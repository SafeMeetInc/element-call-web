const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Bs8NXL8x.js","./matrix-sdk-crypto-wasm-0k4Oq6qg.js","./polyfill-force-C40iLpTT.js","./index-D34BcfIY.js","./polyfill-force-juZMR7fT.js"])))=>i.map(i=>d[i]);
function gfe(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var vnt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ynt(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var fI={exports:{}},i0={},hI={exports:{}},Ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tD;function vfe(){if(tD)return Ct;tD=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),f=Symbol.iterator;function p(G){return G===null||typeof G!="object"?null:(G=f&&G[f]||G["@@iterator"],typeof G=="function"?G:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,g={};function S(G,Q,ge){this.props=G,this.context=Q,this.refs=g,this.updater=ge||m}S.prototype.isReactComponent={},S.prototype.setState=function(G,Q){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,Q,"setState")},S.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function b(){}b.prototype=S.prototype;function w(G,Q,ge){this.props=G,this.context=Q,this.refs=g,this.updater=ge||m}var k=w.prototype=new b;k.constructor=w,v(k,S.prototype),k.isPureReactComponent=!0;var T=Array.isArray,I=Object.prototype.hasOwnProperty,C={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function A(G,Q,ge){var _e,Pe={},Te=null,Re=null;if(Q!=null)for(_e in Q.ref!==void 0&&(Re=Q.ref),Q.key!==void 0&&(Te=""+Q.key),Q)I.call(Q,_e)&&!x.hasOwnProperty(_e)&&(Pe[_e]=Q[_e]);var we=arguments.length-2;if(we===1)Pe.children=ge;else if(1<we){for(var ve=Array(we),We=0;We<we;We++)ve[We]=arguments[We+2];Pe.children=ve}if(G&&G.defaultProps)for(_e in we=G.defaultProps,we)Pe[_e]===void 0&&(Pe[_e]=we[_e]);return{$$typeof:t,type:G,key:Te,ref:Re,props:Pe,_owner:C.current}}function N(G,Q){return{$$typeof:t,type:G.type,key:Q,ref:G.ref,props:G.props,_owner:G._owner}}function D(G){return typeof G=="object"&&G!==null&&G.$$typeof===t}function F(G){var Q={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(ge){return Q[ge]})}var $=/\/+/g;function B(G,Q){return typeof G=="object"&&G!==null&&G.key!=null?F(""+G.key):Q.toString(36)}function W(G,Q,ge,_e,Pe){var Te=typeof G;(Te==="undefined"||Te==="boolean")&&(G=null);var Re=!1;if(G===null)Re=!0;else switch(Te){case"string":case"number":Re=!0;break;case"object":switch(G.$$typeof){case t:case e:Re=!0}}if(Re)return Re=G,Pe=Pe(Re),G=_e===""?"."+B(Re,0):_e,T(Pe)?(ge="",G!=null&&(ge=G.replace($,"$&/")+"/"),W(Pe,Q,ge,"",function(We){return We})):Pe!=null&&(D(Pe)&&(Pe=N(Pe,ge+(!Pe.key||Re&&Re.key===Pe.key?"":(""+Pe.key).replace($,"$&/")+"/")+G)),Q.push(Pe)),1;if(Re=0,_e=_e===""?".":_e+":",T(G))for(var we=0;we<G.length;we++){Te=G[we];var ve=_e+B(Te,we);Re+=W(Te,Q,ge,ve,Pe)}else if(ve=p(G),typeof ve=="function")for(G=ve.call(G),we=0;!(Te=G.next()).done;)Te=Te.value,ve=_e+B(Te,we++),Re+=W(Te,Q,ge,ve,Pe);else if(Te==="object")throw Q=String(G),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.");return Re}function H(G,Q,ge){if(G==null)return G;var _e=[],Pe=0;return W(G,_e,"","",function(Te){return Q.call(ge,Te,Pe++)}),_e}function z(G){if(G._status===-1){var Q=G._result;Q=Q(),Q.then(function(ge){(G._status===0||G._status===-1)&&(G._status=1,G._result=ge)},function(ge){(G._status===0||G._status===-1)&&(G._status=2,G._result=ge)}),G._status===-1&&(G._status=0,G._result=Q)}if(G._status===1)return G._result.default;throw G._result}var K={current:null},V={transition:null},q={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:V,ReactCurrentOwner:C};function Z(){throw Error("act(...) is not supported in production builds of React.")}return Ct.Children={map:H,forEach:function(G,Q,ge){H(G,function(){Q.apply(this,arguments)},ge)},count:function(G){var Q=0;return H(G,function(){Q++}),Q},toArray:function(G){return H(G,function(Q){return Q})||[]},only:function(G){if(!D(G))throw Error("React.Children.only expected to receive a single React element child.");return G}},Ct.Component=S,Ct.Fragment=n,Ct.Profiler=i,Ct.PureComponent=w,Ct.StrictMode=r,Ct.Suspense=l,Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q,Ct.act=Z,Ct.cloneElement=function(G,Q,ge){if(G==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+G+".");var _e=v({},G.props),Pe=G.key,Te=G.ref,Re=G._owner;if(Q!=null){if(Q.ref!==void 0&&(Te=Q.ref,Re=C.current),Q.key!==void 0&&(Pe=""+Q.key),G.type&&G.type.defaultProps)var we=G.type.defaultProps;for(ve in Q)I.call(Q,ve)&&!x.hasOwnProperty(ve)&&(_e[ve]=Q[ve]===void 0&&we!==void 0?we[ve]:Q[ve])}var ve=arguments.length-2;if(ve===1)_e.children=ge;else if(1<ve){we=Array(ve);for(var We=0;We<ve;We++)we[We]=arguments[We+2];_e.children=we}return{$$typeof:t,type:G.type,key:Pe,ref:Te,props:_e,_owner:Re}},Ct.createContext=function(G){return G={$$typeof:o,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},G.Provider={$$typeof:s,_context:G},G.Consumer=G},Ct.createElement=A,Ct.createFactory=function(G){var Q=A.bind(null,G);return Q.type=G,Q},Ct.createRef=function(){return{current:null}},Ct.forwardRef=function(G){return{$$typeof:a,render:G}},Ct.isValidElement=D,Ct.lazy=function(G){return{$$typeof:u,_payload:{_status:-1,_result:G},_init:z}},Ct.memo=function(G,Q){return{$$typeof:c,type:G,compare:Q===void 0?null:Q}},Ct.startTransition=function(G){var Q=V.transition;V.transition={};try{G()}finally{V.transition=Q}},Ct.unstable_act=Z,Ct.useCallback=function(G,Q){return K.current.useCallback(G,Q)},Ct.useContext=function(G){return K.current.useContext(G)},Ct.useDebugValue=function(){},Ct.useDeferredValue=function(G){return K.current.useDeferredValue(G)},Ct.useEffect=function(G,Q){return K.current.useEffect(G,Q)},Ct.useId=function(){return K.current.useId()},Ct.useImperativeHandle=function(G,Q,ge){return K.current.useImperativeHandle(G,Q,ge)},Ct.useInsertionEffect=function(G,Q){return K.current.useInsertionEffect(G,Q)},Ct.useLayoutEffect=function(G,Q){return K.current.useLayoutEffect(G,Q)},Ct.useMemo=function(G,Q){return K.current.useMemo(G,Q)},Ct.useReducer=function(G,Q,ge){return K.current.useReducer(G,Q,ge)},Ct.useRef=function(G){return K.current.useRef(G)},Ct.useState=function(G){return K.current.useState(G)},Ct.useSyncExternalStore=function(G,Q,ge){return K.current.useSyncExternalStore(G,Q,ge)},Ct.useTransition=function(){return K.current.useTransition()},Ct.version="18.3.1",Ct}var nD;function OL(){return nD||(nD=1,hI.exports=vfe()),hI.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rD;function yfe(){if(rD)return i0;rD=1;var t=OL(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,c){var u,f={},p=null,m=null;c!==void 0&&(p=""+c),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(m=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(f[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)f[u]===void 0&&(f[u]=l[u]);return{$$typeof:e,type:a,key:p,ref:m,props:f,_owner:i.current}}return i0.Fragment=n,i0.jsx=o,i0.jsxs=o,i0}var iD;function _fe(){return iD||(iD=1,fI.exports=yfe()),fI.exports}var E=_fe();function sD(t,e,n,r,i,s,o){try{var a=t[s](o),l=a.value}catch(c){return void n(c)}a.done?e(l):Promise.resolve(l).then(r,i)}function U(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(l){sD(s,r,i,o,a,"next",l)}function a(l){sD(s,r,i,o,a,"throw",l)}o(void 0)})}}function W1(t){"@babel/helpers - typeof";return W1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W1(t)}function bfe(t,e){if(W1(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(W1(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Sfe(t){var e=bfe(t,"string");return W1(e)=="symbol"?e:e+""}function L(t,e,n){return(e=Sfe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Efe="l",wfe="rn",Cfe={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":","ꓽ":":","⩴":"::=","⧴":":→","！":"!",ǃ:"!","ⵑ":"!","‼":"!!","⁉":"!?",ʔ:"?","Ɂ":"?","ॽ":"?",Ꭾ:"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·",ᐧ:"·","⋯":"···","ⵈ":"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'","ʹ":"'","ʹ":"'","ˈ":"'","ˊ":"'","ˋ":"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'","ꞌ":"'",י:"'","ߴ":"'","ߵ":"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''","ʺ":"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/","Ⳇ":"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·","Ⲵ":"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">","𖼿":">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2",Ƨ:"2",Ϩ:"2","Ꙅ":"2",ᒿ:"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3",Ȝ:"3",Ʒ:"3","Ꝫ":"3","Ⳍ":"3",З:"3",Ӡ:"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6",б:"6",Ꮾ:"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a",ɑ:"a",α:"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a",а:"a","ⷶ":"ͣ",Ａ:"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A",Α:"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A",А:"A",Ꭺ:"A",ᗅ:"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B",Β:"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B",В:"B",Ᏼ:"B",ᗷ:"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ","ᏼ":"ʙ",ｃ:"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c",ϲ:"c","ⲥ":"c",с:"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C","Ⅽ":"C",ℂ:"C",ℭ:"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C",С:"C",Ꮯ:"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄	⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ",є:"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d",Ꮷ:"d",ᑯ:"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D","ꓓ":"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵","ꝺ":"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ","ꭰ":"ᴅ","⸹":"ẟ",δ:"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ",ծ:"ẟ",ᕷ:"ẟ","℮":"e",ｅ:"e",ℯ:"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E",Ε:"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E",Е:"E","ⴹ":"E",Ꭼ:"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E",ě:"ĕ",Ě:"Ĕ","ɇ":"e̸","Ɇ":"E̸",ҿ:"ę","ꭼ":"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ",ɚ:"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ","Ԑ":"Ɛ",Ꮛ:"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ",з:"ɜ",ҙ:"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f",ſ:"f","ẝ":"f",ք:"f","𝈓":"F",ℱ:"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F",Ϝ:"F","𝟊":"F",ᖴ:"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F",ƒ:"f̦",Ƒ:"F̦","ᵮ":"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g",ɡ:"g","ᶃ":"g",ƍ:"g",ց:"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G",Ꮐ:"G",Ᏻ:"G","ꓖ":"G","ᶢ":"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ",ｈ:"h",ℎ:"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H",Η:"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H",Н:"H",Ꮋ:"H",ᕼ:"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ",ɦ:"h̔","ꚕ":"h̔",Ᏺ:"h̔","Ⱨ":"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵","Ӊ":"H̦",Ӈ:"H̦",н:"ʜ","ꮋ":"ʜ",ң:"ʜ̩","ӊ":"ʜ̦",ӈ:"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i",ｉ:"i","ⅰ":"i",ℹ:"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i",ı:"i","𝚤":"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i",і:"i","ꙇ":"i","ӏ":"i","ꭵ":"i",Ꭵ:"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii",ĳ:"ij","ⅳ":"iv","ⅸ":"ix",ｊ:"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j",ϳ:"j",ј:"j",Ｊ:"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J",Ј:"J",Ꭻ:"J",ᒍ:"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵",ᒙ:"J·","𝚥":"ȷ",յ:"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k",K:"K",Ｋ:"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K",Κ:"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K",К:"K",Ꮶ:"K",ᛕ:"K","ꓗ":"K","𐔘":"K",ƙ:"k̔","Ⱪ":"K̩",Қ:"K̩","₭":"K̵","Ꝁ":"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:Efe,Ｉ:"l","Ⅰ":"l",ℐ:"l",ℑ:"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l",Ɩ:"l",ｌ:"l","ⅼ":"l",ℓ:"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l",ǀ:"l",Ι:"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l","𞸀":"l","𞺀":"l",ﺎ:"l",ﺍ:"l","ߊ":"l","ⵏ":"l",ᛁ:"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L",ℒ:"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L",Ꮮ:"L",ᒪ:"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll","Ⅱ":"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ",Ｍ:"M","Ⅿ":"M",ℳ:"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M",Μ:"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N",Ν:"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩",Ɲ:"N̦","ᵰ":"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No","ͷ":"ᴎ",и:"ᴎ","𐑍":"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o",ο:"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o",σ:"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o",о:"o","ჿ":"o",օ:"o",ס:"o",ه:"o","𞸤":"o","𞹤":"o","𞺄":"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O",Ο:"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O",О:"O",Օ:"O","ⵔ":"O",ዐ:"O",ଠ:"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º",ǒ:"ŏ",Ǒ:"Ŏ","ۿ":"ô",Ő:"Ö",ø:"o̸","ꬾ":"o̸",Ø:"O̸","ⵁ":"O̸",Ǿ:"Ó̸",ɵ:"o̵","ꝋ":"o̵",ө:"o̵",ѳ:"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵","Ꝋ":"O̵",θ:"O̵",ϑ:"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵",Θ:"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵",Ө:"O̵",Ѳ:"O̵","ⴱ":"O̵",Ꮎ:"O̵",Ꮻ:"O̵","ꭴ":"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى","ൟ":"oരo",တ:"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p",ｐ:"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p",ρ:"p",ϱ:"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p",р:"p",Ｐ:"P",ℙ:"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P",Ρ:"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P",Р:"P",Ꮲ:"P",ᑭ:"P","ꓑ":"P","𐊕":"P",ƥ:"p̔","ᵽ":"p̵",ᑷ:"p·",ᒆ:"P'","ᴩ":"ᴘ","ꮲ":"ᴘ",φ:"ɸ",ϕ:"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ",ф:"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q",գ:"q",զ:"q",ℚ:"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q",ʠ:"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ",κ:"ĸ",ϰ:"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ",к:"ĸ","ꮶ":"ĸ",қ:"ĸ̩",ҟ:"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r",г:"r","ꮁ":"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R","ꓣ":"R","𖼵":"R",ɽ:"r̨",ɼ:"r̩","ɍ":"r̵",ғ:"r̵","ᵲ":"r̴",ґ:"r'","𑣣":"rn",m:wfe,"ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸",ɱ:"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ",я:"ᴙ","ᵳ":"ɾ̴","℩":"ɿ",ｓ:"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s",ƽ:"s",ѕ:"s","ꮪ":"s","𑣁":"s","𐑈":"s",Ｓ:"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S",ʂ:"s̨","ᵴ":"s̴","ꞵ":"ß",β:"ß",ϐ:"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T",Τ:"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T",Т:"T",Ꭲ:"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T",ƭ:"t̔","⍡":"T̈","Ⱦ":"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵","ᵵ":"t̴",Ⴀ:"Ꞇ","Ꜩ":"T3",ʨ:"tɕ","℡":"TEL","ꝷ":"tf",ʦ:"ts",ʧ:"tʃ","ꜩ":"tȝ",τ:"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ",т:"ᴛ","ꭲ":"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u",ʋ:"u",υ:"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u",ս:"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U","ꓴ":"U","𖽂":"U","𑢸":"U",ǔ:"ŭ",Ǔ:"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'","ᵫ":"ue","ꭣ":"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v",ｖ:"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v",ν:"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v",ѵ:"v",ט:"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V",Ѵ:"V","ⴸ":"V",Ꮩ:"V",ᐯ:"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ",Л:"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w",ѡ:"w","ԝ":"w",ա:"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W",Ꮃ:"W",Ꮤ:"W","ꓪ":"W",ѽ:"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ",м:"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X",Χ:"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X",Х:"X","ⵝ":"X",ᚷ:"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll",ɣ:"y","ᶌ":"y",ｙ:"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y",ʏ:"y","ỿ":"y","ꭚ":"y",γ:"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y",у:"y",ү:"y",ყ:"y","𑣜":"y",Ｙ:"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y",Υ:"Y",ϒ:"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y",ƴ:"y̔","ɏ":"y̵",ұ:"y̵","¥":"Y̵","Ɏ":"Y̵",Ұ:"Y̵",ʒ:"ȝ","ꝫ":"ȝ","ⳍ":"ȝ",ӡ:"ȝ",ჳ:"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z",Ζ:"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z",Ꮓ:"Z","ꓜ":"Z","𑢩":"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦","ᵶ":"z̴",ƿ:"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ",ϩ:"ƨ","ꙅ":"ƨ",ь:"ƅ","ꮟ":"ƅ",ы:"ƅi","ꭾ":"ɂ",ˤ:"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ","𖼇":"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ",ᐃ:"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ",µ:"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ",ϖ:"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π",п:"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π",П:"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ",ϛ:"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ",ѱ:"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω",Ω:"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω",ᘯ:"Ω",ᘵ:"Ω","𐊶":"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И",Й:"Ѝ","Ҋ":"Ѝ̦",ѝ:"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո","ꓵ":"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ","ݲ":"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز",ﺰ:"ز",ﺯ:"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ","ݾ":"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ","ࢯ":"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ","ࢤ":"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ","ݣ":"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى","ݢ":"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ","ࢰ":"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م","ࢧ":"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن","ݨ":"نؕ","ݩ":"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و",ﻮ:"و",ﻭ:"و","ࢱ":"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى",ں:"ى","𞸝":"ى","𞹝":"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆",ێ:"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै","ऄ":"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ",က:"ဂာ","ၰ":"ဃှ","ၦ":"ပှ",ဟ:"ပာ","ၯ":"ပာှ","ၾ":"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·","ᣝ":"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ","ᣠ":"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·",ᕩ:"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ",ᇃ:"ᄀᄅ","ᇻ":"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ","ᇿ":"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ","ퟋ":"ᄂᄅ",ᄖ:"ᄂᄇ","ᅛ":"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ","ᅜ":"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ","ퟌ":"ᄂᄎ",ᇉ:"ᄂᄐ","ᅝ":"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ",ᇋ:"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ","ꥤ":"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ","ꥦ":"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ","ꥧ":"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ","ꥬ":"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ","ퟲ":"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ","ퟛ":"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ","ퟜ":"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ","ꥯ":"ᄆᄀ",ᇚ:"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ",ᇛ:"ᄆᄅ","ퟠ":"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ","ퟢ":"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ","ퟣ":"ᄇᄃ",ᇣ:"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ","ퟦ":"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ","ퟨ":"ᄇᄌ",ᄨ:"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ","ꥴ":"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ","ퟪ":"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ","ퟯ":"ᄉᄌ",ᄷ:"ᄉᄎ","ퟰ":"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ","ퟱ":"ᄉᄐ",ᄺ:"ᄉᄑ","ퟮ":"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ","ꥶ":"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ","ꥷ":"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ","ꥹ":"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ","ퟺ":"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ","ꥻ":"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ","ꥼ":"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ","ᆣ":"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ","ᆤ":"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ","ᆥ":"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨","ힰ":"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ","ힱ":"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨","ힴ":"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨","ힵ":"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨","ힶ":"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ","ힷ":"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨","ힸ":"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ","ퟅ":"ᆞᅡ",ᆟ:"ᆞᅥ","ퟆ":"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄",不:"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨",ᆚ:"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ",ᆛ:"丨ᅮ","ퟃ":"丨ᅲ",ᆝ:"丨ᆞ","ퟄ":"丨丨",串:"串","丸":"丸",丹:"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二","𠄢":"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什","仌":"仌",令:"令","你":"你",倂:"併","倂":"併","侀":"侀",來:"來",例:"例","侮":"侮","侮":"侮","侻":"侻",便:"便",值:"値",倫:"倫","偺":"偺","備":"備","像":"像",僚:"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿",兀:"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全",兩:"兩",ハ:"八","⼋":"八",六:"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃",切:"切","切":"切",列:"列",利:"利","㓟":"㓟",刺:"刺","刻":"刻","剆":"剆","割":"割","剷":"剷",劉:"劉","𠠄":"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉",勒:"勒",勞:"勞","勤":"勤","勤":"勤",勵:"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕",北:"北","北":"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即",卵:"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶",參:"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句","叫":"叫","叱":"叱","吆":"吆",吏:"吏",吝:"吝","吸":"吸",呂:"呂","呈":"呈","周":"周","咞":"咞","咢":"咢",咽:"咽",䎛:"㖈","哶":"哶","唐":"唐","啓":"啓",啟:"啓","啕":"啕","啣":"啣","善":"善","善":"善",喇:"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳",嗀:"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器",囹:"囹","圖":"圖","圗":"圗","⼟":"土",士:"土","⼠":"土","型":"型","城":"城",㦳:"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀",塚:"塚","塚":"塚",塞:"塞",填:"塡",壿:"墫","墬":"墬","墳":"墳",壘:"壘",壟:"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊",タ:"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄",奈:"奈",契:"契","奔":"奔","奢":"奢",女:"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦",嬀:"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀",宅:"宅","𡧈":"𡧈","寃":"寃","寘":"寘",寧:"寧",寧:"寧","寧":"寧",寮:"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸",尿:"尿","屠":"屠",屢:"屢","層":"層",履:"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦",崙:"崙","嵃":"嵃",嵐:"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲",嶺:"嶺","⼮":"巛","巢":"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾",帲:"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干",年:"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶",廊:"廊","廊":"廊",廉:"廉","廒":"廒",廓:"廓","廙":"廙",廬:"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱",弄:"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳",律:"律","㣣":"㣣","徚":"徚",復:"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志",念:"念","忹":"忹",怒:"怒",怜:"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘",惡:"惡","𢛔":"𢛔","愈":"愈","慨":"慨",慄:"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎",憐:"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲",懶:"懶","懶":"懶",戀:"戀","⼽":"戈","成":"成","戛":"戛",戮:"戮","戴":"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱",拉:"拉",拏:"拏",拓:"拓","拔":"拔","拼":"拼",拾:"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨",捻:"捻","掃":"掃",掠:"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮",搉:"㩁",撚:"撚","撝":"撝",擄:"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬",數:"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日",易:"易",曶:"㫚","㫤":"㫤","晉":"晉",晩:"晚",晴:"晴","晴":"晴","暑":"暑","暑":"暑",暈:"暈","㬈":"㬈","暜":"暜",暴:"暴",曆:"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰",更:"更","書":"書","⽉":"月","𣍟":"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗","朗":"朗","朗":"朗",脧:"朘","望":"望","望":"望",幐:"㬺",䐠:"㬻","𣎓":"𣎓",膧:"朣","𣎜":"𣎜","⽊":"木",李:"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃",柿:"杮",杻:"杻","枅":"枅",林:"林","㭉":"㭉","𣏕":"𣏕",柳:"柳","柺":"柺",栗:"栗","栟":"栟","桒":"桒","𣑭":"𣑭",梁:"梁","梅":"梅","梅":"梅","梎":"梎",梨:"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝",槩:"㮣",樧:"榝","榣":"榣","槪":"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓","𣚣":"𣚣","檨":"檨",櫓:"櫓","櫛":"櫛",欄:"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲",歷:"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟",殮:"殮","⽎":"殳",殺:"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧",沈:"沈","沿":"沿",泌:"泌","泍":"泍",泥:"泥","𣲼":"𣲼",洛:"洛",洞:"洞","洴":"洴","派":"派",流:"流","流":"流","流":"流","洖":"洖","浩":"浩",浪:"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞",淋:"淋",淚:"淚",淪:"淪","淹":"淹","渚":"渚","港":"港","湮":"湮",潙:"溈","滋":"滋","滋":"滋",溜:"溜",溺:"溺","滇":"滇",滑:"滑","滛":"滛","㴳":"㴳",漏:"漏","漢":"漢","漢":"漢",漣:"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆",濫:"濫",濾:"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災",炙:"炙","炭":"炭",烈:"烈",烙:"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅",煉:"煉","𤋮":"𤋮","熜":"熜",燎:"燎",燐:"燐","𤎫":"𤎫",爐:"爐",爛:"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛",牢:"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯",狀:"狀","𤜵":"𤜵",狼:"狼",猪:"猪","猪":"猪","𤠔":"𤠔",獵:"獵","獺":"獺","⽞":"玄",率:"率",率:"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥",玲:"玲","㺸":"㺸","㺸":"㺸",珞:"珞",琉:"琉",理:"理","琢":"琢","瑇":"瑇","瑜":"瑜",瑩:"瑩","瑱":"瑱","瑱":"瑱","璅":"璅",璉:"璉",璘:"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶",留:"留",略:"略",異:"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒",痢:"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼",益:"益","益":"益","盛":"盛",盧:"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳",省:"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹",晣:"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝",硏:"研","硎":"硎",硫:"硫",碌:"碌","碌":"碌","碑":"碑",磊:"磊","磌":"磌","磌":"磌",磻:"磻","䃣":"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝",神:"神",祥:"祥","視":"視","視":"視",祿:"祿","𥚚":"𥚚","禍":"禍","禎":"禎",福:"福","福":"福","𥛅":"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊","䄯":"䄯","秫":"秫",稜:"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱",立:"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹",笠:"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐",簾:"簾",籠:"籠","⽶":"米","类":"类",粒:"粒",精:"精","糒":"糒",糖:"糖","糨":"糨","䊠":"䊠","糣":"糣",糧:"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀",紐:"紐",索:"索",累:"累",絶:"絕","絣":"絣","絛":"絛",綠:"綠",綾:"綾","緇":"緇",練:"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉",縷:"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙",罹:"罹","罺":"罺",羅:"羅","𦌾":"𦌾","⽺":"羊","羕":"羕",羚:"羚",羽:"羽","⽻":"羽","翺":"翺",老:"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳",聆:"聆","聠":"聠","𦖨":"𦖨",聯:"聯","聰":"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙",腁:"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽",若:"若","若":"若","苦":"苦","𦬼":"𦬼",茶:"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓",菉:"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華",菱:"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭",落:"落",葉:"葉",蔿:"蒍","𦳕":"𦳕","𦵫":"𦵫",蓮:"蓮","蓱":"蓱","蓳":"蓳",蓼:"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬",藍:"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡",藺:"藺",蘆:"蘆","䕫":"䕫",蘒:"蘒",蘭:"蘭","𧃒":"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎","虐":"虐",虜:"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊",螺:"螺","蠁":"蠁","䗹":"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤",裂:"裂","𧙧":"𧙧",裏:"裏","裗":"裗","裞":"裞",裡:"裡",裸:"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆",見:"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦",詽:"訮",訞:"䚶","䚾":"䚾","䛇":"䛇","誠":"誠",說:"說",說:"說","調":"調","請":"請",諒:"諒",論:"論","諭":"諭","諭":"諭",諸:"諸","諸":"諸",諾:"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹",識:"識",讀:"讀",讏:"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈","豕":"豕","⾗":"豕",豣:"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁",賂:"賂",賈:"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起",趆:"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼",跺:"跥",路:"路","跰":"跰",躛:"躗","⾝":"身",車:"車","⾞":"車","軔":"軔",輧:"軿",輦:"輦",輪:"輪","輸":"輸","輸":"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛","辞":"辞",辰:"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡",連:"連",逸:"逸","逸":"逸","遲":"遲",遼:"遼","𨗒":"𨗒","𨗭":"𨗭",邏:"邏","⾢":"邑","邔":"邔",郎:"郎",郞:"郎","郞":"郎","郱":"郱",都:"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉",酪:"酪","醙":"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼",錄:"錄",鍊:"鍊",鎮:"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕",閭:"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸","陼":"陼",隆:"隆",隣:"隣","䧦":"䧦","⾪":"隶","隷":"隷",隸:"隷",隸:"隷","⾫":"隹","雃":"雃",離:"離","難":"難","難":"難","⾬":"雨",零:"零",雷:"雷","霣":"霣","𩅅":"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋",領:"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻",類:"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢",飯:"飯",飼:"飼","䬳":"䬳",館:"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂",駱:"駱","駾":"駾",驪:"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯","鱀":"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎",鶴:"鶴","𪄅":"𪄅","䳸":"䳸",鷺:"鷺","𪈎":"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿","𪊑":"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎","䵖":"䵖","⿊":"黑",黒:"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿",龍:"龍","⿓":"龍","龎":"龎","⻰":"龙",龜:"龜",龜:"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var pI,oD;function Tfe(){if(oD)return pI;oD=1;var t=Cfe;function e(s){return s.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n=RegExp(Object.keys(t).map(e).join("|"),"g");function r(s){return t[s]}function i(s){return s.replace(n,r)}return pI=i,pI}var Rfe=Tfe();const Ife=Xa(Rfe);var s0={exports:{}},mI={},gI,aD;function kfe(){if(aD)return gI;aD=1;function t(e,n){typeof n=="boolean"&&(n={forever:n}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=n||{},this._maxRetryTime=n&&n.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return gI=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var n=new Date().getTime();if(e&&n-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,n){this._fn=e,n&&(n.timeout&&(this._operationTimeout=n.timeout),n.cb&&(this._operationTimeoutCb=n.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},n=null,r=0,i=0;i<this._errors.length;i++){var s=this._errors[i],o=s.message,a=(e[o]||0)+1;e[o]=a,a>=r&&(n=s,r=a)}return n},gI}var lD;function xfe(){return lD||(lD=1,function(t){var e=kfe();t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in n)r[i]=n[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<r.retries;o++)s.push(this.createTimeout(o,r));return n&&n.forever&&!s.length&&s.push(this.createTimeout(o,r)),s.sort(function(a,l){return a-l}),s},t.createTimeout=function(n,r){var i=r.randomize?Math.random()+1:1,s=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return s=Math.min(s,r.maxTimeout),s},t.wrap=function(n,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var s in n)typeof n[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],l=n[a];n[a]=(function(u){var f=t.operation(r),p=Array.prototype.slice.call(arguments,1),m=p.pop();p.push(function(v){f.retry(v)||(v&&(arguments[0]=f.mainError()),m.apply(this,arguments))}),f.attempt(function(){u.apply(n,p)})}).bind(n,l),n[a].options=r}}}(mI)),mI}var vI,cD;function Pfe(){return cD||(cD=1,vI=xfe()),vI}var uD;function Lfe(){if(uD)return s0.exports;uD=1;const t=Pfe(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(a){super(),a instanceof Error?(this.originalError=a,{message:a}=a):(this.originalError=new Error(a),this.originalError.stack=this.stack),this.name="AbortError",this.message=a}}const r=(o,a,l)=>{const c=l.retries-(a-1);return o.attemptNumber=a,o.retriesLeft=c,o},i=o=>e.includes(o),s=(o,a)=>new Promise((l,c)=>{a={onFailedAttempt:()=>{},retries:10,...a};const u=t.operation(a);u.attempt(async f=>{try{l(await o(f))}catch(p){if(!(p instanceof Error)){c(new TypeError(`Non-error was thrown: "${p}". You should only throw errors.`));return}if(p instanceof n)u.stop(),c(p.originalError);else if(p instanceof TypeError&&!i(p.message))u.stop(),c(p);else{r(p,f,a);try{await a.onFailedAttempt(p)}catch(m){c(m);return}u.retry(p)||c(u.mainError())}}})});return s0.exports=s,s0.exports.default=s,s0.exports.AbortError=n,s0.exports}var Afe=Lfe();const FK=Xa(Afe);let zy=class{constructor(e,n){if(this.stable=e,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){var e=[this.name],n=this.altName;return n&&e.push(n),e}matches(e){return this.name===e||this.altName===e}findIn(e){var n=void 0;return this.name&&(n=e==null?void 0:e[this.name]),!n&&this.altName&&(n=e==null?void 0:e[this.altName]),n}includedIn(e){var n=!1;return this.name&&(n=e.includes(this.name)),!n&&this.altName&&(n=e.includes(this.altName)),n}};class SC extends zy{constructor(){super(...arguments),L(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class wr extends zy{constructor(e,n){if(super(e,n),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}var ig=function(t){return t.Self="m.self",t.Pin="m.pin",t}({}),Yy=new wr("m.asset","org.matrix.msc3488.asset"),tf=new wr("m.ts","org.matrix.msc3488.ts"),Xy=new wr("m.location","org.matrix.msc3488.location"),Ji=function(t){return t.Read="m.read",t.FullyRead="m.fully_read",t.ReadPrivate="m.read.private",t}({}),Jy="main";function dD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function fD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dD(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var yI=new Map;function _I(t){return t instanceof String&&(t=t.toString()),yI.has(t)||yI.set(t,t),yI.get(t)}function D6(t,e){var n=e??new URLSearchParams,r=function(a){s!=null&&(Array.isArray(s)?s.forEach(l=>{n.append(a,String(l))}):n.append(a,String(s)))};for(var[i,s]of Object.entries(t))r(i);return n}function hD(t,e,n){var r=fD(fD({},n),{},{[e]:n[t]});return delete r[t],r}function Ie(t,e){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r!=null&&(t=t.replace(n,encodeURIComponent(r)))}return t}function OE(t,e,n){var r;if(n){for(r=t.length-1;r>=0;r--)if(e(t[r],r,t))return t.splice(r,1),!0}else for(r=0;r<t.length;r++)if(e(t[r],r,t))return t.splice(r,1),!0;return!1}function UK(t,e){for(var n of e)if(!t.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function Zy(t){return JSON.parse(JSON.stringify(t))}function Eh(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="number"&&isNaN(t)&&isNaN(e))return!0;if(t===null||e===null)return t===e;if(!(t instanceof Object)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===e.toString();if(Array.isArray(t)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!Eh(t[n],e[n]))return!1}else{for(var r in e)if(e.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;for(var i in t)if(e.hasOwnProperty(i)!==t.hasOwnProperty(i)||!Eh(t[i],e[i]))return!1}return!0}function F6(t){if(typeof t!="object"||t==null||Array.isArray(t))return t;var e=[];for(var[n,r]of Object.entries(t))e.push([n,F6(r)]);return e.sort((i,s)=>_2(i[0],s[0])),e}function pD(t){return typeof t=="number"&&isFinite(t)}function wd(t){return typeof t=="string"?Ife(t.normalize("NFD").replace(Mfe,"")):""}function ME(t){return typeof t=="string"?t.replace(/[\u202d-\u202e]/g,""):""}function Ofe(t){return wd(t.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}var Mfe=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function jK(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $K(t){return jK(t).replace(/\\\*/g,".*").replace(/\?/g,".")}function bI(t){return t!=null&&t.endsWith("/")?t.slice(0,-1):t}function tu(t,e){return new Promise(n=>{setTimeout(n,t,e)})}function bnt(t,e,n){return U6.apply(this,arguments)}function U6(){return U6=U(function*(t,e,n){var r=Date.now();try{return yield n()}finally{var i=Date.now();t.debug("[Perf]: ".concat(e," took ").concat(i-r,"ms"))}}),U6.apply(this,arguments)}function Nfe(t,e,n){var r=Date.now();try{return n()}finally{var i=Date.now();t.debug("[Perf]: ".concat(e," took ").concat(i-r,"ms"))}}function BK(t){return t==null}function Dfe(){return Promise.withResolvers()}function dm(t,e){return j6.apply(this,arguments)}function j6(){return j6=U(function*(t,e){for(var n of t)yield e(yield n)}),j6.apply(this,arguments)}function xp(t){return Promise.resolve(t())}function Ffe(t){return FK(e=>t(e),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})}var Dd=(()=>{for(var t="",e=32;e<=126;e++)t+=String.fromCharCode(e);return t})();function mD(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Dd;return t.padEnd(e,n[0])}function z1(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dd,n=BigInt(e.length);if(t<=n){var r;return(r=e[Number(t)-1])!==null&&r!==void 0?r:""}var i=t/n,s=Number(t%n)-1;return s<0&&(i-=BigInt(Math.abs(s)),s=Number(n)-1),z1(i,e)+e[s]}function NE(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dd,n=BigInt(e.length),r=BigInt(0),i=t.length-1,s=BigInt(0);i>=0;i--,s++){var o=t.charCodeAt(i)-e.charCodeAt(0);r+=BigInt(1+o)*n**s}return r}function Ufe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Dd,r=Math.max(t.length,e.length),i=NE(mD(t,r,n),n),s=NE(mD(e,r,n),n),o=(i+s)/BigInt(2);return o===i||o==s?z1(o,n)+n[0]:z1(o,n)}function o0(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dd;return z1(NE(t,e)+BigInt(1),e)}function gD(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dd;return z1(NE(t,e)-BigInt(1),e)}function _2(t,e){return t<e?-1:t>e?1:0}function HK(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;for(var[r,i]of Object.entries(e)){if(t[r]instanceof Object&&i){HK(t[r],i);continue}if(i!=null||!n){DE(t,r,i);continue}}return t}function vD(t){var e;return(e=tf.findIn(t.getContent()))!==null&&e!==void 0?e:-1}function jfe(t,e){return vD(e)-vD(t)}function ML(t){return[Ji.Read,Ji.ReadPrivate].includes(t)}function yD(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o===a;if(t.size!==e.size)return!1;for(var[r,i]of t){var s=e.get(r);if(s===void 0||!n(i,s))return!1}return!0}function VK(t){return t instanceof Map?eh(t):Array.isArray(t)?t.map(e=>VK(e)):t}function eh(t){var e=new Map;for(var[n,r]of t)e.set(n,VK(r));return Object.fromEntries(e.entries())}function d1(t){return t==="__proto__"||t==="prototype"||t==="constructor"}function DE(t,e,n){if(d1(e))throw new Error("Trying to modify prototype or constructor");t[e]=n}function La(t){return!(d1(t.room_id)||d1(t.sender)||d1(t.event_id))}class Bc extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}var $6="migrationState",sg=function(t){return t[t.NOT_STARTED=0]="NOT_STARTED",t[t.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",t[t.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",t[t.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",t[t.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",t[t.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",t}({}),og=50;function _D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function bD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_D(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_D(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Xb(t,e){return encodeURIComponent(t)+"/"+encodeURIComponent(e)}function $fe(t){var e=t.split("/"),n=decodeURIComponent(e[0]),r=decodeURIComponent(e[1]);return{senderKey:n,sessionId:r}}class EC{constructor(){L(this,"migrationState",sg.NOT_STARTED),L(this,"account",null),L(this,"crossSigningKeys",null),L(this,"privateKeys",{}),L(this,"sessions",{}),L(this,"inboundGroupSessions",{}),L(this,"inboundGroupSessionsWithheld",{}),L(this,"rooms",{}),L(this,"sessionsNeedingBackup",{})}containsData(){var e=this;return U(function*(){return e.account!==null})()}startup(){var e=this;return U(function*(){return e})()}deleteAllData(){return Promise.resolve()}getMigrationState(){var e=this;return U(function*(){return e.migrationState})()}setMigrationState(e){var n=this;return U(function*(){n.migrationState=e})()}getAccount(e,n){n(this.account)}storeAccount(e,n){this.account=n}getCrossSigningKeys(e,n){n(this.crossSigningKeys)}getSecretStorePrivateKey(e,n,r){var i=this.privateKeys[r];n(i||null)}storeSecretStorePrivateKey(e,n,r){this.privateKeys[n]=r}countEndToEndSessions(e,n){var r=0;for(var i of Object.values(this.sessions))r+=Object.keys(i).length;n(r)}getEndToEndSession(e,n,r,i){var s=this.sessions[e]||{};i(s[n]||null)}getEndToEndSessions(e,n,r){r(this.sessions[e]||{})}storeEndToEndSession(e,n,r,i){var s=this.sessions[e];s===void 0&&(s={},this.sessions[e]=s),DE(s,n,r)}getEndToEndSessionsBatch(){var e=this;return U(function*(){var n=[];for(var r of Object.values(e.sessions))for(var i of Object.values(r))if(n.push(i),n.length>=og)return n;return n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return U(function*(){for(var{deviceKey:r,sessionId:i}of e){var s=n.sessions[r]||{};delete s[i],Object.keys(s).length===0&&delete n.sessions[r]}})()}getEndToEndInboundGroupSession(e,n,r,i){var s=Xb(e,n);i(this.inboundGroupSessions[s]||null,this.inboundGroupSessionsWithheld[s]||null)}storeEndToEndInboundGroupSession(e,n,r,i){var s=Xb(e,n);this.inboundGroupSessions[s]=r}countEndToEndInboundGroupSessions(){var e=this;return U(function*(){return Object.keys(e.inboundGroupSessions).length})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return U(function*(){var n=[];for(var[r,i]of Object.entries(e.inboundGroupSessions))if(n.push(bD(bD({},$fe(r)),{},{sessionData:i,needsBackup:r in e.sessionsNeedingBackup})),n.length>=og)return n;return n.length===0?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return U(function*(){for(var{senderKey:r,sessionId:i}of e){var s=Xb(r,i);delete n.inboundGroupSessions[s]}})()}getEndToEndRooms(e,n){n(this.rooms)}markSessionsNeedingBackup(e){for(var n of e){var r=Xb(n.senderKey,n.sessionId);this.sessionsNeedingBackup[r]=!0}return Promise.resolve()}doTxn(e,n,r){return Promise.resolve(r(null))}}var Bfe=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/;function Hfe(t){var e=Bfe.exec(t);return(e==null?void 0:e[0])===t}var Vfe=/^[\w-]+$/;function Gfe(t){var e=Vfe.exec(t);return(e==null?void 0:e[0])===t}function wC(t,e,n,r,i){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;if(typeof e!="string"||!e)return"";if(!e.startsWith("mxc://"))return s?e:"";var[l,c,...u]=e.slice(6).split("/");if(u.length>0||!Hfe(l)||!Gfe(c))return"";a&&(o=!0);var f,p=!!n||!!r||!!i,m=p?"thumbnail":"download";a?f="/_matrix/client/v1/media/".concat(m):f="/_matrix/media/v3/".concat(m);var v=new URL("".concat(f,"/").concat(l,"/").concat(c),t);return n&&v.searchParams.set("width",Math.round(n).toString()),r&&v.searchParams.set("height",Math.round(r).toString()),i&&v.searchParams.set("method",i),typeof o=="boolean"&&v.searchParams.set("allow_redirect",JSON.stringify(o)),v.href}var b2={exports:{}},qfe=b2.exports,SD;function Kfe(){return SD||(SD=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(qfe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&r?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function f(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return c(g)||f.apply(this,arguments)}function m(g,S){var b=this,w,k,T,I="loglevel";typeof g=="string"?I+=":"+g:typeof g=="symbol"&&(I=void 0);function C(F){var $=(i[F]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function x(){var F;if(!(typeof window===n||!I)){try{F=window.localStorage[I]}catch{}if(typeof F===n)try{var $=window.document.cookie,B=encodeURIComponent(I),W=$.indexOf(B+"=");W!==-1&&(F=/^([^;]+)/.exec($.slice(W+B.length+1))[1])}catch{}return b.levels[F]===void 0&&(F=void 0),F}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(F){var $=F;if(typeof $=="string"&&b.levels[$.toUpperCase()]!==void 0&&($=b.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=b.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+F)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return T??k??w},b.setLevel=function(F,$){return T=N(F),$!==!1&&C(T),u.call(b)},b.setDefaultLevel=function(F){k=N(F),x()||b.setLevel(F,!1)},b.resetLevel=function(){T=null,A(),u.call(b)},b.enableAll=function(F){b.setLevel(b.levels.TRACE,F)},b.disableAll=function(F){b.setLevel(b.levels.SILENT,F)},b.rebuild=function(){if(o!==b&&(w=N(o.getLevel())),u.call(b),o===b)for(var F in s)s[F].rebuild()},w=N(o?o.getLevel():"WARN");var D=x();D!=null&&(T=N(D)),u.call(b)}o=new m,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[S];return b||(b=s[S]=new m(S,o.methodFactory)),b};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(b2)),b2.exports}var Wfe=Kfe();const B6=Xa(Wfe);var zfe="matrix";B6.methodFactory=function(t,e,n){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.prefix&&i.unshift(this.prefix);var o=t==="error"||t==="warn"||t==="trace"||t==="info"||t==="debug";return o?console[t](...i):console.log(...i)}};function GK(t){var e=zfe+(t===void 0?"":"-".concat(t)),n=B6.getLogger(e);return n.getChild===void 0&&(n.prefix=t,n.getChild=r=>{var i=GK((t??"")+r);return i.methodFactory=n.methodFactory,i.rebuild(),i},n.setLevel(B6.levels.DEBUG,!1)),n}var O=GK();class Snt{constructor(e,n){this.parent=e,L(this,"name",void 0),this.name=n+":"}trace(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.trace(this.name,...n)}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.debug(this.name,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.info(this.name,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.warn(this.name,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.error(this.name,...n)}}var Jb={exports:{}},ED;function Yfe(){if(ED)return Jb.exports;ED=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(I,C,x){return Function.prototype.apply.call(I,C,x)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:n=function(I){return Object.getOwnPropertyNames(I)};function r(T){console&&console.warn&&console.warn(T)}var i=Number.isNaN||function(I){return I!==I};function s(){s.init.call(this)}Jb.exports=s,Jb.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");o=T}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function l(T){return T._maxListeners===void 0?s.defaultMaxListeners:T._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(I){for(var C=[],x=1;x<arguments.length;x++)C.push(arguments[x]);var A=I==="error",N=this._events;if(N!==void 0)A=A&&N.error===void 0;else if(!A)return!1;if(A){var D;if(C.length>0&&(D=C[0]),D instanceof Error)throw D;var F=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw F.context=D,F}var $=N[I];if($===void 0)return!1;if(typeof $=="function")e($,this,C);else for(var B=$.length,W=v($,B),x=0;x<B;++x)e(W[x],this,C);return!0};function c(T,I,C,x){var A,N,D;if(a(C),N=T._events,N===void 0?(N=T._events=Object.create(null),T._eventsCount=0):(N.newListener!==void 0&&(T.emit("newListener",I,C.listener?C.listener:C),N=T._events),D=N[I]),D===void 0)D=N[I]=C,++T._eventsCount;else if(typeof D=="function"?D=N[I]=x?[C,D]:[D,C]:x?D.unshift(C):D.push(C),A=l(T),A>0&&D.length>A&&!D.warned){D.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.emitter=T,F.type=I,F.count=D.length,r(F)}return T}s.prototype.addListener=function(I,C){return c(this,I,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(I,C){return c(this,I,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(T,I,C){var x={fired:!1,wrapFn:void 0,target:T,type:I,listener:C},A=u.bind(x);return A.listener=C,x.wrapFn=A,A}s.prototype.once=function(I,C){return a(C),this.on(I,f(this,I,C)),this},s.prototype.prependOnceListener=function(I,C){return a(C),this.prependListener(I,f(this,I,C)),this},s.prototype.removeListener=function(I,C){var x,A,N,D,F;if(a(C),A=this._events,A===void 0)return this;if(x=A[I],x===void 0)return this;if(x===C||x.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete A[I],A.removeListener&&this.emit("removeListener",I,x.listener||C));else if(typeof x!="function"){for(N=-1,D=x.length-1;D>=0;D--)if(x[D]===C||x[D].listener===C){F=x[D].listener,N=D;break}if(N<0)return this;N===0?x.shift():g(x,N),x.length===1&&(A[I]=x[0]),A.removeListener!==void 0&&this.emit("removeListener",I,F||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(I){var C,x,A;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[I]),this;if(arguments.length===0){var N=Object.keys(x),D;for(A=0;A<N.length;++A)D=N[A],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=x[I],typeof C=="function")this.removeListener(I,C);else if(C!==void 0)for(A=C.length-1;A>=0;A--)this.removeListener(I,C[A]);return this};function p(T,I,C){var x=T._events;if(x===void 0)return[];var A=x[I];return A===void 0?[]:typeof A=="function"?C?[A.listener||A]:[A]:C?S(A):v(A,A.length)}s.prototype.listeners=function(I){return p(this,I,!0)},s.prototype.rawListeners=function(I){return p(this,I,!1)},s.listenerCount=function(T,I){return typeof T.listenerCount=="function"?T.listenerCount(I):m.call(T,I)},s.prototype.listenerCount=m;function m(T){var I=this._events;if(I!==void 0){var C=I[T];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(T,I){for(var C=new Array(I),x=0;x<I;++x)C[x]=T[x];return C}function g(T,I){for(;I+1<T.length;I++)T[I]=T[I+1];T.pop()}function S(T){for(var I=new Array(T.length),C=0;C<I.length;++C)I[C]=T[C].listener||T[C];return I}function b(T,I){return new Promise(function(C,x){function A(D){T.removeListener(I,N),x(D)}function N(){typeof T.removeListener=="function"&&T.removeListener("error",A),C([].slice.call(arguments))}k(T,I,N,{once:!0}),I!=="error"&&w(T,A,{once:!0})})}function w(T,I,C){typeof T.on=="function"&&k(T,"error",I,C)}function k(T,I,C,x){if(typeof T.on=="function")x.once?T.once(I,C):T.on(I,C);else if(typeof T.addEventListener=="function")T.addEventListener(I,function A(N){x.once&&T.removeEventListener(I,A),C(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}return Jb.exports}var CC=Yfe();const NL=Xa(CC);var qK=function(t){return t.NewListener="newListener",t.RemoveListener="removeListener",t.Error="error",t}({});class Un extends CC.EventEmitter{addListener(e,n){return super.addListener(e,n)}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return super.emit(e,...r)}emitPromised(e){var n=arguments,r=this;return U(function*(){for(var i=n.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=n[o];var a=r.listeners(e);return Promise.allSettled(a.map(l=>l(...s))).then(()=>a.length>0)})()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,n){return super.off(e,n)}on(e,n){return super.on(e,n)}once(e,n){return super.once(e,n)}prependListener(e,n){return super.prependListener(e,n)}prependOnceListener(e,n){return super.prependOnceListener(e,n)}removeAllListeners(e){return e===void 0?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,n){return super.removeListener(e,n)}rawListeners(e){return super.rawListeners(e)}}var ee=function(t){return t.RoomCanonicalAlias="m.room.canonical_alias",t.RoomCreate="m.room.create",t.RoomJoinRules="m.room.join_rules",t.RoomMember="m.room.member",t.RoomThirdPartyInvite="m.room.third_party_invite",t.RoomPowerLevels="m.room.power_levels",t.RoomName="m.room.name",t.RoomTopic="m.room.topic",t.RoomAvatar="m.room.avatar",t.RoomPinnedEvents="m.room.pinned_events",t.RoomEncryption="m.room.encryption",t.RoomHistoryVisibility="m.room.history_visibility",t.RoomGuestAccess="m.room.guest_access",t.RoomServerAcl="m.room.server_acl",t.RoomTombstone="m.room.tombstone",t.RoomPredecessor="org.matrix.msc3946.room_predecessor",t.PolicyRuleUser="m.policy.rule.user",t.PolicyRuleRoom="m.policy.rule.room",t.PolicyRuleServer="m.policy.rule.server",t.SpaceChild="m.space.child",t.SpaceParent="m.space.parent",t.RoomRedaction="m.room.redaction",t.RoomMessage="m.room.message",t.RoomMessageEncrypted="m.room.encrypted",t.Sticker="m.sticker",t.CallInvite="m.call.invite",t.CallCandidates="m.call.candidates",t.CallAnswer="m.call.answer",t.CallHangup="m.call.hangup",t.CallReject="m.call.reject",t.CallSelectAnswer="m.call.select_answer",t.CallNegotiate="m.call.negotiate",t.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",t.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",t.CallReplaces="m.call.replaces",t.CallAssertedIdentity="m.call.asserted_identity",t.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",t.CallEncryptionKeysPrefix="io.element.call.encryption_keys",t.KeyVerificationRequest="m.key.verification.request",t.KeyVerificationStart="m.key.verification.start",t.KeyVerificationCancel="m.key.verification.cancel",t.KeyVerificationMac="m.key.verification.mac",t.KeyVerificationDone="m.key.verification.done",t.KeyVerificationKey="m.key.verification.key",t.KeyVerificationAccept="m.key.verification.accept",t.KeyVerificationReady="m.key.verification.ready",t.RoomMessageFeedback="m.room.message.feedback",t.Reaction="m.reaction",t.PollStart="org.matrix.msc3381.poll.start",t.Typing="m.typing",t.Receipt="m.receipt",t.Presence="m.presence",t.FullyRead="m.fully_read",t.Tag="m.tag",t.SpaceOrder="org.matrix.msc3230.space_order",t.PushRules="m.push_rules",t.Direct="m.direct",t.IgnoredUserList="m.ignored_user_list",t.RoomKey="m.room_key",t.RoomKeyRequest="m.room_key_request",t.ForwardedRoomKey="m.forwarded_room_key",t.Dummy="m.dummy",t.SecretRequest="m.secret.request",t.SecretSend="m.secret.send",t.GroupCallPrefix="org.matrix.msc3401.call",t.GroupCallMemberPrefix="org.matrix.msc3401.call.member",t.CallNotify="org.matrix.msc4075.call.notify",t}({}),Tn=function(t){return t.Annotation="m.annotation",t.Replace="m.replace",t.Reference="m.reference",t.Thread="m.thread",t}({}),ql=function(t){return t.Text="m.text",t.Emote="m.emote",t.Notice="m.notice",t.Image="m.image",t.File="m.file",t.Audio="m.audio",t.Location="m.location",t.Video="m.video",t.KeyVerificationRequest="m.key.verification.request",t}({}),FE="type",Cm=function(t){return t.Space="m.space",t.UnstableCall="org.matrix.msc3417.call",t.ElementVideo="io.element.video",t}({}),TC="org.matrix.msgid",H6=new wr("m.room.purpose","org.matrix.msc3088.purpose"),V6=new wr("m.enabled","org.matrix.msc3088.enabled"),G6=new wr("m.data_tree","org.matrix.msc3089.data_tree"),KK=new wr("m.leaf","org.matrix.msc3089.leaf"),Pc=new wr("m.branch","org.matrix.msc3089.branch"),WK=new wr("m.room.marker","org.matrix.msc2716.marker"),q6=new wr("with_rel_types","org.matrix.msc3912.with_relations"),zK=new wr("io.element.functional_members","io.element.functional_members"),th=new wr("m.visibility","org.matrix.msc3531.visibility"),K6=new wr("enabled","org.matrix.msc3881.enabled"),Xfe=new wr("device_id","org.matrix.msc3881.device_id"),YK=new wr("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),UE=new wr("thread_id","org.matrix.msc4023.thread_id"),XK=new zy("membership","io.element.msc4115.membership"),qe=function(t){return t.Ban="ban",t.Invite="invite",t.Join="join",t.Knock="knock",t.Leave="leave",t}({}),Is=function(t){return t.Membership="RoomMember.membership",t.Name="RoomMember.name",t.PowerLevel="RoomMember.powerLevel",t.Typing="RoomMember.typing",t}({});class Y1 extends Un{constructor(e,n){super(),this.roomId=e,this.userId=n,L(this,"_isOutOfBand",!1),L(this,"modified",-1),L(this,"requestedProfileInfo",!1),L(this,"typing",!1),L(this,"name",void 0),L(this,"rawDisplayName",void 0),L(this,"powerLevel",0),L(this,"powerLevelNorm",0),L(this,"user",void 0),L(this,"membership",void 0),L(this,"disambiguate",!1),L(this,"events",{}),this.name=n,this.rawDisplayName=n,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,n){var r,i,s=(r=e.getDirectionalContent().displayname)!==null&&r!==void 0?r:"";if(e.getType()===ee.RoomMember){this._isOutOfBand=!1,this.events.member=e;var o=this.membership;this.membership=e.getDirectionalContent().membership,this.membership===void 0&&O.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=Qfe(this.userId,s,n);var a=this.name;this.name=ehe(this.userId,s,this.disambiguate),this.rawDisplayName=ME((i=e.getDirectionalContent().displayname)!==null&&i!==void 0?i:""),(!this.rawDisplayName||!wd(this.rawDisplayName))&&(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(Is.Membership,e,this,o)),a!==this.name&&(this.updateModifiedTime(),this.emit(Is.Name,e,this,a))}}setPowerLevelEvent(e){if(!(e.getType()!==ee.RoomPowerLevels||e.getStateKey()!=="")){var n=e.getDirectionalContent(),r=n.users_default||0,i=n.users||{};Object.values(i).forEach(a=>{r=Math.max(r,a)});var s=this.powerLevel,o=this.powerLevelNorm;i[this.userId]!==void 0&&Number.isInteger(i[this.userId])?this.powerLevel=i[this.userId]:n.users_default!==void 0?this.powerLevel=n.users_default:this.powerLevel=0,this.powerLevelNorm=0,r>0&&(this.powerLevelNorm=this.powerLevel*100/r),(s!==this.powerLevel||o!==this.powerLevelNorm)&&(this.updateModifiedTime(),this.emit(Is.PowerLevel,e,this))}}setTypingEvent(e){if(e.getType()==="m.typing"){var n=this.typing;this.typing=!1;var r=e.getContent().user_ids;Array.isArray(r)&&(r.indexOf(this.userId)!==-1&&(this.typing=!0),n!==this.typing&&(this.updateModifiedTime(),this.emit(Is.Typing,e,this)))}}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===qe.Leave&&this.events.member!==void 0&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){var e=this.events.member,n=e.getContent(),r=e.getSender();if(n.membership===qe.Join&&(n=e.getPrevContent(),r=e.getUnsigned().prev_sender),n.membership===qe.Invite&&n.is_direct)return r}}getAvatarUrl(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,l=this.getMxcAvatarUrl();if(!l&&!s)return null;var c=wC(e,l,n,r,i,o,void 0,a);return c||null}getMxcAvatarUrl(){if(this.events.member)return this.events.member.getDirectionalContent().avatar_url;if(this.user)return this.user.avatarUrl}}var Jfe=/@.+:.+/,Zfe=/[\u200E\u200F\u202A-\u202F]/;function Qfe(t,e,n){if(!e||e===t||!n)return!1;var r=wd(e);if(!r)return!1;if(Jfe.test(r)||Zfe.test(e))return!0;var i=n.getUserIdsWithDisplayName(e);return!!i.some(s=>s!==t)}function ehe(t,e,n){return!e||e===t?t:n?ME(e)+" ("+t+")":wd(e)?ME(e):t}var SI={},a0={},l0={},wD;function JK(){if(wD)return l0;wD=1,Object.defineProperty(l0,"__esModule",{value:!0}),l0.NamespacedMap=void 0;function t(l,c){var u=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(!u){if(Array.isArray(l)||(u=e(l))||c){u&&(l=u);var f=0,p=function(){};return{s:p,n:function(){return f>=l.length?{done:!0}:{done:!1,value:l[f++]}},e:function(b){throw b},f:p}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,g;return{s:function(){u=u.call(l)},n:function(){var b=u.next();return m=b.done,b},e:function(b){v=!0,g=b},f:function(){try{!m&&u.return!=null&&u.return()}finally{if(v)throw g}}}}function e(l,c){if(l){if(typeof l=="string")return n(l,c);var u=Object.prototype.toString.call(l).slice(8,-1);if(u==="Object"&&l.constructor&&(u=l.constructor.name),u==="Map"||u==="Set")return Array.from(l);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return n(l,c)}}function n(l,c){(c==null||c>l.length)&&(c=l.length);for(var u=0,f=new Array(c);u<c;u++)f[u]=l[u];return f}function r(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")}function i(l,c){for(var u=0;u<c.length;u++){var f=c[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(l,f.key,f)}}function s(l,c,u){return c&&i(l.prototype,c),Object.defineProperty(l,"prototype",{writable:!1}),l}function o(l,c,u){return c in l?Object.defineProperty(l,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[c]=u,l}var a=function(){function l(c){if(r(this,l),o(this,"internalMap",new Map),c){var u=t(c),f;try{for(u.s();!(f=u.n()).done;){var p=f.value;this.set(p[0],p[1])}}catch(m){u.e(m)}finally{u.f()}}}return s(l,[{key:"get",value:function(u){return u.name&&this.internalMap.has(u.name)?this.internalMap.get(u.name):u.altName&&this.internalMap.has(u.altName)?this.internalMap.get(u.altName):null}},{key:"set",value:function(u,f){u.name&&this.internalMap.set(u.name,f),u.altName&&this.internalMap.set(u.altName,f)}},{key:"has",value:function(u){return!!this.get(u)}},{key:"delete",value:function(u){u.name&&this.internalMap.delete(u.name),u.altName&&this.internalMap.delete(u.altName)}},{key:"hasNamespaced",value:function(u){return this.internalMap.has(u)}},{key:"getNamespaced",value:function(u){return this.internalMap.get(u)}}]),l}();return l0.NamespacedMap=a,l0}var c0={},CD;function $g(){if(CD)return c0;CD=1;function t(v){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},t(v)}Object.defineProperty(c0,"__esModule",{value:!0}),c0.InvalidEventError=void 0;function e(v,g,S){return Object.defineProperty(v,"prototype",{writable:!1}),v}function n(v,g){if(!(v instanceof g))throw new TypeError("Cannot call a class as a function")}function r(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(g&&g.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),Object.defineProperty(v,"prototype",{writable:!1}),g&&f(v,g)}function i(v){var g=c();return function(){var b=p(v),w;if(g){var k=p(this).constructor;w=Reflect.construct(b,arguments,k)}else w=b.apply(this,arguments);return s(this,w)}}function s(v,g){if(g&&(t(g)==="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o(v)}function o(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function a(v){var g=typeof Map=="function"?new Map:void 0;return a=function(b){if(b===null||!u(b))return b;if(typeof b!="function")throw new TypeError("Super expression must either be null or a function");if(typeof g<"u"){if(g.has(b))return g.get(b);g.set(b,w)}function w(){return l(b,arguments,p(this).constructor)}return w.prototype=Object.create(b.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),f(w,b)},a(v)}function l(v,g,S){return c()?l=Reflect.construct:l=function(w,k,T){var I=[null];I.push.apply(I,k);var C=Function.bind.apply(w,I),x=new C;return T&&f(x,T.prototype),x},l.apply(null,arguments)}function c(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function u(v){return Function.toString.call(v).indexOf("[native code]")!==-1}function f(v,g){return f=Object.setPrototypeOf||function(b,w){return b.__proto__=w,b},f(v,g)}function p(v){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(S){return S.__proto__||Object.getPrototypeOf(S)},p(v)}var m=function(v){r(S,v);var g=i(S);function S(b){return n(this,S),g.call(this,b)}return e(S)}(a(Error));return c0.InvalidEventError=m,c0}var Pp={},u0={},d0={},TD;function Qy(){if(TD)return d0;TD=1,Object.defineProperty(d0,"__esModule",{value:!0}),d0.ExtensibleEvent=void 0;function t(i,s){if(!(i instanceof s))throw new TypeError("Cannot call a class as a function")}function e(i,s){for(var o=0;o<s.length;o++){var a=s[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function n(i,s,o){return s&&e(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),i}var r=function(){function i(s){t(this,i),this.wireFormat=s}return n(i,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),i}();return d0.ExtensibleEvent=r,d0}var f0={},RD;function ZK(){if(RD)return f0;RD=1,Object.defineProperty(f0,"__esModule",{value:!0}),f0.isOptionalAString=t,f0.isProvided=e;function t(n){return e(n)&&typeof n=="string"}function e(n){return n!=null}return f0}var zs={},Af={},ID;function Bg(){if(ID)return Af;ID=1;function t(m){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},t(m)}Object.defineProperty(Af,"__esModule",{value:!0}),Af.UnstableValue=Af.NamespacedValue=void 0;function e(m,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(v&&v.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),v&&n(m,v)}function n(m,v){return n=Object.setPrototypeOf||function(S,b){return S.__proto__=b,S},n(m,v)}function r(m){var v=o();return function(){var S=a(m),b;if(v){var w=a(this).constructor;b=Reflect.construct(S,arguments,w)}else b=S.apply(this,arguments);return i(this,b)}}function i(m,v){if(v&&(t(v)==="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(m)}function s(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(m){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)},a(m)}function l(m,v){if(!(m instanceof v))throw new TypeError("Cannot call a class as a function")}function c(m,v){for(var g=0;g<v.length;g++){var S=v[g];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(m,S.key,S)}}function u(m,v,g){return v&&c(m.prototype,v),Object.defineProperty(m,"prototype",{writable:!1}),m}var f=function(){function m(v,g){if(l(this,m),this.stable=v,this.unstable=g,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return u(m,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(g){return!!this.name&&this.name===g||!!this.altName&&this.altName===g}},{key:"findIn",value:function(g){var S;return this.name&&(S=g==null?void 0:g[this.name]),!S&&this.altName&&(S=g==null?void 0:g[this.altName]),S}},{key:"includedIn",value:function(g){var S=!1;return this.name&&(S=g.includes(this.name)),!S&&this.altName&&(S=g.includes(this.altName)),S}}]),m}();Af.NamespacedValue=f;var p=function(m){e(g,m);var v=r(g);function g(S,b){var w;if(l(this,g),w=v.call(this,S,b),!w.unstable)throw new Error("Unstable value must be supplied");return w}return u(g,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),g}(f);return Af.UnstableValue=p,Af}var kD;function Kl(){if(kD)return zs;kD=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.M_TEXT=zs.M_NOTICE=zs.M_MESSAGE=zs.M_HTML=zs.M_EMOTE=void 0;var t=Bg(),e=new t.UnstableValue("m.message","org.matrix.msc1767.message");zs.M_MESSAGE=e;var n=new t.UnstableValue("m.text","org.matrix.msc1767.text");zs.M_TEXT=n;var r=new t.UnstableValue("m.html","org.matrix.msc1767.html");zs.M_HTML=r;var i=new t.UnstableValue("m.emote","org.matrix.msc1767.emote");zs.M_EMOTE=i;var s=new t.UnstableValue("m.notice","org.matrix.msc1767.notice");return zs.M_NOTICE=s,zs}var Zb={},xD;function Bh(){if(xD)return Zb;xD=1,Object.defineProperty(Zb,"__esModule",{value:!0}),Zb.isEventTypeSame=t;function t(e,n){if(typeof e=="string")return typeof n=="string"?n===e:n.matches(e);if(typeof n=="string")return e.matches(n);var r=n,i=e;return r.matches(i.name)||r.matches(i.altName)}return Zb}var PD;function Hh(){if(PD)return u0;PD=1;function t(T){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},t(T)}Object.defineProperty(u0,"__esModule",{value:!0}),u0.MessageEvent=void 0;var e=Qy(),n=ZK(),r=$g(),i=Kl(),s=Bh();function o(T,I){var C=Object.keys(T);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(T);I&&(x=x.filter(function(A){return Object.getOwnPropertyDescriptor(T,A).enumerable})),C.push.apply(C,x)}return C}function a(T){for(var I=1;I<arguments.length;I++){var C=arguments[I]!=null?arguments[I]:{};I%2?o(Object(C),!0).forEach(function(x){w(T,x,C[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(C)):o(Object(C)).forEach(function(x){Object.defineProperty(T,x,Object.getOwnPropertyDescriptor(C,x))})}return T}function l(T,I){if(!(T instanceof I))throw new TypeError("Cannot call a class as a function")}function c(T,I){for(var C=0;C<I.length;C++){var x=I[C];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(T,x.key,x)}}function u(T,I,C){return I&&c(T.prototype,I),C&&c(T,C),Object.defineProperty(T,"prototype",{writable:!1}),T}function f(T,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(I&&I.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),Object.defineProperty(T,"prototype",{writable:!1}),I&&p(T,I)}function p(T,I){return p=Object.setPrototypeOf||function(x,A){return x.__proto__=A,x},p(T,I)}function m(T){var I=S();return function(){var x=b(T),A;if(I){var N=b(this).constructor;A=Reflect.construct(x,arguments,N)}else A=x.apply(this,arguments);return v(this,A)}}function v(T,I){if(I&&(t(I)==="object"||typeof I=="function"))return I;if(I!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(T)}function g(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(T){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},b(T)}function w(T,I,C){return I in T?Object.defineProperty(T,I,{value:C,enumerable:!0,configurable:!0,writable:!0}):T[I]=C,T}var k=function(T){f(C,T);var I=m(C);function C(x){var A;l(this,C),A=I.call(this,x),w(g(A),"text",void 0),w(g(A),"html",void 0),w(g(A),"renderings",void 0);var N=i.M_MESSAGE.findIn(A.wireContent),D=i.M_TEXT.findIn(A.wireContent),F=i.M_HTML.findIn(A.wireContent);if((0,n.isProvided)(N)){if(!Array.isArray(N))throw new r.InvalidEventError("m.message contents must be an array");var $=N.find(function(W){return!(0,n.isProvided)(W.mimetype)||W.mimetype==="text/plain"}),B=N.find(function(W){return W.mimetype==="text/html"});if(!$)throw new r.InvalidEventError("m.message is missing a plain text representation");A.text=$.body,A.html=B==null?void 0:B.body,A.renderings=N}else if((0,n.isOptionalAString)(D))A.text=D,A.html=F,A.renderings=[{body:D,mimetype:"text/plain"}],A.html&&A.renderings.push({body:A.html,mimetype:"text/html"});else throw new r.InvalidEventError("Missing textual representation for event");return A}return u(C,[{key:"isEmote",get:function(){return i.M_EMOTE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return i.M_NOTICE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(A){return(0,s.isEventTypeSame)(A,i.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var A=w({},i.M_MESSAGE.name,this.renderings);if(this.renderings.length===1){var N=this.renderings[0].mimetype;(N===void 0||N==="text/plain")&&(A=w({},i.M_TEXT.name,this.renderings[0].body))}return A}},{key:"serialize",value:function(){var A;return{type:"m.room.message",content:a(a({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:(A=this.html)!==null&&A!==void 0?A:void 0})}}}],[{key:"from",value:function(A,N){var D;return new C({type:i.M_MESSAGE.name,content:(D={},w(D,i.M_TEXT.name,A),w(D,i.M_HTML.name,N),D)})}}]),C}(e.ExtensibleEvent);return u0.MessageEvent=k,u0}var h0={},LD;function DL(){if(LD)return h0;LD=1;function t(w){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},t(w)}Object.defineProperty(h0,"__esModule",{value:!0}),h0.NoticeEvent=void 0;var e=Hh(),n=Kl(),r=Bh();function i(w,k,T){return k in w?Object.defineProperty(w,k,{value:T,enumerable:!0,configurable:!0,writable:!0}):w[k]=T,w}function s(w,k){if(!(w instanceof k))throw new TypeError("Cannot call a class as a function")}function o(w,k){for(var T=0;T<k.length;T++){var I=k[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(w,I.key,I)}}function a(w,k,T){return k&&o(w.prototype,k),T&&o(w,T),Object.defineProperty(w,"prototype",{writable:!1}),w}function l(){return typeof Reflect<"u"&&Reflect.get?l=Reflect.get:l=function(k,T,I){var C=c(k,T);if(C){var x=Object.getOwnPropertyDescriptor(C,T);return x.get?x.get.call(arguments.length<3?k:I):x.value}},l.apply(this,arguments)}function c(w,k){for(;!Object.prototype.hasOwnProperty.call(w,k)&&(w=S(w),w!==null););return w}function u(w,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(k&&k.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),k&&f(w,k)}function f(w,k){return f=Object.setPrototypeOf||function(I,C){return I.__proto__=C,I},f(w,k)}function p(w){var k=g();return function(){var I=S(w),C;if(k){var x=S(this).constructor;C=Reflect.construct(I,arguments,x)}else C=I.apply(this,arguments);return m(this,C)}}function m(w,k){if(k&&(t(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v(w)}function v(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(w){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},S(w)}var b=function(w){u(T,w);var k=p(T);function T(I){return s(this,T),k.call(this,I)}return a(T,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(C){return(0,r.isEventTypeSame)(C,n.M_NOTICE)||l(S(T.prototype),"isEquivalentTo",this).call(this,C)}},{key:"serialize",value:function(){var C=l(S(T.prototype),"serialize",this).call(this);return C.content.msgtype="m.notice",C}}],[{key:"from",value:function(C,x){var A;return new T({type:n.M_NOTICE.name,content:(A={},i(A,n.M_TEXT.name,C),i(A,n.M_HTML.name,x),A)})}}]),T}(e.MessageEvent);return h0.NoticeEvent=b,h0}var p0={},AD;function FL(){if(AD)return p0;AD=1;function t(w){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},t(w)}Object.defineProperty(p0,"__esModule",{value:!0}),p0.EmoteEvent=void 0;var e=Hh(),n=Kl(),r=Bh();function i(w,k,T){return k in w?Object.defineProperty(w,k,{value:T,enumerable:!0,configurable:!0,writable:!0}):w[k]=T,w}function s(w,k){if(!(w instanceof k))throw new TypeError("Cannot call a class as a function")}function o(w,k){for(var T=0;T<k.length;T++){var I=k[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(w,I.key,I)}}function a(w,k,T){return k&&o(w.prototype,k),T&&o(w,T),Object.defineProperty(w,"prototype",{writable:!1}),w}function l(){return typeof Reflect<"u"&&Reflect.get?l=Reflect.get:l=function(k,T,I){var C=c(k,T);if(C){var x=Object.getOwnPropertyDescriptor(C,T);return x.get?x.get.call(arguments.length<3?k:I):x.value}},l.apply(this,arguments)}function c(w,k){for(;!Object.prototype.hasOwnProperty.call(w,k)&&(w=S(w),w!==null););return w}function u(w,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(k&&k.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),k&&f(w,k)}function f(w,k){return f=Object.setPrototypeOf||function(I,C){return I.__proto__=C,I},f(w,k)}function p(w){var k=g();return function(){var I=S(w),C;if(k){var x=S(this).constructor;C=Reflect.construct(I,arguments,x)}else C=I.apply(this,arguments);return m(this,C)}}function m(w,k){if(k&&(t(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v(w)}function v(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(w){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},S(w)}var b=function(w){u(T,w);var k=p(T);function T(I){return s(this,T),k.call(this,I)}return a(T,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(C){return(0,r.isEventTypeSame)(C,n.M_EMOTE)||l(S(T.prototype),"isEquivalentTo",this).call(this,C)}},{key:"serialize",value:function(){var C=l(S(T.prototype),"serialize",this).call(this);return C.content.msgtype="m.emote",C}}],[{key:"from",value:function(C,x){var A;return new T({type:n.M_EMOTE.name,content:(A={},i(A,n.M_TEXT.name,C),i(A,n.M_HTML.name,x),A)})}}]),T}(e.MessageEvent);return p0.EmoteEvent=b,p0}var OD;function QK(){if(OD)return Pp;OD=1,Object.defineProperty(Pp,"__esModule",{value:!0}),Pp.LEGACY_M_ROOM_MESSAGE=void 0,Pp.parseMRoomMessage=c;var t=Hh(),e=DL(),n=FL(),r=Bg(),i=Kl();function s(u,f){var p=Object.keys(u);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(u);f&&(m=m.filter(function(v){return Object.getOwnPropertyDescriptor(u,v).enumerable})),p.push.apply(p,m)}return p}function o(u){for(var f=1;f<arguments.length;f++){var p=arguments[f]!=null?arguments[f]:{};f%2?s(Object(p),!0).forEach(function(m){a(u,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(p)):s(Object(p)).forEach(function(m){Object.defineProperty(u,m,Object.getOwnPropertyDescriptor(p,m))})}return u}function a(u,f,p){return f in u?Object.defineProperty(u,f,{value:p,enumerable:!0,configurable:!0,writable:!0}):u[f]=p,u}var l=new r.NamespacedValue("m.room.message");Pp.LEGACY_M_ROOM_MESSAGE=l;function c(u){var f,p,m;if(i.M_MESSAGE.findIn(u.content)||i.M_TEXT.findIn(u.content))return new t.MessageEvent(u);var v=(f=u.content)===null||f===void 0?void 0:f.msgtype,g=(p=u.content)===null||p===void 0?void 0:p.body,S=((m=u.content)===null||m===void 0?void 0:m.format)==="org.matrix.custom.html"?u.content.formatted_body:null;if(v==="m.text"){var b;return new t.MessageEvent(o(o({},u),{},{content:o(o({},u.content),{},(b={},a(b,i.M_TEXT.name,g),a(b,i.M_HTML.name,S),b))}))}else if(v==="m.notice"){var w;return new e.NoticeEvent(o(o({},u),{},{content:o(o({},u.content),{},(w={},a(w,i.M_TEXT.name,g),a(w,i.M_HTML.name,S),w))}))}else if(v==="m.emote"){var k;return new n.EmoteEvent(o(o({},u),{},{content:o(o({},u.content),{},(k={},a(k,i.M_TEXT.name,g),a(k,i.M_HTML.name,S),k))}))}else return null}return Pp}var Qb={},MD;function eW(){if(MD)return Qb;MD=1,Object.defineProperty(Qb,"__esModule",{value:!0}),Qb.parseMMessage=i;var t=Hh(),e=Kl(),n=FL(),r=DL();function i(s){return e.M_EMOTE.matches(s.type)?new n.EmoteEvent(s):e.M_NOTICE.matches(s.type)?new r.NoticeEvent(s):new t.MessageEvent(s)}return Qb}var Ys={},ND;function Hg(){if(ND)return Ys;ND=1,Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.M_POLL_START=Ys.M_POLL_RESPONSE=Ys.M_POLL_KIND_UNDISCLOSED=Ys.M_POLL_KIND_DISCLOSED=Ys.M_POLL_END=void 0;var t=Bg(),e=new t.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");Ys.M_POLL_KIND_DISCLOSED=e;var n=new t.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");Ys.M_POLL_KIND_UNDISCLOSED=n;var r=new t.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");Ys.M_POLL_START=r;var i=new t.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");Ys.M_POLL_RESPONSE=i;var s=new t.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");return Ys.M_POLL_END=s,Ys}var eS={},Of={},DD;function tW(){if(DD)return Of;DD=1;function t(H){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},t(H)}Object.defineProperty(Of,"__esModule",{value:!0}),Of.PollStartEvent=Of.PollAnswerSubevent=void 0;var e=Hg(),n=Hh(),r=Kl(),i=$g(),s=Bg(),o=Bh(),a=Qy();function l(H){return p(H)||f(H)||u(H)||c()}function c(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u(H,z){if(H){if(typeof H=="string")return m(H,z);var K=Object.prototype.toString.call(H).slice(8,-1);if(K==="Object"&&H.constructor&&(K=H.constructor.name),K==="Map"||K==="Set")return Array.from(H);if(K==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(K))return m(H,z)}}function f(H){if(typeof Symbol<"u"&&H[Symbol.iterator]!=null||H["@@iterator"]!=null)return Array.from(H)}function p(H){if(Array.isArray(H))return m(H)}function m(H,z){(z==null||z>H.length)&&(z=H.length);for(var K=0,V=new Array(z);K<z;K++)V[K]=H[K];return V}function v(H,z){var K=Object.keys(H);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(H);z&&(V=V.filter(function(q){return Object.getOwnPropertyDescriptor(H,q).enumerable})),K.push.apply(K,V)}return K}function g(H){for(var z=1;z<arguments.length;z++){var K=arguments[z]!=null?arguments[z]:{};z%2?v(Object(K),!0).forEach(function(V){D(H,V,K[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(K)):v(Object(K)).forEach(function(V){Object.defineProperty(H,V,Object.getOwnPropertyDescriptor(K,V))})}return H}function S(H,z){if(!(H instanceof z))throw new TypeError("Cannot call a class as a function")}function b(H,z){for(var K=0;K<z.length;K++){var V=z[K];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(H,V.key,V)}}function w(H,z,K){return z&&b(H.prototype,z),K&&b(H,K),Object.defineProperty(H,"prototype",{writable:!1}),H}function k(H,z){if(typeof z!="function"&&z!==null)throw new TypeError("Super expression must either be null or a function");H.prototype=Object.create(z&&z.prototype,{constructor:{value:H,writable:!0,configurable:!0}}),Object.defineProperty(H,"prototype",{writable:!1}),z&&T(H,z)}function T(H,z){return T=Object.setPrototypeOf||function(V,q){return V.__proto__=q,V},T(H,z)}function I(H){var z=A();return function(){var V=N(H),q;if(z){var Z=N(this).constructor;q=Reflect.construct(V,arguments,Z)}else q=V.apply(this,arguments);return C(this,q)}}function C(H,z){if(z&&(t(z)==="object"||typeof z=="function"))return z;if(z!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x(H)}function x(H){if(H===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return H}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function N(H){return N=Object.setPrototypeOf?Object.getPrototypeOf:function(K){return K.__proto__||Object.getPrototypeOf(K)},N(H)}function D(H,z,K){return z in H?Object.defineProperty(H,z,{value:K,enumerable:!0,configurable:!0,writable:!0}):H[z]=K,H}var F=function(H){k(K,H);var z=I(K);function K(V){var q;S(this,K),q=z.call(this,V),D(x(q),"id",void 0);var Z=V.content.id;if(!Z||typeof Z!="string")throw new i.InvalidEventError("Answer ID must be a non-empty string");return q.id=Z,q}return w(K,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:g({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(q,Z){return new K({type:"org.matrix.sdk.poll.answer",content:D({id:q},r.M_TEXT.name,Z)})}}]),K}(n.MessageEvent);Of.PollAnswerSubevent=F;var $=function(H){k(K,H);var z=I(K);function K(V){var q;S(this,K),q=z.call(this,V),D(x(q),"question",void 0),D(x(q),"kind",void 0),D(x(q),"rawKind",void 0),D(x(q),"maxSelections",void 0),D(x(q),"answers",void 0);var Z=e.M_POLL_START.findIn(q.wireContent);if(!Z.question)throw new i.InvalidEventError("A question is required");if(q.question=new n.MessageEvent({type:"org.matrix.sdk.poll.question",content:Z.question}),q.rawKind=Z.kind,e.M_POLL_KIND_DISCLOSED.matches(q.rawKind)?q.kind=e.M_POLL_KIND_DISCLOSED:q.kind=e.M_POLL_KIND_UNDISCLOSED,q.maxSelections=Number.isFinite(Z.max_selections)&&Z.max_selections>0?Z.max_selections:1,!Array.isArray(Z.answers))throw new i.InvalidEventError("Poll answers must be an array");var G=Z.answers.slice(0,20).map(function(Q){return new F({type:"org.matrix.sdk.poll.answer",content:Q})});if(G.length<=0)throw new i.InvalidEventError("No answers available");return q.answers=G,q}return w(K,[{key:"isEquivalentTo",value:function(q){return(0,o.isEventTypeSame)(q,e.M_POLL_START)}},{key:"serialize",value:function(){var q;return{type:e.M_POLL_START.name,content:(q={},D(q,e.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(Z){return Z.serialize().content})}),D(q,r.M_TEXT.name,"".concat(this.question.text,`
`).concat(this.answers.map(function(Z,G){return"".concat(G+1,". ").concat(Z.text)}).join(`
`))),q)}}}],[{key:"from",value:function(q,Z,G){var Q,ge=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return new K({type:e.M_POLL_START.name,content:(Q={},D(Q,r.M_TEXT.name,q),D(Q,e.M_POLL_START.name,{question:D({},r.M_TEXT.name,q),kind:G instanceof s.NamespacedValue?G.name:G,max_selections:ge,answers:Z.map(function(_e){return D({id:W()},r.M_TEXT.name,_e)})}),Q)})}}]),K}(a.ExtensibleEvent);Of.PollStartEvent=$;var B="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function W(){return l(Array(16)).map(function(){return B.charAt(Math.floor(Math.random()*B.length))}).join("")}return Of}var m0={},g0={},FD;function UL(){if(FD)return g0;FD=1,Object.defineProperty(g0,"__esModule",{value:!0}),g0.REFERENCE_RELATION=void 0;var t=Bg(),e=new t.NamespacedValue("m.reference");return g0.REFERENCE_RELATION=e,g0}var UD;function nW(){if(UD)return m0;UD=1;function t(w){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},t(w)}Object.defineProperty(m0,"__esModule",{value:!0}),m0.PollResponseEvent=void 0;var e=Qy(),n=Hg(),r=$g(),i=UL(),s=Bh();function o(w,k){if(!(w instanceof k))throw new TypeError("Cannot call a class as a function")}function a(w,k){for(var T=0;T<k.length;T++){var I=k[T];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(w,I.key,I)}}function l(w,k,T){return k&&a(w.prototype,k),T&&a(w,T),Object.defineProperty(w,"prototype",{writable:!1}),w}function c(w,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(k&&k.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),k&&u(w,k)}function u(w,k){return u=Object.setPrototypeOf||function(I,C){return I.__proto__=C,I},u(w,k)}function f(w){var k=v();return function(){var I=g(w),C;if(k){var x=g(this).constructor;C=Reflect.construct(I,arguments,x)}else C=I.apply(this,arguments);return p(this,C)}}function p(w,k){if(k&&(t(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m(w)}function m(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(w){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},g(w)}function S(w,k,T){return k in w?Object.defineProperty(w,k,{value:T,enumerable:!0,configurable:!0,writable:!0}):w[k]=T,w}var b=function(w){c(T,w);var k=f(T);function T(I){var C;o(this,T),C=k.call(this,I),S(m(C),"internalAnswerIds",void 0),S(m(C),"internalSpoiled",void 0),S(m(C),"pollEventId",void 0);var x=C.wireContent["m.relates_to"];if(!i.REFERENCE_RELATION.matches(x==null?void 0:x.rel_type)||typeof(x==null?void 0:x.event_id)!="string")throw new r.InvalidEventError("Relationship must be a reference to an event");return C.pollEventId=x.event_id,C.validateAgainst(null),C}return l(T,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(C){var x=n.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(x==null?void 0:x.answers)){this.internalSpoiled=!0,this.internalAnswerIds=[];return}var A=x.answers;if(A.some(function(N){return typeof N!="string"})||A.length===0){this.internalSpoiled=!0,this.internalAnswerIds=[];return}if(C){if(A.some(function(N){return!C.answers.some(function(D){return D.id===N})})){this.internalSpoiled=!0,this.internalAnswerIds=[];return}A=A.slice(0,C.maxSelections)}this.internalAnswerIds=A,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(C){return(0,s.isEventTypeSame)(C,n.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:n.M_POLL_RESPONSE.name,content:S({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:this.pollEventId}},n.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(C,x){return new T({type:n.M_POLL_RESPONSE.name,content:S({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:x}},n.M_POLL_RESPONSE.name,{answers:C})})}}]),T}(e.ExtensibleEvent);return m0.PollResponseEvent=b,m0}var v0={},jD;function rW(){if(jD)return v0;jD=1;function t(C){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(C)}Object.defineProperty(v0,"__esModule",{value:!0}),v0.PollEndEvent=void 0;var e=Hg(),n=$g(),r=UL(),i=Hh(),s=Kl(),o=Bh(),a=Qy();function l(C,x){var A=Object.keys(C);if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(C);x&&(N=N.filter(function(D){return Object.getOwnPropertyDescriptor(C,D).enumerable})),A.push.apply(A,N)}return A}function c(C){for(var x=1;x<arguments.length;x++){var A=arguments[x]!=null?arguments[x]:{};x%2?l(Object(A),!0).forEach(function(N){T(C,N,A[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(A)):l(Object(A)).forEach(function(N){Object.defineProperty(C,N,Object.getOwnPropertyDescriptor(A,N))})}return C}function u(C,x){if(!(C instanceof x))throw new TypeError("Cannot call a class as a function")}function f(C,x){for(var A=0;A<x.length;A++){var N=x[A];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(C,N.key,N)}}function p(C,x,A){return x&&f(C.prototype,x),A&&f(C,A),Object.defineProperty(C,"prototype",{writable:!1}),C}function m(C,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(x&&x.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),x&&v(C,x)}function v(C,x){return v=Object.setPrototypeOf||function(N,D){return N.__proto__=D,N},v(C,x)}function g(C){var x=w();return function(){var N=k(C),D;if(x){var F=k(this).constructor;D=Reflect.construct(N,arguments,F)}else D=N.apply(this,arguments);return S(this,D)}}function S(C,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return b(C)}function b(C){if(C===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function k(C){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},k(C)}function T(C,x,A){return x in C?Object.defineProperty(C,x,{value:A,enumerable:!0,configurable:!0,writable:!0}):C[x]=A,C}var I=function(C){m(A,C);var x=g(A);function A(N){var D;u(this,A),D=x.call(this,N),T(b(D),"pollEventId",void 0),T(b(D),"closingMessage",void 0);var F=D.wireContent["m.relates_to"];if(!r.REFERENCE_RELATION.matches(F==null?void 0:F.rel_type)||typeof(F==null?void 0:F.event_id)!="string")throw new n.InvalidEventError("Relationship must be a reference to an event");return D.pollEventId=F.event_id,D.closingMessage=new i.MessageEvent(D.wireFormat),D}return p(A,[{key:"isEquivalentTo",value:function(D){return(0,o.isEventTypeSame)(D,e.M_POLL_END)}},{key:"serialize",value:function(){return{type:e.M_POLL_END.name,content:c(T({"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:this.pollEventId}},e.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(D,F){var $;return new A({type:e.M_POLL_END.name,content:($={"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:D}},T($,e.M_POLL_END.name,{}),T($,s.M_TEXT.name,F),$)})}}]),A}(a.ExtensibleEvent);return v0.PollEndEvent=I,v0}var $D;function iW(){if($D)return eS;$D=1,Object.defineProperty(eS,"__esModule",{value:!0}),eS.parseMPoll=i;var t=Hg(),e=tW(),n=nW(),r=rW();function i(s){return t.M_POLL_START.matches(s.type)?new e.PollStartEvent(s):t.M_POLL_RESPONSE.matches(s.type)?new n.PollResponseEvent(s):t.M_POLL_END.matches(s.type)?new r.PollEndEvent(s):null}return eS}var BD;function the(){if(BD)return a0;BD=1,Object.defineProperty(a0,"__esModule",{value:!0}),a0.ExtensibleEvents=void 0;var t=JK(),e=$g(),n=QK(),r=eW(),i=Kl(),s=Hg(),o=iW();function a(g,S){var b=typeof Symbol<"u"&&g[Symbol.iterator]||g["@@iterator"];if(!b){if(Array.isArray(g)||(b=l(g))||S){b&&(g=b);var w=0,k=function(){};return{s:k,n:function(){return w>=g.length?{done:!0}:{done:!1,value:g[w++]}},e:function(A){throw A},f:k}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var T=!0,I=!1,C;return{s:function(){b=b.call(g)},n:function(){var A=b.next();return T=A.done,A},e:function(A){I=!0,C=A},f:function(){try{!T&&b.return!=null&&b.return()}finally{if(I)throw C}}}}function l(g,S){if(g){if(typeof g=="string")return c(g,S);var b=Object.prototype.toString.call(g).slice(8,-1);if(b==="Object"&&g.constructor&&(b=g.constructor.name),b==="Map"||b==="Set")return Array.from(g);if(b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return c(g,S)}}function c(g,S){(S==null||S>g.length)&&(S=g.length);for(var b=0,w=new Array(S);b<S;b++)w[b]=g[b];return w}function u(g,S){if(!(g instanceof S))throw new TypeError("Cannot call a class as a function")}function f(g,S){for(var b=0;b<S.length;b++){var w=S[b];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(g,w.key,w)}}function p(g,S,b){return S&&f(g.prototype,S),b&&f(g,b),Object.defineProperty(g,"prototype",{writable:!1}),g}function m(g,S,b){return S in g?Object.defineProperty(g,S,{value:b,enumerable:!0,configurable:!0,writable:!0}):g[S]=b,g}var v=function(){function g(){u(this,g),m(this,"interpreters",new t.NamespacedMap([[n.LEGACY_M_ROOM_MESSAGE,n.parseMRoomMessage],[i.M_MESSAGE,r.parseMMessage],[i.M_EMOTE,r.parseMMessage],[i.M_NOTICE,r.parseMMessage],[s.M_POLL_START,o.parseMPoll],[s.M_POLL_RESPONSE,o.parseMPoll],[s.M_POLL_END,o.parseMPoll]])),m(this,"_unknownInterpretOrder",[i.M_MESSAGE])}return p(g,[{key:"unknownInterpretOrder",get:function(){var b;return(b=this._unknownInterpretOrder)!==null&&b!==void 0?b:[]},set:function(b){this._unknownInterpretOrder=b}},{key:"registerInterpreter",value:function(b,w){this.interpreters.set(b,w)}},{key:"parse",value:function(b){try{if(this.interpreters.hasNamespaced(b.type))return this.interpreters.getNamespaced(b.type)(b);var w=a(this.unknownInterpretOrder),k;try{for(w.s();!(k=w.n()).done;){var T=k.value;if(this.interpreters.has(T)){var I=this.interpreters.get(T)(b);if(I)return I}}}catch(C){w.e(C)}finally{w.f()}return null}catch(C){if(C instanceof e.InvalidEventError)return null;throw C}}}],[{key:"defaultInstance",get:function(){return g._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return g.defaultInstance.unknownInterpretOrder},set:function(b){g.defaultInstance.unknownInterpretOrder=b}},{key:"registerInterpreter",value:function(b,w){g.defaultInstance.registerInterpreter(b,w)}},{key:"parse",value:function(b){return g.defaultInstance.parse(b)}}]),g}();return a0.ExtensibleEvents=v,m(v,"_defaultInstance",new v),a0}var EI={},HD;function nhe(){return HD||(HD=1,Object.defineProperty(EI,"__esModule",{value:!0})),EI}var Mf={},VD;function rhe(){if(VD)return Mf;VD=1,Object.defineProperty(Mf,"__esModule",{value:!0}),Mf.LegacyMsgType=void 0,Mf.isEventLike=n;var t=Kl(),e;Mf.LegacyMsgType=e,function(r){r.Text="m.text",r.Notice="m.notice",r.Emote="m.emote"}(e||(Mf.LegacyMsgType=e={}));function n(r,i){var s=r.content;return i===e.Text?t.M_MESSAGE.matches(r.type)||r.type==="m.room.message"&&(s==null?void 0:s.msgtype)==="m.text":i===e.Emote?t.M_EMOTE.matches(r.type)||r.type==="m.room.message"&&(s==null?void 0:s.msgtype)==="m.emote":i===e.Notice?t.M_NOTICE.matches(r.type)||r.type==="m.room.message"&&(s==null?void 0:s.msgtype)==="m.notice":!1}return Mf}var GD;function ihe(){return GD||(GD=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=the();Object.keys(e).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===e[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return e[C]}})});var n=nhe();Object.keys(n).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===n[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return n[C]}})});var r=$g();Object.keys(r).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===r[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return r[C]}})});var i=Bg();Object.keys(i).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===i[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return i[C]}})});var s=JK();Object.keys(s).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===s[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return s[C]}})});var o=ZK();Object.keys(o).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===o[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return o[C]}})});var a=rhe();Object.keys(a).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===a[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return a[C]}})});var l=Bh();Object.keys(l).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===l[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return l[C]}})});var c=QK();Object.keys(c).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===c[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return c[C]}})});var u=eW();Object.keys(u).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===u[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return u[C]}})});var f=iW();Object.keys(f).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===f[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return f[C]}})});var p=UL();Object.keys(p).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===p[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return p[C]}})});var m=Qy();Object.keys(m).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===m[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return m[C]}})});var v=Kl();Object.keys(v).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===v[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return v[C]}})});var g=Hh();Object.keys(g).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===g[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return g[C]}})});var S=FL();Object.keys(S).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===S[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return S[C]}})});var b=DL();Object.keys(b).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===b[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return b[C]}})});var w=Hg();Object.keys(w).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===w[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return w[C]}})});var k=tW();Object.keys(k).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===k[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return k[C]}})});var T=nW();Object.keys(T).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===T[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return T[C]}})});var I=rW();Object.keys(I).forEach(function(C){C==="default"||C==="__esModule"||C in t&&t[C]===I[C]||Object.defineProperty(t,C,{enumerable:!0,get:function(){return I[C]}})})}(SI)),SI}var js=ihe();const she="modulepreload",ohe=function(t,e){return new URL(t,e).href},qD={},X1=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const a=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(n.map(u=>{if(u=ohe(u,r),u in qD)return;qD[u]=!0;const f=u.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(!!r)for(let g=a.length-1;g>=0;g--){const S=a[g];if(S.href===u&&(!f||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const v=document.createElement("link");if(v.rel=f?"stylesheet":she,f||(v.as="script"),v.crossOrigin="",v.href=u,c&&v.setAttribute("nonce",c),document.head.appendChild(v),f)return new Promise((g,S)=>{v.addEventListener("load",g),v.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function ahe(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}function lhe(t,e){if(t==null)return{};var n,r,i=ahe(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var Si=function(t){return t.DisplayName="User.displayName",t.AvatarUrl="User.avatarUrl",t.Presence="User.presence",t.CurrentlyActive="User.currentlyActive",t.LastPresenceTs="User.lastPresenceTs",t}({});class Hc extends Un{constructor(e){super(),this.userId=e,L(this,"modified",-1),L(this,"displayName",void 0),L(this,"rawDisplayName",void 0),L(this,"avatarUrl",void 0),L(this,"presenceStatusMsg",void 0),L(this,"presence","offline"),L(this,"lastActiveAgo",0),L(this,"lastPresenceTs",0),L(this,"currentlyActive",!1),L(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,n){var r=new Hc(e);return n.reEmitter.reEmit(r,[Si.AvatarUrl,Si.DisplayName,Si.Presence,Si.CurrentlyActive,Si.LastPresenceTs]),r}setPresenceEvent(e){if(e.getType()==="m.presence"){var n=this.events.presence===null;this.events.presence=e;var r=[];(e.getContent().presence!==this.presence||n)&&r.push(Si.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push(Si.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push(Si.DisplayName),e.getContent().currently_active!==void 0&&e.getContent().currently_active!==this.currentlyActive&&r.push(Si.CurrentlyActive),this.presence=e.getContent().presence,r.push(Si.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(var i of r)this.emit(i,e,this)}}setDisplayName(e){var n=this.displayName;this.displayName=e,e!==n&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){var n=this.avatarUrl;this.avatarUrl=e,e!==n&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var _t=function(t){return t.Backward="b",t.Forward="f",t}({});class Le{static setEventMetadata(e,n,r){e.setMetadata(n,r)}constructor(e){var n,r;this.eventTimelineSet=e,L(this,"roomId",void 0),L(this,"name",void 0),L(this,"events",[]),L(this,"baseIndex",0),L(this,"startState",void 0),L(this,"endState",void 0),L(this,"startToken",null),L(this,"endToken",null),L(this,"prevTimeline",null),L(this,"nextTimeline",null),L(this,"paginationRequests",{[_t.Backward]:null,[_t.Forward]:null}),this.roomId=(n=(r=e.room)===null||r===void 0?void 0:r.roomId)!==null&&n!==void 0?n:null,this.roomId&&(this.startState=new ry(this.roomId),this.endState=new ry(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+new Date().toISOString()}initialiseState(e){var n,r,{timelineWasEmpty:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.events.length>0)throw new Error("Cannot initialise state after events are added");(n=this.startState)===null||n===void 0||n.setStateEvents(e,{timelineWasEmpty:i}),(r=this.endState)===null||r===void 0||r.setStateEvents(e,{timelineWasEmpty:i})}forkLive(e){var n=this.getState(e),r=new Le(this.eventTimelineSet);return r.startState=n==null?void 0:n.clone(),r.endState=n,this.endState=n==null?void 0:n.clone(),r}fork(e){var n=this.getState(e),r=new Le(this.eventTimelineSet);return r.startState=n==null?void 0:n.clone(),r.endState=n==null?void 0:n.clone(),r}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==Le.BACKWARDS)return this.startState;if(e==Le.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===_t.Backward?this.startToken:this.endToken}setPaginationToken(e,n){this.roomId?this.getState(n).paginationToken=e:n===_t.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==Le.BACKWARDS)return this.prevTimeline;if(e==Le.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,n){if(this.getNeighbouringTimeline(n))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+n+")");if(n==Le.BACKWARDS)this.prevTimeline=e;else if(n==Le.FORWARDS)this.nextTimeline=e;else throw new Error("Invalid direction '"+n+"'");this.setPaginationToken(null,n)}addEvent(e,n){var{toStartOfTimeline:r,roomState:i,timelineWasEmpty:s,addToState:o}=n;i||(i=r?this.startState:this.endState);var a=this.getTimelineSet();if(a.room&&(Le.setEventMetadata(e,i,r),o&&e.isState()&&a.room.getUnfilteredTimelineSet()===a)){var l;(l=i)===null||l===void 0||l.setStateEvents([e],{timelineWasEmpty:s}),(!e.sender||e.getType()===ee.RoomMember&&!r)&&Le.setEventMetadata(e,i,r)}var c;r?c=0:c=this.events.length,this.events.splice(c,0,e),r&&this.baseIndex++}insertEvent(e,n,r,i){var s=this.getTimelineSet();s.room&&(Le.setEventMetadata(e,r,!1),i&&e.isState()&&s.room.getUnfilteredTimelineSet()===s&&(r.setStateEvents([e],{}),(!e.sender||e.getType()===ee.RoomMember)&&Le.setEventMetadata(e,r,!1))),this.events.splice(n,0,e)}removeEvent(e){for(var n=this.events.length-1;n>=0;n--){var r=this.events[n];if(r.getId()==e)return this.events.splice(n,1),n<this.baseIndex&&this.baseIndex--,r}return null}toString(){return this.name}}L(Le,"BACKWARDS",_t.Backward);L(Le,"FORWARDS",_t.Forward);var S2=function(t){return t.Add="Relations.add",t.Remove="Relations.remove",t.Redaction="Relations.redaction",t}({}),che=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return[n,...r].includes(e)};class jL extends Un{constructor(e,n,r,i){var s;super(),s=this,this.relationType=e,this.eventType=n,this.altEventTypes=i,L(this,"relationEventIds",new Set),L(this,"relations",new Set),L(this,"annotationsByKey",{}),L(this,"annotationsBySender",{}),L(this,"sortedAnnotationsByKey",[]),L(this,"targetEvent",null),L(this,"creationEmitted",!1),L(this,"client",void 0),L(this,"onEventStatus",(o,a)=>{if(!o.isSending()){o.removeListener(Ht.Status,this.onEventStatus);return}a===at.CANCELLED&&(o.removeListener(Ht.Status,this.onEventStatus),this.removeEvent(o))}),L(this,"onBeforeRedaction",function(){var o=U(function*(a){if(s.relations.has(a)){if(s.relations.delete(a),s.relationType===Tn.Annotation)s.removeAnnotationFromAggregation(a);else if(s.relationType===Tn.Replace&&s.targetEvent&&!s.targetEvent.isState()){var l=yield s.getLastReplacement();s.targetEvent.makeReplaced(l)}a.removeListener(Ht.BeforeRedaction,s.onBeforeRedaction),s.emit(S2.Redaction,a)}});return function(a){return o.apply(this,arguments)}}()),this.client=r instanceof IC?r.client:r}addEvent(e){var n=this;return U(function*(){if(!n.relationEventIds.has(e.getId())){var r=e.getRelation();if(!r){O.error("Event must have relation info");return}var i=r.rel_type,s=e.getType();if(n.relationType!==i||!che(s,n.eventType,n.altEventTypes)){O.error("Event relation info doesn't match this container");return}if(e.isSending()&&e.on(Ht.Status,n.onEventStatus),n.relations.add(e),n.relationEventIds.add(e.getId()),n.relationType===Tn.Annotation)n.addAnnotationToAggregation(e);else if(n.relationType===Tn.Replace&&n.targetEvent&&!n.targetEvent.isState()){var o=yield n.getLastReplacement();n.targetEvent.makeReplaced(o)}e.on(Ht.BeforeRedaction,n.onBeforeRedaction),n.emit(S2.Add,e),n.maybeEmitCreated()}})()}removeEvent(e){var n=this;return U(function*(){if(n.relations.has(e)){if(n.relations.delete(e),n.relationType===Tn.Annotation)n.removeAnnotationFromAggregation(e);else if(n.relationType===Tn.Replace&&n.targetEvent&&!n.targetEvent.isState()){var r=yield n.getLastReplacement();n.targetEvent.makeReplaced(r)}n.emit(S2.Remove,e)}})()}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var n,{key:r}=(n=e.getRelation())!==null&&n!==void 0?n:{};if(r){var i=this.annotationsByKey[r];i||(i=this.annotationsByKey[r]=new Set,this.sortedAnnotationsByKey.push([r,i])),i.add(e),this.sortedAnnotationsByKey.sort((a,l)=>{var c=a[1],u=l[1];return u.size-c.size});var s=e.getSender(),o=this.annotationsBySender[s];o||(o=this.annotationsBySender[s]=new Set),o.add(e)}}removeAnnotationFromAggregation(e){var n,{key:r}=(n=e.getRelation())!==null&&n!==void 0?n:{};if(r){var i=this.annotationsByKey[r];i&&(i.delete(e),this.sortedAnnotationsByKey.sort((a,l)=>{var c=a[1],u=l[1];return u.size-c.size}));var s=e.getSender(),o=this.annotationsBySender[s];o&&o.delete(e)}}getSortedAnnotationsByKey(){return this.relationType!==Tn.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==Tn.Annotation?null:this.annotationsBySender}getLastReplacement(){var e=this;return U(function*(){if(e.relationType!==Tn.Replace||!e.targetEvent)return null;var n=e.targetEvent.getServerAggregatedRelation(Tn.Replace),r=n==null?void 0:n.origin_server_ts,i=e.getRelations().reduce((s,o)=>o.getSender()!==e.targetEvent.getSender()||r&&r>o.getTs()||s&&s.getTs()>o.getTs()?s:o,null);return i!=null&&i.shouldAttemptDecryption()&&e.client.getCrypto()?yield i.attemptDecryption(e.client.getCrypto()):i!=null&&i.isBeingDecrypted()&&(yield i.getDecryptionPromise()),i})()}setTargetEvent(e){var n=this;return U(function*(){if(!n.targetEvent){if(n.targetEvent=e,n.relationType===Tn.Replace&&!n.targetEvent.isState()){var r=yield n.getLastReplacement();r&&n.targetEvent.makeReplaced(r)}n.maybeEmitCreated()}})()}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(Ht.RelationsCreated,this.relationType,this.eventType))}}class sW{constructor(e,n){this.client=e,this.room=n,L(this,"relations",new Map)}getChildEventsForEvent(e,n,r){var i;return(i=this.relations.get(e))===null||i===void 0||(i=i.get(n))===null||i===void 0?void 0:i.get(r)}getAllChildEventsForEvent(e){var n,r=(n=this.relations.get(e))!==null&&n!==void 0?n:new Map,i=[];for(var s of r.values())for(var o of s.values())i.push(...o.getRelations());return i}aggregateParentEvent(e){var n=this.relations.get(e.getId());if(n)for(var r of n.values())for(var i of r.values())i.setTargetEvent(e)}aggregateChildEvent(e,n){if(!(e.isRedacted()||e.status===at.CANCELLED)){var r=e.getRelation();if(r){var i=()=>{if(e.isDecryptionFailure()){e.once(Ht.Decrypted,i);return}this.aggregateChildEvent(e,n)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption()){e.once(Ht.Decrypted,i);return}var{event_id:s,rel_type:o}=r,a=e.getType(),l=this.relations.get(s);l||(l=new Map,this.relations.set(s,l));var c=l.get(o);c||(c=new Map,l.set(o,c));var u=c.get(a);if(!u){var f,p,m;u=new jL(o,a,this.client),c.set(a,u);var v=(f=this.room)!==null&&f!==void 0?f:n==null?void 0:n.room,g=(p=(m=n==null?void 0:n.findEventById(s))!==null&&m!==void 0?m:v==null?void 0:v.findEventById(s))!==null&&p!==void 0?p:v==null?void 0:v.getPendingEvent(s);g&&u.setTargetEvent(g)}u.addEvent(e)}}}}var im;im=O.log.bind(O);var f1=function(t){return t.Ignore="ignore",t.Replace="replace",t}({});class fm extends Un{constructor(e){var n,r,i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;super(),this.room=e,this.thread=a,this.threadListType=l,L(this,"relations",void 0),L(this,"timelineSupport",void 0),L(this,"displayPendingEvents",void 0),L(this,"liveTimeline",void 0),L(this,"timelines",void 0),L(this,"_eventIdToTimeline",new Map),L(this,"filter",void 0),this.timelineSupport=!!s.timelineSupport,this.liveTimeline=new Le(this),this.displayPendingEvents=s.pendingEvents!==!1,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=s.filter,this.relations=(n=(r=this.room)===null||r===void 0?void 0:r.relations)!==null&&n!==void 0?n:new sW((i=e==null?void 0:e.client)!==null&&i!==void 0?i:o)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return!this.room||!this.displayPendingEvents?[]:this.room.getPendingEvents()}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,n){var r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(n,r))}resetLiveTimeline(e,n){var r=!this.timelineSupport||!n,i=this.liveTimeline,s=r?i.forkLive(Le.FORWARDS):i.fork(Le.FORWARDS);r?(this.timelines=[s],this._eventIdToTimeline=new Map):this.timelines.push(s),n&&i.setPaginationToken(n,Le.FORWARDS),s.setPaginationToken(e??null,Le.BACKWARDS),this.liveTimeline=s,this.emit(xe.TimelineReset,this.room,this,r)}getTimelineForEvent(e){if(e==null)return null;var n=this._eventIdToTimeline.get(e);return n===void 0?null:n}findEventById(e){var n=this.getTimelineForEvent(e);if(n)return n.getEvents().find(function(r){return r.getId()==e})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new Le(this);return this.timelines.push(e),e}addEventsToTimeline(e,n,r,i,s){if(!i)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!n&&i==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!(this.filter&&(e=this.filter.filterRoomTimeline(e),!e.length))){var o=n?Le.BACKWARDS:Le.FORWARDS,a=n?Le.FORWARDS:Le.BACKWARDS,l=!1,c=!1;for(var u of e){var f=u.getId(),p=this._eventIdToTimeline.get(f);if(!p){this.addEventToTimeline(u,i,{toStartOfTimeline:n,addToState:r}),c=!0,l=!0;continue}if(c=!1,p==i){im("Event "+f+" already in timeline "+i);continue}var m=i.getNeighbouringTimeline(o);if(m){p==m?im("Event "+f+" in neighbouring timeline - switching to "+p):im("Event "+f+" already in a different timeline "+p),i=p;continue}O.info("Already have timeline for "+f+" - joining timeline "+i+" to "+p);var v=p===this.liveTimeline,g=i===this.liveTimeline,S=o===Le.BACKWARDS&&v,b=o===Le.FORWARDS&&g;if(S||b){S&&O.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+p+")"),b&&O.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+i+")");continue}i.setNeighbouringTimeline(p,o),p.setNeighbouringTimeline(i,a),i=p,l=!0}if(c||!l){if(o===Le.FORWARDS&&i===this.liveTimeline){O.warn({lastEventWasNew:c,didUpdate:l}),O.warn("Refusing to set forwards pagination token of live timeline "+"".concat(i," to ").concat(s));return}i.setPaginationToken(s??null,o)}}}addLiveEvent(e,n){var{duplicateStrategy:r,fromCache:i,roomState:s,timelineWasEmpty:o,addToState:a}=n;if(this.filter){var l=this.filter.filterRoomTimeline([e]);if(!l.length)return}var c=this._eventIdToTimeline.get(e.getId());if(c){if(r===f1.Replace){im("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var u=c.getEvents(),f=0;f<u.length;f++)if(u[f].getId()===e.getId()){s||(s=c.getState(Le.FORWARDS)),Le.setEventMetadata(e,s,!1),u[f]=e;break}}else im("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());return}this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:i,roomState:s,timelineWasEmpty:o,addToState:a})}addEventToTimeline(e,n,r){var{toStartOfTimeline:i,fromCache:s=!1,roomState:o,timelineWasEmpty:a,addToState:l}=r;if(n.getTimelineSet()!==this){var c;throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(n.toString(),` does not belong " +
                "in timelineSet(threadId=`).concat((c=this.thread)===null||c===void 0?void 0:c.id,")"))}var u=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var f,p="event=".concat(u);e.threadRootId&&(p+="(belongs to thread=".concat(e.threadRootId,")")),O.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(p," that does not belong ")+"in timeline=".concat(n.toString()," timelineSet(threadId=").concat((f=this.thread)===null||f===void 0?void 0:f.id,")"));return}n.addEvent(e,{toStartOfTimeline:i,roomState:o,timelineWasEmpty:a,addToState:l}),this._eventIdToTimeline.set(u,n);var m={timeline:n,liveEvent:!i&&n==this.liveTimeline&&!s};this.emit(xe.Timeline,e,this.room,!!i,!1,m)}insertEventIntoTimeline(e,n,r,i){if(n.getTimelineSet()!==this){var s;throw new Error("EventTimelineSet.insertEventIntoTimeline: Timeline=".concat(n.toString(),` does not belong " +
                "in timelineSet(threadId=`).concat((s=this.thread)===null||s===void 0?void 0:s.id,")"))}var o=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var a,l="event=".concat(o);e.threadRootId&&(l+="(belongs to thread=".concat(e.threadRootId,")")),O.warn("EventTimelineSet.insertEventIntoTimeline: Ignoring ".concat(l," that does not belong ")+"in timeline=".concat(n.toString()," timelineSet(threadId=").concat((a=this.thread)===null||a===void 0?void 0:a.id,")"));return}var c=e.relationEventId;if(!c){this.addEventToTimeline(e,n,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:r,addToState:i});return}for(var u=this.findEventById(c),f=n.getEvents(),p=u!==void 0?f.indexOf(u):0,m=p;m<f.length;m++){var v=f[m];if(v.getTs()>e.getTs())break}n.insertEvent(e,m,r,i),this._eventIdToTimeline.set(o,n);var g={timeline:n,liveEvent:!1};this.emit(xe.Timeline,e,this.room,!1,!1,g)}handleRemoteEcho(e,n,r){var i=this._eventIdToTimeline.get(n);i?(this._eventIdToTimeline.delete(n),this._eventIdToTimeline.set(r,i)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){var n=this._eventIdToTimeline.get(e);if(!n)return null;var r=n.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);var i={timeline:n};this.emit(xe.Timeline,r,this.room,void 0,!0,i)}return r}compareEventOrdering(e,n){if(e==n)return 0;var r=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(n);if(r===void 0||i===void 0)return null;if(r===i){for(var s=void 0,o=void 0,a=r.getEvents(),l=0;l<a.length&&(s===void 0||o===void 0);l++){var c=a[l].getId();c==e&&(s=l),c==n&&(o=l)}var u=s-o;return u<0?-1:u>0?1:0}for(var f=r;f;){if(f===i)return-1;f=f.getNeighbouringTimeline(Le.FORWARDS)}for(f=r;f;){if(f===i)return 1;f=f.getNeighbouringTimeline(Le.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);if(this.thread)return this.thread.id===n;if(!r&&!i){var s;O.warn("EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=".concat((s=this.room)===null||s===void 0?void 0:s.roomId," eventId=").concat(e.getId()," threadId=").concat(e.threadRootId))}return r}}var at=function(t){return t.NOT_SENT="not_sent",t.ENCRYPTING="encrypting",t.SENDING="sending",t.QUEUED="queued",t.SENT="sent",t.CANCELLED="cancelled",t}({});class oW{constructor(e,n){this.roomId=e}}class aW{constructor(e){this.target=e,L(this,"reEmitters",new WeakMap)}reEmit(e,n){var r=this,i=this.reEmitters.get(e);i||(i=new Map,this.reEmitters.set(e,i));var s=function(l){if(i.has(l))return 1;var c=function(){if(!(l==="error"&&r.target.listenerCount("error")===0)){for(var f=arguments.length,p=new Array(f),m=0;m<f;m++)p[m]=arguments[m];r.target.emit(l,...p,e)}};e.on(l,c),i.set(l,c)};for(var o of n)s(o)}stopReEmitting(e,n){var r=this.reEmitters.get(e);if(r){for(var i of n)e.off(i,r.get(i)),r.delete(i);r.size===0&&this.reEmitters.delete(e)}}}class Vg extends aW{constructor(e){super(e)}reEmit(e,n){super.reEmit(e,n)}stopReEmitting(e,n){super.stopReEmitting(e,n)}}var J1=new SC("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function uhe(t,e){if(e.endsWith("*")){var n=e.slice(0,-1);return t.slice(0,n.length)===n}else return t===e}class KD{constructor(e,n){this.filterJson=e,this.userId=n}check(e){var n,r,i=((n=e.getUnsigned())===null||n===void 0?void 0:n["m.relations"])||{},s=Object.keys(i),o=[];return this.userId&&i!==null&&i!==void 0&&(r=i[cn.name])!==null&&r!==void 0&&r.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),e.getContent()?e.getContent().url!==void 0:!1,s,o)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[Pm.name]:this.filterJson[Pm.name]||[],[Lm.name]:this.filterJson[Lm.name]||[]}}checkFields(e,n,r,i,s,o){var a={rooms:function(b){return e===b},senders:function(b){return n===b},types:function(b){return uhe(r,b)}};for(var l in a){var c=a[l],u="not_"+l,f=this.filterJson[u];if(f!=null&&f.some(c))return!1;var p=this.filterJson[l];if(p&&!p.some(c))return!1}var m=this.filterJson.contains_url;if(m!==void 0&&m!==i)return!1;var v=this.filterJson[Lm.name];if(v!==void 0&&!this.arrayMatchesFilter(v,s))return!1;var g=this.filterJson[Pm.name];return!(g!==void 0&&!this.arrayMatchesFilter(g,o))}arrayMatchesFilter(e,n){return n.length>0&&e.every(r=>n.includes(r))}filter(e){return e.filter(this.check,this)}limit(){return this.filterJson.limit!==void 0?this.filterJson.limit:10}}function WD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Lp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?WD(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):WD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function wI(t,e,n){for(var r=e.split("."),i=t,s=0;s<r.length-1;s++)i[r[s]]||(i[r[s]]={}),i=i[r[s]];i[r[r.length-1]]=n}class Es{static fromJson(e,n,r){var i=new Es(e,n);return i.setDefinition(r),i}constructor(e,n){this.userId=e,this.filterId=n,L(this,"definition",{}),L(this,"roomFilter",void 0),L(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;var n=e.room,r={};n&&(n.rooms&&(r.rooms=n.rooms),n.rooms&&(r.not_rooms=n.not_rooms)),this.roomFilter=new KD(r,this.userId),this.roomTimelineFilter=new KD((n==null?void 0:n.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){wI(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var n,r;this.definition=Lp(Lp({},this.definition),{},{room:Lp(Lp({},(n=this.definition)===null||n===void 0?void 0:n.room),{},{timeline:Lp(Lp({},(r=this.definition)===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.timeline),{},{[J1.name]:e})})})}setLazyLoadMembers(e){wI(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){wI(this.definition,"room.include_leave",e)}}L(Es,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0});function jE(t){return t!=null}var dhe=new js.UnstableValue("m.message","org.matrix.msc1767.message"),$L=new js.UnstableValue("m.text","org.matrix.msc1767.text"),fhe=new js.UnstableValue("m.html","org.matrix.msc1767.html"),lW=new js.NamespacedValue("m.reference");function hhe(t,e){if(typeof t=="string")return typeof e=="string"?e===t:e.matches(t);if(typeof e=="string")return t.matches(e);var n=e,r=t;return n.matches(r.name)||jE(r.altName)&&n.matches(r.altName)}var BL=new zy("m.topic");function zD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function phe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zD(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function cW(t,e){return{msgtype:ql.Text,format:"org.matrix.custom.html",body:t,formatted_body:e}}function uW(t,e){return{msgtype:ql.Notice,format:"org.matrix.custom.html",body:t,formatted_body:e}}function dW(t,e){return{msgtype:ql.Emote,format:"org.matrix.custom.html",body:t,formatted_body:e}}function fW(t){return{msgtype:ql.Text,body:t}}function hW(t){return{msgtype:ql.Notice,body:t}}function pW(t){return{msgtype:ql.Emote,body:t}}var mW=(t,e,n,r)=>{var i="at ".concat(new Date(n).toISOString()),s=e===ig.Self?"User":void 0,o=r?'"'.concat(r,'"'):void 0;return[s,"Location",o,t,i].filter(Boolean).join(" ")},gW=(t,e,n,r,i)=>{var s=t??mW(e,i||ig.Self,n,r),o=n?{[tf.name]:n}:{};return phe({msgtype:ql.Location,body:s,geo_uri:e,[Xy.name]:{description:r,uri:e},[Yy.name]:{type:i||ig.Self},[$L.name]:s},o)},mhe=t=>{var e,n,r=Xy.findIn(t),i=Yy.findIn(t),s=tf.findIn(t),o=$L.findIn(t),a=(e=r==null?void 0:r.uri)!==null&&e!==void 0?e:t==null?void 0:t.geo_uri,l=r==null?void 0:r.description,c=(n=i==null?void 0:i.type)!==null&&n!==void 0?n:ig.Self,u=o??t.body;return gW(u,a,s??void 0,l,c)},vW=(t,e)=>{var n=[];return jE(e)&&n.push({body:e,mimetype:"text/html"}),jE(t)&&n.push({body:t,mimetype:"text/plain"}),{topic:t,[BL.name]:n}},ghe=t=>{var e,n,r,i,s=BL.findIn(t);if(!Array.isArray(s)){var o;return{text:(o=t.topic)!==null&&o!==void 0?o:void 0}}var a=(e=(n=s==null||(r=s.find(c=>!jE(c.mimetype)||c.mimetype==="text/plain"))===null||r===void 0?void 0:r.body)!==null&&n!==void 0?n:t.topic)!==null&&e!==void 0?e:void 0,l=s==null||(i=s.find(c=>c.mimetype==="text/html"))===null||i===void 0?void 0:i.body;return{text:a,html:l}},vhe=(t,e,n,r,i)=>({description:n,timeout:t,live:e,[tf.name]:i||Date.now(),[Yy.name]:{type:r??ig.Self}}),yW=t=>{var e,{description:n,timeout:r,live:i}=t,s=(e=tf.findIn(t))!==null&&e!==void 0?e:void 0,o=Yy.findIn(t);return{description:n,timeout:r,live:i,assetType:o==null?void 0:o.type,timestamp:s}},yhe=(t,e,n,r)=>({[Xy.name]:{description:r,uri:t},[tf.name]:e,"m.relates_to":{rel_type:lW.name,event_id:n}}),W6=t=>{var e,n=Xy.findIn(t),r=(e=tf.findIn(t))!==null&&e!==void 0?e:void 0;return{description:n==null?void 0:n.description,uri:n==null?void 0:n.uri,timestamp:r}};const _he=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:mW,makeBeaconContent:yhe,makeBeaconInfoContent:vhe,makeEmoteMessage:pW,makeHtmlEmote:dW,makeHtmlMessage:cW,makeHtmlNotice:uW,makeLocationContent:gW,makeNotice:hW,makeTextMessage:fW,makeTopicContent:vW,parseBeaconContent:W6,parseBeaconInfoContent:yW,parseLocationEvent:mhe,parseTopicContent:ghe},Symbol.toStringTag,{value:"Module"}));var Mn=function(t){return t.New="Beacon.new",t.Update="Beacon.update",t.LivenessChange="Beacon.LivenessChange",t.Destroy="Beacon.Destroy",t.LocationUpdate="Beacon.LocationUpdate",t}({}),z6=(t,e,n)=>n>=t&&t+e>=n,$E=t=>"".concat(t.getRoomId(),"_").concat(t.getStateKey());class _W extends Un{constructor(e){super(),this.rootEvent=e,L(this,"roomId",void 0),L(this,"_beaconInfo",void 0),L(this,"_isLive",void 0),L(this,"livenessWatchTimeout",void 0),L(this,"_latestLocationEvent",void 0),L(this,"clearLatestLocation",()=>{this._latestLocationEvent=void 0,this.emit(Mn.LocationUpdate,this.latestLocationState)}),this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return $E(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&W6(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if($E(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(Mn.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(Mn.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),!!this.beaconInfo)if(this.isLive){var e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(e){var n;if(this.isLive){var r=e.filter(s=>{var o=s.getContent(),a=W6(o);if(!a.uri||!a.timestamp)return!1;var{timestamp:l}=a;return this._beaconInfo.timestamp&&z6(this._beaconInfo.timestamp,this._beaconInfo.timeout,l)&&(!this.latestLocationState||l>this.latestLocationState.timestamp)}),i=(n=r.sort(jfe))===null||n===void 0?void 0:n[0];i&&(this._latestLocationEvent=i,this.emit(Mn.LocationUpdate,this.latestLocationState))}}setBeaconInfo(e){this._beaconInfo=yW(e.getContent()),this.checkLiveness()}checkLiveness(){var e=this.isLive;if(this.beaconInfo){var n=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!n&&z6(n,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit(Mn.LivenessChange,this.isLive,this)}}}function YD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function bhe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YD(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function bW(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return new Bi({content:{[e.getId()]:{[n]:{[t]:bhe({ts:e.getTs()},!r&&{thread_id:ug(e)})}}},type:ee.Receipt,room_id:e.getRoomId()})}var Ap=0,Op=1;class SW extends Un{constructor(){super(...arguments),L(this,"receipts",new Bc(()=>new Map)),L(this,"receiptCacheByEventId",new Map)}getReadReceiptForUserId(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ji.Read,[o,a]=(n=(r=this.receipts.get(s))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:[null,null];return i?o:a??o}compareReceipts(e,n){var r;return(r=this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,n.eventId))!==null&&r!==void 0?r:e.data.ts-n.data.ts}getEventReadUpTo(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.getLatestReceipt(e,n);return r&&this.receiptPointsAtConsistentEvent(r)?r.eventId:null}receiptPointsAtConsistentEvent(e){var n,r=this.findEventById(e.eventId);if(!r)return!1;if(!((n=e.data)!==null&&n!==void 0&&n.thread_id))return!0;if(e.data.thread_id===Jy){var i=ny(r);if(i)return!0}else if(r.threadRootId===e.data.thread_id)return!0;return O.warn("Ignoring receipt because its thread_id (".concat(e.data.thread_id,") disagrees ")+"with the thread root (".concat(r.threadRootId,") of the referenced event ")+"(event ID = ".concat(e.eventId,")")),!1}getLatestReceipt(e,n){var r,i,s=this.getReadReceiptForUserId(e,n,Ji.Read),o=this.getReadReceiptForUserId(e,n,Ji.ReadPrivate),a;return s!=null&&s.eventId&&o!==null&&o!==void 0&&o.eventId&&(a=this.compareReceipts(s,o)),a?(i=a<0?o:s)!==null&&i!==void 0?i:null:(r=o??s)!==null&&r!==void 0?r:null}addReceiptToStructure(e,n,r,i,s){var o,a,l=this.receipts.getOrCreate(n),c=l.get(r);c||(c=[null,null],l.set(r,c));var u=c[Ap];if(s){var f;u=(f=c[Op])!==null&&f!==void 0?f:c[Ap]}var p={eventId:e,data:i};if(u){var m=this.compareReceipts(u,p);if(m>=0)return}var v=s?c[Ap]:p,g=s?p:c[Op],S=null;v&&g&&(S=this.getUnfilteredTimelineSet().compareEventOrdering(v.eventId,g.eventId));var b=S===null||S<0,w=(o=c[Op])!==null&&o!==void 0?o:c[Ap];s&&b?c[Op]=p:s||(c[Ap]=p,b||(c[Op]=null));var k=(a=c[Op])!==null&&a!==void 0?a:c[Ap];if(w!==k){if(w&&this.receiptCacheByEventId.get(w.eventId)){var T=w.eventId;this.receiptCacheByEventId.set(T,this.receiptCacheByEventId.get(T).filter(I=>I.type!==n||I.userId!==r)),this.receiptCacheByEventId.get(T).length<1&&this.receiptCacheByEventId.delete(T)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:r,type:n,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){var n=this.getReadReceiptForUserId(e,!1),r=this.timeline[this.timeline.length-1];r&&(n==null?void 0:n.eventId)===r.getId()&&e===r.getSender()&&(this.setUnread(Kt.Total,0),this.setUnread(Kt.Highlight,0))}addLocalEchoReceipt(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this.addReceipt(bW(e,n,r,i),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter(function(n){return ML(n.type)}).map(function(n){return n.userId})}}var She=new js.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),Ehe=new js.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),whe=new js.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),Z1=new js.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),BE=new js.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end"),rd=function(t){return t.New="Poll.new",t.End="Poll.end",t.Update="Poll.update",t.Responses="Poll.Responses",t.Destroy="Poll.Destroy",t.UndecryptableRelations="Poll.UndecryptableRelations",t}({}),XD=(t,e)=>{var n=t.filter(r=>{if(!r.isDecryptionFailure())return Z1.matches(r.getType())&&r.getTs()<=e});return{responseEvents:n}};class EW extends Un{constructor(e,n,r){if(super(),this.rootEvent=e,this.matrixClient=n,this.room=r,L(this,"roomId",void 0),L(this,"pollEvent",void 0),L(this,"_isFetchingResponses",!1),L(this,"relationsNextBatch",void 0),L(this,"responses",null),L(this,"endEvent",void 0),L(this,"undecryptableRelationEventIds",new Set),L(this,"countUndecryptableEvents",i=>{var s=i.filter(a=>a.isDecryptionFailure()).map(a=>a.getId()),o=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...s]),this.undecryptableRelationsCount!==o&&this.emit(rd.UndecryptableRelations,this.undecryptableRelationsCount)}),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return(e=this.endEvent)===null||e===void 0?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}getResponses(){var e=this;return U(function*(){return e.responses||e.isFetchingResponses||(yield e.fetchResponses()),e.responses})()}onNewRelation(e){var n;if(BE.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(rd.End)),!!this.responses){var r=((n=this.endEvent)===null||n===void 0?void 0:n.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:i}=XD([e],r);this.countUndecryptableEvents([e]),i.length&&(i.forEach(s=>{this.responses.addEvent(s)}),this.emit(rd.Responses,this.responses))}}fetchResponses(){var e=this;return U(function*(){var n,r;e._isFetchingResponses=!0;var i=yield e.matrixClient.relations(e.roomId,e.rootEvent.getId(),"m.reference",void 0,{from:e.relationsNextBatch||void 0});yield Promise.all(i.events.map(c=>e.matrixClient.decryptEventIfNeeded(c)));var s=e.responses||new jL("m.reference",Z1.name,e.matrixClient,[Z1.altName]),o=i.events.find(c=>BE.matches(c.getType()));e.validateEndEvent(o)&&(e.endEvent=o,e.refilterResponsesOnEnd(),e.emit(rd.End));var a=((n=e.endEvent)===null||n===void 0?void 0:n.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:l}=XD(i.events,a);l.forEach(c=>{s.addEvent(c)}),e.relationsNextBatch=(r=i.nextBatch)!==null&&r!==void 0?r:void 0,e.responses=s,e.countUndecryptableEvents(i.events),e.relationsNextBatch?e.fetchResponses():e._isFetchingResponses=!1,e.emit(rd.Responses,e.responses)})()}refilterResponsesOnEnd(){var e;if(this.responses){var n=((e=this.endEvent)===null||e===void 0?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach(r=>{if(r.getTs()>n){var i;(i=this.responses)===null||i===void 0||i.removeEvent(r)}}),this.emit(rd.Responses,this.responses)}}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;var n=this.room.currentState,r=e.getSender();return!!r&&(r===this.rootEvent.getSender()||n.maySendRedactionForEvent(this.rootEvent,r))}}var wW=t=>{var e=t.getType();return js.M_POLL_START.matches(e)||Z1.matches(e)||BE.matches(e)};class Che{constructor(e){L(this,"room",void 0),L(this,"threadedReceipts",void 0),L(this,"unthreadedReceipts",void 0),L(this,"danglingReceipts",void 0),L(this,"onTimelineEvent",n=>{var r=n.getId();if(r){var i=this.danglingReceipts.remove(r);i==null||i.forEach(s=>{s.receipt.thread_id?this.threadedReceipts.set(s.receipt.thread_id,s.eventId,s.receiptType,s.userId,s.receipt.ts,s.synthetic):this.unthreadedReceipts.set(r,s.receiptType,s.userId,s.receipt.ts,s.synthetic)})}}),this.room=e,this.threadedReceipts=new khe(e),this.unthreadedReceipts=new CW(e),this.danglingReceipts=new xhe,e.on(xe.Timeline,this.onTimelineEvent)}add(e,n){for(var[r,i]of Object.entries(e))for(var[s,o]of Object.entries(i))for(var[a,l]of Object.entries(o)){var c=this.room.findEventById(r);c?l.thread_id?this.threadedReceipts.set(l.thread_id,r,s,a,l.ts,n):this.unthreadedReceipts.set(r,s,a,l.ts,n):this.danglingReceipts.add(new Rhe(r,s,a,l,n))}}hasUserReadEvent(e,n){var r=this.unthreadedReceipts.get(e);if(r&&Y6(r.eventId,n,this.room))return!0;var i=this.room.findEventById(n);if(!i)return O.warn("hasUserReadEvent event ID ".concat(n," not found in room ").concat(this.room.roomId,": this shouldn't happen!")),!1;var s=ug(i),o=this.threadedReceipts.get(s,e);return!!(o&&Y6(o.eventId,n,this.room)||this.userSentLatestEventInThread(s,e))}userSentLatestEventInThread(e,n){var r,i=e===Jy?this.room.getLiveTimeline().getEvents():(r=this.room.getThread(e))===null||r===void 0?void 0:r.timeline;return!!(i&&i.length>0&&i[i.length-1].getSender()===n)}}class The{constructor(e,n,r){this.eventId=e,this.receiptType=n,this.ts=r}}class Rhe{constructor(e,n,r,i,s){this.eventId=e,this.receiptType=n,this.userId=r,this.receipt=i,this.synthetic=s}}class Ihe{constructor(e){L(this,"room",void 0),L(this,"real",void 0),L(this,"synthetic",void 0),this.room=e,this.real=void 0,this.synthetic=void 0}set(e,n){e?this.synthetic=n:this.real=n,this.synthetic&&this.real&&Y6(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){var e;return(e=this.synthetic)!==null&&e!==void 0?e:this.real}getByType(e){return e?this.synthetic:this.real}}class CW{constructor(e){L(this,"room",void 0),L(this,"data",void 0),this.room=e,this.data=new Map}set(e,n,r,i,s){var o=HL(this.data,r,()=>new Ihe(this.room)),a=o.getByType(s);a&&Phe(a.eventId,e,this.room)||o.set(s,new The(e,n,i))}get(e){var n;return(n=this.data.get(e))===null||n===void 0?void 0:n.get()}}class khe{constructor(e){L(this,"room",void 0),L(this,"data",void 0),this.room=e,this.data=new Map}set(e,n,r,i,s,o){var a=HL(this.data,e,()=>new CW(this.room));a.set(n,r,i,s,o)}get(e,n){var r;return(r=this.data.get(e))===null||r===void 0?void 0:r.get(n)}}class xhe{constructor(){L(this,"data",new Map)}add(e){var n=HL(this.data,e.eventId,()=>[]);n.push(e)}remove(e){var n=this.data.get(e);return this.data.delete(e),n}}function HL(t,e,n){var r=t.get(e);if(r)return r;var i=n();return t.set(e,i),i}function Y6(t,e,n){var r=n.compareEventOrdering(t,e);return r!==null&&r>=0}function Phe(t,e,n){var r=n.compareEventOrdering(t,e);return r!==null&&r>0}function Lhe(t,e,n){var r=t.findEventById(e),i=t.findEventById(n);if(!r||!i)return null;var s=ny(r),o=ny(i);return s&&o?Ahe(t,e,n,r,i):Ohe(e,n,r,i)}function Ahe(t,e,n,r,i){var s=t.getUnfilteredTimelineSet(),o=s.compareEventOrdering(e,n);if(o!==null)return o;var a=s.getTimelineForEvent(e);if(a===s.getLiveTimeline())return 1;var l=s.getTimelineForEvent(n);return l===s.getLiveTimeline()?-1:TW(r,i)}function Ohe(t,e,n,r){var i=ug(n),s=ug(r),o=n.getThread();return o&&i===s?o.timelineSet.compareEventOrdering(t,e):TW(n,r)}function TW(t,e){var n=t.getTs(),r=e.getTs();return n<r?-1:n>r?1:0}var le=function(t){return t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE",t.Options="OPTIONS",t.Head="HEAD",t.Patch="PATCH",t}({});function JD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Mhe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JD(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class Fd extends Error{constructor(e,n,r){super(e),this.httpStatus=n,this.httpHeaders=r}isRateLimitError(){return this.httpStatus===429}getRetryAfterMs(){var e,n=(e=this.httpHeaders)===null||e===void 0?void 0:e.get("Retry-After");if(n!=null){if(/^\d+$/.test(n)){var r=Number.parseInt(n)*1e3;if(!Number.isFinite(r))throw new Error("Retry-After header integer value is too large");return r}var i=new Date(n);if(i.toUTCString()!==n)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return i.getTime()-Date.now()}return null}}class Nn extends Fd{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o=e.error||"Unknown message";n&&(o="[".concat(n,"] ").concat(o)),r&&(o="".concat(o," (").concat(r,")")),super("MatrixError: ".concat(o),n,s),this.url=r,this.event=i,L(this,"errcode",void 0),L(this,"data",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return this.errcode==="M_LIMIT_EXCEEDED"||(this.errcode==="M_UNKNOWN"||this.errcode===void 0)&&super.isRateLimitError()}getRetryAfterMs(){var e=super.getRetryAfterMs();if(e!==null)return e;if(this.errcode==="M_LIMIT_EXCEEDED"&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){var e,n,r,i,s={};if(this.httpHeaders)for(var[o,a]of this.httpHeaders)s[o]=a;return{http_status:(e=this.httpStatus)!==null&&e!==void 0?e:400,http_headers:s,url:(n=this.url)!==null&&n!==void 0?n:"",response:Mhe({errcode:(r=this.errcode)!==null&&r!==void 0?r:"M_UNKNOWN",error:(i=this.data.error)!==null&&i!==void 0?i:"Unknown message"},this.data)}}static fromWidgetApiErrorData(e){return new Nn(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function VL(t,e){if(!(t instanceof Fd)||!t.isRateLimitError())return e;try{var n;return(n=t.getRetryAfterMs())!==null&&n!==void 0?n:e}catch{return e}}let Vh=class extends Error{constructor(e,n){super(e+(n?": ".concat(n.message):""))}get name(){return"ConnectionError"}};class RW extends Error{constructor(e){var n;super((n=e==null?void 0:e.message)!==null&&n!==void 0?n:"")}get name(){return"TokenRefreshError"}}class GL extends Error{constructor(e){var n;super((n=e==null?void 0:e.message)!==null&&n!==void 0?n:"")}get name(){return"TokenRefreshLogoutError"}}var X6=function(t){return t.SessionLoggedOut="Session.logged_out",t.NoConsent="no_consent",t}({}),tS={};/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var ZD;function Nhe(){if(ZD)return tS;ZD=1;var t=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,e=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,i=/([\\"])/g,s=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;tS.format=o,tS.parse=a;function o(f){if(!f||typeof f!="object")throw new TypeError("argument obj is required");var p=f.parameters,m=f.type;if(!m||!s.test(m))throw new TypeError("invalid type");var v=m;if(p&&typeof p=="object")for(var g,S=Object.keys(p).sort(),b=0;b<S.length;b++){if(g=S[b],!n.test(g))throw new TypeError("invalid parameter name");v+="; "+g+"="+c(p[g])}return v}function a(f){if(!f)throw new TypeError("argument string is required");var p=typeof f=="object"?l(f):f;if(typeof p!="string")throw new TypeError("argument string is required to be a string");var m=p.indexOf(";"),v=m!==-1?p.slice(0,m).trim():p.trim();if(!s.test(v))throw new TypeError("invalid media type");var g=new u(v.toLowerCase());if(m!==-1){var S,b,w;for(t.lastIndex=m;b=t.exec(p);){if(b.index!==m)throw new TypeError("invalid parameter format");m+=b[0].length,S=b[1].toLowerCase(),w=b[2],w.charCodeAt(0)===34&&(w=w.slice(1,-1),w.indexOf("\\")!==-1&&(w=w.replace(r,"$1"))),g.parameters[S]=w}if(m!==p.length)throw new TypeError("invalid parameter format")}return g}function l(f){var p;if(typeof f.getHeader=="function"?p=f.getHeader("content-type"):typeof f.headers=="object"&&(p=f.headers&&f.headers["content-type"]),typeof p!="string")throw new TypeError("content-type header is missing from object");return p}function c(f){var p=String(f);if(n.test(p))return p;if(p.length>0&&!e.test(p))throw new TypeError("invalid parameter value");return'"'+p.replace(i,"\\$1")+'"'}function u(f){this.parameters=Object.create(null),this.type=f}return tS}var Dhe=Nhe();function RC(t){var e=new AbortController;return setTimeout(()=>{e.abort()},t),e.signal}function IW(t){var e=new AbortController;function n(){for(var s of t)s.removeEventListener("abort",r)}function r(){e.abort(),n()}for(var i of t){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:e.signal,cleanup:n}}function qL(t,e){var n,r,i=QD(t)?new Headers(t.getAllResponseHeaders().trim().split(/[\r\n]+/).map(o=>{var a=o.indexOf(":");return[o.substring(0,a),o.substring(a+1)]})):t.headers,s;try{s=Fhe(i)}catch(o){return o}return((n=s)===null||n===void 0?void 0:n.type)==="application/json"&&e?new Nn(JSON.parse(e),t.status,QD(t)?t.responseURL:t.url,void 0,i):((r=s)===null||r===void 0?void 0:r.type)==="text/plain"?new Fd("Server returned ".concat(t.status," error: ").concat(e),t.status,i):new Fd("Server returned ".concat(t.status," error"),t.status,i)}function QD(t){return"getResponseHeader"in t}function Fhe(t){var e=t.get("Content-Type");if(e===null)return null;try{return Dhe.parse(e)}catch(n){throw new Error("Error parsing Content-Type '".concat(e,"': ").concat(n))}}function J6(t,e){return Z6.apply(this,arguments)}function Z6(){return Z6=U(function*(t,e){for(var n=0,r=null;n<t;)try{if(n>0){var i=1e3*Math.pow(2,n);O.log("network operation failed ".concat(n," times, retrying in ").concat(i,"ms...")),yield tu(i)}return yield e()}catch(s){if(s instanceof Vh)n+=1,r=s;else throw s}throw r}),Z6.apply(this,arguments)}function KL(t,e,n){return e>4||t instanceof Vh&&!n||t.httpStatus&&Math.floor(t.httpStatus/100)===4&&t.httpStatus!==429||t.name==="AbortError"||t.name==="M_TOO_LARGE"?-1:VL(t,1e3*Math.pow(2,e))}var id=function(t){return t.Success="success",t.Failure="failure",t.Logout="logout",t}({}),Uhe=500,jhe=60*1e3;class $he{constructor(e){this.opts=e,L(this,"tokenRefreshPromise",void 0),L(this,"latestTokenRefreshExpiry",void 0)}prepareForRequest(){var e=this;return U(function*(){return yield e.refreshIfNeeded(),{accessToken:e.opts.accessToken,refreshToken:e.opts.refreshToken,expiry:e.latestTokenRefreshExpiry}})()}refreshIfNeeded(){var e=this;return U(function*(){if(e.tokenRefreshPromise)return e.tokenRefreshPromise;if(e.latestTokenRefreshExpiry){var n=e.latestTokenRefreshExpiry.getTime()-Date.now();n<=Uhe&&(yield e._handleUnknownToken())}})()}handleUnknownToken(e,n){var r=this;return U(function*(){return r._handleUnknownToken(e,n)})()}_handleUnknownToken(e,n){var r=this;return U(function*(){if(e!=null&&e.expiry){var i=e.expiry.getTime()-Date.now();if(i>=jhe)return id.Logout}if(!e||(e==null?void 0:e.accessToken)===r.opts.accessToken){var s;(s=r.tokenRefreshPromise)!==null&&s!==void 0||(r.tokenRefreshPromise=r.doTokenRefresh(n));try{return yield r.tokenRefreshPromise}finally{r.tokenRefreshPromise=void 0}}return id.Success})()}doTokenRefresh(e){var n=this;return U(function*(){if(!n.opts.refreshToken||!n.opts.tokenRefreshFunction){var r;return(r=n.opts.logger)===null||r===void 0||r.error("Unable to refresh token - no refresh token or refresh function"),id.Logout}e&&e>1&&(yield tu(1e3*Math.min(32,2**e)));try{var i,s;(i=n.opts.logger)===null||i===void 0||i.debug("Attempting to refresh token");var{accessToken:o,refreshToken:a,expiry:l}=yield n.opts.tokenRefreshFunction(n.opts.refreshToken);return n.opts.accessToken=o,n.opts.refreshToken=a,n.latestTokenRefreshExpiry=l,(s=n.opts.logger)===null||s===void 0||s.debug("... token refresh complete, new token expiry:",l),id.Success}catch(f){var c;if(f instanceof GL||f instanceof Nn){var u;return(u=n.opts.logger)===null||u===void 0||u.error("Failed to refresh token",f),id.Logout}return(c=n.opts.logger)===null||c===void 0||c.warn("Failed to refresh token",f),id.Failure}})()}}class Bhe{constructor(e,n){var r;this.eventEmitter=e,this.opts=n,L(this,"abortController",new AbortController),L(this,"tokenRefresher",void 0),UK(n,["baseUrl","prefix"]),n.onlyData=!!n.onlyData,n.useAuthorizationHeader=(r=n.useAuthorizationHeader)!==null&&r!==void 0?r:!0,this.tokenRefresher=new $he(n)}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,n){return this.opts.fetchFn?this.opts.fetchFn(e,n):globalThis.fetch(e,n)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,n,r,i,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,a=void 0;e===le.Get?o=r:a=r;var l=this.getUrl(n,o,i,this.opts.idBaseUrl),c={json:!0,headers:{}};return s&&(c.headers.Authorization="Bearer ".concat(s)),this.requestOtherUrl(e,l,a,c)}authedRequest(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return this.doAuthedRequest(1,e,n,r,i,s)}doAuthedRequest(e,n,r,i,s){var o=arguments,a=this;return U(function*(){var l=o.length>5&&o[5]!==void 0?o[5]:{},c=Zy(l);c.abortSignal=l.abortSignal;var u=yield a.tokenRefresher.prepareForRequest();u.accessToken&&(a.opts.useAuthorizationHeader?(c.headers||(c.headers={}),c.headers.Authorization||(c.headers.Authorization="Bearer ".concat(u.accessToken)),i.access_token&&delete i.access_token):i.access_token||(i.access_token=u.accessToken));try{var f=yield a.request(n,r,i,s,c);return f}catch(m){if(!(m instanceof Nn))throw m;if(m.errcode==="M_UNKNOWN_TOKEN"){var p=yield a.tokenRefresher.handleUnknownToken(u,e);if(p===id.Success)return a.doAuthedRequest(e+1,n,r,i,s,l);if(p===id.Failure)throw new RW(m);c!=null&&c.inhibitLogoutEmit||a.eventEmitter.emit(X6.SessionLoggedOut,m)}else m.errcode=="M_CONSENT_NOT_GIVEN"&&a.eventEmitter.emit(X6.NoConsent,m.message,m.data.consent_uri);throw m}})()}request(e,n,r,i,s){var o=this.getUrl(n,r,s==null?void 0:s.prefix,s==null?void 0:s.baseUrl);return this.requestOtherUrl(e,o,i,s)}requestOtherUrl(e,n,r){var i=arguments,s=this;return U(function*(){var o,a,l,c,u,f=i.length>3&&i[3]!==void 0?i[3]:{},p=s.sanitizeUrlForLogs(n);(o=s.opts.logger)===null||o===void 0||o.debug("FetchHttpApi: --> ".concat(e," ").concat(p));var m=Object.assign({},f.headers||{}),v=(a=f.json)!==null&&a!==void 0?a:!0,g=v&&(r==null||(l=r.constructor)===null||l===void 0?void 0:l.name)===Object.name;v&&(g&&!m["Content-Type"]&&(m["Content-Type"]="application/json"),m.Accept||(m.Accept="application/json"));var S=(c=f.localTimeoutMs)!==null&&c!==void 0?c:s.opts.localTimeoutMs,b=(u=f.keepAlive)!==null&&u!==void 0?u:!1,w=[s.abortController.signal];S!==void 0&&w.push(RC(S)),f.abortSignal&&w.push(f.abortSignal);var k;g?k=JSON.stringify(r):k=r;var{signal:T,cleanup:I}=IW(w),C,x=Date.now();try{var A;C=yield s.fetch(n,{signal:T,method:e,body:k,headers:m,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:b,priority:f.priority}),(A=s.opts.logger)===null||A===void 0||A.debug("FetchHttpApi: <-- ".concat(e," ").concat(p," [").concat(Date.now()-x,"ms ").concat(C.status,"]"))}catch(D){var N;throw(N=s.opts.logger)===null||N===void 0||N.debug("FetchHttpApi: <-- ".concat(e," ").concat(p," [").concat(Date.now()-x,"ms ").concat(D,"]")),D.name==="AbortError"?D:new Vh("fetch failed",D)}finally{I()}if(!C.ok)throw qL(C,yield C.text());return s.opts.onlyData?v?C.json():C.text():C})()}sanitizeUrlForLogs(e){try{var n;typeof e=="string"?n=new URL(e):n=e;var r=new URLSearchParams;for(var i of n.searchParams.keys())r.append(i,"xxx");var s=r.toString(),o=s?"?".concat(s):"";return n.origin+n.pathname+o}catch{return"??"}}getUrl(e,n,r,i){var s=i??this.opts.baseUrl,o=s.endsWith("/")?s.slice(0,-1):s,a=new URL(o+(r??this.opts.prefix)+e);return n&&D6(n,a.searchParams),a}}var Hr=function(t){return t.V1="/_matrix/client/v1",t.V3="/_matrix/client/v3",t.Unstable="/_matrix/client/unstable",t}({}),mc=function(t){return t.V2="/_matrix/identity/v2",t}({}),Tm=function(t){return t.V1="/_matrix/media/v1",t.V3="/_matrix/media/v3",t}({}),Hhe=1e3,Vhe=0,CI,Fc=[],Ghe=function(){};function eF(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];e=e||0,e<0&&(e=0);var s=Date.now()+e,o=Vhe++,a={runAt:s,func:t,params:r,key:o},l=Khe(Fc,function(c){return c.runAt-s});return Fc.splice(l,0,a),WL(),o}function tF(t){if(Fc.length!==0){var e;for(e=0;e<Fc.length;e++){var n=Fc[e];if(n.key==t){Fc.splice(e,1);break}}e===0&&WL()}}function WL(){CI&&globalThis.clearTimeout(CI);var t=Fc[0];if(t){var e=Date.now(),n=Math.min(t.runAt-e,Hhe);CI=globalThis.setTimeout(qhe,n)}}function qhe(){for(var t=Date.now(),e=[];;){var n=Fc[0];if(!n||n.runAt>t)break;var r=Fc.shift();Ghe("runCallbacks: popping",r.key),e.push(r)}WL();for(var i of e)try{i.func.apply(globalThis,i.params)}catch(s){O.error("Uncaught exception in callback function",s)}}function Khe(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>1,s=e(t[i]);s>0?r=i:n=i+1}return n}class kW extends Bhe{constructor(){super(...arguments),L(this,"uploads",[])}uploadContent(e){var n,r,i,s,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=(n=o.includeFilename)!==null&&n!==void 0?n:!0,l=(r=o.abortController)!==null&&r!==void 0?r:new AbortController,c=((i=o.type)!==null&&i!==void 0?i:e.type)||"application/octet-stream",u=(s=o.name)!==null&&s!==void 0?s:e.name,f={loaded:0,total:0,abortController:l},p=Promise.withResolvers();if(globalThis.XMLHttpRequest){var m=new globalThis.XMLHttpRequest,v=function(){m.abort(),p.reject(new Error("Timeout"))},g=eF(v,3e4);m.onreadystatechange=function(){switch(m.readyState){case globalThis.XMLHttpRequest.DONE:tF(g);try{if(m.status===0)throw new DOMException(m.statusText,"AbortError");if(!m.responseText)throw new Error("No response body.");m.status>=400?p.reject(qL(m,m.responseText)):p.resolve(JSON.parse(m.responseText))}catch(k){if(k.name==="AbortError"){p.reject(k);return}p.reject(new Vh("request failed",k))}break}},m.upload.onprogress=k=>{var T;tF(g),f.loaded=k.loaded,f.total=k.total,g=eF(v,3e4),(T=o.progressHandler)===null||T===void 0||T.call(o,{loaded:k.loaded,total:k.total})};var S=this.getUrl("/upload",void 0,Tm.V3);a&&u&&S.searchParams.set("filename",encodeURIComponent(u)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&S.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),m.open(le.Post,S.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&m.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),m.setRequestHeader("Content-Type",c),m.send(e),l.signal.addEventListener("abort",()=>{m.abort()})}else{var b={};a&&u&&(b.filename=u);var w={"Content-Type":c};this.authedRequest(le.Post,"/upload",b,e,{prefix:Tm.V3,headers:w,abortSignal:l.signal}).then(k=>this.opts.onlyData?k:k.json()).then(p.resolve,p.reject)}return f.promise=p.promise.finally(()=>{OE(this.uploads,k=>k===f)}),l.signal.addEventListener("abort",()=>{OE(this.uploads,k=>k===f),p.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(f),f.promise}cancelUpload(e){var n=this.uploads.find(r=>r.promise===e);return n?(n.abortController.abort(),!0):!1}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:Tm.V3+"/upload",params:{access_token:this.opts.accessToken}}}}var Whe=6*60*60*1e3,zhe=30*1e3,xW=function(t){return t.Stable="stable",t.Unstable="unstable",t}({});class PW{constructor(e){var n=this;this.http=e,L(this,"capabilities",void 0),L(this,"retryTimeout",void 0),L(this,"refreshTimeout",void 0),L(this,"fetchCapabilities",U(function*(){var r=yield n.http.authedRequest(le.Get,"/capabilities");return n.capabilities=r.capabilities,n.capabilities})),L(this,"poll",U(function*(){try{yield n.fetchCapabilities(),n.clearTimeouts(),n.refreshTimeout=setTimeout(n.poll,Whe),O.debug("Fetched new server capabilities")}catch(i){n.clearTimeouts();var r=Math.floor(zhe+Math.random()*5e3);n.retryTimeout=setTimeout(n.poll,r),O.warn("Failed to refresh capabilities: retrying in ".concat(r,"ms"),i)}}))}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}function nF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function y0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var LW="10",Yhe=["1","2","3","4","5","6","7","8","9","10"],Xhe=30,Kt=function(t){return t.Highlight="highlight",t.Total="total",t}({}),xe=function(t){return t.MyMembership="Room.myMembership",t.Tags="Room.tags",t.AccountData="Room.accountData",t.Receipt="Room.receipt",t.Name="Room.name",t.Redaction="Room.redaction",t.RedactionCancelled="Room.redactionCancelled",t.LocalEchoUpdated="Room.localEchoUpdated",t.Timeline="Room.timeline",t.TimelineReset="Room.timelineReset",t.TimelineRefresh="Room.TimelineRefresh",t.OldStateUpdated="Room.OldStateUpdated",t.CurrentStateUpdated="Room.CurrentStateUpdated",t.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",t.UnreadNotifications="Room.UnreadNotifications",t.Summary="Room.Summary",t}({});let IC=class extends SW{constructor(e,n,r){var i,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),i=this,this.roomId=e,this.client=n,this.myUserId=r,this.opts=s,L(this,"reEmitter",void 0),L(this,"txnToEvent",new Map),L(this,"notificationCounts",{}),L(this,"bumpStamp",void 0),L(this,"threadNotifications",new Map),L(this,"cachedThreadReadReceipts",new Map),L(this,"oldestThreadedReceiptTs",1/0),L(this,"unthreadedReceipts",new Map),L(this,"timelineSets",void 0),L(this,"polls",new Map),L(this,"threadsTimelineSets",[]),L(this,"filteredTimelineSets",{}),L(this,"timelineNeedsRefresh",!1),L(this,"pendingEventList",void 0),L(this,"blacklistUnverifiedDevices",void 0),L(this,"selfMembership",void 0),L(this,"heroes",null),L(this,"getTypeWarning",!1),L(this,"getVersionWarning",!1),L(this,"membersPromise",void 0),L(this,"name",void 0),L(this,"normalizedName",void 0),L(this,"tags",{}),L(this,"accountData",new Map),L(this,"summary",null),L(this,"oldState",void 0),L(this,"currentState",void 0),L(this,"relations",void 0),L(this,"threads",new Map),L(this,"visibilityEvents",new Map),L(this,"roomReceipts",new Che(this)),L(this,"threadTimelineSetsPromise",null),L(this,"threadsReady",!1),L(this,"updateThreadRootEvents",(o,a,l)=>{if(o.length){var c;if(this.updateThreadRootEvent((c=this.threadsTimelineSets)===null||c===void 0?void 0:c[0],o,a,l),o.hasCurrentUserParticipated){var u;this.updateThreadRootEvent((u=this.threadsTimelineSets)===null||u===void 0?void 0:u[1],o,a,l)}}}),L(this,"updateThreadRootEvent",(o,a,l,c)=>{o&&a.rootEvent&&(c&&o.removeEvent(a.id),Rn.hasServerSideSupport?o.addLiveEvent(a.rootEvent,{duplicateStrategy:f1.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):o.addEventToTimeline(a.rootEvent,o.getLiveTimeline(),{toStartOfTimeline:l,addToState:!1}))}),L(this,"applyRedaction",o=>{if(o.isRedaction()){var a=o.event.redacts,l=a?this.findEventById(a):void 0;if(l){var c=l.threadRootId;if(l.makeRedacted(o,this),l.isState()){var u=this.currentState.getStateEvents(l.getType(),l.getStateKey());(u==null?void 0:u.getId())===l.getId()&&this.currentState.setStateEvents([l])}this.emit(xe.Redaction,o,this,c),this.visibilityEvents.delete(a),l.isVisibilityEvent()&&this.redactVisibilityChangeEvent(o)}}}),this.setMaxListeners(100),this.reEmitter=new Vg(this),s.pendingEventOrdering=s.pendingEventOrdering||cg.Chronological,this.name=e,this.normalizedName=e,this.relations=new sW(this.client,this),this.on(xe.Receipt,this.onReceipt),this.timelineSets=[new fm(this,s)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[xe.Timeline,xe.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===cg.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(o=>{var a=this.client.getEventMapper({toDevice:!1,decrypt:!1});o.forEach(function(){var l=U(function*(c){var u=a(c);yield n.decryptEventIfNeeded(u),u.setStatus(at.NOT_SENT),i.addPendingEvent(u,u.getTxnId())});return function(c){return l.apply(this,arguments)}}())})),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}createThreadsTimelineSets(){var e=this;return U(function*(){var n;if(e.threadTimelineSetsPromise)return e.threadTimelineSetsPromise;if((n=e.client)!==null&&n!==void 0&&n.supportsThreads())try{e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(Ra.My)]);var r=yield e.threadTimelineSetsPromise;return e.threadsTimelineSets[0]=r[0],e.threadsTimelineSets[1]=r[1],r}catch{return e.threadTimelineSetsPromise=null,null}return null})()}decryptCriticalEvents(){var e=this;return U(function*(){if(e.client.getCrypto()){var n=e.getEventReadUpTo(e.client.getUserId(),!0),r=e.getLiveTimeline().getEvents(),i=r.findIndex(o=>o.event.event_id===n),s=r.slice(i).reverse().map(o=>e.client.decryptEventIfNeeded(o));yield Promise.allSettled(s)}})()}decryptAllEvents(){var e=this;return U(function*(){if(e.client.getCrypto()){var n=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map(r=>e.client.decryptEventIfNeeded(r));yield Promise.allSettled(n)}})()}getCreator(){var e,n=this.currentState.getStateEvents(ee.RoomCreate,"");return(e=n==null?void 0:n.getSender())!==null&&e!==void 0?e:null}getVersion(){var e,n=this.currentState.getStateEvents(ee.RoomCreate,"");return n?(e=n.getContent().room_version)!==null&&e!==void 0?e:"1":(this.getVersionWarning||(O.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}getRecommendedVersion(){var e=this;return U(function*(){var n={};try{n=yield e.client.getCapabilities()}catch{}var r=n["m.room_versions"];if(!r){r={default:LW,available:{}};for(var i of Yhe)r.available[i]=xW.Stable}var s=e.checkVersionAgainstCapability(r);if(s.urgent&&s.needsUpgrade){O.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{n=yield e.client.fetchCapabilities()}catch(o){O.warn("Failed to refresh room version capabilities",o)}if(r=n["m.room_versions"],r)s=e.checkVersionAgainstCapability(r);else return O.warn("No room version capability - assuming upgrade required."),s}return s})()}checkVersionAgainstCapability(e){var n=this.getVersion();O.log("[".concat(this.roomId,"] Current version: ").concat(n)),O.log("[".concat(this.roomId,"] Version capability: "),e);var r={version:n,needsUpgrade:!1,urgent:!1};if(n===e.default)return r;var i=Object.keys(e.available).filter(s=>e.available[s]==="stable");return i.includes(n)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?O.warn("URGENT upgrade required on ".concat(this.roomId)):O.warn("Non-urgent upgrade required on ".concat(this.roomId))),r}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(ee.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var n=OE(this.pendingEventList,function(r){return r.getId()==e},!1);return this.savePendingEvents(),n}hasPendingEvent(e){var n,r;return(n=(r=this.pendingEventList)===null||r===void 0?void 0:r.some(i=>i.getId()===e))!==null&&n!==void 0?n:!1}getPendingEvent(e){var n,r;return(n=(r=this.pendingEventList)===null||r===void 0?void 0:r.find(i=>i.getId()===e))!==null&&n!==void 0?n:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){var e=this.getLiveTimeline(),n=e.getEvents();if(n.length){var r=n[n.length-1];return r.getTs()}else return Number.MIN_SAFE_INTEGER}getLastLiveEvent(){var e,n,r=this.getLiveTimeline().getEvents(),i=r[r.length-1],s=this.getLastThread();if(!s)return i;var o=s.events[s.events.length-1];return((e=i==null?void 0:i.getTs())!==null&&e!==void 0?e:0)>((n=o==null?void 0:o.getTs())!==null&&n!==void 0?n:0)?i:o}getLastThread(){return this.getThreads().reduce((e,n)=>{var r,i;if(!e)return n;var s=n.events[n.events.length-1],o=e.events[e.events.length-1];return((r=s==null?void 0:s.getTs())!==null&&r!==void 0?r:0)>=((i=o==null?void 0:o.getTs())!==null&&i!==void 0?i:0)?n:e},void 0)}getMyMembership(){var e;return(e=this.selfMembership)!==null&&e!==void 0?e:qe.Leave}getDMInviter(){var e=this.getMember(this.myUserId);if(e)return e.getDMInviter();if(this.selfMembership===qe.Invite){var n=this.getInvitedAndJoinedMemberCount();if(n===2){var r;return(r=this.heroes)===null||r===void 0||(r=r[0])===null||r===void 0?void 0:r.userId}}}guessDMUserId(){var e=this.getMember(this.myUserId);if(e){var n=e.getDMInviter();if(n)return n}if(Array.isArray(this.heroes)&&this.heroes.length)return this.heroes[0].userId;var r=this.currentState.getMembers(),i=r.find(s=>s.userId!==this.myUserId);return i?i.userId:this.myUserId}getFunctionalMembers(){var e=this.currentState.getStateEvents(zK.name,"");return Array.isArray(e==null?void 0:e.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var e,n=this.getFunctionalMembers(),r=0;if(this.getMembers().forEach(g=>{g.membership!=="join"&&g.membership!=="invite"||n.includes(g.userId)||r++}),!(r>2)){var i=(e=this.heroes)===null||e===void 0?void 0:e.filter(g=>!n.includes(g.userId)),s=Array.isArray(i)&&i.length;if(s){for(var o of i)if(o.fromMSC4186){var l=new Y1(this.roomId,o.userId);return l.setMembershipEvent(new Bi({event_id:"$"+this.roomId+o.userId+new Date().getTime(),type:ee.RoomMember,state_key:o.userId,content:{displayname:o.displayName,avatar_url:o.avatarUrl}})),l}else{var a=this.getMember(o.userId);if(a)return a}var c=i.map(g=>this.getMember(g.userId)).find(g=>!!g);if(c)return c}var u=this.getMembers(),f=u==null?void 0:u.filter(g=>!n.includes(g.userId));if(f.length<=2){var p=f.find(g=>g.userId!==this.myUserId);if(p)return p}if(s){var m=i.map(g=>this.client.getUser(g.userId)).find(g=>!!g);if(m){var v=new Y1(this.roomId,m.userId);return v.user=m,v}}}}updateMyMembership(e){var n=this.selfMembership;this.selfMembership=e,n!==e&&(e===qe.Leave&&this.cleanupAfterLeaving(),this.emit(xe.MyMembership,this,e,n))}loadMembersFromServer(){var e=this;return U(function*(){var n=e.client.store.getSyncToken(),r=yield e.client.members(e.roomId,void 0,qe.Leave,n??void 0);return r.chunk})()}loadMembers(){var e=this;return U(function*(){var n=!1,r=yield e.client.store.getOutOfBandMembers(e.roomId);(r===null||e.hasEncryptionStateEvent())&&(n=!0,r=yield e.loadMembersFromServer(),O.log("LL: got ".concat(r.length," ")+"members from server for room ".concat(e.roomId)));var i=r.filter(La).map(e.client.getEventMapper());return{memberEvents:i,fromServer:n}})()}membersLoaded(){return this.opts.lazyLoadMembers?this.currentState.outOfBandMembersReady():!0}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var e=this.loadMembers().then(n=>(this.currentState.setOutOfBandMembers(n.memberEvents),n.fromServer)).catch(n=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),n});return e.then(n=>{if(n){var r=this.currentState.getMembers().filter(s=>s.isOutOfBand()).map(s=>{var o;return(o=s.events.member)===null||o===void 0?void 0:o.event});O.log("LL: telling store to write ".concat(r.length)+" members for room ".concat(this.roomId));var i=this.client.store;return i.setOutOfBandMembers(this.roomId,r).catch(s=>{O.log("LL: storing OOB room members failed, oh well",s)})}}).catch(n=>{O.error(n)}),this.membersPromise=e,this.membersPromise}clearLoadedMembersIfNeeded(){var e=this;return U(function*(){e.opts.lazyLoadMembers&&e.membersPromise&&(yield e.loadMembersIfNeeded(),yield e.client.store.clearOutOfBandMembers(e.roomId),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0)})()}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(e=>{O.error("error after clearing loaded members from "+"room ".concat(this.roomId," after leaving")),O.log(e)})}refreshLiveTimeline(){var e=this;return U(function*(){var n=e.getLiveTimeline(),r=n.getPaginationToken(Le.FORWARDS),i=n.getPaginationToken(Le.BACKWARDS),s=n.getEvents(),o=s[s.length-1];O.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(n.toString()," ")+"forwardPaginationToken=".concat(r," ")+"backwardPaginationToken=".concat(i));var a=e.getUnfilteredTimelineSet(),l;o?(e.resetLiveTimeline(null,null),e.emit(xe.TimelineRefresh,e,a),l=yield e.client.getEventTimeline(a,o.getId())):l=yield e.client.getLatestTimeline(a);var c=a.getLiveTimeline();!c||c.getPaginationToken(_t.Forward)===null&&c.getPaginationToken(_t.Backward)===null&&c.getEvents().length===0?(O.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),l.setPaginationToken(r,Le.FORWARDS),a.setLiveTimeline(l),e.fixUpLegacyTimelineFields()):O.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(xe.TimelineRefresh,e,a)})()}resetLiveTimeline(e,n){for(var r of this.timelineSets)r.resetLiveTimeline(e??void 0,n??void 0);for(var i of this.threads.values())i.resetLiveTimeline(e,n);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){var e=this.oldState,n=this.currentState;this.oldState=this.getLiveTimeline().getState(Le.BACKWARDS),this.currentState=this.getLiveTimeline().getState(Le.FORWARDS),e!==this.oldState&&this.emit(xe.OldStateUpdated,this,e,this.oldState),n!==this.currentState&&(this.emit(xe.CurrentStateUpdated,this,n,this.currentState),this.reEmitter.stopReEmitting(n,[gt.Events,gt.Members,gt.NewMember,gt.Update,gt.Marker,Mn.New,Mn.Update,Mn.Destroy,Mn.LivenessChange]),this.reEmitter.reEmit(this.currentState,[gt.Events,gt.Members,gt.NewMember,gt.Update,gt.Marker,Mn.New,Mn.Update,Mn.Destroy,Mn.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var n=[],r=!1,i=e.getContent();for(var s of Object.values(i))for(var[o,a]of Object.entries(s))if(ML(o)&&a){for(var[l,c]of Object.entries(a))if(!(!c||typeof c!="object")){var u=c;l===this.client.getUserId()&&(u.thread_id===void 0?r=!0:typeof u.thread_id=="string"&&n.push(u.thread_id))}}r&&(n=this.getThreads().filter(I=>this.getThreadUnreadNotificationCount(I.id,Kt.Total)>0||this.getThreadUnreadNotificationCount(I.id,Kt.Highlight)>0).map(I=>I.id),n.push("main"));for(var f of n){var p,m=20,v=f==="main"?this.getLiveTimeline():(p=this.getThread(f))===null||p===void 0?void 0:p.liveTimeline;if(!v){O.warn("Couldn't find timeline for thread ID ".concat(f," in room ").concat(this.roomId));continue}for(var g=v.getEvents(),S=0,b=g.length-1;b>=0;b--){var w;if(b===g.length-m)return;var k=g[b];if(this.hasUserReadEvent(this.client.getUserId(),k.getId()))break;var T=this.client.getPushActionsForEvent(k);S+=T!=null&&(w=T.tweaks)!==null&&w!==void 0&&w.highlight?1:0}f==="main"?this.setUnreadNotificationCount(Kt.Highlight,S):this.setThreadUnreadNotificationCount(f,Kt.Highlight,S)}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){var n=this.findEventById(e),r=this.findThreadForEvent(n);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){var n=this.getUnfilteredTimelineSet().findEventById(e);if(!n)for(var r=this.getThreads(),i=0;i<r.length;i++){var s=r[i];if(n=s.findEventById(e),n)return n}return n}getUnreadNotificationCount(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kt.Total,n=this.getRoomUnreadNotificationCount(e);for(var r of this.threadNotifications.values()){var i;n+=(i=r[e])!==null&&i!==void 0?i:0}return n}getUnreadCountForEventContext(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kt.Total,r=arguments.length>1?arguments[1]:void 0,i=!!r.threadRootId&&!r.isThreadRoot;return(e=i?this.getThreadUnreadNotificationCount(r.threadRootId,n):this.getRoomUnreadNotificationCount(n))!==null&&e!==void 0?e:0}getRoomUnreadNotificationCount(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kt.Total;return(e=this.notificationCounts[n])!==null&&e!==void 0?e:0}getThreadUnreadNotificationCount(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kt.Total;return(n=(r=this.threadNotifications.get(e))===null||r===void 0?void 0:r[i])!==null&&n!==void 0?n:0}hasThreadUnreadNotification(){for(var e of this.threadNotifications.values()){var n,r;if(((n=e.highlight)!==null&&n!==void 0?n:0)>0||((r=e.total)!==null&&r!==void 0?r:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,n,r){var i,s,o=y0({highlight:(i=this.threadNotifications.get(e))===null||i===void 0?void 0:i.highlight,total:(s=this.threadNotifications.get(e))===null||s===void 0?void 0:s.total},{[n]:r});this.threadNotifications.set(e,o),this.emit(xe.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){var e=null;for(var n of this.threadNotifications.values()){var r,i;if(((r=n.highlight)!==null&&r!==void 0?r:0)>0)return Kt.Highlight;((i=n.total)!==null&&i!==void 0?i:0)>0&&!e&&(e=Kt.Total)}return e}resetThreadUnreadNotificationCountFromSync(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=this.hasEncryptionStateEvent();for(var[r,i]of this.threadNotifications)e.includes(r)||(i.total=0,n||(i.highlight=0));this.emit(xe.UnreadNotifications)}setBumpStamp(e){this.bumpStamp=e}getBumpStamp(){return this.bumpStamp}setUnreadNotificationCount(e,n){this.notificationCounts[e]=n,this.emit(xe.UnreadNotifications,this.notificationCounts)}setUnread(e,n){return this.setUnreadNotificationCount(e,n)}setSummary(e){var n,r=(n=e["m.heroes"])===null||n===void 0?void 0:n.map(o=>({userId:o,fromMSC4186:!1})),i=e["m.joined_member_count"],s=e["m.invited_member_count"];Number.isInteger(i)&&this.currentState.setJoinedMemberCount(i),Number.isInteger(s)&&this.currentState.setInvitedMemberCount(s),Array.isArray(r)&&(this.heroes=r.filter(o=>o.userId!=this.myUserId)),this.emit(xe.Summary,e)}setMSC4186SummaryData(e,n,r){e&&(this.heroes=e.filter(i=>i.user_id!==this.myUserId).map(i=>({userId:i.user_id,displayName:i.displayname,avatarUrl:i.avatar_url,fromMSC4186:!0}))),n!==void 0&&Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),r!==void 0&&Number.isInteger(r)&&this.currentState.setInvitedMemberCount(r),this.emit(xe.Summary,{"m.heroes":this.heroes?this.heroes.map(i=>i.userId):[],"m.joined_member_count":n,"m.invited_member_count":r})}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices===void 0?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,a=this.currentState.getStateEvents(ee.RoomAvatar,"");if(!a&&!s)return null;var l=a?a.getContent().url:null;return l?wC(e,l,n,r,i,void 0,void 0,o):null}getMxcAvatarUrl(){var e;return((e=this.currentState.getStateEvents(ee.RoomAvatar,""))===null||e===void 0||(e=e.getContent())===null||e===void 0?void 0:e.url)||null}getCanonicalAlias(){var e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){var e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,"");return e?e.getContent().alt_aliases||[]:[]}addEventsToTimeline(e,n,r,i,s){i.getTimelineSet().addEventsToTimeline(e,n,r,i,s)}getThread(e){var n;return(n=this.threads.get(e))!==null&&n!==void 0?n:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(qe.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter(function(n){return n.membership===e})}getEncryptionTargetMembers(){var e=this;return U(function*(){yield e.loadMembersIfNeeded();var n=e.getMembersWithMembership(qe.Join);return e.shouldEncryptForInvitedMembers()&&(n=n.concat(e.getMembersWithMembership(qe.Invite))),n})()}shouldEncryptForInvitedMembers(){var e,n=this.currentState.getStateEvents(ee.RoomHistoryVisibility,"");return(n==null||(e=n.getContent())===null||e===void 0?void 0:e.history_visibility)!=="joined"}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,n){var r=this.getMember(e);return r?r.membership===n:!1}getOrCreateFilteredTimelineSet(e){var{prepopulateTimeline:n=!0,useSyncEvents:r=!0,pendingEvents:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var s=Object.assign({filter:e,pendingEvents:i},this.opts),o=new fm(this,s);this.reEmitter.reEmit(o,[xe.Timeline,xe.TimelineReset]),r&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));var a=this.getLiveTimeline();if(n){a.getEvents().forEach(function(u){o.addLiveEvent(u,{addToState:!1})});for(var l=a;l.getNeighbouringTimeline(Le.BACKWARDS);)l=l.getNeighbouringTimeline(Le.BACKWARDS);o.getLiveTimeline().setPaginationToken(l.getPaginationToken(Le.BACKWARDS),Le.BACKWARDS)}else if(r){var c=a.getPaginationToken(_t.Forward);o.getLiveTimeline().setPaginationToken(c,_t.Backward)}return o}getThreadListFilter(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:Ra.All,i=n.client.getUserId(),s=new Es(i),o={room:{timeline:{[Lm.name]:[cn.name]}}};r===Ra.My&&(o.room.timeline[Pm.name]=[i]),s.setDefinition(o);var a=yield n.client.getOrCreateFilter("THREAD_PANEL_".concat(n.roomId,"_").concat(r),s);return s.filterId=a,s})()}createThreadTimelineSet(e){var n=this;return U(function*(){var r;if(Rn.hasServerSideListSupport)r=new fm(n,y0(y0({},n.opts),{},{pendingEvents:!1}),void 0,void 0,e??Ra.All),n.reEmitter.reEmit(r,[xe.Timeline,xe.TimelineReset]);else if(Rn.hasServerSideSupport){var i=yield n.getThreadListFilter(e);r=n.getOrCreateFilteredTimelineSet(i,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else r=new fm(n,{pendingEvents:!1}),Array.from(n.threads).forEach(s=>{var[,o]=s;if(o.length!==0){var a=o.timeline.some(l=>l.getSender()===n.client.getUserId());(e!==Ra.My||a)&&r.getLiveTimeline().addEvent(o.rootEvent,{toStartOfTimeline:!1,addToState:!1})}});return r})()}processThreadRoots(e,n){if(this.client.supportsThreads())for(var r of e)Le.setEventMetadata(r,this.currentState,n),this.getThread(r.getId())||this.createThread(r.getId(),r,[],n)}fetchRoomThreads(){var e=this;return U(function*(){if(!(e.threadsReady||!e.client.supportsThreads())){if(Rn.hasServerSideListSupport)yield Promise.all([e.fetchRoomThreadList(Ra.All),e.fetchRoomThreadList(Ra.My)]);else{var n=yield e.getThreadListFilter(),{chunk:r}=yield e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,_t.Backward,n);if(!r.length)return;var i=r.map(e.client.getEventMapper()).sort((p,m)=>{var v=p.getServerAggregatedRelation(cn.name),g=m.getServerAggregatedRelation(cn.name);return v.latest_event.origin_server_ts-g.latest_event.origin_server_ts}),s,o=e.getLiveTimeline().getState(Le.FORWARDS);for(var a of i){var l,c={duplicateStrategy:f1.Ignore,fromCache:!1,addToState:!1,roomState:o};(l=e.threadsTimelineSets[0])===null||l===void 0||l.addLiveEvent(a,c);var u=a.getServerAggregatedRelation(cn.name);if(u!=null&&u.current_user_participated){var f;(f=e.threadsTimelineSets[1])===null||f===void 0||f.addLiveEvent(a,c),s=a}}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),s&&e.client.decryptEventIfNeeded(s)}e.on(Zi.NewReply,e.onThreadReply),e.on(Zi.Update,e.onThreadUpdate),e.on(Zi.Delete,e.onThreadDelete),e.threadsReady=!0}})()}processPollEvents(e){var n=this;return U(function*(){for(var r of e)try{if(!r.isEncrypted()&&!wW(r))continue;yield n.client.decryptEventIfNeeded(r),n.processPollEvent(r)}catch(i){O.warn("Error processing poll event",r.getId(),i)}})()}processPollEvent(e){var n=this;return U(function*(){if(e.isDecryptionFailure()){e.once(Ht.Decrypted,o=>{n.processPollEvent(o)});return}if(js.M_POLL_START.matches(e.getType())){try{var r=new EW(e,n.client,n);n.polls.set(e.getId(),r),n.emit(rd.New,r),e.once(Ht.BeforeRedaction,o=>{n.polls.delete(o.getId())})}catch{}return}var i=e.relationEventId;if(i&&n.polls.has(i)){var s=n.polls.get(i);s==null||s.onNewRelation(e)}})()}fetchRoomThreadList(e){var n=this;return U(function*(){if(n.client.supportsThreads()&&n.threadsTimelineSets.length!==0){var r=e===Ra.My?n.threadsTimelineSets[1]:n.threadsTimelineSets[0],{chunk:i,end:s}=yield n.client.createThreadListMessagesRequest(n.roomId,null,void 0,_t.Backward,r.threadListType,r.getFilter());if(r.getLiveTimeline().setPaginationToken(s??null,_t.Backward),!!i.length){var o=i.map(n.client.getEventMapper());n.processThreadRoots(o,!0);var a=n.getLiveTimeline().getState(Le.FORWARDS);for(var l of o)r.addLiveEvent(l,{duplicateStrategy:f1.Replace,fromCache:!1,roomState:a,addToState:!1})}}})()}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var n;this.threads.delete(e.id);var r=this.getTimelineForEvent(e.id),i=r==null||(n=r.getEvents())===null||n===void 0?void 0:n.find(o=>o.getId()===e.id);i?e.clearEventMetadata(i):O.debug("onThreadDelete: Could not find root event in room timeline");for(var s of this.threadsTimelineSets)s.removeEvent(e.id)}removeFilteredTimelineSet(e){var n=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var r=this.timelineSets.indexOf(n);r>-1&&this.timelineSets.splice(r,1)}eventShouldLiveIn(e,n,r){var i;if(!((i=this.client)!==null&&i!==void 0&&i.supportsThreads()))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||r!=null&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};var s=e.isRelation(cn.name),o=e.getAssociatedId(),a=e.threadRootId;if(o&&!s&&(a===o||r!=null&&r.has(o)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};var l;if(o){var c;l=(c=this.findEventById(o))!==null&&c!==void 0?c:n==null?void 0:n.find(u=>u.getId()===o)}return l&&!s?this.eventShouldLiveIn(l,n,r):a!=null?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:a}:!o||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;var{threadId:n}=this.eventShouldLiveIn(e);return n?this.getThread(n):null}addThreadedEvents(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getThread(e);if(i)i.addEvents(n,r);else{var s,o=(s=this.findEventById(e))!==null&&s!==void 0?s:n.find(a=>a.getId()===e);this.createThread(e,o,n,r)}}processThreadedEvents(e,n){e.forEach(this.applyRedaction);var r={};for(var i of e){var s,{threadId:o,shouldLiveInThread:a}=this.eventShouldLiveIn(i);a&&!r[o]&&(r[o]=[]),(s=r[o])===null||s===void 0||s.push(i)}Object.entries(r).map(l=>{var[c,u]=l;return this.addThreadedEvents(c,u,n)})}createThread(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(n){var o=this.relations.getAllChildEventsForEvent(n.getId());o!=null&&o.length&&(i=i.concat(o.filter(l=>!l.isRelation(Tn.Replace))))}var a=new Rn(e,n,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:(r=this.cachedThreadReadReceipts.get(e))!==null&&r!==void 0?r:[]});return this.reEmitter.reEmit(a,[Zi.Delete,Zi.Update,Zi.NewReply,xe.Timeline,xe.TimelineReset]),this.cachedThreadReadReceipts.delete(e),this.threads.set(a.id,a),a.addEvents(i,!1),this.threadsReady&&a.initialEventsFetched&&this.updateThreadRootEvents(a,s,!1),this.emit(Zi.New,a,s),a}processLiveEvent(e){this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e);var n=e.getUnsigned().transaction_id;if(!n&&e.getSender()===this.myUserId){for(var[r,i]of this.txnToEvent)if(i.getId()===e.getId()){O.debug("processLiveEvent: found sent event without txn ID: ",r,e.getId());var s=e.getUnsigned();s.transaction_id=r,e.setUnsigned(s);break}}}addLiveEvent(e,n){var{duplicateStrategy:r,timelineWasEmpty:i,fromCache:s,addToState:o}=n;for(var a of this.timelineSets)a.addLiveEvent(e,{duplicateStrategy:r,fromCache:s,timelineWasEmpty:i,addToState:o});e.sender&&e.getType()!==ee.RoomRedaction&&this.addReceipt(bW(e.sender.userId,e,Ji.Read),!0)}addPendingEvent(e,n){if(e.status!==at.SENDING&&e.status!==at.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(n))throw new Error("addPendingEvent called on an event with known txnId "+n);if(Le.setEventMetadata(e,this.getLiveTimeline().getState(Le.FORWARDS),!1),this.txnToEvent.set(n,e),this.pendingEventList){if(this.pendingEventList.some(o=>o.status===at.NOT_SENT)&&(O.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(at.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var r=e.event.redacts,i=this.pendingEventList.find(o=>o.getId()===r);!i&&r&&(i=this.findEventById(r)),i&&(i.markLocallyRedacted(e),this.emit(xe.Redaction,e,this,i.threadRootId))}}else for(var s of this.timelineSets)s.getFilter()?s.getFilter().filterRoomTimeline([e]).length&&s.addEventToTimeline(e,s.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):s.addEventToTimeline(e,s.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit(xe.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){var e=this.pendingEventList.map(n=>y0(y0({},n.event),{},{txn_id:n.getTxnId()})).filter(n=>{var r=n.type===ee.RoomMessageEncrypted,i=this.hasEncryptionStateEvent();return r||!i});this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,n){var r=n.getId(),i=e.getId(),s=n.status;O.debug("Got remote echo for event ".concat(r," -> ").concat(i," old status ").concat(s)),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(r),n.handleRemoteEcho(e.event);var{shouldLiveInRoom:o,threadId:a}=this.eventShouldLiveIn(e),l=a?this.getThread(a):null;if(l==null||l.setEventMetadata(n),l==null||l.timelineSet.handleRemoteEcho(n,r,i),o)for(var c of this.timelineSets)c.handleRemoteEcho(n,r,i);this.emit(xe.LocalEchoUpdated,n,this,r,s)}updatePendingEvent(e,n,r){if(O.log("setting pendingEvent status to ".concat(n," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(r)),n==at.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(n==at.SENT){var i=this.getTimelineForEvent(r);if(i){var s=this.findEventById(r),o=s==null?void 0:s.getUnsigned().transaction_id;if(!o&&s){var a=s.getUnsigned();a.transaction_id=e.getTxnId(),s.setUnsigned(a),this.removeEvent(s.getId()),this.handleRemoteEcho(s,e)}return}}var l=e.status,c=e.getId();if(!l)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var u=Jhe[l];if(!(u!=null&&u.includes(n)))throw new Error("Invalid EventStatus transition ".concat(l,"->").concat(n));if(e.setStatus(n),n==at.SENT){e.replaceLocalEventId(r);var{shouldLiveInRoom:f,threadId:p}=this.eventShouldLiveIn(e),m=p?this.getThread(p):void 0;if(m==null||m.setEventMetadata(e),m==null||m.timelineSet.replaceEventId(c,r),f)for(var v of this.timelineSets)v.replaceEventId(c,r)}else if(n==at.CANCELLED){if(this.pendingEventList){var g=this.getPendingEvent(c);this.removePendingEvent(c),g!=null&&g.isRedaction()&&this.revertRedactionLocalEcho(g)}this.removeEvent(c)}this.savePendingEvents(),this.emit(xe.LocalEchoUpdated,e,this,c,l)}revertRedactionLocalEcho(e){var n=e.event.redacts;if(n){var r=this.getUnfilteredTimelineSet().findEventById(n);r&&(r.unmarkLocallyRedacted(),this.emit(xe.RedactionCancelled,e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}}assertTimelineSetsAreLive(){for(var e=0;e<this.timelineSets.length;e++){var n=this.timelineSets[e].getLiveTimeline();if(n.getPaginationToken(Le.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+n.getPaginationToken(Le.FORWARDS)+")");if(n.getNeighbouringTimeline(Le.FORWARDS))throw new Error("live timeline ".concat(e," is no longer live - it has a neighbouring timeline"))}}addLiveEvents(e,n){var r=this;return U(function*(){var{duplicateStrategy:i,fromCache:s,timelineWasEmpty:o=!1,addToState:a}=n;if(i&&["replace","ignore"].indexOf(i)===-1)throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");r.assertTimelineSetsAreLive();var l=r.findThreadRoots(e),c={},u={duplicateStrategy:i,fromCache:s,timelineWasEmpty:o,addToState:a},f=[...e];for(var p of e){var m;if(r.processLiveEvent(p),p.getUnsigned().transaction_id){var v=r.txnToEvent.get(p.getUnsigned().transaction_id);if(v){r.handleRemoteEcho(p,v);continue}}var{shouldLiveInRoom:g,shouldLiveInThread:S,threadId:b=""}=r.eventShouldLiveIn(p,f,l);if(!S&&!g&&p.isRelation())try{var w=new Bi(yield r.client.fetchRoomEvent(r.roomId,p.relationEventId));if(f.push(w),w.threadRootId){l.add(w.threadRootId);var k=p.getUnsigned();k[UE.name]=w.threadRootId,p.setUnsigned(k)}({shouldLiveInRoom:g,shouldLiveInThread:S,threadId:b=""}=r.eventShouldLiveIn(p,f,l))}catch(T){O.error("Failed to load parent event of unhandled relation",T)}S&&!c[b]&&(c[b]=[]),(m=c[b])===null||m===void 0||m.push(p),g?r.addLiveEvent(p,u):!S&&p.isRelation()&&r.relations.aggregateChildEvent(p)}Object.entries(c).forEach(T=>{var[I,C]=T;r.addThreadedEvents(I,C,!1)})})()}partitionThreadedEvents(e){var n=0,r=1,i=2;if(this.client.supportsThreads()){var s=this.findThreadRoots(e);return e.reduce((o,a)=>{var{shouldLiveInRoom:l,shouldLiveInThread:c,threadId:u}=this.eventShouldLiveIn(a,e,s);return l&&o[n].push(a),c&&(a.setThreadId(u??""),o[r].push(a)),!c&&!l&&o[i].push(a),o},[[],[],[]])}else return[e,[],[]]}findThreadRoots(e){var n=new Set;for(var r of e){var i=r.threadRootId;i!=null&&n.add(i)}return n}addReceipt(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e.getContent();this.roomReceipts.add(r,n),Object.keys(r).forEach(i=>{Object.keys(r[i]).forEach(s=>{Object.keys(r[i][s]).forEach(o=>{var a,l,c,u=r[i][s][o],f=!u.thread_id||u.thread_id===Jy,p=f?this:this.threads.get((a=u.thread_id)!==null&&a!==void 0?a:"");if(p){if(p.addReceiptToStructure(i,s,o,u,n),!n&&this.client.isInitialSyncComplete()&&o===this.client.getUserId()){var m=p.timeline[p.timeline.length-1];m&&i===m.getId()&&o===m.getSender()&&(p.setUnread(Kt.Total,0),p.setUnread(Kt.Highlight,0))}}else{var v;this.cachedThreadReadReceipts.set(u.thread_id,[...(v=this.cachedThreadReadReceipts.get(u.thread_id))!==null&&v!==void 0?v:[],{eventId:i,receiptType:s,userId:o,receipt:u,synthetic:n}])}var g=this.client.getUserId();o===g&&!f&&u.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=u.ts),!u.thread_id&&u.ts>((l=(c=this.unthreadedReceipts.get(o))===null||c===void 0?void 0:c.ts)!==null&&l!==void 0?l:0)&&this.unthreadedReceipts.set(o,u)})})}),this.emit(xe.Receipt,e,this)}addEphemeralEvents(e){for(var n of e)n.getType()===ee.Typing?this.currentState.setTypingEvent(n):n.getType()===ee.Receipt&&this.addReceipt(n)}removeEvents(e){for(var n of e)this.removeEvent(n)}removeEvent(e){var n=!1;for(var r of this.timelineSets){var i=r.removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),n=!0)}return n}recalculate(){var e=this.currentState.getStateEvents(ee.RoomMember,this.myUserId);if(e){var n=e.getContent().membership;if(this.updateMyMembership(n),n===qe.Invite){var r=e.getUnsigned().invite_room_state||[];r.forEach(s=>{var o=this.currentState.getStateEvents(s.type,s.state_key);o||this.currentState.setStateEvents([new Bi({type:s.type,state_key:s.state_key,content:s.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])})}}var i=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=Ofe(this.name),this.summary=new oW(this.roomId,{title:this.name}),i!==this.name&&this.emit(xe.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(xe.Tags,e,this)}addAccountData(e){for(var n of e){n.getType()==="m.tag"&&this.addTags(n);var r=n.getType(),i=this.accountData.get(r);this.accountData.set(r,n),this.emit(xe.AccountData,n,this,i)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===qe.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(ee.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(ee.RoomMessage,this.myUserId))}canInvite(e){var n=this.getMyMembership()===qe.Join,r=this.currentState.getStateEvents(ee.RoomPowerLevels,""),i=r&&r.getContent(),s=this.getMember(e);return i&&s&&i.invite>s.powerLevel&&(n=!1),n}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){var e=this.currentState.getStateEvents(ee.RoomCreate,"");if(!e){this.getTypeWarning||(O.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0);return}return e.getContent()[FE]}isSpaceRoom(){return this.getType()===Cm.Space}isCallRoom(){return this.getType()===Cm.UnstableCall}isElementVideoRoom(){return this.getType()===Cm.ElementVideo}findPredecessor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.getLiveTimeline().getState(Le.FORWARDS);return n?n.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){var n=this.client.roomNameGenerator(this.roomId,e);if(n!==null)return n}switch(e.type){case gl.Actual:return e.name;case gl.Generated:switch(e.subtype){case"Inviting":return"Inviting ".concat(rF(e.names,e.count));default:return rF(e.names,e.count)}case gl.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}calculateRoomName(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n){var r=this.currentState.getStateEvents(ee.RoomName,"");if(r!=null&&r.getContent().name)return this.roomNameGenerator({type:gl.Actual,name:r.getContent().name})}var i=this.getCanonicalAlias();if(i)return this.roomNameGenerator({type:gl.Actual,name:i});var s=this.currentState.getJoinedMemberCount(),o=this.currentState.getInvitedMemberCount(),a=s+o-1,l=this.getFunctionalMembers(),c=[];if(this.heroes)this.heroes.forEach(b=>{if(l.includes(b.userId)){a--;return}if(b.displayName)c.push(b.displayName);else{var w=this.getMember(b.userId);c.push(w?w.name:b.userId)}});else{var u=this.currentState.getMembers().filter(b=>b.userId!==e&&(b.membership===qe.Invite||b.membership===qe.Join));u=u.filter(b=>{var{userId:w}=b;return l.includes(w)?(a--,!1):!0});var f=new Intl.Collator;u.sort((b,w)=>f.compare(b.userId,w.userId)),u=u.slice(0,5),c=u.map(b=>b.name)}if(a)return this.roomNameGenerator({type:gl.Generated,names:c,count:a});var p=this.getMyMembership();if(p==qe.Join){var m=this.currentState.getStateEvents(ee.RoomThirdPartyInvite);if(m!=null&&m.length){var v=m.map(b=>b.getContent().display_name);return this.roomNameGenerator({type:gl.Generated,subtype:"Inviting",names:v,count:v.length+1})}}var g=c;g.length||(g=this.currentState.getMembers().filter(b=>b.userId!==e&&b.membership!==qe.Invite&&b.membership!==qe.Join).map(b=>b.name));var S;return g.length&&(S=this.roomNameGenerator({type:gl.Generated,names:g,count:g.length+1})),this.roomNameGenerator({type:gl.EmptyRoom,oldName:S})}applyNewVisibilityEvent(e){var n=e.asVisibilityChange();if(n){var r=e.getSender();if(r){var i=th.name&&this.currentState.maySendStateEvent(th.name,r)||th.altName&&this.currentState.maySendStateEvent(th.altName,r);if(i){var s=this.visibilityEvents.get(n.eventId);if(s){for(var o=s.length-1,a=Math.max(0,s.length-Xhe);o>=a;--o){var l=s[o];if(l.getTs()<e.getTs())break}o===-1?s.unshift(e):s.splice(o+1,0,e)}else this.visibilityEvents.set(n.eventId,[e]);var c=this.findEventById(n.eventId);c&&c.applyVisibilityEvent(n)}}}}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var n=e.getRelation(),r=n==null?void 0:n.event_id,i=this.visibilityEvents.get(r);if(i){var s=i.findIndex(c=>c.getId()===e.getId());if(s!==-1&&(i.splice(s,1),s===i.length)){var o=this.findEventById(r);if(!o)return;if(s===0)this.visibilityEvents.delete(r),o.applyVisibilityEvent();else{var a=i[i.length-1],l=a.asVisibilityChange();if(!l)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(l)}}}}applyPendingVisibilityEvents(e){var n=this.visibilityEvents.get(e.getId());if(!(!n||n.length==0)){var r=n[n.length-1],i=r.asVisibilityChange();i&&(i.visible,!(r.getTs()<e.getTs())&&e.applyVisibilityEvent(i))}}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,n){return this.roomReceipts.hasUserReadEvent(e,n)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);var n=this.getThreads().filter(i=>this.getThreadUnreadNotificationCount(i.id,Kt.Total)>0);for(var r of n)r.fixupNotifications(e)}compareEventOrdering(e,n){return Lhe(this,e,n)}hasEncryptionStateEvent(){var e;return!!(!((e=this.getLiveTimeline().getState(Le.FORWARDS))===null||e===void 0)&&e.getStateEvents(ee.RoomEncryption,""))}};var Jhe={[at.ENCRYPTING]:[at.SENDING,at.NOT_SENT,at.CANCELLED],[at.SENDING]:[at.ENCRYPTING,at.QUEUED,at.NOT_SENT,at.SENT],[at.QUEUED]:[at.SENDING,at.NOT_SENT,at.CANCELLED],[at.SENT]:[],[at.NOT_SENT]:[at.SENDING,at.QUEUED,at.CANCELLED],[at.CANCELLED]:[]},gl=function(t){return t[t.EmptyRoom=0]="EmptyRoom",t[t.Generated=1]="Generated",t[t.Actual=2]="Actual",t}({});function rF(t,e){var n=e-1;if(t.length){if(t.length===1&&n<=1)return t[0];if(t.length===2&&n<=2)return"".concat(t[0]," and ").concat(t[1]);var r=n>1;return r?"".concat(t[0]," and ").concat(n," others"):"".concat(t[0]," and 1 other")}else return"Empty room"}var qr=function(t){return t[t.Stable=0]="Stable",t[t.Unstable=1]="Unstable",t[t.Unsupported=2]="Unsupported",t}({}),Kr=function(t){return t.Thread="Thread",t.ThreadUnreadNotifications="ThreadUnreadNotifications",t.LoginTokenRequest="LoginTokenRequest",t.RelationBasedRedactions="RelationBasedRedactions",t.AccountDataDeletion="AccountDataDeletion",t.RelationsRecursion="RelationsRecursion",t.IntentionalMentions="IntentionalMentions",t}({}),Zhe={[Kr.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[Kr.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[Kr.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[Kr.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[Kr.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]},[Kr.RelationsRecursion]:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},[Kr.IntentionalMentions]:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};function Qhe(t){return Q6.apply(this,arguments)}function Q6(){return Q6=U(function*(t){var e=new Map;for(var[n,r]of Object.entries(Zhe)){var i,s,o,a,l=(i=(s=t.versions)===null||s===void 0?void 0:s.includes(r.matrixVersion||""))!==null&&i!==void 0?i:!1,c=(o=(a=r.unstablePrefixes)===null||a===void 0?void 0:a.every(u=>{var f;return((f=t.unstable_features)===null||f===void 0?void 0:f[u])===!0}))!==null&&o!==void 0?o:!1;l?e.set(n,qr.Stable):c?e.set(n,qr.Unstable):e.set(n,qr.Unsupported)}return e}),Q6.apply(this,arguments)}function iF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function HE(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var sF=80*1e3,epe=3,qt=function(t){return t.Error="ERROR",t.Prepared="PREPARED",t.Stopped="STOPPED",t.Syncing="SYNCING",t.Catchup="CATCHUP",t.Reconnecting="RECONNECTING",t}({}),tpe=["org.matrix.msc2716v3"];function oF(t,e){return"FILTER_SYNC_".concat(t)+(e?"_"+e:"")}function Bn(){O.log(...arguments)}var AW=function(t){return t.Offline="offline",t.Online="online",t.Unavailable="unavailable",t}({});function OW(t){return HE({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:30*1e3,pendingEventOrdering:cg.Chronological,threadSupport:!1},t)}function MW(t){return HE({canResetEntireTimeline:e=>!1},t)}class hd{constructor(e,n,r){var i=this;this.client=e,L(this,"opts",void 0),L(this,"syncOpts",void 0),L(this,"_peekRoom",null),L(this,"currentSyncRequest",void 0),L(this,"abortController",void 0),L(this,"syncState",null),L(this,"syncStateData",void 0),L(this,"catchingUp",!1),L(this,"running",!1),L(this,"keepAliveTimer",void 0),L(this,"connectionReturnedResolvers",void 0),L(this,"notifEvents",[]),L(this,"failedSyncCount",0),L(this,"storeIsInvalid",!1),L(this,"presence",void 0),L(this,"getPushRules",U(function*(){try{Bn("Getting push rules...");var s=yield i.client.getPushRules();Bn("Got push rules"),i.client.pushRules=s}catch(o){return O.error("Getting push rules failed",o),i.shouldAbortSync(o)?void 0:(Bn("Waiting for saved sync before retrying push rules..."),yield i.recoverFromSyncStartupError(i.savedSyncPromise,o),i.getPushRules())}})),L(this,"buildDefaultFilter",()=>{var s=new Es(this.client.credentials.userId);return this.client.canSupport.get(Kr.ThreadUnreadNotifications)!==qr.Unsupported&&s.setUnreadThreadNotifications(!0),s}),L(this,"prepareLazyLoadingForSync",U(function*(){Bn("Prepare lazy loading for sync..."),i.client.isGuest()&&(i.opts.lazyLoadMembers=!1),i.opts.lazyLoadMembers&&(Bn("Enabling lazy load on sync filter..."),i.opts.filter||(i.opts.filter=i.buildDefaultFilter()),i.opts.filter.setLazyLoadMembers(!0))})),L(this,"storeClientOptions",U(function*(){try{Bn("Storing client options..."),yield i.client.storeClientOptions(),Bn("Stored client options")}catch(s){throw O.error("Storing client options failed",s),s}})),L(this,"getFilter",U(function*(){Bn("Getting filter...");var s;i.opts.filter?s=i.opts.filter:s=i.buildDefaultFilter();var o;try{o=yield i.client.getOrCreateFilter(oF(i.client.credentials.userId),s)}catch(a){return O.error("Getting filter failed",a),i.shouldAbortSync(a)?{}:(Bn("Waiting for saved sync before retrying filter..."),yield i.recoverFromSyncStartupError(i.savedSyncPromise,a),i.getFilter())}return{filter:s,filterId:o}})),L(this,"savedSyncPromise",void 0),L(this,"onOnline",()=>{Bn("Browser thinks we are back online"),this.startKeepAlives(0)}),this.opts=OW(n),this.syncOpts=MW(r),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[xe.Timeline,xe.TimelineReset])}createRoom(e){var n=NW(this.client,e,this.opts);return n.on(gt.Marker,(r,i)=>{this.onMarkerStateEvent(n,r,i)}),n}onMarkerStateEvent(e,n){var{timelineWasEmpty:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r){O.debug("MarkerState: Ignoring markerEventId=".concat(n.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh.");return}var i=tpe.includes(e.getVersion())||n.getSender()===e.getCreator();i?(O.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(n.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(xe.HistoryImportedWithinTimeline,n,e)):O.debug("MarkerState: Ignoring markerEventId=".concat(n.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}syncLeftRooms(){var e=this;return U(function*(){var n,r=e.client,i=new Es(e.client.credentials.userId);i.setTimelineLimit(1),i.setIncludeLeaveRooms(!0);var s=e.opts.pollTimeout+sF,o=yield r.getOrCreateFilter(oF(r.credentials.userId,"LEFT_ROOMS"),i),a={timeout:0,filter:o,"org.matrix.msc4222.use_state_after":!0},l=yield r.http.authedRequest(le.Get,"/sync",a,void 0,{localTimeoutMs:s}),c=[];(n=l.rooms)!==null&&n!==void 0&&n.leave&&(c=e.mapSyncResponseToRoomArray(l.rooms.leave));var u=yield Promise.all(c.map(function(){var f=U(function*(p){var m=p.room;if(p.isBrandNewRoom){p.timeline=p.timeline||{prev_batch:null,events:[]},m.getLiveTimeline().setPaginationToken(p.timeline.prev_batch,Le.BACKWARDS);var{timelineEvents:v}=yield e.mapAndInjectRoomEvents(p);return m.recalculate(),r.store.storeRoom(m),r.emit(Ae.Room,m),e.processEventsForNotifs(m,v),m}});return function(p){return f.apply(this,arguments)}}()));return u.filter(Boolean)})()}peek(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;if(((n=this._peekRoom)===null||n===void 0?void 0:n.roomId)===e)return Promise.resolve(this._peekRoom);var i=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,r).then(s=>{var o;if(((o=this._peekRoom)===null||o===void 0?void 0:o.roomId)!==e)throw new Error("Peeking aborted");s.messages=s.messages||{chunk:[]},s.messages.chunk=s.messages.chunk||[],s.state=s.state||[];var a=Zy(s.state).map(i.getEventMapper()),l=s.state.map(i.getEventMapper()),c=s.messages.chunk.map(i.getEventMapper());return Array.isArray(s.presence)&&s.presence.map(i.getEventMapper()).forEach(function(u){var f=i.store.getUser(u.getContent().user_id);f?f.setPresenceEvent(u):(f=Hc.createUser(u.getContent().user_id,i),f.setPresenceEvent(u),i.store.storeUser(f)),i.emit(Ae.Event,u)}),s.messages.start&&(this._peekRoom.oldState.paginationToken=s.messages.start),this._peekRoom.oldState.setStateEvents(a),this._peekRoom.currentState.setStateEvents(l),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(c.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),s.messages.start),i.store.storeRoom(this._peekRoom),i.emit(Ae.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(e,n){var r,i=this;if(this._peekRoom!==e){Bn("Stopped peeking in room %s",e.roomId);return}this.client.http.authedRequest(le.Get,"/events",{room_id:e.roomId,timeout:String(30*1e3),from:n},void 0,{localTimeoutMs:50*1e3,abortSignal:(r=this.abortController)===null||r===void 0?void 0:r.signal}).then(function(){var s=U(function*(o){if(i._peekRoom!==e){Bn("Stopped peeking in room %s",e.roomId);return}o.chunk.filter(function(l){return l.type==="m.presence"}).map(i.client.getEventMapper()).forEach(l=>{var c=i.client.store.getUser(l.getContent().user_id);c?c.setPresenceEvent(l):(c=Hc.createUser(l.getContent().user_id,i.client),c.setPresenceEvent(l),i.client.store.storeUser(c)),i.client.emit(Ae.Event,l)});var a=o.chunk.filter(function(l){return l.room_id===e.roomId&&l.event_id}).map(i.client.getEventMapper());yield e.addLiveEvents(a,{addToState:!0}),i.peekPoll(e,o.end)});return function(o){return s.apply(this,arguments)}}(),s=>{O.error("[%s] Peek poll failed: %s",e.roomId,s),setTimeout(()=>{this.peekPoll(e,n)},30*1e3)})}getSyncState(){return this.syncState}getSyncStateData(){var e;return(e=this.syncStateData)!==null&&e!==void 0?e:null}recoverFromSyncStartupError(e,n){var r=this;return U(function*(){yield e;var i=r.startKeepAlives();r.updateSyncState(qt.Error,{error:n}),yield i})()}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(O.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(qt.Error,{error:e}),!0):!1}sync(){var e=this;return U(function*(){var n,r;if(e.running=!0,e.abortController=new AbortController,(n=globalThis.window)===null||n===void 0||(r=n.addEventListener)===null||r===void 0||r.call(n,"online",e.onOnline,!1),e.client.isGuest())return e.doSync({});Bn("Getting saved sync token...");var i=e.client.store.getSavedSyncToken().then(u=>(Bn("Got saved sync token"),u));e.savedSyncPromise=e.client.store.getSavedSync().then(u=>{if(Bn("Got reply from saved sync, exists? ".concat(!!u)),u)return e.syncFromCache(u)}).catch(u=>{O.error("Getting saved sync failed",u)}),yield e.getPushRules(),yield e.prepareLazyLoadingForSync(),yield e.storeClientOptions();var{filterId:s,filter:o}=yield e.getFilter();if(o){if(e.client.resetNotifTimelineSet(),!e.currentSyncRequest){var a=s,l=yield i;if(l)Bn("Sending first sync request...");else{Bn("Sending initial sync request...");var c=e.buildDefaultFilter();c.setDefinition(o.getDefinition()),c.setTimelineLimit(e.opts.initialSyncLimit),a=JSON.stringify(c.getDefinition())}e.currentSyncRequest=e.doSyncRequest({filter:a},l)}return Bn("Waiting for saved sync before starting sync processing..."),yield e.savedSyncPromise,e.doSync({filter:s})}})()}stop(){var e,n,r;Bn("SyncApi.stop"),(e=globalThis.window)===null||e===void 0||(n=e.removeEventListener)===null||n===void 0||n.call(e,"online",this.onOnline,!1),this.running=!1,(r=this.abortController)===null||r===void 0||r.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return this.connectionReturnedResolvers?(this.startKeepAlives(0),!0):!1}syncFromCache(e){var n=this;return U(function*(){Bn("sync(): not doing HTTP hit, instead returning stored /sync data");var r=e.nextBatch;n.client.store.setSyncToken(r);var i={nextSyncToken:r,catchingUp:!1,fromCache:!0},s={next_batch:r,rooms:e.roomsData,account_data:{events:e.accountData}};try{yield n.processSyncResponse(i,s)}catch(o){O.error("Error processing cached sync",o)}n.storeIsInvalid||n.updateSyncState(qt.Prepared,i)})()}doSync(e){var n=this;return U(function*(){for(;n.running;){var r=n.client.store.getSyncToken(),i=void 0;try{n.currentSyncRequest||(n.currentSyncRequest=n.doSyncRequest(e,r)),i=yield n.currentSyncRequest}catch(a){var s=yield n.onSyncError(a);if(s)return;continue}finally{n.currentSyncRequest=void 0}n.client.store.setSyncToken(i.next_batch),n.failedSyncCount=0;var o={oldSyncToken:r??void 0,nextSyncToken:i.next_batch,catchingUp:n.catchingUp};try{yield n.processSyncResponse(o,i)}catch(a){O.error("Caught /sync error",a),n.client.emit(Ae.SyncUnexpectedError,a)}yield n.client.store.setSyncData(i),o.catchingUp=n.catchingUp,e.hasSyncedBefore||(n.updateSyncState(qt.Prepared,o),e.hasSyncedBefore=!0),n.syncOpts.cryptoCallbacks&&(yield n.syncOpts.cryptoCallbacks.onSyncCompleted(o)),n.updateSyncState(qt.Syncing,o),n.client.store.wantsSave()&&(yield n.client.store.save())}n.running||(Bn("Sync no longer running: exiting."),n.connectionReturnedResolvers&&(n.connectionReturnedResolvers.reject(),n.connectionReturnedResolvers=void 0),n.updateSyncState(qt.Stopped))})()}doSyncRequest(e,n){var r,i=this.getSyncParams(e,n);return this.client.http.authedRequest(le.Get,"/sync",i,void 0,{localTimeoutMs:i.timeout+sF,abortSignal:(r=this.abortController)===null||r===void 0?void 0:r.signal})}getSyncParams(e,n){var r=this.opts.pollTimeout;(this.getSyncState()!==qt.Syncing||this.catchingUp)&&(this.catchingUp=!0,r=0);var i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());var s={filter:i,timeout:r,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?s.set_presence=AW.Offline:this.presence!==void 0&&(s.set_presence=this.presence),n?s.since=n:s._cacheBuster=Date.now(),[qt.Reconnecting,qt.Error].includes(this.getSyncState())&&(s.timeout=0),s}setPresence(e){this.presence=e}onSyncError(e){var n=this;return U(function*(){if(!n.running)return Bn("Sync no longer running: exiting"),n.connectionReturnedResolvers&&(n.connectionReturnedResolvers.reject(),n.connectionReturnedResolvers=void 0),n.updateSyncState(qt.Stopped),!0;if(O.error("/sync error %s",e),n.shouldAbortSync(e))return!0;n.failedSyncCount++,O.log("Number of consecutive failed sync requests:",n.failedSyncCount),Bn("Starting keep-alive");var r=n.startKeepAlives();n.currentSyncRequest=void 0,n.updateSyncState(n.failedSyncCount>=epe?qt.Error:qt.Reconnecting,{error:e});var i=yield r;return i&&n.getSyncState()===qt.Error&&n.updateSyncState(qt.Catchup,{catchingUp:!0}),!1})()}processSyncResponse(e,n){var r=this;return U(function*(){var i,s,o,a,l=r.client;if(Array.isArray((i=n.presence)===null||i===void 0?void 0:i.events)&&n.presence.events.filter(La).map(l.getEventMapper()).forEach(function(b){var w=l.store.getUser(b.getSender());w?w.setPresenceEvent(b):(w=Hc.createUser(b.getSender(),l),w.setPresenceEvent(b),l.store.storeUser(w)),l.emit(Ae.Event,b)}),Array.isArray((s=n.account_data)===null||s===void 0?void 0:s.events)){var c=n.account_data.events.filter(La).map(l.getEventMapper()),u=c.reduce((b,w)=>(b[w.getType()]=l.store.getAccountData(w.getType()),b),{});l.store.storeAccountDataEvents(c),c.forEach(function(b){if(b.getType()===ee.PushRules){var w=b.getContent();l.setPushRules(w)}var k=u[b.getType()];return l.emit(Ae.AccountData,b,k),b})}if(n.to_device&&Array.isArray(n.to_device.events)&&n.to_device.events.length>0){var f=n.to_device.events.filter(La);r.syncOpts.cryptoCallbacks&&(f=yield r.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(f));var p=[];f.map(DW).map(b=>{if(b.getType()==="m.key.verification.cancel"){var w=b.getContent().transaction_id;w&&p.push(w)}return b}).forEach(function(b){var w=b.getContent();if(b.getType()=="m.room.message"&&w.msgtype=="m.bad.encrypted"){O.log("Ignoring undecryptable to-device event from "+b.getSender());return}if(b.getType()==="m.key.verification.start"||b.getType()==="m.key.verification.request"){var k=w.transaction_id;p.includes(k)&&b.flagCancelled()}l.emit(Ae.ToDeviceEvent,b)})}else r.catchingUp=!1;var m=[],v=[],g=[],S=[];n.rooms&&(n.rooms.invite&&(m=r.mapSyncResponseToRoomArray(n.rooms.invite)),n.rooms.join&&(v=r.mapSyncResponseToRoomArray(n.rooms.join)),n.rooms.leave&&(g=r.mapSyncResponseToRoomArray(n.rooms.leave)),n.rooms.knock&&(S=r.mapSyncResponseToRoomArray(n.rooms.knock))),r.notifEvents=[],yield dm(m,function(){var b=U(function*(w){var k=w.room,T=r.mapSyncEventsFormat(w.invite_state,k);yield r.injectRoomEvents(k,T,void 0),w.isBrandNewRoom?(k.recalculate(),l.store.storeRoom(k),l.emit(Ae.Room,k)):k.recalculate(),T.forEach(function(I){l.emit(Ae.Event,I)})});return function(w){return b.apply(this,arguments)}}()),yield dm(v,function(){var b=U(function*(w){var k,T=w.room,I=r.mapSyncEventsFormat(w.state,T),C=r.mapSyncEventsFormat(w["org.matrix.msc4222.state_after"],T),x=r.mapSyncEventsFormat(w.timeline,T,!1),A=r.mapSyncEventsFormat(w.ephemeral),N=r.mapSyncEventsFormat(w.account_data),D=w["org.matrix.msc4222.state_after"]?C:I.concat(x),F=r.isRoomEncrypted(T,D);if(w.unread_notifications){if(!F||w.unread_notifications.notification_count===0){var $;T.setUnreadNotificationCount(Kt.Total,($=w.unread_notifications.notification_count)!==null&&$!==void 0?$:0)}if(!F||T.getUnreadNotificationCount(Kt.Highlight)<=0){var B;T.setUnreadNotificationCount(Kt.Highlight,(B=w.unread_notifications.highlight_count)!==null&&B!==void 0?B:0)}}var W=(k=w[J1.name])!==null&&k!==void 0?k:w[J1.altName];if(W){T.resetThreadUnreadNotificationCountFromSync(Object.keys(W));for(var[H,z]of Object.entries(W)){if(!F||z.notification_count===0){var K;T.setThreadUnreadNotificationCount(H,Kt.Total,(K=z.notification_count)!==null&&K!==void 0?K:0)}var V=T.getThreadUnreadNotificationCount(H,Kt.Highlight)<=0;if(!F||F&&V){var q;T.setThreadUnreadNotificationCount(H,Kt.Highlight,(q=z.highlight_count)!==null&&q!==void 0?q:0)}}}else T.resetThreadUnreadNotificationCountFromSync();if(w.timeline=w.timeline||{},w.isBrandNewRoom)w.timeline.prev_batch!==null&&T.getLiveTimeline().setPaginationToken(w.timeline.prev_batch,Le.BACKWARDS);else if(w.timeline.limited){for(var Z=!0,G=x.length-1;G>=0;G--){var Q=x[G].getId();if(T.getTimelineForEvent(Q)){Bn("Already have event ".concat(Q," in limited sync - not resetting")),Z=!1,x.splice(0,G);break}}if(Z){var ge;T.resetLiveTimeline(w.timeline.prev_batch,r.syncOpts.canResetEntireTimeline(T.roomId)?null:(ge=e.oldSyncToken)!==null&&ge!==void 0?ge:null),l.resetNotifTimelineSet()}}if(r.syncOpts.cryptoCallbacks)for(var _e of D)_e.isState()&&_e.getType()===ee.RoomEncryption&&_e.getStateKey()===""&&(yield r.syncOpts.cryptoCallbacks.onCryptoEvent(T,_e));try{"org.matrix.msc4222.state_after"in w?yield r.injectRoomEvents(T,void 0,C,x,e.fromCache):yield r.injectRoomEvents(T,I,void 0,x,e.fromCache)}catch(Te){O.error("Failed to process events on room ".concat(T.roomId,":"),Te)}w.summary&&T.setSummary(w.summary),T.addEphemeralEvents(A),T.addAccountData(N),T.recalculate(),w.isBrandNewRoom&&(l.store.storeRoom(T),l.emit(Ae.Room,T)),r.processEventsForNotifs(T,x);var Pe=Te=>l.emit(Ae.Event,Te);I.forEach(Pe),x.forEach(Pe),A.forEach(Pe),N.forEach(Pe),T.decryptCriticalEvents()});return function(w){return b.apply(this,arguments)}}()),yield dm(g,function(){var b=U(function*(w){var k=w.room,{timelineEvents:T,stateEvents:I,stateAfterEvents:C}=yield r.mapAndInjectRoomEvents(w),x=r.mapSyncEventsFormat(w.account_data);k.addAccountData(x),k.recalculate(),w.isBrandNewRoom&&(l.store.storeRoom(k),l.emit(Ae.Room,k)),r.processEventsForNotifs(k,T),I==null||I.forEach(function(A){l.emit(Ae.Event,A)}),C==null||C.forEach(function(A){l.emit(Ae.Event,A)}),T.forEach(function(A){l.emit(Ae.Event,A)}),x.forEach(function(A){l.emit(Ae.Event,A)})});return function(w){return b.apply(this,arguments)}}()),yield dm(S,function(){var b=U(function*(w){var k=w.room,T=r.mapSyncEventsFormat(w.knock_state,k);yield r.injectRoomEvents(k,T,void 0),w.isBrandNewRoom?(k.recalculate(),l.store.storeRoom(k),l.emit(Ae.Room,k)):k.recalculate(),T.forEach(function(I){l.emit(Ae.Event,I)})});return function(w){return b.apply(this,arguments)}}()),e.oldSyncToken&&r.notifEvents.length&&(r.notifEvents.sort(function(b,w){return b.getTs()-w.getTs()}),r.notifEvents.forEach(function(b){var w;(w=l.getNotifTimelineSet())===null||w===void 0||w.addLiveEvent(b,{addToState:!0})})),n.device_lists&&r.syncOpts.cryptoCallbacks&&(yield r.syncOpts.cryptoCallbacks.processDeviceLists(n.device_lists)),yield(o=r.syncOpts.cryptoCallbacks)===null||o===void 0?void 0:o.processKeyCounts(n.device_one_time_keys_count,(a=n.device_unused_fallback_key_types)!==null&&a!==void 0?a:n["org.matrix.msc2732.device_unused_fallback_key_types"])})()}startKeepAlives(e){return e===void 0&&(e=2e3+Math.floor(Math.random()*5e3)),this.keepAliveTimer!==null&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedResolvers||(this.connectionReturnedResolvers=Promise.withResolvers()),this.connectionReturnedResolvers.promise}pokeKeepAlive(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.running){clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.reject("SyncApi.stop() was called"),this.connectionReturnedResolvers=void 0);return}var r=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.resolve(n),this.connectionReturnedResolvers=void 0)};this.client.http.request(le.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15*1e3,abortSignal:(e=this.abortController)===null||e===void 0?void 0:e.signal}).then(()=>{r()},i=>{i.httpStatus==400||i.httpStatus==404?this.keepAliveTimer=setTimeout(r,2e3):(n=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,n),5e3+Math.floor(Math.random()*5e3)),this.updateSyncState(qt.Error,{error:i}))})}mapSyncResponseToRoomArray(e){var n=this.client;return Object.keys(e).filter(r=>!d1(r)).map(r=>{var i=n.store.getRoom(r),s=!1;return i||(i=this.createRoom(r),s=!0),HE(HE({},e[r]),{},{room:i,isBrandNewRoom:s})})}mapSyncEventsFormat(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!Array.isArray(e.events))return[];var i=this.client.getEventMapper({decrypt:r});return e.events.filter(La).map(function(s){return n&&(s.room_id=n.roomId),i(s)})}resolveInvites(e){if(!(!e||!this.opts.resolveInvitesToProfiles)){var n=this.client;e.getMembersWithMembership(qe.Invite).forEach(function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var i=n.getUser(r.userId),s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){var a=r.events.member;(a==null?void 0:a.getContent().membership)===qe.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})}})}}findEncryptionEvent(e){return e==null?void 0:e.find(n=>n.getType()===ee.RoomEncryption&&n.getStateKey()==="")}isRoomEncrypted(e,n){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(n)}mapAndInjectRoomEvents(e){var n=this;return U(function*(){var r=n.mapSyncEventsFormat(e.state,e.room),i=n.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),s=n.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?yield n.injectRoomEvents(e.room,void 0,i,s):yield n.injectRoomEvents(e.room,r,void 0,s),{timelineEvents:s,stateEvents:r,stateAfterEvents:i}})()}injectRoomEvents(e,n,r,i){var s=arguments,o=this;return U(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:!1,l=r??n,c=e.getLiveTimeline(),u=c.getEvents().length==0;if(u){for(var f of l)o.client.getPushActionsForEvent(f);c.initialiseState(l,{timelineWasEmpty:u})}o.resolveInvites(e),e.recalculate(),u||(e.oldState.setStateEvents(l),e.currentState.setStateEvents(l)),yield e.addLiveEvents(i||[],{fromCache:a,timelineWasEmpty:u,addToState:r===void 0}),o.client.processBeaconEvents(e,i)})()}processEventsForNotifs(e,n){if(this.client.getNotifTimelineSet())for(var r of n){var i,s=this.client.getPushActionsForEvent(r);s!=null&&s.notify&&(i=s.tweaks)!==null&&i!==void 0&&i.highlight&&this.notifEvents.push(r)}}getGuestFilter(){return"{}"}updateSyncState(e,n){var r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(Ae.Sync,this.syncState,r,n)}}function NW(t,e,n){var{timelineSupport:r}=t,i=new IC(e,t,t.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return t.reEmitter.reEmit(i,[xe.Name,xe.Redaction,xe.RedactionCancelled,xe.Receipt,xe.Tags,xe.LocalEchoUpdated,xe.AccountData,xe.MyMembership,xe.Timeline,xe.TimelineReset,gt.Events,gt.Members,gt.NewMember,gt.Update,Mn.New,Mn.Update,Mn.Destroy,Mn.LivenessChange]),i.on(gt.NewMember,(s,o,a)=>{var l;a.user=(l=t.getUser(a.userId))!==null&&l!==void 0?l:void 0,t.reEmitter.reEmit(a,[Is.Name,Is.Typing,Is.PowerLevel,Is.Membership])}),i}function DW(t){return delete t.room_id,new Bi(t)}class npe{constructor(){L(this,"accountData",new Map),L(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,n){return[]}setUserCreator(e){}storeEvents(e,n,r,i){}storeFilter(e){}getFilter(e,n){return null}getFilterIdByName(e){return null}setFilterIdByName(e,n){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,n){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}getPendingEvents(e){return U(function*(){return[]})()}setPendingEvents(e,n){return Promise.resolve()}saveToDeviceBatches(e){return U(function*(){return Promise.resolve()})()}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(e){return U(function*(){return Promise.resolve()})()}destroy(){return U(function*(){})()}}const _i=[];for(let t=0;t<256;++t)_i.push((t+256).toString(16).slice(1));function rpe(t,e=0){return(_i[t[e+0]]+_i[t[e+1]]+_i[t[e+2]]+_i[t[e+3]]+"-"+_i[t[e+4]]+_i[t[e+5]]+"-"+_i[t[e+6]]+_i[t[e+7]]+"-"+_i[t[e+8]]+_i[t[e+9]]+"-"+_i[t[e+10]]+_i[t[e+11]]+_i[t[e+12]]+_i[t[e+13]]+_i[t[e+14]]+_i[t[e+15]]).toLowerCase()}let TI;const ipe=new Uint8Array(16);function spe(){if(!TI){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");TI=crypto.getRandomValues.bind(crypto)}return TI(ipe)}const ope=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),aF={randomUUID:ope};function ape(t,e,n){var i;if(aF.randomUUID&&!t)return aF.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??spe();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,rpe(r)}var ba={},RI={},II={exports:{}},lF;function zL(){if(lF)return II.exports;lF=1;var t=II.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),II.exports}var cF;function lpe(){return cF||(cF=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,c,u){if(u&&!c)l[u]=e(a[1]);else for(var f=0;f<c.length;f+=1)a[f+1]!=null&&(l[c[f]]=e(a[f+1]))},r=function(a,l,c){var u=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:u&&!l[a.name]&&(l[a.name]={});var f=a.push?{}:u?l[a.name]:l;n(c.match(a.reg),f,a.names,a.name),a.push&&l[a.push].push(f)},i=zL(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},c=[],u=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(f){var p=f[0],m=f.slice(2);p==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(i[p]||[]).length;v+=1){var g=i[p][v];if(g.reg.test(m))return r(g,u,m)}}),l.media=c,l};var o=function(a,l){var c=l.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&l.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],c=a.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(c){var u,f=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),f=!0),{scid:u,paused:f}})})}}(RI)),RI}var kI,uF;function cpe(){if(uF)return kI;uF=1;var t=zL(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,c=l.length;return o.replace(e,function(u){if(a>=c)return u;var f=l[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},r=function(o,a,l){var c=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,u=[o+"="+c];if(a.names)for(var f=0;f<a.names.length;f+=1){var p=a.names[f];a.name?u.push(l[a.name][p]):u.push(l[a.names[f]])}else u.push(l[a.name]);return n.apply(null,u)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return kI=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var l=a.outerOrder||i,c=a.innerOrder||s,u=[];return l.forEach(function(f){t[f].forEach(function(p){p.name in o&&o[p.name]!=null?u.push(r(f,p,o)):p.push in o&&o[p.push]!=null&&o[p.push].forEach(function(m){u.push(r(f,p,m))})})}),o.media.forEach(function(f){u.push(r("m",t.m[0],f)),c.forEach(function(p){t[p].forEach(function(m){m.name in f&&f[m.name]!=null?u.push(r(p,m,f)):m.push in f&&f[m.push]!=null&&f[m.push].forEach(function(v){u.push(r(p,m,v))})})})}),u.join(`\r
`)+`\r
`},kI}var dF;function upe(){if(dF)return ba;dF=1;var t=lpe(),e=cpe(),n=zL();return ba.grammar=n,ba.write=e,ba.parse=t.parse,ba.parseParams=t.parseParams,ba.parseFmtpConfig=t.parseFmtpConfig,ba.parsePayloads=t.parsePayloads,ba.parseRemoteCandidates=t.parseRemoteCandidates,ba.parseImageAttributes=t.parseImageAttributes,ba.parseSimulcastStreamList=t.parseSimulcastStreamList,ba}var ex=upe();function YL(t,e){if(typeof t.toBase64=="function")return t.toBase64(e);var n=btoa(t.reduce((r,i)=>r+String.fromCharCode(i),""));return e.omitPadding&&(n=n.replace(/={1,2}$/,"")),e.alphabet==="base64url"&&(n=n.replace(/\+/g,"-").replace(/\//g,"_")),n}function E2(t){return YL(t,{alphabet:"base64",omitPadding:!1})}function FW(t){return YL(t,{alphabet:"base64",omitPadding:!0})}function kC(t){return YL(t,{alphabet:"base64url",omitPadding:!0})}function dpe(t,e){return typeof Uint8Array.fromBase64=="function"?Uint8Array.fromBase64(t,e):Uint8Array.from(atob(t),n=>n.charCodeAt(0))}function Rm(t){return dpe(t.replace(/-/g,"+").replace(/_/g,"/"),{alphabet:"base64",lastChunkHandling:"loose"})}var fpe="abcdefghijklmnopqrstuvwxyz",hpe="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ppe="0123456789";function UW(t){var e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),kC(e)}function lo(t){return mpe(t,hpe+fpe+ppe)}function mpe(t,e){if(e.length<2||e.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(t<1||t>32768)throw new Error("Requested random string length must be between 1 and 32768");for(var n=256-256%e.length,r=new Uint8Array(Math.floor(t*1.3)),i=r.length,s=[];s.length<t;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);var o=r[i++];o<n&&s.push(e[o%e.length])}return s.join("")}var Hu="org.matrix.msc3077.sdp_stream_metadata",vn=function(t){return t.Usermedia="m.usermedia",t.Screenshare="m.screenshare",t}({}),h1=null,tx=0,gpe=()=>(h1===null&&(h1=new AudioContext),tx++,h1),vpe=()=>{if(tx--,tx===0){var t;(t=h1)===null||t===void 0||t.close(),h1=null}},ype=200,nx=-60,_pe=8,vl=function(t){return t.NewStream="new_stream",t.MuteStateChanged="mute_state_changed",t.LocalVolumeChanged="local_volume_changed",t.VolumeChanged="volume_changed",t.ConnectedChanged="connected_changed",t.Speaking="speaking",t.Disposed="disposed",t}({});class Lc extends Un{constructor(e){super(),L(this,"stream",void 0),L(this,"sdpMetadataStreamId",void 0),L(this,"userId",void 0),L(this,"deviceId",void 0),L(this,"purpose",void 0),L(this,"speakingVolumeSamples",void 0),L(this,"client",void 0),L(this,"call",void 0),L(this,"roomId",void 0),L(this,"audioMuted",void 0),L(this,"videoMuted",void 0),L(this,"localVolume",1),L(this,"measuringVolumeActivity",!1),L(this,"audioContext",void 0),L(this,"analyser",void 0),L(this,"frequencyBinCount",void 0),L(this,"speakingThreshold",nx),L(this,"speaking",!1),L(this,"volumeLooperTimeout",void 0),L(this,"_disposed",!1),L(this,"_connected",!1),L(this,"onAddTrack",()=>{this.emit(vl.NewStream,this.stream)}),L(this,"onCallState",n=>{n===ut.Connected?this.connected=!0:n===ut.Connecting&&(this.connected=!1)}),L(this,"volumeLooper",()=>{if(this.analyser&&this.measuringVolumeActivity){this.analyser.getFloatFrequencyData(this.frequencyBinCount);var n=-1/0;for(var r of this.frequencyBinCount)r>n&&(n=r);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(n),this.emit(vl.VolumeChanged,n);var i=!1;for(var s of this.speakingVolumeSamples)if(s>this.speakingThreshold){i=!0;break}this.speaking!==i&&(this.speaking=i,this.emit(vl.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,ype)}}),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(_pe).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(yt.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(vl.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,n){if(n!==e){var r=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=n,n.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),r&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit(vl.NewStream,this.stream)}}initVolumeMeasuring(){if(this.hasAudioTrack){this.audioContext||(this.audioContext=gpe()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1;var e=this.audioContext.createMediaStreamSource(this.stream);e.connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount)}}getMember(){var e,n=this.client.getRoom(this.roomId);return(e=n==null?void 0:n.getMember(this.userId))!==null&&e!==void 0?e:null}isLocal(){return this.userId===this.client.getUserId()&&(this.deviceId===void 0||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return this.stream.getAudioTracks().length===0||this.audioMuted}isVideoMuted(){return this.stream.getVideoTracks().length===0||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,n){e!==null&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),n!==null&&(this.videoMuted=n),this.emit(vl.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(vl.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){var e=this.client.getMediaHandler(),n=this.stream.clone();return O.log("CallFeed clone() cloning stream (originalStreamId=".concat(this.stream.id,", newStreamId").concat(n.id,")")),this.purpose===vn.Usermedia?e.userMediaStreams.push(n):e.screensharingStreams.push(n),new Lc({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:n,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,n;clearTimeout(this.volumeLooperTimeout),(e=this.stream)===null||e===void 0||e.removeEventListener("addtrack",this.onAddTrack),(n=this.call)===null||n===void 0||n.removeListener(yt.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,vpe()),this._disposed=!0,this.emit(vl.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(vl.LocalVolumeChanged,e)}}var bpe=3e3,rx=function(t){return t.Incoming="Call.incoming",t}({});class Spe{constructor(e){L(this,"calls",void 0),L(this,"callEventBuffer",void 0),L(this,"nextSeqByCall",new Map),L(this,"toDeviceEventBuffers",new Map),L(this,"client",void 0),L(this,"candidateEventsByCall",void 0),L(this,"eventBufferPromiseChain",void 0),L(this,"onSync",()=>{var n=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(n)):this.eventBufferPromiseChain=this.evaluateEventBuffer(n)}),L(this,"onRoomTimeline",n=>{this.callEventBuffer.push(n)}),L(this,"onToDeviceEvent",n=>{var r=n.getContent();if(!r.call_id){this.callEventBuffer.push(n);return}if(this.nextSeqByCall.has(r.call_id)||this.nextSeqByCall.set(r.call_id,0),r.seq===void 0){this.callEventBuffer.push(n);return}var i=this.nextSeqByCall.get(r.call_id)||0;if(r.seq!==i){this.toDeviceEventBuffers.has(r.call_id)||this.toDeviceEventBuffers.set(r.call_id,[]);var s=this.toDeviceEventBuffers.get(r.call_id),o=s.findIndex(u=>u.getContent().seq>r.seq);o===-1?s.push(n):s.splice(o,0,n)}else{var a=r.call_id;this.callEventBuffer.push(n),this.nextSeqByCall.set(a,r.seq+1);for(var l=this.toDeviceEventBuffers.get(a),c=l&&l.shift();c&&c.getContent().seq===this.nextSeqByCall.get(a);)this.callEventBuffer.push(c),this.nextSeqByCall.set(a,c.getContent().seq+1),c=l.shift()}}),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(Ae.Sync,this.onSync),this.client.on(xe.Timeline,this.onRoomTimeline),this.client.on(Ae.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(Ae.Sync,this.onSync),this.client.removeListener(xe.Timeline,this.onRoomTimeline),this.client.removeListener(Ae.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(e){var n=this;return U(function*(){yield Promise.all(e.map(u=>n.client.decryptEventIfNeeded(u)));var r=e.filter(u=>{var f=u.getType();return f.startsWith("m.call.")||f.startsWith("org.matrix.call.")}),i=new Set;for(var s of r){var o=s.getType();(o===ee.CallAnswer||o===ee.CallHangup)&&i.add(s.getContent().call_id)}for(var a of r){var l=a.getType(),c=a.getContent().call_id;if(!(l===ee.CallInvite&&i.has(c)))try{yield n.handleCallEvent(a)}catch(u){O.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",u)}}})()}handleCallEvent(e){var n=this;return U(function*(){var r;n.client.emit(Ae.ReceivedVoipEvent,e);var i=e.getContent(),s=e.getRoomId()||((r=n.client.groupCallEventHandler.getGroupCallById(i.conf_id))===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.roomId),o=i.conf_id,a=e.getType(),l=e.getSender(),c=i.call_id?n.calls.get(i.call_id):void 0,u,f;if(o){if(f=n.client.groupCallEventHandler.getGroupCallById(o),!f){O.warn("CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=".concat(o,", type=").concat(a,")"));return}if(u=i.device_id,!u){O.warn("CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=".concat(l,")")),f.emit(gn.Error,new BW(l));return}if(i.dest_session_id!==n.client.getSessionId()){O.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring");return}}var p=l===n.client.credentials.userId&&(u===void 0||u===n.client.getDeviceId());if(s){if(a===ee.CallInvite){var m,v,g;if(p||e.getLocalAge()>i.lifetime-bpe||c&&c.state===ut.Ended||(c&&O.warn("CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=".concat(i.call_id,")")),i.invitee&&i.invitee!==n.client.getUserId()))return;var S=((m=n.client.getTurnServersExpiry())!==null&&m!==void 0?m:0)-Date.now();if(O.info("CallEventHandler handleCallEvent() current turn creds expire in "+S+" ms"),c=(v=Q1(n.client,s,{forceTURN:n.client.forceTURN,opponentDeviceId:u,groupCallId:o,opponentSessionId:i.sender_session_id}))!==null&&v!==void 0?v:void 0,!c){O.log("CallEventHandler handleCallEvent() this client does not support WebRTC (callId=".concat(i.call_id,")"));return}c.callId=i.call_id;var b=(g=f)===null||g===void 0?void 0:g.getGroupCallStats();b&&c.initStats(b);try{yield c.initWithInvite(e)}catch(N){if(N instanceof _c)if(N.code===m1.UnknownDevice){var w;(w=f)===null||w===void 0||w.emit(gn.Error,N)}else O.error(N)}if(n.calls.set(c.callId,c),n.candidateEventsByCall.get(c.callId))for(var k of n.candidateEventsByCall.get(c.callId))c.onRemoteIceCandidatesReceived(k);var T;for(var I of n.calls.values()){var C,x=[ut.WaitLocalMedia,ut.CreateOffer,ut.InviteSent].includes(I.state);if(c.roomId===I.roomId&&I.direction===Zu.Outbound&&((C=c.getOpponentMember())===null||C===void 0?void 0:C.userId)===I.invitee&&x){T=I;break}}T?T.callId>c.callId?(O.log("CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=".concat(c.callId,", outgoingId=").concat(T.callId,")")),T.replacedBy(c)):(O.log("CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=".concat(c.callId,", outgoingId=").concat(T.callId,")")),c.hangup(mt.Replaced,!0)):n.client.emit(rx.Incoming,c);return}else if(a===ee.CallCandidates){if(p)return;c?c.onRemoteIceCandidatesReceived(e):(n.candidateEventsByCall.has(i.call_id)||n.candidateEventsByCall.set(i.call_id,[]),n.candidateEventsByCall.get(i.call_id).push(e));return}else if([ee.CallHangup,ee.CallReject].includes(a)){if(c)c.state!==ut.Ended&&(a===ee.CallHangup?c.onHangupReceived(i):c.onRejectReceived(i),c.state===ut.Ended&&n.calls.delete(i.call_id));else{var A;c=(A=Q1(n.client,s,{opponentDeviceId:u,opponentSessionId:i.sender_session_id}))!==null&&A!==void 0?A:void 0,c&&(c.callId=i.call_id,c.initWithHangup(e),n.calls.set(i.call_id,c))}return}if(!c||!c.hasPeerConnection){O.info("CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=".concat(a,")"));return}if(e.getContent().party_id!==c.ourPartyId)switch(a){case ee.CallAnswer:p?c.state===ut.Ringing&&c.onAnsweredElsewhere(i):c.onAnswerReceived(e);break;case ee.CallSelectAnswer:c.onSelectAnswerReceived(e);break;case ee.CallNegotiate:c.onNegotiateReceived(e);break;case ee.CallAssertedIdentity:case ee.CallAssertedIdentityPrefix:c.onAssertedIdentityReceived(e);break;case ee.CallSDPStreamMetadataChanged:case ee.CallSDPStreamMetadataChangedPrefix:c.onSDPStreamMetadataChangedReceived(e);break}}})()}}var ix=function(t){return t.Incoming="GroupCall.incoming",t.Outgoing="GroupCall.outgoing",t.Ended="GroupCall.ended",t.Participants="GroupCall.participants",t}({});class Epe{constructor(e){this.client=e,L(this,"groupCalls",new Map),L(this,"roomDeferreds",new Map),L(this,"onRoomsChanged",n=>{this.createGroupCallForRoom(n)}),L(this,"onRoomStateChanged",(n,r)=>{var i=n.getType();if(i===ee.GroupCallPrefix){var s=n.getStateKey(),o=n.getContent(),a=this.groupCalls.get(r.roomId);!a&&!o["m.terminated"]&&!n.isRedacted()?this.createGroupCallFromRoomStateEvent(n):a&&a.groupCallId===s?o["m.terminated"]||n.isRedacted()?a.terminate(!1):o["m.type"]!==a.type&&O.warn("GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=".concat(r.roomId,")")):a&&a.groupCallId!==s&&O.warn("GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=".concat(r.roomId,")"))}})}start(){var e=this;return U(function*(){e.client.getSyncState()!==qt.Syncing&&(O.debug("GroupCallEventHandler start() waiting for client to start syncing"),yield new Promise(i=>{var s=()=>{if(e.client.getSyncState()===qt.Syncing)return e.client.off(Ae.Sync,s),i()};e.client.on(Ae.Sync,s)}));var n=e.client.getRooms();for(var r of n)e.createGroupCallForRoom(r);e.client.on(Ae.Room,e.onRoomsChanged),e.client.on(gt.Events,e.onRoomStateChanged)})()}stop(){this.client.removeListener(Ae.Room,this.onRoomsChanged),this.client.removeListener(gt.Events,this.onRoomStateChanged)}getRoomDeferred(e){var n=this.roomDeferreds.get(e);if(n===void 0){var r;n={prom:new Promise(i=>{r=i})},n.resolve=r,this.roomDeferreds.set(e,n)}return n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find(n=>n.groupCallId===e)}createGroupCallForRoom(e){var n=e.currentState.getStateEvents(ee.GroupCallPrefix),r=n.sort((o,a)=>a.getTs()-o.getTs());for(var i of r){var s=i.getContent();if(!(s["m.terminated"]||i.isRedacted())){O.debug("GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=".concat(i.getStateKey(),", ts=").concat(i.getTs(),", roomId=").concat(e.roomId,", numOfPossibleCalls=").concat(n.length,")")),this.createGroupCallFromRoomStateEvent(i);break}}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){var n=e.getRoomId(),r=e.getContent(),i=this.client.getRoom(n);if(!i){O.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=".concat(n,")"));return}var s=e.getStateKey(),o=r["m.type"];if(!Object.values(xC).includes(o)){O.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=".concat(o,", roomId=").concat(n,")"));return}var a=r["m.intent"];if(!Object.values($W).includes(a)){O.warn("Received invalid group call intent (type=".concat(o,", roomId=").concat(n,")"));return}var l=!!r["io.element.ptt"],c;if(r!=null&&r.dataChannelsEnabled&&r!==null&&r!==void 0&&r.dataChannelOptions){var{ordered:u,maxPacketLifeTime:f,maxRetransmits:p,protocol:m}=r.dataChannelOptions;c={ordered:u,maxPacketLifeTime:f,maxRetransmits:p,protocol:m}}var v=new XL(this.client,i,o,l,a,s,(r==null?void 0:r.dataChannelsEnabled)||this.client.isVoipWithNoMediaAllowed,c,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,r["io.element.livekit_service_url"]);return this.groupCalls.set(i.roomId,v),this.client.emit(ix.Incoming,v),v}}class wpe{constructor(){L(this,"bandwidth",{}),L(this,"bitrate",{}),L(this,"packetLoss",{}),L(this,"transport",[])}}class Cpe{static buildBandwidthReport(e){var n=e.availableIncomingBitrate,r=e.availableOutgoingBitrate;return{download:n?Math.round(n/1e3):0,upload:r?Math.round(r/1e3):0}}}class Tpe{static buildReport(e,n,r,i){var s=e==null?void 0:e.get(n.localCandidateId),o=e==null?void 0:e.get(n.remoteCandidateId);if(o&&s){var a=o.ip!==void 0?o.ip:o.address,l=o.port,c="".concat(a,":").concat(l),u=s.ip!==void 0?s.ip:s.address,f=s.port,p="".concat(u,":").concat(f),m=o.protocol;r.some(v=>v.ip===c&&v.type===m&&v.localIp===p)||r.push({ip:c,type:m,localIp:p,isFocus:i,localCandidateType:s.candidateType,remoteCandidateType:o.candidateType,networkType:s.networkType,rtt:n.currentRoundTripTime?n.currentRoundTripTime*1e3:NaN})}return r}}class Rpe{constructor(){L(this,"ssrcToMid",{local:new Map,remote:new Map})}findMidBySsrc(e,n){var r;return this.ssrcToMid[n].forEach((i,s)=>{if(i.find(o=>o==e)){r=s;return}}),r}parse(e,n){var r=ex.parse(e),i=new Map;r.media.forEach(s=>{if(s.mid&&s.type==="video"||s.type==="audio"){var o,a=[];(o=s.ssrcs)===null||o===void 0||o.forEach(l=>{l.attribute==="cname"&&a.push("".concat(l.id))}),i.set("".concat(s.mid),a)}}),this.ssrcToMid[n]=i}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class Ipe{constructor(e){this.pc=e}getLocalTracks(e){var n=r=>r!==null&&r.kind===e;return this.pc.getTransceivers().filter(r=>r.currentDirection==="sendonly"||r.currentDirection==="sendrecv").filter(r=>r.sender!==null).map(r=>r.sender).map(r=>r.track).filter(n)}getTackById(e){return this.pc.getTransceivers().map(n=>{if((n==null?void 0:n.sender.track)!==null&&n.sender.track.id===e)return n.sender.track;if((n==null?void 0:n.receiver.track)!==null&&n.receiver.track.id===e)return n.receiver.track}).find(n=>n!==void 0)}getLocalTrackIdByMid(e){var n,r=this.pc.getTransceivers().find(i=>i.mid===e);return r==null||(n=r.sender)===null||n===void 0||(n=n.track)===null||n===void 0?void 0:n.id}getRemoteTrackIdByMid(e){var n,r=this.pc.getTransceivers().find(i=>i.mid===e);return r==null||(n=r.receiver)===null||n===void 0||(n=n.track)===null||n===void 0?void 0:n.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find(n=>n.receiver.track.id===e||n.sender.track!==null&&n.sender.track.id===e)}}class kpe{constructor(e,n,r){this.trackId=e,this.type=n,this.kind=r,L(this,"loss",{packetsTotal:0,packetsLost:0,isDownloadStream:!1}),L(this,"bitrate",{download:0,upload:0}),L(this,"resolution",{width:-1,height:-1}),L(this,"audioConcealment",{concealedAudio:0,totalAudioDuration:0}),L(this,"framerate",0),L(this,"jitter",0),L(this,"codec",""),L(this,"isAlive",!0),L(this,"isMuted",!1),L(this,"isEnabled",!0)}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,n){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=n}getAudioConcealment(){return this.audioConcealment}}class xpe{constructor(e,n){this.mediaSsrcHandler=e,this.mediaTrackHandler=n,L(this,"track2stats",new Map)}findTrack2Stats(e,n){var r;if(e.trackIdentifier)r=e.trackIdentifier;else if(e.mid)r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){var i=this.mediaSsrcHandler.findMidBySsrc(e.ssrc,n);if(!i)return;r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(r){var s=this.track2stats.get(r);if(!s){var o=this.mediaTrackHandler.getTackById(r);if(o!==void 0){var a=o.kind==="audio"?o.kind:"video";s=new kpe(r,n,a),this.track2stats.set(r,s)}else return}return s}}findLocalVideoTrackStats(e){var n=this.mediaTrackHandler.getLocalTracks("video");if(n.length!==0)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class Gf{static getNonNegativeValue(e){var n=e;return typeof n!="number"&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)}}class to{static buildFramerateResolution(e,n){var r={height:n.frameHeight,width:n.frameWidth},i=n.framesPerSecond;r.height&&r.width&&e.setResolution(r),e.setFramerate(Math.round(i||0))}static calculateSimulcastFramerate(e,n,r,i){var s=e.getFramerate();if(!s){if(r){var o=n.timestamp-r.timestamp;if(o>0&&n.framesSent){var a=n.framesSent-r.framesSent;s=a/o*1e3}}if(!s)return}s=i?Math.round(s/i):0,e.setFramerate(s)}static buildCodec(e,n,r){var i=e==null?void 0:e.get(r.codecId);if(i){var s=i.mimeType.split("/")[1];s&&n.setCodec(s)}}static buildBitrateReceived(e,n,r){e.setBitrate({download:to.calculateBitrate(n.bytesReceived,r.bytesReceived,n.timestamp,r.timestamp),upload:0})}static buildBitrateSend(e,n,r){e.setBitrate({download:0,upload:this.calculateBitrate(n.bytesSent,r.bytesSent,n.timestamp,r.timestamp)})}static buildPacketsLost(e,n,r){var i=n.type==="outbound-rtp"?"packetsSent":"packetsReceived",s=n[i];(!s||s<0)&&(s=0);var o=Gf.getNonNegativeValue(r[i]),a=Math.max(0,s-o),l=Gf.getNonNegativeValue(n.packetsLost),c=Gf.getNonNegativeValue(r.packetsLost),u=Math.max(0,l-c);e.setLoss({packetsTotal:a+u,packetsLost:u,isDownloadStream:n.type!=="outbound-rtp"})}static calculateBitrate(e,n,r,i){var s=Gf.getNonNegativeValue(e),o=Gf.getNonNegativeValue(n),a=Math.max(0,s-o),l=r-i,c=0;return l>0&&(c=Math.round(a*8/l)),c}static setTrackStatsState(e,n){var r;if(n===void 0){e.alive=!1;return}var i=e.getType()==="remote"?n.receiver.track:n==null||(r=n.sender)===null||r===void 0?void 0:r.track;if(i==null){e.alive=!1;return}if(i.readyState==="ended"){e.alive=!1;return}e.muted=i.muted,e.enabled=i.enabled,e.alive=!0}static buildTrackSummary(e){var n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},i=e.filter(o=>o.getType()==="remote"),s=i.filter(o=>o.kind==="audio");return i.forEach(o=>{var a=o.kind==="video"?n:r;if(a.count++,o.alive&&o.muted&&a.muted++,a.maxJitter<o.getJitter()&&(a.maxJitter=o.getJitter()),a.maxPacketLoss<o.getLoss().packetsLost&&(a.maxPacketLoss=o.getLoss().packetsLost),s.length>0){var l,c;a.concealedAudio+=(l=o.getAudioConcealment())===null||l===void 0?void 0:l.concealedAudio,a.totalAudio+=(c=o.getAudioConcealment())===null||c===void 0?void 0:c.totalAudioDuration}}),{audioTrackSummary:r,videoTrackSummary:n}}static buildJitter(e,n){if(n.type==="inbound-rtp"){var r=n==null?void 0:n.jitter;if(r!==void 0){var i=Gf.getNonNegativeValue(r);e.setJitter(Math.round(i*1e3))}else e.setJitter(-1)}}static buildAudioConcealment(e,n){if(n.type==="inbound-rtp"){var r=1e3*(n==null?void 0:n.totalSamplesDuration)/(n==null?void 0:n.totalSamplesReceived),i=r*(n==null?void 0:n.concealedSamples),s=1e3*(n==null?void 0:n.totalSamplesDuration);e.setAudioConcealment(i,s)}}}class p1{static build(e){var n={},r={download:0,upload:0},i={download:0,upload:0},s=0,o=0,a={local:new Map,remote:new Map},l={local:new Map,remote:new Map},c={local:new Map,remote:new Map},u=new Map,f=new Map,p=0,m=0,v=0,g=0,S=0,b=0;for(var[w,k]of e){var T=k.getLoss(),I=T.isDownloadStream?"download":"upload";if(r[I]+=T.packetsTotal,i[I]+=T.packetsLost,s+=k.getBitrate().download,o+=k.getBitrate().upload,k.kind==="audio"){var C=k.getAudioConcealment();S+=C.concealedAudio,b+=C.totalAudioDuration,p+=k.getBitrate().download,m+=k.getBitrate().upload}else v+=k.getBitrate().download,g+=k.getBitrate().upload;a[k.getType()].set(w,k.getResolution()),l[k.getType()].set(w,k.getFramerate()),c[k.getType()].set(w,k.getCodec()),k.getType()==="remote"&&(u.set(w,k.getJitter()),k.kind==="audio"&&f.set(w,k.getAudioConcealment())),k.resetBitrate()}return n.bitrate={upload:o,download:s},n.bitrate.audio={upload:m,download:p},n.bitrate.video={upload:g,download:v},n.packetLoss={total:p1.calculatePacketLoss(i.download+i.upload,r.download+r.upload),download:p1.calculatePacketLoss(i.download,r.download),upload:p1.calculatePacketLoss(i.upload,r.upload)},n.audioConcealment=f,n.totalAudioConcealment={concealedAudio:S,totalAudioDuration:b},n.framerate=l,n.resolution=a,n.codec=c,n.jitter=u,n}static calculatePacketLoss(e,n){return!n||n<=0||!e||e<=0?0:Math.round(e/n*100)}}class pd{static buildCallFeedReport(e,n,r){var i=r.getTransceivers(),s=[],o=[];return i.forEach(a=>{var l,c=(l=a.sender)!==null&&l!==void 0&&l.track?pd.buildTrackStats(a.sender.track,"sender"):null,u=pd.buildTrackStats(a.receiver.track,"receiver");s.push({mid:a.mid==null?"null":a.mid,direction:a.direction,currentDirection:a.currentDirection==null?"null":a.currentDirection,sender:c,receiver:u})}),{callId:e,opponentMemberId:n,transceiver:s,callFeeds:o}}static buildTrackStats(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"--",s=(n=e.getSettings())===null||n===void 0?void 0:n.deviceId,o=(r=e.getConstraints())===null||r===void 0?void 0:r.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:s??"unknown",constrainDeviceId:o??"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:i}}static expandCallFeedReport(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unknown";return n.forEach(i=>{var s=i.stream.getAudioTracks(),o=i.stream.getVideoTracks(),a=s.length>0?pd.buildTrackStats(i.stream.getAudioTracks()[0],i.purpose):null,l=o.length>0?pd.buildTrackStats(i.stream.getVideoTracks()[0],i.purpose):null,c={stream:i.stream.id,type:i.isLocal()?"local":"remote",audio:a,video:l,purpose:i.purpose,prefix:r,isVideoMuted:i.isVideoMuted(),isAudioMuted:i.isAudioMuted()};e.callFeeds.push(c)}),e}}function fF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function nS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class Ppe{constructor(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.callId=e,this.opponentMemberId=n,this.pc=r,this.emitter=i,this.isFocus=s,L(this,"isActive",!0),L(this,"previousStatsReport",void 0),L(this,"currentStatsReport",void 0),L(this,"connectionStats",new wpe),L(this,"trackStats",void 0),r.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new xpe(new Rpe,new Ipe(r))}processStats(e,n){var r=this;return U(function*(){var i={isFirstCollection:r.previousStatsReport===void 0,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(r.isActive){var s=r.pc.getStats();if(typeof(s==null?void 0:s.then)=="function")return s.then(o=>{var a,l;r.currentStatsReport=typeof(o==null?void 0:o.result)=="function"?o.result():o;try{r.processStatsReport(e,n)}catch(u){return r.handleError(u),i}r.previousStatsReport=r.currentStatsReport,i.receivedMedia=r.connectionStats.bitrate.download,i.receivedAudioMedia=((a=r.connectionStats.bitrate.audio)===null||a===void 0?void 0:a.download)||0,i.receivedVideoMedia=((l=r.connectionStats.bitrate.video)===null||l===void 0?void 0:l.download)||0;var c=to.buildTrackSummary(Array.from(r.trackStats.getTrack2stats().values()));return nS(nS({},i),{},{audioTrackSummary:c.audioTrackSummary,videoTrackSummary:c.videoTrackSummary})}).catch(o=>(r.handleError(o),i));r.isActive=!1}return Promise.resolve(i)})()}processStatsReport(e,n){var r,i=new Map;i.callId=this.callId,i.opponentMemberId=this.opponentMemberId,(r=this.currentStatsReport)===null||r===void 0||r.forEach(s=>{var o=this.previousStatsReport?this.previousStatsReport.get(s.id):null;if(s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded")this.connectionStats.bandwidth=Cpe.buildBandwidthReport(s),this.connectionStats.transport=Tpe.buildReport(this.currentStatsReport,s,this.connectionStats.transport,this.isFocus);else if(s.type==="inbound-rtp"||s.type==="outbound-rtp"){var a=this.trackStats.findTrack2Stats(s,s.type==="inbound-rtp"?"remote":"local");if(!a)return;if(o&&to.buildPacketsLost(a,s,o),s.type==="inbound-rtp"){to.buildFramerateResolution(a,s),o&&to.buildBitrateReceived(a,s,o);var l=this.trackStats.findTransceiverByTrackId(a.trackId);to.setTrackStatsState(a,l),to.buildJitter(a,s),to.buildAudioConcealment(a,s)}else o&&(i.set(a.trackId,Gf.getNonNegativeValue(s.bytesSent)),to.buildBitrateSend(a,s,o));to.buildCodec(this.currentStatsReport,a,s)}else if(s.type==="track"&&s.kind==="video"&&!s.remoteSource){var c=this.trackStats.findLocalVideoTrackStats(s);if(!c)return;to.buildFramerateResolution(c,s),to.calculateSimulcastFramerate(c,s,o,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}}),this.emitter.emitByteSendReport(i),this.emitter.emitCallFeedReport(pd.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,O.warn("CallStatsReportGatherer ".concat(this.callId," processStatsReport fails and set to inactive ").concat(e))}processAndEmitConnectionStatsReport(){var e=p1.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport(nS(nS({},e),{},{transport:this.connectionStats.transport})),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){this.pc.signalingState==="stable"&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var Uc=function(t){return t.CONNECTION_STATS="StatsReport.connection_stats",t.CALL_FEED_REPORT="StatsReport.call_feed_report",t.BYTE_SENT_STATS="StatsReport.byte_sent_stats",t.SUMMARY_STATS="StatsReport.summary_stats",t}({});class Lpe extends Un{emitByteSendReport(e){this.emit(Uc.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(Uc.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(Uc.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(Uc.SUMMARY_STATS,e)}}class jW{constructor(e){this.emitter=e}build(e){var n=e.filter(u=>!u.isFirstCollection),r=n.length,i=e.length;if(r!==0){var s={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0},o=0,a=0;n.forEach(u=>{this.countTrackListReceivedMedia(s,u),this.countConcealedAudio(s,u),o=this.buildMaxJitter(o,u),a=this.buildMaxPacketLoss(a,u)});var l=5,c={percentageReceivedMedia:Number((s.receivedMedia/r).toFixed(l)),percentageReceivedVideoMedia:Number((s.receivedVideo/r).toFixed(l)),percentageReceivedAudioMedia:Number((s.receivedAudio/r).toFixed(l)),maxJitter:o,maxPacketLoss:a,percentageConcealedAudio:Number(s.totalAudio>0?(s.concealedAudio/s.totalAudio).toFixed(l):0),peerConnections:i};this.emitter.emitSummaryStatsReport(c)}}static extendSummaryReport(e,n){var r=[],i=[];for(var s of n){i.push(s);for(var o of s[1])r.push(o)}e.opponentDevicesInCall=Math.max(0,r.length-1),e.opponentUsersInCall=Math.max(0,i.length-1),e.diffDevicesToPeerConnections=Math.max(0,r.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=Math.max(0,r.length-1)==0?0:e.peerConnections/(r.length-1)}countTrackListReceivedMedia(e,n){var r=!1,i=!1;(n.receivedAudioMedia>0||n.audioTrackSummary.count===0)&&(e.receivedAudio++,r=!0),(n.receivedVideoMedia>0||n.videoTrackSummary.count===0||n.videoTrackSummary.muted>0&&n.videoTrackSummary.muted===n.videoTrackSummary.count)&&(e.receivedVideo++,i=!0),i&&r&&e.receivedMedia++}buildMaxJitter(e,n){return e<n.videoTrackSummary.maxJitter&&(e=n.videoTrackSummary.maxJitter),e<n.audioTrackSummary.maxJitter&&(e=n.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,n){return e<n.videoTrackSummary.maxPacketLoss&&(e=n.videoTrackSummary.maxPacketLoss),e<n.audioTrackSummary.maxPacketLoss&&(e=n.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,n){e.concealedAudio+=n.audioTrackSummary.concealedAudio,e.totalAudio+=n.audioTrackSummary.totalAudio}}class Ape{constructor(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e4;this.groupCallId=e,this.userId=n,this.interval=r,L(this,"timer",void 0),L(this,"gatherers",new Map),L(this,"reports",new Lpe),L(this,"summaryStatsReportGatherer",new jW(this.reports))}start(){this.timer===void 0&&this.interval>0&&(this.timer=setInterval(()=>{this.processStats()},this.interval))}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.gatherers.forEach(e=>e.stopProcessingStats()))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,n,r){return this.hasStatsReportGatherer(e)?!1:(this.gatherers.set(e,new Ppe(e,n,r,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,n){var r;(r=this.getStatsReportGatherer(e))===null||r===void 0||r.setOpponentMemberId(n)}processStats(){var e=[];this.gatherers.forEach(n=>{e.push(n.processStats(this.groupCallId,this.userId))}),Promise.all(e).then(n=>this.summaryStatsReportGatherer.build(n)).catch(n=>{O.error("Could not build summary stats report",n)})}setInterval(e){this.interval=e}}function hF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function rS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var $W=function(t){return t.Ring="m.ring",t.Prompt="m.prompt",t.Room="m.room",t}({}),xC=function(t){return t.Video="m.video",t.Voice="m.voice",t}({}),Ope=function(t){return t.CallEnded="call_ended",t}({}),gn=function(t){return t.GroupCallStateChanged="group_call_state_changed",t.ActiveSpeakerChanged="active_speaker_changed",t.CallsChanged="calls_changed",t.UserMediaFeedsChanged="user_media_feeds_changed",t.ScreenshareFeedsChanged="screenshare_feeds_changed",t.LocalScreenshareStateChanged="local_screenshare_state_changed",t.LocalMuteStateChanged="local_mute_state_changed",t.ParticipantsChanged="participants_changed",t.Error="group_call_error",t}({}),Q0=function(t){return t.ConnectionStats="GroupCall.connection_stats",t.ByteSentStats="GroupCall.byte_sent_stats",t.SummaryStats="GroupCall.summary_stats",t.CallFeedStats="GroupCall.call_feed_stats",t}({}),m1=function(t){return t.NoUserMedia="no_user_media",t.UnknownDevice="unknown_device",t.PlaceCallFailed="place_call_failed",t}({});class sx extends Error{constructor(e,n,r){r?(super(n+": "+r),L(this,"code",void 0)):(super(n),L(this,"code",void 0)),this.code=e}}class BW extends sx{constructor(e){super(m1.UnknownDevice,"No device found for "+e),this.userId=e}}var Jn=function(t){return t.LocalCallFeedUninitialized="local_call_feed_uninitialized",t.InitializingLocalCallFeed="initializing_local_call_feed",t.LocalCallFeedInitialized="local_call_feed_initialized",t.Entered="entered",t.Ended="ended",t}({}),pF=1e3*60*60;function iS(t){var e;return((e=t.getOpponentMember())===null||e===void 0?void 0:e.userId)||t.invitee||null}class XL extends Un{constructor(e,n,r,i,s,o,a,l,c){var u,f,p=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,m=arguments.length>10?arguments[10]:void 0;super(),this.client=e,this.room=n,this.type=r,this.isPtt=i,this.intent=s,this.dataChannelsEnabled=a,this.dataChannelOptions=l,this.useLivekit=p,L(this,"activeSpeakerInterval",1e3),L(this,"retryCallInterval",5e3),L(this,"participantTimeout",1e3*15),L(this,"pttMaxTransmitTime",1e3*20),L(this,"activeSpeaker",void 0),L(this,"localCallFeed",void 0),L(this,"localScreenshareFeed",void 0),L(this,"localDesktopCapturerSourceId",void 0),L(this,"userMediaFeeds",[]),L(this,"screenshareFeeds",[]),L(this,"groupCallId",void 0),L(this,"allowCallWithoutVideoAndAudio",void 0),L(this,"calls",new Map),L(this,"callHandlers",new Map),L(this,"activeSpeakerLoopInterval",void 0),L(this,"retryCallLoopInterval",void 0),L(this,"retryCallCounts",new Map),L(this,"reEmitter",void 0),L(this,"transmitTimer",null),L(this,"participantsExpirationTimer",null),L(this,"resendMemberStateTimer",null),L(this,"initWithAudioMuted",!1),L(this,"initWithVideoMuted",!1),L(this,"initCallFeedPromise",void 0),L(this,"_livekitServiceURL",void 0),L(this,"stats",void 0),L(this,"statsCollectIntervalTime",0),L(this,"onConnectionStats",v=>{this.emit(Q0.ConnectionStats,{report:v})}),L(this,"onByteSentStats",v=>{this.emit(Q0.ByteSentStats,{report:v})}),L(this,"onSummaryStats",v=>{jW.extendSummaryReport(v,this.participants),this.emit(Q0.SummaryStats,{report:v})}),L(this,"onCallFeedReport",v=>{this.localCallFeed&&(v=pd.expandCallFeedReport(v,[this.localCallFeed],"from-local-feed"));var g=[];this.forEachCall(S=>{S.callId===v.callId&&S.getFeeds().forEach(b=>g.push(b))}),v=pd.expandCallFeedReport(v,g,"from-call-feed"),this.emit(Q0.CallFeedStats,{report:v})}),L(this,"_state",Jn.LocalCallFeedUninitialized),L(this,"_participants",new Map),L(this,"_creationTs",null),L(this,"_enteredViaAnotherSession",!1),L(this,"onIncomingCall",v=>{var g,S;if(v.roomId===this.room.roomId){if(v.state!==ut.Ringing){O.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call no longer in ringing state - ignoring"));return}if(!v.groupCallId||v.groupCallId!==this.groupCallId){O.log("GroupCall ".concat(this.groupCallId," onIncomingCall() ignored because it doesn't match the current group call")),v.reject();return}var b=(g=v.getOpponentMember())===null||g===void 0?void 0:g.userId;if(b===void 0){O.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call with no member - ignoring"));return}if(this.useLivekit){O.info("Received incoming call whilst in signaling-only mode! Ignoring.");return}var w=(S=this.calls.get(b))!==null&&S!==void 0?S:new Map,k=w.get(v.getOpponentDeviceId());if((k==null?void 0:k.callId)!==v.callId){O.log("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call (userId=").concat(b,", callId=").concat(v.callId,")")),k&&k.hangup(mt.Replaced,!1),w.set(v.getOpponentDeviceId(),v),this.calls.set(b,w),this.initCall(v);var T=this.getLocalFeeds().map(C=>C.clone());if(!this.callExpected(v))for(var I of T)kr(I.stream.getAudioTracks(),!1),kr(I.stream.getVideoTracks(),!1);v.answerWithCallFeeds(T),this.emit(gn.CallsChanged,this.calls)}}}),L(this,"onRetryCallLoop",()=>{var v=!1;for(var[{userId:g},S]of this.participants){var b=this.calls.get(g),w=this.retryCallCounts.get(g);for(var[k,T]of S){var I,C,x=b==null?void 0:b.get(k),A=(I=(C=w)===null||C===void 0?void 0:C.get(k))!==null&&I!==void 0?I:0;(x==null?void 0:x.getOpponentSessionId())!==T.sessionId&&this.wantsOutgoingCall(g,k)&&A<3&&(w===void 0&&(w=new Map,this.retryCallCounts.set(g,w)),w.set(k,A+1),v=!0)}}v&&this.placeOutgoingCalls()}),L(this,"onCallFeedsChanged",v=>{var g=iS(v),S=v.getOpponentDeviceId();if(!g)throw new Error("Cannot change call feeds without user id");var b=this.getUserMediaFeed(g,S),w=v.remoteUsermediaFeed,k=w!==b,T=this.calls.get(g),I=T==null?void 0:T.get(S);if((I==null?void 0:I.callId)===v.callId){k&&(!b&&w?this.addUserMediaFeed(w):b&&w?this.replaceUserMediaFeed(b,w):b&&!w&&this.removeUserMediaFeed(b));var C=this.getScreenshareFeed(g,S),x=v.remoteScreensharingFeed,A=x!==C;A&&(!C&&x?this.addScreenshareFeed(x):C&&x?this.replaceScreenshareFeed(C,x):C&&!x&&this.removeScreenshareFeed(C))}}),L(this,"onCallStateChanged",(v,g,S)=>{var b;if(g!==ut.Ended){var w=this.localCallFeed.isAudioMuted();v.localUsermediaStream&&v.isMicrophoneMuted()!==w&&v.setMicrophoneMuted(w);var k=this.localCallFeed.isVideoMuted();v.localUsermediaStream&&v.isLocalVideoMuted()!==k&&v.setLocalVideoMuted(k);var T=(b=v.getOpponentMember())===null||b===void 0?void 0:b.userId;if(g===ut.Connected&&T){var I=this.retryCallCounts.get(T);I==null||I.delete(v.getOpponentDeviceId()),(I==null?void 0:I.size)===0&&this.retryCallCounts.delete(T)}}}),L(this,"onCallHangup",v=>{var g,S;if(v.hangupReason!==mt.Replaced){var b=(g=(S=v.getOpponentMember())===null||S===void 0?void 0:S.userId)!==null&&g!==void 0?g:this.room.getMember(v.invitee).userId,w=this.calls.get(b);(w==null?void 0:w.get(v.getOpponentDeviceId()))===v&&(this.disposeCall(v,v.hangupReason),w.delete(v.getOpponentDeviceId()),w.size===0&&this.calls.delete(b),this.emit(gn.CallsChanged,this.calls))}}),L(this,"onCallReplaced",(v,g)=>{var S=v.getOpponentMember().userId,b=this.calls.get(S);b===void 0&&(b=new Map,this.calls.set(S,b)),v.hangup(mt.Replaced,!1),this.initCall(g),b.set(v.getOpponentDeviceId(),g),this.emit(gn.CallsChanged,this.calls)}),L(this,"onActiveSpeakerLoop",()=>{var v=void 0,g=void 0;for(var S of this.userMediaFeeds)if(!(S.isLocal()&&this.userMediaFeeds.length>1)){var b=S.speakingVolumeSamples.reduce((k,T)=>k+Math.max(T,nx)),w=b/S.speakingVolumeSamples.length;(!v||w>v)&&(v=w,g=S)}g&&this.activeSpeaker!==g&&v&&v>nx&&(this.activeSpeaker=g,this.emit(gn.ActiveSpeakerChanged,this.activeSpeaker))}),L(this,"onRoomState",()=>this.updateParticipants()),L(this,"onParticipantsChanged",()=>{this.forEachCall(v=>{var g=this.callExpected(v);for(var S of v.getLocalFeeds())kr(S.stream.getAudioTracks(),!S.isAudioMuted()&&g),kr(S.stream.getVideoTracks(),!S.isVideoMuted()&&g)}),this.state===Jn.Entered&&!this.useLivekit&&this.placeOutgoingCalls()}),L(this,"onStateChanged",(v,g)=>{(v===Jn.Entered||g===Jn.Entered||v===Jn.Ended)&&(this.updateParticipants(),this.updateMemberState().catch(S=>O.error("GroupCall ".concat(this.groupCallId,' onStateChanged() failed to update member state devices"'),S)))}),L(this,"onLocalFeedsChanged",()=>{this.state===Jn.Entered&&this.updateMemberState().catch(v=>O.error("GroupCall ".concat(this.groupCallId," onLocalFeedsChanged() failed to update member state feeds"),v))}),this.reEmitter=new aW(this),this.groupCallId=o??qf(),this._livekitServiceURL=m,this.creationTs=(u=(f=n.currentState.getStateEvents(ee.GroupCallPrefix,this.groupCallId))===null||f===void 0?void 0:f.getTs())!==null&&u!==void 0?u:null,this.updateParticipants(),n.on(gt.Update,this.onRoomState),this.on(gn.ParticipantsChanged,this.onParticipantsChanged),this.on(gn.GroupCallStateChanged,this.onStateChanged),this.on(gn.LocalScreenshareStateChanged,this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!c}create(){var e=this;return U(function*(){return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(ix.Outgoing,e),yield e.sendCallStateEvent(),e})()}sendCallStateEvent(){var e=this;return U(function*(){var n={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0};e.livekitServiceURL&&(n["io.element.livekit_service_url"]=e.livekitServiceURL),yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallPrefix,n,e.groupCallId)})()}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){var n=this._state;e!==n&&(this._state=e,this.emit(gn.GroupCallStateChanged,e,n))}get participants(){return this._participants}set participants(e){var n=this._participants,r=(s,o)=>s.sessionId===o.sessionId&&s.screensharing===o.screensharing,i=(s,o)=>yD(s,o,r);yD(e,n,i)||(this._participants=e,this.emit(gn.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(var n of this.calls.values())for(var r of n.values())e(r)}getLocalFeeds(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,n;return(e=(n=this.participants.get(this.room.getMember(this.client.getUserId())))===null||n===void 0?void 0:n.has(this.client.getDeviceId()))!==null&&e!==void 0?e:!1}callExpected(e){var n,r=iS(e),i=r===null?null:this.room.getMember(r),s=e.getOpponentDeviceId();return i!==null&&s!==void 0&&((n=this.participants.get(i))===null||n===void 0?void 0:n.get(s))!==void 0}initLocalCallFeed(){var e=this;return U(function*(){if(e.useLivekit){O.info("Livekit group call: not starting local call feed.");return}if(e.state!==Jn.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));if(e.state=Jn.InitializingLocalCallFeed,e.initCallFeedPromise)return e.initCallFeedPromise;try{e.initCallFeedPromise=e.initLocalCallFeedInternal(),yield e.initCallFeedPromise}finally{e.initCallFeedPromise=void 0}})()}initLocalCallFeedInternal(){var e=this;return U(function*(){O.log("GroupCall ".concat(e.groupCallId," initLocalCallFeedInternal() running"));var n;try{n=yield e.client.getMediaHandler().getUserMediaStream(!0,e.type===xC.Video)}catch(i){if(e.allowCallWithoutVideoAndAudio)n=new MediaStream;else throw e.state=Jn.LocalCallFeedUninitialized,i}if(e._state!==Jn.InitializingLocalCallFeed)throw e.client.getMediaHandler().stopUserMediaStream(n),new Error("Group call disposed while gathering media stream");var r=new Lc({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:n,purpose:vn.Usermedia,audioMuted:e.initWithAudioMuted||n.getAudioTracks().length===0||e.isPtt,videoMuted:e.initWithVideoMuted||n.getVideoTracks().length===0});kr(n.getAudioTracks(),!r.isAudioMuted()),kr(n.getVideoTracks(),!r.isVideoMuted()),e.localCallFeed=r,e.addUserMediaFeed(r),e.state=Jn.LocalCallFeedInitialized})()}updateLocalUsermediaStream(e){var n=this;return U(function*(){if(n.localCallFeed){var r=n.localCallFeed.stream;n.localCallFeed.setNewStream(e);var i=n.localCallFeed.isAudioMuted(),s=n.localCallFeed.isVideoMuted();O.log("GroupCall ".concat(n.groupCallId," updateLocalUsermediaStream() (oldStreamId=").concat(r.id,", newStreamId=").concat(e.id,", micShouldBeMuted=").concat(i,", vidShouldBeMuted=").concat(s,")")),kr(e.getAudioTracks(),!i),kr(e.getVideoTracks(),!s),n.client.getMediaHandler().stopUserMediaStream(r)}})()}enter(){var e=this;return U(function*(){if(e.state===Jn.LocalCallFeedUninitialized)yield e.initLocalCallFeed();else if(e.state!==Jn.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));O.log("GroupCall ".concat(e.groupCallId," enter() running")),e.state=Jn.Entered,e.client.on(rx.Incoming,e.onIncomingCall);for(var n of e.client.callEventHandler.calls.values())e.onIncomingCall(n);e.useLivekit||(e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval))})()}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),this.transmitTimer!==null&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),this.retryCallLoopInterval!==void 0&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===Jn.Entered&&(this.forEachCall(n=>n.hangup(mt.UserHangup,!1)),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(rx.Incoming,this.onIncomingCall),(e=this.stats)===null||e===void 0||e.stop())}leave(){this.dispose(),this.state=Jn.LocalCallFeedUninitialized}terminate(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:!0;if(n.dispose(),n.room.off(gt.Update,n.onRoomState),n.client.groupCallEventHandler.groupCalls.delete(n.room.roomId),n.client.emit(ix.Ended,n),n.state=Jn.Ended,r){var i=n.room.currentState.getStateEvents(ee.GroupCallPrefix,n.groupCallId);yield n.client.sendStateEvent(n.room.roomId,ee.GroupCallPrefix,rS(rS({},i.getContent()),{},{"m.terminated":Ope.CallEnded}),n.groupCallId)}})()}isLocalVideoMuted(){return this.localCallFeed?this.localCallFeed.isVideoMuted():!0}isMicrophoneMuted(){return this.localCallFeed?this.localCallFeed.isAudioMuted():!0}setMicrophoneMuted(e){var n=this;return U(function*(){if(!e&&!(yield n.client.getMediaHandler().hasAudioDevice()))return!1;var r=!e&&n.isPtt;n.isPtt&&(!e&&n.isMicrophoneMuted()?n.transmitTimer=setTimeout(()=>{n.setMicrophoneMuted(!0)},n.pttMaxTransmitTime):e&&!n.isMicrophoneMuted()&&(n.transmitTimer!==null&&clearTimeout(n.transmitTimer),n.transmitTimer=null)),n.forEachCall(o=>{var a;return(a=o.localUsermediaFeed)===null||a===void 0?void 0:a.setAudioVideoMuted(e,null)});var i=function(){var o=U(function*(){var a=[];n.forEachCall(l=>a.push(l.sendMetadataUpdate())),yield Promise.all(a).catch(l=>O.info("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() failed to send some metadata updates"),l))});return function(){return o.apply(this,arguments)}}();if(r&&(yield i()),n.localCallFeed){O.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() (streamId=").concat(n.localCallFeed.stream.id,", muted=").concat(e,")"));var s=yield n.checkAudioPermissionIfNecessary(e);if(!s)return!1;n.localCallFeed.setAudioVideoMuted(e,null),kr(n.localCallFeed.stream.getAudioTracks(),!e)}else O.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no stream muted (muted=").concat(e,")")),n.initWithAudioMuted=e;return n.forEachCall(o=>kr(o.localUsermediaFeed.stream.getAudioTracks(),!e&&n.callExpected(o))),n.emit(gn.LocalMuteStateChanged,e,n.isLocalVideoMuted()),r||(yield i()),!0})()}checkAudioPermissionIfNecessary(e){var n=this;return U(function*(){try{if(!e&&n.localCallFeed&&!n.localCallFeed.hasAudioTrack){var r=yield n.client.getMediaHandler().getUserMediaStream(!0,!n.localCallFeed.isVideoMuted());if((r==null?void 0:r.getTracks().length)===0)return O.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no device to receive local stream, muted=").concat(e)),!1}}catch{return O.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no device or permission to receive local stream, muted=").concat(e)),!1}return!0})()}setLocalVideoMuted(e){var n=this;return U(function*(){if(!e&&!(yield n.client.getMediaHandler().hasVideoDevice()))return!1;if(n.localCallFeed){O.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() (stream=").concat(n.localCallFeed.stream.id,", muted=").concat(e,")"));try{var r=yield n.client.getMediaHandler().getUserMediaStream(!0,!e);yield n.updateLocalUsermediaStream(r),n.localCallFeed.setAudioVideoMuted(null,e),kr(n.localCallFeed.stream.getVideoTracks(),!e)}catch{return O.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() no device or permission to receive local stream, muted=").concat(e)),!1}}else O.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() no stream muted (muted=").concat(e,")")),n.initWithVideoMuted=e;var i=[];return n.forEachCall(s=>i.push(s.setLocalVideoMuted(e))),yield Promise.all(i),n.forEachCall(s=>kr(s.localUsermediaFeed.stream.getVideoTracks(),!e&&n.callExpected(s))),n.emit(gn.LocalMuteStateChanged,n.isMicrophoneMuted(),e),!0})()}setScreensharingEnabled(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};if(e===r.isScreensharing())return e;if(e)try{O.log("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() is asking for screensharing permissions"));var s=yield r.client.getMediaHandler().getScreensharingStream(i),o=function*(c){var u=()=>{r.setScreensharingEnabled(!1),c.removeEventListener("ended",u)};c.addEventListener("ended",u)};for(var a of s.getTracks())yield*o(a);return O.log("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls")),r.localDesktopCapturerSourceId=i.desktopCapturerSourceId,r.localScreenshareFeed=new Lc({client:r.client,roomId:r.room.roomId,userId:r.client.getUserId(),deviceId:r.client.getDeviceId(),stream:s,purpose:vn.Screenshare,audioMuted:!1,videoMuted:!1}),r.addScreenshareFeed(r.localScreenshareFeed),r.emit(gn.LocalScreenshareStateChanged,!0,r.localScreenshareFeed,r.localDesktopCapturerSourceId),r.forEachCall(l=>l.pushLocalFeed(r.localScreenshareFeed.clone())),!0}catch(l){if(i.throwOnFail)throw l;return O.error("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() enabling screensharing error"),l),r.emit(gn.Error,new sx(m1.NoUserMedia,"Failed to get screen-sharing stream: ",l)),!1}else return r.forEachCall(l=>{l.localScreensharingFeed&&l.removeLocalFeed(l.localScreensharingFeed)}),r.client.getMediaHandler().stopScreensharingStream(r.localScreenshareFeed.stream),r.removeScreenshareFeed(r.localScreenshareFeed),r.localScreenshareFeed=void 0,r.localDesktopCapturerSourceId=void 0,r.emit(gn.LocalScreenshareStateChanged,!1,void 0,void 0),!1})()}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,n){var r=this.client.getUserId(),i=this.client.getDeviceId();return e>=r&&(e!==r||n>i)}placeOutgoingCalls(){var e=this,n=!1,r=function(a){var l,c=(l=e.calls.get(a))!==null&&l!==void 0?l:new Map,u=function(v){var g=c.get(v);if((g==null?void 0:g.getOpponentSessionId())!==p.sessionId&&e.wantsOutgoingCall(a,v)){n=!0,g!==void 0&&(O.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() replacing call (userId=").concat(a,", deviceId=").concat(v,", callId=").concat(g.callId,")")),g.hangup(mt.NewSession,!1));var S=Q1(e.client,e.room.roomId,{invitee:a,opponentDeviceId:v,opponentSessionId:p.sessionId,groupCallId:e.groupCallId});S===null?(O.error("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to create call (userId=").concat(a,", device=").concat(v,")")),c.delete(v)):(e.initCall(S),c.set(v,S),O.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() placing call (userId=").concat(a,", deviceId=").concat(v,", sessionId=").concat(p.sessionId,")")),S.placeCallWithCallFeeds(e.getLocalFeeds().map(b=>b.clone()),p.screensharing).then(()=>{e.dataChannelsEnabled&&S.createDataChannel("datachannel",e.dataChannelOptions)}).catch(b=>{O.warn("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to place call (userId=").concat(a,")"),b),b instanceof _c&&b.code===m1.UnknownDevice?e.emit(gn.Error,b):e.emit(gn.Error,new sx(m1.PlaceCallFailed,"Failed to place call to ".concat(a))),S.hangup(mt.SignallingFailed,!1),c.get(v)===S&&c.delete(v)}))}};for(var[f,p]of s)u(f);c.size>0?e.calls.set(a,c):e.calls.delete(a)};for(var[{userId:i},s]of this.participants)r(i);n&&this.emit(gn.CallsChanged,this.calls)}getMemberStateEvents(e){return e===void 0?this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix):this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix,e)}initCall(e){var n=iS(e);if(!n)throw new Error("Cannot init call without user id");var r=()=>this.onCallFeedsChanged(e),i=(l,c)=>this.onCallStateChanged(e,l,c),s=this.onCallHangup,o=l=>this.onCallReplaced(e,l),a=this.callHandlers.get(n);a===void 0&&(a=new Map,this.callHandlers.set(n,a)),a.set(e.getOpponentDeviceId(),{onCallFeedsChanged:r,onCallStateChanged:i,onCallHangup:s,onCallReplaced:o}),e.on(yt.FeedsChanged,r),e.on(yt.State,i),e.on(yt.Hangup,s),e.on(yt.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(yt)),e.initStats(this.getGroupCallStats()),r()}disposeCall(e,n){var r=iS(e),i=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");var s=this.callHandlers.get(r),{onCallFeedsChanged:o,onCallStateChanged:a,onCallHangup:l,onCallReplaced:c}=s.get(i);if(e.removeListener(yt.FeedsChanged,o),e.removeListener(yt.State,a),e.removeListener(yt.Hangup,l),e.removeListener(yt.Replaced,c),s.delete(r),s.size===0&&this.callHandlers.delete(r),e.hangupReason!==mt.Replaced){var u=this.getUserMediaFeed(r,i);u&&this.removeUserMediaFeed(u);var f=this.getScreenshareFeed(r,i);f&&this.removeScreenshareFeed(f)}}getUserMediaFeed(e,n){return this.userMediaFeeds.find(r=>r.userId===e&&r.deviceId===n)}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(gn.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,n){var r=this.userMediaFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,n),e.dispose(),n.measureVolumeActivity(!0),this.emit(gn.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){var n=this.userMediaFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(n,1),e.dispose(),this.emit(gn.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(gn.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,n){return this.screenshareFeeds.find(r=>r.userId===e&&r.deviceId===n)}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit(gn.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,n){var r=this.screenshareFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,n),e.dispose(),this.emit(gn.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){var n=this.screenshareFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(n,1),e.dispose(),this.emit(gn.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){var e=this.room.getMember(this.client.getSafeUserId());if(!e){O.warn("GroupCall ".concat(this.groupCallId," updateParticipants() tried to update participants before local room member is available"));return}if(this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===Jn.Ended){this.participants=new Map;return}var n=new Map,r=Date.now(),i=this.state===Jn.Entered||this.enteredViaAnotherSession,s=1/0;for(var o of this.getMemberStateEvents()){var a=this.room.getMember(o.getStateKey()),l=o.getContent(),c=Array.isArray(l["m.calls"])?l["m.calls"]:[],u=c.find(S=>S["m.call_id"]===this.groupCallId),f=Array.isArray(u==null?void 0:u["m.devices"])?u["m.devices"]:[],p=f.filter(S=>typeof S.device_id=="string"&&typeof S.session_id=="string"&&typeof S.expires_ts=="number"&&S.expires_ts>r&&Array.isArray(S.feeds));if(!i&&(a==null?void 0:a.userId)===this.client.getUserId()&&(p=p.filter(S=>S.device_id!==this.client.getDeviceId())),p.length>0&&(a==null?void 0:a.membership)===qe.Join){var m=new Map;n.set(a,m);for(var v of p)m.set(v.device_id,{sessionId:v.session_id,screensharing:v.feeds.some(S=>S.purpose===vn.Screenshare)}),v.expires_ts<s&&(s=v.expires_ts)}}if(i){var g=n.get(e);g===void 0&&(g=new Map,n.set(e,g)),g.has(this.client.getDeviceId())||g.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(S=>S.purpose===vn.Screenshare)})}this.participants=n,s<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),s-r))}updateDevices(e){var n=arguments,r=this;return U(function*(){var i,s=n.length>1&&n[1]!==void 0?n[1]:!1,o=Date.now(),a=r.client.getUserId(),l=r.getMemberStateEvents(a),c=(i=l==null?void 0:l.getContent())!==null&&i!==void 0?i:{},u=Array.isArray(c["m.calls"])?c["m.calls"]:[],f=null,p=[];for(var m of u)m["m.call_id"]===r.groupCallId?f=m:p.push(m);f===null&&(f={});var v=Array.isArray(f["m.devices"])?f["m.devices"]:[],g=v.filter(k=>typeof k.device_id=="string"&&typeof k.session_id=="string"&&typeof k.expires_ts=="number"&&k.expires_ts>o&&Array.isArray(k.feeds)),S=e(g);if(S!==null){var b=[...p];S.length>0&&b.push(rS(rS({},f),{},{"m.call_id":r.groupCallId,"m.devices":S}));var w={"m.calls":b};yield r.client.sendStateEvent(r.room.roomId,ee.GroupCallMemberPrefix,w,a,{keepAlive:s})}})()}addDeviceToMemberState(){var e=this;return U(function*(){yield e.updateDevices(n=>[...n.filter(r=>r.device_id!==e.client.getDeviceId()),{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+pF,feeds:e.getLocalFeeds().map(r=>({purpose:r.purpose}))}])})()}updateMemberState(){var e=this;return U(function*(){e.resendMemberStateTimer!==null&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state===Jn.Entered?(yield e.addDeviceToMemberState(),e.resendMemberStateTimer=setInterval(U(function*(){O.log("GroupCall ".concat(e.groupCallId,' updateMemberState() resending call member state"'));try{yield e.addDeviceToMemberState()}catch(n){O.error("GroupCall ".concat(e.groupCallId," updateMemberState() failed to resend call member state"),n)}}),pF*3/4)):yield e.updateDevices(n=>n.filter(r=>r.device_id!==e.client.getDeviceId()),!0)})()}cleanMemberState(){var e=this;return U(function*(){var{devices:n}=yield e.client.getDevices(),r=new Map(n.map(i=>[i.device_id,i]));yield e.updateDevices(i=>{var s=i.filter(o=>{var a=r.get(o.device_id);return(a==null?void 0:a.last_seen_ts)!==void 0&&!(o.device_id===e.client.getDeviceId()&&e.state!==Jn.Entered&&!e.enteredViaAnotherSession)});return s.length===i.length?null:s})})()}getGroupCallStats(){if(this.stats===void 0){var e=this.client.getUserId()||"unknown";this.stats=new Ape(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(Uc.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(Uc.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(Uc.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(Uc.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,this.stats!==void 0&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}function mF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function sS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ut=function(t){return t.Fledgling="fledgling",t.InviteSent="invite_sent",t.WaitLocalMedia="wait_local_media",t.CreateOffer="create_offer",t.CreateAnswer="create_answer",t.Connecting="connecting",t.Connected="connected",t.Ringing="ringing",t.Ended="ended",t}({}),gF=function(t){return t.Voice="voice",t.Video="video",t}({}),Zu=function(t){return t.Inbound="inbound",t.Outbound="outbound",t}({}),sr=function(t){return t.Local="local",t.Remote="remote",t}({}),yt=function(t){return t.Hangup="hangup",t.State="state",t.Error="error",t.Replaced="replaced",t.LocalHoldUnhold="local_hold_unhold",t.RemoteHoldUnhold="remote_hold_unhold",t.HoldUnhold="hold_unhold",t.FeedsChanged="feeds_changed",t.AssertedIdentityChanged="asserted_identity_changed",t.LengthChanged="length_changed",t.DataChannel="datachannel",t.SendVoipEvent="send_voip_event",t.PeerConnectionCreated="peer_connection_created",t}({}),mt=function(t){return t.UserHangup="user_hangup",t.LocalOfferFailed="local_offer_failed",t.NoUserMedia="no_user_media",t.UnknownDevices="unknown_devices",t.SendInvite="send_invite",t.CreateAnswer="create_answer",t.CreateOffer="create_offer",t.SendAnswer="send_answer",t.SetRemoteDescription="set_remote_description",t.SetLocalDescription="set_local_description",t.AnsweredElsewhere="answered_elsewhere",t.IceFailed="ice_failed",t.InviteTimeout="invite_timeout",t.Replaced="replaced",t.SignallingFailed="signalling_timeout",t.UserBusy="user_busy",t.Transferred="transferred",t.NewSession="new_session",t}({}),Mpe="1",Npe="stun:turn.matrix.org",xI=60*1e3,Dpe=1e3,Fpe=30*1e3,Upe=2*1e3;class _c extends Error{constructor(e,n,r){super(n+": "+r),L(this,"code",void 0),this.code=e}}function qf(){return Date.now().toString()+lo(16)}function vF(t){var e=[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:t?12e3:void 0}];return e}function Sa(t,e){return t+":"+e}class jpe extends Un{constructor(e){var n,r;if(super(),n=this,L(this,"roomId",void 0),L(this,"callId",void 0),L(this,"invitee",void 0),L(this,"hangupParty",void 0),L(this,"hangupReason",void 0),L(this,"direction",void 0),L(this,"ourPartyId",void 0),L(this,"peerConn",void 0),L(this,"toDeviceSeq",0),L(this,"isPtt",!1),L(this,"_state",ut.Fledgling),L(this,"client",void 0),L(this,"forceTURN",void 0),L(this,"turnServers",void 0),L(this,"candidateSendQueue",[]),L(this,"candidateSendTries",0),L(this,"candidatesEnded",!1),L(this,"feeds",[]),L(this,"transceivers",new Map),L(this,"inviteOrAnswerSent",!1),L(this,"waitForLocalAVStream",!1),L(this,"successor",void 0),L(this,"opponentMember",void 0),L(this,"opponentVersion",void 0),L(this,"opponentPartyId",void 0),L(this,"opponentCaps",void 0),L(this,"iceDisconnectedTimeout",void 0),L(this,"iceReconnectionTimeOut",void 0),L(this,"inviteTimeout",void 0),L(this,"removeTrackListeners",new Map),L(this,"remoteOnHold",!1),L(this,"callStatsAtEnd",void 0),L(this,"makingOffer",!1),L(this,"ignoreOffer",!1),L(this,"isSettingRemoteAnswerPending",!1),L(this,"responsePromiseChain",void 0),L(this,"remoteCandidateBuffer",new Map),L(this,"remoteAssertedIdentity",void 0),L(this,"remoteSDPStreamMetadata",void 0),L(this,"callLengthInterval",void 0),L(this,"callStartTime",void 0),L(this,"opponentDeviceId",void 0),L(this,"hasOpponentDeviceInfo",void 0),L(this,"opponentSessionId",void 0),L(this,"groupCallId",void 0),L(this,"stopVideoTrackTimer",void 0),L(this,"isOnlyDataChannelAllowed",void 0),L(this,"stats",void 0),L(this,"gotLocalIceCandidate",s=>{if(s.candidate){if(this.candidatesEnded&&O.warn("Call ".concat(this.callId," gotLocalIceCandidate() got candidate after candidates have ended!")),O.debug("Call ".concat(this.callId," got local ICE ").concat(s.candidate.sdpMid," ").concat(s.candidate.candidate)),this.callHasEnded())return;s.candidate.candidate===""?this.queueCandidate(null):this.queueCandidate(s.candidate)}}),L(this,"onIceGatheringStateChange",s=>{var o;O.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state changed to ").concat(this.peerConn.iceGatheringState)),((o=this.peerConn)===null||o===void 0?void 0:o.iceGatheringState)==="complete"&&(this.queueCandidate(null),O.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state complete, set candidates have ended")))}),L(this,"getLocalOfferFailed",s=>{O.error("Call ".concat(this.callId," getLocalOfferFailed() running"),s),this.emit(yt.Error,new _c(mt.LocalOfferFailed,"Failed to get local offer!",s),this),this.terminate(sr.Local,mt.LocalOfferFailed,!1)}),L(this,"getUserMediaFailed",s=>{if(this.successor){this.successor.getUserMediaFailed(s);return}O.warn("Call ".concat(this.callId," getUserMediaFailed() failed to get user media - ending call"),s),this.emit(yt.Error,new _c(mt.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",s),this),this.terminate(sr.Local,mt.NoUserMedia,!1)}),L(this,"placeCallFailed",s=>{if(this.successor){this.successor.placeCallFailed(s);return}O.warn("Call ".concat(this.callId," placeCallWithCallFeeds() failed - ending call"),s),this.emit(yt.Error,new _c(mt.IceFailed,"Couldn't start call! Invalid ICE server configuration.",s),this),this.terminate(sr.Local,mt.IceFailed,!1)}),L(this,"onIceConnectionStateChanged",()=>{var s,o,a,l,c,u;if(!this.callHasEnded()){if(O.debug("Call ".concat(this.callId," onIceConnectionStateChanged() running (state=").concat((s=this.peerConn)===null||s===void 0?void 0:s.iceConnectionState,", conn=").concat((o=this.peerConn)===null||o===void 0?void 0:o.connectionState,")")),["connected","completed"].includes((a=(l=this.peerConn)===null||l===void 0?void 0:l.iceConnectionState)!==null&&a!==void 0?a:""))clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state=ut.Connected,!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit(yt.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3),this)},Dpe));else if(((c=this.peerConn)===null||c===void 0?void 0:c.iceConnectionState)=="failed"){var f;if(this.candidatesEnded=!1,(f=this.peerConn)!==null&&f!==void 0&&f.restartIce){var p;this.candidatesEnded=!1,O.debug("Call ".concat(this.callId," onIceConnectionStateChanged() ice restart (state=").concat((p=this.peerConn)===null||p===void 0?void 0:p.iceConnectionState,")")),this.peerConn.restartIce()}else O.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)")),this.hangup(mt.IceFailed,!1)}else((u=this.peerConn)===null||u===void 0?void 0:u.iceConnectionState)=="disconnected"&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout(()=>{var v,g,S;O.info("Call ".concat(this.callId," onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=").concat((v=this.peerConn)===null||v===void 0?void 0:v.iceConnectionState,", conn=").concat((g=this.peerConn)===null||g===void 0?void 0:g.connectionState,")")),(S=this.peerConn)!==null&&S!==void 0&&S.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0},Upe),this.iceDisconnectedTimeout=setTimeout(()=>{O.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)")),this.hangup(mt.IceFailed,!1)},Fpe),this.state=ut.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(var m of this.getRemoteFeeds())m.setAudioVideoMuted(!0,!0)}}),L(this,"onSignallingStateChanged",()=>{var s;O.debug("Call ".concat(this.callId," onSignallingStateChanged() running (state=").concat((s=this.peerConn)===null||s===void 0?void 0:s.signalingState,")"))}),L(this,"onTrack",s=>{if(s.streams.length===0){O.warn("Call ".concat(this.callId," onTrack() called with streamless track streamless (kind=").concat(s.track.kind,")"));return}var o=s.streams[0];if(this.pushRemoteFeed(o),!this.removeTrackListeners.has(o)){var a=()=>{o.getTracks().length===0&&(O.info("Call ".concat(this.callId," onTrack() removing track (streamId=").concat(o.id,")")),this.deleteFeedByStream(o),o.removeEventListener("removetrack",a),this.removeTrackListeners.delete(o))};o.addEventListener("removetrack",a),this.removeTrackListeners.set(o,a)}}),L(this,"onDataChannel",s=>{this.emit(yt.DataChannel,s.channel,this)}),L(this,"onNegotiationNeeded",U(function*(){if(O.info("Call ".concat(n.callId," onNegotiationNeeded() negotiation is needed!")),n.state!==ut.CreateOffer&&n.opponentVersion===0){O.info("Call ".concat(n.callId," onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event"));return}n.queueGotLocalOffer()})),L(this,"onHangupReceived",s=>{O.debug("Call ".concat(this.callId," onHangupReceived() running")),this.partyIdMatches(s)||this.state===ut.Ringing?this.terminate(sr.Remote,s.reason||mt.UserHangup,!0):O.info("Call ".concat(this.callId," onHangupReceived() ignoring message from party ID ").concat(s.party_id,": our partner is ").concat(this.opponentPartyId))}),L(this,"onRejectReceived",s=>{O.debug("Call ".concat(this.callId," onRejectReceived() running"));var o=[ut.InviteSent,ut.Ringing].includes(this.state)||this.state===ut.Fledgling&&this.direction===Zu.Inbound;o?this.terminate(sr.Remote,s.reason||mt.UserHangup,!0):O.debug("Call ".concat(this.callId," onRejectReceived() called in wrong state (state=").concat(this.state,")"))}),L(this,"onAnsweredElsewhere",s=>{O.debug("Call ".concat(this.callId," onAnsweredElsewhere() running")),this.terminate(sr.Remote,mt.AnsweredElsewhere,!0)}),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=(r=e.forceTURN)!==null&&r!==void 0?r:!1,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],this.turnServers.length===0&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[Npe]});for(var i of this.turnServers)UK(i,["urls"]);this.callId=qf(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}placeVoiceCall(){var e=this;return U(function*(){yield e.placeCall(!0,!1)})()}placeVideoCall(){var e=this;return U(function*(){yield e.placeCall(!0,!0)})()}createDataChannel(e,n){var r=this.peerConn.createDataChannel(e,n);return this.emit(yt.DataChannel,r,this),r}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!!(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!!(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){var n=this._state;this._state=e,this.emit(yt.State,e,n,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?gF.Video:gF.Voice}get hasLocalUserMediaVideoTrack(){var e;return!!((e=this.localUsermediaStream)!==null&&e!==void 0&&e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===vn.Usermedia&&((n=e.stream)===null||n===void 0?void 0:n.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var e;return!!((e=this.localUsermediaStream)!==null&&e!==void 0&&e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===vn.Usermedia&&!!((n=e.stream)!==null&&n!==void 0&&n.getAudioTracks().length)})}get hasUserMediaAudioSender(){var e;return!!(!((e=this.transceivers.get(Sa(vn.Usermedia,"audio")))===null||e===void 0)&&e.sender)}get hasUserMediaVideoSender(){var e;return!!(!((e=this.transceivers.get(Sa(vn.Usermedia,"video")))===null||e===void 0)&&e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find(e=>e.purpose===vn.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(e=>e.purpose===vn.Screenshare)}get localUsermediaStream(){var e;return(e=this.localUsermediaFeed)===null||e===void 0?void 0:e.stream}get localScreensharingStream(){var e;return(e=this.localScreensharingFeed)===null||e===void 0?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(e=>e.purpose===vn.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(e=>e.purpose===vn.Screenshare)}get remoteUsermediaStream(){var e;return(e=this.remoteUsermediaFeed)===null||e===void 0?void 0:e.stream}get remoteScreensharingStream(){var e;return(e=this.remoteScreensharingFeed)===null||e===void 0?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find(n=>n.stream.id===e)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}initOpponentCrypto(){var e=this;return U(function*(){var n;if(e.opponentDeviceId&&e.client.getUseE2eForGroupCall()){if(!e.client.getCrypto()){e.hasOpponentDeviceInfo=!0;return}var r=e.invitee||((n=e.getOpponentMember())===null||n===void 0?void 0:n.userId);throw r?(e.hasOpponentDeviceInfo=!1,new BW(r)):new Error("Couldn't find opponent user ID to init crypto")}})()}getLocalSDPStreamMetadata(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n={};for(var r of this.getLocalFeeds())e&&(r.sdpMetadataStreamId=r.stream.id),n[r.sdpMetadataStreamId]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()};return n}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata()){this.pushRemoteFeedWithoutMetadata(e);return}var n=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,s=this.remoteSDPStreamMetadata[e.id].video_muted;if(!r){O.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=").concat(e.id,")"));return}if(this.getFeedByStreamId(e.id)){O.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.feeds.push(new Lc({client:this.client,call:this,roomId:this.roomId,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:i,videoMuted:s})),this.emit(yt.FeedsChanged,this.feeds,this),O.info("Call ".concat(this.callId," pushRemoteFeed() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,", purpose=").concat(r,")"))}pushRemoteFeedWithoutMetadata(e){var n,r=this.getOpponentMember().userId,i=vn.Usermedia,s=(n=this.feeds.find(o=>!o.isLocal()))===null||n===void 0?void 0:n.stream;if(s&&e.id!==s.id){O.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=").concat(e.id,")"));return}if(this.getFeedByStreamId(e.id)){O.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.feeds.push(new Lc({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:i})),this.emit(yt.FeedsChanged,this.feeds,this),O.info("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,")"))}pushNewLocalFeed(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.client.getUserId();if(kr(e.getAudioTracks(),!0),kr(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)){O.warn("Call ".concat(this.callId," pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.pushLocalFeed(new Lc({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n}),r)}pushLocalFeed(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(this.feeds.some(o=>e.stream.id===o.stream.id)){O.info("Call ".concat(this.callId," pushLocalFeed() ignoring duplicate local stream (streamId=").concat(e.stream.id,")"));return}if(this.feeds.push(e),r){var i=function(){O.info("Call ".concat(n.callId," pushLocalFeed() adding track to peer connection (id=").concat(s.id,", kind=").concat(s.kind,", streamId=").concat(e.stream.id,", streamPurpose=").concat(e.purpose,", enabled=").concat(s.enabled,")"));var a=Sa(e.purpose,s.kind);if(n.transceivers.has(a)){var l=n.transceivers.get(a);l.sender.replaceTrack(s),l.direction=l.direction==="inactive"?"sendonly":"sendrecv"}else{var c=n.peerConn.addTrack(s,e.stream),u=n.peerConn.getTransceivers().find(f=>f.sender===c);u?n.transceivers.set(a,u):O.warn("Call ".concat(n.callId," pushLocalFeed() didn't find a matching transceiver after adding track!"))}};for(var s of e.stream.getTracks())i()}O.info("Call ".concat(this.callId," pushLocalFeed() pushed stream (id=").concat(e.stream.id,", active=").concat(e.stream.active,", purpose=").concat(e.purpose,")")),this.emit(yt.FeedsChanged,this.feeds,this)}removeLocalFeed(e){var n=Sa(e.purpose,"audio"),r=Sa(e.purpose,"video");for(var i of[n,r])if(this.transceivers.has(i)){var s=this.transceivers.get(i);s.sender&&this.peerConn.removeTrack(s.sender)}e.purpose===vn.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(var e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit(yt.FeedsChanged,this.feeds,this)}deleteFeedByStream(e){var n=this.getFeedByStreamId(e.id);if(!n){O.warn("Call ".concat(this.callId," deleteFeedByStream() didn't find the feed to delete (streamId=").concat(e.id,")"));return}this.deleteFeed(n)}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(yt.FeedsChanged,this.feeds,this)}getCurrentCallStats(){var e=this;return U(function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()})()}collectCallStats(){var e=this;return U(function*(){if(e.peerConn){var n=yield e.peerConn.getStats(),r=[];return n.forEach(i=>{r.push(i)}),r}})()}initWithInvite(e){var n=this;return U(function*(){var r,i=e.getContent();n.direction=Zu.Inbound;var s=yield n.client.checkTurnServers();s||O.warn("Call ".concat(n.callId," initWithInvite() failed to get TURN credentials! Proceeding with call anyway..."));var o=i[Hu];o?n.updateRemoteSDPStreamMetadata(o):O.debug("Call ".concat(n.callId," initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams")),n.peerConn=n.createPeerConnection(),n.emit(yt.PeerConnectionCreated,n.peerConn,n),n.chooseOpponent(e),yield n.initOpponentCrypto();try{yield n.peerConn.setRemoteDescription(i.offer),O.debug("Call ".concat(n.callId," initWithInvite() set remote description: ").concat(i.offer.type)),yield n.addBufferedIceCandidates()}catch(u){O.debug("Call ".concat(n.callId," initWithInvite() failed to set remote description"),u),n.terminate(sr.Local,mt.SetRemoteDescription,!1);return}var a=(r=n.feeds.find(u=>!u.isLocal()))===null||r===void 0?void 0:r.stream;if(!n.isOnlyDataChannelAllowed&&(!a||a.getTracks().length===0)){O.error("Call ".concat(n.callId," initWithInvite() no remote stream or no tracks after setting remote description!")),n.terminate(sr.Local,mt.SetRemoteDescription,!1);return}if(n.state=ut.Ringing,e.getLocalAge()){var l=setTimeout(()=>{if(n.state==ut.Ringing){var u;O.debug("Call ".concat(n.callId," initWithInvite() invite has expired. Hanging up.")),n.hangupParty=sr.Remote,n.state=ut.Ended,n.stopAllMedia(),n.peerConn.signalingState!="closed"&&n.peerConn.close(),(u=n.stats)===null||u===void 0||u.removeStatsReportGatherer(n.callId),n.emit(yt.Hangup,n)}},i.lifetime-e.getLocalAge()),c=u=>{u!==ut.Ringing&&(clearTimeout(l),n.off(yt.State,c))};n.on(yt.State,c)}})()}initWithHangup(e){this.state=ut.Ended}shouldAnswerWithMediaType(e,n,r){return e&&!n?(O.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(r," because the other side isn't sending it either.")),!1):!BK(e)&&e!==n&&!this.opponentSupportsSDPStreamMetadata()?(O.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(r,"=").concat(e," because the other side doesn't support it. Answering with ").concat(r,"=").concat(n,".")),n):e??n}answer(e,n){var r=this;return U(function*(){if(!r.inviteOrAnswerSent){if(e===!1&&n===!1)throw new Error("You CANNOT answer a call without media");if(!r.localUsermediaStream&&!r.waitForLocalAVStream){var i=r.state,s=r.shouldAnswerWithMediaType(e,r.hasRemoteUserMediaAudioTrack,"audio"),o=r.shouldAnswerWithMediaType(n,r.hasRemoteUserMediaVideoTrack,"video");r.state=ut.WaitLocalMedia,r.waitForLocalAVStream=!0;try{var a,l=yield r.client.getMediaHandler().getUserMediaStream(s,o);r.waitForLocalAVStream=!1;var c=new Lc({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:(a=r.client.getDeviceId())!==null&&a!==void 0?a:void 0,stream:l,purpose:vn.Usermedia,audioMuted:!1,videoMuted:!1}),u=[c];r.localScreensharingFeed&&u.push(r.localScreensharingFeed),r.answerWithCallFeeds(u)}catch(f){if(o)O.warn("Call ".concat(r.callId," answer() failed to getUserMedia(), trying to getUserMedia() without video")),r.state=i,r.waitForLocalAVStream=!1,yield r.answer(s,!1);else{r.getUserMediaFailed(f);return}}}else r.waitForLocalAVStream&&(r.state=ut.WaitLocalMedia)}})()}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){O.debug("Call ".concat(this.callId," replacedBy() running (newCallId=").concat(e.callId,")")),this.state===ut.WaitLocalMedia?(O.debug("Call ".concat(this.callId," replacedBy() telling new call to wait for local media (newCallId=").concat(e.callId,")")),e.waitForLocalAVStream=!0):[ut.CreateOffer,ut.InviteSent].includes(this.state)&&(e.direction===Zu.Outbound?e.queueGotCallFeedsForAnswer([]):(O.debug("Call ".concat(this.callId," replacedBy() handing local stream to new call(newCallId=").concat(e.callId,")")),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(n=>n.clone())))),this.successor=e,this.emit(yt.Replaced,e,this),this.hangup(mt.Replaced,!0)}hangup(e,n){if(!this.callHasEnded()&&(O.debug("Call ".concat(this.callId," hangup() ending call (reason=").concat(e,")")),this.terminate(sr.Local,e,!n),![ut.Fledgling,ut.WaitLocalMedia].includes(this.state))){var r={};(this.opponentVersion&&this.opponentVersion!==0||e!==mt.UserHangup)&&(r.reason=e),this.sendVoipEvent(ee.CallHangup,r)}}reject(){if(this.state!==ut.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion===0){O.info("Call ".concat(this.callId," reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=").concat(this.opponentVersion,")")),this.hangup(mt.UserHangup,!0);return}O.debug("Rejecting call: "+this.callId),this.terminate(sr.Local,mt.UserHangup,!0),this.sendVoipEvent(ee.CallReject,{})}upgradeCall(e,n){var r=this;return U(function*(){if(!(!e&&!n)&&r.opponentSupportsSDPStreamMetadata())try{O.debug("Call ".concat(r.callId," upgradeCall() upgrading call (audio=").concat(e,", video=").concat(n,")"));var i=e||r.hasLocalUserMediaAudioTrack,s=n||r.hasLocalUserMediaVideoTrack,o=yield r.client.getMediaHandler().getUserMediaStream(i,s,!1);yield r.updateLocalUsermediaStream(o,e,n)}catch(a){O.error("Call ".concat(r.callId," upgradeCall() failed to upgrade the call"),a),r.emit(yt.Error,new _c(mt.NoUserMedia,"Failed to get camera access: ",a),r)}})()}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}setScreensharingEnabled(e,n){var r=this;return U(function*(){if(e&&r.isScreensharing())return O.warn("Call ".concat(r.callId," setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!")),!0;if(!e&&!r.isScreensharing())return O.warn("Call ".concat(r.callId," setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!")),!1;if(!r.opponentSupportsSDPStreamMetadata())return r.setScreensharingEnabledWithoutMetadataSupport(e,n);if(O.debug("Call ".concat(r.callId," setScreensharingEnabled() running (enabled=").concat(e,")")),e)try{var i=yield r.client.getMediaHandler().getScreensharingStream(n);return i?(r.pushNewLocalFeed(i,vn.Screenshare),!0):!1}catch(l){return O.error("Call ".concat(r.callId," setScreensharingEnabled() failed to get screen-sharing stream:"),l),!1}else{var s=r.transceivers.get(Sa(vn.Screenshare,"audio")),o=r.transceivers.get(Sa(vn.Screenshare,"video"));for(var a of[s,o])a&&a.sender&&r.peerConn.removeTrack(a.sender);return r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),!1}})()}setScreensharingEnabledWithoutMetadataSupport(e,n){var r=this;return U(function*(){if(O.debug("Call ".concat(r.callId," setScreensharingEnabledWithoutMetadataSupport() running (enabled=").concat(e,")")),e)try{var i,s=yield r.client.getMediaHandler().getScreensharingStream(n);if(!s)return!1;var o=s.getTracks().find(p=>p.kind==="video"),a=(i=r.transceivers.get(Sa(vn.Usermedia,"video")))===null||i===void 0?void 0:i.sender;return a==null||a.replaceTrack(o??null),r.pushNewLocalFeed(s,vn.Screenshare,!1),!0}catch(p){return O.error("Call ".concat(r.callId," setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:"),p),!1}else{var l,c,u=(l=r.localUsermediaStream)===null||l===void 0?void 0:l.getTracks().find(p=>p.kind==="video"),f=(c=r.transceivers.get(Sa(vn.Usermedia,"video")))===null||c===void 0?void 0:c.sender;return f==null||f.replaceTrack(u??null),r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),!1}})()}updateLocalUsermediaStream(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1,s=n.length>2&&n[2]!==void 0?n[2]:!1,o=r.localUsermediaFeed,a=i||!o.isAudioMuted()&&!r.remoteOnHold,l=s||!o.isVideoMuted()&&!r.remoteOnHold;O.log("Call ".concat(r.callId," updateLocalUsermediaStream() running (streamId=").concat(e.id,", audio=").concat(a,", video=").concat(l,")")),kr(e.getAudioTracks(),a),kr(e.getVideoTracks(),l);for(var c of r.localUsermediaStream.getTracks())r.localUsermediaStream.removeTrack(c),c.stop();for(var u of e.getTracks())r.localUsermediaStream.addTrack(u);var f=function*(){var v=Sa(vn.Usermedia,p.kind),g=r.transceivers.get(v),S=g==null?void 0:g.sender,b=!1;if(S)try{O.info("Call ".concat(r.callId," updateLocalUsermediaStream() replacing track (id=").concat(p.id,", kind=").concat(p.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")")),yield S.replaceTrack(p),g.direction=g.direction==="inactive"?"sendonly":"sendrecv",b=!0}catch(T){O.warn("Call ".concat(r.callId," updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead"),T)}if(!b){O.info("Call ".concat(r.callId," updateLocalUsermediaStream() adding track to peer connection (id=").concat(p.id,", kind=").concat(p.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")"));var w=r.peerConn.addTrack(p,r.localUsermediaStream),k=r.peerConn.getTransceivers().find(T=>T.sender===w);k?r.transceivers.set(v,k):O.warn("Call ".concat(r.callId," updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!"))}};for(var p of e.getTracks())yield*f()})()}setLocalVideoMuted(e){var n=this;return U(function*(){var r;if(O.log("Call ".concat(n.callId," setLocalVideoMuted() running ").concat(e)),!e&&n.stopVideoTrackTimer!==void 0&&(clearTimeout(n.stopVideoTrackTimer),n.stopVideoTrackTimer=void 0),!(yield n.client.getMediaHandler().hasVideoDevice()))return n.isLocalVideoMuted();if(!n.hasUserMediaVideoSender&&!e){var i;return(i=n.localUsermediaFeed)===null||i===void 0||i.setAudioVideoMuted(null,e),yield n.upgradeCall(!1,!0),n.isLocalVideoMuted()}if(!e&&n.localUsermediaStream.getVideoTracks().length===0){var s=yield n.client.getMediaHandler().getUserMediaStream(!0,!0);yield n.updateLocalUsermediaStream(s)}return(r=n.localUsermediaFeed)===null||r===void 0||r.setAudioVideoMuted(null,e),n.updateMuteStatus(),yield n.sendMetadataUpdate(),e&&(n.stopVideoTrackTimer=setTimeout(()=>{for(var o of n.localUsermediaStream.getVideoTracks())o.stop(),n.localUsermediaStream.removeTrack(o)},120)),n.isLocalVideoMuted()})()}isLocalVideoMuted(){var e,n;return(e=(n=this.localUsermediaFeed)===null||n===void 0?void 0:n.isVideoMuted())!==null&&e!==void 0?e:!1}setMicrophoneMuted(e){var n=this;return U(function*(){var r;return O.log("Call ".concat(n.callId," setMicrophoneMuted() running ").concat(e)),(yield n.client.getMediaHandler().hasAudioDevice())?!e&&(!n.hasUserMediaAudioSender||!n.hasLocalUserMediaAudioTrack)?(yield n.upgradeCall(!0,!1),n.isMicrophoneMuted()):((r=n.localUsermediaFeed)===null||r===void 0||r.setAudioVideoMuted(e,null),n.updateMuteStatus(),yield n.sendMetadataUpdate(),n.isMicrophoneMuted()):n.isMicrophoneMuted()})()}isMicrophoneMuted(){var e,n;return(e=(n=this.localUsermediaFeed)===null||n===void 0?void 0:n.isAudioMuted())!==null&&e!==void 0?e:!1}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(var n of this.peerConn.getTransceivers())n.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(yt.RemoteHoldUnhold,this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!==ut.Connected)return!1;var e=!0;for(var n of this.peerConn.getTransceivers()){var r=["inactive","recvonly"].includes(n.currentDirection);r||(e=!1)}return e}sendDtmfDigit(e){for(var n of this.peerConn.getSenders()){var r;if(((r=n.track)===null||r===void 0?void 0:r.kind)==="audio"&&n.dtmf){n.dtmf.insertDTMF(e);return}}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e=this.isMicrophoneMuted()||this.remoteOnHold,n=this.isLocalVideoMuted()||this.remoteOnHold;O.log("Call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(n)),kr(this.localUsermediaStream.getAudioTracks(),!e),kr(this.localUsermediaStream.getVideoTracks(),!n)}sendMetadataUpdate(){var e=this;return U(function*(){yield e.sendVoipEvent(ee.CallSDPStreamMetadataChangedPrefix,{[Hu]:e.getLocalSDPStreamMetadata()})})()}gotCallFeedsForInvite(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.successor){this.successor.queueGotCallFeedsForAnswer(e);return}if(this.callHasEnded()){this.stopAllMedia();return}for(var r of e)this.pushLocalFeed(r);n&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=ut.CreateOffer,O.debug("Call ".concat(this.callId," gotUserMediaForInvite() run"))}sendAnswer(){var e=this;return U(function*(){var n={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type},[Hu]:e.getLocalSDPStreamMetadata(!0)};n.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1};var r=e.discardDuplicateCandidates();O.info("Call ".concat(e.callId," sendAnswer() discarding ").concat(r," candidates that will be sent in answer"));try{yield e.sendVoipEvent(ee.CallAnswer,n),e.inviteOrAnswerSent=!0}catch(o){e.state=ut.Ringing,o instanceof Nn&&o.event&&e.client.cancelPendingEvent(o.event);var i=mt.SendAnswer,s="Failed to send answer";throw o.name=="UnknownDeviceError"&&(i=mt.UnknownDevices,s="Unknown devices present in the room"),e.emit(yt.Error,new _c(i,s,o),e),o}e.sendCandidateQueue()})()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(e)):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,n){var r=ex.parse(e.sdp);r.media.forEach(i=>{var s=new Map,o=new Map;for(var a of i.rtp)s.set(a.payload,a.codec),o.set(a.codec,a.payload);for(var l of n)if(l.mediaType===i.type){if(!o.has(l.codec)){O.info("Call ".concat(this.callId," mungeSdp() ignoring SDP modifications for ").concat(l.codec," as it's not present."));continue}var c=[];l.enableDtx!==void 0&&c.push("usedtx=".concat(l.enableDtx?"1":"0")),l.maxAverageBitrate!==void 0&&c.push("maxaveragebitrate=".concat(l.maxAverageBitrate));var u=!1;for(var f of i.fmtp)s.get(f.payload)===l.codec&&(u=!0,f.config+=";"+c.join(";"));u||i.fmtp.push({payload:o.get(l.codec),config:c.join(";")})}}),e.sdp=ex.write(r)}createOffer(){var e=this;return U(function*(){var n=yield e.peerConn.createOffer();return e.mungeSdp(n,vF(e.isPtt)),n})()}createAnswer(){var e=this;return U(function*(){var n=yield e.peerConn.createAnswer();return e.mungeSdp(n,vF(e.isPtt)),n})()}gotCallFeedsForAnswer(e){var n=this;return U(function*(){if(!n.callHasEnded()){n.waitForLocalAVStream=!1;for(var r of e)n.pushLocalFeed(r);n.state=ut.CreateAnswer;var i;try{n.getRidOfRTXCodecs(),i=yield n.createAnswer()}catch(s){O.debug("Call ".concat(n.callId," gotCallFeedsForAnswer() failed to create answer: "),s),n.terminate(sr.Local,mt.CreateAnswer,!0);return}try{if(yield n.peerConn.setLocalDescription(i),n.callHasEnded()||(n.state=ut.Connecting,yield new Promise(s=>{setTimeout(s,200)}),n.callHasEnded()))return;n.sendAnswer()}catch(s){O.debug("Call ".concat(n.callId," gotCallFeedsForAnswer() error setting local description!"),s),n.terminate(sr.Local,mt.SetLocalDescription,!0);return}}})()}onRemoteIceCandidatesReceived(e){var n=this;return U(function*(){if(!n.callHasEnded()){var r=e.getContent(),i=r.candidates;if(!i){O.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!"));return}var s=r.version===0?null:r.party_id||null;if(n.opponentPartyId===void 0){if(s){O.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() buffering ").concat(i.length," candidates until we pick an opponent"));var o=n.remoteCandidateBuffer.get(s)||[];o.push(...i),n.remoteCandidateBuffer.set(s,o)}return}if(!n.partyIdMatches(r)){O.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() ignoring candidates from party ID ").concat(r.party_id,": we have chosen party ID ").concat(n.opponentPartyId));return}yield n.addIceCandidates(i)}})()}onAnswerReceived(e){var n=this;return U(function*(){var r=e.getContent();if(O.debug("Call ".concat(n.callId," onAnswerReceived() running (hangupParty=").concat(r.party_id,")")),n.callHasEnded()){O.debug("Call ".concat(n.callId," onAnswerReceived() ignoring answer because call has ended"));return}if(n.opponentPartyId!==void 0){O.info("Call ".concat(n.callId," onAnswerReceived() ignoring answer from party ID ").concat(r.party_id,": we already have an answer/reject from ").concat(n.opponentPartyId));return}n.chooseOpponent(e),yield n.addBufferedIceCandidates(),n.state=ut.Connecting;var i=r[Hu];i?n.updateRemoteSDPStreamMetadata(i):O.warn("Call ".concat(n.callId," onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams"));try{n.isSettingRemoteAnswerPending=!0,yield n.peerConn.setRemoteDescription(r.answer),n.isSettingRemoteAnswerPending=!1,O.debug("Call ".concat(n.callId," onAnswerReceived() set remote description: ").concat(r.answer.type))}catch(s){n.isSettingRemoteAnswerPending=!1,O.debug("Call ".concat(n.callId," onAnswerReceived() failed to set remote description"),s),n.terminate(sr.Local,mt.SetRemoteDescription,!1);return}if(n.opponentPartyId!==null)try{yield n.sendVoipEvent(ee.CallSelectAnswer,{selected_party_id:n.opponentPartyId})}catch(s){O.warn("Call ".concat(n.callId," onAnswerReceived() failed to send select_answer event"),s)}})()}onSelectAnswerReceived(e){var n=this;return U(function*(){if(n.direction!==Zu.Inbound){O.warn("Call ".concat(n.callId," onSelectAnswerReceived() got select_answer for an outbound call: ignoring"));return}var r=e.getContent().selected_party_id;if(r==null){O.warn("Call ".concat(n.callId," onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring"));return}r!==n.ourPartyId&&(O.info("Call ".concat(n.callId," onSelectAnswerReceived() got select_answer for party ID ").concat(r,": we are party ID ").concat(n.ourPartyId,".")),yield n.terminate(sr.Remote,mt.AnsweredElsewhere,!0))})()}onNegotiateReceived(e){var n=this;return U(function*(){var r=e.getContent(),i=r.description;if(!i||!i.sdp||!i.type){O.info("Call ".concat(n.callId," onNegotiateReceived() ignoring invalid m.call.negotiate event"));return}var s=n.direction===Zu.Inbound,o=!n.makingOffer&&(n.peerConn.signalingState==="stable"||n.isSettingRemoteAnswerPending),a=i.type==="offer"&&!o;if(n.ignoreOffer=!s&&a,n.ignoreOffer){O.info("Call ".concat(n.callId," onNegotiateReceived() ignoring colliding negotiate event because we're impolite"));return}var l=n.isLocalOnHold(),c=r[Hu];c?n.updateRemoteSDPStreamMetadata(c):O.warn("Call ".concat(n.callId," onNegotiateReceived() received negotiation event without SDPStreamMetadata!"));try{if(n.isSettingRemoteAnswerPending=i.type=="answer",yield n.peerConn.setRemoteDescription(i),n.isSettingRemoteAnswerPending=!1,O.debug("Call ".concat(n.callId," onNegotiateReceived() set remote description: ").concat(i.type)),i.type==="offer"){var u,f;try{n.getRidOfRTXCodecs(),f=yield n.createAnswer()}catch(m){O.debug("Call ".concat(n.callId," onNegotiateReceived() failed to create answer: "),m),n.terminate(sr.Local,mt.CreateAnswer,!0);return}yield n.peerConn.setLocalDescription(f),O.debug("Call ".concat(n.callId," onNegotiateReceived() create an answer")),n.sendVoipEvent(ee.CallNegotiate,{lifetime:xI,description:(u=n.peerConn.localDescription)===null||u===void 0?void 0:u.toJSON(),[Hu]:n.getLocalSDPStreamMetadata(!0)})}}catch(m){n.isSettingRemoteAnswerPending=!1,O.warn("Call ".concat(n.callId," onNegotiateReceived() failed to complete negotiation"),m)}var p=n.isLocalOnHold();l!==p&&(n.emit(yt.LocalHoldUnhold,p,n),n.emit(yt.HoldUnhold,p))})()}updateRemoteSDPStreamMetadata(e){this.remoteSDPStreamMetadata=HK(this.remoteSDPStreamMetadata||{},e,!0);for(var n of this.getRemoteFeeds()){var r,i=n.stream.id,s=this.remoteSDPStreamMetadata[i];n.setAudioVideoMuted(s==null?void 0:s.audio_muted,s==null?void 0:s.video_muted),n.purpose=(r=this.remoteSDPStreamMetadata[i])===null||r===void 0?void 0:r.purpose}}onSDPStreamMetadataChangedReceived(e){var n=e.getContent(),r=n[Hu];this.updateRemoteSDPStreamMetadata(r)}onAssertedIdentityReceived(e){var n=this;return U(function*(){var r=e.getContent();r.asserted_identity&&(n.remoteAssertedIdentity={id:r.asserted_identity.id,displayName:r.asserted_identity.display_name},n.emit(yt.AssertedIdentityChanged,n))})()}callHasEnded(){return this.state===ut.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.responsePromiseChain=this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){var e=this;return U(function*(){e.makingOffer=!0;try{yield e.gotLocalOffer()}catch(n){e.getLocalOfferFailed(n);return}finally{e.makingOffer=!1}})()}gotLocalOffer(){var e=this;return U(function*(){if(O.debug("Call ".concat(e.callId," gotLocalOffer() running")),e.callHasEnded()){O.debug("Call ".concat(e.callId,' gotLocalOffer() ignoring newly created offer because the call has ended"'));return}var n;try{e.getRidOfRTXCodecs(),n=yield e.createOffer()}catch(u){O.debug("Call ".concat(e.callId," gotLocalOffer() failed to create offer: "),u),e.terminate(sr.Local,mt.CreateOffer,!0);return}try{yield e.peerConn.setLocalDescription(n)}catch(u){O.debug("Call ".concat(e.callId," gotLocalOffer() error setting local description!"),u),e.terminate(sr.Local,mt.SetLocalDescription,!0);return}if(e.peerConn.iceGatheringState==="gathering"&&(yield new Promise(u=>{setTimeout(u,200)})),!e.callHasEnded()){var r=e.state===ut.CreateOffer?ee.CallInvite:ee.CallNegotiate,i={lifetime:xI};if(r===ee.CallInvite&&e.invitee&&(i.invitee=e.invitee),e.state===ut.CreateOffer){var s;i.offer=(s=e.peerConn.localDescription)===null||s===void 0?void 0:s.toJSON()}else{var o;i.description=(o=e.peerConn.localDescription)===null||o===void 0?void 0:o.toJSON()}i.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},i[Hu]=e.getLocalSDPStreamMetadata(!0);var a=e.discardDuplicateCandidates();O.info("Call ".concat(e.callId," gotLocalOffer() discarding ").concat(a," candidates that will be sent in offer"));try{yield e.sendVoipEvent(r,i)}catch(u){O.error("Call ".concat(e.callId," gotLocalOffer() failed to send invite"),u),u instanceof Nn&&u.event&&e.client.cancelPendingEvent(u.event);var l=mt.SignallingFailed,c="Signalling failed";e.state===ut.CreateOffer&&(l=mt.SendInvite,c="Failed to send invite"),u.name=="UnknownDeviceError"&&(l=mt.UnknownDevices,c="Unknown devices present in the room"),e.emit(yt.Error,new _c(l,c,u),e),e.terminate(sr.Local,l,!1);return}e.sendCandidateQueue(),e.state===ut.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=ut.InviteSent,e.inviteTimeout=setTimeout(()=>{e.inviteTimeout=void 0,e.state===ut.InviteSent&&e.hangup(mt.InviteTimeout,!1)},xI))}})()}getRidOfRTXCodecs(){if(!(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)){var e=this.transceivers.get(Sa(vn.Screenshare,"video"));if(!(!e||!e.setCodecPreferences)){var n=RTCRtpReceiver.getCapabilities("video").codecs,r=RTCRtpSender.getCapabilities("video").codecs,i=[];for(var s of[...n,...r])if(s.mimeType!=="video/rtx"){i.push(s);try{e.setCodecPreferences(i)}catch(o){O.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",s,o),i.pop()}}}}}sendVoipEvent(e,n){var r=this;return U(function*(){var i=sS(sS({},n),{},{version:Mpe,call_id:r.callId,party_id:r.ourPartyId,conf_id:r.groupCallId});if(r.opponentDeviceId){var s,o=r.toDeviceSeq++,a=sS(sS({},i),{},{device_id:r.client.deviceId,sender_session_id:r.client.getSessionId(),dest_session_id:r.opponentSessionId,seq:o,[TC]:ape()});r.emit(yt.SendVoipEvent,{type:"toDevice",eventType:e,userId:r.invitee||((s=r.getOpponentMember())===null||s===void 0?void 0:s.userId),opponentDeviceId:r.opponentDeviceId,content:a},r);var l=r.invitee||r.getOpponentMember().userId;if(r.client.getUseE2eForGroupCall()){if(!r.hasOpponentDeviceInfo){O.warn("Call ".concat(r.callId," sendVoipEvent() failed: we do not have opponentDeviceInfo"));return}throw new Error("Unimplemented")}else yield r.client.sendToDevice(e,new Map([[l,new Map([[r.opponentDeviceId,a]])]]))}else{var c;r.emit(yt.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:r.roomId,content:i,userId:r.invitee||((c=r.getOpponentMember())===null||c===void 0?void 0:c.userId)},r),yield r.client.sendEvent(r.roomId,e,i)}})()}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,!(this.state===ut.Ringing||!this.inviteOrAnswerSent)){var n=this.direction===Zu.Inbound?500:2e3;this.candidateSendTries===0&&setTimeout(()=>{this.sendCandidateQueue()},n)}}discardDuplicateCandidates(){for(var e=0,n=[],r=0;r<this.candidateSendQueue.length;r++){var i=this.candidateSendQueue[r];i.candidate===""?n.push(i):e++}return this.candidateSendQueue=n,e}transfer(e){var n=this;return U(function*(){var r=yield n.client.getProfileInfo(e),i=qf(),s={replacement_id:qf(),target_user:{id:e,display_name:r.displayname,avatar_url:r.avatar_url},create_call:i};yield n.sendVoipEvent(ee.CallReplaces,s),yield n.terminate(sr.Local,mt.Transferred,!0)})()}transferToCall(e){var n=this;return U(function*(){var r,i,s=(r=e.getOpponentMember())===null||r===void 0?void 0:r.userId,o=s?yield n.client.getProfileInfo(s):void 0,a=(i=n.getOpponentMember())===null||i===void 0?void 0:i.userId,l=a?yield n.client.getProfileInfo(a):void 0,c=qf(),u={replacement_id:qf(),target_user:{id:a,display_name:l==null?void 0:l.displayname,avatar_url:l==null?void 0:l.avatar_url},await_call:c};yield e.sendVoipEvent(ee.CallReplaces,u);var f={replacement_id:qf(),target_user:{id:s,display_name:o==null?void 0:o.displayname,avatar_url:o==null?void 0:o.avatar_url},create_call:c};yield n.sendVoipEvent(ee.CallReplaces,f),yield n.terminate(sr.Local,mt.Transferred,!0),yield e.terminate(sr.Local,mt.Transferred,!0)})()}terminate(e,n,r){var i=this;return U(function*(){var s;if(!i.callHasEnded()){i.hangupParty=e,i.hangupReason=n,i.state=ut.Ended,i.inviteTimeout&&(clearTimeout(i.inviteTimeout),i.inviteTimeout=void 0),i.iceDisconnectedTimeout!==void 0&&(clearTimeout(i.iceDisconnectedTimeout),i.iceDisconnectedTimeout=void 0),i.callLengthInterval&&(clearInterval(i.callLengthInterval),i.callLengthInterval=void 0),i.stopVideoTrackTimer!==void 0&&(clearTimeout(i.stopVideoTrackTimer),i.stopVideoTrackTimer=void 0);for(var[o,a]of i.removeTrackListeners)o.removeEventListener("removetrack",a);i.removeTrackListeners.clear(),i.callStatsAtEnd=yield i.collectCallStats(),i.stopAllMedia(),i.deleteAllFeeds(),i.peerConn&&i.peerConn.signalingState!=="closed"&&i.peerConn.close(),(s=i.stats)===null||s===void 0||s.removeStatsReportGatherer(i.callId),r&&i.emit(yt.Hangup,i),i.client.callEventHandler.calls.delete(i.callId)}})()}stopAllMedia(){O.debug("Call ".concat(this.callId," stopAllMedia() running"));for(var e of this.feeds)if(e.isLocal()&&e.purpose===vn.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===vn.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal()){O.debug("Call ".concat(this.callId," stopAllMedia() stopping stream (streamId=").concat(e.stream.id,")"));for(var n of e.stream.getTracks())n.stop()}}checkForErrorListener(){if(this.listeners(qK.Error).length===0)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return U(function*(){if(!(e.candidateSendQueue.length===0||e.callHasEnded())){var n=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;var r={candidates:n.map(a=>a.toJSON())};e.candidatesEnded&&r.candidates.push({candidate:""}),O.debug("Call ".concat(e.callId," sendCandidateQueue() attempting to send ").concat(n.length," candidates"));try{yield e.sendVoipEvent(ee.CallCandidates,r),e.candidateSendTries=0,e.sendCandidateQueue()}catch(a){if(a instanceof Nn&&a.event&&e.client.cancelPendingEvent(a.event),e.candidateSendQueue.push(...n),e.candidateSendTries>5){O.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),a);var i=mt.SignallingFailed,s="Signalling failed";e.emit(yt.Error,new _c(i,s,a),e),e.hangup(i,!1);return}var o=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,O.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates. Retrying in ").concat(o,"ms"),a),setTimeout(()=>{e.sendCandidateQueue()},o)}}})()}placeCall(e,n){var r=this;return U(function*(){if(!e)throw new Error("You CANNOT start a call without audio");r.state=ut.WaitLocalMedia;var i;try{var s,o=yield r.client.getMediaHandler().getUserMediaStream(e,n);kr(o.getAudioTracks(),!0),kr(o.getVideoTracks(),!0),i=new Lc({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:(s=r.client.getDeviceId())!==null&&s!==void 0?s:void 0,stream:o,purpose:vn.Usermedia,audioMuted:!1,videoMuted:!1})}catch(a){r.getUserMediaFailed(a);return}try{yield r.placeCallWithCallFeeds([i])}catch(a){r.placeCallFailed(a);return}})()}placeCallWithCallFeeds(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;r.checkForErrorListener(),r.direction=Zu.Outbound,yield r.initOpponentCrypto(),r.client.callEventHandler.calls.set(r.callId,r);var s=yield r.client.checkTurnServers();s||O.warn("Call ".concat(r.callId," placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...")),r.peerConn=r.createPeerConnection(),r.emit(yt.PeerConnectionCreated,r.peerConn,r),r.gotCallFeedsForInvite(e,i)})()}createPeerConnection(){var e,n=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});n.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),n.addEventListener("signalingstatechange",this.onSignallingStateChanged),n.addEventListener("icecandidate",this.gotLocalIceCandidate),n.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),n.addEventListener("track",this.onTrack),n.addEventListener("negotiationneeded",this.onNegotiationNeeded),n.addEventListener("datachannel",this.onDataChannel);var r=this.getOpponentMember(),i=r?r.userId:"unknown";return(e=this.stats)===null||e===void 0||e.addStatsReportGatherer(this.callId,i,n),n}partyIdMatches(e){var n=e.version===0?null:e.party_id||null;return n===this.opponentPartyId}chooseOpponent(e){var n,r=e.getContent();if(O.debug("Call ".concat(this.callId," chooseOpponent() running (partyId=").concat(r.party_id,")")),this.opponentVersion=r.version,this.opponentVersion===0?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=(n=this.client.getRoom(this.roomId).getMember(e.getSender()))!==null&&n!==void 0?n:void 0,this.opponentMember){var i;(i=this.stats)===null||i===void 0||i.updateOpponentMember(this.callId,this.opponentMember.userId)}}addBufferedIceCandidates(){var e=this;return U(function*(){var n=e.remoteCandidateBuffer.get(e.opponentPartyId);n&&(O.info("Call ".concat(e.callId," addBufferedIceCandidates() adding ").concat(n.length," buffered candidates for opponent ").concat(e.opponentPartyId)),yield e.addIceCandidates(n)),e.remoteCandidateBuffer.clear()})()}addIceCandidates(e){var n=this;return U(function*(){for(var r of e){(r.sdpMid===null||r.sdpMid===void 0)&&(r.sdpMLineIndex===null||r.sdpMLineIndex===void 0)?O.debug("Call ".concat(n.callId," addIceCandidates() got remote ICE end-of-candidates")):O.debug("Call ".concat(n.callId," addIceCandidates() got remote ICE candidate (sdpMid=").concat(r.sdpMid,", candidate=").concat(r.candidate,")"));try{yield n.peerConn.addIceCandidate(r)}catch(i){n.ignoreOffer?O.debug("Call ".concat(n.callId," addIceCandidates() failed to add remote ICE candidate because ignoring offer"),i):O.info("Call ".concat(n.callId," addIceCandidates() failed to add remote ICE candidate"),i)}}})()}get hasPeerConnection(){return!!this.peerConn}initStats(e){this.stats=e,this.stats.start()}}function kr(t,e){for(var n of t)n.enabled=e}function ox(){if(typeof window>"u"||typeof document>"u")return!1;try{var t,e,n,r=!!((t=(e=(n=window.RTCPeerConnection)!==null&&n!==void 0?n:window.RTCSessionDescription)!==null&&e!==void 0?e:window.RTCIceCandidate)!==null&&t!==void 0?t:navigator.mediaDevices);if(!r)return O.error("WebRTC is not supported in this browser / environment"),!1}catch(i){return O.error("Exception thrown when trying to access WebRTC",i),!1}return!0}function Q1(t,e,n){if(!ox())return null;var r=n?n.forceTURN:!1,i={client:t,roomId:e,invitee:n==null?void 0:n.invitee,turnServers:t.getTurnServers(),forceTURN:t.forceTURN||r,opponentDeviceId:n==null?void 0:n.opponentDeviceId,opponentSessionId:n==null?void 0:n.opponentSessionId,groupCallId:n==null?void 0:n.groupCallId},s=new jpe(i);return t.reEmitter.reEmit(s,Object.values(yt)),s}var Cd=function(t){return t.DontNotify="dont_notify",t.Notify="notify",t.Coalesce="coalesce",t}({}),JL=function(t){return t.Highlight="highlight",t.Sound="sound",t}({}),$pe=function(t){return t.ExactEquals="==",t.LessThan="<",t.GreaterThan=">",t.GreaterThanOrEqual=">=",t.LessThanOrEqual="<=",t}({}),Bpe="2";function Hpe(t){return t==="==2"||t==="2"}var xr=function(t){return t.EventMatch="event_match",t.EventPropertyIs="event_property_is",t.EventPropertyContains="event_property_contains",t.ContainsDisplayName="contains_display_name",t.RoomMemberCount="room_member_count",t.SenderNotificationPermission="sender_notification_permission",t.CallStarted="call_started",t.CallStartedPrefix="org.matrix.msc3914.call_started",t}({}),ui=function(t){return t.Override="override",t.ContentSpecific="content",t.RoomSpecific="room",t.SenderSpecific="sender",t.Underride="underride",t}({}),ci=function(t){return t.Master=".m.rule.master",t.IsUserMention=".m.rule.is_user_mention",t.IsRoomMention=".m.rule.is_room_mention",t.ContainsDisplayName=".m.rule.contains_display_name",t.ContainsUserName=".m.rule.contains_user_name",t.AtRoomNotification=".m.rule.roomnotif",t.DM=".m.rule.room_one_to_one",t.EncryptedDM=".m.rule.encrypted_room_one_to_one",t.Message=".m.rule.message",t.EncryptedMessage=".m.rule.encrypted",t.InviteToSelf=".m.rule.invite_for_me",t.MemberEvent=".m.rule.member_event",t.IncomingCall=".m.rule.call",t.SuppressNotices=".m.rule.suppress_notices",t.Tombstone=".m.rule.tombstone",t.PollStart=".m.rule.poll_start",t.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",t.PollEnd=".m.rule.poll_end",t.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",t.PollStartOneToOne=".m.rule.poll_start_one_to_one",t.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",t.PollEndOneToOne=".m.rule.poll_end_one_to_one",t.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",t}({});function yF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _F(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var bF=[ui.Override,ui.ContentSpecific,ui.RoomSpecific,ui.SenderSpecific,ui.Underride],Vpe={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:xr.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:xr.SenderNotificationPermission,key:"room"}],actions:[Cd.Notify,{set_tweak:JL.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:xr.EventMatch,key:"type",pattern:"m.reaction"}],actions:[Cd.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:xr.EventMatch,key:"type",pattern:ee.RoomServerAcl},{kind:xr.EventMatch,key:"state_key",pattern:""}],actions:[]}},ZL=Symbol("UserDefinedRules"),Gpe=[ci.Master,ZL,ci.SuppressNotices,ci.InviteToSelf,ci.MemberEvent,ci.IsUserMention,ci.ContainsDisplayName,ci.IsRoomMention,ci.AtRoomNotification,ci.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],qpe={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:xr.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:xr.CallStarted}],actions:[Cd.Notify,{set_tweak:JL.Sound,value:"default"}]}},Kpe=[ZL,ci.IncomingCall,".org.matrix.msc3914.rule.room.call",ci.EncryptedDM,ci.DM,ci.Message,ci.EncryptedMessage];function SF(t,e,n,r){var i=e.filter(m=>m.default),s=e.filter(m=>!m.default);function o(m){m===ZL?l.push(...s):m in n?(O.warn("Adding default global ".concat(t," push rule ").concat(m)),l.push(n[m])):O.warn("Missing default global ".concat(t," push rule ").concat(m))}var a=0,l=[];for(var c of i){var u=r.indexOf(c.rule_id);if(u===-1){l.push(c);continue}for(;u>a;){var f=r[a];o(f),a+=1}l.push(c),a+=1}for(var p of r.slice(a))o(p);return l}class ka{constructor(e){this.client=e,L(this,"parsedKeys",new Map)}static actionListToActionsObject(e){var n={notify:!1,tweaks:{}};for(var r of e)r===Cd.Notify?n.notify=!0:typeof r=="object"&&(r.value===void 0&&(r.value=!0),n.tweaks[r.set_tweak]=r.value);return n}static rewriteDefaultRules(e){var n=JSON.parse(JSON.stringify(e));return n||(n={}),n.global||(n.global={}),n.global.override||(n.global.override=[]),n.global.underride||(n.global.underride=[]),n.global.override=SF(ui.Override,n.global.override,Vpe,Gpe),n.global.underride=SF(ui.Underride,n.global.underride,qpe,Kpe),n}static getPushRuleGlobRegex(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"i",[i,s]=n?["(?<=^|\\W)","(?=\\W|$)"]:["^","$"],o="".concat(n,"-").concat(r,"-").concat(e);return ka.cachedGlobToRegex[o]||(ka.cachedGlobToRegex[o]=new RegExp(i+"("+$K(e)+")"+s,r)),ka.cachedGlobToRegex[o]}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);var n=new Set(this.parsedKeys.keys());for(var r of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(var i of r)if(i.conditions)for(var s of i.conditions)s.kind===xr.EventMatch&&(n.delete(s.key),this.parsedKeys.set(s.key,ka.partsForDottedKey(s.key)));n.forEach(o=>this.parsedKeys.delete(o))}matchingRuleFromKindSet(e,n){for(var r of bF){var i=n[r];if(i){for(var s of i)if(s.enabled){var o=this.templateRuleToRaw(r,s);if(o&&this.ruleMatchesEvent(o,e))return _F(_F({},s),{},{kind:r})}}}return null}templateRuleToRaw(e,n){var r={rule_id:n.rule_id,actions:n.actions,conditions:[]};switch(e){case ui.Underride:case ui.Override:r.conditions=n.conditions;break;case ui.RoomSpecific:if(!n.rule_id)return null;r.conditions.push({kind:xr.EventMatch,key:"room_id",value:n.rule_id});break;case ui.SenderSpecific:if(!n.rule_id)return null;r.conditions.push({kind:xr.EventMatch,key:"user_id",value:n.rule_id});break;case ui.ContentSpecific:if(!n.pattern)return null;r.conditions.push({kind:xr.EventMatch,key:"content.body",pattern:n.pattern});break}return r}eventFulfillsCondition(e,n){switch(e.kind){case xr.EventMatch:return this.eventFulfillsEventMatchCondition(e,n);case xr.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,n);case xr.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,n);case xr.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,n);case xr.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,n);case xr.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,n);case xr.CallStarted:case xr.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,n)}return!1}eventFulfillsSenderNotifPermCondition(e,n){var r=e.key;if(!r)return!1;var i=this.client.getRoom(n.getRoomId());return i!=null&&i.currentState?i.currentState.mayTriggerNotifOfType(r,n.getSender()):!1}eventFulfillsRoomMemberCountCondition(e,n){if(!e.is)return!1;var r=this.client.getRoom(n.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;var i=r.currentState.getJoinedMemberCount(),s=e.is.match(/^([=<>]*)(\d*)$/);if(!s)return!1;var o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}}eventFulfillsDisplayNameCondition(e,n){var r,i=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(i=n.getClearContent()),!i||!i.body||typeof i.body!="string")return!1;var s=this.client.getRoom(n.getRoomId()),o=s==null||(r=s.currentState)===null||r===void 0?void 0:r.getMember(this.client.credentials.userId);if(!o)return!1;var a=o.name,l=new RegExp("(^|\\W)"+jK(a)+"(\\W|$)","i");return i.body.search(l)>-1}eventFulfillsEventMatchCondition(e,n){if(!e.key)return!1;var r=this.valueForDottedKey(e.key,n);if(typeof r!="string")return!1;if(e.value)return e.value===r;if(typeof e.pattern!="string")return!1;var i=ka.getPushRuleGlobRegex(e.pattern,e.key==="content.body");return!!r.match(i)}eventFulfillsEventPropertyIsCondition(e,n){return!e.key||e.value===void 0?!1:e.value===this.valueForDottedKey(e.key,n)}eventFulfillsEventPropertyContains(e,n){if(!e.key||e.value===void 0)return!1;var r=this.valueForDottedKey(e.key,n);return Array.isArray(r)?r.includes(e.value):!1}eventFulfillsCallStartedCondition(e,n){return["m.ring","m.prompt"].includes(n.getContent()["m.intent"])&&!("m.terminated"in n.getContent())&&(n.getPrevContent()["m.terminated"]!==n.getContent()["m.terminated"]||Eh(n.getPrevContent(),{}))}static partsForDottedKey(e){var n=[],r="",i=!1;for(var s of e){if(i){s==="\\"||s==="."?r+=s:r+="\\"+s,i=!1;continue}s=="."?(n.push(r),r=""):s=="\\"?i=!0:r+=s}return i&&(r+="\\"),n.push(r),n}valueForDottedKey(e,n){var r=this.parsedKeys.get(e);r===void 0&&(r=ka.partsForDottedKey(e),this.parsedKeys.set(e,r));var i,s=r[0],o=0;for(s==="content"?(i=n.getContent(),++o):s==="type"?(i=n.getType(),++o):i=n.event;o<r.length;++o){if(BK(i))return;var a=r[o];i=i[a]}return i}matchingRuleForEventWithRulesets(e,n){return!n||e.getSender()===this.client.getSafeUserId()?null:this.matchingRuleFromKindSet(e,n.global)}pushActionsForEventAndRulesets(e,n){var r=this.matchingRuleForEventWithRulesets(e,n);if(!r)return{};var i=ka.actionListToActionsObject(r.actions);return i.tweaks.highlight===void 0&&(i.tweaks.highlight=r.kind==ui.ContentSpecific),{actions:i,rule:r}}ruleMatchesEvent(e,n){var r;return this.client.supportsIntentionalMentions()&&n.getContent()["m.mentions"]!==void 0&&(e.rule_id===ci.ContainsUserName||e.rule_id===ci.ContainsDisplayName||e.rule_id===ci.AtRoomNotification)?!1:!((r=e.conditions)!==null&&r!==void 0&&r.some(i=>!this.eventFulfillsCondition(i,n)))}actionsForEvent(e){var{actions:n}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return n||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){var n,r=this.getPushRuleAndKindById(e);return(n=r==null?void 0:r.rule)!==null&&n!==void 0?n:null}getPushRuleAndKindById(e){for(var n of["global"]){var r;if(((r=this.client.pushRules)===null||r===void 0?void 0:r[n])!==void 0){for(var i of bF)if(this.client.pushRules[n][i]!==void 0){for(var s of this.client.pushRules[n][i])if(s.rule_id===e)return{rule:s,kind:i}}}}return null}}L(ka,"cachedGlobToRegex",{});var ey=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],Wpe=ey[0],zpe=ey[ey.length-1],io=function(t){return t.SUCCESS="SUCCESS",t.IGNORE="IGNORE",t.PROMPT="PROMPT",t.FAIL_PROMPT="FAIL_PROMPT",t.FAIL_ERROR="FAIL_ERROR",t}({}),ra=function(t){return t.Invalid="Invalid homeserver discovery response",t.GenericFailure="Failed to get autodiscovery configuration from server",t.InvalidHsBaseUrl="Invalid base_url for m.homeserver",t.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",t.InvalidIsBaseUrl="Invalid base_url for m.identity_server",t.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",t.InvalidIs="Invalid identity server discovery response",t.MissingWellknown="No .well-known JSON file found",t.InvalidJson="Invalid JSON",t.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",t}({});class dt{static fromDiscoveryConfig(e){var n=this;return U(function*(){var r,i={"m.homeserver":{state:dt.FAIL_ERROR,error:dt.ERROR_INVALID,base_url:null},"m.identity_server":{state:dt.PROMPT,error:null,base_url:null}};if(!(e!=null&&e["m.homeserver"]))return O.error("No m.homeserver key in config"),i["m.homeserver"].state=dt.FAIL_PROMPT,i["m.homeserver"].error=dt.ERROR_INVALID,Promise.resolve(i);if(!e["m.homeserver"].base_url)return O.error("No m.homeserver base_url in config"),i["m.homeserver"].state=dt.FAIL_PROMPT,i["m.homeserver"].error=dt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);var s=n.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!s)return O.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=dt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);var o=yield n.fetchWellKnownObject("".concat(s,"/_matrix/client/versions"));if(!o||!Array.isArray((r=o.raw)===null||r===void 0?void 0:r.versions))return O.error("Invalid /versions response"),i["m.homeserver"].error=dt.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=s,Promise.resolve(i);var a=new Set(o.raw.versions),l=!1;for(var c of ey)if(a.has(c)){l=!0;break}if(!l)return O.error("Homeserver does not meet version requirements"),i["m.homeserver"].error=dt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,i["m.homeserver"].base_url=s,Promise.resolve(i);i["m.homeserver"]={state:dt.SUCCESS,error:null,base_url:s};var u="";if(e["m.identity_server"]){var f={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:dt.FAIL_PROMPT,error:dt.ERROR_INVALID_IS,base_url:null}};if(u=n.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!u)return O.error("Invalid base_url for m.identity_server"),f["m.identity_server"].error=dt.ERROR_INVALID_IS_BASE_URL,Promise.resolve(f);var p=yield n.fetchWellKnownObject("".concat(u,"/_matrix/identity/v2"));if(!(p!=null&&p.raw)||p.action!==io.SUCCESS)return O.error("Invalid /v2 response"),f["m.identity_server"].error=dt.ERROR_INVALID_IDENTITY_SERVER,f["m.identity_server"].base_url=u,Promise.resolve(f)}return u&&u.toString().length>0&&(i["m.identity_server"]={state:dt.SUCCESS,error:null,base_url:u}),Object.keys(e).forEach(m=>{if(m==="m.homeserver"||m==="m.identity_server"){var v=["error","state","base_url"];for(var g of Object.keys(e[m]))v.includes(g)||(i[m][g]=e[m][g])}else i[m]=e[m]}),Promise.resolve(i)})()}static findClientConfig(e){var n=this;return U(function*(){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");var r={"m.homeserver":{state:dt.FAIL_ERROR,error:dt.ERROR_INVALID,base_url:null},"m.identity_server":{state:dt.PROMPT,error:null,base_url:null}},i=e.includes("://")?e:"https://".concat(e),s=yield n.fetchWellKnownObject("".concat(i,"/.well-known/matrix/client"));return!s||s.action!==io.SUCCESS?(O.error("No response or error when parsing .well-known"),s.reason&&O.error(s.reason),s.action===io.IGNORE?r["m.homeserver"]={state:dt.PROMPT,error:null,base_url:null}:(r["m.homeserver"].state=dt.FAIL_PROMPT,r["m.homeserver"].error=dt.ERROR_INVALID),Promise.resolve(r)):dt.fromDiscoveryConfig(s.raw)})()}static getRawClientConfig(e){var n=this;return U(function*(){var r;if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");var i=yield n.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"));return i?(r=i.raw)!==null&&r!==void 0?r:{}:{}})()}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var n,r;try{r=new URL(e)}catch(a){O.error("Could not parse url",a)}if(!((n=r)!==null&&n!==void 0&&n.hostname)||r.protocol!=="http:"&&r.protocol!=="https:")return!1;var i=r.port?":".concat(r.port):"",s=r.pathname?r.pathname:"",o="".concat(r.protocol,"//").concat(r.hostname).concat(i).concat(s);return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(a){return O.error(a),!1}}static fetch(e,n){return this.fetchFn?this.fetchFn(e,n):globalThis.fetch(e,n)}static setFetchFn(e){dt.fetchFn=e}static fetchWellKnownObject(e){return U(function*(){var n;try{if(n=yield dt.fetch(e,{method:le.Get,signal:RC(5e3)}),n.status===404)return{raw:{},action:io.IGNORE,reason:dt.ERROR_MISSING_WELLKNOWN};if(n.status!==200)return{raw:{},action:io.FAIL_PROMPT,reason:"General failure"}}catch(o){var r=o,i="";return typeof r=="object"&&(i=r==null?void 0:r.message),{error:r,raw:{},action:io.FAIL_PROMPT,reason:i||"General failure"}}try{return{raw:yield n.json(),action:io.SUCCESS}}catch(o){var s=o;return{error:s,raw:{},action:io.FAIL_PROMPT,reason:(s==null?void 0:s.name)==="SyntaxError"?dt.ERROR_INVALID_JSON:dt.ERROR_INVALID}}})()}}L(dt,"ERROR_INVALID",ra.Invalid);L(dt,"ERROR_GENERIC_FAILURE",ra.GenericFailure);L(dt,"ERROR_INVALID_HS_BASE_URL",ra.InvalidHsBaseUrl);L(dt,"ERROR_INVALID_HOMESERVER",ra.InvalidHomeserver);L(dt,"ERROR_INVALID_IS_BASE_URL",ra.InvalidIsBaseUrl);L(dt,"ERROR_INVALID_IDENTITY_SERVER",ra.InvalidIdentityServer);L(dt,"ERROR_INVALID_IS",ra.InvalidIs);L(dt,"ERROR_MISSING_WELLKNOWN",ra.MissingWellknown);L(dt,"ERROR_INVALID_JSON",ra.InvalidJson);L(dt,"ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION",ra.UnsupportedHomeserverSpecVersion);L(dt,"ALL_ERRORS",Object.keys(ra));L(dt,"FAIL_ERROR",io.FAIL_ERROR);L(dt,"FAIL_PROMPT",io.FAIL_PROMPT);L(dt,"PROMPT",io.PROMPT);L(dt,"SUCCESS",io.SUCCESS);L(dt,"fetchFn",void 0);var ax=function(t){return t.IS="SERVICE_TYPE_IS",t.IM="SERVICE_TYPE_IM",t}({});class Ype{constructor(e){this.ourEvent=e,L(this,"timeline",void 0),L(this,"ourEventIndex",0),L(this,"paginateTokens",{[_t.Backward]:null,[_t.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.paginateTokens[e?_t.Backward:_t.Forward]}setPaginateToken(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.paginateTokens[n?_t.Backward:_t.Forward]=e??null}addEvents(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class PC{static fromJson(e,n){var r=e.context||{},i=(r.events_before||[]).map(n),s=(r.events_after||[]).map(n),o=new Ype(n(e.result)),a=o.ourEvent.threadRootId;return i=i.filter(l=>l.threadRootId===a),s=s.filter(l=>l.threadRootId===a),o.setPaginateToken(r.start,!0),o.addEvents(i,!0),o.addEvents(s,!1),o.setPaginateToken(r.end,!1),new PC(e.rank,o)}constructor(e,n){this.rank=e,this.context=n}}var HW=function(t){return t.Public="public",t.Private="private",t}({}),LC=function(t){return t.PrivateChat="private_chat",t.TrustedPrivateChat="trusted_private_chat",t.PublicChat="public_chat",t}({}),Td=function(t){return t.Public="public",t.Invite="invite",t.Private="private",t.Knock="knock",t.Restricted="restricted",t}({}),Xpe=function(t){return t.RoomMembership="m.room_membership",t}({}),VE=function(t){return t.CanJoin="can_join",t.Forbidden="forbidden",t}({}),QL=function(t){return t.Invited="invited",t.Joined="joined",t.Shared="shared",t.WorldReadable="world_readable",t}({});function EF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function wF(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?EF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):EF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Jpe(t,e){var n=!!e.preventReEmit,r=e.decrypt!==!1;function i(s){var o=t.getRoom(s.room_id),a;o&&s.state_key===void 0&&(a=o.findEventById(s.event_id)),!a||a.status?a=new Bi(s):(a.setUnsigned(wF(wF({},a.getUnsigned()),s.unsigned)),n=!0);var l=a.getServerAggregatedRelation(Tn.Replace);if(l!=null&&l.content){var c=i(l);a.makeReplaced(c)}var u=o==null?void 0:o.findThreadForEvent(a);return u&&a.setThread(u),a.isEncrypted()&&(n||t.reEmitter.reEmit(a,[Ht.Decrypted]),r&&t.decryptEventIfNeeded(a)),n||(t.reEmitter.reEmit(a,[Ht.Replaced,Ht.VisibilityChange]),o==null||o.reEmitter.reEmit(a,[Ht.BeforeRedaction])),a}return i}function CF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Vu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class TF{constructor(e,n,r){this.client=e,this.indexEvent=n,this.directory=r}get id(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return this.indexEvent.getContent().active===!0}get version(){var e;return(e=this.indexEvent.getContent().version)!==null&&e!==void 0?e:1}get roomId(){return this.indexEvent.getRoomId()}delete(){var e=this;return U(function*(){yield e.client.sendStateEvent(e.roomId,Pc.name,{},e.id),yield e.client.redactEvent(e.roomId,e.id);var n=(yield e.getVersionHistory())[1];n&&(yield n.delete())})()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){var n=this;return U(function*(){yield n.client.sendStateEvent(n.roomId,Pc.name,Vu(Vu({},n.indexEvent.getContent()),{},{name:e}),n.id)})()}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(e){var n=this;return U(function*(){yield n.client.sendStateEvent(n.roomId,Pc.name,Vu(Vu({},n.indexEvent.getContent()),{},{locked:e}),n.id)})()}getFileInfo(){var e=this;return U(function*(){var n=yield e.getFileEvent(),r=n.getOriginalContent().file,i=e.client.mxcUrlToHttp(r.url);if(!i)throw new Error("No HTTP URL available for ".concat(r.url));return{info:r,httpUrl:i}})()}getFileEvent(){var e=this;return U(function*(){var n=e.client.getRoom(e.roomId);if(!n)throw new Error("Unknown room");for(var r=n.getUnfilteredTimelineSet().findEventById(e.id);!r&&n.getLiveTimeline().getState(Le.BACKWARDS).paginationToken;)yield e.client.scrollback(n,100),r=n.getUnfilteredTimelineSet().findEventById(e.id);if(!r)throw new Error("Failed to find event");return yield e.client.decryptEventIfNeeded(r),r})()}createNewVersion(e,n,r,i){var s=this;return U(function*(){var o=yield s.directory.createFile(e,n,r,Vu(Vu({},i??{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:Tn.Replace,event_id:s.id}}));return yield s.client.sendStateEvent(s.roomId,Pc.name,{active:!0,name:e,version:s.version+1},o.event_id),yield s.client.sendStateEvent(s.roomId,Pc.name,Vu(Vu({},s.indexEvent.getContent()),{},{active:!1}),s.id),o})()}getVersionHistory(){var e=this;return U(function*(){var n=[];n.push(e);var r=e.client.getRoom(e.roomId);if(!r)throw new Error("Invalid or unknown room");var i=[...r.getLiveTimeline().getEvents()].reverse(),s,o=yield e.getFileEvent();do if(s=i.find(l=>l.replacingEventId()===o.getId()),s){var a=e.directory.getFile(s.getId());if(a)n.push(a),o=s;else break}while(s);return n})()}}function RF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Nf(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?RF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):RF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Zpe={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[ee.RoomPowerLevels]:100,[ee.RoomHistoryVisibility]:100,[ee.RoomTombstone]:100,[ee.RoomEncryption]:100,[ee.RoomName]:50,[ee.RoomMessage]:50,[ee.RoomMessageEncrypted]:50,[ee.Sticker]:50},users:{}},Mp=function(t){return t.Viewer="viewer",t.Editor="editor",t.Owner="owner",t}({});class IF{constructor(e,n){if(this.client=e,this.roomId=n,L(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){var e=this.room.currentState.getStateEvents(ee.SpaceParent);return e!=null&&e.length?e.every(n=>{var r;return!((r=n.getContent())!==null&&r!==void 0&&r.via)}):!0}setName(e){var n=this;return U(function*(){yield n.client.sendStateEvent(n.roomId,ee.RoomName,{name:e},"")})()}invite(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!0,s=[r.retryInvite(e)];i&&s.push(...r.getDirectories().map(o=>o.invite(e,i))),yield Promise.all(s)})()}retryInvite(e){var n=this;return Ffe(U(function*(){yield n.client.invite(n.roomId,e).catch(r=>{throw(r==null?void 0:r.errcode)==="M_FORBIDDEN"?new FK.AbortError(r):r})}))}setPermissions(e,n){var r=this;return U(function*(){var i,s=r.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(s))throw new Error("Unexpected return type for power levels");var o=(s==null?void 0:s.getContent())||{},a=o.users_default||0,l=o.events_default||50,c=((i=o.events)===null||i===void 0?void 0:i[ee.RoomPowerLevels])||100,u=o.users||{};switch(n){case Mp.Viewer:u[e]=a;break;case Mp.Editor:u[e]=l;break;case Mp.Owner:u[e]=c;break;default:throw new Error("Invalid role: "+n)}o.users=u,yield r.client.sendStateEvent(r.roomId,ee.RoomPowerLevels,o,"")})()}getPermissions(e){var n,r,i=this.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");var s=(i==null?void 0:i.getContent())||{},o=s.users_default||0,a=s.events_default||50,l=((n=s.events)===null||n===void 0?void 0:n[ee.RoomPowerLevels])||100,c=((r=s.users)===null||r===void 0?void 0:r[e])||o;return c>=l?Mp.Owner:c>=a?Mp.Editor:Mp.Viewer}createDirectory(e){var n=this;return U(function*(){var r=yield n.client.unstableCreateFileTree(e);return yield n.client.sendStateEvent(n.roomId,ee.SpaceChild,{via:[n.client.getDomain()]},r.roomId),yield n.client.sendStateEvent(r.roomId,ee.SpaceParent,{via:[n.client.getDomain()]},n.roomId),r})()}getDirectories(){var e=[],n=this.room.currentState.getStateEvents(ee.SpaceChild);for(var r of n)try{var i=r.getStateKey();if(i){var s=this.client.unstableGetFileTreeSpace(i);s&&e.push(s)}}catch(o){O.warn("Unable to create tree space instance for listing. Are we joined?",o)}return e}getDirectory(e){return this.getDirectories().find(n=>n.roomId===e)}delete(){var e=this;return U(function*(){var n=e.getDirectories();for(var r of n)yield r.delete();var i=[qe.Invite,qe.Knock,qe.Join],s=e.room.currentState.getStateEvents(ee.RoomMember);for(var o of s){var a=o.getStateKey()!==e.client.getUserId();if(a&&i.includes(o.getContent().membership)){var l=o.getStateKey();if(!l)throw new Error("State key not found for branch");yield e.client.kick(e.roomId,l,"Room deleted")}}yield e.client.leave(e.roomId)})()}getOrderedChildren(e){var n=e.map(r=>({roomId:r.getStateKey(),order:r.getContent().order})).filter(r=>r.roomId);return n.sort((r,i)=>{if(r.order&&!i.order)return-1;if(!r.order&&i.order)return 1;if(!r.order&&!i.order){var s,o,a,l,c=this.client.getRoom(r.roomId),u=this.client.getRoom(i.roomId);if(!c||!u)return _2(r.roomId,i.roomId);var f=(s=(o=c.currentState.getStateEvents(ee.RoomCreate,""))===null||o===void 0?void 0:o.getTs())!==null&&s!==void 0?s:0,p=(a=(l=u.currentState.getStateEvents(ee.RoomCreate,""))===null||l===void 0?void 0:l.getTs())!==null&&a!==void 0?a:0;return f===p?_2(r.roomId,i.roomId):f-p}else return _2(r.order,i.order)}),n}getParentRoom(){var e=this.room.currentState.getStateEvents(ee.SpaceParent),n=e[0];if(!n)throw new Error("Expected to have a parent in a non-top level space");var r=n.getStateKey();if(!r)throw new Error("No state key found for parent");var i=this.client.getRoom(r);if(!i)throw new Error("Unable to locate room for parent");return i}getOrder(){if(this.isTopLevel)return-1;var e=this.getParentRoom(),n=e.currentState.getStateEvents(ee.SpaceChild),r=this.getOrderedChildren(n);return r.findIndex(i=>i.roomId===this.roomId)}setOrder(e){var n=this;return U(function*(){var r;if(n.isTopLevel)throw new Error("Cannot set order of top level spaces currently");var i=n.getParentRoom(),s=i.currentState.getStateEvents(ee.SpaceChild),o=n.getOrderedChildren(s);e=Math.max(Math.min(e,o.length-1),0);var a=n.getOrder(),l=a<e;l&&e===o.length-1?e--:!l&&e===0&&e++;var c=o[l?e:e-1],u=o[l?e+1:e],f=Dd[0],p=!1;if(!c)u!=null&&u.order&&(f=gD(u.order));else if(e===o.length-1)u!=null&&u.order&&(f=o0(u.order));else{var m=c==null?void 0:c.order,v=u==null?void 0:u.order;m&&v?m===v?f=o0(m):f=Ufe(m,v):m?f=o0(m):v?f=gD(v):p=!0}if(p){for(var g,S=0;S<=e;S++){var b=o[S];if(S===0&&(g=b.order),b.order)g=b.order;else{var w;g=g?o0(g):Dd[0];var k=i.currentState.getStateEvents(ee.SpaceChild,b.roomId),T=(w=k==null?void 0:k.getContent())!==null&&w!==void 0?w:{via:[n.client.getDomain()]};yield n.client.sendStateEvent(i.roomId,ee.SpaceChild,Nf(Nf({},T),{},{order:g}),b.roomId)}}g&&(f=o0(g))}var I=i.currentState.getStateEvents(ee.SpaceChild,n.roomId),C=(r=I==null?void 0:I.getContent())!==null&&r!==void 0?r:{via:[n.client.getDomain()]};yield n.client.sendStateEvent(i.roomId,ee.SpaceChild,Nf(Nf({},C),{},{order:f}),n.roomId)})()}createFile(e,n,r,i){var s=this;return U(function*(){var{content_uri:o}=yield s.client.uploadContent(n,{includeFilename:!1});r.url=o;var a={msgtype:ql.File,body:e,url:o,file:r};i=i??{},i["m.new_content"]&&(i["m.new_content"]=a);var l=yield s.client.sendMessage(s.roomId,Nf(Nf(Nf({},i),a),{},{[KK.name]:{}}));return yield s.client.sendStateEvent(s.roomId,Pc.name,{active:!0,name:e},l.event_id),l})()}getFile(e){var n=this.room.currentState.getStateEvents(Pc.name,e);return n?new TF(this.client,n,this):null}listFiles(){return this.listAllFiles().filter(e=>e.isActive)}listAllFiles(){var e,n=(e=this.room.currentState.getStateEvents(Pc.name))!==null&&e!==void 0?e:[];return n.map(r=>new TF(this.client,r,this))}}var VW=function(t){return t.Recent="recent",t.Rank="rank",t}({}),Kf=function(t){return t.LocalStreamsChanged="local_streams_changed",t}({});class Qpe extends Un{constructor(e){super(),this.client=e,L(this,"audioInput",void 0),L(this,"audioSettings",void 0),L(this,"videoInput",void 0),L(this,"localUserMediaStream",void 0),L(this,"userMediaStreams",[]),L(this,"screensharingStreams",[]),L(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,n){this.audioInput=e,this.videoInput=n}setAudioInput(e){var n=this;return U(function*(){O.info("MediaHandler setAudioInput() running (deviceId=".concat(e,")")),n.audioInput!==e&&(n.audioInput=e,yield n.updateLocalUsermediaStreams())})()}setAudioSettings(e){var n=this;return U(function*(){O.info("MediaHandler setAudioSettings() running (opts=".concat(JSON.stringify(e),")")),n.audioSettings=Object.assign({},e),yield n.updateLocalUsermediaStreams()})()}setVideoInput(e){var n=this;return U(function*(){O.info("MediaHandler setVideoInput() running (deviceId=".concat(e,")")),n.videoInput!==e&&(n.videoInput=e,yield n.updateLocalUsermediaStreams())})()}setMediaInputs(e,n){var r=this;return U(function*(){O.log("MediaHandler setMediaInputs() running (audioInput: ".concat(e," videoInput: ").concat(n,")")),r.audioInput=e,r.videoInput=n,yield r.updateLocalUsermediaStreams()})()}updateLocalUsermediaStreams(){var e=this;return U(function*(){if(e.userMediaStreams.length!==0){var n=new Map;for(var r of e.client.callEventHandler.calls.values())n.set(r.callId,{audio:r.hasLocalUserMediaAudioTrack,video:r.hasLocalUserMediaVideoTrack});for(var i of e.userMediaStreams){O.log("MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=".concat(i.id,")"));for(var s of i.getTracks())s.stop()}e.userMediaStreams=[],e.localUserMediaStream=void 0;for(var o of e.client.callEventHandler.calls.values())if(!(o.callHasEnded()||!n.has(o.callId))){var{audio:a,video:l}=n.get(o.callId);O.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=".concat(o.callId,")"));var c=yield e.getUserMediaStream(a,l);o.callHasEnded()||(yield o.updateLocalUsermediaStream(c))}for(var u of e.client.groupCallEventHandler.groupCalls.values())if(u.localCallFeed){O.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=".concat(u.groupCallId,")"));var f=yield e.getUserMediaStream(!0,u.type===xC.Video);u.state!==Jn.Ended&&(yield u.updateLocalUsermediaStream(f))}e.emit(Kf.LocalStreamsChanged)}})()}hasAudioDevice(){return U(function*(){try{var e=yield navigator.mediaDevices.enumerateDevices();return e.filter(n=>n.kind==="audioinput").length>0}catch(n){return O.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",n),!1}})()}hasVideoDevice(){return U(function*(){try{var e=yield navigator.mediaDevices.enumerateDevices();return e.filter(n=>n.kind==="videoinput").length>0}catch(n){return O.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",n),!1}})()}getUserMediaStream(e,n){var r=arguments,i=this;return U(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:!0;return i.getMediaStreamPromise?i.getMediaStreamPromise=i.getMediaStreamPromise.then(()=>i.getUserMediaStreamInternal(e,n,s)):i.getMediaStreamPromise=i.getUserMediaStreamInternal(e,n,s),i.getMediaStreamPromise})()}getUserMediaStreamInternal(e,n,r){var i=this;return U(function*(){var s=e&&(yield i.hasAudioDevice()),o=n&&(yield i.hasVideoDevice()),a,l=!0;if(i.localUserMediaStream){var c,u;s!==i.localUserMediaStream.getAudioTracks().length>0&&(l=!1),o!==i.localUserMediaStream.getVideoTracks().length>0&&(l=!1),s&&((c=i.localUserMediaStream.getAudioTracks()[0])===null||c===void 0||(c=c.getSettings())===null||c===void 0?void 0:c.deviceId)!==i.audioInput&&(l=!1),o&&((u=i.localUserMediaStream.getVideoTracks()[0])===null||u===void 0||(u=u.getSettings())===null||u===void 0?void 0:u.deviceId)!==i.videoInput&&(l=!1)}else l=!1;if(l){var v;if(a=i.localUserMediaStream.clone(),O.log("MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=".concat((v=i.localUserMediaStream)===null||v===void 0?void 0:v.id," newStreamId=").concat(a.id," shouldRequestAudio=").concat(s," shouldRequestVideo=").concat(o,")")),!s)for(var g of a.getAudioTracks())a.removeTrack(g);if(!o)for(var S of a.getVideoTracks())a.removeTrack(S)}else{var f=i.getUserMediaContraints(s,o);a=yield navigator.mediaDevices.getUserMedia(f),O.log("MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=".concat(a.id,", shouldRequestAudio=").concat(s,", shouldRequestVideo=").concat(o,", constraints=").concat(JSON.stringify(f),")"));for(var p of a.getTracks()){var m=p.getSettings();p.kind==="audio"?i.audioInput=m.deviceId:p.kind==="video"&&(i.videoInput=m.deviceId)}r&&(i.localUserMediaStream=a)}return r&&i.userMediaStreams.push(a),i.emit(Kf.LocalStreamsChanged),a})()}stopUserMediaStream(e){O.log("MediaHandler stopUserMediaStream() stopping (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop();var r=this.userMediaStreams.indexOf(e);if(r!==-1&&(O.debug("MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=".concat(e.id,")"),e.id),this.userMediaStreams.splice(r,1)),this.emit(Kf.LocalStreamsChanged),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(var i of e.getTracks()){var s;if((s=this.localUserMediaStream)!==null&&s!==void 0&&s.getTrackById(i.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}}getScreensharingStream(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{},i=e.length>1&&e[1]!==void 0?e[1]:!0,s;if(n.screensharingStreams.length===0){var o=n.getScreenshareContraints(r);r.desktopCapturerSourceId?(O.debug("MediaHandler getScreensharingStream() calling getUserMedia() (opts=".concat(JSON.stringify(r),")")),s=yield navigator.mediaDevices.getUserMedia(o)):(O.debug("MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=".concat(JSON.stringify(r),")")),s=yield navigator.mediaDevices.getDisplayMedia(o))}else{var a=n.screensharingStreams[n.screensharingStreams.length-1];O.log("MediaHandler getScreensharingStream() cloning (streamId=".concat(a.id,")")),s=a.clone()}return i&&n.screensharingStreams.push(s),n.emit(Kf.LocalStreamsChanged),s})()}stopScreensharingStream(e){O.debug("MediaHandler stopScreensharingStream() stopping stream (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop();var r=this.screensharingStreams.indexOf(e);r!==-1&&(O.debug("MediaHandler stopScreensharingStream() splicing stream out (streamId=".concat(e.id,")")),this.screensharingStreams.splice(r,1)),this.emit(Kf.LocalStreamsChanged)}stopAllStreams(){for(var e of this.userMediaStreams){O.log("MediaHandler stopAllStreams() stopping (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop()}for(var r of this.screensharingStreams)for(var i of r.getTracks())i.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(Kf.LocalStreamsChanged)}getUserMediaContraints(e,n){var r=!!navigator.webkitGetUserMedia;return{audio:e?{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0}:!1,video:n?{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}:!1}}getScreenshareContraints(e){var{desktopCapturerSourceId:n,audio:r}=e;return n?{audio:r??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n}}}:{audio:r??!1,video:!0}}}var kF=function(t){return t.RequestFinished="FINISHED",t.Complete="COMPLETE",t}({}),e_=function(t){return t.PreProcess="ExtState.PreProcess",t.PostProcess="ExtState.PostProcess",t}({}),lx=function(t){return t.RoomData="SlidingSync.RoomData",t.Lifecycle="SlidingSync.Lifecycle",t}({}),eme=3;class tme{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return e_.PreProcess}onRequest(e){var n=this;return U(function*(){return e&&(O.log("ExtensionE2EE: invalidating all device lists due to missing 'pos'"),yield n.crypto.markAllTrackedUsersAsDirty()),{enabled:!0}})()}onResponse(e){var n=this;return U(function*(){e.device_lists&&(yield n.crypto.processDeviceLists(e.device_lists)),yield n.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),n.crypto.onSyncCompleted({})})()}}class nme{constructor(e,n){this.client=e,this.cryptoCallbacks=n,L(this,"nextBatch",null)}name(){return"to_device"}when(){return e_.PreProcess}onRequest(e){var n=this;return U(function*(){return{since:n.nextBatch!==null?n.nextBatch:void 0,limit:100,enabled:!0}})()}onResponse(e){var n=this;return U(function*(){var r=[],i=e.events||[];i.length>0&&n.cryptoCallbacks&&(i=yield n.cryptoCallbacks.preprocessToDeviceMessages(i)),i.map(DW).map(s=>{if(s.getType()==="m.key.verification.cancel"){var o=s.getContent().transaction_id;o&&r.push(o)}return s}).forEach(s=>{var o=s.getContent();if(s.getType()=="m.room.message"&&o.msgtype=="m.bad.encrypted"){O.log("Ignoring undecryptable to-device event from "+s.getSender());return}if(s.getType()==="m.key.verification.start"||s.getType()==="m.key.verification.request"){var a=o.transaction_id;r.includes(a)&&s.flagCancelled()}n.client.emit(Ae.ToDeviceEvent,s)}),n.nextBatch=e.next_batch})()}}class rme{constructor(e){this.client=e}name(){return"account_data"}when(){return e_.PostProcess}onRequest(e){return U(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return U(function*(){e.global&&e.global.length>0&&n.processGlobalAccountData(e.global);for(var r in e.rooms){var i=Im(n.client,r,e.rooms[r]),s=n.client.getRoom(r);if(!s){O.warn("got account data for room but room doesn't exist on client:",r);continue}s.addAccountData(i),i.forEach(o=>{n.client.emit(Ae.Event,o)})}})()}processGlobalAccountData(e){var n=Im(this.client,void 0,e),r=n.reduce((i,s)=>(i[s.getType()]=this.client.store.getAccountData(s.getType()),i),{});this.client.store.storeAccountDataEvents(n),n.forEach(i=>{if(i.getType()===ee.PushRules){var s=i.getContent();this.client.setPushRules(s)}var o=r[i.getType()];return this.client.emit(Ae.AccountData,i,o),i})}}class ime{constructor(e){this.client=e}name(){return"typing"}when(){return e_.PostProcess}onRequest(e){return U(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return U(function*(){if(e!=null&&e.rooms)for(var r in e.rooms)qW(n.client,r,[e.rooms[r]])})()}}class sme{constructor(e){this.client=e}name(){return"receipts"}when(){return e_.PostProcess}onRequest(e){return U(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return U(function*(){if(e!=null&&e.rooms)for(var r in e.rooms)qW(n.client,r,[e.rooms[r]])})()}}class GW{constructor(e,n,r,i){this.slidingSync=e,this.client=n,L(this,"opts",void 0),L(this,"syncOpts",void 0),L(this,"syncState",null),L(this,"syncStateData",void 0),L(this,"lastPos",null),L(this,"failCount",0),L(this,"notifEvents",[]),this.opts=OW(r),this.syncOpts=MW(i),n.getNotifTimelineSet()&&n.reEmitter.reEmit(n.getNotifTimelineSet(),[xe.Timeline,xe.TimelineReset]),this.slidingSync.on(lx.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(lx.RoomData,this.onRoomData.bind(this));var s=[new nme(this.client,this.syncOpts.cryptoCallbacks),new rme(this.client),new ime(this.client),new sme(this.client)];this.syncOpts.cryptoCallbacks&&s.push(new tme(this.syncOpts.cryptoCallbacks)),s.forEach(o=>{this.slidingSync.registerExtension(o)})}onRoomData(e,n){var r=this;return U(function*(){var i=r.client.store.getRoom(e);if(!i){if(!n.initial){O.debug("initial flag not set but no stored room exists for room ",e,n);return}i=NW(r.client,e,r.opts)}yield r.processRoomData(r.client,i,n)})()}onLifecycle(e,n,r){switch(r&&O.debug("onLifecycle",e,r),e){case kF.Complete:if(this.purgeNotifications(),!n)break;this.lastPos||this.updateSyncState(qt.Prepared,{oldSyncToken:void 0,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(qt.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.lastPos=n.pos;break;case kF.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>eme?qt.Error:qt.Reconnecting,{error:new Nn(r)}),this.shouldAbortSync(new Nn(r)))return}else this.failCount=0,O.log("SlidingSyncState.RequestFinished with ".concat(Object.keys((n==null?void 0:n.rooms)||[]).length," rooms"));break}}syncLeftRooms(){return U(function*(){return[]})()}peek(e){return U(function*(){return null})()}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){var e;return(e=this.syncStateData)!==null&&e!==void 0?e:null}createRoom(e){var{timelineSupport:n}=this.client,r=new IC(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n});return this.client.reEmitter.reEmit(r,[xe.Name,xe.Redaction,xe.RedactionCancelled,xe.Receipt,xe.Tags,xe.LocalEchoUpdated,xe.AccountData,xe.MyMembership,xe.Timeline,xe.TimelineReset]),this.registerStateListeners(r),r}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[gt.Events,gt.Members,gt.NewMember,gt.Update]),e.currentState.on(gt.NewMember,(n,r,i)=>{var s;i.user=(s=this.client.getUser(i.userId))!==null&&s!==void 0?s:void 0,this.client.reEmitter.reEmit(i,[Is.Name,Is.Typing,Is.PowerLevel,Is.Membership])})}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(O.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(qt.Error,{error:e}),!0):!1}processRoomData(e,n,r){var i=this;return U(function*(){r=ome(e,n.roomId,r);var s=Im(i.client,n.roomId,r.required_state),o=Im(i.client,n.roomId,r.timeline,!1),a=[];if(r.limited||r.initial){var l=new Set;n.getLiveTimeline().getEvents().forEach(w=>{l.add(w.getId())});for(var c=[],u=[],f=!1,p=o.length-1;p>=0;p--){var m=o[p];if(l.has(m.getId())){f=!0;continue}f?c.push(m):u.unshift(m)}o=u,c.length>0&&n.addEventsToTimeline(c,!0,!1,n.getLiveTimeline(),r.prev_batch)}var v=n.hasEncryptionStateEvent();if(r.notification_count!=null&&n.setUnreadNotificationCount(Kt.Total,r.notification_count),r.highlight_count!=null&&(!v||v&&n.getUnreadNotificationCount(Kt.Highlight)<=0)&&n.setUnreadNotificationCount(Kt.Highlight,r.highlight_count),r.bump_stamp&&n.setBumpStamp(r.bump_stamp),Number.isInteger(r.invited_count)&&n.currentState.setInvitedMemberCount(r.invited_count),Number.isInteger(r.joined_count)&&n.currentState.setJoinedMemberCount(r.joined_count),r.invite_state){var g=Im(i.client,n.roomId,r.invite_state);yield i.injectRoomEvents(n,g),r.initial&&(n.recalculate(),i.client.store.storeRoom(n),i.client.emit(Ae.Room,n)),g.forEach(w=>{i.client.emit(Ae.Event,w)});return}if(r.limited){var S;n.getLiveTimeline().setPaginationToken((S=r.prev_batch)!==null&&S!==void 0?S:null,Le.BACKWARDS)}yield i.injectRoomEvents(n,s,o,r.num_live),n.addEphemeralEvents(a),n.updateMyMembership(qe.Join),n.setMSC4186SummaryData(r.heroes,r.joined_count,r.invited_count),n.recalculate(),r.initial&&(e.store.storeRoom(n),e.emit(Ae.Room,n)),i.addNotifications(o);var b=function(){var w=U(function*(k){e.emit(Ae.Event,k),k.isState()&&k.getType()==ee.RoomEncryption&&i.syncOpts.cryptoCallbacks&&(yield i.syncOpts.cryptoCallbacks.onCryptoEvent(n,k))});return function(T){return w.apply(this,arguments)}}();yield dm(s,b),yield dm(o,b),a.forEach(function(w){e.emit(Ae.Event,w)}),n.decryptCriticalEvents()})()}injectRoomEvents(e,n){var r=arguments,i=this;return U(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:[],o=r.length>3&&r[3]!==void 0?r[3]:0,a=e.getLiveTimeline(),l=a.getEvents().length==0;if(l){for(var c of n)i.client.getPushActionsForEvent(c);a.initialiseState(n)}l||(e.oldState.setStateEvents(n),e.currentState.setStateEvents(n));var u=[];o>0&&(u=s.slice(-1*o),s=s.slice(0,-1*u.length)),yield e.addLiveEvents(s,{fromCache:!0,addToState:!1}),u.length>0&&(yield e.addLiveEvents(u,{fromCache:!1,addToState:!1})),e.recalculate(),i.resolveInvites(e)})()}resolveInvites(e){if(!(!e||!this.opts.resolveInvitesToProfiles)){var n=this.client;e.getMembersWithMembership(qe.Invite).forEach(function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var i=n.getUser(r.userId),s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){var a=r.events.member;a.getContent().membership===qe.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})}})}}retryImmediately(){return!0}sync(){var e=this;return U(function*(){for(O.debug("Sliding sync init loop");!e.client.isGuest();)try{O.debug("Getting push rules...");var n=yield e.client.getPushRules();O.debug("Got push rules"),e.client.pushRules=n;break}catch(r){if(O.error("Getting push rules failed",r),e.shouldAbortSync(r))return}yield e.slidingSync.start()})()}stop(){O.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,n){var r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(Ae.Sync,this.syncState,r,n)}addNotifications(e){if(this.client.getNotifTimelineSet())for(var n of e){var r=this.client.getPushActionsForEvent(n);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this.notifEvents.push(n)}}purgeNotifications(){this.notifEvents.sort(function(e,n){return e.getTs()-n.getTs()}),this.notifEvents.forEach(e=>{var n;(n=this.client.getNotifTimelineSet())===null||n===void 0||n.addLiveEvent(e,{addToState:!1})}),this.notifEvents=[]}}function ome(t,e,n){if(!n.name)return n;for(var r of n.required_state)if(r.type===ee.RoomName&&r.state_key==="")return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+e,state_key:"",type:ee.RoomName,content:{name:n.name},sender:t.getUserId(),origin_server_ts:new Date().getTime()}),n}function Im(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=t.getEventMapper({decrypt:r});return n.map(function(s){return s.room_id=e,i(s)})}function qW(t,e,n){var r=Im(t,e,n),i=t.getRoom(e);if(!i){O.warn("got ephemeral events for room but room doesn't exist on client:",e);return}i.addEphemeralEvents(r),r.forEach(s=>{t.emit(Ae.Event,s)})}var eA=new wr("m.beacon_info","org.matrix.msc3672.beacon_info"),cx=new wr("m.beacon","org.matrix.msc3672.beacon");class ag{static RETRY_BACKOFF_RATELIMIT(e,n,r){return KL(r,n,!1)}static QUEUE_MESSAGES(e){return e.getType()===ee.RoomMessage||e.hasAssociation()?"message":null}constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ag.RETRY_BACKOFF_RATELIMIT,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ag.QUEUE_MESSAGES;this.retryAlgorithm=e,this.queueAlgorithm=n,L(this,"queues",{}),L(this,"activeQueues",[]),L(this,"procFn",null),L(this,"processQueue",r=>{var i=this.peekNextEvent(r);if(!i){this.disableQueue(r);return}this.queues[r].length,Promise.resolve().then(()=>this.procFn(i.event)).then(s=>{this.removeNextEvent(r),i.event.getId(),i.resolvers.resolve(s),this.processQueue(r)},s=>{i.attempts+=1;var o=this.retryAlgorithm(i.event,i.attempts,s);i.attempts,i.event.getId(),o===-1?(O.info("Queue '%s' giving up on event %s",r,i.event.getId()),this.clearQueue(r,s)):setTimeout(this.processQueue,o,r)})})}getQueueForEvent(e){var n=this.queueAlgorithm(e);return!n||!this.queues[n]?null:this.queues[n].map(function(r){return r.event})}removeEventFromQueue(e){var n=this.queueAlgorithm(e);if(!n||!this.queues[n])return!1;var r=!1;return OE(this.queues[n],i=>i.event.getId()===e.getId()?(r=!0,!0):!1),r}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){var n=this.queueAlgorithm(e);if(!n)return null;this.queues[n]||(this.queues[n]=[]);var r=Promise.withResolvers();return this.queues[n].push({event:e,resolvers:r,attempts:0}),e.getId(),this.startProcessingQueues(),r.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(e=>this.activeQueues.indexOf(e)===-1&&this.queues[e].length>0).forEach(e=>{this.activeQueues.push(e),this.processQueue(e)})}disableQueue(e){var n=this.activeQueues.indexOf(e);n>=0&&this.activeQueues.splice(n,1),O.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,n){O.info("clearing queue '%s'",e);for(var r;r=this.removeNextEvent(e);)r.resolvers.reject(n);this.disableQueue(e)}peekNextEvent(e){var n=this.queues[e];if(Array.isArray(n))return n[0]}removeNextEvent(e){var n=this.queues[e];if(Array.isArray(n))return n.shift()}}var xF=20;class ame{constructor(e){var n=this;this.client=e,L(this,"sending",!1),L(this,"running",!0),L(this,"retryTimeout",null),L(this,"retryAttempts",0),L(this,"sendQueue",U(function*(){if(n.retryTimeout!==null&&clearTimeout(n.retryTimeout),n.retryTimeout=null,!(n.sending||!n.running)){O.debug("Attempting to send queued to-device messages"),n.sending=!0;var r;try{for(;n.running&&(r=yield n.client.store.getOldestToDeviceBatch(),r!==null);)yield n.sendBatch(r),yield n.client.store.removeToDeviceBatch(r.id),n.retryAttempts=0;if(!n.running)return;O.debug("All queued to-device messages sent")}catch(s){++n.retryAttempts;var i=ag.RETRY_BACKOFF_RATELIMIT(null,n.retryAttempts,s);if(i===-1){Math.floor(s.httpStatus/100)===4?(O.error("Fatal error when sending to-device message - dropping to-device batch!",s),yield n.client.store.removeToDeviceBatch(r.id)):O.info("Automatic retry limit reached for to-device messages.");return}O.info("Failed to send batch of to-device messages. Will retry in ".concat(i,"ms"),s),n.retryTimeout=setTimeout(n.sendQueue,i)}finally{n.sending=!1}}})),L(this,"onResumedSync",(r,i)=>{r===qt.Syncing&&i!==qt.Syncing&&(O.info("Resuming queue after resumed sync"),this.sendQueue())})}start(){this.running=!0,this.sendQueue(),this.client.on(Ae.Sync,this.onResumedSync)}stop(){this.running=!1,this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(Ae.Sync,this.onResumedSync)}queueBatch(e){var n=this;return U(function*(){for(var r=[],i=0;i<e.batch.length;i+=xF){var s={eventType:e.eventType,batch:e.batch.slice(i,i+xF),txnId:n.client.makeTxnId()};r.push(s);var o=s.batch.map(a=>"".concat(a.userId,"/").concat(a.deviceId," (msgid ").concat(a.payload[TC],")"));O.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(s.txnId),o)}yield n.client.store.saveToDeviceBatches(r),n.sendQueue()})()}sendBatch(e){var n=this;return U(function*(){var r=new Bc(()=>new Map);for(var i of e.batch)r.getOrCreate(i.userId).set(i.deviceId,i.payload);O.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),yield n.client.sendToDevice(e.eventType,r,e.txnId)})()}}var PI=new js.UnstableValue("m.policies","org.matrix.msc3847.policies"),oS=new js.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),PF=function(t){return t.Ban="m.ban",t}({}),km=function(t){return t.User="m.policy.user",t.Room="m.policy.room",t.Server="m.policy.server",t}({}),LF={[km.User]:ee.PolicyRuleUser,[km.Room]:ee.PolicyRuleRoom,[km.Server]:ee.PolicyRuleServer};class lme{constructor(e){this.client=e}addRule(e,n,r){var i=this;return U(function*(){var s=yield i.getOrCreateTargetRoom(),o=yield i.client.sendStateEvent(s.roomId,LF[e],{entity:n,reason:r,recommendation:PF.Ban});return o.event_id})()}removeRule(e){var n=this;return U(function*(){yield n.client.redactEvent(e.getRoomId(),e.getId())})()}addSource(e){var n=this;return U(function*(){yield n.client.joinRoom(e);var r=(yield n.getOrCreateSourceRooms()).map(i=>i.roomId);return r.includes(e)?!1:(r.push(e),yield n.withIgnoreInvitesPolicies(i=>{i.sources=r}),!0)})()}getRuleForInvite(e){var n=this;return U(function*(){var{sender:r,roomId:i}=e,s=yield n.getOrCreateSourceRooms(),o=r.split(":")[1],a=i.split(":")[1];for(var l of s){var c=l.getUnfilteredTimelineSet().getLiveTimeline().getState(Le.FORWARDS);for(var{scope:u,entities:f}of[{scope:km.Room,entities:[i]},{scope:km.User,entities:[r]},{scope:km.Server,entities:[o,a]}]){var p=c.getStateEvents(LF[u]);for(var m of p){var v=m.getContent();if((v==null?void 0:v.recommendation)==PF.Ban){var g=v==null?void 0:v.entity;if(g){var S=void 0;try{S=new RegExp($K(g))}catch{continue}for(var b of f)if(b&&S.test(b))return m}}}}}return null})()}getOrCreateTargetRoom(){var e=this;return U(function*(){var n=e.getIgnoreInvitesPolicies(),r=n.target;if(typeof r!="string"&&(r=null),r){var i=e.client.getRoom(r);if(i)return i;r=null}return r=(yield e.client.createRoom({name:"Individual Policy Room",preset:LC.PrivateChat})).room_id,yield e.withIgnoreInvitesPolicies(s=>{s.target=r}),e.client.getRoom(r)})()}getOrCreateSourceRooms(){var e=this;return U(function*(){var n=e.getIgnoreInvitesPolicies(),r=n.sources,i=!1;Array.isArray(r)||(i=!0,r=[]);var s=r.filter(a=>typeof a=="string").map(a=>e.client.getRoom(a)).filter(a=>!!a);if(s.length!=r.length&&(i=!0),s.length==0){var o=yield e.getOrCreateTargetRoom();i=!0,s=[o]}return i&&(yield e.withIgnoreInvitesPolicies(a=>{a.sources=r})),s})()}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(e){var n=this;return U(function*(){var{policies:r,ignoreInvitesPolicies:i}=n.getPoliciesAndIgnoreInvitesPolicies();e(i),r[oS.name]=i,yield n.client.setAccountData(PI.name,r)})()}getPoliciesAndIgnoreInvitesPolicies(){var e={};for(var n of[PI.name,PI.altName]){var r;if(n){var i=(r=this.client.getAccountData(n))===null||r===void 0?void 0:r.getContent();if(i){e=i;break}}}var s={},o=!1;for(var a of[oS.name,oS.altName])if(a){var l=e[a];if(l&&typeof l=="object"){s=l,o=!0;break}}return o||(e[oS.name]=s),{policies:e,ignoreInvitesPolicies:s}}}var LI="matrix-js-sdk";function cme(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let c=0;c<e.length;c++)e[c]=255;for(let c=0;c<t.length;c++){const u=t.charAt(c),f=u.charCodeAt(0);if(e[f]!==255)throw new TypeError(u+" is ambiguous");e[f]=c}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let u=0,f=0,p=0;const m=c.length;for(;p!==m&&c[p]===0;)p++,u++;const v=(m-p)*s+1>>>0,g=new Uint8Array(v);for(;p!==m;){let w=c[p],k=0;for(let T=v-1;(w!==0||k<f)&&T!==-1;T--,k++)w+=256*g[T]>>>0,g[T]=w%n>>>0,w=w/n>>>0;if(w!==0)throw new Error("Non-zero carry");f=k,p++}let S=v-f;for(;S!==v&&g[S]===0;)S++;let b=r.repeat(u);for(;S<v;++S)b+=t.charAt(g[S]);return b}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let u=0,f=0,p=0;for(;c[u]===r;)f++,u++;const m=(c.length-u)*i+1>>>0,v=new Uint8Array(m);for(;c[u];){let w=e[c.charCodeAt(u)];if(w===255)return;let k=0;for(let T=m-1;(w!==0||k<p)&&T!==-1;T--,k++)w+=n*v[T]>>>0,v[T]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");p=k,u++}let g=m-p;for(;g!==m&&v[g]===0;)g++;const S=new Uint8Array(f+(m-g));let b=f;for(;g!==m;)S[b++]=v[g++];return S}function l(c){const u=a(c);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:l}}var ume="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Cnt=cme(ume);var ri=function(t){return t.UserTrustStatusChanged="userTrustStatusChanged",t.KeyBackupStatus="crypto.keyBackupStatus",t.KeyBackupFailed="crypto.keyBackupFailed",t.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",t.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",t.VerificationRequestReceived="crypto.verificationRequestReceived",t.WillUpdateDevices="crypto.willUpdateDevices",t.DevicesUpdated="crypto.devicesUpdated",t.KeysChanged="crossSigning.keysChanged",t.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",t.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",t.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",t.RehydrationStarted="dehydration.RehydrationStarted",t.RehydrationProgress="dehydration.RehydrationProgress",t.RehydrationCompleted="dehydration.RehydrationCompleted",t.RehydrationError="dehydration.RehydrationError",t.DehydrationKeyCached="dehydration.DehydrationKeyCached",t.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",t}({}),AF=function(t){return t.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",t.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",t.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",t.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",t.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",t.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",t.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",t.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",t.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",t.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",t.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t.MEGOLM_BAD_ROOM="MEGOLM_BAD_ROOM",t.MEGOLM_MISSING_FIELDS="MEGOLM_MISSING_FIELDS",t.OLM_DECRYPT_GROUP_MESSAGE_ERROR="OLM_DECRYPT_GROUP_MESSAGE_ERROR",t.OLM_BAD_ENCRYPTED_MESSAGE="OLM_BAD_ENCRYPTED_MESSAGE",t.OLM_BAD_RECIPIENT="OLM_BAD_RECIPIENT",t.OLM_BAD_RECIPIENT_KEY="OLM_BAD_RECIPIENT_KEY",t.OLM_BAD_ROOM="OLM_BAD_ROOM",t.OLM_BAD_SENDER_CHECK_FAILED="OLM_BAD_SENDER_CHECK_FAILED",t.OLM_BAD_SENDER="OLM_BAD_SENDER",t.OLM_FORWARDED_MESSAGE="OLM_FORWARDED_MESSAGE",t.OLM_MISSING_CIPHERTEXT="OLM_MISSING_CIPHERTEXT",t.OLM_NOT_INCLUDED_IN_RECIPIENTS="OLM_NOT_INCLUDED_IN_RECIPIENTS",t.UNKNOWN_ENCRYPTION_ALGORITHM="UNKNOWN_ENCRYPTION_ALGORITHM",t}({}),dme=function(t){return t[t.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",t[t.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",t}({});class Tnt{constructor(e){this.errorOnVerifiedUserProblems=e,L(this,"kind",dme.AllDevicesIsolationMode)}}class Rnt{constructor(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this.crossSigningVerified=e,this.crossSigningVerifiedBefore=n,this.tofu=r,L(this,"needsUserApproval",void 0),this.needsUserApproval=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class Int{constructor(e){var n,r,i,s,o;L(this,"signedByOwner",void 0),L(this,"crossSigningVerified",void 0),L(this,"tofu",void 0),L(this,"localVerified",void 0),L(this,"trustCrossSignedDevices",void 0),this.signedByOwner=(n=e.signedByOwner)!==null&&n!==void 0?n:!1,this.crossSigningVerified=(r=e.crossSigningVerified)!==null&&r!==void 0?r:!1,this.tofu=(i=e.tofu)!==null&&i!==void 0?i:!1,this.localVerified=(s=e.localVerified)!==null&&s!==void 0?s:!1,this.trustCrossSignedDevices=(o=e.trustCrossSignedDevices)!==null&&o!==void 0?o:!1}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var knt=function(t){return t.Fetch="fetch",t.LoadKeys="load_keys",t}({}),xnt=function(t){return t.Master="master",t.SelfSigning="self_signing",t.UserSigning="user_signing",t}({}),Pnt=function(t){return t[t.NONE=0]="NONE",t[t.GREY=1]="GREY",t[t.RED=2]="RED",t}({}),Lnt=function(t){return t[t.UNKNOWN=0]="UNKNOWN",t[t.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",t[t.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",t[t.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",t[t.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",t[t.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",t[t.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",t[t.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",t}({}),fme=new Uint8Array(8);function KW(t,e){return ux.apply(this,arguments)}function ux(){return ux=U(function*(t,e){var n=yield globalThis.crypto.subtle.importKey("raw",t,{name:"HKDF"},!1,["deriveBits"]),r=yield globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:fme,info:new TextEncoder().encode(e),hash:"SHA-256"},n,512),i=r.slice(0,32),s=r.slice(32),o=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([o,a])}),ux.apply(this,arguments)}function WW(t,e,n,r){return dx.apply(this,arguments)}function dx(){return dx=U(function*(t,e,n,r){var i;r?i=Rm(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);var[s,o]=yield KW(e,n),a=new TextEncoder().encode(t),l=yield globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},s,a),c=yield globalThis.crypto.subtle.sign({name:"HMAC"},o,l);return{iv:E2(i),ciphertext:E2(new Uint8Array(l)),mac:E2(new Uint8Array(c))}}),dx.apply(this,arguments)}function hme(t,e,n){return fx.apply(this,arguments)}function fx(){return fx=U(function*(t,e,n){var[r,i]=yield KW(e,n),s=Rm(t.ciphertext);if(!(yield globalThis.crypto.subtle.verify({name:"HMAC"},i,Rm(t.mac),s)))throw new Error("Error decrypting secret ".concat(n,": bad MAC"));var o=yield globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:Rm(t.iv),length:64},r,s);return new TextDecoder().decode(new Uint8Array(o))}),fx.apply(this,arguments)}var Wf="m.secret_storage.v1.aes-hmac-sha2";class zW{constructor(e,n){this.accountDataAdapter=e,this.callbacks=n}getDefaultKeyId(){var e=this;return U(function*(){var n,r=yield e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return r&&(n=r.key)!==null&&n!==void 0?n:null})()}setDefaultKeyId(e){return new Promise((n,r)=>{var i=o=>{if(o.getType()==="m.secret_storage.default_key"){var a=o.getContent(),l=e===null?Object.keys(a).length===0:a.key===e;l&&(this.accountDataAdapter.removeListener(Ae.AccountData,i),n())}};this.accountDataAdapter.on(Ae.AccountData,i);var s=e===null?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",s).catch(o=>{this.accountDataAdapter.removeListener(Ae.AccountData,i),r(o)})})}addKey(e,n,r){var i=this;return U(function*(){if(e!==Wf)throw new Error("Unknown key algorithm ".concat(e));var s={algorithm:e};n.name&&(s.name=n.name),n.passphrase&&(s.passphrase=n.passphrase);var{iv:o,mac:a}=yield px(n.key);if(s.iv=o,s.mac=a,!r)do r=lo(32);while(yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(r)));return yield i.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(r),s),{keyId:r,keyInfo:s}})()}getKey(e){var n=this;return U(function*(){if(e||(e=yield n.getDefaultKeyId()),!e)return null;var r=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(e));return r?[e,r]:null})()}hasKey(e){var n=this;return U(function*(){var r=yield n.getKey(e);return!!r})()}checkKey(e,n){return U(function*(){if(n.algorithm===Wf)if(n.mac){var{mac:r}=yield px(e,n.iv);return hx(n.mac)===hx(r)}else return!0;else throw new Error("Unknown algorithm")})()}store(e,n,r){var i=this;return U(function*(){if(n===null){yield i.accountDataAdapter.setAccountData(e,{});return}var s={};if(!r){var o=yield i.getDefaultKeyId();if(!o)throw new Error("No keys specified and no default key present");r=[o]}if(r.length===0)throw new Error("Zero keys given to encrypt with!");for(var a of r){var l=yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(a));if(!l)throw new Error("Unknown key: "+a);if(l.algorithm===Wf){var c={[a]:l},[,u]=yield i.getSecretStorageKey(c,e);s[a]=yield u.encrypt(n)}else O.warn("unknown algorithm for secret storage key "+a+": "+l.algorithm)}yield i.accountDataAdapter.setAccountData(e,{encrypted:s})})()}get(e){var n=this;return U(function*(){var r=yield n.accountDataAdapter.getAccountDataFromServer(e);if(r){if(!r.encrypted)throw new Error("Content is not encrypted!");var i={};for(var s of Object.keys(r.encrypted)){var o=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s)),a=r.encrypted[s];(o==null?void 0:o.algorithm)===Wf&&a.iv&&a.ciphertext&&a.mac&&(i[s]=o)}if(Object.keys(i).length===0)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");var[l,c]=yield n.getSecretStorageKey(i,e),u=r.encrypted[l];return c.decrypt(u)}})()}isStored(e){var n=this;return U(function*(){var r=yield n.accountDataAdapter.getAccountDataFromServer(e);if(!(r!=null&&r.encrypted))return null;var i={};for(var s of Object.keys(r.encrypted)){var o=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s));if(o){var a=r.encrypted[s];o.algorithm===Wf&&a.iv&&a.ciphertext&&a.mac&&(i[s]=o)}}return Object.keys(i).length?i:null})()}getSecretStorageKey(e,n){var r=this;return U(function*(){if(!r.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");var i=yield r.callbacks.getSecretStorageKey({keys:e},n);if(!i)throw new Error("getSecretStorageKey callback returned falsey");if(i.length<2)throw new Error("getSecretStorageKey callback returned invalid data");var[s,o]=i;if(!e[s])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[s].algorithm===Wf){var a={encrypt:function(c){return WW(c,o,n)},decrypt:function(c){return hme(c,o,n)}};return[s,a]}else throw new Error("Unknown key type: "+e[s].algorithm)})()}}function hx(t){for(var e=t.length;e>=1&&t.charCodeAt(e-1)==61;)e--;return e<t.length?t.substring(0,e):t}var pme="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function px(t,e){return WW(pme,t,"",e)}const mme=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:Wf,ServerSideSecretStorageImpl:zW,calculateKeyCheck:px,trimTrailingEquals:hx},Symbol.toStringTag,{value:"Module"}));var YW=t=>t.type==="livekit"&&"livekit_service_url"in t,mx=t=>YW(t)&&"livekit_alias"in t,tA=t=>t.type==="livekit"&&"focus_selection"in t,nA=1e3*60*60*4,gme=(t,e)=>{var n,r="Malformed session membership event: ";return typeof t.device_id!="string"&&e.push(r+"device_id must be string"),typeof t.call_id!="string"&&e.push(r+"call_id must be string"),typeof t.application!="string"&&e.push(r+"application must be a string"),typeof((n=t.focus_active)===null||n===void 0?void 0:n.type)!="string"&&e.push(r+"focus_active.type must be a string"),Array.isArray(t.foci_preferred)||e.push(r+"foci_preferred must be an array"),t.created_ts&&typeof t.created_ts!="number"&&e.push(r+"created_ts must be number"),t.scope&&typeof t.scope!="string"&&e.push(r+"scope must be string"),e.length===0};class OF{static equal(e,n){return Eh(e.membershipData,n.membershipData)}constructor(e,n){this.parentEvent=e,L(this,"membershipData",void 0);var r=[];if(gme(n,r))this.membershipData=n;else throw Error("unknown CallMembership data. Does not match MSC4143 call.member (".concat(r.join(" & "),") events this could be a legacy membership event: (").concat(n,")"))}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return this.createdTs().toString()}createdTs(){var e;return(e=this.membershipData.created_ts)!==null&&e!==void 0?e:this.parentEvent.getTs()}getAbsoluteExpiry(){var e;return this.createdTs()+((e=this.membershipData.expires)!==null&&e!==void 0?e:nA)}getMsUntilExpiry(){return this.getAbsoluteExpiry()-Date.now()}isExpired(){return this.getMsUntilExpiry()<=0}getPreferredFoci(){return this.membershipData.foci_preferred}getFocusSelection(){var e=this.membershipData.focus_active;if(tA(e))return e.focus_selection}}var lh=function(t){return t.Cancel="cancel",t.Restart="restart",t.Send="send",t}({}),rA=function(t){return t.TooNew="TOO_NEW",t}({});class iA extends Error{constructor(e){var n="Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again";super(n),this.reason=e,this.name="InvalidCryptoStoreError"}}L(iA,"TOO_NEW",rA.TooNew);class vme extends Error{constructor(e,n){super(e),this.value=n}}class yme extends Error{constructor(){super("MatrixClient has been stopped")}}class md extends Error{constructor(e,n){super(e),this.clientEndpoint=n,this.name="UnsupportedDelayedEventsEndpointError"}}var Qu=function(t){return t.Disconnected="Disconnected",t.Connecting="Connecting",t.ConnectingFailed="ConnectingFailed",t.Connected="Connected",t.Reconnecting="Reconnecting",t.Disconnecting="Disconnecting",t.Stuck="Stuck",t.Unknown="Unknown",t}({}),w2=(t,e,n)=>t.sender===e&&t.deviceId===n;class _me{constructor(e,n){this.membershipLoopHandler=e,L(this,"logger",void 0),L(this,"running",!1),L(this,"wakeup",r=>{this.logger.error("Cannot call wakeup before calling `startWithJoin()`")}),L(this,"_actions",[]),this.logger=(n??O).getChild("[NewMembershipActionScheduler]")}get actions(){return this._actions}startWithJoin(){var e=this;return U(function*(){if(e.running){e.logger.error("Cannot call startWithJoin() on NewMembershipActionScheduler while already running");return}e.running=!0,e._actions=[{ts:Date.now(),type:ht.SendDelayedEvent}];try{for(var n=function*(){e._actions.sort((c,u)=>c.ts-u.ts);var i=e._actions[0],s=void 0,o=new Promise(c=>{e.wakeup=u=>{s=u,c()}});i.ts>Date.now()&&(yield Promise.race([o,tu(i.ts-Date.now())]));var a={};if(!s){e.logger.debug("Current MembershipManager processing: ".concat(i.type,`
Queue:`),e._actions,`
Date.now: "`.concat(Date.now()));try{a=yield e.membershipLoopHandler(i.type)}catch(c){throw Error("The MembershipManager shut down because of the end condition: ".concat(c))}}e._actions.splice(0,1);var l=s??a;"replace"in l?e._actions=l.replace:"insert"in l&&e._actions.push(...l.insert)};e._actions.length>0;)yield*n()}finally{e.running=!1}e.logger.debug("Leave MembershipManager ActionScheduler loop (no more actions)")})()}initiateJoin(){var e;(e=this.wakeup)===null||e===void 0||e.call(this,{replace:[{ts:Date.now(),type:ht.SendDelayedEvent}]})}initiateLeave(){var e;(e=this.wakeup)===null||e===void 0||e.call(this,{replace:[{ts:Date.now(),type:ht.SendScheduledDelayedLeaveEvent}]})}}var MF=function(t){return t.StatusChanged="StatusChanged",t}({}),ht=function(t){return t.SendDelayedEvent="SendDelayedEvent",t.SendJoinEvent="SendJoinEvent",t.RestartDelayedEvent="RestartDelayedEvent",t.UpdateExpiry="UpdateExpiry",t.SendScheduledDelayedLeaveEvent="SendScheduledDelayedLeaveEvent",t.SendLeaveEvent="SendLeaveEvent",t}({});class GE extends Un{isActivated(){return this.activated}isJoined(){return this.isActivated()}join(e,n,r){if(this.scheduler.running){this.logger.error("MembershipManager is already running. Ignoring join request.");return}this.fociPreferred=e,this.focusActive=n,this.leavePromiseResolvers=void 0,this.activated=!0,this.oldStatus=this.status,this.state=GE.defaultState,this.scheduler.startWithJoin().catch(i=>{this.logger.error("MembershipManager stopped because: ",i),r==null||r(i)}).finally(()=>{if(this.activated=!1,this.oldStatus&&this.oldStatus!==this.status&&this.emit(MF.StatusChanged,this.oldStatus,this.status),!this.scheduler.running){var i;(i=this.leavePromiseResolvers)===null||i===void 0||i.resolve(!0),this.leavePromiseResolvers=void 0}})}leave(e){return this.scheduler.running?(this.leavePromiseResolvers||(this.leavePromiseResolvers=Dfe(),this.activated=!1,this.scheduler.initiateLeave(),e&&setTimeout(()=>{var n;return(n=this.leavePromiseResolvers)===null||n===void 0?void 0:n.resolve(!1)},e)),this.leavePromiseResolvers.promise):(this.logger.warn("Called MembershipManager.leave() even though the MembershipManager is not running"),Promise.resolve(!0))}onRTCSessionMemberUpdate(e){var n=this;return U(function*(){var r=n.client.getUserId(),i=n.client.getDeviceId();if(r&&i&&n.isJoined()&&!e.some(o=>w2(o,r,i))){var s=[ht.SendDelayedEvent,ht.SendJoinEvent];n.logger.warn("Missing own membership: force re-join"),n.scheduler.actions.find(o=>s.includes(o.type))?n.logger.error("NewMembershipManger tried adding another `SendFirstDelayedEvent` actions even though we already have one in the Queue\nActionQueueOnMemberUpdate:",n.scheduler.actions):(n.state.hasMemberStateEvent=!1,n.scheduler.initiateJoin())}return Promise.resolve()})()}getActiveFocus(){if(this.focusActive)if(tA(this.focusActive)){if(this.focusActive.focus_selection==="oldest_membership"){var e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}else this.logger.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.");else{var n=this.getOldestMembership();return n==null?void 0:n.getPreferredFoci()[0]}}constructor(e,n,r,i,s){super(),this.joinConfig=e,this.room=n,this.client=r,this.getOldestMembership=i,L(this,"activated",!1),L(this,"logger",void 0),L(this,"leavePromiseResolvers",void 0),L(this,"oldStatus",void 0),L(this,"scheduler",void 0),L(this,"state",void 0),L(this,"deviceId",void 0),L(this,"stateKey",void 0),L(this,"fociPreferred",void 0),L(this,"focusActive",void 0),L(this,"delayedLeaveEventDelayMsOverride",void 0),this.logger=(s??O).getChild("[NewMembershipManager]");var[o,a]=[this.client.getUserId(),this.client.getDeviceId()];if(o===null)throw Error("Missing userId in client");if(a===null)throw Error("Missing deviceId in client");this.deviceId=a,this.stateKey=this.makeMembershipStateKey(o,a),this.state=GE.defaultState,this.scheduler=new _me(l=>(this.oldStatus&&(this.logger.debug("MembershipManager applied action changes. Status: ".concat(this.oldStatus," -> ").concat(this.status)),this.oldStatus!==this.status&&this.emit(MF.StatusChanged,this.oldStatus,this.status)),this.oldStatus=this.status,this.logger.debug("MembershipManager before processing action. status=".concat(this.oldStatus)),this.membershipLoopHandler(l)),this.logger)}static get defaultState(){return{hasMemberStateEvent:!1,delayId:void 0,startTime:0,rateLimitRetries:new Map,networkErrorRetries:new Map,expireUpdateIterations:1}}get networkErrorRetryMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.networkErrorRetryMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.callMemberEventRetryDelayMinimum)!==null&&e!==void 0?e:3e3}get membershipEventExpiryMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.membershipEventExpiryMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.membershipExpiryTimeout)!==null&&e!==void 0?e:nA}get membershipEventExpiryHeadroomMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.membershipEventExpiryHeadroomMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.membershipExpiryTimeoutHeadroom)!==null&&e!==void 0?e:5e3}computeNextExpiryActionTs(e){return this.state.startTime+this.membershipEventExpiryMs*e-this.membershipEventExpiryHeadroomMs}get delayedLeaveEventDelayMs(){var e,n,r,i,s;return(e=(n=(r=this.delayedLeaveEventDelayMsOverride)!==null&&r!==void 0?r:(i=this.joinConfig)===null||i===void 0?void 0:i.delayedLeaveEventDelayMs)!==null&&n!==void 0?n:(s=this.joinConfig)===null||s===void 0?void 0:s.membershipServerSideExpiryTimeout)!==null&&e!==void 0?e:8e3}get delayedLeaveEventRestartMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.delayedLeaveEventRestartMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.membershipKeepAlivePeriod)!==null&&e!==void 0?e:5e3}get maximumRateLimitRetryCount(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.maximumRateLimitRetryCount)!==null&&e!==void 0?e:10}get maximumNetworkErrorRetryCount(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.maximumNetworkErrorRetryCount)!==null&&e!==void 0?e:10}membershipLoopHandler(e){var n=this;return U(function*(){switch(e){case ht.SendDelayedEvent:return n.state.delayId?n.cancelKnownDelayIdBeforeSendFirstDelayedEvent(n.state.delayId):n.sendOrResendDelayedLeaveEvent();case ht.RestartDelayedEvent:return n.state.delayId?n.restartDelayedEvent(n.state.delayId):To(ht.SendDelayedEvent);case ht.SendScheduledDelayedLeaveEvent:return n.state.hasMemberStateEvent?n.state.delayId?n.sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(n.state.delayId):To(ht.SendLeaveEvent):{replace:[]};case ht.SendJoinEvent:return n.sendJoinEvent();case ht.UpdateExpiry:return n.updateExpiryOnJoinedEvent();case ht.SendLeaveEvent:return n.state.hasMemberStateEvent?n.sendFallbackLeaveEvent():{replace:[]}}})()}sendOrResendDelayedLeaveEvent(){var e=this;return U(function*(){return yield e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.delayedLeaveEventDelayMs},ee.GroupCallMemberPrefix,{},e.stateKey).then(n=>(e.resetRateLimitCounter(ht.SendDelayedEvent),e.state.delayId=n.delay_id,e.state.hasMemberStateEvent?To(ht.RestartDelayedEvent,e.delayedLeaveEventRestartMs):To(ht.SendJoinEvent))).catch(n=>{var r=ht.SendDelayedEvent;if(e.manageMaxDelayExceededSituation(n))return To(r);var i=e.actionUpdateFromErrors(n,r,"sendDelayedStateEvent");if(i)return i;if(e.state.hasMemberStateEvent){if(e.isUnsupportedDelayedEndpoint(n))return{};throw Error("Could not send delayed event, even though delayed events are supported. "+n)}else return e.isUnsupportedDelayedEndpoint(n)?e.logger.info("Not using delayed event because the endpoint is not supported"):e.logger.info("Not using delayed event because: "+n),To(ht.SendJoinEvent)})})()}cancelKnownDelayIdBeforeSendFirstDelayedEvent(e){var n=this;return U(function*(){return yield n.client._unstable_updateDelayedEvent(e,lh.Cancel).then(()=>(n.state.delayId=void 0,n.resetRateLimitCounter(ht.SendDelayedEvent),AI(ht.SendDelayedEvent))).catch(r=>{var i=ht.SendDelayedEvent,s=n.actionUpdateFromErrors(r,i,"updateDelayedEvent");if(s)return s;if(n.isNotFoundError(r))return n.state.delayId=void 0,AI(i);if(n.isUnsupportedDelayedEndpoint(r))return AI(ht.SendJoinEvent);throw Error("We failed to cancel a delayed event where we already had a delay id with an error we cannot automatically handle")})})()}restartDelayedEvent(e){var n=this;return U(function*(){return yield n.client._unstable_updateDelayedEvent(e,lh.Restart).then(()=>(n.resetRateLimitCounter(ht.RestartDelayedEvent),To(ht.RestartDelayedEvent,n.delayedLeaveEventRestartMs))).catch(r=>{var i=ht.RestartDelayedEvent;if(n.isNotFoundError(r))return n.state.delayId=void 0,To(ht.SendDelayedEvent);if(n.isUnsupportedDelayedEndpoint(r))return{};var s=n.actionUpdateFromErrors(r,i,"updateDelayedEvent");if(s)return s;throw Error("Could not restart delayed event, even though delayed events are supported. "+r)})})()}sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(e){var n=this;return U(function*(){return yield n.client._unstable_updateDelayedEvent(e,lh.Send).then(()=>(n.state.hasMemberStateEvent=!1,n.resetRateLimitCounter(ht.SendScheduledDelayedLeaveEvent),{replace:[]})).catch(r=>{var i=ht.SendLeaveEvent;if(n.isUnsupportedDelayedEndpoint(r))return{};if(n.isNotFoundError(r))return n.state.delayId=void 0,To(i);var s=n.actionUpdateFromErrors(r,i,"updateDelayedEvent");return s||(n.logger.warn("Encountered unexpected error during SendScheduledDelayedLeaveEvent. Falling back to SendLeaveEvent",r),To(i))})})()}sendJoinEvent(){var e=this;return U(function*(){return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryMs),e.stateKey).then(()=>(e.state.startTime=Date.now(),e.state.expireUpdateIterations=1,e.state.hasMemberStateEvent=!0,e.resetRateLimitCounter(ht.SendJoinEvent),{insert:[{ts:Date.now(),type:ht.RestartDelayedEvent},{ts:e.computeNextExpiryActionTs(e.state.expireUpdateIterations),type:ht.UpdateExpiry}]})).catch(n=>{var r=e.actionUpdateFromErrors(n,ht.SendJoinEvent,"sendStateEvent");if(r)return r;throw n})})()}updateExpiryOnJoinedEvent(){var e=this;return U(function*(){var n=e.state.expireUpdateIterations+1;return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,e.makeMyMembership(e.membershipEventExpiryMs*n),e.stateKey).then(()=>(e.resetRateLimitCounter(ht.UpdateExpiry),e.state.expireUpdateIterations=n,{insert:[{ts:e.computeNextExpiryActionTs(n),type:ht.UpdateExpiry}]})).catch(r=>{var i=e.actionUpdateFromErrors(r,ht.UpdateExpiry,"sendStateEvent");if(i)return i;throw r})})()}sendFallbackLeaveEvent(){var e=this;return U(function*(){return yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,{},e.stateKey).then(()=>(e.resetRateLimitCounter(ht.SendLeaveEvent),e.state.hasMemberStateEvent=!1,{replace:[]})).catch(n=>{var r=e.actionUpdateFromErrors(n,ht.SendLeaveEvent,"sendStateEvent");if(r)return r;throw n})})()}makeMembershipStateKey(e,n){var r="".concat(e,"_").concat(n);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?r:"_".concat(r)}makeMyMembership(e){var n;return{call_id:"",scope:"m.room",application:"m.call",device_id:this.deviceId,expires:e,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:(n=this.fociPreferred)!==null&&n!==void 0?n:[]}}isNotFoundError(e){return e instanceof Nn&&e.errcode==="M_NOT_FOUND"}manageMaxDelayExceededSituation(e){if(e instanceof Nn&&e.errcode==="M_UNKNOWN"&&e.data["org.matrix.msc4140.errcode"]==="M_MAX_DELAY_EXCEEDED"){var n=e.data["org.matrix.msc4140.max_delay"];return typeof n=="number"&&this.delayedLeaveEventDelayMs>n&&(this.delayedLeaveEventDelayMsOverride=n),this.logger.warn("Retry sending delayed disconnection event due to server timeout limitations:",e),!0}return!1}actionUpdateFromErrors(e,n,r){var i=this.actionUpdateFromRateLimitError(e,r,n);if(i)return i;var s=this.actionUpdateFromNetworkErrorRetry(e,n);if(s)return s}actionUpdateFromRateLimitError(e,n,r){var i;if((e instanceof Fd||e instanceof Nn)&&e.isRateLimitError()){var s=(i=this.state.rateLimitRetries.get(r))!==null&&i!==void 0?i:0;if(s<this.maximumRateLimitRetryCount){var o,a=5e3;try{var l;o=(l=e.getRetryAfterMs())!==null&&l!==void 0?l:a,this.logger.info("Rate limited by server, retrying in ".concat(o,"ms"))}catch(c){this.logger.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(a),c),o=a}return this.state.rateLimitRetries.set(r,s+1),To(r,o)}throw Error("Exceeded maximum retries for "+r+" attempts (client."+n+"): "+e)}}actionUpdateFromNetworkErrorRetry(e,n){var r,i=(r=this.state.networkErrorRetries.get(n))!==null&&r!==void 0?r:0,s=this.networkErrorRetryMs/1e3+"s",o="("+i+"/"+this.maximumNetworkErrorRetryCount+")";if(e instanceof Error&&e.name==="AbortError")this.logger.warn("Network local timeout error while sending event, retrying in "+s+" "+o,e);else if(e instanceof Error&&e.message.includes("updating delayed event"))this.logger.warn("delayed event update timeout error, retrying in "+s+" "+o,e);else if(e instanceof Vh)this.logger.warn("Network connection error while sending event, retrying in "+s+" "+o,e);else if((e instanceof Fd||e instanceof Nn)&&typeof e.httpStatus=="number"&&e.httpStatus>=500&&e.httpStatus<600)this.logger.warn("Server error while sending event, retrying in "+s+" "+o,e);else return;if(i<this.maximumNetworkErrorRetryCount)return this.state.networkErrorRetries.set(n,i+1),To(n,this.networkErrorRetryMs);throw Error("Reached maximum ("+this.maximumNetworkErrorRetryCount+") retries cause by: "+e)}isUnsupportedDelayedEndpoint(e){return e instanceof md}resetRateLimitCounter(e){this.state.rateLimitRetries.set(e,0),this.state.networkErrorRetries.set(e,0)}get status(){var e=this.scheduler.actions;if(e.length===1){var{type:n}=e[0];switch(n){case ht.SendDelayedEvent:case ht.SendJoinEvent:return Qu.Connecting;case ht.UpdateExpiry:return Qu.Connected;case ht.SendScheduledDelayedLeaveEvent:case ht.SendLeaveEvent:return Qu.Disconnecting}}else if(e.length===2){var r=e.map(s=>s.type);if((r.includes(ht.RestartDelayedEvent)||r.includes(ht.SendDelayedEvent)&&this.state.hasMemberStateEvent)&&r.includes(ht.UpdateExpiry))return Qu.Connected}else if(e.length===3){var i=e.map(s=>s.type);if(i.filter(s=>s===ht.RestartDelayedEvent).length===2&&i.includes(ht.UpdateExpiry))return Qu.Connected}return this.scheduler.running?(this.logger.error("MembershipManager has an unknown state. Actions: ",e),Qu.Unknown):Qu.Disconnected}}function To(t,e){return{insert:[{ts:Date.now()+(e??0),type:t}]}}function AI(t,e){return{replace:[{ts:Date.now()+0,type:t}]}}var gd=function(t){return t.ReceivedKeys="received_keys",t.NotSupportedError="not_supported_error",t}({});class XW extends Error{constructor(e){super(e)}get name(){return"NotSupportedError"}}class bme extends Un{setParentLogger(e){this.logger=e.getChild("[ToDeviceKeyTransport]")}constructor(e,n,r,i,s,o){super(),this.userId=e,this.deviceId=n,this.roomId=r,this.client=i,this.statistics=s,L(this,"logger",O),L(this,"onToDeviceEvent",a=>{if(a.getType()===ee.CallEncryptionKeysPrefix){var l=this.getValidEventContent(a);l&&a.getSender()&&this.receiveCallKeyEvent(a.getSender(),l)}}),this.setParentLogger(o??O)}start(){this.client.on(Ae.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.off(Ae.ToDeviceEvent,this.onToDeviceEvent)}sendKey(e,n,r){var i=this;return U(function*(){var s={keys:{index:n,key:e},room_id:i.roomId,member:{claimed_device_id:i.deviceId},session:{call_id:"",application:"m.call",scope:"m.room"}},o=r.filter(a=>a.sender==null||a.deviceId==null?(i.logger.warn("Malformed call member: ".concat(a.sender,"|").concat(a.deviceId)),!1):!(a.sender==i.userId&&a.deviceId==i.deviceId)).map(a=>({userId:a.sender,deviceId:a.deviceId}));o.length>0?(yield i.client.encryptAndSendToDevice(ee.CallEncryptionKeysPrefix,o,s).catch(a=>{var l=a.message;if(l.includes("unknown variant")&&l.includes("send_to_device")||l.includes("not supported"))throw new XW("The widget driver does not support to-device encryption")}),i.statistics.counters.roomEventEncryptionKeysSent+=1):i.logger.warn("No targets found for sending key")})()}receiveCallKeyEvent(e,n){this.statistics.counters.roomEventEncryptionKeysReceived+=1;var r=Date.now(),i=r-(typeof n.sent_ts=="number"?n.sent_ts:r);this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=i,this.emit(gd.ReceivedKeys,e,n.member.claimed_device_id,n.keys.key,n.keys.index,r)}getValidEventContent(e){var n=e.getContent(),r=n.room_id;if(!r){this.logger.warn("Malformed Event: invalid call encryption keys event, no roomId");return}if(r!==this.roomId){this.logger.warn("Malformed Event: Mismatch roomId");return}if(!n.keys||!n.keys.key||typeof n.keys.index!="number"){this.logger.warn("Malformed Event: Missing keys field");return}if(!n.member||!n.member.claimed_device_id){this.logger.warn("Malformed Event: Missing claimed_device_id");return}return n}}var AC=function(t){return t.EnabledTransportsChanged="enabled_transports_changed",t}({});class JW extends Un{constructor(e,n,r){var i;super(),i=this,this.toDeviceTransport=e,this.roomKeyTransport=n,L(this,"logger",void 0),L(this,"_enabled",{toDevice:!0,room:!1}),this.logger=(r??O).getChild("[RoomAndToDeviceTransport]"),this.toDeviceTransport.setParentLogger(this.logger),this.roomKeyTransport.setParentLogger(this.logger),this.roomKeyTransport.on(gd.ReceivedKeys,function(){i._enabled.room||(i.logger.debug("Received room key, enabling room key transport, disabling toDevice transport"),i.setEnabled({toDevice:!1,room:!0}));for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];i.emit(gd.ReceivedKeys,...o)}),this.toDeviceTransport.on(gd.ReceivedKeys,function(){if(i._enabled.toDevice){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];i.emit(gd.ReceivedKeys,...o)}else i.logger.debug("To Device transport is disabled, ignoring received keys")})}setEnabled(e){(this.enabled.toDevice!==e.toDevice||this.enabled.room!==e.room)&&(this._enabled=e,this.emit(AC.EnabledTransportsChanged,e))}get enabled(){return this._enabled}start(){this.roomKeyTransport.start(),this.toDeviceTransport.start()}stop(){this.roomKeyTransport.stop(),this.toDeviceTransport.stop()}sendKey(e,n,r){var i=this;return U(function*(){if(i.logger.debug("Sending key with index ".concat(n," to call members (count=").concat(r.length,") via:")+(i._enabled.room?"room transport":"")+(i._enabled.room&&i._enabled.toDevice?"and":"")+(i._enabled.toDevice?"to device transport":"")),i._enabled.room&&(yield i.roomKeyTransport.sendKey(e,n,r)),i._enabled.toDevice)try{yield i.toDeviceTransport.sendKey(e,n,r)}catch(s){s instanceof XW&&!i._enabled.room&&(i.logger.warn("To device is not supported enabling room key transport, disabling toDevice transport"),i.setEnabled({toDevice:!1,room:!0}),yield i.sendKey(e,n,r))}})()}}class Sme{get updateEncryptionKeyThrottle(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.updateEncryptionKeyThrottle)!==null&&e!==void 0?e:3e3}get makeKeyDelay(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.makeKeyDelay)!==null&&e!==void 0?e:3e3}get useKeyDelay(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.useKeyDelay)!==null&&e!==void 0?e:5e3}constructor(e,n,r,i,s,o,a){var l=this;this.userId=e,this.deviceId=n,this.getMemberships=r,this.transport=i,this.statistics=s,this.onEncryptionKeysChanged=o,L(this,"manageMediaKeys",!1),L(this,"keysEventUpdateTimeout",void 0),L(this,"makeNewKeyTimeout",void 0),L(this,"setNewKeyTimeouts",new Set),L(this,"encryptionKeys",new Map),L(this,"lastEncryptionKeyUpdateRequest",void 0),L(this,"lastMembershipFingerprints",void 0),L(this,"latestGeneratedKeyIndex",-1),L(this,"joinConfig",void 0),L(this,"logger",void 0),L(this,"joined",!1),L(this,"sendEncryptionKeysEvent",function(){var c=U(function*(u){if(l.keysEventUpdateTimeout!==void 0&&(clearTimeout(l.keysEventUpdateTimeout),l.keysEventUpdateTimeout=void 0),l.lastEncryptionKeyUpdateRequest=Date.now(),!!l.joined){var f=l.getKeysForParticipant(l.userId,l.deviceId);if(!f){l.logger.warn("Tried to send encryption keys event but no keys found!");return}if(typeof u!="number"&&l.latestGeneratedKeyIndex===-1){l.logger.warn("Tried to send encryption keys event but no current key index found!");return}var p=u??l.latestGeneratedKeyIndex;l.logger.info("Try sending encryption keys event. keyIndexToSend=".concat(p," (method parameter: ").concat(u,")"));var m=f[p];try{l.statistics.counters.roomEventEncryptionKeysSent+=1,yield l.transport.sendKey(FW(m),p,l.getMemberships()),l.logger.debug("sendEncryptionKeysEvent participantId=".concat(l.userId,":").concat(l.deviceId," numKeys=").concat(f.length," currentKeyIndex=").concat(l.latestGeneratedKeyIndex," keyIndexToSend=").concat(p),l.encryptionKeys)}catch(g){if(l.keysEventUpdateTimeout===void 0){var v=VL(g,5e3);l.logger.warn("Failed to send m.call.encryption_key, retrying in ".concat(v),g),l.keysEventUpdateTimeout=setTimeout(()=>void l.sendEncryptionKeysEvent(),v)}else l.logger.info("Not scheduling key resend as another re-send is already pending")}}});return function(u){return c.apply(this,arguments)}}()),L(this,"onTransportChanged",()=>{this.requestSendCurrentKey()}),L(this,"onNewKeyReceived",(c,u,f,p,m)=>{this.logger.debug("Received key over key transport ".concat(c,":").concat(u," at index ").concat(p)),this.setEncryptionKey(c,u,p,f,m)}),L(this,"onRotateKeyTimeout",()=>{if(this.manageMediaKeys){this.makeNewKeyTimeout=void 0,this.logger.info("Making new sender key for key rotation");var c=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(c)}}),this.logger=(a??O).getChild("[EncryptionManager]")}getEncryptionKeys(){return this.encryptionKeys}join(e){var n,r,i;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.manageMediaKeys)!==null&&n!==void 0?n:this.manageMediaKeys,this.transport.on(gd.ReceivedKeys,this.onNewKeyReceived),this.transport instanceof JW&&this.transport.on(AC.EnabledTransportsChanged,this.onTransportChanged),this.transport.start(),(i=this.joinConfig)!==null&&i!==void 0&&i.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){this.encryptionKeys.set(C2(this.userId,this.deviceId),[]),this.transport.off(gd.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),this.makeNewKeyTimeout!==void 0&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0);for(var e of this.setNewKeyTimeouts)clearTimeout(e);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){if(this.manageMediaKeys&&this.joined){var n=new Set(e.filter(c=>!w2(c,this.userId,this.deviceId)).map(OI)),r=new Set(this.getMemberships().filter(c=>!w2(c,this.userId,this.deviceId)).map(OI)),i=Array.from(n).some(c=>!r.has(c)),s=Array.from(r).some(c=>!n.has(c)),o=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),i)this.makeNewKeyTimeout||(this.logger.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,this.makeKeyDelay));else if(s)this.logger.debug("New member(s) have joined: re-sending keys"),this.requestSendCurrentKey();else if(o){var a=this.lastMembershipFingerprints,l=Array.from(o).some(c=>!a.has(c))||Array.from(a).some(c=>!o.has(c));l&&(this.logger.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestSendCurrentKey())}}}makeNewSenderKey(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=UW(16),r=this.getNewEncryptionKeyIndex();return this.logger.info("Generated new key at index "+r),this.setEncryptionKey(this.userId,this.deviceId,r,n,Date.now(),e),r}requestSendCurrentKey(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now()){this.logger.info("Last encryption key event sent too recently: postponing"),this.keysEventUpdateTimeout===void 0&&(this.keysEventUpdateTimeout=setTimeout(()=>void this.sendEncryptionKeysEvent(),this.updateEncryptionKeyThrottle));return}this.sendEncryptionKeysEvent()}}getKeysForParticipant(e,n){var r;return(r=this.encryptionKeys.get(C2(e,n)))===null||r===void 0?void 0:r.map(i=>i.key)}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter(e=>!w2(e,this.userId,this.deviceId)).map(e=>"".concat(OI(e),":").concat(e.createdTs())))}getNewEncryptionKeyIndex(){return this.latestGeneratedKeyIndex===-1?0:(this.latestGeneratedKeyIndex+1)%256}setEncryptionKey(e,n,r,i,s){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;this.logger.debug("Setting encryption key for ".concat(e,":").concat(n," at index ").concat(r));var a=Rm(i),l=C2(e,n);this.encryptionKeys.has(l)||this.encryptionKeys.set(l,[]);var c=this.encryptionKeys.get(l),u=c[r];if(u){if(u.timestamp>s){this.logger.info("Ignoring new key at index ".concat(r," for ").concat(l," as it is older than existing known key"));return}if(Eme(u.key,a)){u.timestamp=s;return}}if(e===this.userId&&n===this.deviceId&&(this.latestGeneratedKeyIndex=r),c[r]={key:a,timestamp:s},o){var f=setTimeout(()=>{this.setNewKeyTimeouts.delete(f),this.logger.info("Delayed-emitting key changed event for ".concat(l," index ").concat(r)),this.onEncryptionKeysChanged(a,r,l)},this.useKeyDelay);this.setNewKeyTimeouts.add(f)}else this.onEncryptionKeysChanged(a,r,l)}}var C2=(t,e)=>"".concat(t,":").concat(e);function Eme(t,e){return t===e?!0:!!t&&!!e&&t.length===e.length&&t.every((n,r)=>n===e[r])}var OI=t=>C2(t.sender,t.deviceId);class wme{get networkErrorRetryMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.networkErrorRetryMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.callMemberEventRetryDelayMinimum)!==null&&e!==void 0?e:3e3}get membershipEventExpiryMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.membershipEventExpiryMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.membershipExpiryTimeout)!==null&&e!==void 0?e:nA}get delayedLeaveEventDelayMs(){var e,n,r,i,s;return(e=(n=(r=this.delayedLeaveEventDelayMsOverride)!==null&&r!==void 0?r:(i=this.joinConfig)===null||i===void 0?void 0:i.delayedLeaveEventDelayMs)!==null&&n!==void 0?n:(s=this.joinConfig)===null||s===void 0?void 0:s.membershipServerSideExpiryTimeout)!==null&&e!==void 0?e:8e3}get delayedLeaveEventRestartMs(){var e,n,r,i;return(e=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.delayedLeaveEventRestartMs)!==null&&n!==void 0?n:(i=this.joinConfig)===null||i===void 0?void 0:i.membershipKeepAlivePeriod)!==null&&e!==void 0?e:5e3}constructor(e,n,r,i){var s=this;this.joinConfig=e,this.room=n,this.client=r,this.getOldestMembership=i,L(this,"relativeExpiry",void 0),L(this,"memberEventTimeout",void 0),L(this,"ownFociPreferred",void 0),L(this,"ownFocusActive",void 0),L(this,"updateCallMembershipRunning",!1),L(this,"needCallMembershipUpdate",!1),L(this,"delayedLeaveEventDelayMsOverride",void 0),L(this,"disconnectDelayId",void 0),L(this,"triggerCallMembershipEventUpdate",U(function*(){if(s.updateCallMembershipRunning){s.needCallMembershipUpdate=!0;return}s.updateCallMembershipRunning=!0;try{do s.needCallMembershipUpdate=!1,yield s.updateCallMembershipEvent();while(s.needCallMembershipUpdate)}finally{s.updateCallMembershipRunning=!1}})),L(this,"delayDisconnection",U(function*(){try{var o=s.disconnectDelayId;yield Np(()=>s.client._unstable_updateDelayedEvent(o,lh.Restart)),s.scheduleDelayDisconnection()}catch(a){O.error("Failed to delay our disconnection event:",a)}}))}off(e,n){return O.error("off is not implemented on LegacyMembershipManager"),this}on(e,n){return O.error("on is not implemented on LegacyMembershipManager"),this}isJoined(){return this.relativeExpiry!==void 0}isActivated(){return this.isJoined()}get status(){return Qu.Unknown}join(e,n){this.ownFocusActive=n,this.ownFociPreferred=e,this.relativeExpiry=this.membershipEventExpiryMs,this.triggerCallMembershipEventUpdate()}leave(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:void 0;if(n.relativeExpiry=void 0,n.ownFocusActive=void 0,n.memberEventTimeout&&(clearTimeout(n.memberEventTimeout),n.memberEventTimeout=void 0),r){var i=yield Promise.race([n.triggerCallMembershipEventUpdate(),tu(r,"timeout")]);return i!=="timeout"}else return yield n.triggerCallMembershipEventUpdate(),!0})()}onRTCSessionMemberUpdate(e){var n=this;return U(function*(){var r=i=>i.sender===n.client.getUserId()&&i.deviceId===n.client.getDeviceId();if(n.isJoined()&&!e.some(r))return O.warn("Missing own membership: force re-join"),n.triggerCallMembershipEventUpdate()})()}getActiveFocus(){if(this.ownFocusActive)if(tA(this.ownFocusActive)){if(this.ownFocusActive.focus_selection==="oldest_membership"){var e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}else O.warn("Unknown own ActiveFocus type. This makes it impossible to connect to an SFU.");else{var n=this.getOldestMembership();return n==null?void 0:n.getPreferredFoci()[0]}}makeNewMembership(e){return this.isJoined()?this.makeMyMembership(e):{}}makeMyMembership(e){var n;return{call_id:"",scope:"m.room",application:"m.call",device_id:e,expires:this.relativeExpiry,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:(n=this.ownFociPreferred)!==null&&n!==void 0?n:[]}}updateCallMembershipEvent(){var e=this;return U(function*(){e.memberEventTimeout&&(clearTimeout(e.memberEventTimeout),e.memberEventTimeout=void 0);var n=e.room.getLiveTimeline().getState(Le.FORWARDS);if(!n)throw new Error("Couldn't get room state for room "+e.room.roomId);var r=e.client.getUserId(),i=e.client.getDeviceId();if(!r||!i)throw new Error("User ID or device ID was null!");var s={};s=e.makeNewMembership(i);try{if(e.isJoined()){var o=e.makeMembershipStateKey(r,i),a=function(){var p=U(function*(){try{var m=yield Np(()=>e.client._unstable_sendDelayedStateEvent(e.room.roomId,{delay:e.delayedLeaveEventDelayMs},ee.GroupCallMemberPrefix,{},o));e.disconnectDelayId=m.delay_id}catch(g){if(g instanceof Nn&&g.errcode==="M_UNKNOWN"&&g.data["org.matrix.msc4140.errcode"]==="M_MAX_DELAY_EXCEEDED"){var v=g.data["org.matrix.msc4140.max_delay"];if(typeof v=="number"&&e.delayedLeaveEventDelayMs>v)return e.delayedLeaveEventDelayMsOverride=v,a()}O.error("Failed to prepare delayed disconnection event:",g)}});return function(){return p.apply(this,arguments)}}();if(yield a(),yield Np(()=>e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,s,o)),e.disconnectDelayId!==void 0)try{var l=e.disconnectDelayId;yield Np(()=>e.client._unstable_updateDelayedEvent(l,lh.Restart))}catch(p){p instanceof Nn&&p.errcode==="M_NOT_FOUND"&&(O.warn("Failed to update delayed disconnection event, prepare it again:",p),e.disconnectDelayId=void 0,yield a())}e.disconnectDelayId!==void 0&&e.scheduleDelayDisconnection()}else{var c=!1;if(e.disconnectDelayId!==void 0){try{var u=e.disconnectDelayId;yield Np(()=>e.client._unstable_updateDelayedEvent(u,lh.Send)),c=!0}catch(p){O.error("Failed to send our delayed disconnection event:",p)}e.disconnectDelayId=void 0}c||(yield Np(()=>e.client.sendStateEvent(e.room.roomId,ee.GroupCallMemberPrefix,{},e.makeMembershipStateKey(r,i))))}O.info("Sent updated call member event.")}catch(p){var f=e.networkErrorRetryMs;O.warn("Failed to send call member event (retrying in ".concat(f,"): ").concat(p)),yield tu(f),yield e.triggerCallMembershipEventUpdate()}})()}scheduleDelayDisconnection(){this.memberEventTimeout=setTimeout(()=>void this.delayDisconnection(),this.delayedLeaveEventRestartMs)}makeMembershipStateKey(e,n){var r="".concat(e,"_").concat(n);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?r:"_".concat(r)}}function Np(t){return gx.apply(this,arguments)}function gx(){return gx=U(function*(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;;)try{return yield t()}catch(s){if(e>0&&s instanceof Fd&&s.isRateLimitError()){e--;var n=void 0,r=5e3;try{var i;n=(i=s.getRetryAfterMs())!==null&&i!==void 0?i:r,O.info("Rate limited by server, retrying in ".concat(n,"ms"))}catch(o){O.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(r),o),n=r}yield tu(n)}else throw s}}),gx.apply(this,arguments)}class NF extends Un{setParentLogger(e){this.logger=e.getChild("[RoomKeyTransport]")}constructor(e,n,r,i){super(),this.room=e,this.client=n,this.statistics=r,L(this,"logger",O),this.setParentLogger(i??O)}start(){this.room.on(xe.Timeline,e=>void this.consumeCallEncryptionEvent(e))}stop(){this.room.off(xe.Timeline,e=>void this.consumeCallEncryptionEvent(e))}consumeCallEncryptionEvent(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;if(yield r.client.decryptEventIfNeeded(e),e.isDecryptionFailure()){i?r.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason)):(r.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason," will retry once only")),setTimeout(()=>void r.consumeCallEncryptionEvent(e,!0),1e3));return}else i&&r.logger.info("Decryption succeeded for event ".concat(e.getId()," after retry"));if(e.getType()!==ee.CallEncryptionKeysPrefix)return Promise.resolve();if(!r.room)return r.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!")),Promise.resolve();r.onEncryptionEvent(e)})()}sendKey(e,n,r){var i=this;return U(function*(){var s={keys:[{index:n,key:e}],device_id:i.client.getDeviceId(),call_id:"",sent_ts:Date.now()};try{yield i.client.sendEvent(i.room.roomId,ee.CallEncryptionKeysPrefix,s)}catch(a){i.logger.error("Failed to send call encryption keys",a);var o=a;throw o.event&&i.client.cancelPendingEvent(o.event),a}})()}onEncryptionEvent(e){var n=e.getSender(),r=e.getContent(),i=r.device_id,s=r.call_id;if(!n){this.logger.warn("Received m.call.encryption_keys with no userId: callId=".concat(s));return}if(s!==""){this.logger.warn("Received m.call.encryption_keys with unsupported callId: userId=".concat(n,", deviceId=").concat(i,", callId=").concat(s));return}if(!Array.isArray(r.keys)){this.logger.warn("Received m.call.encryption_keys where keys wasn't an array: callId=".concat(s));return}if(n===this.client.getUserId()&&i===this.client.getDeviceId()){this.logger.info("Ignoring our own keys event");return}this.statistics.counters.roomEventEncryptionKeysReceived+=1;var o=Date.now()-(typeof r.sent_ts=="number"?r.sent_ts:e.getTs());this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=o;for(var a of r.keys){if(!a){this.logger.info("Ignoring false-y key in keys event");continue}var l=a.key,c=a.index;!l||c===void 0||c===null||s===void 0||s===null||typeof i!="string"||typeof s!="string"||typeof l!="string"||typeof c!="number"?this.logger.warn("Malformed call encryption_key: userId=".concat(n,", deviceId=").concat(i,", encryptionKeyIndex=").concat(c," callId=").concat(s)):(this.logger.debug("onCallEncryption userId=".concat(n,":").concat(i," encryptionKeyIndex=").concat(c," age=").concat(o,"ms")),this.emit(gd.ReceivedKeys,n,i,l,c,e.getTs()))}}}var Ar=function(t){return t.MembershipsChanged="memberships_changed",t.JoinStateChanged="join_state_changed",t.EncryptionKeyChanged="encryption_key_changed",t.MembershipManagerError="membership_manager_error",t}({});class xm extends Un{get callId(){return this._callId}static callMembershipsForRoom(e){var n=O.getChild("[MatrixRTCSession ".concat(e.roomId,"]")),r=e.getLiveTimeline().getState(Le.FORWARDS);if(!r)throw n.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);var i=r.getStateEvents(ee.GroupCallMemberPrefix),s=[];for(var o of i){var a=o.getContent(),l=Object.keys(a).length;if(l!==0){var c=[];if(l>1&&"focus_active"in a?c.push(a):l===1&&"memberships"in a&&n.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),c.length!==0)for(var u of c)try{var f,p=new OF(o,u);if(p.callId!==""||p.scope!=="m.room"){n.info("Ignoring user-scoped call");continue}if(p.isExpired()){n.info("Ignoring expired device membership ".concat(p.sender,"/").concat(p.deviceId));continue}if(!e.hasMembershipState((f=p.sender)!==null&&f!==void 0?f:"",qe.Join)){n.info("Ignoring membership of user ".concat(p.sender," who is not in the room."));continue}s.push(p)}catch(m){n.warn("Couldn't construct call membership: ",m)}}}return s.sort((m,v)=>m.createdTs()-v.createdTs()),s.length>1&&n.debug("Call memberships in room ".concat(e.roomId,", in order: "),s.map(m=>[m.createdTs(),m.sender])),s}static roomSessionForRoom(e,n){var r=xm.callMembershipsForRoom(n);return new xm(e,n,r)}get room(){return this.roomSubset}constructor(e,n,r){var i;super(),this.client=e,this.roomSubset=n,this.memberships=r,L(this,"membershipManager",void 0),L(this,"encryptionManager",void 0),L(this,"_callId",void 0),L(this,"logger",void 0),L(this,"expiryTimeout",void 0),L(this,"statistics",{counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}}),L(this,"reEmitter",new Vg(this)),L(this,"onRoomMemberUpdate",()=>{this.recalculateSessionMembers()}),L(this,"onRTCSessionMemberUpdate",()=>{this.recalculateSessionMembers()}),L(this,"recalculateSessionMembers",()=>{var o,a,l,c=this.memberships;this.memberships=xm.callMembershipsForRoom(this.room),this._callId=(o=this._callId)!==null&&o!==void 0?o:(a=this.memberships[0])===null||a===void 0?void 0:a.callId;var u=c.length!=this.memberships.length||c.some((p,m)=>!OF.equal(p,this.memberships[m]));if(u){var f;this.logger.info("Memberships for call in room ".concat(this.roomSubset.roomId," have changed: emitting")),Nfe(this.logger,"emit MatrixRTCSessionEvent.MembershipsChanged",()=>{this.emit(Ar.MembershipsChanged,c,this.memberships)}),(f=this.membershipManager)===null||f===void 0||f.onRTCSessionMemberUpdate(this.memberships)}(l=this.encryptionManager)===null||l===void 0||l.onMembershipsUpdate(c),this.setExpiryTimer()}),this.logger=O.getChild("[MatrixRTCSession ".concat(n.roomId,"]")),this._callId=(i=r[0])===null||i===void 0?void 0:i.callId;var s=this.roomSubset.getLiveTimeline().getState(Le.FORWARDS);s==null||s.on(gt.Members,this.onRoomMemberUpdate),this.setExpiryTimer()}isJoined(){var e,n;return(e=(n=this.membershipManager)===null||n===void 0?void 0:n.isJoined())!==null&&e!==void 0?e:!1}stop(){var e=this;return U(function*(){var n;yield(n=e.membershipManager)===null||n===void 0?void 0:n.leave(1e3),e.expiryTimeout&&(clearTimeout(e.expiryTimeout),e.expiryTimeout=void 0);var r=e.roomSubset.getLiveTimeline().getState(Le.FORWARDS);r==null||r.off(gt.Members,e.onRoomMemberUpdate)})()}joinRoomSession(e,n,r){if(this.isJoined()){this.logger.info("Already joined to session in room ".concat(this.roomSubset.roomId,": ignoring join call"));return}else{var i;(i=r==null?void 0:r.useNewMembershipManager)!==null&&i!==void 0&&i?this.membershipManager=new GE(r,this.roomSubset,this.client,()=>this.getOldestMembership(),this.logger):this.membershipManager=new wme(r,this.roomSubset,this.client,()=>this.getOldestMembership());var s;if(r!=null&&r.useExperimentalToDeviceTransport){this.logger.info("Using to-device with room fallback transport for encryption keys");var[o,a]=[this.client.getUserId(),this.client.getDeviceId()],[l,c,u]=[this.roomSubset,this.client,this.statistics],f=new NF(l,c,u),p=new bme(o,a,l.roomId,c,u);s=new JW(p,f,this.logger),this.reEmitter.reEmit(s,[AC.EnabledTransportsChanged])}else s=new NF(this.roomSubset,this.client,this.statistics);this.encryptionManager=new Sme(this.client.getUserId(),this.client.getDeviceId(),()=>this.memberships,s,this.statistics,(m,v,g)=>{this.emit(Ar.EncryptionKeyChanged,m,v,g)},this.logger)}this.membershipManager.join(e,n,m=>{this.logger.error("MembershipManager encountered an unrecoverable error: ",m),this.emit(Ar.MembershipManagerError,m),this.emit(Ar.JoinStateChanged,this.isJoined())}),this.encryptionManager.join(r),this.emit(Ar.JoinStateChanged,!0)}leaveRoomSession(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:void 0;if(!n.isJoined())return n.logger.info("Not joined to session in room ".concat(n.roomSubset.roomId,": ignoring leave call")),!1;n.logger.info("Leaving call session in room ".concat(n.roomSubset.roomId)),n.encryptionManager.leave();var i=n.membershipManager.leave(r);return n.emit(Ar.JoinStateChanged,!1),yield i})()}getActiveFocus(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.getActiveFocus()}getOldestMembership(){return this.memberships[0]}getFocusInUse(){var e=this.getOldestMembership();if((e==null?void 0:e.getFocusSelection())==="oldest_membership")return e.getPreferredFoci()[0]}reemitEncryptionKeys(){var e;(e=this.encryptionManager)===null||e===void 0||e.getEncryptionKeys().forEach((n,r)=>{n.forEach((i,s)=>{this.emit(Ar.EncryptionKeyChanged,i.key,s,r)})})}getEncryptionKeys(){var e,n,r=(e=(n=this.encryptionManager)===null||n===void 0?void 0:n.getEncryptionKeys())!==null&&e!==void 0?e:new Map;return Array.from(r.entries()).map(i=>{var[s,o]=i;return[s,o.map(a=>a.key)]}).values()}setExpiryTimer(){this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0);var e;for(var n of this.memberships){var r=n.getMsUntilExpiry();r!==void 0&&(e===void 0||r<e)&&(e=r)}e!=null&&(this.expiryTimeout=setTimeout(this.onRTCSessionMemberUpdate,e))}}var qE=function(t){return t.SessionStarted="session_started",t.SessionEnded="session_ended",t}({});class Cme extends Un{constructor(e){super(),this.client=e,L(this,"roomSessions",new Map),L(this,"logger",void 0),L(this,"onRoom",n=>{this.refreshRoom(n)}),L(this,"onRoomState",(n,r)=>{var i=this.client.getRoom(n.getRoomId());if(!i){this.logger.error("Got room state event for unknown room ".concat(n.getRoomId(),"!"));return}n.getType()==ee.GroupCallMemberPrefix&&this.refreshRoom(i)}),this.logger=O.getChild("[MatrixRTCSessionManager]")}start(){for(var e of(n=this.client.getRooms())!==null&&n!==void 0?n:[]){var n,r=xm.roomSessionForRoom(this.client,e);r.memberships.length>0&&this.roomSessions.set(e.roomId,r)}this.client.on(Ae.Room,this.onRoom),this.client.on(gt.Events,this.onRoomState)}stop(){for(var e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(Ae.Room,this.onRoom),this.client.off(gt.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,xm.roomSessionForRoom(this.client,e)),this.roomSessions.get(e.roomId)}refreshRoom(e){var n=!this.roomSessions.has(e.roomId),r=this.getRoomSession(e),i=r.memberships.length>0&&!n;r.onRTCSessionMemberUpdate();var s=r.memberships.length>0;i&&!s?(this.logger.trace("Session ended for ".concat(e.roomId," (").concat(r.memberships.length," members)")),this.emit(qE.SessionEnded,e.roomId,this.roomSessions.get(e.roomId))):!i&&s&&(this.logger.trace("Session started for ".concat(e.roomId," (").concat(r.memberships.length," members)")),this.emit(qE.SessionStarted,e.roomId,this.roomSessions.get(e.roomId)))}}function MI(t){return e=>{var n,r;return((n=e.content)===null||n===void 0||(n=n["m.relates_to"])===null||n===void 0?void 0:n.event_id)!==t||((r=e.content)===null||r===void 0||(r=r["m.relates_to"])===null||r===void 0?void 0:r.rel_type)===cn.name}}function ZW(t){return vx.apply(this,arguments)}function vx(){return vx=U(function*(t){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");var e=new TextEncoder().encode(t),n=yield globalThis.crypto.subtle.digest("SHA-256",e);return new Uint8Array(n)}),vx.apply(this,arguments)}class e1 extends Error{}e1.prototype.name="InvalidTokenError";function Tme(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function Rme(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Tme(e)}catch{return atob(e)}}function QW(t,e){if(typeof t!="string")throw new e1("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,r=t.split(".")[n];if(typeof r!="string")throw new e1(`Invalid token specified: missing part #${n+1}`);let i;try{i=Rme(r)}catch(s){throw new e1(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new e1(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}var Ime={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},El,wl,ty=(t=>(t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t))(ty||{});(t=>{function e(){El=3,wl=Ime}t.reset=e;function n(i){if(!(0<=i&&i<=4))throw new Error("Invalid log level");El=i}t.setLevel=n;function r(i){wl=i}t.setLogger=r})(ty||(ty={}));var br=class yl{constructor(e){this._name=e}debug(...e){El>=4&&wl.debug(yl._format(this._name,this._method),...e)}info(...e){El>=3&&wl.info(yl._format(this._name,this._method),...e)}warn(...e){El>=2&&wl.warn(yl._format(this._name,this._method),...e)}error(...e){El>=1&&wl.error(yl._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const n=Object.create(this);return n._method=e,n.debug("begin"),n}static createStatic(e,n){const r=new yl(`${e}.${n}`);return r.debug("begin"),r}static _format(e,n){const r=`[${e}]`;return n?`${r} ${n}:`:r}static debug(e,...n){El>=4&&wl.debug(yl._format(e),...n)}static info(e,...n){El>=3&&wl.info(yl._format(e),...n)}static warn(e,...n){El>=2&&wl.warn(yl._format(e),...n)}static error(e,...n){El>=1&&wl.error(yl._format(e),...n)}};ty.reset();var KE=class{static decode(t){try{return QW(t)}catch(e){throw br.error("JwtUtils.decode",e),e}}static async generateSignedJwt(t,e,n){const r=Ha.encodeBase64Url(new TextEncoder().encode(JSON.stringify(t))),i=Ha.encodeBase64Url(new TextEncoder().encode(JSON.stringify(e))),s=`${r}.${i}`,o=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,new TextEncoder().encode(s)),a=Ha.encodeBase64Url(new Uint8Array(o));return`${s}.${a}`}},kme="10000000-1000-4000-8000-100000000000",yx=t=>btoa([...new Uint8Array(t)].map(e=>String.fromCharCode(e)).join("")),ez=class _l{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return kme.replace(/[018]/g,n=>(+n^_l._randomWord()&15>>+n/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return _l.generateUUIDv4()+_l.generateUUIDv4()+_l.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r);return yx(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(n){throw br.error("CryptoUtils.generateCodeChallenge",n),n}}static generateBasicAuth(e,n){const i=new TextEncoder().encode([e,n].join(":"));return yx(i)}static async hash(e,n){const r=new TextEncoder().encode(n),i=await crypto.subtle.digest(e,r);return new Uint8Array(i)}static async customCalculateJwkThumbprint(e){let n;switch(e.kty){case"RSA":n={e:e.e,kty:e.kty,n:e.n};break;case"EC":n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":n={crv:e.crv,kty:e.kty,x:e.x};break;case"oct":n={crv:e.k,kty:e.kty};break;default:throw new Error("Unknown jwk type")}const r=await _l.hash("SHA-256",JSON.stringify(n));return _l.encodeBase64Url(r)}static async generateDPoPProof({url:e,accessToken:n,httpMethod:r,keyPair:i,nonce:s}){let o,a;const l={jti:window.crypto.randomUUID(),htm:r??"GET",htu:e,iat:Math.floor(Date.now()/1e3)};n&&(o=await _l.hash("SHA-256",n),a=_l.encodeBase64Url(o),l.ath=a),s&&(l.nonce=s);try{const c=await crypto.subtle.exportKey("jwk",i.publicKey),u={alg:"ES256",typ:"dpop+jwt",jwk:{crv:c.crv,kty:c.kty,x:c.x,y:c.y}};return await KE.generateSignedJwt(u,l,i.privateKey)}catch(c){throw c instanceof TypeError?new Error(`Error exporting dpop public key: ${c.message}`):c}}static async generateDPoPJkt(e){try{const n=await crypto.subtle.exportKey("jwk",e.publicKey);return await _l.customCalculateJwkThumbprint(n)}catch(n){throw n instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${n.message}`):n}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};ez.encodeBase64Url=t=>yx(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var Ha=ez,xme=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new br(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const n=this._callbacks.lastIndexOf(e);n>=0&&this._callbacks.splice(n,1)}async raise(...e){this._logger.debug("raise:",...e);for(const n of this._callbacks)await n(...e)}},WE=class T2 extends xme{constructor(){super(...arguments),this._logger=new br(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-T2.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=T2.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const n=this._logger.create("init");e=Math.max(Math.floor(e),1);const r=T2.getEpochTime()+e;if(this.expiration===r&&this._timerHandle){n.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),n.debug("using duration",e),this._expiration=r;const i=Math.min(e,5);this._timerHandle=setInterval(this._callback,i*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},DF=class{static readParams(t,e="query"){if(!t)throw new TypeError("Invalid URL");const r=new URL(t,"http://127.0.0.1")[e==="fragment"?"hash":"search"];return new URLSearchParams(r.slice(1))}},_x=";",lg=class extends Error{constructor(t,e){var n,r,i;if(super(t.error_description||t.error||""),this.form=e,this.name="ErrorResponse",!t.error)throw br.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=t.error,this.error_description=(n=t.error_description)!=null?n:null,this.error_uri=(r=t.error_uri)!=null?r:null,this.state=t.userState,this.session_state=(i=t.session_state)!=null?i:null,this.url_state=t.url_state}},Pme=class extends Error{constructor(t){super(t),this.name="ErrorTimeout"}},Lme=class{constructor(){this._logger=new br("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(t){return this._logger.create(`getItem('${t}')`),this._data[t]}setItem(t,e){this._logger.create(`setItem('${t}')`),this._data[t]=e}removeItem(t){this._logger.create(`removeItem('${t}')`),delete this._data[t]}get length(){return Object.getOwnPropertyNames(this._data).length}key(t){return Object.getOwnPropertyNames(this._data)[t]}},bx=class extends Error{constructor(t,e){super(e),this.name="ErrorDPoPNonce",this.nonce=t}},sA=class{constructor(t=[],e=null,n={}){this._jwtHandler=e,this._extraHeaders=n,this._logger=new br("JsonService"),this._contentTypes=[],this._contentTypes.push(...t,"application/json"),e&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(t,e={}){const{timeoutInSeconds:n,...r}=e;if(!n)return await fetch(t,r);const i=new AbortController,s=setTimeout(()=>i.abort(),n*1e3);try{return await fetch(t,{...e,signal:i.signal})}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new Pme("Network timed out"):o}finally{clearTimeout(s)}}async getJson(t,{token:e,credentials:n,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),s={Accept:this._contentTypes.join(", ")};e&&(i.debug("token passed, setting Authorization header"),s.Authorization="Bearer "+e),this.appendExtraHeaders(s);let o;try{i.debug("url:",t),o=await this.fetchWithTimeout(t,{method:"GET",headers:s,timeoutInSeconds:r,credentials:n})}catch(c){throw i.error("Network Error"),c}i.debug("HTTP response received, status",o.status);const a=o.headers.get("Content-Type");if(a&&!this._contentTypes.find(c=>a.startsWith(c))&&i.throw(new Error(`Invalid response Content-Type: ${a??"undefined"}, from URL: ${t}`)),o.ok&&this._jwtHandler&&(a!=null&&a.startsWith("application/jwt")))return await this._jwtHandler(await o.text());let l;try{l=await o.json()}catch(c){throw i.error("Error parsing JSON response",c),o.ok?c:new Error(`${o.statusText} (${o.status})`)}if(!o.ok)throw i.error("Error from server:",l),l.error?new lg(l):new Error(`${o.statusText} (${o.status}): ${JSON.stringify(l)}`);return l}async postForm(t,{body:e,basicAuth:n,timeoutInSeconds:r,initCredentials:i,extraHeaders:s}){const o=this._logger.create("postForm"),a={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...s};n!==void 0&&(a.Authorization="Basic "+n),this.appendExtraHeaders(a);let l;try{o.debug("url:",t),l=await this.fetchWithTimeout(t,{method:"POST",headers:a,body:e,timeoutInSeconds:r,credentials:i})}catch(p){throw o.error("Network error"),p}o.debug("HTTP response received, status",l.status);const c=l.headers.get("Content-Type");if(c&&!this._contentTypes.find(p=>c.startsWith(p)))throw new Error(`Invalid response Content-Type: ${c??"undefined"}, from URL: ${t}`);const u=await l.text();let f={};if(u)try{f=JSON.parse(u)}catch(p){throw o.error("Error parsing JSON response",p),l.ok?p:new Error(`${l.statusText} (${l.status})`)}if(!l.ok){if(o.error("Error from server:",f),l.headers.has("dpop-nonce")){const p=l.headers.get("dpop-nonce");throw new bx(p,`${JSON.stringify(f)}`)}throw f.error?new lg(f,e):new Error(`${l.statusText} (${l.status}): ${JSON.stringify(f)}`)}return f}appendExtraHeaders(t){const e=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];n.length!==0&&n.forEach(i=>{if(r.includes(i.toLocaleLowerCase())){e.warn("Protected header could not be overridden",i,r);return}const s=typeof this._extraHeaders[i]=="function"?this._extraHeaders[i]():this._extraHeaders[i];s&&s!==""&&(t[i]=s)})}},tz=class{constructor(t){this._settings=t,this._logger=new br("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new sA(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const t=this._logger.create("getMetadata");if(this._metadata)return t.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw t.throw(new Error("No authority or metadataUrl configured on settings")),null;t.debug("getting metadata from",this._metadataUrl);const e=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return t.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,e),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(t=!0){return this._getMetadataProperty("token_endpoint",t)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(t=!0){return this._getMetadataProperty("revocation_endpoint",t)}getKeysEndpoint(t=!0){return this._getMetadataProperty("jwks_uri",t)}async _getMetadataProperty(t,e=!1){const n=this._logger.create(`_getMetadataProperty('${t}')`),r=await this.getMetadata();if(n.debug("resolved"),r[t]===void 0){if(e===!0){n.warn("Metadata does not contain optional property");return}n.throw(new Error("Metadata does not contain property "+t))}return r[t]}async getSigningKeys(){const t=this._logger.create("getSigningKeys");if(this._signingKeys)return t.debug("returning signingKeys from cache"),this._signingKeys;const e=await this.getKeysEndpoint(!1);t.debug("got jwks_uri",e);const n=await this._jsonService.getJson(e,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(t.debug("got key set",n),!Array.isArray(n.keys))throw t.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},OC=class{constructor({prefix:t="oidc.",store:e=localStorage}={}){this._logger=new br("WebStorageStateStore"),this._store=e,this._prefix=t}async set(t,e){this._logger.create(`set('${t}')`),t=this._prefix+t,await this._store.setItem(t,e)}async get(t){return this._logger.create(`get('${t}')`),t=this._prefix+t,await this._store.getItem(t)}async remove(t){this._logger.create(`remove('${t}')`),t=this._prefix+t;const e=await this._store.getItem(t);return await this._store.removeItem(t),e}async getAllKeys(){this._logger.create("getAllKeys");const t=await this._store.length,e=[];for(let n=0;n<t;n++){const r=await this._store.key(n);r&&r.indexOf(this._prefix)===0&&e.push(r.substr(this._prefix.length))}return e}},Ame="code",Ome="openid",Mme="client_secret_post",Nme=60*15,Sx=class{constructor({authority:t,metadataUrl:e,metadata:n,signingKeys:r,metadataSeed:i,client_id:s,client_secret:o,response_type:a=Ame,scope:l=Ome,redirect_uri:c,post_logout_redirect_uri:u,client_authentication:f=Mme,prompt:p,display:m,max_age:v,ui_locales:g,acr_values:S,resource:b,response_mode:w,filterProtocolClaims:k=!0,loadUserInfo:T=!1,requestTimeoutInSeconds:I,staleStateAgeInSeconds:C=Nme,mergeClaimsStrategy:x={array:"replace"},disablePKCE:A=!1,stateStore:N,revokeTokenAdditionalContentTypes:D,fetchRequestCredentials:F,refreshTokenAllowedScope:$,extraQueryParams:B={},extraTokenParams:W={},extraHeaders:H={},dpop:z,omitScopeWhenRequesting:K=!1}){var V;if(this.authority=t,e?this.metadataUrl=e:(this.metadataUrl=t,t&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=l,this.redirect_uri=c,this.post_logout_redirect_uri=u,this.client_authentication=f,this.prompt=p,this.display=m,this.max_age=v,this.ui_locales=g,this.acr_values=S,this.resource=b,this.response_mode=w,this.filterProtocolClaims=k??!0,this.loadUserInfo=!!T,this.staleStateAgeInSeconds=C,this.mergeClaimsStrategy=x,this.omitScopeWhenRequesting=K,this.disablePKCE=!!A,this.revokeTokenAdditionalContentTypes=D,this.fetchRequestCredentials=F||"same-origin",this.requestTimeoutInSeconds=I,N)this.stateStore=N;else{const q=typeof window<"u"?window.localStorage:new Lme;this.stateStore=new OC({store:q})}if(this.refreshTokenAllowedScope=$,this.extraQueryParams=B,this.extraTokenParams=W,this.extraHeaders=H,this.dpop=z,this.dpop&&!((V=this.dpop)!=null&&V.store))throw new Error("A DPoPStore is required when dpop is enabled")}},Dme=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new br("UserInfoService"),this._getClaimsFromJwt=async n=>{const r=this._logger.create("_getClaimsFromJwt");try{const i=KE.decode(n);return r.debug("JWT decoding successful"),i}catch(i){throw r.error("Error parsing JWT response"),i}},this._jsonService=new sA(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(t){const e=this._logger.create("getClaims");t||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();e.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:t,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("got claims",r),r}},nz=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new br("TokenClient"),this._jsonService=new sA(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:t="authorization_code",redirect_uri:e=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...s}){const o=this._logger.create("exchangeCode");n||o.throw(new Error("A client_id is required")),e||o.throw(new Error("A redirect_uri is required")),s.code||o.throw(new Error("A code is required"));const a=new URLSearchParams({grant_type:t,redirect_uri:e});for(const[f,p]of Object.entries(s))p!=null&&a.set(f,p);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw o.throw(new Error("A client_secret is required")),null;l=Ha.generateBasicAuth(n,r);break;case"client_secret_post":a.append("client_id",n),r&&a.append("client_secret",r);break}const c=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const u=await this._jsonService.postForm(c,{body:a,basicAuth:l,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),u}async exchangeCredentials({grant_type:t="password",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const s=this._logger.create("exchangeCredentials");e||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:t});this._settings.omitScopeWhenRequesting||o.set("scope",r);for(const[u,f]of Object.entries(i))f!=null&&o.set(u,f);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=Ha.generateBasicAuth(e,n);break;case"client_secret_post":o.append("client_id",e),n&&o.append("client_secret",n);break}const l=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const c=await this._jsonService.postForm(l,{body:o,basicAuth:a,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),c}async exchangeRefreshToken({grant_type:t="refresh_token",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...s}){const o=this._logger.create("exchangeRefreshToken");e||o.throw(new Error("A client_id is required")),s.refresh_token||o.throw(new Error("A refresh_token is required"));const a=new URLSearchParams({grant_type:t});for(const[f,p]of Object.entries(s))Array.isArray(p)?p.forEach(m=>a.append(f,m)):p!=null&&a.set(f,p);let l;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw o.throw(new Error("A client_secret is required")),null;l=Ha.generateBasicAuth(e,n);break;case"client_secret_post":a.append("client_id",e),n&&a.append("client_secret",n);break}const c=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const u=await this._jsonService.postForm(c,{body:a,basicAuth:l,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),u}async revoke(t){var e;const n=this._logger.create("revoke");t.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${(e=t.token_type_hint)!=null?e:"default token type"}`);const i=new URLSearchParams;for(const[s,o]of Object.entries(t))o!=null&&i.set(s,o);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),n.debug("got response")}},Fme=class{constructor(t,e,n){this._settings=t,this._metadataService=e,this._claimsService=n,this._logger=new br("ResponseValidator"),this._userInfoService=new Dme(this._settings,this._metadataService),this._tokenClient=new nz(this._settings,this._metadataService)}async validateSigninResponse(t,e,n){const r=this._logger.create("validateSigninResponse");this._processSigninState(t,e),r.debug("state processed"),await this._processCode(t,e,n),r.debug("code processed"),t.isOpenId&&this._validateIdTokenAttributes(t),r.debug("tokens validated"),await this._processClaims(t,e==null?void 0:e.skipUserInfo,t.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(t,e){const n=this._logger.create("validateCredentialsResponse");t.isOpenId&&t.id_token&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),await this._processClaims(t,e,t.isOpenId),n.debug("claims processed")}async validateRefreshResponse(t,e){var n,r;const i=this._logger.create("validateRefreshResponse");t.userState=e.data,(n=t.session_state)!=null||(t.session_state=e.session_state),(r=t.scope)!=null||(t.scope=e.scope),t.isOpenId&&t.id_token&&(this._validateIdTokenAttributes(t,e.id_token),i.debug("ID Token validated")),t.id_token||(t.id_token=e.id_token,t.profile=e.profile);const s=t.isOpenId&&!!t.id_token;await this._processClaims(t,!1,s),i.debug("claims processed")}validateSignoutResponse(t,e){const n=this._logger.create("validateSignoutResponse");if(e.id!==t.state&&n.throw(new Error("State does not match")),n.debug("state validated"),t.userState=e.data,t.error)throw n.warn("Response was error",t.error),new lg(t)}_processSigninState(t,e){var n;const r=this._logger.create("_processSigninState");if(e.id!==t.state&&r.throw(new Error("State does not match")),e.client_id||r.throw(new Error("No client_id on state")),e.authority||r.throw(new Error("No authority on state")),this._settings.authority!==e.authority&&r.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==e.client_id&&r.throw(new Error("client_id mismatch on settings vs. signin state")),r.debug("state validated"),t.userState=e.data,t.url_state=e.url_state,(n=t.scope)!=null||(t.scope=e.scope),t.error)throw r.warn("Response was error",t.error),new lg(t);e.code_verifier&&!t.code&&r.throw(new Error("Expected code in response"))}async _processClaims(t,e=!1,n=!0){const r=this._logger.create("_processClaims");if(t.profile=this._claimsService.filterProtocolClaims(t.profile),e||!this._settings.loadUserInfo||!t.access_token){r.debug("not loading user info");return}r.debug("loading user info");const i=await this._userInfoService.getClaims(t.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==t.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),t.profile=this._claimsService.mergeClaims(t.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",t.profile)}async _processCode(t,e,n){const r=this._logger.create("_processCode");if(t.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:e.client_id,client_secret:e.client_secret,code:t.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier,extraHeaders:n,...e.extraTokenParams});Object.assign(t,i)}else r.debug("No code to process")}_validateIdTokenAttributes(t,e){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=KE.decode((n=t.id_token)!=null?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),e){const s=KE.decode(e);i.sub!==s.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==s.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==s.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&s.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}t.profile=i}},zE=class Ex{constructor(e){this.id=e.id||Ha.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=WE.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new br("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(e){return br.createStatic("State","fromStorageString"),Promise.resolve(new Ex(JSON.parse(e)))}static async clearStaleState(e,n){const r=br.createStatic("State","clearStaleState"),i=WE.getEpochTime()-n,s=await e.getAllKeys();r.debug("got keys",s);for(let o=0;o<s.length;o++){const a=s[o],l=await e.get(a);let c=!1;if(l)try{const u=await Ex.fromStorageString(l);r.debug("got item from key:",a,u.created),u.created<=i&&(c=!0)}catch(u){r.error("Error parsing state for key:",a,u),c=!0}else r.debug("no item in storage for key:",a),c=!0;c&&(r.debug("removed item for key:",a),e.remove(a))}}},oA=class wx extends zE{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(e){const n=e.code_verifier===!0?Ha.generateCodeVerifier():e.code_verifier||void 0,r=n?await Ha.generateCodeChallenge(n):void 0;return new wx({...e,code_verifier:n,code_challenge:r})}toStorageString(){return new br("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){br.createStatic("SigninState","fromStorageString");const n=JSON.parse(e);return wx.create(n)}},rz=class iz{constructor(e){this.url=e.url,this.state=e.state}static async create({url:e,authority:n,client_id:r,redirect_uri:i,response_type:s,scope:o,state_data:a,response_mode:l,request_type:c,client_secret:u,nonce:f,url_state:p,resource:m,skipUserInfo:v,extraQueryParams:g,extraTokenParams:S,disablePKCE:b,dpopJkt:w,omitScopeWhenRequesting:k,...T}){if(!e)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!s)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!o)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const I=await oA.create({data:a,request_type:c,url_state:p,code_verifier:!b,client_id:r,authority:n,redirect_uri:i,response_mode:l,client_secret:u,scope:o,extraTokenParams:S,skipUserInfo:v}),C=new URL(e);C.searchParams.append("client_id",r),C.searchParams.append("redirect_uri",i),C.searchParams.append("response_type",s),k||C.searchParams.append("scope",o),f&&C.searchParams.append("nonce",f),w&&C.searchParams.append("dpop_jkt",w);let x=I.id;p&&(x=`${x}${_x}${p}`),C.searchParams.append("state",x),I.code_challenge&&(C.searchParams.append("code_challenge",I.code_challenge),C.searchParams.append("code_challenge_method","S256")),m&&(Array.isArray(m)?m:[m]).forEach(N=>C.searchParams.append("resource",N));for(const[A,N]of Object.entries({response_mode:l,...T,...g}))N!=null&&C.searchParams.append(A,N.toString());return new iz({url:C.href,state:I})}};rz._logger=new br("SigninRequest");var Ume=rz,jme="openid",R2=class{constructor(t){if(this.access_token="",this.token_type="",this.profile={},this.state=t.get("state"),this.session_state=t.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(_x);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(_x))}this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri"),this.code=t.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-WE.getEpochTime()}set expires_in(t){typeof t=="string"&&(t=Number(t)),t!==void 0&&t>=0&&(this.expires_at=Math.floor(t)+WE.getEpochTime())}get isOpenId(){var t;return((t=this.scope)==null?void 0:t.split(" ").includes(jme))||!!this.id_token}},$me=class{constructor({url:t,state_data:e,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:s,client_id:o}){if(this._logger=new br("SignoutRequest"),!t)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(t);n&&a.searchParams.append("id_token_hint",n),o&&a.searchParams.append("client_id",o),r&&(a.searchParams.append("post_logout_redirect_uri",r),e&&(this.state=new zE({data:e,request_type:s}),a.searchParams.append("state",this.state.id)));for(const[l,c]of Object.entries({...i}))c!=null&&a.searchParams.append(l,c.toString());this.url=a.href}},Bme=class{constructor(t){this.state=t.get("state"),this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri")}},Hme=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],Vme=["sub","iss","aud","exp","iat"],Gme=class{constructor(t){this._settings=t,this._logger=new br("ClaimsService")}filterProtocolClaims(t){const e={...t};if(this._settings.filterProtocolClaims){let n;Array.isArray(this._settings.filterProtocolClaims)?n=this._settings.filterProtocolClaims:n=Hme;for(const r of n)Vme.includes(r)||delete e[r]}return e}mergeClaims(t,e){const n={...t};for(const[r,i]of Object.entries(e))if(n[r]!==i)if(Array.isArray(n[r])||Array.isArray(i))if(this._settings.mergeClaimsStrategy.array=="replace")n[r]=i;else{const s=Array.isArray(n[r])?n[r]:[n[r]];for(const o of Array.isArray(i)?i:[i])s.includes(o)||s.push(o);n[r]=s}else typeof n[r]=="object"&&typeof i=="object"?n[r]=this.mergeClaims(n[r],i):n[r]=i;return n}},qme=class{constructor(t,e){this.keys=t,this.nonce=e}},aA=class{constructor(t,e){this._logger=new br("OidcClient"),this.settings=t instanceof Sx?t:new Sx(t),this.metadataService=e??new tz(this.settings),this._claimsService=new Gme(this.settings),this._validator=new Fme(this.settings,this.metadataService,this._claimsService),this._tokenClient=new nz(this.settings,this.metadataService)}async createSigninRequest({state:t,request:e,request_uri:n,request_type:r,id_token_hint:i,login_hint:s,skipUserInfo:o,nonce:a,url_state:l,response_type:c=this.settings.response_type,scope:u=this.settings.scope,redirect_uri:f=this.settings.redirect_uri,prompt:p=this.settings.prompt,display:m=this.settings.display,max_age:v=this.settings.max_age,ui_locales:g=this.settings.ui_locales,acr_values:S=this.settings.acr_values,resource:b=this.settings.resource,response_mode:w=this.settings.response_mode,extraQueryParams:k=this.settings.extraQueryParams,extraTokenParams:T=this.settings.extraTokenParams,dpopJkt:I,omitScopeWhenRequesting:C=this.settings.omitScopeWhenRequesting}){const x=this._logger.create("createSigninRequest");if(c!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");const A=await this.metadataService.getAuthorizationEndpoint();x.debug("Received authorization endpoint",A);const N=await Ume.create({url:A,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:f,response_type:c,scope:u,state_data:t,url_state:l,prompt:p,display:m,max_age:v,ui_locales:g,id_token_hint:i,login_hint:s,acr_values:S,dpopJkt:I,resource:b,request:e,request_uri:n,extraQueryParams:k,extraTokenParams:T,request_type:r,response_mode:w,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:C});await this.clearStaleState();const D=N.state;return await this.settings.stateStore.set(D.id,D.toStorageString()),N}async readSigninResponseState(t,e=!1){const n=this._logger.create("readSigninResponseState"),r=new R2(DF.readParams(t,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await oA.fromStorageString(i),response:r}}async processSigninResponse(t,e){const n=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(t,!0);if(n.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const s=await this.getDpopProof(this.settings.dpop.store);e={...e,DPoP:s}}try{await this._validator.validateSigninResponse(i,r,e)}catch(s){if(s instanceof bx&&this.settings.dpop){const o=await this.getDpopProof(this.settings.dpop.store,s.nonce);e.DPoP=o,await this._validator.validateSigninResponse(i,r,e)}else throw s}return i}async getDpopProof(t,e){let n,r;return(await t.getAllKeys()).includes(this.settings.client_id)?(r=await t.get(this.settings.client_id),r.nonce!==e&&e&&(r.nonce=e,await t.set(this.settings.client_id,r))):(n=await Ha.generateDPoPKeys(),r=new qme(n,e),await t.set(this.settings.client_id,r)),await Ha.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:t,password:e,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:t,password:e,...r}),s=new R2(new URLSearchParams);return Object.assign(s,i),await this._validator.validateCredentialsResponse(s,n),s}async useRefreshToken({state:t,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:s}){var o;const a=this._logger.create("useRefreshToken");let l;if(this.settings.refreshTokenAllowedScope===void 0)l=t.scope;else{const f=this.settings.refreshTokenAllowedScope.split(" ");l=(((o=t.scope)==null?void 0:o.split(" "))||[]).filter(m=>f.includes(m)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const f=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:f}}let c;try{c=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:l,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,...s})}catch(f){if(f instanceof bx&&this.settings.dpop)i.DPoP=await this.getDpopProof(this.settings.dpop.store,f.nonce),c=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:l,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,...s});else throw f}const u=new R2(new URLSearchParams);return Object.assign(u,c),a.debug("validating response",u),await this._validator.validateRefreshResponse(u,{...t,scope:l}),u}async createSignoutRequest({state:t,id_token_hint:e,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:s=this.settings.extraQueryParams}={}){const o=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw o.throw(new Error("No end session endpoint")),null;o.debug("Received end session endpoint",a),!n&&i&&!e&&(n=this.settings.client_id);const l=new $me({url:a,id_token_hint:e,client_id:n,post_logout_redirect_uri:i,state_data:t,extraQueryParams:s,request_type:r});await this.clearStaleState();const c=l.state;return c&&(o.debug("Signout request has state to persist"),await this.settings.stateStore.set(c.id,c.toStorageString())),l}async readSignoutResponseState(t,e=!1){const n=this._logger.create("readSignoutResponseState"),r=new Bme(DF.readParams(t,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new lg(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await zE.fromStorageString(i),response:r}}async processSignoutResponse(t){const e=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(t,!0);return n?(e.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):e.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),zE.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(t,e){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:t,token_type_hint:e})}},$i=function(t){return t.NotSupported="OIDC authentication not supported",t.Misconfigured="OIDC is misconfigured",t.General="Something went wrong with OIDC discovery",t.OpSupport="Configured OIDC OP does not support required functions",t.DynamicRegistrationNotSupported="Dynamic registration not supported",t.DynamicRegistrationFailed="Dynamic registration failed",t.DynamicRegistrationInvalid="Dynamic registration invalid response",t.CodeExchangeFailed="Failed to exchange code for token",t.InvalidBearerTokenResponse="Invalid bearer token response",t.InvalidIdToken="Invalid ID token",t.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",t}({}),lA=t=>!!t&&typeof t=="object"&&!Array.isArray(t),jc=(t,e)=>!t[e]||!g1(t,e)?(O.error("Missing or invalid property: ".concat(e)),!1):!0,g1=(t,e)=>t[e]&&typeof t[e]!="string"?(O.error("Invalid property: ".concat(e)),!1):!0,FF=(t,e)=>t[e]&&(!Array.isArray(t[e])||!t[e].every(n=>typeof n=="string"))?(O.error("Invalid property: ".concat(e)),!1):!0,NI=(t,e,n)=>{var r=t[e];return!r||!Array.isArray(r)||!r.includes(n)?(O.error("Invalid property: ".concat(e,". ").concat(n," is required.")),!1):!0},sz=t=>{if(!lA(t))throw O.error("Issuer configuration not found or malformed"),new Error($i.OpSupport);var e=[jc(t,"issuer"),jc(t,"authorization_endpoint"),jc(t,"token_endpoint"),jc(t,"revocation_endpoint"),g1(t,"registration_endpoint"),g1(t,"account_management_uri"),g1(t,"device_authorization_endpoint"),FF(t,"account_management_actions_supported"),NI(t,"response_types_supported","code"),NI(t,"grant_types_supported","authorization_code"),NI(t,"code_challenge_methods_supported","S256"),FF(t,"prompt_values_supported")].some(n=>!n);if(!e)return t;throw O.error("Issuer configuration not valid"),new Error($i.OpSupport)},oz=t=>{try{return QW(t)}catch(e){throw O.error("Could not decode id_token",e),e}},az=(t,e,n,r)=>{try{if(!t)throw new Error("No ID token");var i=oz(t);if(i.iss!==e)throw new Error("Invalid issuer");var s=typeof i.aud=="string"?[i.aud]:i.aud;if(!s.includes(n))throw new Error("Invalid audience");if(r!==void 0&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>i.exp*1e3)throw new Error("Invalid expiry")}catch(o){throw O.error("Invalid ID token",o),new Error($i.InvalidIdToken)}};function lz(t){if(!lA(t))throw O.error("Stored user state not found"),new Error($i.MissingOrInvalidStoredState);var e=[jc(t,"homeserverUrl"),jc(t,"nonce"),g1(t,"identityServerUrl")].some(n=>!n);if(e)throw new Error($i.MissingOrInvalidStoredState)}var Kme=t=>lA(t)&&jc(t,"token_type")&&t.token_type.toLowerCase()==="bearer"&&jc(t,"access_token")&&jc(t,"refresh_token")&&(!("expires_in"in t)||typeof t.expires_in=="number");function cz(t){if(!Kme(t))throw new Error($i.InvalidBearerTokenResponse)}function UF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function YE(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?UF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):UF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var MC=t=>{var e=t??lo(10);return"openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:".concat(e)},Wme=function(){var t=U(function*(e){if(!globalThis.crypto.subtle)return O.warn("A secure context is required to generate code challenge. Using plain text code challenge"),e;var n=yield ZW(e);return kC(n)});return function(n){return t.apply(this,arguments)}}(),zme=t=>{var{redirectUri:e}=t;return{scope:MC(),redirectUri:e,state:lo(8),nonce:lo(8),codeVerifier:lo(64)}},Yme=function(){var t=U(function*(e,n,r){var{scope:i,redirectUri:s,state:o,nonce:a,codeVerifier:l}=r,c=new URL(e);return c.searchParams.append("response_mode","query"),c.searchParams.append("response_type","code"),c.searchParams.append("redirect_uri",s),c.searchParams.append("client_id",n),c.searchParams.append("state",o),c.searchParams.append("scope",i),c.searchParams.append("nonce",a),c.searchParams.append("code_challenge_method","S256"),c.searchParams.append("code_challenge",yield Wme(l)),c.toString()});return function(n,r,i){return t.apply(this,arguments)}}(),Xme=function(){var t=U(function*(e){var{metadata:n,redirectUri:r,clientId:i,homeserverUrl:s,identityServerUrl:o,nonce:a,prompt:l,urlState:c}=e,u=MC(),f=new aA(YE(YE({},n),{},{client_id:i,redirect_uri:r,authority:n.issuer,response_mode:"query",response_type:"code",scope:u,stateStore:new OC({prefix:"mx_oidc_",store:window.sessionStorage})})),p={homeserverUrl:s,nonce:a,identityServerUrl:o},m=yield f.createSigninRequest({state:p,nonce:a,prompt:l,url_state:c});return m.url});return function(n){return t.apply(this,arguments)}}(),Jme=t=>({id_token:t.id_token,scope:t.scope,expires_at:t.expires_at,refresh_token:t.refresh_token,access_token:t.access_token,token_type:"Bearer"}),Zme=function(){var t=U(function*(e,n){var r=new URL(window.location.origin);r.searchParams.append("code",e),r.searchParams.append("state",n),ty.setLogger(O);try{var i=new R2(r.searchParams),s=new OC({prefix:"mx_oidc_",store:window.sessionStorage}),o=yield s.get(i.state);if(!o)throw new Error($i.MissingOrInvalidStoredState);var a=yield oA.fromStorageString(o),l=new aA(YE(YE({},a),{},{stateStore:s})),c=yield l.processSigninResponse(r.href),u=c.userState;lz(u),cz(c),az(c.id_token,l.settings.authority,l.settings.client_id,u.nonce);var f=Jme(c);return{oidcClientSettings:{clientId:l.settings.client_id,issuer:l.settings.authority},tokenResponse:f,homeserverUrl:u.homeserverUrl,identityServerUrl:u.identityServerUrl,idTokenClaims:c.profile}}catch(m){O.error("Oidc login failed",m);var p=m.message;throw Object.values($i).includes(p)?m:new Error($i.CodeExchangeFailed)}});return function(n,r){return t.apply(this,arguments)}}();function jF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function $F(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var cA=function(){var t=U(function*(e){var n=new URL(".well-known/openid-configuration",e),r=yield fetch(n,{method:le.Get,signal:RC(5e3)}),i=yield r.json();return uA(i)});return function(n){return t.apply(this,arguments)}}(),uA=function(){var t=U(function*(e){var n=sz(e),r=new Sx({authority:n.issuer,metadata:n,redirect_uri:"",client_id:""}),i=new tz(r);return $F($F({},n),{},{signingKeys:yield i.getSigningKeys()})});return function(n){return t.apply(this,arguments)}}(),Qme="urn:ietf:params:oauth:grant-type:device_code",DI=(t,e)=>{if(!e)return!1;var n=new URL(e);return!(n.protocol!==t.protocol||n.hostname!==t.hostname&&!n.hostname.endsWith(".".concat(t.hostname)))},ege=function(){var t=U(function*(e,n){if(!e.registration_endpoint)throw new Error($i.DynamicRegistrationNotSupported);var r=["authorization_code","refresh_token"];if(r.some(u=>!e.grant_types_supported.includes(u)))throw new Error($i.DynamicRegistrationNotSupported);var i=new URL(n.clientUri),s={client_name:n.clientName,client_uri:n.clientUri,response_types:["code"],grant_types:r,redirect_uris:n.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:n.applicationType,contacts:n.contacts,logo_uri:DI(i,n.logoUri)?n.logoUri:void 0,policy_uri:DI(i,n.policyUri)?n.policyUri:void 0,tos_uri:DI(i,n.tosUri)?n.tosUri:void 0},o={Accept:"application/json","Content-Type":"application/json"};try{var a=yield fetch(e.registration_endpoint,{method:le.Post,headers:o,body:JSON.stringify(s)});if(a.status>=400)throw new Error($i.DynamicRegistrationFailed);var l=yield a.json(),c=l.client_id;if(!c||typeof c!="string")throw new Error($i.DynamicRegistrationInvalid);return c}catch(u){throw Object.values($i).includes(u.message)?u:(O.error("Dynamic registration request failed",u),new Error($i.DynamicRegistrationFailed))}});return function(n,r){return t.apply(this,arguments)}}();class tge{constructor(e,n,r,i,s){this.idTokenClaims=s,L(this,"oidcClientReady",void 0),L(this,"oidcClient",void 0),L(this,"inflightRefreshRequest",void 0),this.oidcClientReady=this.initialiseOidcClient(e,n,i,r)}initialiseOidcClient(e,n,r,i){var s=this;return U(function*(){try{var o,a=yield cA(e),l=MC(r);s.oidcClient=new aA({metadata:a,signingKeys:(o=a.signingKeys)!==null&&o!==void 0?o:void 0,client_id:n,scope:l,redirect_uri:i,authority:a.issuer,stateStore:new OC({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(c){throw O.error("Failed to initialise OIDC client.",c),new Error("Failed to initialise OIDC client.")}})()}doRefreshAccessToken(e){var n=this;return U(function*(){n.inflightRefreshRequest||(n.inflightRefreshRequest=n.getNewTokens(e));try{var r=yield n.inflightRefreshRequest;return r}catch(i){throw i instanceof lg?new GL(i):i}finally{n.inflightRefreshRequest=void 0}})()}persistTokens(e){return U(function*(){})()}getNewTokens(e){var n=this;return U(function*(){if(!n.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");var r={refresh_token:e,session_state:"test",data:void 0,profile:n.idTokenClaims},i=Date.now(),s=yield n.oidcClient.useRefreshToken({state:r,timeoutInSeconds:300}),o={accessToken:s.access_token,refreshToken:s.refresh_token,expiry:s.expires_in?new Date(i+s.expires_in*1e3):void 0};return yield n.persistTokens(o),o})()}}var nge=["server","limit","since"];function BF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Br(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?BF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var rge=3e3,HF=10*60*1e3,ige=new wr("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),cg=function(t){return t.Chronological="chronological",t.Detached="detached",t}({}),sge=new zy("m.get_login_token","org.matrix.msc3882.get_login_token"),uz="uk.half-shot.msc2666",dz="uk.half-shot.msc2666.mutual_rooms",fz="uk.half-shot.msc2666.query_mutual_rooms",Il="org.matrix.msc4140",hz="uk.tcpip.msc4133",cl="$",Ae=function(t){return t.Sync="sync",t.Event="event",t.ToDeviceEvent="toDeviceEvent",t.AccountData="accountData",t.Room="Room",t.DeleteRoom="deleteRoom",t.SyncUnexpectedError="sync.unexpectedError",t.ClientWellKnown="WellKnown.client",t.ReceivedVoipEvent="received_voip_event",t.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",t.TurnServers="turnServers",t.TurnServersError="turnServers.error",t}({}),oge=new wr("action","org.matrix.msc3824.action");class NC extends Un{constructor(e){var n,r,i,s;super(),i=this,L(this,"logger",void 0),L(this,"reEmitter",new Vg(this)),L(this,"olmVersion",null),L(this,"usingExternalCrypto",!1),L(this,"_store",void 0),L(this,"deviceId",void 0),L(this,"credentials",void 0),L(this,"legacyPickleKey",void 0),L(this,"scheduler",void 0),L(this,"clientRunning",!1),L(this,"timelineSupport",!1),L(this,"urlPreviewCache",{}),L(this,"identityServer",void 0),L(this,"http",void 0),L(this,"cryptoBackend",void 0),L(this,"cryptoCallbacks",void 0),L(this,"callEventHandler",void 0),L(this,"groupCallEventHandler",void 0),L(this,"supportsCallTransfer",!1),L(this,"forceTURN",!1),L(this,"iceCandidatePoolSize",0),L(this,"idBaseUrl",void 0),L(this,"baseUrl",void 0),L(this,"isVoipWithNoMediaAllowed",void 0),L(this,"useLivekitForGroupCalls",void 0),L(this,"canSupportVoip",!1),L(this,"peekSync",null),L(this,"isGuestAccount",!1),L(this,"ongoingScrollbacks",{}),L(this,"notifTimelineSet",null),L(this,"legacyCryptoStore",void 0),L(this,"verificationMethods",void 0),L(this,"fallbackICEServerAllowed",!1),L(this,"syncApi",void 0),L(this,"roomNameGenerator",void 0),L(this,"pushRules",void 0),L(this,"syncLeftRoomsPromise",void 0),L(this,"syncedLeftRooms",!1),L(this,"clientOpts",void 0),L(this,"clientWellKnownIntervalID",void 0),L(this,"canResetTimelineCallback",void 0),L(this,"canSupport",new Map),L(this,"pushProcessor",new ka(this)),L(this,"serverVersionsPromise",void 0),L(this,"clientWellKnown",void 0),L(this,"clientWellKnownPromise",void 0),L(this,"turnServers",[]),L(this,"turnServersExpiry",0),L(this,"checkTurnServersIntervalID",void 0),L(this,"txnCtr",0),L(this,"mediaHandler",new Qpe(this)),L(this,"sessionId",void 0),L(this,"eventsBeingEncrypted",new Set),L(this,"useE2eForGroupCall",!0),L(this,"toDeviceMessageQueue",void 0),L(this,"livekitServiceURL",void 0),L(this,"_secretStorage",void 0),L(this,"ignoredInvites",void 0),L(this,"matrixRTC",void 0),L(this,"serverCapabilitiesService",void 0),L(this,"startCallEventHandler",()=>{this.isInitialSyncComplete()&&(ox()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off(Ae.Sync,this.startCallEventHandler))}),L(this,"startMatrixRTC",()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off(Ae.Sync,this.startMatrixRTC))}),L(this,"fixupRoomNotifications",()=>{if(this.isInitialSyncComplete()){var a,l=((a=this.getRooms())!==null&&a!==void 0?a:[]).filter(f=>f.getUnreadNotificationCount(Kt.Total)>0);for(var c of l){var u=this.getSafeUserId();c.fixupNotifications(u)}this.off(Ae.Sync,this.fixupRoomNotifications)}}),this.logger=(n=e.logger)!==null&&n!==void 0?n:O,e.baseUrl=bI(e.baseUrl),e.idBaseUrl=bI(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=(r=e.usingExternalCrypto)!==null&&r!==void 0?r:!1,this.store=e.store||new npe,this.deviceId=e.deviceId||null,this.sessionId=lo(10);var o=e.userId||null;this.credentials={userId:o},this.http=new kW(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:Hr.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.pickleKey&&(this.legacyPickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction(function(){var a=U(function*(l){var c=i.getRoom(l.getRoomId());l.status!==at.SENDING&&i.updatePendingEventStatus(c,l,at.SENDING);var u=yield i.sendEventHttpRequest(l);return c&&c.updatePendingEvent(l,at.SENT,u.event_id),u});return function(l){return a.apply(this,arguments)}}()),ox()&&(this.callEventHandler=new Spe(this),this.groupCallEventHandler=new Epe(this),this.canSupportVoip=!0,this.on(Ae.Sync,this.startCallEventHandler)),this.matrixRTC=new Cme(this),this.serverCapabilitiesService=new PW(this.http),this.on(Ae.Sync,this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.legacyCryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=e.iceCandidatePoolSize===void 0?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,e.useE2eForGroupCall!==void 0&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new ame(this),this.on(Ht.Decrypted,a=>{pz(this,a)}),this.ignoredInvites=new lme(this),this._secretStorage=new zW(this,(s=e.cryptoCallbacks)!==null&&s!==void 0?s:{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator(n=>Hc.createUser(n,this))}get store(){return this._store}startClient(e){var n=this;return U(function*(){if(!n.clientRunning){n.clientRunning=!0,n.on(Ae.Sync,n.startMatrixRTC);var r=n.getUserId();r&&n.store.storeUser(new Hc(r)),n.canSupportVoip&&(n.checkTurnServersIntervalID=setInterval(()=>{n.checkTurnServers()},HF),n.checkTurnServers()),n.syncApi&&(n.logger.error("Still have sync object whilst not running: stopping old one"),n.syncApi.stop());try{yield n.getVersions();var{threads:i,list:s,fwdPagination:o}=yield n.doesServerSupportThread();Rn.setServerSideSupport(i),Rn.setServerSideListSupport(s),Rn.setServerSideFwdPaginationSupport(o)}catch(a){n.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",a)}n.clientOpts=e??{},n.clientOpts.slidingSync?n.syncApi=new GW(n.clientOpts.slidingSync,n,n.clientOpts,n.buildSyncApiOptions()):n.syncApi=new hd(n,n.clientOpts,n.buildSyncApiOptions()),n.syncApi.sync().catch(a=>n.logger.info("Sync startup aborted with an error:",a)),n.clientOpts.clientWellKnownPollPeriod!==void 0&&(n.clientWellKnownIntervalID=setInterval(()=>{n.fetchClientWellKnown()},1e3*n.clientOpts.clientWellKnownPollPeriod),n.fetchClientWellKnown()),n.toDeviceMessageQueue.start(),n.serverCapabilitiesService.start()}})()}buildSyncApiOptions(){return{cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>this.canResetTimelineCallback?this.canResetTimelineCallback(e):!1}}stopClient(){var e,n,r,i,s;(e=this.cryptoBackend)===null||e===void 0||e.stop(),this.off(Ae.Sync,this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,(n=this.syncApi)===null||n===void 0||n.stop(),this.syncApi=void 0,(r=this.peekSync)===null||r===void 0||r.stopPeeking(),(i=this.callEventHandler)===null||i===void 0||i.stop(),(s=this.groupCallEventHandler)===null||s===void 0||s.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.clientWellKnownIntervalID!==void 0&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}clearStores(){var e=this;if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var n=[];n.push(this.store.deleteAllData()),this.legacyCryptoStore&&n.push(this.legacyCryptoStore.deleteAllData());var r=function(){var i=U(function*(){var s;try{if(s=globalThis.indexedDB,!s)return}catch{return}var o=function*(c){var u=new Promise((f,p)=>{e.logger.info("Removing IndexedDB instance ".concat(c));var m=s.deleteDatabase(c);m.onsuccess=v=>{e.logger.info("Removed IndexedDB instance ".concat(c)),f(0)},m.onerror=v=>{e.logger.warn("Failed to remove IndexedDB instance ".concat(c,":"),v),f(0)},m.onblocked=v=>{e.logger.info("cannot yet remove IndexedDB instance ".concat(c))}});yield u};for(var a of["".concat(LI,"::matrix-sdk-crypto"),"".concat(LI,"::matrix-sdk-crypto-meta")])yield*o(a)});return function(){return i.apply(this,arguments)}}();return n.push(r()),Promise.all(n).then()}getUserId(){var e,n;return(e=(n=this.credentials)===null||n===void 0?void 0:n.userId)!==null&&e!==void 0?e:null}getSafeUserId(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return(e=this.credentials)!==null&&e!==void 0&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,n;return(e=(n=this.credentials)===null||n===void 0||(n=n.userId)===null||n===void 0?void 0:n.split(":")[0].substring(1))!==null&&e!==void 0?e:null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return Q1(this,e)}createGroupCall(e,n,r,i,s,o){var a=this;return U(function*(){if(a.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));var l=a.getRoom(e);if(!l)throw new Error("Cannot find room ".concat(e));return new XL(a,l,n,r,i,void 0,s||a.isVoipWithNoMediaAllowed,o,a.isVoipWithNoMediaAllowed,a.useLivekitForGroupCalls,a.livekitServiceURL).create()})()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,n;return(e=(n=this.syncApi)===null||n===void 0?void 0:n.getSyncState())!==null&&e!==void 0?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){var e=this.getSyncState();return e?e===qt.Prepared||e===qt.Syncing:!1}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,n;return this.toDeviceMessageQueue.sendQueue(),(e=(n=this.syncApi)===null||n===void 0?void 0:n.retryImmediately())!==null&&e!==void 0?e:!1}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){var e=this;return U(function*(){var n=e.serverCapabilitiesService.getCachedCapabilities();return n||e.serverCapabilitiesService.fetchCapabilities()})()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}initRustCrypto(){var e=arguments,n=this;return U(function*(){var r,i=e.length>0&&e[0]!==void 0?e[0]:{};if(n.cryptoBackend){n.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");return}var s=n.getUserId();if(s===null)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");var o=n.getDeviceId();if(o===null)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");n.logger.debug("Downloading Rust crypto library");var a=yield X1(()=>import("./index-Bs8NXL8x.js"),__vite__mapDeps([0,1]),import.meta.url),l=yield a.initRustCrypto({logger:n.logger,http:n.http,userId:s,deviceId:o,secretStorage:n.secretStorage,cryptoCallbacks:n.cryptoCallbacks,storePrefix:i.useIndexedDB===!1?null:LI,storeKey:i.storageKey,storePassphrase:i.storagePassword,legacyCryptoStore:n.legacyCryptoStore,legacyPickleKey:(r=n.legacyPickleKey)!==null&&r!==void 0?r:"DEFAULT_KEY",legacyMigrationProgressListener:(c,u)=>{n.emit(ri.LegacyCryptoStoreMigrationProgress,c,u)}});l.setSupportedVerificationMethods(n.verificationMethods),n.cryptoBackend=l,n.on(Is.Membership,l.onRoomMembership.bind(l)),n.on(Ae.Event,c=>{l.onLiveEventFromSync(c)}),n.reEmitter.reEmit(l,[ri.VerificationRequestReceived,ri.UserTrustStatusChanged,ri.KeyBackupStatus,ri.KeyBackupSessionsRemaining,ri.KeyBackupFailed,ri.KeyBackupDecryptionKeyCached,ri.KeysChanged,ri.DevicesUpdated,ri.WillUpdateDevices,ri.DehydratedDeviceCreated,ri.DehydratedDeviceUploaded,ri.RehydrationStarted,ri.RehydrationProgress,ri.RehydrationCompleted,ri.RehydrationError,ri.DehydrationKeyCached,ri.DehydratedDeviceRotationError])})()}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isRoomEncrypted(e){var n=this.getRoom(e);return n?n.hasEncryptionStateEvent():!1}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}makeKeyBackupPath(e,n,r){var i;n!==void 0?i=Ie("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:n}):e!==void 0?i=Ie("/room_keys/keys/$roomId",{$roomId:e}):i="/room_keys/keys";var s=r===void 0?void 0:{version:r};return{path:i,queryData:s}}deleteKeysFromBackup(e,n,r){var i=this;return U(function*(){var s=i.makeKeyBackupPath(e,n,r);yield i.http.authedRequest(le.Delete,s.path,s.queryData,void 0,{prefix:Hr.V3})})()}getMediaConfig(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=e?"/media/config":"/config";return this.http.authedRequest(le.Get,n,void 0,void 0,{prefix:e?Hr.V1:Tm.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.store.getRooms(),r=new Set;for(var i of n){var s,o=(s=i.findPredecessor(e))===null||s===void 0?void 0:s.roomId;o&&r.add(o)}return n.filter(a=>{var l=a.currentState.getStateEvents(ee.RoomTombstone,"");return!(l&&r.has(a.roomId))})}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,n){var r=this;return U(function*(){if(!r.clientRunning)return O.warn("Calling `setAccountData` before the client is started: `getAccountData` may return inconsistent results."),yield J6(5,()=>r.setAccountDataRaw(e,n));var i=r.store.getAccountData(e);if(i&&Eh(i.event.content,n))return{};var s=Promise.withResolvers();function o(l){l.getType()===e&&s.resolve()}r.addListener(Ae.AccountData,o);try{var a=yield J6(5,()=>r.setAccountDataRaw(e,n));return yield s.promise,a}finally{r.removeListener(Ae.AccountData,o)}})()}setAccountDataRaw(e,n){var r=Ie("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this.http.authedRequest(le.Put,r,void 0,n)}getAccountData(e){return this.store.getAccountData(e)}getAccountDataFromServer(e){var n=this;return U(function*(){if(n.isInitialSyncComplete()){var r=n.store.getAccountData(e);return r?r.getContent():null}var i=Ie("/user/$userId/account_data/$type",{$userId:n.credentials.userId,$type:e});try{return yield n.http.authedRequest(le.Get,i)}catch(o){var s;if(((s=o.data)===null||s===void 0?void 0:s.errcode)==="M_NOT_FOUND")return null;throw o}})()}deleteAccountData(e){var n=this;return U(function*(){var r=n.canSupport.get(Kr.AccountDataDeletion);if(r===qr.Unsupported){yield n.setAccountData(e,{});return}var i=Ie("/user/$userId/account_data/$type",{$userId:n.getSafeUserId(),$type:e}),s=r===qr.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return yield n.http.authedRequest(le.Delete,i,void 0,void 0,s)})()}getIgnoredUsers(){var e=this.getAccountData(ee.IgnoredUserList);return e!=null&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){var n={ignored_users:{}};return e.forEach(r=>{n.ignored_users[r]={}}),this.setAccountData(ee.IgnoredUserList,n)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}joinRoom(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};i.syncRoom===void 0&&(i.syncRoom=!0);var s=r.getRoom(e);if(s!=null&&s.hasMembershipState(r.credentials.userId,qe.Join))return s;var o=Promise.resolve();if(i.inviteSignUrl){var a=new URL(i.inviteSignUrl);a.searchParams.set("mxid",r.credentials.userId),o=r.http.requestOtherUrl(le.Post,a)}var l={};i.viaServers&&(l.server_name=i.viaServers,l.via=i.viaServers);var c={},u=yield o;u&&(c.third_party_signed=u);var f=Ie("/join/$roomid",{$roomid:e}),p=yield r.http.authedRequest(le.Post,f,l,c),m=p.room_id,v=r.getRoom(m);if(v!=null&&v.hasMembershipState(r.credentials.userId,qe.Join))return v;var g=new hd(r,r.clientOpts,r.buildSyncApiOptions()),S=g.createRoom(m);return i.syncRoom,S})()}knockRoom(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,qe.Knock))return Promise.resolve({room_id:r.roomId});var i=Ie("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),s={};n.viaServers&&(s.server_name=n.viaServers,s.via=n.viaServers);var o={};return n.reason&&(o.reason=n.reason),this.http.authedRequest(le.Post,i,s,o)}resendEvent(e,n){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(n,e,at.SENDING),this.encryptAndSendEvent(n,e)}cancelPendingEvent(e){if(![at.QUEUED,at.NOT_SENT,at.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===at.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===at.QUEUED&&this.scheduler.removeEventFromQueue(e);var n=this.getRoom(e.getRoomId());this.updatePendingEventStatus(n,e,at.CANCELLED)}setRoomName(e,n){return this.sendStateEvent(e,ee.RoomName,{name:n})}setRoomTopic(e,n,r){var i=vW(n,r);return this.sendStateEvent(e,ee.RoomTopic,i)}getRoomTags(e){var n=Ie("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(le.Get,n)}setRoomTag(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=Ie("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(le.Put,i,void 0,r)}deleteRoomTag(e,n){var r=Ie("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(le.Delete,r)}setRoomAccountData(e,n,r){var i=Ie("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:n});return this.http.authedRequest(le.Put,i,void 0,r)}setPowerLevel(e,n,r){var i=this;return U(function*(){var s,o;if(i.clientRunning&&i.isInitialSyncComplete()){var a;o=(a=i.getRoom(e))===null||a===void 0||(a=a.currentState)===null||a===void 0||(a=a.getStateEvents(ee.RoomPowerLevels,""))===null||a===void 0?void 0:a.getContent()}if(!o)try{o=yield i.getStateEvent(e,ee.RoomPowerLevels,"")}catch(u){if(u instanceof Nn&&u.errcode==="M_NOT_FOUND")o={};else throw u}o=Zy(o),(s=o)!==null&&s!==void 0&&s.users||(o.users={});var l=Array.isArray(n)?n:[n];for(var c of l)r==null?delete o.users[c]:o.users[c]=r;return i.sendStateEvent(e,ee.RoomPowerLevels,o,"")})()}unstable_createLiveBeacon(e,n){var r=this;return U(function*(){return r.unstable_setLiveBeacon(e,n)})()}unstable_setLiveBeacon(e,n){var r=this;return U(function*(){return r.sendStateEvent(e,eA.name,n,r.getUserId())})()}sendEvent(e,n,r,i,s){var o,a,l,c;return!(n!=null&&n.startsWith(cl))&&n!==null?(c=i,l=r,a=n,o=null):(c=s,l=i,a=r,o=n),this.addThreadRelationIfNeeded(l,o,e),this.sendCompleteEvent(e,o,{type:a,content:l},c)}addThreadRelationIfNeeded(e,n,r){var i;if(n&&!((i=e["m.relates_to"])!==null&&i!==void 0&&i.rel_type)){var s,o,a=!!((s=e["m.relates_to"])!==null&&s!==void 0&&s["m.in_reply_to"]);e["m.relates_to"]=Br(Br({},e["m.relates_to"]),{},{rel_type:cn.name,event_id:n,is_falling_back:!a});var l=(o=this.getRoom(r))===null||o===void 0?void 0:o.getThread(n);if(l&&!a){var c,u;e["m.relates_to"]["m.in_reply_to"]={event_id:(c=(u=l.lastReply(f=>f.isRelation(cn.name)&&!f.status))===null||u===void 0?void 0:u.getId())!==null&&c!==void 0?c:n}}}}sendCompleteEvent(e,n,r,i,s){var o,a;typeof i=="string"?a=i:(o=i,a=s),a||(a=this.makeTxnId());var l=new Bi(Object.assign(r,{event_id:"~"+e+":"+a,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:new Date().getTime()})),c=this.getRoom(e),u=n?c==null?void 0:c.getThread(n):void 0;u&&l.setThread(u),o||(this.reEmitter.reEmit(l,[Ht.Replaced,Ht.VisibilityChange]),c==null||c.reEmitter.reEmit(l,[Ht.BeforeRedaction]));var f=l.getAssociatedId();if(f!=null&&f.startsWith("~")){var p=c==null?void 0:c.getPendingEvents().find(v=>v.getId()===f);p==null||p.once(Ht.LocalEventIdReplaced,()=>{l.updateAssociatedId(p.getId())})}var m=l.getType();return this.logger.debug("sendEvent of type ".concat(m," in ").concat(e," with txnId ").concat(a).concat(o?" (delayed event)":"")),l.setTxnId(a),l.setStatus(at.SENDING),o?this.encryptAndSendEvent(c,l,o):(c==null||c.addPendingEvent(l,a),l.status===at.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(c,l))}encryptAndSendEvent(e,n,r){var i=this;return U(function*(){if(r)return i.sendEventHttpRequest(n,r);try{var s;i.eventsBeingEncrypted.add(n.getId());try{yield i.encryptEventIfNeeded(n,e??void 0)}finally{s=!i.eventsBeingEncrypted.delete(n.getId())}if(s)return{};n.status===at.ENCRYPTING&&i.updatePendingEventStatus(e,n,at.SENDING);var o=null;return i.scheduler&&(o=i.scheduler.queueEvent(n),o&&i.scheduler.getQueueForEvent(n).length>1&&i.updatePendingEventStatus(e,n,at.QUEUED)),o||(o=i.sendEventHttpRequest(n),e&&(o=o.then(a=>(e.updatePendingEvent(n,at.SENT,a.event_id),a)))),yield o}catch(a){i.logger.error("Error sending event",a);try{n.error=a,i.updatePendingEventStatus(e,n,at.NOT_SENT)}catch(l){i.logger.error("Exception in error handler!",l)}throw a instanceof Nn&&(a.event=n),a}})()}encryptEventIfNeeded(e,n){var r=this;return U(function*(){if(n&&(yield r.shouldEncryptEventForRoom(e,n))&&!(!r.cryptoBackend&&r.usingExternalCrypto)){if(!r.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");r.updatePendingEventStatus(n,e,at.ENCRYPTING),yield r.cryptoBackend.encryptEvent(e,n)}})()}shouldEncryptEventForRoom(e,n){var r=this;return U(function*(){var i;return e.isEncrypted()||e.getType()===ee.Reaction||e.isRedaction()?!1:!!(n.hasEncryptionStateEvent()||(yield(i=r.cryptoBackend)===null||i===void 0?void 0:i.isEncryptionEnabledInRoom(n.roomId)))})()}getEncryptedIfNeededEventType(e,n){var r;return n===ee.Reaction?n:(r=this.getRoom(e))!==null&&r!==void 0&&r.hasEncryptionStateEvent()?ee.RoomMessageEncrypted:n}updatePendingEventStatus(e,n,r){e?e.updatePendingEvent(n,r):n.setStatus(r)}sendEventHttpRequest(e,n){var r=e.getTxnId();r||(r=this.makeTxnId(),e.setTxnId(r));var i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:r},s;if(e.isState()){var o="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(o="/rooms/$roomId/state/$eventType/$stateKey"),s=Ie(o,i)}else if(e.isRedaction()&&e.event.redacts){var a="/rooms/$roomId/redact/$redactsEventId/$txnId";s=Ie(a,Br({$redactsEventId:e.event.redacts},i))}else s=Ie("/rooms/$roomId/send/$eventType/$txnId",i);var l=e.getWireContent();return n?this.http.authedRequest(le.Put,s,VF(n),l):this.http.authedRequest(le.Put,s,void 0,l).then(c=>(this.logger.debug("Event sent to ".concat(e.getRoomId()," with event id ").concat(c.event_id)),c))}redactEvent(e,n,r,i,s){var o,a,l;(o=r)!==null&&o!==void 0&&o.startsWith(cl)||(s=i,i=r,r=n,n=null);var c=(a=s)===null||a===void 0?void 0:a.reason,u={reason:c};if(((l=s)===null||l===void 0?void 0:l.with_rel_types)!==void 0){if(this.canSupport.get(Kr.RelationBasedRedactions)===qr.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(r," txnId: ").concat(i," threadId ").concat(n));var f=this.canSupport.get(Kr.RelationBasedRedactions)===qr.Stable?q6.stable:q6.unstable;u[f]=s.with_rel_types}return this.sendCompleteEvent(e,n,{type:ee.RoomRedaction,content:u,redacts:r},i)}sendMessage(e,n,r,i){typeof n!="string"&&n!==null&&(i=r,r=n,n=null);var s=ee.RoomMessage,o=r;return this.sendEvent(e,n,s,o,i)}sendTextMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(i=r,r=n,n=null);var o=fW(r);return this.sendMessage(e,n,o,i)}sendNotice(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(i=r,r=n,n=null);var o=hW(r);return this.sendMessage(e,n,o,i)}sendEmoteMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(i=r,r=n,n=null);var o=pW(r);return this.sendMessage(e,n,o,i)}sendImageMessage(e,n,r,i){var s,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"Image";!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(o=i||"Image",i=r,r=n,n=null);var a={msgtype:ql.Image,url:r,info:i,body:o};return this.sendMessage(e,n,a)}sendStickerMessage(e,n,r,i){var s,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"Sticker";!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(o=i||"Sticker",i=r,r=n,n=null);var a={url:r,info:i,body:o};return this.sendEvent(e,n,ee.Sticker,a)}sendHtmlMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(i=r,r=n,n=null);var o=cW(r,i);return this.sendMessage(e,n,o)}sendHtmlNotice(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(i=r,r=n,n=null);var o=uW(r,i);return this.sendMessage(e,n,o)}sendHtmlEmote(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(cl))&&n!==null&&(i=r,r=n,n=null);var o=dW(r,i);return this.sendMessage(e,n,o)}_unstable_sendDelayedEvent(e,n,r,i,s,o){var a=this;return U(function*(){if(!(yield a.doesServerSupportUnstableFeature(Il)))throw new md("Server does not support the delayed events API","sendDelayedEvent");return a.addThreadRelationIfNeeded(s,r,e),a.sendCompleteEvent(e,r,{type:i,content:s},n,o)})()}_unstable_sendDelayedStateEvent(e,n,r,i){var s=arguments,o=this;return U(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:"",l=s.length>5&&s[5]!==void 0?s[5]:{};if(!(yield o.doesServerSupportUnstableFeature(Il)))throw new md("Server does not support the delayed events API","sendDelayedStateEvent");var c={$roomId:e,$eventType:r,$stateKey:a},u=Ie("/rooms/$roomId/state/$eventType",c);return a!==void 0&&(u=Ie(u+"/$stateKey",c)),o.http.authedRequest(le.Put,u,VF(n),i,l)})()}_unstable_getDelayedEvents(e){var n=this;return U(function*(){if(!(yield n.doesServerSupportUnstableFeature(Il)))throw new md("Server does not support the delayed events API","getDelayedEvents");var r=e?{from:e}:void 0;return yield n.http.authedRequest(le.Get,"/delayed_events",r,void 0,{prefix:"".concat(Hr.Unstable,"/").concat(Il)})})()}_unstable_updateDelayedEvent(e,n){var r=arguments,i=this;return U(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{};if(!(yield i.doesServerSupportUnstableFeature(Il)))throw new md("Server does not support the delayed events API","updateDelayedEvent");var o=Ie("/delayed_events/$delayId",{$delayId:e}),a={action:n};return yield i.http.authedRequest(le.Post,o,void 0,a,Br(Br({},s),{},{prefix:"".concat(Hr.Unstable,"/").concat(Il)}))})()}sendReceipt(e,n,r){var i=arguments,s=this;return U(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:!1;if(s.isGuest())return Promise.resolve({});var a=Ie("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:n,$eventId:e.getId()}),l=!o&&s.supportsThreads(),c=l?Br(Br({},r),{},{thread_id:ug(e)}):r,u=s.http.authedRequest(le.Post,a,void 0,c||{}),f=s.getRoom(e.getRoomId());return f&&s.credentials.userId&&f.addLocalEchoReceipt(s.credentials.userId,e,n,o),u})()}sendReadReceipt(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:Ji.Read,s=n.length>2&&n[2]!==void 0?n[2]:!1;if(e){var o=e.getId(),a=r.getRoom(e.getRoomId());if(a!=null&&a.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));return r.sendReceipt(e,i,{},s)}})()}setRoomReadMarkers(e,n,r,i){var s=this;return U(function*(){var o=s.getRoom(e);if(o!=null&&o.hasPendingEvent(n))throw new Error("Cannot set read marker to a pending event (".concat(n,")"));var a;if(r){if(a=r.getId(),o!=null&&o.hasPendingEvent(a))throw new Error("Cannot set read receipt to a pending event (".concat(a,")"));o==null||o.addLocalEchoReceipt(s.credentials.userId,r,Ji.Read)}var l;if(i){if(l=i.getId(),o!=null&&o.hasPendingEvent(l))throw new Error("Cannot set read receipt to a pending event (".concat(l,")"));o==null||o.addLocalEchoReceipt(s.credentials.userId,i,Ji.ReadPrivate)}return yield s.setRoomReadMarkersHttpRequest(e,n,a,l)})()}getUrlPreview(e,n){n=Math.floor(n/6e4)*6e4;var r=new URL(e);r.hash="",e=r.toString();var i=n+"_"+e;if(i in this.urlPreviewCache)return this.urlPreviewCache[i];var s=this.http.authedRequest(le.Get,"/preview_url",{url:e,ts:n.toString()},void 0,{prefix:Tm.V3,priority:"low"});return this.urlPreviewCache[i]=s,s}sendTyping(e,n,r){if(this.isGuest())return Promise.resolve({});var i=Ie("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),s={typing:n};return n&&(s.timeout=r||2e4),this.http.authedRequest(le.Put,i,void 0,s)}getRoomUpgradeHistory(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getRoom(e);if(!i)return[];var s=this.findPredecessorRooms(i,n,r),o=this.findSuccessorRooms(i,n,r);return[...s,i,...o]}findPredecessorRooms(e,n,r){for(var i,s=[],o=new Set([e.roomId]),a=(i=e.findPredecessor(r))===null||i===void 0?void 0:i.roomId;a!==null;){var l;if(a){if(o.has(a))break;o.add(a)}var c=this.getRoom(a);if(c===null)break;if(n){var u=c.currentState.getStateEvents(ee.RoomTombstone,"");if(!u||u.getContent().replacement_room!==e.roomId)break}s.splice(0,0,c),e=c,a=(l=e.findPredecessor(r))===null||l===void 0?void 0:l.roomId}return s}findSuccessorRooms(e,n,r){for(var i=[],s=e.currentState.getStateEvents(ee.RoomTombstone,"");s;){var o=this.getRoom(s.getContent().replacement_room);if(!o||o.roomId===e.roomId)break;if(n){var a,l=(a=o.findPredecessor(r))===null||a===void 0?void 0:a.roomId;if(!l||l!==e.roomId)break}i.push(o);var c=new Set(i.map(u=>u.roomId));if(c.size<i.length)return i.slice(0,i.length-1);e=o,s=e.currentState.getStateEvents(ee.RoomTombstone,"")}return i}invite(e,n,r){return this.membershipChange(e,n,qe.Invite,r)}inviteByEmail(e,n){return this.inviteByThreePid(e,"email",n)}inviteByThreePid(e,n,r){var i=this;return U(function*(){var s,o=Ie("/rooms/$roomId/invite",{$roomId:e}),a=i.getIdentityServerUrl(!0);if(!a)return Promise.reject(new Nn({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));var l={id_server:a,medium:n,address:r};if((s=i.identityServer)!==null&&s!==void 0&&s.getAccessToken){var c=yield i.identityServer.getAccessToken();c&&(l.id_access_token=c)}return i.http.authedRequest(le.Post,o,void 0,l)})()}leave(e){return this.membershipChange(e,void 0,qe.Leave)}leaveRoomChain(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.getRoomUpgradeHistory(e),i=r;if(!n){i=[];for(var s of r)if(i.push(s),s.roomId===e)break}var o={},a=[],l=u=>this.leave(u).then(()=>{delete o[u]}).catch(f=>{o[u]=f});for(var c of i)a.push(l(c.roomId));return Promise.all(a).then(()=>o)}ban(e,n,r){return this.membershipChange(e,n,qe.Ban,r)}forget(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!0,s=Ie("/rooms/$room_id/forget",{$room_id:e}),o=yield r.http.authedRequest(le.Post,s);return i&&(r.store.removeRoom(e),r.emit(Ae.DeleteRoom,e)),o})()}unban(e,n){var r=Ie("/rooms/$roomId/unban",{$roomId:e}),i={user_id:n};return this.http.authedRequest(le.Post,r,void 0,i)}kick(e,n,r){var i=Ie("/rooms/$roomId/kick",{$roomId:e}),s={user_id:n,reason:r};return this.http.authedRequest(le.Post,i,void 0,s)}membershipChange(e,n,r,i){var s=Ie("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(le.Post,s,void 0,{user_id:n,reason:i})}getPushActionsForEvent(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e.getPushActions()||n){var{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushActions()}getPushDetailsForEvent(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e.getPushDetails()||n){var{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushDetails()}setProfileInfo(e,n){var r=Ie("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(le.Put,r,void 0,n)}setDisplayName(e){var n=this;return U(function*(){var r=yield n.setProfileInfo("displayname",{displayname:e}),i=n.getUser(n.getUserId());return i&&(i.displayName=e,i.emit(Si.DisplayName,i.events.presence,i)),r})()}setAvatarUrl(e){var n=this;return U(function*(){var r=yield n.setProfileInfo("avatar_url",{avatar_url:e}),i=n.getUser(n.getUserId());return i&&(i.avatarUrl=e,i.emit(Si.AvatarUrl,i.events.presence,i)),r})()}mxcUrlToHttp(e,n,r,i,s,o,a){return wC(this.baseUrl,e,n,r,i,s,o,a)}setSyncPresence(e){var n=this;return U(function*(){var r;(r=n.syncApi)===null||r===void 0||r.setPresence(e)})()}setPresence(e){var n=this;return U(function*(){var r=Ie("/presence/$userId/status",{$userId:n.credentials.userId}),i=["offline","online","unavailable"];if(i.indexOf(e.presence)===-1)throw new Error("Bad presence value: "+e.presence);yield n.http.authedRequest(le.Put,r,void 0,e)})()}getPresence(e){var n=Ie("/presence/$userId/status",{$userId:e});return this.http.authedRequest(le.Get,n)}scrollback(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:30,r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){var s=Date.now()-i.errorTs;r=Math.max(rge-s,0)}if(e.oldState.paginationToken===null)return Promise.resolve(e);var o=this.store.scrollback(e,n).length;if(o===n)return Promise.resolve(e);n=n-o;var a=new Promise((l,c)=>{tu(r).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,n,_t.Backward)).then(u=>{var f,p,m=u.chunk.map(this.getEventMapper());if(u.state){var v=u.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(v)}var[g,S,b]=e.partitionThreadedEvents(m);this.processAggregatedTimelineEvents(e,g),e.addEventsToTimeline(g,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,S,!0),b.forEach(w=>e.relations.aggregateChildEvent(w)),e.oldState.paginationToken=(f=u.end)!==null&&f!==void 0?f:null,u.chunk.length===0&&(e.oldState.paginationToken=null),this.store.storeEvents(e,m,(p=u.end)!==null&&p!==void 0?p:null,!0),delete this.ongoingScrollbacks[e.roomId],l(e)}).catch(u=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},c(u)})});return i={promise:a},this.ongoingScrollbacks[e.roomId]=i,a}getEventMapper(e){return Jpe(this,e||{})}getEventTimeline(e,n){var r=this;return U(function*(){var i,s,o,a;if(!r.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!(e!=null&&e.room))throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);if(e.thread&&r.supportsThreads())return r.getThreadTimeline(e,n);var l=Ie("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:n}),c=void 0;(i=r.clientOpts)!==null&&i!==void 0&&i.lazyLoadMembers&&(c={filter:JSON.stringify(Es.LAZY_LOADING_MESSAGES_FILTER)});var u=yield r.http.authedRequest(le.Get,l,c);if(!u.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);var f=r.getEventMapper(),p=f(u.event);if(p.isRelation(cn.name)){r.logger.warn("Tried loading a regular timeline at the position of a thread event");return}var m=[...u.events_after.reverse().map(f),p,...u.events_before.map(f)],v=e.getTimelineForEvent(m[0].getId());v?v.getState(Le.BACKWARDS).setUnknownStateEvents(u.state.map(f)):(v=e.addTimeline(),v.initialiseState(u.state.map(f)),v.getState(Le.FORWARDS).paginationToken=u.end);var[g,S,b]=e.room.partitionThreadedEvents(m);return e.addEventsToTimeline(g,!0,!1,v,u.start),r.processThreadEvents(e.room,S,!0),r.processAggregatedTimelineEvents(e.room,g),b.forEach(w=>e.relations.aggregateChildEvent(w)),(s=(o=e.getTimelineForEvent(n))!==null&&o!==void 0?o:(a=e.room.findThreadForEvent(p))===null||a===void 0?void 0:a.liveTimeline)!==null&&s!==void 0?s:v})()}getThreadTimeline(e,n){var r=this;return U(function*(){var i;if(!r.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var s=Ie("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:n}),o={limit:"0"};(i=r.clientOpts)!==null&&i!==void 0&&i.lazyLoadMembers&&(o.filter=JSON.stringify(Es.LAZY_LOADING_MESSAGES_FILTER));var a=yield r.http.authedRequest(le.Get,s,o),l=r.getEventMapper(),c=l(a.event);if(e.canContain(c)){var u=r.canSupport.get(Kr.RelationsRecursion)!==qr.Unsupported;if(Rn.hasServerSideSupport)if(Rn.hasServerSideFwdPaginationSupport){var f,p,m;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var v=e.thread,g=yield r.fetchRelations(e.room.roomId,v.id,null,null,{dir:_t.Backward,from:a.start,recurse:u||void 0}),S=yield r.fetchRelations(e.room.roomId,v.id,null,null,{dir:_t.Forward,from:a.end,recurse:u||void 0}),b=[...S.chunk.reverse().filter(MI(v.id)).map(l),c,...g.chunk.filter(MI(v.id)).map(l)];for(var w of b){var k;yield(k=e.thread)===null||k===void 0?void 0:k.processEvent(w)}var T=e.getTimelineForEvent(c.getId());if(T?T.getState(Le.BACKWARDS).setUnknownStateEvents(a.state.map(l)):(T=e.addTimeline(),T.initialiseState(a.state.map(l))),e.addEventsToTimeline(b,!0,!1,T,S.next_batch),!g.next_batch){var I=yield r.fetchRoomEvent(e.room.roomId,v.id);e.addEventsToTimeline([l(I)],!0,!1,T,null)}return T.setPaginationToken((f=g.next_batch)!==null&&f!==void 0?f:null,_t.Backward),T.setPaginationToken((p=S.next_batch)!==null&&p!==void 0?p:null,_t.Forward),r.processAggregatedTimelineEvents(e.room,b),(m=e.getTimelineForEvent(n))!==null&&m!==void 0?m:T}else{for(var C,x=e.thread,A=yield r.fetchRelations(e.room.roomId,x.id,cn.name,null,{dir:_t.Backward,from:a.start,recurse:u||void 0}),N=[],D=a.end;D;){var F,$=yield r.fetchRelations(e.room.roomId,x.id,cn.name,null,{dir:_t.Forward,from:D,recurse:u||void 0});D=(F=$.next_batch)!==null&&F!==void 0?F:null,N.push(...$.chunk)}var B=[...N.reverse().map(l),c,...A.chunk.map(l)];for(var W of B){var H;yield(H=e.thread)===null||H===void 0?void 0:H.processEvent(W)}var z=e.getLiveTimeline();if(z.getState(Le.BACKWARDS).setUnknownStateEvents(a.state.map(l)),e.addEventsToTimeline(B,!0,!1,z,null),!A.next_batch){var K=yield r.fetchRoomEvent(e.room.roomId,x.id);e.addEventsToTimeline([l(K)],!0,!1,z,null)}return z.setPaginationToken((C=A.next_batch)!==null&&C!==void 0?C:null,_t.Backward),z.setPaginationToken(null,_t.Forward),r.processAggregatedTimelineEvents(e.room,B),z}}})()}getLatestTimeline(e){var n=this;return U(function*(){if(!n.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");var r;if(e.threadListType!==null){var i,s=yield n.createThreadListMessagesRequest(e.room.roomId,null,1,_t.Backward,e.threadListType,e.getFilter());r=(i=s.chunk)===null||i===void 0?void 0:i[0]}else if(e.thread&&Rn.hasServerSideSupport){var o,a=n.canSupport.get(Kr.RelationsRecursion)!==qr.Unsupported,l=yield n.fetchRelations(e.room.roomId,e.thread.id,cn.name,null,{dir:_t.Backward,limit:1,recurse:a||void 0});r=(o=l.chunk)===null||o===void 0?void 0:o[0]}else{var c,u,f=Ie("/rooms/$roomId/messages",{$roomId:e.room.roomId}),p={dir:"b"};(c=n.clientOpts)!==null&&c!==void 0&&c.lazyLoadMembers&&(p.filter=JSON.stringify(Es.LAZY_LOADING_MESSAGES_FILTER));var m=yield n.http.authedRequest(le.Get,f,p);r=(u=m.chunk)===null||u===void 0?void 0:u[0]}if(!r)throw new Error("No message returned when trying to construct getLatestTimeline");return n.getEventTimeline(e,r.event_id)})()}createMessagesRequest(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:30,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=Ie("/rooms/$roomId/messages",{$roomId:e}),l={limit:i.toString(),dir:s};n&&(l.from=n);var c=null;if((r=this.clientOpts)!==null&&r!==void 0&&r.lazyLoadMembers&&(c=Object.assign({},Es.LAZY_LOADING_MESSAGES_FILTER)),o){var u;c=c||{},Object.assign(c,(u=o.getRoomTimelineFilterComponent())===null||u===void 0?void 0:u.toJSON())}return c&&(l.filter=JSON.stringify(c)),this.http.authedRequest(le.Get,a,l)}createThreadListMessagesRequest(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:30,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:_t.Backward,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Ra.All,a=arguments.length>5?arguments[5]:void 0,l=Ie("/rooms/$roomId/threads",{$roomId:e}),c={limit:i.toString(),dir:s,include:mz(o)};n&&(c.from=n);var u={};if((r=this.clientOpts)!==null&&r!==void 0&&r.lazyLoadMembers&&(u=Br({},Es.LAZY_LOADING_MESSAGES_FILTER)),a){var f;u=Br(Br({},u),(f=a.getRoomTimelineFilterComponent())===null||f===void 0?void 0:f.toJSON())}Object.keys(u).length&&(c.filter=JSON.stringify(u));var p={prefix:Rn.hasServerSideListSupport===ji.Stable?Hr.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(le.Get,l,c,void 0,p).then(m=>{var v;return Br(Br({},m),{},{chunk:(v=m.chunk)===null||v===void 0?void 0:v.reverse(),start:m.prev_batch,end:m.next_batch})})}paginateEventTimeline(e,n){var r=this,i=e.getTimelineSet()===this.notifTimelineSet,s=this.getRoom(e.getRoomId()),o=e.getTimelineSet().threadListType,a=e.getTimelineSet().thread;n=n||{};var l=n.backwards||!1;if(i&&!l)throw new Error("paginateNotifTimeline can only paginate backwards");var c=l?Le.BACKWARDS:Le.FORWARDS,u=e.getPaginationToken(c),f=e.paginationRequests[c];if(f)return f;var p,m,v;if(i){var g;p="/notifications",m={limit:((g=n.limit)!==null&&g!==void 0?g:30).toString(),only:"highlight"},u&&u!=="end"&&(m.from=u),v=this.http.authedRequest(le.Get,p,m).then(function(){var T=U(function*(I){var C=I.next_token,x=[];I.notifications=I.notifications.filter(La);for(var A=0;A<I.notifications.length;A++){var N=I.notifications[A],D=r.getEventMapper()(N.event);r.getPushDetailsForEvent(D,!0),D.event.room_id=N.room_id,x[A]=D}var F=e.getTimelineSet();return F.addEventsToTimeline(x,l,!1,e,C),r.processAggregatedTimelineEvents(F.room,x),l&&!I.next_token&&e.setPaginationToken(null,c),!!I.next_token});return function(I){return T.apply(this,arguments)}}()).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=v}else if(o!==null){if(!s)throw new Error("Unknown room "+e.getRoomId());if(!Rn.hasServerSideFwdPaginationSupport&&c===_t.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");v=this.createThreadListMessagesRequest(e.getRoomId(),u,n.limit,c,o,e.getFilter()).then(T=>{if(T.state){var I=e.getState(c),C=T.state.filter(La).map(this.getEventMapper());I.setUnknownStateEvents(C)}var x=T.end,A=T.chunk.filter(La).map(this.getEventMapper()),N=e.getTimelineSet();return N.addEventsToTimeline(A,l,!1,e,x),this.processAggregatedTimelineEvents(s,A),this.processThreadRoots(s,A,l),l&&T.end==T.start&&e.setPaginationToken(null,c),T.end!==T.start}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=v}else if(a){var S,b,w=this.getRoom((S=e.getRoomId())!==null&&S!==void 0?S:void 0);if(!w)throw new Error("Unknown room "+e.getRoomId());var k=this.canSupport.get(Kr.RelationsRecursion)!==qr.Unsupported;v=this.fetchRelations((b=e.getRoomId())!==null&&b!==void 0?b:"",a.id,null,null,{dir:c,limit:n.limit,from:u??void 0,recurse:k||void 0}).then(function(){var T=U(function*(I){var C=r.getEventMapper(),x=I.chunk.filter(La).filter(MI(a.id)).map(C);for(var A of x.slice().reverse()){yield a==null?void 0:a.processEvent(A);var N=A.getSender();(!l||(a==null?void 0:a.getEventReadUpTo(N))===null)&&w.addLocalEchoReceipt(N,A,Ji.Read)}var D=I.next_batch,F=e.getTimelineSet();if(F.addEventsToTimeline(x,l,!1,e,D??null),!D&&l){var $,B,W=($=a.rootEvent)!==null&&$!==void 0?$:C(yield r.fetchRoomEvent((B=e.getRoomId())!==null&&B!==void 0?B:"",a.id));F.addEventsToTimeline([W],!0,!1,e,null)}return r.processAggregatedTimelineEvents(F.room,x),l&&!D&&e.setPaginationToken(null,c),!!D});return function(I){return T.apply(this,arguments)}}()).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=v}else{if(!s)throw new Error("Unknown room "+e.getRoomId());v=this.createMessagesRequest(e.getRoomId(),u,n.limit,c,e.getFilter()).then(T=>{if(T.state){var I=e.getState(c),C=T.state.filter(La).map(this.getEventMapper());I.setUnknownStateEvents(C)}var x=T.end,A=T.chunk.filter(La).map(this.getEventMapper()),N=e.getTimelineSet(),[D,,F]=s.partitionThreadedEvents(A);N.addEventsToTimeline(D,l,!1,e,x),this.processAggregatedTimelineEvents(s,D),this.processThreadRoots(s,D.filter(B=>B.getServerAggregatedRelation(cn.name)),!1),F.forEach(B=>s.relations.aggregateChildEvent(B));var $=T.end===void 0||T.end===T.start;return l&&$&&e.setPaginationToken(null,c),!$}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=v}return v}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;return(n=this.peekSync)===null||n===void 0||n.stopPeeking(),this.peekSync=new hd(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,r)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,n){var r=this.sendStateEvent(e,ee.RoomGuestAccess,{guest_access:n.allowJoin?VE.CanJoin:VE.Forbidden},""),i=Promise.resolve();return n.allowRead&&(i=this.sendStateEvent(e,ee.RoomHistoryVisibility,{history_visibility:QL.WorldReadable},"")),Promise.all([i,r]).then()}requestRegisterEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestRegisterMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestAdd3pidEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestPasswordEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestPasswordMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestTokenFromEndpoint(e,n){var r=this;return U(function*(){var i=Object.assign({},n);return r.http.request(le.Post,e,void 0,i)})()}getRoomPushRule(e,n){if(this.pushRules){var r;return(r=this.pushRules[e])===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.find(i=>i.rule_id===n)}else throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,n,r){var i,s=!1,o=this.getRoomPushRule(e,n);if(o!=null&&o.actions.includes(Cd.DontNotify)&&(s=!0),!r)s&&(i=this.deletePushRule(e,ui.RoomSpecific,o.rule_id));else if(!o)i=this.addPushRule(e,ui.RoomSpecific,n,{actions:[Cd.DontNotify]});else if(!s){var a=Promise.withResolvers();this.deletePushRule(e,ui.RoomSpecific,o.rule_id).then(()=>{this.addPushRule(e,ui.RoomSpecific,n,{actions:[Cd.DontNotify]}).then(()=>{a.resolve()}).catch(l=>{a.reject(l)})}).catch(l=>{a.reject(l)}),i=a.promise}if(i)return new Promise((l,c)=>{i.then(()=>{this.getPushRules().then(u=>{this.pushRules=u,l()}).catch(u=>{c(u)})}).catch(u=>{this.getPushRules().then(f=>{this.pushRules=f,c(u)}).catch(f=>{c(u)})})})}searchMessageText(e){var n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}})}searchRoomEvents(e){var n={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:VW.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:n,results:[],highlights:[]};return this.search({body:n}).then(i=>this.processRoomEventsSearch(r,i))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var n={body:e._query,next_batch:e.next_batch},r=this.search(n,e.abortSignal).then(i=>this.processRoomEventsSearch(e,i)).finally(()=>{e.pendingRequest=void 0});return e.pendingRequest=r,r}processRoomEventsSearch(e,n){var r,i,s=n.search_categories.room_events;e.count=s.count,e.next_batch=s.next_batch;var o=new Set(s.highlights);e.highlights.forEach(m=>{o.add(m)}),e.highlights=Array.from(o);for(var a=this.getEventMapper(),l=(r=(i=s.results)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0,c=0;c<l;c++){var u=PC.fromJson(s.results[c],a),f=this.getRoom(u.context.getEvent().getRoomId());if(f)for(var p of u.context.getTimeline())p.setMetadata(f.currentState,!1);e.results.push(u)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var e=new hd(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(e){var n=Ie("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(le.Post,n,void 0,e).then(r=>{var i=Es.fromJson(this.credentials.userId,r.filter_id,e);return this.store.storeFilter(i),i})}getFilter(e,n,r){if(r){var i=this.store.getFilter(e,n);if(i)return Promise.resolve(i)}var s=Ie("/user/$userId/filter/$filterId",{$userId:e,$filterId:n});return this.http.authedRequest(le.Get,s).then(o=>{var a=Es.fromJson(e,n,o);return this.store.storeFilter(a),a})}getOrCreateFilter(e,n){var r=this;return U(function*(){var i=r.store.getFilterIdByName(e),s;if(i){try{var o=yield r.getFilter(r.credentials.userId,i,!0);if(o){var a=o.getDefinition(),l=n.getDefinition();Eh(a,l)&&(s=i)}}catch(u){if(u.errcode!=="M_UNKNOWN"&&u.errcode!=="M_NOT_FOUND")throw u}s||r.store.setFilterIdByName(e,void 0)}if(s)return s;var c=yield r.createFilter(n.getDefinition());return r.store.setFilterIdByName(e,c.filterId),c.filterId})()}getOpenIdToken(){var e=Ie("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(le.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(le.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return this.checkTurnServersIntervalID!==void 0}checkTurnServers(){var e=this;return U(function*(){if(e.canSupportVoip){var n=!1,r=e.turnServersExpiry-Date.now();if(r>HF)e.logger.debug("TURN creds are valid for another "+r+" ms: not fetching new ones."),n=!0;else{e.logger.debug("Fetching new TURN credentials");try{var i=yield e.turnServer();if(i.uris){e.logger.debug("Got TURN URIs: "+i.uris+" refresh in "+i.ttl+" secs");var s={urls:i.uris,username:i.username,credential:i.password};e.turnServers=[s],e.turnServersExpiry=Date.now()+i.ttl*1e3,n=!0,e.emit(Ae.TurnServers,e.turnServers)}}catch(o){e.logger.error("Failed to get TURN URIs",o),o.httpStatus===403?(e.logger.info("TURN access unavailable for this account: stopping credentials checks"),e.checkTurnServersIntervalID!==null&&globalThis.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(Ae.TurnServersError,o,!0)):e.emit(Ae.TurnServersError,o,!1)}}return n}})()}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){var e=Ie("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(le.Get,e,void 0,void 0,{prefix:""}).then(n=>n.admin)}whoisSynapseUser(e){var n=Ie("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(le.Get,n,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){var n=Ie("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(le.Post,n,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var e=this;return U(function*(){var n;e.clientWellKnownPromise=dt.getRawClientConfig((n=e.getDomain())!==null&&n!==void 0?n:void 0),e.clientWellKnown=yield e.clientWellKnownPromise,e.emit(Ae.ClientWellKnown,e.clientWellKnown)})()}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){var e=["boolean","string","number"],n=Object.entries(this.clientOpts).filter(r=>{var[i,s]=r;return e.includes(typeof s)}).reduce((r,i)=>{var[s,o]=i;return r[s]=o,r},{});return this.store.storeClientOptions(n)}_unstable_getSharedRooms(e){var n=this;return U(function*(){var r=yield n.doesServerSupportUnstableFeature(uz),i=yield n.doesServerSupportUnstableFeature(dz),s=yield n.doesServerSupportUnstableFeature(fz);if(!r&&!i&&!s)throw Error("Server does not support the Mutual Rooms API");var o,a;s?(o="/uk.half-shot.msc2666/user/mutual_rooms",a={user_id:e}):(o=Ie("/uk.half-shot.msc2666/user/".concat(i?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),a={});var l=[],c=null;do{var u={};c!=null&&s&&(u.batch_token=c);var f=yield n.http.authedRequest(le.Get,o,Br(Br({},a),u),void 0,{prefix:Hr.Unstable});l.push(...f.joined),f.next_batch_token!==void 0?c=f.next_batch_token:c=null}while(c!=null);return l})()}getVersions(){var e=this;return U(function*(){if(e.serverVersionsPromise)return e.serverVersionsPromise;e.serverVersionsPromise=e.http.authedRequest(le.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(r=>{throw e.serverVersionsPromise=void 0,r});var n=yield e.serverVersionsPromise;return e.canSupport=yield Qhe(n),e.serverVersionsPromise})()}isVersionSupported(e){var n=this;return U(function*(){var{versions:r}=yield n.getVersions();return r&&r.includes(e)})()}doesServerSupportUnstableFeature(e){var n=this;return U(function*(){var r=yield n.getVersions();if(!r)return!1;var i=r.unstable_features;return i&&!!i[e]})()}doesServerForceEncryptionForPreset(e){var n=this;return U(function*(){var r=yield n.getVersions();if(!r)return!1;var i=r.unstable_features,s=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return i&&!!i["io.element.e2ee_forced.".concat(s)]})()}doesServerSupportThread(){var e=this;return U(function*(){if(yield e.isVersionSupported("v1.4"))return{threads:ji.Stable,list:ji.Stable,fwdPagination:ji.Stable};try{var[n,r,i,s,o,a]=yield Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:I2(r,n),list:I2(s,i),fwdPagination:I2(a,o)}}catch{return{threads:ji.None,list:ji.None,fwdPagination:ji.None}}})()}hasLazyLoadMembersEnabled(){var e;return!!((e=this.clientOpts)!==null&&e!==void 0&&e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(e,n,r,i){var s=arguments,o=this;return U(function*(){var a,l,c=s.length>4&&s[4]!==void 0?s[4]:{dir:_t.Backward},u=i?o.getEncryptedIfNeededEventType(e,i):null,[f,p]=yield Promise.all([o.fetchRoomEvent(e,n),o.fetchRelations(e,n,r,u,c)]),m=o.getEventMapper(),v=f?m(f):void 0,g=p.chunk.map(m);if(u===ee.RoomMessageEncrypted){var S=v?g.concat(v):g;yield Promise.all(S.map(b=>o.decryptEventIfNeeded(b))),i!==null&&(g=g.filter(b=>b.getType()===i))}return v&&r===Tn.Replace&&(g=g.filter(b=>b.getSender()===v.getSender())),{originalEvent:v??null,events:g,nextBatch:(a=p.next_batch)!==null&&a!==void 0?a:null,prevBatch:(l=p.prev_batch)!==null&&l!==void 0?l:null}})()}generateClientSecret(){return lo(32)}decryptEventIfNeeded(e,n){return e.shouldAttemptDecryption()&&this.getCrypto()&&e.attemptDecryption(this.cryptoBackend,n),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,n){switch(e){case ax.IS:return this.http.getUrl("/terms",void 0,mc.V2,n);case ax.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",n);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return r&&((e=this.idBaseUrl)!==null&&e!==void 0&&e.startsWith("http://")||(n=this.idBaseUrl)!==null&&n!==void 0&&n.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=bI(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){var e;return(e=this.http.opts.refreshToken)!==null&&e!==void 0?e:null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return this.http.opts.accessToken!==void 0}makeTxnId(){return"m"+new Date().getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(le.Get,"/register/available",{username:e}).then(n=>n.available).catch(n=>n.errcode==="M_USER_IN_USE"?!1:Promise.reject(n))}register(e,n,r,i,s,o,a){r&&(i.session=r);var l={auth:i,refresh_token:!0};return e!=null&&(l.username=e),n!=null&&(l.password=n),o!=null&&(l.guest_access_token=o),a!=null&&(l.inhibit_login=a),this.registerRequest(l)}registerGuest(){var{body:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.registerRequest(e||{},"guest")}registerRequest(e,n){var r={};return n&&(r.kind=n),this.http.request(le.Post,"/register",r,e)}refreshToken(e){var n=r=>this.http.authedRequest(le.Post,"/refresh",void 0,{refresh_token:e},{prefix:r,inhibitLogoutEmit:!0});return n(Hr.V3).catch(r=>{if(r.errcode==="M_UNRECOGNIZED")return n(Hr.V1);throw r})}loginFlows(){return this.http.request(le.Get,"/login")}login(e,n){return this.loginRequest(Br(Br({},n),{},{type:e})).then(r=>(r.access_token&&r.user_id&&(this.http.opts.accessToken=r.access_token,this.credentials={userId:r.user_id}),r))}loginWithPassword(e,n){return this.login("m.login.password",{user:e,password:n})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"sso",r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s="/login/"+n+"/redirect";r&&(s+="/"+r);var o={redirectUrl:e,[oge.unstable]:i};return this.http.getUrl(s,o).href}loginWithToken(e){return this.login("m.login.token",{token:e})}loginRequest(e){var n=this;return U(function*(){return yield n.http.authedRequest(le.Post,"/login",void 0,e)})()}logout(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:!1;return r&&(n.stopClient(),n.http.abort()),n.http.authedRequest(le.Post,"/logout")})()}deactivateAccount(e,n){var r={};return e&&(r.auth=e),n!==void 0&&(r.erase=n),this.http.authedRequest(le.Post,"/account/deactivate",void 0,r)}requestLoginToken(e){var n=this;return U(function*(){var r={auth:e};return n.http.authedRequest(le.Post,"/login/get_token",void 0,r,{prefix:Hr.V1})})()}getFallbackAuthUrl(e,n){var r=Ie("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:n}).href}createRoom(e){var n=this;return U(function*(){var r,i=(e.invite_3pid||[]).filter(a=>!a.id_access_token);if(i.length>0&&(r=n.identityServer)!==null&&r!==void 0&&r.getAccessToken){var s=yield n.identityServer.getAccessToken();if(s)for(var o of i)o.id_access_token=s}return n.http.authedRequest(le.Post,"/createRoom",void 0,e)})()}fetchRelations(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{dir:_t.Backward},o=s;Rn.hasServerSideFwdPaginationSupport===ji.Experimental&&(o=hD("dir","org.matrix.msc3715.dir",o)),this.canSupport.get(Kr.RelationsRecursion)===qr.Unstable&&(o=hD("recurse","org.matrix.msc3981.recurse",o));var a=D6(o),l="/rooms/$roomId/relations/$eventId";r!==null?(l+="/$relationType",i!==null&&(l+="/$eventType")):i!==null&&(this.logger.warn("eventType: ".concat(i,` ignored when fetching
            relations as relationType is null`)),i=null);var c=Ie(l+"?"+a,{$roomId:e,$eventId:n,$relationType:r,$eventType:i});return this.http.authedRequest(le.Get,c,void 0,void 0,{prefix:Hr.V1})}roomState(e){var n=Ie("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(le.Get,n)}fetchRoomEvent(e,n){var r=Ie("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(le.Get,r)}members(e,n,r,i){var s={};n&&(s.membership=n),r&&(s.not_membership=r),i&&(s.at=i);var o=D6(s),a=Ie("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(le.Get,a)}upgradeRoom(e,n){var r=Ie("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(le.Post,r,void 0,{new_version:n})}getStateEvent(e,n,r){var i={$roomId:e,$eventType:n,$stateKey:r},s=Ie("/rooms/$roomId/state/$eventType",i);return r!==void 0&&(s=Ie(s+"/$stateKey",i)),this.http.authedRequest(le.Get,s)}sendStateEvent(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},o={$roomId:e,$eventType:n,$stateKey:i},a=Ie("/rooms/$roomId/state/$eventType",o);return i!==void 0&&(a=Ie(a+"/$stateKey",o)),this.http.authedRequest(le.Put,a,void 0,r,s)}roomInitialSync(e,n){var r,i=Ie("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(le.Get,i,{limit:(r=n==null?void 0:n.toString())!==null&&r!==void 0?r:"30"})}setRoomReadMarkersHttpRequest(e,n,r,i){var s=this;return U(function*(){var o=Ie("/rooms/$roomId/read_markers",{$roomId:e}),a={[Ji.FullyRead]:n,[Ji.Read]:r};return((yield s.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield s.isVersionSupported("v1.4")))&&(a[Ji.ReadPrivate]=i),s.http.authedRequest(le.Post,o,void 0,a)})()}getJoinedRooms(){var e=Ie("/joined_rooms",{});return this.http.authedRequest(le.Get,e)}getJoinedRoomMembers(e){var n=Ie("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(le.Get,n)}publicRooms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{server:n,limit:r,since:i}=e,s=lhe(e,nge);if(Object.keys(s).length===0){var o={server:n,limit:r,since:i};return this.http.authedRequest(le.Get,"/publicRooms",o)}else{var a={server:n},l=Br({limit:r,since:i},s);return this.http.authedRequest(le.Post,"/publicRooms",a,l)}}createAlias(e,n){var r=Ie("/directory/room/$alias",{$alias:e}),i={room_id:n};return this.http.authedRequest(le.Put,r,void 0,i)}deleteAlias(e){var n=Ie("/directory/room/$alias",{$alias:e});return this.http.authedRequest(le.Delete,n)}getLocalAliases(e){var n=Ie("/rooms/$roomId/aliases",{$roomId:e}),r=Hr.V3;return this.http.authedRequest(le.Get,n,void 0,void 0,{prefix:r})}getRoomIdForAlias(e){var n=Ie("/directory/room/$alias",{$alias:e});return this.http.authedRequest(le.Get,n)}getRoomDirectoryVisibility(e){var n=Ie("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(le.Get,n)}setRoomDirectoryVisibility(e,n){var r=Ie("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(le.Put,r,void 0,{visibility:n})}searchUserDirectory(e){var{term:n,limit:r}=e,i={search_term:n};return r!==void 0&&(i.limit=r),this.http.authedRequest(le.Post,"/user_directory/search",void 0,i)}uploadContent(e,n){return this.http.uploadContent(e,n)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,n){var r=n?Ie("/profile/$userId/$info",{$userId:e,$info:n}):Ie("/profile/$userId",{$userId:e});return this.http.authedRequest(le.Get,r)}doesServerSupportExtendedProfiles(){var e=this;return U(function*(){return e.doesServerSupportUnstableFeature(hz)})()}getExtendedProfileRequestPrefix(){var e=this;return U(function*(){return(yield e.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable"))?Hr.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"})()}getExtendedProfile(e){var n=this;return U(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return n.http.authedRequest(le.Get,Ie("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}getExtendedProfileProperty(e,n){var r=this;return U(function*(){if(!(yield r.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var i=yield r.http.authedRequest(le.Get,Ie("/profile/$userId/$key",{$userId:e,$key:n}),void 0,void 0,{prefix:yield r.getExtendedProfileRequestPrefix()});return i[n]})()}setExtendedProfileProperty(e,n){var r=this;return U(function*(){if(!(yield r.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var i=r.getUserId();yield r.http.authedRequest(le.Put,Ie("/profile/$userId/$key",{$userId:i,$key:e}),void 0,{[e]:n},{prefix:yield r.getExtendedProfileRequestPrefix()})})()}deleteExtendedProfileProperty(e){var n=this;return U(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(le.Delete,Ie("/profile/$userId/$key",{$userId:r,$key:e}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}patchExtendedProfile(e){var n=this;return U(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();return n.http.authedRequest(le.Patch,Ie("/profile/$userId",{$userId:r}),{},e,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}setExtendedProfile(e){var n=this;return U(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(le.Put,Ie("/profile/$userId",{$userId:r}),{},e,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}getThreePids(){return this.http.authedRequest(le.Get,"/account/3pid")}addThreePidOnly(e){var n=this;return U(function*(){var r="/account/3pid/add";return n.http.authedRequest(le.Post,r,void 0,e)})()}bindThreePid(e){var n=this;return U(function*(){var r="/account/3pid/bind";return n.http.authedRequest(le.Post,r,void 0,e)})()}unbindThreePid(e,n){var r=this;return U(function*(){var i="/account/3pid/unbind",s={medium:e,address:n,id_server:r.getIdentityServerUrl(!0)};return r.http.authedRequest(le.Post,i,void 0,s)})()}deleteThreePid(e,n){var r="/account/3pid/delete";return this.http.authedRequest(le.Post,r,void 0,{medium:e,address:n})}setPassword(e,n,r){var i="/account/password",s={auth:e,new_password:n,logout_devices:r};return this.http.authedRequest(le.Post,i,void 0,s)}getDevices(){return this.http.authedRequest(le.Get,"/devices")}getDevice(e){var n=Ie("/devices/$device_id",{$device_id:e});return this.http.authedRequest(le.Get,n)}setDeviceDetails(e,n){var r=Ie("/devices/$device_id",{$device_id:e});return this.http.authedRequest(le.Put,r,void 0,n)}deleteDevice(e,n){var r=Ie("/devices/$device_id",{$device_id:e}),i={};return n&&(i.auth=n),this.http.authedRequest(le.Delete,r,void 0,i)}deleteMultipleDevices(e,n){var r={devices:e};n&&(r.auth=n);var i="/delete_devices";return this.http.authedRequest(le.Post,i,void 0,r)}getPushers(){var e=this;return U(function*(){var n=yield e.http.authedRequest(le.Get,"/pushers");return(yield e.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(n.pushers=n.pushers.map(r=>(r.hasOwnProperty(K6.name)||(r[K6.name]=!0),r))),n})()}setPusher(e){var n="/pushers/set";return this.http.authedRequest(le.Post,n,void 0,e)}removePusher(e,n){var r="/pushers/set",i={pushkey:e,app_id:n,kind:null};return this.http.authedRequest(le.Post,r,void 0,i)}setLocalNotificationSettings(e,n){var r="".concat(YK.name,".").concat(e);return this.setAccountData(r,n)}getPushRules(){return this.http.authedRequest(le.Get,"/pushrules/").then(e=>(this.setPushRules(e),this.pushRules))}setPushRules(e){this.pushRules=ka.rewriteDefaultRules(e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,n,r,i){var s=Ie("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(le.Put,s,void 0,i)}deletePushRule(e,n,r){var i=Ie("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(le.Delete,i)}setPushRuleEnabled(e,n,r,i){var s=Ie("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:n,$ruleId:r});return this.http.authedRequest(le.Put,s,void 0,{enabled:i})}setPushRuleActions(e,n,r,i){var s=Ie("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:n,$ruleId:r});return this.http.authedRequest(le.Put,s,void 0,{actions:i})}search(e,n){var{body:r,next_batch:i}=e,s={};return i&&(s.next_batch=i),this.http.authedRequest(le.Post,"/search",s,r,{abortSignal:n})}uploadKeysRequest(e,n){return this.http.authedRequest(le.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(le.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e){var{token:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={device_keys:{}};return n!==void 0&&(r.token=n),e.forEach(i=>{r.device_keys[i]=[]}),this.http.authedRequest(le.Post,"/keys/query",void 0,r)}claimOneTimeKeys(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"signed_curve25519",r=arguments.length>2?arguments[2]:void 0,i={};n===void 0&&(n="signed_curve25519");for(var[s,o]of e){var a=i[s]||{};DE(i,s,a),DE(a,o,n)}var l={one_time_keys:i};r&&(l.timeout=r);var c="/keys/claim";return this.http.authedRequest(le.Post,c,void 0,l)}getKeyChanges(e,n){var r={from:e,to:n};return this.http.authedRequest(le.Get,"/keys/changes",r)}uploadDeviceSigningKeys(e,n){var r=Object.assign({},n);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(le.Post,"/keys/device_signing/upload",void 0,r,{prefix:Hr.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var n=this.http.getUrl("/account/register",void 0,mc.V2,this.idBaseUrl);return this.http.requestOtherUrl(le.Post,n,e)}requestEmailToken(e,n,r,i,s){var o={client_secret:n,email:e,send_attempt:r==null?void 0:r.toString()};return i&&(o.next_link=i),this.http.idServerRequest(le.Post,"/validate/email/requestToken",o,mc.V2,s)}requestMsisdnToken(e,n,r,i,s,o){var a={client_secret:r,country:e,phone_number:n,send_attempt:i==null?void 0:i.toString()};return s&&(a.next_link=s),this.http.idServerRequest(le.Post,"/validate/msisdn/requestToken",a,mc.V2,o)}submitMsisdnToken(e,n,r,i){var s={sid:e,client_secret:n,token:r};return this.http.idServerRequest(le.Post,"/validate/msisdn/submitToken",s,mc.V2,i??void 0)}submitMsisdnTokenOtherUrl(e,n,r,i){var s={sid:n,client_secret:r,token:i};return this.http.requestOtherUrl(le.Post,e,s)}getIdentityHashDetails(e){return this.http.idServerRequest(le.Get,"/hash_details",void 0,mc.V2,e)}identityHashedLookup(e,n){var r=this;return U(function*(){var i={},s=yield r.getIdentityHashDetails(n);if(!s||!s.lookup_pepper||!s.algorithms)throw new Error("Unsupported identity server: bad response");i.pepper=s.lookup_pepper;var o={};if(s.algorithms.includes("sha256"))i.addresses=yield Promise.all(e.map(function(){var p=U(function*(m){var v=m[0].toLowerCase(),g=m[1].toLowerCase(),S=yield ZW("".concat(v," ").concat(g," ").concat(i.pepper)),b=kC(S);return o[b]=m[0],b});return function(m){return p.apply(this,arguments)}}())),i.algorithm="sha256";else if(s.algorithms.includes("none"))i.addresses=e.map(p=>{var m=p[0].toLowerCase(),v=p[1].toLowerCase(),g="".concat(m," ").concat(v);return o[g]=p[0],g}),i.algorithm="none";else throw new Error("Unsupported identity server: unknown hash algorithm");var a=yield r.http.idServerRequest(le.Post,"/lookup",i,mc.V2,n);if(!(a!=null&&a.mappings))return[];var l=[];for(var c of Object.keys(a.mappings)){var u=a.mappings[c],f=o[c];if(!f)throw new Error("Identity server returned more results than expected");l.push({address:f,mxid:u})}return l})()}lookupThreePid(e,n,r){var i=this;return U(function*(){var s=yield i.identityHashedLookup([[n,e]],r),o=s.find(l=>l.address===n);if(!o)return{};var a={address:n,medium:e,mxid:o.mxid};return a})()}bulkLookupThreePids(e,n){var r=this;return U(function*(){var i=yield r.identityHashedLookup(e.map(l=>[l[1],l[0]]),n),s=[],o=function*(c){var u=e.find(f=>f[1]===c.address);if(!u)throw new Error("Identity sever returned unexpected results");s.push([u[0],c.address,c.mxid])};for(var a of i)yield*o(a);return{threepids:s}})()}getIdentityAccount(e){return this.http.idServerRequest(le.Get,"/account",void 0,mc.V2,e)}sendToDevice(e,n,r){var i=Ie("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),s={messages:eh(n)},o=new Map;for(var[a,l]of n)o.set(a,Array.from(l.keys()));return this.logger.debug("PUT ".concat(i),o),this.http.authedRequest(le.Put,i,void 0,s)}encryptAndSendToDevice(e,n,r){var i=this;return U(function*(){if(!i.cryptoBackend)throw new Error("Cannot encrypt to device event, your client does not support encryption.");var s=yield i.cryptoBackend.encryptToDeviceMessages(e,n,r);yield i.queueToDevice(s)})()}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(le.Get,"/thirdparty/protocols").then(e=>{if(!e||typeof e!="object")throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e})}getThirdpartyLocation(e,n){var r=Ie("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(le.Get,r,n)}getThirdpartyUser(e,n){var r=Ie("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(le.Get,r,n)}getTerms(e,n){var r=this.termsUrlForService(e,n);return this.http.requestOtherUrl(le.Get,r)}agreeToTerms(e,n,r,i){var s=this.termsUrlForService(e,n),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(le.Post,s,{user_accepts:i},{headers:o})}reportEvent(e,n,r,i){var s=Ie("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(le.Post,s,void 0,{score:r,reason:i})}reportRoom(e,n){var r=Ie("/rooms/$roomId/report",{$roomId:e});return this.http.authedRequest(le.Post,r,void 0,{reason:n})}getRoomHierarchy(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0,o=Ie("/rooms/$roomId/hierarchy",{$roomId:e}),a={suggested_only:String(i),max_depth:r==null?void 0:r.toString(),from:s,limit:n==null?void 0:n.toString()};return this.http.authedRequest(le.Get,o,a,void 0,{prefix:Hr.V1}).catch(l=>{if(l.errcode==="M_UNRECOGNIZED")return this.http.authedRequest(le.Get,o,a,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw l})}unstableCreateFileTree(e){var n=this;return U(function*(){var{room_id:r}=yield n.createRoom({name:e,preset:LC.PrivateChat,power_level_content_override:Br(Br({},Zpe),{},{users:{[n.getUserId()]:100}}),creation_content:{[FE]:Cm.Space},initial_state:[{type:H6.name,state_key:G6.name,content:{[V6.name]:!0}},{type:ee.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new IF(n,r)})()}unstableGetFileTreeSpace(e){var n,r,i=this.getRoom(e);if((i==null?void 0:i.getMyMembership())!==qe.Join)return null;var s=i.currentState.getStateEvents(ee.RoomCreate,""),o=i.currentState.getStateEvents(H6.name,G6.name);if(!s)throw new Error("Expected single room create event");return!(o!=null&&(n=o.getContent())!==null&&n!==void 0&&n[V6.name])||((r=s.getContent())===null||r===void 0?void 0:r[FE])!==Cm.Space?null:new IF(this,e)}slidingSync(e,n,r){var i={};e.pos&&(i.pos=e.pos,delete e.pos),e.timeout&&(i.timeout=e.timeout,delete e.timeout);var s=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(le.Post,"/sync",i,e,{prefix:"/_matrix/client/unstable/org.matrix.simplified_msc3575",baseUrl:n,localTimeoutMs:s,abortSignal:r})}supportsThreads(){var e;return((e=this.clientOpts)===null||e===void 0?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(Kr.IntentionalMentions)!==qr.Unsupported}getRoomSummary(e,n){var r=this;return U(function*(){var i={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{var s=Ie("/summary/$roomid",{$roomid:e});return yield r.http.authedRequest(le.Get,s,{via:n},void 0,i)}catch(a){if(a instanceof Nn&&a.errcode==="M_UNRECOGNIZED"){var o=Ie("/rooms/$roomid/summary",{$roomid:e});return yield r.http.authedRequest(le.Get,o,{via:n},void 0,i)}else throw a}})()}processThreadEvents(e,n,r){e.processThreadedEvents(n,r)}processThreadRoots(e,n,r){this.supportsThreads()&&e.processThreadRoots(n,r)}processBeaconEvents(e,n){this.processAggregatedTimelineEvents(e,n)}processAggregatedTimelineEvents(e,n){n!=null&&n.length&&e&&(e.currentState.processBeaconEvents(n,this),e.processPollEvents(n))}whoami(){var e=this;return U(function*(){return e.http.authedRequest(le.Get,"/account/whoami")})()}timestampToEvent(e,n,r){var i=this;return U(function*(){var s=Ie("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:n.toString(),dir:r};try{return yield i.http.authedRequest(le.Get,s,o,void 0,{prefix:Hr.V1})}catch(a){if(a.errcode==="M_UNRECOGNIZED"&&(a.httpStatus===400||a.httpStatus===404||a.httpStatus===405))return yield i.http.authedRequest(le.Get,s,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw a}})()}getAuthIssuer(){var e=this;return U(function*(){return e.http.request(le.Get,"/auth_issuer",void 0,void 0,{prefix:Hr.Unstable+"/org.matrix.msc2965"})})()}getAuthMetadata(){var e=this;return U(function*(){var n;try{n=yield e.http.request(le.Get,"/auth_metadata",void 0,void 0,{prefix:Hr.Unstable+"/org.matrix.msc2965"})}catch(i){if(i instanceof Nn&&i.errcode==="M_UNRECOGNIZED"){var{issuer:r}=yield e.getAuthIssuer();return cA(r)}throw i}return uA(n)})()}}L(NC,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY");function VF(t){return Object.fromEntries(Object.entries(t).map(e=>{var[n,r]=e;return["".concat(Il,".").concat(n),r]}))}function pz(t,e){var n,r=t.getUserId(),i=e.getId(),s=t.getRoom(e.getRoomId());if(!(!s||!r||!i)){if(!s.findEventById(i)){O.info("Decrypted event ".concat(e.getId()," is not in room ").concat(s.roomId,": ignoring"));return}var o=!!e.threadRootId&&!e.isThreadRoot,a;if(o){var l=s.getThread(e.threadRootId);a=l?l.hasUserReadEvent(r,i):!0}else a=s.hasUserReadEvent(r,i);if(!a){var c=t.getPushActionsForEvent(e,!0),u=!!(c!=null&&(n=c.tweaks)!==null&&n!==void 0&&n.highlight);if(u){var f=s.getUnreadCountForEventContext(Kt.Highlight,e)+1;o?s.setThreadUnreadNotificationCount(e.threadRootId,Kt.Highlight,f):s.setUnreadNotificationCount(Kt.Highlight,f)}var p=!!(c!=null&&c.notify);if(p){var m=s.getUnreadCountForEventContext(Kt.Total,e)+1;o?s.setThreadUnreadNotificationCount(e.threadRootId,Kt.Total,m):s.setUnreadNotificationCount(Kt.Total,m)}}}}function ug(t){return ny(t)?Jy:t.threadRootId}function ny(t){if(!t.threadRootId||t.isThreadRoot)return!0;if(!t.isRelation())return O.warn("Event is not a relation or a thread root, but still has a threadRootId! id=".concat(t.getId())),!0;if(t.isRelation(cn.name))return!1;var e=t.relationEventId===t.threadRootId;return e}function GF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function qF(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Zi=function(t){return t.New="Thread.new",t.Update="Thread.update",t.NewReply="Thread.newReply",t.ViewThread="Thread.viewThread",t.Delete="Thread.delete",t}({}),ji=function(t){return t[t.None=0]="None",t[t.Experimental=1]="Experimental",t[t.Stable=2]="Stable",t}({});function I2(t,e){return t?ji.Stable:e?ji.Experimental:ji.None}class Rn extends SW{constructor(e,n,r){var i,s;if(super(),i=this,this.id=e,this.rootEvent=n,L(this,"timelineSet",void 0),L(this,"_currentUserParticipated",!1),L(this,"reEmitter",void 0),L(this,"lastEvent",void 0),L(this,"replyCount",0),L(this,"lastPendingEvent",void 0),L(this,"pendingReplyCount",0),L(this,"room",void 0),L(this,"client",void 0),L(this,"pendingEventOrdering",void 0),L(this,"processRootEventPromise",void 0),L(this,"initialEventsFetched",!Rn.hasServerSideSupport),L(this,"initalEventFetchProm",void 0),L(this,"replayEvents",[]),L(this,"onTimelineReset",U(function*(){yield i.processRootEventPromise,i.processRootEventPromise=void 0})),L(this,"onBeforeRedaction",(o,a)=>{o!=null&&o.isRelation(cn.name)&&this.room.eventShouldLiveIn(o).threadId===this.id&&o.getId()!==this.id&&!a.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(Zi.Update,this))}),L(this,"onRedaction",function(){var o=U(function*(a,l,c){if(c===i.id)if(i.replyCount<=0){for(var u of i.timeline)i.clearEventMetadata(u);i.lastEvent=i.rootEvent,i._currentUserParticipated=!1,i.emit(Zi.Delete,i)}else{var f;((f=i.lastEvent)===null||f===void 0?void 0:f.getId())===a.getAssociatedId()&&(yield i.processRootEventPromise,i.processRootEventPromise=void 0),yield i.updateThreadMetadata()}});return function(a,l,c){return o.apply(this,arguments)}}()),L(this,"onTimelineEvent",(o,a,l)=>{if(!l){var c=o.getSender();c&&a&&this.shouldSendLocalEchoReceipt(c,o)&&a.addLocalEchoReceipt(c,o,Ji.Read),o.getId()!==this.id&&o.isRelation(cn.name)&&this.replyCount++}this.onEcho(o,l??!1)}),L(this,"onLocalEcho",o=>{this.onEcho(o,!1)}),L(this,"onEcho",function(){var o=U(function*(a,l){a.threadRootId===i.id&&i.lastEvent!==a&&(yield i.updateThreadMetadata(),a.isRelation(cn.name)&&(l||(i.lastEvent=void 0,i.emit(Zi.NewReply,i,a))))});return function(a,l){return o.apply(this,arguments)}}()),this.setMaxListeners(1e3),!(r!=null&&r.room))throw new Error("element-web#22141: A thread requires a room in order to function");this.room=r.room,this.client=r.client,this.pendingEventOrdering=(s=r.pendingEventOrdering)!==null&&s!==void 0?s:cg.Chronological,this.timelineSet=new fm(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new Vg(this),this.reEmitter.reEmit(this.timelineSet,[xe.Timeline,xe.TimelineReset]),this.room.on(Ht.BeforeRedaction,this.onBeforeRedaction),this.room.on(xe.Redaction,this.onRedaction),this.room.on(xe.LocalEchoUpdated,this.onLocalEcho),this.room.on(xe.TimelineReset,this.onTimelineReset),this.timelineSet.on(xe.Timeline,this.onTimelineEvent),this.processReceipts(r.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){var e=this;return U(function*(){try{var n=yield e.client.fetchRoomEvent(e.roomId,e.id),r=e.client.getEventMapper();e.rootEvent=r(n)}catch(i){O.error("Failed to fetch thread root to construct thread with",i)}yield e.processEvent(e.rootEvent)})()}static setServerSideSupport(e){Rn.hasServerSideSupport=e,e!==ji.Stable&&(Pm.setPreferUnstable(!0),Lm.setPreferUnstable(!0),cn.setPreferUnstable(!0))}static setServerSideListSupport(e){Rn.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){Rn.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,n){var r,i=(r=this.client.canSupport.get(Kr.RelationsRecursion))!==null&&r!==void 0?r:qr.Unsupported;if(i===qr.Unsupported){var s,o=(s=this.getReadReceiptForUserId(e))===null||s===void 0?void 0:s.eventId;if(o){var a=this.findEventById(o);if(a&&a.getTs()>n.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(Le.FORWARDS)}addEventToTimeline(e,n){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:n,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){var n=e.getId();n&&(this.findEventById(n)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,n){e.forEach(r=>this.addEvent(r,n,!1)),this.updateThreadMetadata()}addEvent(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this.setEventMetadata(e);var i=this.lastReply(),s=!i||e.localTimestamp>=i.localTimestamp;if(!Rn.hasServerSideSupport)this.addEventToTimeline(e,n),this.client.decryptEventIfNeeded(e);else if(e.isRelation(Tn.Annotation)||e.isRelation(Tn.Replace)){this.addRelatedThreadEvent(e,n);return}else!n&&s?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):n?this.addEventToTimeline(e,n):this.insertEventIntoTimeline(e);e.getId()!==this.id&&e.isRelation(cn.name)&&!n&&s&&(this.lastEvent=void 0),r&&(this.emit(Zi.NewReply,this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,n){var r,i;if(this.initialEventsFetched){var o,a=(o=this.client.canSupport.get(Kr.RelationsRecursion))!==null&&o!==void 0?o:qr.Unsupported;a===qr.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,n)}else{var s;(s=this.replayEvents)===null||s===void 0||s.push(e)}(r=this.timelineSet.relations)===null||r===void 0||r.aggregateParentEvent(e),(i=this.timelineSet.relations)===null||i===void 0||i.aggregateChildEvent(e,this.timelineSet)}processEvent(e){var n=this;return U(function*(){e&&(n.setEventMetadata(e),yield n.fetchEditsWhereNeeded(e))})()}processReceipts(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];for(var{eventId:n,receiptType:r,userId:i,receipt:s,synthetic:o}of e)this.addReceiptToStructure(n,r,i,s,o)}getRootEventBundledRelationship(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.rootEvent;return e==null?void 0:e.getServerAggregatedRelation(cn.name)}processRootEvent(){var e=this;return U(function*(){var n=e.getRootEventBundledRelationship();if(Rn.hasServerSideSupport&&n){e.replyCount=n.count,e._currentUserParticipated=!!n.current_user_participated;var r=e.client.getEventMapper();e.lastEvent=r(qF(qF({},n.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),yield e.processEvent(e.lastEvent)}})()}updatePendingReplyCount(){var e=this.pendingEventOrdering===cg.Detached?this.room.getPendingEvents():this.events,n=e.filter(r=>{var i;return r.threadRootId===this.id&&r.isRelation(cn.name)&&r.status!==null&&r.getId()!==((i=this.lastEvent)===null||i===void 0?void 0:i.getId())});this.lastPendingEvent=n.length?n[n.length-1]:void 0,this.pendingReplyCount=n.length}resetLiveTimeline(e,n){var r=this;return U(function*(){var i=r.liveTimeline;r.timelineSet.resetLiveTimeline(e??void 0,n??void 0);var s=r.liveTimeline,o,a;if(e){var l=yield r.client.createMessagesRequest(r.roomId,e,1,_t.Forward);o=l.end}if(n){var c=yield r.client.createMessagesRequest(r.roomId,n,1,_t.Backward);a=c.start}n&&i.getPaginationToken(_t.Forward)===n&&i.setPaginationToken(a??null,_t.Forward),e&&s.getPaginationToken(_t.Backward)===e&&s.setPaginationToken(o??null,_t.Backward)})()}updateThreadFromRootEvent(){var e=this;return U(function*(){Rn.hasServerSideSupport&&(!e.initialEventsFetched&&!e.lastEvent&&(yield e.processRootEvent()),yield e.fetchRootEvent()),yield e.processRootEvent()})()}updateThreadMetadata(){var e=this;return U(function*(){if(e.updatePendingReplyCount(),e.processRootEventPromise||(e.processRootEventPromise=e.updateThreadFromRootEvent()),yield e.processRootEventPromise,!e.initialEventsFetched)if(e.initalEventFetchProm)yield e.initalEventFetchProm;else try{e.timelineSet.resetLiveTimeline(),e.replyCount===0&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,!1,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,_t.Backward)):(e.initalEventFetchProm=e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0}),yield e.initalEventFetchProm),e.initialEventsFetched=!0;for(var n of e.replayEvents)e.addEvent(n,!1);e.replayEvents=null,e.emit(xe.TimelineReset,e.room,e.timelineSet,!0)}catch(r){O.error("Failed to load start of newly created thread: ",r),e.initialEventsFetched=!1}e.emit(Zi.Update,e)})()}fetchEditsWhereNeeded(){var e=arguments,n=this;return U(function*(){var r,i=(r=n.client.canSupport.get(Kr.RelationsRecursion))!==null&&r!==void 0?r:qr.Unsupported;if(i===qr.Unsupported){for(var s=e.length,o=new Array(s),a=0;a<s;a++)o[a]=e[a];return Promise.all(o.filter(age).map(function(){var l=U(function*(c){try{var u=yield n.client.relations(n.roomId,c.getId(),Tn.Replace,c.getType(),{limit:1});if(u.events.length){var f=u.events[0];c.makeReplaced(f),n.insertEventIntoTimeline(f)}}catch(p){O.error("Failed to load edits for encrypted thread event",p)}});return function(c){return l.apply(this,arguments)}}()))}})()}setEventMetadata(e){e&&(Le.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){if(e){var n;e.setThread(void 0),(n=e.event)===null||n===void 0||(n=n.unsigned)===null||n===void 0||(n=n["m.relations"])===null||n===void 0||delete n[cn.name]}}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i=>i.isRelation(cn.name),n=this.timeline.length-1;n>=0;n--){var r=this.timeline[n];if(e(r))return r}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,n;return(e=(n=this.lastPendingEvent)!==null&&n!==void 0?n:this.lastEvent)!==null&&e!==void 0?e:this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof Bi}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,n){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,n){var r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){var s=i.getTs()<this.room.getOldestThreadedReceiptTs(),o=i.getId();if(s&&o)return o}var a=super.getEventReadUpTo(e,n);if(i){var l=this.room.getLastUnthreadedReceiptFor(e);if(!l)return a;for(var c=((u=this.timeline)===null||u===void 0?void 0:u.length)-1;c>=0;--c){var u,f,p=this.timeline[c];if(p.getId()===a)return a;if(p.getTs()<l.ts)return(f=p.getId())!==null&&f!==void 0?f:a}}return a}hasUserReadEvent(e,n){if(e===this.client.getUserId()){var r,i,s,o,a,l,c=((r=(i=this.lastReply())===null||i===void 0?void 0:i.getTs())!==null&&r!==void 0?r:0)<this.room.getOldestThreadedReceiptTs(),u=(s=(o=this.room.getLastUnthreadedReceiptFor(e))===null||o===void 0?void 0:o.ts)!==null&&s!==void 0?s:0,f=((a=this===null||this===void 0||(l=this.lastReply())===null||l===void 0?void 0:l.getTs())!==null&&a!==void 0?a:0)<u;if(c||f)return!0}return this.room.hasUserReadEvent(e,n)}setUnread(e,n){return this.room.setThreadUnreadNotificationCount(this.id,e,n)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}}L(Rn,"hasServerSideSupport",ji.None);L(Rn,"hasServerSideListSupport",ji.None);L(Rn,"hasServerSideFwdPaginationSupport",ji.None);function age(t){return t.isEncrypted()&&(t.isRelation(cn.name)||t.isThreadRoot)}var Pm=new SC("related_by_senders","io.element.relation_senders"),Lm=new SC("related_by_rel_types","io.element.relation_types"),cn=new SC("m.thread","io.element.thread"),Ra=function(t){return t[t.My=0]="My",t[t.All=1]="All",t}({});function mz(t){switch(t){case Ra.My:return"participated";default:return"all"}}class KF extends Error{constructor(e,n,r){super(n),this.code=e,L(this,"detailedString",void 0),this.name="DecryptionError",this.detailedString=lge(this,r)}}function lge(t,e){var n=t.name+"[msg: "+t.message;return e&&(n+=", "+Object.keys(e).map(r=>r+": "+e[r]).join(", ")),n+="]",n}var WF=Object.freeze({visible:!0}),Ht=function(t){return t.Decrypted="Event.decrypted",t.BeforeRedaction="Event.beforeRedaction",t.VisibilityChange="Event.visibilityChange",t.LocalEventIdReplaced="Event.localEventIdReplaced",t.Status="Event.status",t.Replaced="Event.replaced",t.RelationsCreated="Event.relationsCreated",t.SentinelUpdated="Event.sentinelUpdated",t}({});class Bi extends Un{setMetadata(e,n){var r,i,s=this.isState()&&this.getType()===ee.RoomMember&&this.getSender()===this.getStateKey(),o=!1;if(s||!((r=this.sender)!==null&&r!==void 0&&(r=r.events)!==null&&r!==void 0&&r.member)){var a=e.getSentinelMember(this.getSender());a!==this.sender&&(o=!0),this.sender=a}if(s||!((i=this.target)!==null&&i!==void 0&&(i=i.events)!==null&&i!==void 0&&i.member)&&this.getType()===ee.RoomMember){var l=e.getSentinelMember(this.getStateKey());l!==this.target&&(o=!0),this.target=l}this.isState()&&n&&(this.forwardLooking=!1),o&&this.emit(Ht.SentinelUpdated)}constructor(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.event=n,L(this,"pushDetails",{}),L(this,"_replacingEvent",null),L(this,"_localRedactionEvent",null),L(this,"_isCancelled",!1),L(this,"clearEvent",void 0),L(this,"visibility",WF),L(this,"_hasCachedExtEv",!1),L(this,"_cachedExtEv",void 0),L(this,"_decryptionFailureReason",null),L(this,"senderCurve25519Key",null),L(this,"claimedEd25519Key",null),L(this,"forwardingCurve25519KeyChain",[]),L(this,"untrusted",null),L(this,"decryptionPromise",null),L(this,"retryDecryption",!1),L(this,"txnId",void 0),L(this,"thread",void 0),L(this,"threadId",void 0),L(this,"localTimestamp",void 0),L(this,"sender",null),L(this,"target",null),L(this,"status",null),L(this,"error",null),L(this,"forwardLooking",!0),L(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach(i=>{typeof n[i]=="string"&&(n[i]=_I(n[i]))}),["membership","avatar_url","displayname"].forEach(i=>{var s;typeof((s=n.content)===null||s===void 0?void 0:s[i])=="string"&&(n.content[i]=_I(n.content[i]))}),["rel_type"].forEach(i=>{var s;typeof((s=n.content)===null||s===void 0||(s=s["m.relates_to"])===null||s===void 0?void 0:s[i])=="string"&&(n.content["m.relates_to"][i]=_I(n.content["m.relates_to"][i]))}),this.txnId=n.txn_id;var r=this.getAge();this.localTimestamp=r!==void 0?Date.now()-r:(e=this.getTs())!==null&&e!==void 0?e:Date.now(),this.reEmitter=new Vg(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=js.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){var e=Object.assign({},this.getContent());if(this.getWireType()===ee.RoomMessageEncrypted)for(var[n,r]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(n)||e[n]===void 0&&(e[n]=r);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var e=this.getRoomId();if(e){var n;return"id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()," room=").concat(e," ts=").concat((n=this.getDate())===null||n===void 0?void 0:n.toISOString())}else{var r=this.getContent()[TC];return"msgid=".concat(r," type=").concat(this.getWireType()," sender=").concat(this.getSender())}}getOriginalContent(){var e;if(this._localRedactionEvent)return{};if(this.clearEvent){var n;return(n=this.clearEvent.content)!==null&&n!==void 0?n:{}}return(e=this.event.content)!==null&&e!==void 0?e:{}}getContent(){if(this._localRedactionEvent)return{};if(this._replacingEvent){var e;return(e=this._replacingEvent.getContent()["m.new_content"])!==null&&e!==void 0?e:{}}else return this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var e;if(!this.isState()){var n=(e=this.getWireContent())===null||e===void 0?void 0:e["m.relates_to"];if((n==null?void 0:n.rel_type)===cn.name)return n.event_id;if(this.thread)return this.thread.id;if(this.threadId!==void 0)return this.threadId;var r=this.getUnsigned();if(typeof r[UE.name]=="string")return r[UE.name]}}get isThreadRoot(){if(this.isState())return!1;var e=this.getServerAggregatedRelation(cn.name);return!!e||this.threadRootId===this.getId()}get replyEventId(){var e;return(e=this.getWireContent()["m.relates_to"])===null||e===void 0||(e=e["m.in_reply_to"])===null||e===void 0?void 0:e.event_id}get relationEventId(){var e;return(e=this.getWireContent())===null||e===void 0||(e=e["m.relates_to"])===null||e===void 0?void 0:e.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return this.event.state_key!==void 0}getMembershipAtEvent(){var e=this.getUnsigned();return XK.findIn(e)}makeEncrypted(e,n,r,i){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=n,this.senderCurve25519Key=r,this.claimedEd25519Key=i}isBeingDecrypted(){return this.decryptionPromise!=null}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return this._decryptionFailureReason!==null}get decryptionFailureReason(){return this._decryptionFailureReason}get isEncryptedDisabledForUnverifiedDevices(){return this.decryptionFailureReason===AF.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};if(!r.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");var s=r.clearEvent&&!r.isDecryptionFailure(),o=i.forceRedecryptIfUntrusted&&r.isKeySourceUntrusted();if(s&&!o)throw new Error("Attempt to decrypt event which has already been decrypted");return r.decryptionPromise?(O.log("Event ".concat(r.getId()," already being decrypted; queueing a retry")),r.retryDecryption=!0,r.decryptionPromise):(r.decryptionPromise=r.decryptionLoop(e,i),r.decryptionPromise)})()}getKeyRequestRecipients(e){var n=[{userId:e,deviceId:"*"}];return n}decryptionLoop(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};for(yield Promise.resolve();;){r.retryDecryption=!1;var s=void 0;try{var o=yield e.decryptEvent(r);i.isRetry===!0&&O.info("Decrypted event on retry (".concat(r.getDetails(),")")),r.setClearData(o),r._decryptionFailureReason=null}catch(l){var a=l instanceof KF?l.detailedString:String(l);if(s=l,r.retryDecryption){O.log("Error decrypting event (".concat(r.getDetails(),"), but retrying: ").concat(a));continue}O.warn("Error decrypting event (".concat(r.getDetails(),"): ").concat(a)),r.setClearDataForDecryptionFailure(String(l)),r._decryptionFailureReason=l instanceof KF?l.code:AF.UNKNOWN_ERROR}r.decryptionPromise=null,r.retryDecryption=!1,r.setPushDetails(),i.emit!==!1&&r.emit(Ht.Decrypted,r,s);return}})()}setClearData(e){var n,r;this.clearEvent=e.clearEvent,this.senderCurve25519Key=(n=e.senderCurve25519Key)!==null&&n!==void 0?n:null,this.claimedEd25519Key=(r=e.claimedEd25519Key)!==null&&r!==void 0?r:null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:ee.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: ".concat(e," **")}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===ee.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(Ht.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var n,r,i=(n=e==null?void 0:e.visible)!==null&&n!==void 0?n:!0,s=(r=e==null?void 0:e.reason)!==null&&r!==void 0?r:null,o=!1;(this.visibility.visible!==i||!this.visibility.visible&&this.visibility.reason!==s)&&(o=!0),o&&(i?this.visibility=WF:this.visibility=Object.freeze({visible:!1,reason:s}),this.emit(Ht.VisibilityChange,this,i))}messageVisibility(){return this.visibility}makeRedacted(e,n){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit(Ht.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(var r in this.event)this.event.hasOwnProperty(r)&&!cge.has(r)&&delete this.event[r];this.isEncrypted()&&(this.clearEvent=void 0);var i=this.getType()in zF?zF[this.getType()]:{},s=this.getContent();for(var o in s)s.hasOwnProperty(o)&&!i[o]&&delete s[o];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(n),e.moveToMainTimeline(n)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var n=this.thread;if(this.moveToMainTimeline(e),n)for(var r of n.events){var i;((i=r.getRelation())===null||i===void 0?void 0:i.event_id)===this.getId()&&r.moveAllRelatedToMainTimeline(e)}}moveToMainTimeline(e){var n;(n=this.thread)===null||n===void 0||n.timelineSet.removeEvent(this.getId()),this.setThread(void 0);var r=e.getLiveTimeline();r.getTimelineSet().insertEventIntoTimeline(this,r,r.getState(Le.FORWARDS),!1)}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===ee.RoomRedaction}asVisibilityChange(){if(!th.matches(this.getType()))return null;var e=this.getRelation();if(!e||e.rel_type!="m.reference")return null;var n=e.event_id;if(!n)return null;var r=this.getWireContent(),i=!!r.visible,s=r.reason;return s&&typeof s!="string"?null:{visible:i,reason:s,eventId:n}}isVisibilityEvent(){return th.matches(this.getType())}getRedactionEvent(){var e,n;if(!this.isRedacted())return null;if((e=this.clearEvent)!==null&&e!==void 0&&e.unsigned){var r,i;return(r=(i=this.clearEvent)===null||i===void 0?void 0:i.unsigned.redacted_because)!==null&&r!==void 0?r:null}else return(n=this.event.unsigned)!==null&&n!==void 0&&n.redacted_because?this.event.unsigned.redacted_because:{}}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,n){this.pushDetails={actions:e,rule:n}}handleRemoteEcho(e){var n,r=this.getUnsigned(),i=this.getId();this.event=e,r.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=r.redacted_because),this.setStatus(null),this.getId()!==i&&this.emit(Ht.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-((n=this.getAge())!==null&&n!==void 0?n:0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(Ht.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(Ht.LocalEventIdReplaced,this)}isRelation(e){var n,r=(n=this.getWireContent())===null||n===void 0?void 0:n["m.relates_to"];return this.isState()&&(r!=null&&r.rel_type)&&[Tn.Replace,Tn.Thread].includes(r.rel_type)?!1:!!(r!=null&&r.rel_type&&r.event_id&&(!e||r.rel_type===e))}getRelation(){var e;return this.isRelation()&&(e=this.getWireContent()["m.relates_to"])!==null&&e!==void 0?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit(Ht.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var n;return(n=this.getUnsigned()["m.relations"])===null||n===void 0?void 0:n[e]}replacingEventId(){var e=this.getServerAggregatedRelation(Tn.Replace);if(e)return e.event_id;if(this._replacingEvent)return this._replacingEvent.getId()}replacingEvent(){return this._replacingEvent}replacingEventDate(){var e=this.getServerAggregatedRelation(Tn.Replace);if(e){var n=e.origin_server_ts;if(Number.isFinite(n))return new Date(n)}else if(this._replacingEvent){var r;return(r=this._replacingEvent.getDate())!==null&&r!==void 0?r:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){var e=this.getRelation();if(this.replyEventId)return this.replyEventId;if(e)return e.event_id;if(this.isRedaction())return this.event.redacts}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){var n=this.getRelation();n?n.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){var e=new Bi(JSON.parse(JSON.stringify(this.event)));for(var[n,r]of Object.entries(this))n!=="event"&&(e[n]=r);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;var n=F6(this.event),r=F6(e.event);return JSON.stringify(n)===JSON.stringify(r)}toJSON(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[Zi.Update]),this.thread=e,this.setThreadId(e==null?void 0:e.id),e&&this.reEmitter.reEmit(e,[Zi.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}var cge=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),zF={[ee.RoomMember]:{membership:1},[ee.RoomJoinRules]:{join_rule:1},[ee.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}},eo=function(t){return t[t.NotStarted=0]="NotStarted",t[t.InProgress=1]="InProgress",t[t.Finished=2]="Finished",t}(eo||{}),gt=function(t){return t.Events="RoomState.events",t.Members="RoomState.members",t.NewMember="RoomState.newMember",t.Update="RoomState.update",t.BeaconLiveness="RoomState.BeaconLiveness",t.Marker="RoomState.Marker",t}({});class ry extends Un{constructor(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{status:eo.NotStarted};super(),this.roomId=e,this.oobMemberFlags=n,L(this,"reEmitter",new Vg(this)),L(this,"sentinels",{}),L(this,"displayNameToUserIds",new Map),L(this,"userIdsToDisplayNames",{}),L(this,"tokenToInvite",{}),L(this,"joinedMemberCount",null),L(this,"summaryJoinedMemberCount",null),L(this,"invitedMemberCount",null),L(this,"summaryInvitedMemberCount",null),L(this,"modified",-1),L(this,"members",{}),L(this,"events",new Map),L(this,"paginationToken",null),L(this,"beacons",new Map),L(this,"_liveBeaconIds",[]),this.updateModifiedTime()}getJoinedMemberCount(){return this.summaryJoinedMemberCount!==null?this.summaryJoinedMemberCount:(this.joinedMemberCount===null&&(this.joinedMemberCount=this.getMembers().reduce((e,n)=>n.membership===qe.Join?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return this.summaryInvitedMemberCount!==null?this.summaryInvitedMemberCount:(this.invitedMemberCount===null&&(this.invitedMemberCount=this.getMembers().reduce((e,n)=>n.membership===qe.Invite?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(n=>!e.includes(n.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;var n=this.sentinels[e];if(n===void 0){n=new Y1(this.roomId,e);var r=this.members[e];r!=null&&r.events.member&&n.setMembershipEvent(r.events.member,this),this.sentinels[e]=n}return n}getStateEvents(e,n){if(!this.events.has(e))return n===void 0?[]:null;if(n===void 0)return Array.from(this.events.get(e).values());var r=this.events.get(e).get(n);return r||null}get hasLiveBeacons(){var e;return!!((e=this.liveBeaconIds)!==null&&e!==void 0&&e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){var e=new ry(this.roomId,this.oobMemberFlags),n=this.oobMemberFlags.status;return this.oobMemberFlags.status=eo.NotStarted,Array.from(this.events.values()).forEach(r=>{e.setStateEvents(Array.from(r.values()))}),this.oobMemberFlags.status=n,this.summaryInvitedMemberCount!==null&&e.setInvitedMemberCount(this.getInvitedMemberCount()),this.summaryJoinedMemberCount!==null&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==eo.Finished&&this.getMembers().forEach(r=>{if(r.isOutOfBand()){var i;(i=e.getMember(r.userId))===null||i===void 0||i.markOutOfBand()}}),e}setUnknownStateEvents(e){var n=e.filter(r=>!this.events.has(r.getType())||!this.events.get(r.getType()).has(r.getStateKey()));this.setStateEvents(n)}setStateEvents(e,n){this.updateModifiedTime(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState())){eA.matches(r.getType())&&this.setBeacon(r);var i=this.getStateEventMatching(r);if(this.setStateEvent(r),r.getType()===ee.RoomMember){var s;this.updateDisplayNameCache(r.getStateKey(),(s=r.getContent().displayname)!==null&&s!==void 0?s:""),this.updateThirdPartyTokenCache(r)}this.emit(gt.Events,r,this,i)}}),this.onBeaconLivenessChange(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState()))if(r.getType()===ee.RoomMember){var i=r.getStateKey();(r.getContent().membership===qe.Leave||r.getContent().membership===qe.Ban)&&(r.getContent().avatar_url=r.getContent().avatar_url||r.getPrevContent().avatar_url,r.getContent().displayname=r.getContent().displayname||r.getPrevContent().displayname);var s=this.getOrCreateMember(i,r);s.setMembershipEvent(r,this),this.updateMember(s),this.emit(gt.Members,r,this,s)}else if(r.getType()===ee.RoomPowerLevels){if(r.getStateKey()!=="")return;var o=Object.values(this.members);o.forEach(a=>{var l=a.getLastModifiedTime();a.setPowerLevelEvent(r),l!==a.getLastModifiedTime()&&this.emit(gt.Members,r,this,a)}),this.sentinels={}}else WK.matches(r.getType())&&this.emit(gt.Marker,r,n)}),this.emit(gt.Update,this)}processBeaconEvents(e,n){var r=this;return U(function*(){if(!(!e.length||!r.beacons.size)){var i=[...r.beacons.values()].reduce((c,u)=>(c[u.beaconInfoId]=u,c),{}),s=(c,u)=>{if(cx.matches(u.getType())){var f=i[c];f&&f.addLocations([u])}},o=function*(u){var f,p=(f=u.getRelation())===null||f===void 0?void 0:f.event_id;if(!p||!i[p])return{v:void 0};if(!cx.matches(u.getType())&&!u.isEncrypted())return{v:void 0};try{yield n.decryptEventIfNeeded(u),s(p,u)}catch{u.isDecryptionFailure()&&u.once(Ht.Decrypted,U(function*(){s(p,u)}))}},a;for(var l of e)if(a=yield*o(l),a)return a.v}})()}getOrCreateMember(e,n){var r=this.members[e];return r||(r=new Y1(this.roomId,e),this.members[e]=r,this.emit(gt.NewMember,n,this,r)),r}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var n=$E(e);if(this.beacons.has(n)){var r=this.beacons.get(n);if(e.isRedacted()){var i;r.beaconInfoId===((i=e.getRedactionEvent())===null||i===void 0?void 0:i.redacts)&&(r.destroy(),this.beacons.delete(n));return}return r.update(e)}if(!e.isRedacted()){var s=new _W(e);this.reEmitter.reEmit(s,[Mn.New,Mn.Update,Mn.Destroy,Mn.LivenessChange]),this.emit(Mn.New,e,s),s.on(Mn.LivenessChange,this.onBeaconLivenessChange.bind(this)),s.on(Mn.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(s.identifier,s)}}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit(gt.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var n,r;return(n=(r=this.events.get(e.getType()))===null||r===void 0?void 0:r.get(e.getStateKey()))!==null&&n!==void 0?n:null}updateMember(e){var n=this.getStateEvents(ee.RoomPowerLevels,"");n&&e.setPowerLevelEvent(n),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===eo.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===eo.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===eo.NotStarted&&(this.oobMemberFlags.status=eo.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===eo.InProgress&&(this.oobMemberFlags.status=eo.NotStarted)}clearOutOfBandMembers(){var e=0;Object.keys(this.members).forEach(n=>{var r=this.members[n];r.isOutOfBand()&&(++e,delete this.members[n])}),O.log("LL: RoomState removed ".concat(e," members...")),this.oobMemberFlags.status=eo.NotStarted}setOutOfBandMembers(e){O.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===eo.InProgress&&(O.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=eo.Finished,e.forEach(n=>this.setOutOfBandMember(n)),this.emit(gt.Update,this))}setOutOfBandMember(e){if(e.getType()===ee.RoomMember){var n=e.getStateKey(),r=this.getMember(n);if(!(r&&!r.isOutOfBand())){var i=this.getOrCreateMember(n,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit(gt.Members,e,this,i)}}}setTypingEvent(e){Object.values(this.members).forEach(function(n){n.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var n;return(n=this.displayNameToUserIds.get(wd(e)))!==null&&n!==void 0?n:[]}maySendRedactionForEvent(e,n){var r=this.getMember(n);if(!r||r.membership===qe.Leave||e.status||e.isRedacted())return!1;var i=this.maySendEvent(ee.RoomRedaction,n);return i?e.getSender()===n?!0:this.hasSufficientPowerLevelFor("redact",r.powerLevel):!1}hasSufficientPowerLevelFor(e,n){var r=this.getStateEvents(ee.RoomPowerLevels,""),i={};r&&(i=r.getContent());var s=50;return pD(i[e])&&(s=i[e]),n>=s}maySendMessage(e){return this.maySendEventOfType(ee.RoomMessage,e,!1)}maySendEvent(e,n){return this.maySendEventOfType(e,n,!1)}mayClientSendStateEvent(e,n){return n.isGuest()||!n.credentials.userId?!1:this.maySendStateEvent(e,n.credentials.userId)}maySendStateEvent(e,n){return this.maySendEventOfType(e,n,!0)}maySendEventOfType(e,n,r){var i=this.getStateEvents(ee.RoomPowerLevels,""),s,o={},a=0,l=0,c=0;if(i){s=i.getContent(),o=s.events||{},Number.isSafeInteger(s.state_default)?a=s.state_default:a=50;var u=s.users&&s.users[n];Number.isSafeInteger(u)?c=u:Number.isSafeInteger(s.users_default)&&(c=s.users_default),Number.isSafeInteger(s.events_default)&&(l=s.events_default)}var f=r?a:l;return Number.isSafeInteger(o[e])&&(f=o[e]),c>=f}mayTriggerNotifOfType(e,n){var r=this.getMember(n);if(!r)return!1;var i=this.getStateEvents(ee.RoomPowerLevels,""),s=50;return i&&i.getContent()&&i.getContent().notifications&&pD(i.getContent().notifications[e])&&(s=i.getContent().notifications[e]),r.powerLevel>=s}getJoinRule(){var e,n=this.getStateEvents(ee.RoomJoinRules,""),r=(e=n==null?void 0:n.getContent())!==null&&e!==void 0?e:{};return r.join_rule||Td.Invite}getHistoryVisibility(){var e,n=this.getStateEvents(ee.RoomHistoryVisibility,""),r=(e=n==null?void 0:n.getContent())!==null&&e!==void 0?e:{};return r.history_visibility||QL.Shared}getGuestAccess(){var e,n=this.getStateEvents(ee.RoomGuestAccess,""),r=(e=n==null?void 0:n.getContent())!==null&&e!==void 0?e:{};return r.guest_access||VE.Forbidden}findPredecessor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(e){var n=this.getStateEvents(ee.RoomPredecessor,"");if(n){var r=n.getContent(),i=r.predecessor_room_id,s=r.last_known_event_id;typeof s!="string"&&(s=void 0);var o=r.via_servers;if(Array.isArray(o)||(o=void 0),typeof i=="string")return{roomId:i,eventId:s,viaServers:o}}}var a=this.getStateEvents(ee.RoomCreate,"");if(a){var l=a.getContent().predecessor;if(l){var c=l.room_id;if(typeof c=="string"){var u=l.event_id;return(typeof u!="string"||u==="")&&(u=void 0),{roomId:c,eventId:u}}}}return null}updateThirdPartyTokenCache(e){if(e.getContent().third_party_invite){var n=(e.getContent().third_party_invite.signed||{}).token;if(n){var r=this.getStateEvents(ee.RoomThirdPartyInvite,n);r&&(this.tokenToInvite[n]=e)}}}updateDisplayNameCache(e,n){var r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){var i=wd(r),s=this.displayNameToUserIds.get(i);if(s){var o=s.filter(u=>u!==e);this.displayNameToUserIds.set(i,o)}}this.userIdsToDisplayNames[e]=n;var a=n&&wd(n);if(a){var l,c=(l=this.displayNameToUserIds.get(a))!==null&&l!==void 0?l:[];c.push(e),this.displayNameToUserIds.set(a,c)}}}function YF(t){var e=typeof t=="string"&&!!t&&t!=="undefined"&&t!=="null";return e||typeof t=="number"}class iy{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};L(this,"rooms",{}),L(this,"users",{}),L(this,"syncToken",null),L(this,"filters",new Bc(()=>new Map)),L(this,"accountData",new Map),L(this,"localStorage",void 0),L(this,"oobMembers",new Map),L(this,"pendingEvents",{}),L(this,"clientOptions",void 0),L(this,"pendingToDeviceBatches",[]),L(this,"nextToDeviceBatchId",0),L(this,"createUser",void 0),L(this,"onRoomMember",(n,r,i)=>{var s;if(i.membership!==qe.Invite){var o=this.users[i.userId]||((s=this.createUser)===null||s===void 0?void 0:s.call(this,i.userId));i.name&&(o.setDisplayName(i.name),i.events.member&&o.setRawDisplayName(i.events.member.getDirectionalContent().displayname)),i.events.member&&i.events.member.getContent().avatar_url&&o.setAvatarUrl(i.events.member.getContent().avatar_url),this.users[o.userId]=o}}),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(gt.Members,this.onRoomMember),e.currentState.getMembers().forEach(n=>{this.onRoomMember(null,e.currentState,n)})}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(gt.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map(function(e){return e.summary})}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,n){return[]}storeEvents(e,n,r,i){}storeFilter(e){!(e!=null&&e.userId)||!(e!=null&&e.filterId)||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,n){var r;return((r=this.filters.get(e))===null||r===void 0?void 0:r.get(n))||null}getFilterIdByName(e){if(!this.localStorage)return null;var n="mxjssdk_memory_filter_"+e;try{var r=this.localStorage.getItem(n);if(YF(r))return r}catch{}return null}setFilterIdByName(e,n){if(this.localStorage){var r="mxjssdk_memory_filter_"+e;try{YF(n)?this.localStorage.setItem(r,n):this.localStorage.removeItem(r)}catch{}}}storeAccountDataEvents(e){e.forEach(n=>{var r=!Object.keys(n.getContent()).length;r?this.accountData.delete(n.getType()):this.accountData.set(n.getType(),n)})}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new Bc(()=>new Map),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,n){return this.oobMembers.set(e,n),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}getPendingEvents(e){var n=this;return U(function*(){var r;return(r=n.pendingEvents[e])!==null&&r!==void 0?r:[]})()}setPendingEvents(e,n){var r=this;return U(function*(){r.pendingEvents[e]=n})()}saveToDeviceBatches(e){for(var n of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:n.eventType,txnId:n.txnId,batch:n.batch});return Promise.resolve()}getOldestToDeviceBatch(){var e=this;return U(function*(){return e.pendingToDeviceBatches.length===0?null:e.pendingToDeviceBatches[0]})()}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(n=>n.id!==e),Promise.resolve()}destroy(){return U(function*(){})()}}var gz=(t=>(t.ToWidget="toWidget",t.FromWidget="fromWidget",t))(gz||{});function uge(t){if(t==="toWidget")return"fromWidget";if(t==="fromWidget")return"toWidget";throw new Error("Invalid direction")}var bc=(t=>(t.MSC2762="org.matrix.msc2762",t.MSC2762_UPDATE_STATE="org.matrix.msc2762_update_state",t.MSC2871="org.matrix.msc2871",t.MSC2873="org.matrix.msc2873",t.MSC2931="org.matrix.msc2931",t.MSC2974="org.matrix.msc2974",t.MSC2876="org.matrix.msc2876",t.MSC3819="org.matrix.msc3819",t.MSC3846="town.robin.msc3846",t.MSC3869="org.matrix.msc3869",t.MSC3973="org.matrix.msc3973",t.MSC4039="org.matrix.msc4039",t))(bc||{});const dge=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2762_update_state","org.matrix.msc2871","org.matrix.msc2873","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class fge extends CC.EventEmitter{constructor(e,n,r,i){super(),this.sendDirection=e,this.initialWidgetId=n,this.transportWindow=r,this.inboundWindow=i,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this._widgetId=null,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=n}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let n=0,r=e;for(;this.outboundRequests.has(r);)r=`${e}-${n++}`;return this.outboundRequests.set(r,null),r}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,n){return this.sendInternal({...e,response:n})}send(e,n){return this.sendComplete(e,n).then(r=>r.response)}sendComplete(e,n){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const r={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:n};return e===ar.UpdateVisibility&&(r.visible=n.visible),new Promise((i,s)=>{const o=f=>{u(),i(f)},a=f=>{u(),s(f)},l=setTimeout(()=>a(new Error("Request timed out")),(this.timeoutSeconds||1)*1e3),c=()=>a(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",c);const u=()=>{this.outboundRequests.delete(r.requestId),clearTimeout(l),this.stopController.signal.removeEventListener("abort",c)};this.outboundRequests.set(r.requestId,{request:r,resolve:o,reject:a}),this.sendInternal(r)})}start(){this.inboundWindow.addEventListener("message",e=>{this.handleMessage(e)}),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==window.origin)return;const n=e.data;if(!(!n.action||!n.requestId||!n.widgetId))if(n.response){if(n.api!==this.sendDirection)return;this.handleResponse(n)}else{const r=n;if(r.api!==uge(this.sendDirection))return;this.handleRequest(r)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const n=this.outboundRequests.get(e.requestId);if(n)if(pge(e.response)){const{message:r,...i}=e.response.error;n.reject(new XE(r,i))}else n.resolve(e)}}var ar=(t=>(t.SupportedApiVersions="supported_api_versions",t.Capabilities="capabilities",t.NotifyCapabilities="notify_capabilities",t.ThemeChange="theme_change",t.LanguageChange="language_change",t.TakeScreenshot="screenshot",t.UpdateVisibility="visibility",t.OpenIDCredentials="openid_credentials",t.WidgetConfig="widget_config",t.CloseModalWidget="close_modal",t.ButtonClicked="button_clicked",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.UpdateState="update_state",t.UpdateTurnServers="update_turn_servers",t))(ar||{}),Vn=(t=>(t.SupportedApiVersions="supported_api_versions",t.ContentLoaded="content_loaded",t.SendSticker="m.sticker",t.UpdateAlwaysOnScreen="set_always_on_screen",t.GetOpenIDCredentials="get_openid",t.CloseModalWidget="close_modal",t.OpenModalWidget="open_modal",t.SetModalButtonEnabled="set_button_enabled",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.WatchTurnServers="watch_turn_servers",t.UnwatchTurnServers="unwatch_turn_servers",t.BeeperReadRoomAccountData="com.beeper.read_room_account_data",t.MSC2876ReadEvents="org.matrix.msc2876.read_events",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",t.MSC3869ReadRelations="org.matrix.msc3869.read_relations",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",t.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",t.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(Vn||{}),sm=(t=>(t.Allowed="allowed",t.Blocked="blocked",t.PendingUserConfirmation="request",t))(sm||{}),vz=(t=>(t.Custom="m.custom",t.JitsiMeet="m.jitsi",t.Stickerpicker="m.stickerpicker",t))(vz||{}),yz=(t=>(t.Close="m.close",t))(yz||{}),bl=(t=>(t.Send="send",t.Receive="receive",t))(bl||{});class Fi{constructor(e,n,r,i,s){this.direction=e,this.eventType=n,this.kind=r,this.keyStr=i,this.raw=s}matchesAsStateEvent(e,n,r){return this.kind!=="state_event"||this.direction!==e||this.eventType!==n?!1:this.keyStr===null||this.keyStr===r}matchesAsToDeviceEvent(e,n){return!(this.kind!=="to_device"||this.direction!==e||this.eventType!==n)}matchesAsRoomEvent(e,n,r=null){if(this.kind!=="event"||this.direction!==e||this.eventType!==n)return!1;if(this.eventType==="m.room.message"){if(this.keyStr===null||this.keyStr===r)return!0}else return!0;return!1}matchesAsRoomAccountData(e,n){return!(this.kind!=="room_account"||this.direction!==e||this.eventType!==n)}static forStateEvent(e,n,r){n=n.replace(/#/g,"\\#"),r=r!=null?`#${r}`:"";const i=`org.matrix.msc2762.${e}.state_event:${n}${r}`;return Fi.findEventCapabilities([i])[0]}static forToDeviceEvent(e,n){const r=`org.matrix.msc3819.${e}.to_device:${n}`;return Fi.findEventCapabilities([r])[0]}static forRoomEvent(e,n){const r=`org.matrix.msc2762.${e}.event:${n}`;return Fi.findEventCapabilities([r])[0]}static forRoomMessageEvent(e,n){n=n??"";const r=`org.matrix.msc2762.${e}.event:m.room.message#${n}`;return Fi.findEventCapabilities([r])[0]}static forRoomAccountData(e,n){const r=`com.beeper.capabilities.${e}.room_account_data:${n}`;return Fi.findEventCapabilities([r])[0]}static findEventCapabilities(e){const n=[];for(const r of e){let i=null,s,o=null;if(r.startsWith("org.matrix.msc2762.send.event:")?(i="send",o="event",s=r.substring(30)):r.startsWith("org.matrix.msc2762.send.state_event:")?(i="send",o="state_event",s=r.substring(36)):r.startsWith("org.matrix.msc3819.send.to_device:")?(i="send",o="to_device",s=r.substring(34)):r.startsWith("org.matrix.msc2762.receive.event:")?(i="receive",o="event",s=r.substring(33)):r.startsWith("org.matrix.msc2762.receive.state_event:")?(i="receive",o="state_event",s=r.substring(39)):r.startsWith("org.matrix.msc3819.receive.to_device:")?(i="receive",o="to_device",s=r.substring(37)):r.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(i="receive",o="room_account",s=r.substring(50)),i===null||o===null||s===void 0)continue;const a=s.startsWith("m.room.message#")||o==="state_event";let l=null;if(s.includes("#")&&a){const c=s.split("#"),u=c.findIndex(f=>!f.endsWith("\\"));s=c.slice(0,u+1).map(f=>f.endsWith("\\")?f.substring(0,f.length-1):f).join("#"),l=c.slice(u+1).join("#")}n.push(new Fi(i,s,o,l,r))}return n}}var zf=(t=>(t.AnyRoom="*",t))(zf||{});const bC=class bC extends Error{constructor(e,n){super(e),this.data=n}};bC.prototype.name=bC.name;let XE=bC;class hge extends CC.EventEmitter{constructor(e=null,n=null){if(super(),this.clientOrigin=n,this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new fge(gz.FromWidget,e,window.parent,window),this.transport.targetOrigin=n,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){e.forEach(n=>this.requestCapability(n))}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,n){this.requestCapability(Fi.forStateEvent(bl.Send,e,n).raw)}requestCapabilityToReceiveState(e,n){this.requestCapability(Fi.forStateEvent(bl.Receive,e,n).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(Fi.forToDeviceEvent(bl.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(Fi.forToDeviceEvent(bl.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(Fi.forRoomEvent(bl.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(Fi.forRoomEvent(bl.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(Fi.forRoomMessageEvent(bl.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(Fi.forRoomMessageEvent(bl.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(Fi.forRoomAccountData(bl.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise((e,n)=>{this.transport.sendComplete(Vn.GetOpenIDCredentials,{}).then(r=>{const i=r.response;if(i.state===sm.Allowed)e(i);else if(i.state===sm.Blocked)n(new Error("User declined to verify their identity"));else if(i.state===sm.PendingUserConfirmation){const s=o=>{o.preventDefault();const a=o.detail;a.data.original_request_id===r.requestId&&(a.data.state===sm.Allowed?(e(a.data),this.transport.reply(a,{})):a.data.state===sm.Blocked?(n(new Error("User declined to verify their identity")),this.transport.reply(a,{})):(n(new Error("Invalid state on reply: "+i.state)),this.transport.reply(a,{error:{message:"Invalid state"}})),this.off(`action:${ar.OpenIDCredentials}`,s))};this.on(`action:${ar.OpenIDCredentials}`,s)}else n(new Error("Invalid state: "+i.state))}).catch(n)})}updateRequestedCapabilities(){return this.transport.send(Vn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(Vn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(Vn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(Vn.UpdateAlwaysOnScreen,{value:e}).then(n=>n.success)}openModalWidget(e,n,r=[],i={},s=vz.Custom){return this.transport.send(Vn.OpenModalWidget,{type:s,url:e,name:n,buttons:r,data:i}).then()}closeModalWidget(e={}){return this.transport.send(Vn.CloseModalWidget,e).then()}sendRoomEvent(e,n,r,i,s){return this.sendEvent(e,void 0,n,r,i,s)}sendStateEvent(e,n,r,i,s,o){return this.sendEvent(e,n,r,i,s,o)}sendEvent(e,n,r,i,s,o){return this.transport.send(Vn.SendEvent,{type:e,content:r,...n!==void 0&&{state_key:n},...i!==void 0&&{room_id:i},...s!==void 0&&{delay:s},...o!==void 0&&{parent_delay_id:o}})}updateDelayedEvent(e,n){return this.transport.send(Vn.MSC4157UpdateDelayedEvent,{delay_id:e,action:n})}sendToDevice(e,n,r){return this.transport.send(Vn.SendToDevice,{type:e,encrypted:n,messages:r})}readRoomAccountData(e,n){const r={type:e};return n&&(n.includes(zf.AnyRoom)?r.room_ids=zf.AnyRoom:r.room_ids=n),this.transport.send(Vn.BeeperReadRoomAccountData,r).then(i=>i.events)}readRoomEvents(e,n,r,i,s){const o={type:e,msgtype:r};return n!==void 0&&(o.limit=n),i&&(i.includes(zf.AnyRoom)?o.room_ids=zf.AnyRoom:o.room_ids=i),s&&(o.since=s),this.transport.send(Vn.MSC2876ReadEvents,o).then(a=>a.events)}async readEventRelations(e,n,r,i,s,o,a,l){if(!(await this.getClientVersions()).includes(bc.MSC3869))throw new Error("The read_relations action is not supported by the client.");const u={event_id:e,rel_type:r,event_type:i,room_id:n,to:a,from:o,limit:s,direction:l};return this.transport.send(Vn.MSC3869ReadRelations,u)}readStateEvents(e,n,r,i){const s={type:e,state_key:r===void 0?!0:r};return n!==void 0&&(s.limit=n),i&&(i.includes(zf.AnyRoom)?s.room_ids=zf.AnyRoom:s.room_ids=i),this.transport.send(Vn.MSC2876ReadEvents,s).then(o=>o.events)}setModalButtonEnabled(e,n){if(e===yz.Close)throw new Error("The close button cannot be disabled");return this.transport.send(Vn.SetModalButtonEnabled,{button:e,enabled:n}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(Vn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const n=async r=>{r.preventDefault(),e(r.detail.data),await this.transport.reply(r.detail,{})};if(this.on(`action:${ar.UpdateTurnServers}`,n),this.turnServerWatchers===0)try{await this.transport.send(Vn.WatchTurnServers,{})}catch(r){throw this.off(`action:${ar.UpdateTurnServers}`,n),r}this.turnServerWatchers++;try{for(;;)yield await new Promise(r=>e=r)}finally{this.off(`action:${ar.UpdateTurnServers}`,n),this.turnServerWatchers--,this.turnServerWatchers===0&&await this.transport.send(Vn.UnwatchTurnServers,{})}}async searchUserDirectory(e,n){if(!(await this.getClientVersions()).includes(bc.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const i={search_term:e,limit:n};return this.transport.send(Vn.MSC3973UserDirectorySearch,i)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(bc.MSC4039))throw new Error("The get_media_config action is not supported by the client.");const n={};return this.transport.send(Vn.MSC4039GetMediaConfigAction,n)}async uploadFile(e){if(!(await this.getClientVersions()).includes(bc.MSC4039))throw new Error("The upload_file action is not supported by the client.");const r={file:e};return this.transport.send(Vn.MSC4039UploadFileAction,r)}async downloadFile(e){if(!(await this.getClientVersions()).includes(bc.MSC4039))throw new Error("The download_file action is not supported by the client.");const r={content_uri:e};return this.transport.send(Vn.MSC4039DownloadFileAction,r)}start(){this.transport.start(),this.getClientVersions().then(e=>{e.includes(bc.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)})}handleMessage(e){const n=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,n),!n.defaultPrevented)switch(e.detail.action){case ar.SupportedApiVersions:return this.replyVersions(e.detail);case ar.Capabilities:return this.handleCapabilities(e.detail);case ar.UpdateVisibility:return this.transport.reply(e.detail,{});case ar.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:dge})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(Vn.SupportedApiVersions,{}).then(e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions)).catch(e=>(console.warn("non-fatal error getting supported client versions: ",e),[]))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(n=>(n.includes(bc.MSC2871)?this.once(`action:${ar.NotifyCapabilities}`,r=>{this.approvedCapabilities=r.detail.data.approved,this.emit("ready")}):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities})))}}var v1=(t=>(t.Screenshots="m.capability.screenshot",t.StickerSending="m.sticker",t.AlwaysOnScreen="m.always_on_screen",t.RequiresClient="io.element.requires_client",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC3846TurnServers="town.robin.msc3846.turn_servers",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039UploadFile="org.matrix.msc4039.upload_file",t.MSC4039DownloadFile="org.matrix.msc4039.download_file",t.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(v1||{});function pge(t){const e=t.error;return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}function XF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function aS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?XF(Object(n),!0).forEach(function(r){L(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):XF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function mge(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new k2(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function k2(t){function e(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return k2=function(r){this.s=r,this.n=r.next},k2.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?Promise.resolve({value:r,done:!0}):e(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?Promise.reject(r):e(i.apply(this.s,arguments))}},new k2(t)}var x2=function(t){return t.PendingEventsChanged="PendingEvent.pendingEventsChanged",t}({});class _z extends NC{constructor(e,n,r,i,s){var o,a,l,c,u,f,p,m,v,g,S,b,w,k;super(i),o=this,this.widgetApi=e,this.capabilities=n,this.roomId=r,L(this,"room",void 0),L(this,"widgetApiReady",void 0),L(this,"roomStateSynced",void 0),L(this,"lifecycle",void 0),L(this,"syncState",null),L(this,"pendingSendingEventsTxId",[]),L(this,"eventEmitter",new Un),L(this,"updateTxId",function(){var C=U(function*(x){if(x.getSender()===o.getUserId()&&o.pendingSendingEventsTxId.some(F=>x.getType()===F.type)){for(var A,N=(A=o.pendingSendingEventsTxId.find(F=>F.id===x.getId()))===null||A===void 0?void 0:A.txId;!N&&o.pendingSendingEventsTxId.length>0;){var D;yield new Promise(F=>o.eventEmitter.once(x2.PendingEventsChanged,()=>F())),N=(D=o.pendingSendingEventsTxId.find(F=>F.id===x.getId()))===null||D===void 0?void 0:D.txId}N&&(x.setTxnId(N),x.setUnsigned(aS(aS({},x.getUnsigned()),{},{transaction_id:N}))),o.pendingSendingEventsTxId=o.pendingSendingEventsTxId.filter(F=>F.id!==x.getId()),o.pendingSendingEventsTxId.length===0&&o.eventEmitter.emit(x2.PendingEventsChanged)}});return function(x){return C.apply(this,arguments)}}()),L(this,"onEvent",function(){var C=U(function*(x){if(x.preventDefault(),x.detail.data.room_id===o.roomId){var A=new Bi(x.detail.data);yield o.updateTxId(A),o.syncApi instanceof hd?(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,void 0,[],[A]):yield o.syncApi.injectRoomEvents(o.room,[],void 0,[A]):(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,[],[A]):O.error("slididng sync cannot be used in widget mode if the client widget driver does not support the version: 'org.matrix.msc2762_update_state'"),o.emit(Ae.Event,A),o.setSyncState(qt.Syncing),O.info("Received event ".concat(A.getId()," ").concat(A.getType()))}else{var{event_id:N,room_id:D}=x.detail.data;O.info("Received event ".concat(N," for a different room ").concat(D,"; discarding"))}yield o.ack(x)});return function(x){return C.apply(this,arguments)}}()),L(this,"onToDevice",function(){var C=U(function*(x){x.preventDefault();var A=new Bi({type:x.detail.data.type,sender:x.detail.data.sender,content:x.detail.data.content});x.detail.data.encrypted&&A.makeEncrypted(ee.RoomMessageEncrypted,{},"",""),o.emit(Ae.ToDeviceEvent,A),o.setSyncState(qt.Syncing),yield o.ack(x)});return function(x){return C.apply(this,arguments)}}()),L(this,"onStateUpdate",function(){var C=U(function*(x){x.preventDefault(),(yield o.supportUpdateState())||O.warn("received update_state widget action but the widget driver did not claim to support 'org.matrix.msc2762_update_state'");for(var A of x.detail.data.state)if(A.room_id===o.roomId){var N=new Bi(A);o.syncApi instanceof hd?yield o.syncApi.injectRoomEvents(o.room,void 0,[N]):yield o.syncApi.injectRoomEvents(o.room,[N]),O.info("Updated state entry ".concat(N.getType()," ").concat(N.getStateKey()," to ").concat(N.getId()))}else{var{event_id:D,room_id:F}=x.detail.data;O.info("Received state entry ".concat(D," for a different room ").concat(F,"; discarding"))}yield o.ack(x)});return function(x){return C.apply(this,arguments)}}());var T=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=function(){var C=U(function*(x,A){try{return yield T(x,A)}catch(N){JF(N)}});return function(x,A){return C.apply(this,arguments)}}();var I=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=function(){var C=U(function*(x,A){try{return yield I(x,A)}catch(N){JF(N)}});return function(x,A){return C.apply(this,arguments)}}(),this.widgetApiReady=new Promise(C=>this.widgetApi.once("ready",C)),this.roomStateSynced=(a=n.receiveState)!==null&&a!==void 0&&a.length?new Promise(C=>this.widgetApi.once("action:".concat(ar.UpdateState),C)):Promise.resolve(),((l=n.sendEvent)!==null&&l!==void 0&&l.length||(c=n.receiveEvent)!==null&&c!==void 0&&c.length||n.sendMessage===!0||Array.isArray(n.sendMessage)&&n.sendMessage.length||n.receiveMessage===!0||Array.isArray(n.receiveMessage)&&n.receiveMessage.length||(u=n.sendState)!==null&&u!==void 0&&u.length||(f=n.receiveState)!==null&&f!==void 0&&f.length)&&e.requestCapabilityForRoomTimeline(r),(p=n.sendEvent)===null||p===void 0||p.forEach(C=>e.requestCapabilityToSendEvent(C)),(m=n.receiveEvent)===null||m===void 0||m.forEach(C=>e.requestCapabilityToReceiveEvent(C)),n.sendMessage===!0?e.requestCapabilityToSendMessage():Array.isArray(n.sendMessage)&&n.sendMessage.forEach(C=>e.requestCapabilityToSendMessage(C)),n.receiveMessage===!0?e.requestCapabilityToReceiveMessage():Array.isArray(n.receiveMessage)&&n.receiveMessage.forEach(C=>e.requestCapabilityToReceiveMessage(C)),(v=n.sendState)===null||v===void 0||v.forEach(C=>{var{eventType:x,stateKey:A}=C;return e.requestCapabilityToSendState(x,A)}),(g=n.receiveState)===null||g===void 0||g.forEach(C=>{var{eventType:x,stateKey:A}=C;return e.requestCapabilityToReceiveState(x,A)}),(S=n.sendToDevice)===null||S===void 0||S.forEach(C=>e.requestCapabilityToSendToDevice(C)),(b=n.receiveToDevice)===null||b===void 0||b.forEach(C=>e.requestCapabilityToReceiveToDevice(C)),n.sendDelayedEvents&&((w=n.sendEvent)!==null&&w!==void 0&&w.length||n.sendMessage===!0||Array.isArray(n.sendMessage)&&n.sendMessage.length||(k=n.sendState)!==null&&k!==void 0&&k.length)&&e.requestCapability(v1.MSC4157SendDelayedEvent),n.updateDelayedEvents&&e.requestCapability(v1.MSC4157UpdateDelayedEvent),n.turnServers&&e.requestCapability(v1.MSC3846TurnServers),e.on("action:".concat(ar.SendEvent),this.onEvent),e.on("action:".concat(ar.SendToDevice),this.onToDevice),e.on("action:".concat(ar.UpdateState),this.onStateUpdate),e.start(),s&&e.sendContentLoaded()}supportUpdateState(){var e=this;return U(function*(){return(yield e.widgetApi.getClientVersions()).includes(bc.MSC2762_UPDATE_STATE)})()}startClient(){var e=arguments,n=this;return U(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};n.lifecycle=new AbortController;var i=n.getUserId();if(i&&n.store.storeUser(new Hc(i)),r.slidingSync?n.syncApi=new GW(r.slidingSync,n,r,n.buildSyncApiOptions()):n.syncApi=new hd(n,r,n.buildSyncApiOptions()),n.room=n.syncApi.createRoom(n.roomId),n.store.storeRoom(n.room),yield n.widgetApiReady,yield n.supportUpdateState())yield n.roomStateSynced;else{var s,o;yield Promise.all((s=(o=n.capabilities.receiveState)===null||o===void 0?void 0:o.map(function(){var a=U(function*(l){var{eventType:c,stateKey:u}=l,f=yield n.widgetApi.readStateEvents(c,void 0,u,[n.roomId]),p=f.map(m=>new Bi(m));n.syncApi instanceof hd?yield n.syncApi.injectRoomEvents(n.room,void 0,p):yield n.syncApi.injectRoomEvents(n.room,p),p.forEach(m=>{n.emit(Ae.Event,m),O.info("Backfilled event ".concat(m.getId()," ").concat(m.getType()," ").concat(m.getStateKey()))})});return function(l){return a.apply(this,arguments)}}()))!==null&&s!==void 0?s:[])}r.clientWellKnownPollPeriod!==void 0&&(n.clientWellKnownIntervalID=setInterval(()=>{n.fetchClientWellKnown()},1e3*r.clientWellKnownPollPeriod),n.fetchClientWellKnown()),n.setSyncState(qt.Syncing),O.info("Finished initial sync"),n.matrixRTC.start(),n.capabilities.turnServers&&n.watchTurnServers()})()}stopClient(){this.widgetApi.off("action:".concat(ar.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(ar.SendToDevice),this.onToDevice),this.widgetApi.off("action:".concat(ar.UpdateState),this.onStateUpdate),super.stopClient(),this.lifecycle.abort()}joinRoom(e){var n=this;return U(function*(){if(e===n.roomId)return n.room;throw new Error("Unknown room: ".concat(e))})()}encryptAndSendEvent(e,n,r){var i=this;return U(function*(){var s=n.event.redacts?aS(aS({},n.getContent()),{},{redacts:n.event.redacts}):n.getContent();if(r){var o=yield i.widgetApi.sendRoomEvent(n.getType(),s,e.roomId,"delay"in r?r.delay:void 0,"parent_delay_id"in r?r.parent_delay_id:void 0).catch(ul);return i.validateSendDelayedEventResponse(o)}var a=n.getTxnId();a&&i.pendingSendingEventsTxId.push({type:n.getType(),id:void 0,txId:a});var l;try{l=yield i.widgetApi.sendRoomEvent(n.getType(),s,e.roomId).catch(ul)}catch(c){throw i.updatePendingEventStatus(e,n,at.NOT_SENT),c}return e.updatePendingEvent(n,at.SENT,l.event_id),i.pendingSendingEventsTxId.forEach(c=>{c.txId===a&&(c.id=l.event_id)}),i.eventEmitter.emit(x2.PendingEventsChanged),{event_id:l.event_id}})()}sendStateEvent(e,n,r){var i=arguments,s=this;return U(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:"",a=yield s.widgetApi.sendStateEvent(n,o,r,e).catch(ul);if(a.event_id===void 0)throw new Error("'event_id' absent from response to an event request");return{event_id:a.event_id}})()}_unstable_sendDelayedStateEvent(e,n,r,i){var s=arguments,o=this;return U(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:"";if(!(yield o.doesServerSupportUnstableFeature(Il)))throw new md("Server does not support the delayed events API","sendDelayedStateEvent");var l=yield o.widgetApi.sendStateEvent(r,a,i,e,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0).catch(ul);return o.validateSendDelayedEventResponse(l)})()}validateSendDelayedEventResponse(e){if(e.delay_id===void 0)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}_unstable_updateDelayedEvent(e,n){var r=this;return U(function*(){if(!(yield r.doesServerSupportUnstableFeature(Il)))throw new md("Server does not support the delayed events API","updateDelayedEvent");return yield r.widgetApi.updateDelayedEvent(e,n).catch(ul),{}})()}encryptAndSendToDevice(e,n,r){var i=this;return U(function*(){var s=new Bc(()=>new Map);for(var{userId:o,deviceId:a}of n)s.getOrCreate(o).set(a,r);yield i.widgetApi.sendToDevice(e,!0,eh(s)).catch(ul)})()}sendToDevice(e,n){var r=this;return U(function*(){return yield r.widgetApi.sendToDevice(e,!1,eh(n)).catch(ul),{}})()}getOpenIdToken(){var e=this;return U(function*(){var n=yield e.widgetApi.requestOpenIDConnectToken().catch(ul);return{access_token:n.access_token,expires_in:n.expires_in,matrix_server_name:n.matrix_server_name,token_type:n.token_type}})()}queueToDevice(e){var n=this;return U(function*(){var{eventType:r,batch:i}=e,s=new Bc(()=>new Map);for(var{userId:o,deviceId:a,payload:l}of i)s.getOrCreate(o).set(a,l);yield n.widgetApi.sendToDevice(r,!1,eh(s)).catch(ul)})()}sendToDeviceViaWidgetApi(e,n,r){var i=this;return U(function*(){yield i.widgetApi.sendToDevice(e,n,eh(r)).catch(ul)})()}checkTurnServers(){var e=this;return U(function*(){return e.turnServers.length>0})()}getSyncState(){return this.syncState}setSyncState(e){var n=this.syncState;this.syncState=e,this.emit(Ae.Sync,e,n)}ack(e){var n=this;return U(function*(){yield n.widgetApi.transport.reply(e.detail,{})})()}watchTurnServers(){var e=this;return U(function*(){var n=e.widgetApi.getTurnServers(),r=()=>{n.return(void 0)};e.lifecycle.signal.addEventListener("abort",r);try{var i=!1,s=!1,o;try{for(var a=mge(n),l;i=!(l=yield a.next()).done;i=!1){var c=l.value;e.turnServers=[{urls:c.uris,username:c.username,credential:c.password}],e.emit(Ae.TurnServers,e.turnServers),O.log("Received TURN server: ".concat(c.uris))}}catch(u){s=!0,o=u}finally{try{i&&a.return!=null&&(yield a.return())}finally{if(s)throw o}}}catch(u){O.warn("Error watching TURN servers",u)}finally{e.lifecycle.signal.removeEventListener("abort",r)}})()}}function JF(t){throw t instanceof XE&&t.data.matrix_api_error?Nn.fromWidgetApiErrorData(t.data.matrix_api_error):t}function ul(t){throw t instanceof Error&&t.message==="Request timed out"?new Vh("widget api timeout"):t}class gge{constructor(){L(this,"unthreadedReadReceipts",new Map),L(this,"threadedReadReceipts",new Bc(()=>new Map))}setUnthreaded(e,n){this.unthreadedReadReceipts.set(e,n)}setThreaded(e,n,r){this.threadedReadReceipts.getOrCreate(e).set(n,r)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(var e of this.threadedReadReceipts.values())for(var n of e.entries())yield n}consumeEphemeralEvents(e){e==null||e.forEach(n=>{n.type!==ee.Receipt||!n.content||Object.keys(n.content).forEach(r=>{Object.entries(n.content[r]).forEach(i=>{var[s,o]=i;if(ML(s))for(var a of Object.keys(o)){var l=n.content[r][s][a],c={data:n.content[r][s][a],type:s,eventId:r};l.thread_id?this.setThreaded(l.thread_id,a,c):this.setUnthreaded(a,c)}})})})}buildAccumulatedReceiptEvent(e){var n={type:ee.Receipt,room_id:e,content:{}},r=new Bc(()=>new Bc(()=>new Map));for(var[i,s]of this.allUnthreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);for(var[o,a]of this.allThreaded())r.getOrCreate(a.eventId).getOrCreate(a.type).set(o,a.data);return n.content=eh(r),r.size>0?n:null}}var gc=function(t){return t.Invite="invite",t.Leave="leave",t.Join="join",t.Knock="knock",t}({});function vge(t){return"_localTs"in t&&t._localTs!==void 0}class bz{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.opts=e,L(this,"accountData",{}),L(this,"inviteRooms",{}),L(this,"knockRooms",{}),L(this,"joinRooms",{}),L(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.accumulateRooms(e,n),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach(n=>{this.accountData[n.type]=n})}accumulateRooms(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(r=>{this.accumulateRoom(r,gc.Invite,e.rooms.invite[r],n)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(r=>{this.accumulateRoom(r,gc.Join,e.rooms.join[r],n)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(r=>{this.accumulateRoom(r,gc.Leave,e.rooms.leave[r],n)}),e.rooms.knock&&Object.keys(e.rooms.knock).forEach(r=>{this.accumulateRoom(r,gc.Knock,e.rooms.knock[r],n)}))}accumulateRoom(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;switch(n){case gc.Invite:this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,r);break;case gc.Knock:this.accumulateKnockState(e,r);break;case gc.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,i);break;case gc.Leave:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:O.error("Unknown cateogory: ",n)}}accumulateInviteState(e,n){if(!(!n.invite_state||!n.invite_state.events)){if(!this.inviteRooms[e]){this.inviteRooms[e]={invite_state:n.invite_state};return}var r=this.inviteRooms[e];n.invite_state.events.forEach(i=>{for(var s=!1,o=0;o<r.invite_state.events.length;o++){var a=r.invite_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.invite_state.events[o]=i,s=!0)}s||r.invite_state.events.push(i)})}}accumulateKnockState(e,n){if(!(!n.knock_state||!n.knock_state.events)){if(!this.knockRooms[e]){this.knockRooms[e]={knock_state:n.knock_state};return}var r=this.knockRooms[e];n.knock_state.events.forEach(i=>{for(var s=!1,o=0;o<r.knock_state.events.length;o++){var a=r.knock_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.knock_state.events[o]=i,s=!0)}s||r.knock_state.events.push(i)})}}accumulateJoinState(e,n){var r,i,s,o,a,l,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new gge});var u=this.joinRooms[e];if(n.account_data&&n.account_data.events&&n.account_data.events.forEach(I=>{u._accountData[I.type]=I}),n.unread_notifications&&(u._unreadNotifications=n.unread_notifications),u._unreadThreadNotifications=(r=(i=n[J1.stable])!==null&&i!==void 0?i:n[J1.unstable])!==null&&r!==void 0?r:void 0,n.summary){var f,p,m,v="m.heroes",g="m.invited_member_count",S="m.joined_member_count",b=u._summary,w=n.summary;b[v]=(f=w[v])!==null&&f!==void 0?f:b[v],b[S]=(p=w[S])!==null&&p!==void 0?p:b[S],b[g]=(m=w[g])!==null&&m!==void 0?m:b[g]}if(u._receipts.consumeEphemeralEvents((s=n.ephemeral)===null||s===void 0?void 0:s.events),n.timeline&&n.timeline.limited&&(u._timeline=[]),(o=n.state)===null||o===void 0||(o=o.events)===null||o===void 0||o.forEach(I=>{lS(u._currentState,I)}),(a=n["org.matrix.msc4222.state_after"])===null||a===void 0||(a=a.events)===null||a===void 0||a.forEach(I=>{lS(u._currentState,I)}),(l=n.timeline)===null||l===void 0||(l=l.events)===null||l===void 0||l.forEach((I,C)=>{var x;n["org.matrix.msc4222.state_after"]||lS(u._currentState,I);var A;if(c)A=I;else{var N;A=Object.assign({},I),A.unsigned!==void 0&&(A.unsigned=Object.assign({},A.unsigned));var D=(N=I.unsigned)===null||N===void 0?void 0:N.age;D!==void 0&&(A._localTs=Date.now()-D)}u._timeline.push({event:A,token:C===0&&(x=n.timeline.prev_batch)!==null&&x!==void 0?x:null})}),u._timeline.length>this.opts.maxTimelineEntries){for(var k=u._timeline.length-this.opts.maxTimelineEntries,T=k;T<u._timeline.length;T++)if(u._timeline[T].token){u._timeline=u._timeline.slice(T,u._timeline.length);break}}}getJSON(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach(i=>{n.invite[i]=this.inviteRooms[i]}),Object.keys(this.knockRooms).forEach(i=>{n.knock[i]=this.knockRooms[i]}),Object.keys(this.joinRooms).forEach(i=>{var s=this.joinRooms[i],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:s._unreadNotifications,unread_thread_notifications:s._unreadThreadNotifications,summary:s._summary};Object.keys(s._accountData).forEach(p=>{o.account_data.events.push(s._accountData[p])});var a=s._receipts.buildAccumulatedReceiptEvent(i);a&&o.ephemeral.events.push(a),s._timeline.forEach(p=>{if(!o.timeline.prev_batch){if(!p.token)return;o.timeline.prev_batch=p.token}var m;!e&&vge(p.event)?(m=Object.assign({},p.event),m.unsigned!==void 0&&(m.unsigned=Object.assign({},m.unsigned)),delete m._localTs,m.unsigned=m.unsigned||{},m.unsigned.age=Date.now()-p.event._localTs):m=p.event,o.timeline.events.push(m)});for(var l=Object.create(null),c=o.timeline.events.length-1;c>=0;c--){var u=o.timeline.events[c];if(!(u.state_key===null||u.state_key===void 0)){var f=Zy(u);f.unsigned&&(f.unsigned.prev_content&&(f.content=f.unsigned.prev_content),f.unsigned.prev_sender&&(f.sender=f.unsigned.prev_sender)),lS(l,f)}}Object.keys(s._currentState).forEach(p=>{Object.keys(s._currentState[p]).forEach(m=>{var v=s._currentState[p][m];o["org.matrix.msc4222.state_after"].events.push(v),l[p]&&l[p][m]&&(v=l[p][m]),o.state.events.push(v)})}),n.join[i]=o});var r=[];return Object.keys(this.accountData).forEach(i=>{r.push(this.accountData[i])}),{nextBatch:this.nextBatch,roomsData:n,accountData:r}}getNextBatchToken(){return this.nextBatch}}function lS(t,e){e.state_key===null||e.state_key===void 0||!e.type||(t[e.type]||(t[e.type]=Object.create(null)),t[e.type][e.state_key]=e)}var Sz=function(t){return t[t.Blocked=-1]="Blocked",t[t.Unverified=0]="Unverified",t[t.Verified=1]="Verified",t}({});class yge{constructor(e){L(this,"deviceId",void 0),L(this,"userId",void 0),L(this,"algorithms",void 0),L(this,"keys",void 0),L(this,"verified",void 0),L(this,"signatures",void 0),L(this,"displayName",void 0),L(this,"dehydrated",!1),this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||Sz.Unverified,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get("ed25519:".concat(this.deviceId))}getIdentityKey(){return this.keys.get("curve25519:".concat(this.deviceId))}}var ZF=function(){},_ge=10;class bge{constructor(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.client=e,this.timelineSet=n,L(this,"windowLimit",void 0),L(this,"start",void 0),L(this,"end",void 0),L(this,"eventCount",0),this.windowLimit=i.windowLimit||1e3,(r=n.room)===null||r===void 0||r.on(xe.Timeline,this.onTimelineEvent.bind(this))}load(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20,r=i=>{if(!i)throw new Error("No timeline given to initFields");var s,o=i.getEvents();if(!e)s=o.length;else if(s=o.findIndex(c=>c.getId()===e),s<0)throw new Error("getEventTimeline result didn't include requested event");var a=Math.min(o.length,s+Math.ceil(n/2)),l=Math.max(0,a-n);this.start=new Cx(i,l-i.getBaseIndex()),this.end=new Cx(i,a-i.getBaseIndex()),this.eventCount=a-l};return this.timelineSet.getTimelineForEvent(e)?(r(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){if(e==Le.BACKWARDS){var n;return(n=this.start)!==null&&n!==void 0?n:null}else if(e==Le.FORWARDS){var r;return(r=this.end)!==null&&r!==void 0?r:null}else throw new Error("Invalid direction '"+e+"'")}extend(e,n){var r=this.getTimelineIndex(e);if(!r)return!1;var i=e==Le.BACKWARDS?r.retreat(n):r.advance(n);if(i){this.eventCount+=i,ZF("TimelineWindow: increased cap by "+i+" (now "+this.eventCount+")");var s=this.eventCount-this.windowLimit;return s>0&&this.unpaginate(s,e!=Le.BACKWARDS),!0}return!1}onTimelineEvent(e,n,r,i){i&&this.onEventRemoved()}onEventRemoved(){var e=this.getEvents();e.length>0&&e[e.length-1]===void 0&&this.end&&this.end.index--}canPaginate(e){var n=this.getTimelineIndex(e);if(!n)return!1;if(e==Le.BACKWARDS){if(n.index>n.minIndex())return!0}else if(n.index<n.maxIndex())return!0;var r=n.timeline.getNeighbouringTimeline(e),i=n.timeline.getPaginationToken(e);return!!r||!!i}paginate(e,n){var r=arguments,i=this;return U(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:!0,o=r.length>3&&r[3]!==void 0?r[3]:_ge,a=i.getTimelineIndex(e);if(!a)return!1;if(a.pendingPaginate)return a.pendingPaginate;if(i.extend(e,n))return!0;if(!s||o===0)return!1;var l=a.timeline.getPaginationToken(e);if(!l)return!1;var c=i.client.paginateEventTimeline(a.timeline,{backwards:e==Le.BACKWARDS,limit:n}).finally(function(){a.pendingPaginate=void 0}).then(u=>u?i.paginate(e,n,!0,o-1):i.paginate(e,n,!1,0));return a.pendingPaginate=c,c})()}unpaginate(e,n){var r=n?this.start:this.end;if(!r)throw new Error("Attempting to unpaginate startOfTimeline=".concat(n," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var i=n?r.advance(e):r.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,ZF("TimelineWindow.unpaginate: dropped "+i+" (now "+this.eventCount+")")}}getEvents(){if(!this.start)return[];for(var e=[],n=this.start.timeline;n;){var r,i,s=n.getEvents(),o=0,a=s.length;n===this.start.timeline&&(o=this.start.index+n.getBaseIndex()),n===((r=this.end)===null||r===void 0?void 0:r.timeline)&&(a=this.end.index+n.getBaseIndex());for(var l=o;l<a;l++)e.push(s[l]);if(n===((i=this.end)===null||i===void 0?void 0:i.timeline))break;n=n.getNeighbouringTimeline(Le.FORWARDS)}return e}}class Cx{constructor(e,n){this.timeline=e,this.index=n,L(this,"pendingPaginate",void 0)}minIndex(){return this.timeline.getBaseIndex()*-1}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;var n;if(e<0){if(n=Math.max(e,this.minIndex()-this.index),n<0)return this.index+=n,n}else if(n=Math.min(e,this.maxIndex()-this.index),n>0)return this.index+=n,n;var r=this.timeline.getNeighbouringTimeline(e<0?Le.BACKWARDS:Le.FORWARDS);return r?(this.timeline=r,e<0?this.index=this.maxIndex():this.index=this.minIndex(),this.advance(e)):0}retreat(e){return this.advance(e*-1)*-1}}var _0="m.login.email.identity",QF="m.login.msisdn",Tx=function(t){return t.Password="m.login.password",t.Recaptcha="m.login.recaptcha",t.Terms="m.login.terms",t.Email="m.login.email.identity",t.Msisdn="m.login.msisdn",t.Sso="m.login.sso",t.SsoUnstable="org.matrix.login.sso",t.Dummy="m.login.dummy",t.RegistrationToken="m.login.registration_token",t.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",t}({});class Ez extends Error{constructor(e,n,r){super(e),this.required_stages=n,this.flows=r,L(this,"name","NoAuthFlowFoundError")}}class dA{constructor(e){var n=this;L(this,"matrixClient",void 0),L(this,"inputs",void 0),L(this,"clientSecret",void 0),L(this,"requestCallback",void 0),L(this,"busyChangedCallback",void 0),L(this,"stateUpdatedCallback",void 0),L(this,"requestEmailTokenCallback",void 0),L(this,"supportedStages",void 0),L(this,"data",void 0),L(this,"emailSid",void 0),L(this,"requestingEmailToken",!1),L(this,"attemptAuthDeferred",null),L(this,"chosenFlow",null),L(this,"currentStage",null),L(this,"emailAttempt",1),L(this,"submitPromise",null),L(this,"requestEmailToken",U(function*(){if(n.requestingEmailToken)O.warn("Could not request email token: Already requesting");else{O.trace("Requesting email token. Attempt: "+n.emailAttempt),n.requestingEmailToken=!0;try{var r=yield n.requestEmailTokenCallback(n.inputs.emailAddress,n.clientSecret,n.emailAttempt++,n.data.session);n.emailSid=r.sid,O.trace("Email token request succeeded")}finally{n.requestingEmailToken=!1}}})),this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,e.supportedStages!==void 0&&(this.supportedStages=new Set(e.supportedStages))}attemptAuth(){var e=this;return U(function*(){var n;e.attemptAuthDeferred=Promise.withResolvers();var r=e.attemptAuthDeferred.promise;if((n=e.data)!==null&&n!==void 0&&(n=n.flows)!==null&&n!==void 0&&n.length)e.startNextAuthStage();else{var i;(i=e.busyChangedCallback)===null||i===void 0||i.call(e,!0);var s=e.data.session?{session:e.data.session}:null;e.doRequest(s).finally(()=>{var o;(o=e.busyChangedCallback)===null||o===void 0||o.call(e,!1)})}return r})()}poll(){var e=this;return U(function*(){if(e.data.session&&e.attemptAuthDeferred&&!e.submitPromise){var n={};if(e.currentStage==_0&&e.emailSid){var r={sid:e.emailSid,client_secret:e.clientSecret},i=e.matrixClient.getIdentityServerUrl();i&&(r.id_server=new URL(i).host),n={type:_0,threepid_creds:r}}e.submitAuthDict(n,!0)}})()}getSessionId(){var e;return(e=this.data)===null||e===void 0?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var n;return(n=this.data)===null||n===void 0||(n=n.params)===null||n===void 0?void 0:n[e]}getChosenFlow(){return this.chosenFlow}submitAuthDict(e){var n=arguments,r=this;return U(function*(){var i,s=n.length>1&&n[1]!==void 0?n[1]:!1;if(!r.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");if(!s){var o;(o=r.busyChangedCallback)===null||o===void 0||o.call(r,!0)}for(;r.submitPromise;)try{yield r.submitPromise}catch{}var a;(i=r.data)!==null&&i!==void 0&&i.session?a=Object.assign({session:r.data.session},e):a=e;try{r.submitPromise=r.doRequest(a,s),yield r.submitPromise}finally{if(r.submitPromise=null,!s){var l;(l=r.busyChangedCallback)===null||l===void 0||l.call(r,!1)}}})()}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}doRequest(e){var n=arguments,r=this;return U(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;try{var s=yield r.requestCallback(e,i);r.attemptAuthDeferred.resolve(s),r.attemptAuthDeferred=null}catch(v){var o,a,l,c,u=v instanceof Nn?v:null,f=(o=u==null||(a=u.data)===null||a===void 0?void 0:a.flows)!==null&&o!==void 0?o:null,p=((l=r.data)===null||l===void 0?void 0:l.flows)||!!f;if(!u||u.httpStatus!==401||!u.data||!p)if(i)O.log("Background poll request failed doing UI auth: ignoring",v);else{var m;(m=r.attemptAuthDeferred)===null||m===void 0||m.reject(v)}u&&!u.data&&(u.data={}),u&&!u.data.flows&&!u.data.completed&&!u.data.session&&(u.data.flows=r.data.flows,u.data.completed=r.data.completed,u.data.session=r.data.session),u&&(r.data=u.data);try{r.startNextAuthStage()}catch(g){r.attemptAuthDeferred.reject(g),r.attemptAuthDeferred=null;return}if(!r.emailSid&&(c=r.chosenFlow)!==null&&c!==void 0&&c.stages.includes(Tx.Email))try{yield r.requestEmailToken()}catch(g){r.attemptAuthDeferred.reject(g),r.attemptAuthDeferred=null}}})()}startNextAuthStage(){var e,n,r=this.chooseStage();if(!r)throw new Error("No incomplete flows from the server");if(this.currentStage=r,r===Tx.Dummy){this.submitAuthDict({type:"m.login.dummy"});return}if((e=this.data)!==null&&e!==void 0&&e.errcode||(n=this.data)!==null&&n!==void 0&&n.error){var i,s;this.stateUpdatedCallback(r,{errcode:((i=this.data)===null||i===void 0?void 0:i.errcode)||"",error:((s=this.data)===null||s===void 0?void 0:s.error)||""});return}this.stateUpdatedCallback(r,r===_0?{emailSid:this.emailSid}:{})}chooseStage(){this.chosenFlow===null&&(this.chosenFlow=this.chooseFlow()),O.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return O.log("Next stage: %s",e),e}scoreFlow(e){var n=e.stages.length;return this.supportedStages!==void 0&&(n+=e.stages.filter(r=>!this.supportedStages.has(r)).length*10),n}chooseFlow(){var e,n=((e=this.data)===null||e===void 0?void 0:e.flows)||[],r=!!this.inputs.emailAddress||!!this.emailSid,i=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;n.sort((u,f)=>this.scoreFlow(u)-this.scoreFlow(f));for(var s of n){var o=!1,a=!1;for(var l of s.stages)l===_0?o=!0:l==QF&&(a=!0);if(o==r&&a==i)return s}var c=[];throw r&&c.push(_0),i&&c.push(QF),new Ez("No appropriate authentication flow found",c,n)}firstUncompletedStage(e){var n,r=((n=this.data)===null||n===void 0?void 0:n.completed)||[];return e.stages.find(i=>!r.includes(i))}}function wz(t,e){return new Promise((n,r)=>{var i=!0,s=t.open(e);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>r(s.error),s.onsuccess=()=>{var o=s.result;o.close(),i||t.deleteDatabase(e),n(i)},s.onerror=()=>r(s.error)})}var Cz=[t=>{t.createObjectStore("users",{keyPath:["userId"]}),t.createObjectStore("accountData",{keyPath:["type"]}),t.createObjectStore("sync",{keyPath:["clobber"]})},t=>{var e=t.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]});e.createIndex("room","room_id")},t=>{t.createObjectStore("client_options",{keyPath:["clobber"]})},t=>{t.createObjectStore("to_device_queue",{autoIncrement:!0})}],Sge=Cz.length;function cS(t,e,n){var r=t.openCursor(e);return new Promise((i,s)=>{var o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r.error)===null||a===void 0?void 0:a.name)))},r.onsuccess=()=>{var a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}function Df(t){return new Promise((e,n)=>{t.oncomplete=function(r){e(r)},t.onerror=function(){n(t.error)}})}function Tz(t){return new Promise((e,n)=>{t.onsuccess=function(r){e(r)},t.onerror=function(){n(t.error)}})}function Ege(t){return new Promise((e,n)=>{t.onsuccess=()=>e(t),t.onerror=r=>n(r)})}function FI(t){return Tz(t).then(e=>t.result)}class eU{static exists(e,n){return n="matrix-js-sdk:"+(n||"default"),wz(e,n)}constructor(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"default";this.indexedDB=e,L(this,"dbName",void 0),L(this,"syncAccumulator",void 0),L(this,"db",void 0),L(this,"disconnected",!0),L(this,"_isNewlyCreated",!1),L(this,"syncToDatabasePromise",void 0),L(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+n,this.syncAccumulator=new bz}connect(e){var n=this;if(!this.disconnected)return O.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,O.log("LocalIndexedDBStoreBackend.connect: connecting...");var r=this.indexedDB.open(this.dbName,Sge);return r.onupgradeneeded=i=>{var s=r.result,o=i.oldVersion;O.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(o)),o<1&&(this._isNewlyCreated=!0),Cz.forEach((a,l)=>{o<=l&&a(s)})},r.onblocked=()=>{O.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},O.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),Tz(r).then(U(function*(){O.log("LocalIndexedDBStoreBackend.connect: connected"),n.db=r.result,n.db.onversionchange=()=>{var i;(i=n.db)===null||i===void 0||i.close(),n.disconnected=!0,n.db=void 0},n.db.onclose=()=>{n.disconnected=!0,n.db=void 0,e==null||e()},yield n.init()}))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(e=>{var[n,r]=e;O.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:r.nextBatch,rooms:r.roomsData,account_data:{events:n}},!0)})}getOutOfBandMembers(e){return new Promise((n,r)=>{var i=this.db.transaction(["oob_membership_events"],"readonly"),s=i.objectStore("oob_membership_events"),o=s.index("room"),a=IDBKeyRange.only(e),l=o.openCursor(a),c=[],u=!1;l.onsuccess=()=>{var f=l.result;if(!f)return!c.length&&!u?n(null):n(c);var p=f.value;p.oob_written?u=!0:c.push(p),f.continue()},l.onerror=f=>{r(f)}}).then(n=>(O.log("LL: got ".concat(n==null?void 0:n.length," membershipEvents from storage for room ").concat(e," ...")),n))}setOutOfBandMembers(e,n){var r=this;return U(function*(){O.log("LL: backend about to store ".concat(n.length)+" members for ".concat(e));var i=r.db.transaction(["oob_membership_events"],"readwrite"),s=i.objectStore("oob_membership_events");n.forEach(a=>{s.put(a)});var o={room_id:e,oob_written:!0,state_key:0};s.put(o),yield Df(i),O.log("LL: backend done storing for ".concat(e,"!"))})()}clearOutOfBandMembers(e){var n=this;return U(function*(){var r=n.db.transaction(["oob_membership_events"],"readonly"),i=r.objectStore("oob_membership_events"),s=i.index("room"),o=IDBKeyRange.only(e),a=FI(s.openKeyCursor(o,"next")).then(v=>(v==null?void 0:v.primaryKey)[1]),l=FI(s.openKeyCursor(o,"prev")).then(v=>(v==null?void 0:v.primaryKey)[1]),[c,u]=yield Promise.all([a,l]),f=n.db.transaction(["oob_membership_events"],"readwrite"),p=f.objectStore("oob_membership_events"),m=IDBKeyRange.bound([e,c],[e,u]);O.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,c],[e,u]),yield Ege(p.delete(m))})()}clearDatabase(){return new Promise(e=>{var n;O.log("Removing indexeddb instance: ".concat(this.dbName)),(n=this.db)===null||n===void 0||n.close();var r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{O.log("can't yet delete indexeddb ".concat(this.dbName," because it is open elsewhere"))},r.onerror=()=>{var i;O.warn("unable to delete js-sdk store indexeddb: ".concat((i=r.error)===null||i===void 0?void 0:i.name)),e()},r.onsuccess=()=>{O.log("Removed indexeddb instance: ".concat(this.dbName)),e()}})}getSavedSync(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=this.syncAccumulator.getJSON();return n.nextBatch?e?Promise.resolve(Zy(n)):Promise.resolve(n):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(e)})}syncToDatabase(e){var n=this;return U(function*(){return n.syncToDatabasePromise?(O.warn("Skipping syncToDatabase() as persist already in flight"),n.pendingUserPresenceData.push(...e),n.syncToDatabasePromise):(e.unshift(...n.pendingUserPresenceData),n.syncToDatabasePromise=n.doSyncToDatabase(e),n.syncToDatabasePromise)})()}doSyncToDatabase(e){var n=this;return U(function*(){try{var r=n.syncAccumulator.getJSON(!0);yield Promise.all([n.persistUserPresenceEvents(e),n.persistAccountData(r.accountData),n.persistSyncData(r.nextBatch,r.roomsData)])}finally{n.syncToDatabasePromise=void 0}})()}persistSyncData(e,n){return O.log("Persisting sync data up to",e),xp(()=>{var r=this.db.transaction(["sync"],"readwrite"),i=r.objectStore("sync");return i.put({clobber:"-",nextBatch:e,roomsData:n}),Df(r).then(()=>{O.log("Persisted sync data up to",e)})})}persistAccountData(e){return xp(()=>{var n=this.db.transaction(["accountData"],"readwrite"),r=n.objectStore("accountData");for(var i of e)r.put(i);return Df(n).then()})}persistUserPresenceEvents(e){return xp(()=>{var n=this.db.transaction(["users"],"readwrite"),r=n.objectStore("users");for(var i of e)r.put({userId:i[0],event:i[1]});return Df(n).then()})}getUserPresenceEvents(){return xp(()=>{var e=this.db.transaction(["users"],"readonly"),n=e.objectStore("users");return cS(n,void 0,r=>[r.value.userId,r.value.event])})}loadAccountData(){return O.log("LocalIndexedDBStoreBackend: loading account data..."),xp(()=>{var e=this.db.transaction(["accountData"],"readonly"),n=e.objectStore("accountData");return cS(n,void 0,r=>r.value).then(r=>(O.log("LocalIndexedDBStoreBackend: loaded account data"),r))})}loadSyncData(){return O.log("LocalIndexedDBStoreBackend: loading sync data..."),xp(()=>{var e=this.db.transaction(["sync"],"readonly"),n=e.objectStore("sync");return cS(n,void 0,r=>r.value).then(r=>(O.log("LocalIndexedDBStoreBackend: loaded sync data"),r.length>1&&O.warn("loadSyncData: More than 1 sync row found."),r.length>0?r[0]:{}))})}getClientOptions(){return Promise.resolve().then(()=>{var e=this.db.transaction(["client_options"],"readonly"),n=e.objectStore("client_options");return cS(n,void 0,r=>{var i;return(i=r.value)===null||i===void 0?void 0:i.options}).then(r=>r[0])})}storeClientOptions(e){var n=this;return U(function*(){var r=n.db.transaction(["client_options"],"readwrite"),i=r.objectStore("client_options");i.put({clobber:"-",options:e}),yield Df(r)})()}saveToDeviceBatches(e){var n=this;return U(function*(){var r=n.db.transaction(["to_device_queue"],"readwrite"),i=r.objectStore("to_device_queue");for(var s of e)i.add(s);yield Df(r)})()}getOldestToDeviceBatch(){var e=this;return U(function*(){var n=e.db.transaction(["to_device_queue"],"readonly"),r=n.objectStore("to_device_queue"),i=yield FI(r.openCursor());if(!i)return null;var s=i.value;return{id:i.key,txnId:s.txnId,eventType:s.eventType,batch:s.batch}})()}removeToDeviceBatch(e){var n=this;return U(function*(){var r=n.db.transaction(["to_device_queue"],"readwrite"),i=r.objectStore("to_device_queue");i.delete(e),yield Df(r)})()}destroy(){var e=this;return U(function*(){var n;(n=e.db)===null||n===void 0||n.close()})()}}class wge{constructor(e,n){this.workerFactory=e,this.dbName=n,L(this,"worker",void 0),L(this,"nextSeq",0),L(this,"inFlight",{}),L(this,"startPromise",void 0),L(this,"onWorkerMessage",r=>{var i=r.data;if(i.command=="closed"){var s;(s=this.onClose)===null||s===void 0||s.call(this)}else if(i.command=="cmd_success"||i.command=="cmd_fail"){if(i.seq===void 0){O.error("Got reply from worker with no seq");return}var o=this.inFlight[i.seq];if(o===void 0){O.error("Got reply for unknown seq "+i.seq);return}if(delete this.inFlight[i.seq],i.command=="cmd_success")o.resolve(i.result);else{var a=new Error(i.error.message);a.name=i.error.name,o.reject(a)}}else O.warn("Unrecognised message from worker: ",i)})}connect(e){return this.onClose=e,this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,n){return this.doCmd("setOutOfBandMembers",[e,n])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(e){var n=this;return U(function*(){return n.doCmd("saveToDeviceBatches",[e])})()}getOldestToDeviceBatch(){var e=this;return U(function*(){return e.doCmd("getOldestToDeviceBatch")})()}removeToDeviceBatch(e){var n=this;return U(function*(){return n.doCmd("removeToDeviceBatch",[e])})()}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{O.log("IndexedDB worker is ready")})),this.startPromise}doCmd(e,n){return Promise.resolve().then(()=>{var r,i=this.nextSeq++,s=Promise.withResolvers();return this.inFlight[i]=s,(r=this.worker)===null||r===void 0||r.postMessage({command:e,seq:i,args:n}),s.promise})}destroy(){var e=this;return U(function*(){var n;(n=e.worker)===null||n===void 0||n.terminate()})()}}var Cge=1e3*60*5;class Rz extends iy{static exists(e,n){return eU.exists(e,n)}constructor(e){if(super(e),L(this,"backend",void 0),L(this,"startedUp",!1),L(this,"syncTs",0),L(this,"userModifiedMap",{}),L(this,"emitter",new Un),L(this,"onClose",()=>{this.emitter.emit("closed")}),L(this,"getSavedSync",this.degradable(()=>this.backend.getSavedSync(),"getSavedSync")),L(this,"isNewlyCreated",this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated")),L(this,"getSavedSyncToken",this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken")),L(this,"deleteAllData",this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{O.log("Deleted indexeddb data.")},n=>{throw O.error("Failed to delete indexeddb data: ".concat(n)),n})),null)),L(this,"reallySave",this.degradable(()=>{this.syncTs=Date.now();var n=[];for(var r of this.getUsers())this.userModifiedMap[r.userId]!==r.getLastModifiedTime()&&r.events.presence&&(n.push([r.userId,r.events.presence.event]),this.userModifiedMap[r.userId]=r.getLastModifiedTime());return this.backend.syncToDatabase(n)},null)),L(this,"setSyncData",this.degradable(n=>this.backend.setSyncData(n),"setSyncData")),L(this,"getOutOfBandMembers",this.degradable(n=>this.backend.getOutOfBandMembers(n),"getOutOfBandMembers")),L(this,"setOutOfBandMembers",this.degradable((n,r)=>(super.setOutOfBandMembers(n,r),this.backend.setOutOfBandMembers(n,r)),"setOutOfBandMembers")),L(this,"clearOutOfBandMembers",this.degradable(n=>(super.clearOutOfBandMembers(n),this.backend.clearOutOfBandMembers(n)),"clearOutOfBandMembers")),L(this,"getClientOptions",this.degradable(()=>this.backend.getClientOptions(),"getClientOptions")),L(this,"storeClientOptions",this.degradable(n=>(super.storeClientOptions(n),this.backend.storeClientOptions(n)),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new wge(e.workerFactory,e.dbName):this.backend=new eU(e.indexedDB,e.dbName)}on(e,n){this.emitter.on(e,n)}startup(){return this.startedUp?(O.log("IndexedDBStore.startup: already started"),Promise.resolve()):(O.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then(()=>(O.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{O.log("IndexedDBStore.startup: processing presence events"),e.forEach(n=>{var[r,i]=n;if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");var s=this.createUser(r);i&&s.setPresenceEvent(new Bi(i)),this.userModifiedMap[s.userId]=s.getLastModifiedTime(),this.storeUser(s)}),this.startedUp=!0}))}destroy(){return this.backend.destroy()}wantsSave(){var e=Date.now();return e-this.syncTs>Cge}save(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,n){var r=this,i=n?super[n]:null;return U(function*(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];try{return yield e.call(r,...o)}catch(l){O.error("IndexedDBStore failure, degrading to MemoryStore",l),r.emitter.emit("degraded",l);try{O.log("IndexedDBStore trying to delete degraded data"),yield r.backend.clearDatabase(),O.log("IndexedDBStore delete after degrading succeeded")}catch(c){O.warn("IndexedDBStore delete after degrading failed",c)}if(i)return i.call(r,...o)}})}getPendingEvents(e){var n=()=>super.getPendingEvents,r=this;return U(function*(){if(!r.localStorage)return n().call(r,e);var i=r.localStorage.getItem(UI(e));if(i)try{return JSON.parse(i)}catch(s){O.error("Could not parse persisted pending events",s)}return[]})()}setPendingEvents(e,n){var r=()=>super.setPendingEvents,i=this;return U(function*(){if(!i.localStorage)return r().call(i,e,n);n.length>0?i.localStorage.setItem(UI(e),JSON.stringify(n)):i.localStorage.removeItem(UI(e))})()}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function UI(t){return"mx_pending_events_".concat(t)}var Va="crypto.",tU=Va+"migration",jI=Va+"account",Tge=Va+"cross_signing_keys",P2=Va+"inboundgroupsessions/",Rge=Va+"inboundgroupsessions.withheld/",Ige=Va+"rooms/",$I=Va+"sessionsneedingbackup";function Dp(t){return Va+"sessions/"+t}function BI(t,e){return P2+t+"/"+e}function kge(t,e){return Rge+t+"/"+e}function xge(t){return Ige+t}class DC extends EC{static exists(e){for(var n=e.length,r=0;r<n;r++){var i;if((i=e.key(r))!==null&&i!==void 0&&i.startsWith(Va))return!0}return!1}constructor(e){super(),this.store=e}containsData(){var e=this;return U(function*(){return DC.exists(e.store)})()}getMigrationState(){var e=this;return U(function*(){var n;return(n=Ro(e.store,tU))!==null&&n!==void 0?n:sg.NOT_STARTED})()}setMigrationState(e){var n=this;return U(function*(){Ff(n.store,tU,e)})()}countEndToEndSessions(e,n){for(var r=0,i=0;i<this.store.length;++i){var s=this.store.key(i);if(s!=null&&s.startsWith(Dp(""))){var o=Ro(this.store,s);r+=Object.keys(o??{}).length}}n(r)}_getEndToEndSessions(e){var n=Ro(this.store,Dp(e)),r={};for(var[i,s]of Object.entries(n||{}))typeof s=="string"?r[i]={session:s}:r[i]=s;return r}getEndToEndSession(e,n,r,i){var s,o=this._getEndToEndSessions(e);i((s=o[n])!==null&&s!==void 0?s:{})}getEndToEndSessions(e,n,r){var i;r((i=this._getEndToEndSessions(e))!==null&&i!==void 0?i:{})}storeEndToEndSession(e,n,r,i){var s=this._getEndToEndSessions(e)||{};s[n]=r,Ff(this.store,Dp(e),s)}getEndToEndSessionsBatch(){var e=this;return U(function*(){for(var n=[],r=0;r<e.store.length;++r){var i;if((i=e.store.key(r))!==null&&i!==void 0&&i.startsWith(Dp(""))){var s=e.store.key(r).split("/")[1];for(var o of Object.values(e._getEndToEndSessions(s)))if(n.push(o),n.length>=og)return n}}return n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return U(function*(){for(var{deviceKey:r,sessionId:i}of e){var s=n._getEndToEndSessions(r)||{};delete s[i],Object.keys(s).length===0?n.store.removeItem(Dp(r)):Ff(n.store,Dp(r),s)}})()}getEndToEndInboundGroupSession(e,n,r,i){i(Ro(this.store,BI(e,n)),Ro(this.store,kge(e,n)))}storeEndToEndInboundGroupSession(e,n,r,i){Ff(this.store,BI(e,n),r)}countEndToEndInboundGroupSessions(){var e=this;return U(function*(){for(var n=0,r=0;r<e.store.length;++r){var i=e.store.key(r);i!=null&&i.startsWith(P2)&&(n+=1)}return n})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return U(function*(){for(var n=Ro(e.store,$I)||{},r=[],i=0;i<e.store.length;++i){var s=e.store.key(i);if(s!=null&&s.startsWith(P2)){var o=s.slice(P2.length);if(r.push({senderKey:o.slice(0,43),sessionId:o.slice(44),sessionData:Ro(e.store,s),needsBackup:o in n}),r.length>=og)return r}}return r.length===0?null:r})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return U(function*(){for(var{senderKey:r,sessionId:i}of e){var s=BI(r,i);n.store.removeItem(s)}})()}getEndToEndRooms(e,n){for(var r={},i=xge(""),s=0;s<this.store.length;++s){var o=this.store.key(s);if(o!=null&&o.startsWith(i)){var a=o.slice(i.length);r[a]=Ro(this.store,o)}}n(r)}markSessionsNeedingBackup(e){var n=Ro(this.store,$I)||{};for(var r of e)n[r.senderKey+"/"+r.sessionId]=!0;return Ff(this.store,$I,n),Promise.resolve()}deleteAllData(){return this.store.removeItem(jI),Promise.resolve()}getAccount(e,n){var r=Ro(this.store,jI);n(r)}storeAccount(e,n){Ff(this.store,jI,n)}getCrossSigningKeys(e,n){var r=Ro(this.store,Tge);n(r)}getSecretStorePrivateKey(e,n,r){var i=Ro(this.store,Va+"ssss_cache.".concat(r));n(i)}storeSecretStorePrivateKey(e,n,r){Ff(this.store,Va+"ssss_cache.".concat(n),r)}doTxn(e,n,r){return Promise.resolve(r(null))}}function Ro(t,e){try{return JSON.parse(t.getItem(e))}catch(n){O.log("Error: Failed to get key %s: %s",e,n.message),O.log(n.stack)}return null}function Ff(t,e,n){t.setItem(e,JSON.stringify(n))}let Pge=class{constructor(e){this.db=e,L(this,"nextTxnId",0),e.onversionchange=()=>{O.log("versionchange for indexeddb ".concat(this.db.name,": closing")),e.close()}}containsData(){return U(function*(){throw Error("Not implemented for Backend")})()}startup(){var e=this;return U(function*(){return e})()}deleteAllData(){return U(function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")})()}getMigrationState(){var e=this;return U(function*(){var n=sg.NOT_STARTED;return yield e.doTxn("readonly",[$t.STORE_ACCOUNT],r=>{var i=r.objectStore($t.STORE_ACCOUNT),s=i.get($6);s.onsuccess=()=>{var o;n=(o=s.result)!==null&&o!==void 0?o:sg.NOT_STARTED}}),n})()}setMigrationState(e){var n=this;return U(function*(){yield n.doTxn("readwrite",[$t.STORE_ACCOUNT],r=>{var i=r.objectStore($t.STORE_ACCOUNT);i.put(e,$6)})})()}getAccount(e,n){var r=e.objectStore("account"),i=r.get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){gs(e,s)}}}storeAccount(e,n){var r=e.objectStore("account");r.put(n,"-")}getCrossSigningKeys(e,n){var r=e.objectStore("account"),i=r.get("crossSigningKeys");i.onsuccess=function(){try{n(i.result||null)}catch(s){gs(e,s)}}}getSecretStorePrivateKey(e,n,r){var i=e.objectStore("account"),s=i.get("ssss_cache:".concat(r));s.onsuccess=function(){try{n(s.result||null)}catch(o){gs(e,o)}}}storeSecretStorePrivateKey(e,n,r){var i=e.objectStore("account");i.put(r,"ssss_cache:".concat(n))}countEndToEndSessions(e,n){var r=e.objectStore("sessions"),i=r.count();i.onsuccess=function(){try{n(i.result)}catch(s){gs(e,s)}}}getEndToEndSessions(e,n,r){var i=n.objectStore("sessions"),s=i.index("deviceKey"),o=s.openCursor(e),a={};o.onsuccess=function(){var l=o.result;if(l)a[l.value.sessionId]={session:l.value.session,lastReceivedMessageTs:l.value.lastReceivedMessageTs},l.continue();else try{r(a)}catch(c){gs(n,c)}}}getEndToEndSession(e,n,r,i){var s=r.objectStore("sessions"),o=s.get([e,n]);o.onsuccess=function(){try{o.result?i({session:o.result.session,lastReceivedMessageTs:o.result.lastReceivedMessageTs}):i(null)}catch(a){gs(r,a)}}}storeEndToEndSession(e,n,r,i){var s=i.objectStore("sessions");s.put({deviceKey:e,sessionId:n,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}getEndToEndSessionsBatch(){var e=this;return U(function*(){var n=[];return yield e.doTxn("readonly",[$t.STORE_SESSIONS],r=>{var i=r.objectStore($t.STORE_SESSIONS),s=i.openCursor();s.onsuccess=function(){try{var o=s.result;o&&(n.push(o.value),n.length<og&&o.continue())}catch(a){gs(r,a)}}}),n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return U(function*(){yield n.doTxn("readwrite",[$t.STORE_SESSIONS],function(){var r=U(function*(i){try{var s=i.objectStore($t.STORE_SESSIONS),o=function*(){var u=s.delete([a,l]);yield new Promise(f=>{u.onsuccess=f})};for(var{deviceKey:a,sessionId:l}of e)yield*o()}catch(c){gs(i,c)}});return function(i){return r.apply(this,arguments)}}())})()}getEndToEndInboundGroupSession(e,n,r,i){var s=!1,o=!1,a=r.objectStore("inbound_group_sessions"),l=a.get([e,n]);l.onsuccess=function(){try{l.result?s=l.result.session:s=null,o!==!1&&i(s,o)}catch(f){gs(r,f)}};var c=r.objectStore("inbound_group_sessions_withheld"),u=c.get([e,n]);u.onsuccess=function(){try{u.result?o=u.result.session:o=null,s!==!1&&i(s,o)}catch(f){gs(r,f)}}}storeEndToEndInboundGroupSession(e,n,r,i){var s=i.objectStore("inbound_group_sessions");s.put({senderCurve25519Key:e,sessionId:n,session:r})}countEndToEndInboundGroupSessions(){var e=this;return U(function*(){var n=0;return yield e.doTxn("readonly",[$t.STORE_INBOUND_GROUP_SESSIONS],r=>{var i=r.objectStore($t.STORE_INBOUND_GROUP_SESSIONS),s=i.count();s.onsuccess=()=>{n=s.result}}),n})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return U(function*(){var n=[];return yield e.doTxn("readonly",[$t.STORE_INBOUND_GROUP_SESSIONS,$t.STORE_BACKUP],r=>{var i=r.objectStore($t.STORE_INBOUND_GROUP_SESSIONS),s=r.objectStore($t.STORE_BACKUP),o=i.openCursor();o.onsuccess=function(){try{var a=o.result;if(a){var l=s.get(a.key);l.onsuccess=()=>{n.push({senderKey:a.value.senderCurve25519Key,sessionId:a.value.sessionId,sessionData:a.value.session,needsBackup:l.result!==void 0}),n.length<og&&a.continue()}}}catch(c){gs(r,c)}}}),n.length===0?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return U(function*(){yield n.doTxn("readwrite",[$t.STORE_INBOUND_GROUP_SESSIONS],function(){var r=U(function*(i){try{var s=i.objectStore($t.STORE_INBOUND_GROUP_SESSIONS),o=function*(){var u=s.delete([a,l]);yield new Promise(f=>{u.onsuccess=f})};for(var{senderKey:a,sessionId:l}of e)yield*o()}catch(c){gs(i,c)}});return function(i){return r.apply(this,arguments)}}())})()}getEndToEndDeviceData(e,n){var r=e.objectStore("device_data"),i=r.get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){gs(e,s)}}}getEndToEndRooms(e,n){var r={},i=e.objectStore("rooms"),s=i.openCursor();s.onsuccess=function(){var o=s.result;if(o)r[o.key]=o.value,o.continue();else try{n(r)}catch(a){gs(e,a)}}}markSessionsNeedingBackup(e,n){var r=this;return U(function*(){n||(n=r.db.transaction("sessions_needing_backup","readwrite"));var i=n.objectStore("sessions_needing_backup");yield Promise.all(e.map(s=>new Promise((o,a)=>{var l=i.put({senderCurve25519Key:s.senderKey,sessionId:s.sessionId});l.onsuccess=o,l.onerror=a})))})()}doTxn(e,n,r){var i=this.db.transaction(n,e),s=Oge(i),o=r(i);return s.then(()=>o)}};var Iz=[t=>{Age(t)},t=>{t.createObjectStore("account")},t=>{var e=t.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]});e.createIndex("deviceKey","deviceKey")},t=>{t.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("device_data")},t=>{t.createObjectStore("rooms")},t=>{t.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{var e=t.createObjectStore("session_problems",{keyPath:["deviceKey","time"]});e.createIndex("deviceKey","deviceKey"),t.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},t=>{t.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t=>{t.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],kz=Iz.length;function Lge(t,e){O.log("Upgrading IndexedDBCryptoStore from version ".concat(e)+" to ".concat(kz)),Iz.forEach((n,r)=>{e<=r&&n(t)})}function Age(t){var e=t.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});e.createIndex("session",["requestBody.room_id","requestBody.session_id"]),e.createIndex("state","state")}function gs(t,e){t._mx_abortexception=e;try{t.abort()}catch{}}function Oge(t){return new Promise((e,n)=>{t.oncomplete=()=>{t._mx_abortexception!==void 0&&n(t._mx_abortexception),e(null)},t.onerror=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(O.log("Error performing indexeddb txn",r),n(t.error))},t.onabort=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(O.log("Error performing indexeddb txn",r),n(t.error))}})}class $t{static exists(e,n){return wz(e,n)}static existsAndIsNotMigrated(e,n){return new Promise((r,i)=>{var s=!0,o=e.open(n);o.onupgradeneeded=()=>{s=!1},o.onblocked=()=>i(o.error),o.onsuccess=()=>{var a=o.result;if(!s)a.close(),e.deleteDatabase(n),r(!1);else{var l=a.transaction([$t.STORE_ACCOUNT],"readonly"),c=l.objectStore($t.STORE_ACCOUNT),u=c.get($6);u.onsuccess=()=>{var f,p=(f=u.result)!==null&&f!==void 0?f:sg.NOT_STARTED;r(p===sg.NOT_STARTED)},u.onerror=()=>{i(u.error)},a.close()}},o.onerror=()=>i(o.error)})}constructor(e,n){this.indexedDB=e,this.dbName=n,L(this,"backendPromise",void 0),L(this,"backend",void 0)}containsData(){var e=this;return U(function*(){return $t.exists(e.indexedDB,e.dbName)})()}startup(){return this.backendPromise?this.backendPromise:(this.backendPromise=new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}O.log("connecting to indexeddb ".concat(this.dbName));var r=this.indexedDB.open(this.dbName,kz);r.onupgradeneeded=i=>{var s=r.result,o=i.oldVersion;Lge(s,o)},r.onblocked=()=>{O.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{O.log("Error connecting to indexeddb",i),n(r.error)},r.onsuccess=()=>{var i=r.result;O.log("connected to indexeddb ".concat(this.dbName)),e(new Pge(i))}}).then(e=>e.doTxn("readonly",[$t.STORE_INBOUND_GROUP_SESSIONS,$t.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],n=>{e.getEndToEndInboundGroupSession("","",n,()=>{})}).then(()=>e)).catch(e=>{if(e.name==="VersionError")throw O.warn("Crypto DB is too new for us to use!",e),new iA(rA.TooNew);O.warn("unable to connect to indexeddb ".concat(this.dbName)+": falling back to localStorage store: ".concat(e));try{if(!(globalThis.localStorage instanceof Storage))throw new Error("localStorage is not available");return new DC(globalThis.localStorage)}catch(n){return O.warn("Unable to open localStorage: falling back to in-memory store: ".concat(n)),new EC}}).then(e=>(this.backend=e,e)),this.backendPromise)}deleteAllData(){return new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}O.log("Removing indexeddb instance: ".concat(this.dbName));var r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{O.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{O.log("Error deleting data from indexeddb",i),n(r.error)},r.onsuccess=()=>{O.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}).catch(e=>{O.warn("unable to delete IndexedDBCryptoStore: ".concat(e))})}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getAccount(e,n){this.backend.getAccount(e,n)}storeAccount(e,n){this.backend.storeAccount(e,n)}getCrossSigningKeys(e,n){this.backend.getCrossSigningKeys(e,n)}getSecretStorePrivateKey(e,n,r){this.backend.getSecretStorePrivateKey(e,n,r)}storeSecretStorePrivateKey(e,n,r){this.backend.storeSecretStorePrivateKey(e,n,r)}countEndToEndSessions(e,n){this.backend.countEndToEndSessions(e,n)}getEndToEndSession(e,n,r,i){this.backend.getEndToEndSession(e,n,r,i)}getEndToEndSessions(e,n,r){this.backend.getEndToEndSessions(e,n,r)}storeEndToEndSession(e,n,r,i){this.backend.storeEndToEndSession(e,n,r,i)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,n,r,i){this.backend.getEndToEndInboundGroupSession(e,n,r,i)}storeEndToEndInboundGroupSession(e,n,r,i){this.backend.storeEndToEndInboundGroupSession(e,n,r,i)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}getEndToEndRooms(e,n){this.backend.getEndToEndRooms(e,n)}markSessionsNeedingBackup(e,n){return this.backend.markSessionsNeedingBackup(e,n)}doTxn(e,n,r,i){return this.backend.doTxn(e,n,r,i)}}L($t,"STORE_ACCOUNT","account");L($t,"STORE_SESSIONS","sessions");L($t,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions");L($t,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld");L($t,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions");L($t,"STORE_PARKED_SHARED_HISTORY","parked_shared_history");L($t,"STORE_DEVICE_DATA","device_data");L($t,"STORE_ROOMS","rooms");L($t,"STORE_BACKUP","sessions_needing_backup");var Mge=function(t){return t.Email="email",t.Phone="msisdn",t}({}),Nge=new wr("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility"),Dge=function(t){return t.Gitlab="gitlab",t.Github="github",t.Apple="apple",t.Google="google",t.Facebook="facebook",t.Twitter="twitter",t}({}),Fge=function(t){return t.LOGIN="login",t.REGISTER="register",t}({}),Uge="us.cloke.msc4175.tz";class jge{constructor(e){L(this,"relations",void 0),this.relations=e.filter(n=>!!n)}getRelations(){return this.relations.reduce((e,n)=>[...e,...n.getRelations()],[])}on(e,n){this.relations.forEach(r=>r.on(e,n))}off(e,n){this.relations.forEach(r=>r.off(e,n))}}var $ge=function(t){return t.Global="Global",t.SetItemError="setItem",t.GetItemError="getItem",t.RemoveItemError="removeItem",t.ClearError="clear",t.QuotaExceededError="QuotaExceededError",t}({});class Bge extends Un{}var Hge=new Bge,xz=()=>new EC;function Pz(t){xz=t}function Lz(t){var e,n,r;return t.store=(e=t.store)!==null&&e!==void 0?e:new iy({localStorage:globalThis.localStorage}),t.scheduler=(n=t.scheduler)!==null&&n!==void 0?n:new ag,t.cryptoStore=(r=t.cryptoStore)!==null&&r!==void 0?r:xz(),t}function FC(t){return new NC(Lz(t))}function Az(t,e,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return new _z(t,e,n,Lz(r),i)}const Vge=Object.freeze(Object.defineProperty({__proto__:null,AuthType:Tx,AutoDiscovery:dt,AutoDiscoveryAction:io,AutoDiscoveryError:ra,Beacon:_W,BeaconEvent:Mn,CallEvent:yt,CallFeedEvent:vl,Category:gc,ClientEvent:Ae,ClientPrefix:Hr,ClientStoppedError:yme,ConditionKind:xr,ConditionOperator:$pe,ConnectionError:Vh,ContentHelpers:_he,DELEGATED_OIDC_COMPATIBILITY:Nge,DEVICE_CODE_SCOPE:Qme,DMMemberCountCondition:Bpe,Device:yge,DeviceVerification:Sz,Direction:_t,DuplicateStrategy:f1,EVENT_VISIBILITY_CHANGE_TYPE:th,EventEmitterEvents:qK,EventStatus:at,EventTimeline:Le,EventTimelineSet:fm,EventType:ee,FILTER_RELATED_BY_REL_TYPES:Lm,FILTER_RELATED_BY_SENDERS:Pm,FeatureSupport:ji,Filter:Es,GET_LOGIN_TOKEN_CAPABILITY:sge,GroupCall:XL,GroupCallEvent:gn,GroupCallIntent:$W,GroupCallState:Jn,GroupCallStatsReportEvent:Q0,GroupCallType:xC,GuestAccess:VE,HTTPError:Fd,HistoryVisibility:QL,HttpApiEvent:X6,IdentityPrefix:mc,IdentityProviderBrand:Dge,IndexedDBCryptoStore:$t,IndexedDBStore:Rz,InteractiveAuth:dA,InvalidCryptoStoreError:iA,InvalidCryptoStoreState:rA,JoinRule:Td,KNOWN_SAFE_ROOM_VERSION:LW,KeySignatureUploadError:vme,KnownMembership:qe,LOCAL_NOTIFICATION_SETTINGS_PREFIX:YK,LocalStorageCryptoStore:DC,LocalStorageErrors:$ge,LocationAssetType:ig,MAIN_ROOM_TIMELINE:Jy,MAXIMUM_MATRIX_VERSION:zpe,MINIMUM_MATRIX_VERSION:Wpe,MSC3912_RELATION_BASED_REDACTIONS_PROP:q6,M_ASSET:Yy,M_BEACON:cx,M_BEACON_INFO:eA,M_HTML:fhe,M_LOCATION:Xy,M_MESSAGE:dhe,M_POLL_END:BE,M_POLL_KIND_DISCLOSED:She,M_POLL_KIND_UNDISCLOSED:Ehe,M_POLL_RESPONSE:Z1,M_POLL_START:whe,M_TEXT:$L,M_TIMESTAMP:tf,M_TOPIC:BL,MatrixClient:NC,MatrixError:Nn,MatrixEvent:Bi,MatrixEventEvent:Ht,MatrixHttpApi:kW,MatrixScheduler:ag,MediaHandlerEvent:Kf,MediaPrefix:Tm,MemoryCryptoStore:EC,MemoryStore:iy,Method:le,MsgType:ql,NoAuthFlowFoundError:Ez,NotificationCountType:Kt,OidcError:$i,OidcTokenRefresher:tge,PUSHER_DEVICE_ID:Xfe,PUSHER_ENABLED:K6,PendingEventOrdering:cg,Poll:EW,PollEvent:rd,Preset:LC,ProfileKeyMSC4175Timezone:Uge,PushRuleActionName:Cd,PushRuleKind:ui,REFERENCE_RELATION:lW,ReceiptType:Ji,RelatedRelations:jge,RelationType:Tn,Relations:jL,RelationsEvent:S2,RestrictedAllowType:Xpe,Room:IC,RoomCreateTypeField:FE,RoomEvent:xe,RoomMember:Y1,RoomMemberEvent:Is,RoomNameType:gl,RoomState:ry,RoomStateEvent:gt,RoomSummary:oW,RoomType:Cm,RoomVersionStability:xW,RoomWidgetClient:_z,RoomWidgetClientEvent:x2,RuleId:ci,SERVICE_TYPES:ax,SSOAction:Fge,SUPPORTED_MATRIX_VERSIONS:ey,SearchOrderBy:VW,SearchResult:PC,SecretStorage:mme,ServerCapabilities:PW,SetPresence:AW,SlidingSyncEvent:lx,StatsReport:Uc,SyncAccumulator:bz,SyncState:qt,THREAD_RELATION_TYPE:cn,Thread:Rn,ThreadEvent:Zi,ThreadFilterType:Ra,ThreepidMedium:Mge,TimelineIndex:Cx,TimelineWindow:bge,ToDeviceMessageId:TC,TokenRefreshError:RW,TokenRefreshLogoutError:GL,TweakName:JL,TypedEventEmitter:Un,UNSIGNED_MEMBERSHIP_FIELD:XK,UNSIGNED_THREAD_ID_FIELD:UE,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:zK,UNSTABLE_MSC2666_MUTUAL_ROOMS:dz,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:fz,UNSTABLE_MSC2666_SHARED_ROOMS:uz,UNSTABLE_MSC2716_MARKER:WK,UNSTABLE_MSC3088_ENABLED:V6,UNSTABLE_MSC3088_PURPOSE:H6,UNSTABLE_MSC3089_BRANCH:Pc,UNSTABLE_MSC3089_LEAF:KK,UNSTABLE_MSC3089_TREE_SUBTYPE:G6,UNSTABLE_MSC3852_LAST_SEEN_UA:ige,UNSTABLE_MSC4133_EXTENDED_PROFILES:hz,UNSTABLE_MSC4140_DELAYED_EVENTS:Il,UnsupportedDelayedEventsEndpointError:md,UpdateDelayedEventAction:lh,User:Hc,UserEvent:Si,Visibility:HW,anySignal:IW,calculateRetryBackoff:KL,completeAuthorizationCodeGrant:Zme,createClient:FC,createNewMatrixCall:Q1,createRoomWidgetClient:Az,decodeBase64:Rm,decodeIdToken:oz,determineFeatureSupport:I2,discoverAndValidateOIDCIssuerWellKnown:cA,encodeBase64:E2,encodeUnpaddedBase64:FW,encodeUnpaddedBase64Url:kC,fixNotificationCountOnDecryption:pz,generateAuthorizationParams:zme,generateAuthorizationUrl:Yme,generateOidcAuthorizationUrl:Xme,generateScope:MC,getBeaconInfoIdentifier:$E,getHttpUriForMxc:wC,inMainTimelineForReceipt:ny,isDmMemberCountCondition:Hpe,isEventTypeSame:hhe,isPollEvent:wW,isTimestampInDuration:z6,localStorageErrorsEventsEmitter:Hge,parseErrorResponse:qL,registerOidcClient:ege,retryNetworkOperation:J6,safeGetRetryAfterMs:VL,setCryptoStoreFactory:Pz,threadFilterTypeToFilter:mz,threadIdForReceipt:ug,timeoutSignal:RC,validateAuthMetadata:sz,validateAuthMetadataAndKeys:uA,validateBearerTokenResponse:cz,validateIdToken:az,validateStoredUserState:lz},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");globalThis.__js_sdk_entrypoint=!0;var Rx;try{Rx=globalThis.indexedDB}catch{}Rx&&Pz(()=>new $t(Rx,"matrix-js-sdk:crypto"));globalThis.matrixcs=Vge;var _=OL();const Se=Xa(_),Oz=gfe({__proto__:null,default:Se},[_]);var uS={},HI={exports:{}},vs={},VI={exports:{}},GI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nU;function Gge(){return nU||(nU=1,function(t){function e(V,q){var Z=V.length;V.push(q);e:for(;0<Z;){var G=Z-1>>>1,Q=V[G];if(0<i(Q,q))V[G]=q,V[Z]=Q,Z=G;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var q=V[0],Z=V.pop();if(Z!==q){V[0]=Z;e:for(var G=0,Q=V.length,ge=Q>>>1;G<ge;){var _e=2*(G+1)-1,Pe=V[_e],Te=_e+1,Re=V[Te];if(0>i(Pe,Z))Te<Q&&0>i(Re,Pe)?(V[G]=Re,V[Te]=Z,G=Te):(V[G]=Pe,V[_e]=Z,G=_e);else if(Te<Q&&0>i(Re,Z))V[G]=Re,V[Te]=Z,G=Te;else break e}}return q}function i(V,q){var Z=V.sortIndex-q.sortIndex;return Z!==0?Z:V.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,p=3,m=!1,v=!1,g=!1,S=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(V){for(var q=n(c);q!==null;){if(q.callback===null)r(c);else if(q.startTime<=V)r(c),q.sortIndex=q.expirationTime,e(l,q);else break;q=n(c)}}function T(V){if(g=!1,k(V),!v)if(n(l)!==null)v=!0,z(I);else{var q=n(c);q!==null&&K(T,q.startTime-V)}}function I(V,q){v=!1,g&&(g=!1,b(A),A=-1),m=!0;var Z=p;try{for(k(q),f=n(l);f!==null&&(!(f.expirationTime>q)||V&&!F());){var G=f.callback;if(typeof G=="function"){f.callback=null,p=f.priorityLevel;var Q=G(f.expirationTime<=q);q=t.unstable_now(),typeof Q=="function"?f.callback=Q:f===n(l)&&r(l),k(q)}else r(l);f=n(l)}if(f!==null)var ge=!0;else{var _e=n(c);_e!==null&&K(T,_e.startTime-q),ge=!1}return ge}finally{f=null,p=Z,m=!1}}var C=!1,x=null,A=-1,N=5,D=-1;function F(){return!(t.unstable_now()-D<N)}function $(){if(x!==null){var V=t.unstable_now();D=V;var q=!0;try{q=x(!0,V)}finally{q?B():(C=!1,x=null)}}else C=!1}var B;if(typeof w=="function")B=function(){w($)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,H=W.port2;W.port1.onmessage=$,B=function(){H.postMessage(null)}}else B=function(){S($,0)};function z(V){x=V,C||(C=!0,B())}function K(V,q){A=S(function(){V(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){v||m||(v=!0,z(I))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(V){switch(p){case 1:case 2:case 3:var q=3;break;default:q=p}var Z=p;p=q;try{return V()}finally{p=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,q){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Z=p;p=V;try{return q()}finally{p=Z}},t.unstable_scheduleCallback=function(V,q,Z){var G=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?G+Z:G):Z=G,V){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=Z+Q,V={id:u++,callback:q,priorityLevel:V,startTime:Z,expirationTime:Q,sortIndex:-1},Z>G?(V.sortIndex=Z,e(c,V),n(l)===null&&V===n(c)&&(g?(b(A),A=-1):g=!0,K(T,Z-G))):(V.sortIndex=Q,e(l,V),v||m||(v=!0,z(I))),V},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(V){var q=p;return function(){var Z=p;p=q;try{return V.apply(this,arguments)}finally{p=Z}}}}(GI)),GI}var rU;function qge(){return rU||(rU=1,VI.exports=Gge()),VI.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iU;function Kge(){if(iU)return vs;iU=1;var t=OL(),e=qge();function n(d){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+d,y=1;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(d,h){o(d,h),o(d+"Capture",h)}function o(d,h){for(i[d]=h,d=0;d<h.length;d++)r.add(h[d])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},f={};function p(d){return l.call(f,d)?!0:l.call(u,d)?!1:c.test(d)?f[d]=!0:(u[d]=!0,!1)}function m(d,h,y,R){if(y!==null&&y.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return R?!1:y!==null?!y.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function v(d,h,y,R){if(h===null||typeof h>"u"||m(d,h,y,R))return!0;if(R)return!1;if(y!==null)switch(y.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function g(d,h,y,R,P,M,j){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=R,this.attributeNamespace=P,this.mustUseProperty=y,this.propertyName=d,this.type=h,this.sanitizeURL=M,this.removeEmptyString=j}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){S[d]=new g(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var h=d[0];S[h]=new g(h,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){S[d]=new g(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){S[d]=new g(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){S[d]=new g(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){S[d]=new g(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){S[d]=new g(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){S[d]=new g(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){S[d]=new g(d,5,!1,d.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function w(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var h=d.replace(b,w);S[h]=new g(h,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var h=d.replace(b,w);S[h]=new g(h,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var h=d.replace(b,w);S[h]=new g(h,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){S[d]=new g(d,1,!1,d.toLowerCase(),null,!1,!1)}),S.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){S[d]=new g(d,1,!1,d.toLowerCase(),null,!0,!0)});function k(d,h,y,R){var P=S.hasOwnProperty(h)?S[h]:null;(P!==null?P.type!==0:R||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(v(h,y,P,R)&&(y=null),R||P===null?p(h)&&(y===null?d.removeAttribute(h):d.setAttribute(h,""+y)):P.mustUseProperty?d[P.propertyName]=y===null?P.type===3?!1:"":y:(h=P.attributeName,R=P.attributeNamespace,y===null?d.removeAttribute(h):(P=P.type,y=P===3||P===4&&y===!0?"":""+y,R?d.setAttributeNS(R,h,y):d.setAttribute(h,y))))}var T=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I=Symbol.for("react.element"),C=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),F=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),V=Symbol.iterator;function q(d){return d===null||typeof d!="object"?null:(d=V&&d[V]||d["@@iterator"],typeof d=="function"?d:null)}var Z=Object.assign,G;function Q(d){if(G===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);G=h&&h[1]||""}return`
`+G+d}var ge=!1;function _e(d,h){if(!d||ge)return"";ge=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(oe){var R=oe}Reflect.construct(d,[],h)}else{try{h.call()}catch(oe){R=oe}d.call(h.prototype)}else{try{throw Error()}catch(oe){R=oe}d()}}catch(oe){if(oe&&R&&typeof oe.stack=="string"){for(var P=oe.stack.split(`
`),M=R.stack.split(`
`),j=P.length-1,Y=M.length-1;1<=j&&0<=Y&&P[j]!==M[Y];)Y--;for(;1<=j&&0<=Y;j--,Y--)if(P[j]!==M[Y]){if(j!==1||Y!==1)do if(j--,Y--,0>Y||P[j]!==M[Y]){var J=`
`+P[j].replace(" at new "," at ");return d.displayName&&J.includes("<anonymous>")&&(J=J.replace("<anonymous>",d.displayName)),J}while(1<=j&&0<=Y);break}}}finally{ge=!1,Error.prepareStackTrace=y}return(d=d?d.displayName||d.name:"")?Q(d):""}function Pe(d){switch(d.tag){case 5:return Q(d.type);case 16:return Q("Lazy");case 13:return Q("Suspense");case 19:return Q("SuspenseList");case 0:case 2:case 15:return d=_e(d.type,!1),d;case 11:return d=_e(d.type.render,!1),d;case 1:return d=_e(d.type,!0),d;default:return""}}function Te(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case x:return"Fragment";case C:return"Portal";case N:return"Profiler";case A:return"StrictMode";case B:return"Suspense";case W:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case F:return(d.displayName||"Context")+".Consumer";case D:return(d._context.displayName||"Context")+".Provider";case $:var h=d.render;return d=d.displayName,d||(d=h.displayName||h.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case H:return h=d.displayName||null,h!==null?h:Te(d.type)||"Memo";case z:h=d._payload,d=d._init;try{return Te(d(h))}catch{}}return null}function Re(d){var h=d.type;switch(d.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=h.render,d=d.displayName||d.name||"",h.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Te(h);case 8:return h===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function we(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ve(d){var h=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function We(d){var h=ve(d)?"checked":"value",y=Object.getOwnPropertyDescriptor(d.constructor.prototype,h),R=""+d[h];if(!d.hasOwnProperty(h)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var P=y.get,M=y.set;return Object.defineProperty(d,h,{configurable:!0,get:function(){return P.call(this)},set:function(j){R=""+j,M.call(this,j)}}),Object.defineProperty(d,h,{enumerable:y.enumerable}),{getValue:function(){return R},setValue:function(j){R=""+j},stopTracking:function(){d._valueTracker=null,delete d[h]}}}}function pn(d){d._valueTracker||(d._valueTracker=We(d))}function hr(d){if(!d)return!1;var h=d._valueTracker;if(!h)return!0;var y=h.getValue(),R="";return d&&(R=ve(d)?d.checked?"true":"false":d.value),d=R,d!==y?(h.setValue(d),!0):!1}function Ft(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function ze(d,h){var y=h.checked;return Z({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??d._wrapperState.initialChecked})}function Fr(d,h){var y=h.defaultValue==null?"":h.defaultValue,R=h.checked!=null?h.checked:h.defaultChecked;y=we(h.value!=null?h.value:y),d._wrapperState={initialChecked:R,initialValue:y,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function Tr(d,h){h=h.checked,h!=null&&k(d,"checked",h,!1)}function Ki(d,h){Tr(d,h);var y=we(h.value),R=h.type;if(y!=null)R==="number"?(y===0&&d.value===""||d.value!=y)&&(d.value=""+y):d.value!==""+y&&(d.value=""+y);else if(R==="submit"||R==="reset"){d.removeAttribute("value");return}h.hasOwnProperty("value")?Bs(d,h.type,y):h.hasOwnProperty("defaultValue")&&Bs(d,h.type,we(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(d.defaultChecked=!!h.defaultChecked)}function nc(d,h,y){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var R=h.type;if(!(R!=="submit"&&R!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+d._wrapperState.initialValue,y||h===d.value||(d.value=h),d.defaultValue=h}y=d.name,y!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,y!==""&&(d.name=y)}function Bs(d,h,y){(h!=="number"||Ft(d.ownerDocument)!==d)&&(y==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+y&&(d.defaultValue=""+y))}var Pi=Array.isArray;function la(d,h,y,R){if(d=d.options,h){h={};for(var P=0;P<y.length;P++)h["$"+y[P]]=!0;for(y=0;y<d.length;y++)P=h.hasOwnProperty("$"+d[y].value),d[y].selected!==P&&(d[y].selected=P),P&&R&&(d[y].defaultSelected=!0)}else{for(y=""+we(y),h=null,P=0;P<d.length;P++){if(d[P].value===y){d[P].selected=!0,R&&(d[P].defaultSelected=!0);return}h!==null||d[P].disabled||(h=d[P])}h!==null&&(h.selected=!0)}}function _u(d,h){if(h.dangerouslySetInnerHTML!=null)throw Error(n(91));return Z({},h,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Hs(d,h){var y=h.value;if(y==null){if(y=h.children,h=h.defaultValue,y!=null){if(h!=null)throw Error(n(92));if(Pi(y)){if(1<y.length)throw Error(n(93));y=y[0]}h=y}h==null&&(h=""),y=h}d._wrapperState={initialValue:we(y)}}function vf(d,h){var y=we(h.value),R=we(h.defaultValue);y!=null&&(y=""+y,y!==d.value&&(d.value=y),h.defaultValue==null&&d.defaultValue!==y&&(d.defaultValue=y)),R!=null&&(d.defaultValue=""+R)}function bu(d){var h=d.textContent;h===d._wrapperState.initialValue&&h!==""&&h!==null&&(d.value=h)}function yf(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nl(d,h){return d==null||d==="http://www.w3.org/1999/xhtml"?yf(h):d==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var yo,sp=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,y,R,P){MSApp.execUnsafeLocalFunction(function(){return d(h,y,R,P)})}:d}(function(d,h){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=h;else{for(yo=yo||document.createElement("div"),yo.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=yo.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;h.firstChild;)d.appendChild(h.firstChild)}});function rl(d,h){if(h){var y=d.firstChild;if(y&&y===d.lastChild&&y.nodeType===3){y.nodeValue=h;return}}d.textContent=h}var rc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ic=["Webkit","ms","Moz","O"];Object.keys(rc).forEach(function(d){ic.forEach(function(h){h=h+d.charAt(0).toUpperCase()+d.substring(1),rc[h]=rc[d]})});function Vs(d,h,y){return h==null||typeof h=="boolean"||h===""?"":y||typeof h!="number"||h===0||rc.hasOwnProperty(d)&&rc[d]?(""+h).trim():h+"px"}function op(d,h){d=d.style;for(var y in h)if(h.hasOwnProperty(y)){var R=y.indexOf("--")===0,P=Vs(y,h[y],R);y==="float"&&(y="cssFloat"),R?d.setProperty(y,P):d[y]=P}}var ct=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mn(d,h){if(h){if(ct[d]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(n(137,d));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(n(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(n(61))}if(h.style!=null&&typeof h.style!="object")throw Error(n(62))}}function jn(d,h){if(d.indexOf("-")===-1)return typeof h.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ca=null;function tt(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Tt=null,It=null,Et=null;function wn(d){if(d=Vv(d)){if(typeof Tt!="function")throw Error(n(280));var h=d.stateNode;h&&(h=db(h),Tt(d.stateNode,d.type,h))}}function Ur(d){It?Et?Et.push(d):Et=[d]:It=d}function Rr(){if(It){var d=It,h=Et;if(Et=It=null,wn(d),h)for(d=0;d<h.length;d++)wn(h[d])}}function ua(d,h){return d(h)}function us(){}var da=!1;function fa(d,h,y){if(da)return d(h,y);da=!0;try{return ua(d,h,y)}finally{da=!1,(It!==null||Et!==null)&&(us(),Rr())}}function Li(d,h){var y=d.stateNode;if(y===null)return null;var R=db(y);if(R===null)return null;y=R[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(d=d.type,R=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!R;break e;default:d=!1}if(d)return null;if(y&&typeof y!="function")throw Error(n(231,h,typeof y));return y}var Su=!1;if(a)try{var Eu={};Object.defineProperty(Eu,"passive",{get:function(){Su=!0}}),window.addEventListener("test",Eu,Eu),window.removeEventListener("test",Eu,Eu)}catch{Su=!1}function Eue(d,h,y,R,P,M,j,Y,J){var oe=Array.prototype.slice.call(arguments,3);try{h.apply(y,oe)}catch(me){this.onError(me)}}var Cv=!1,V_=null,G_=!1,L3=null,wue={onError:function(d){Cv=!0,V_=d}};function Cue(d,h,y,R,P,M,j,Y,J){Cv=!1,V_=null,Eue.apply(wue,arguments)}function Tue(d,h,y,R,P,M,j,Y,J){if(Cue.apply(this,arguments),Cv){if(Cv){var oe=V_;Cv=!1,V_=null}else throw Error(n(198));G_||(G_=!0,L3=oe)}}function _f(d){var h=d,y=d;if(d.alternate)for(;h.return;)h=h.return;else{d=h;do h=d,(h.flags&4098)!==0&&(y=h.return),d=h.return;while(d)}return h.tag===3?y:null}function C9(d){if(d.tag===13){var h=d.memoizedState;if(h===null&&(d=d.alternate,d!==null&&(h=d.memoizedState)),h!==null)return h.dehydrated}return null}function T9(d){if(_f(d)!==d)throw Error(n(188))}function Rue(d){var h=d.alternate;if(!h){if(h=_f(d),h===null)throw Error(n(188));return h!==d?null:d}for(var y=d,R=h;;){var P=y.return;if(P===null)break;var M=P.alternate;if(M===null){if(R=P.return,R!==null){y=R;continue}break}if(P.child===M.child){for(M=P.child;M;){if(M===y)return T9(P),d;if(M===R)return T9(P),h;M=M.sibling}throw Error(n(188))}if(y.return!==R.return)y=P,R=M;else{for(var j=!1,Y=P.child;Y;){if(Y===y){j=!0,y=P,R=M;break}if(Y===R){j=!0,R=P,y=M;break}Y=Y.sibling}if(!j){for(Y=M.child;Y;){if(Y===y){j=!0,y=M,R=P;break}if(Y===R){j=!0,R=M,y=P;break}Y=Y.sibling}if(!j)throw Error(n(189))}}if(y.alternate!==R)throw Error(n(190))}if(y.tag!==3)throw Error(n(188));return y.stateNode.current===y?d:h}function R9(d){return d=Rue(d),d!==null?I9(d):null}function I9(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var h=I9(d);if(h!==null)return h;d=d.sibling}return null}var k9=e.unstable_scheduleCallback,x9=e.unstable_cancelCallback,Iue=e.unstable_shouldYield,kue=e.unstable_requestPaint,pr=e.unstable_now,xue=e.unstable_getCurrentPriorityLevel,A3=e.unstable_ImmediatePriority,P9=e.unstable_UserBlockingPriority,q_=e.unstable_NormalPriority,Pue=e.unstable_LowPriority,L9=e.unstable_IdlePriority,K_=null,il=null;function Lue(d){if(il&&typeof il.onCommitFiberRoot=="function")try{il.onCommitFiberRoot(K_,d,void 0,(d.current.flags&128)===128)}catch{}}var ha=Math.clz32?Math.clz32:Mue,Aue=Math.log,Oue=Math.LN2;function Mue(d){return d>>>=0,d===0?32:31-(Aue(d)/Oue|0)|0}var W_=64,z_=4194304;function Tv(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Y_(d,h){var y=d.pendingLanes;if(y===0)return 0;var R=0,P=d.suspendedLanes,M=d.pingedLanes,j=y&268435455;if(j!==0){var Y=j&~P;Y!==0?R=Tv(Y):(M&=j,M!==0&&(R=Tv(M)))}else j=y&~P,j!==0?R=Tv(j):M!==0&&(R=Tv(M));if(R===0)return 0;if(h!==0&&h!==R&&(h&P)===0&&(P=R&-R,M=h&-h,P>=M||P===16&&(M&4194240)!==0))return h;if((R&4)!==0&&(R|=y&16),h=d.entangledLanes,h!==0)for(d=d.entanglements,h&=R;0<h;)y=31-ha(h),P=1<<y,R|=d[y],h&=~P;return R}function Nue(d,h){switch(d){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Due(d,h){for(var y=d.suspendedLanes,R=d.pingedLanes,P=d.expirationTimes,M=d.pendingLanes;0<M;){var j=31-ha(M),Y=1<<j,J=P[j];J===-1?((Y&y)===0||(Y&R)!==0)&&(P[j]=Nue(Y,h)):J<=h&&(d.expiredLanes|=Y),M&=~Y}}function O3(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function A9(){var d=W_;return W_<<=1,(W_&4194240)===0&&(W_=64),d}function M3(d){for(var h=[],y=0;31>y;y++)h.push(d);return h}function Rv(d,h,y){d.pendingLanes|=h,h!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,h=31-ha(h),d[h]=y}function Fue(d,h){var y=d.pendingLanes&~h;d.pendingLanes=h,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=h,d.mutableReadLanes&=h,d.entangledLanes&=h,h=d.entanglements;var R=d.eventTimes;for(d=d.expirationTimes;0<y;){var P=31-ha(y),M=1<<P;h[P]=0,R[P]=-1,d[P]=-1,y&=~M}}function N3(d,h){var y=d.entangledLanes|=h;for(d=d.entanglements;y;){var R=31-ha(y),P=1<<R;P&h|d[R]&h&&(d[R]|=h),y&=~P}}var on=0;function O9(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var M9,D3,N9,D9,F9,F3=!1,X_=[],wu=null,Cu=null,Tu=null,Iv=new Map,kv=new Map,Ru=[],Uue="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function U9(d,h){switch(d){case"focusin":case"focusout":wu=null;break;case"dragenter":case"dragleave":Cu=null;break;case"mouseover":case"mouseout":Tu=null;break;case"pointerover":case"pointerout":Iv.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":kv.delete(h.pointerId)}}function xv(d,h,y,R,P,M){return d===null||d.nativeEvent!==M?(d={blockedOn:h,domEventName:y,eventSystemFlags:R,nativeEvent:M,targetContainers:[P]},h!==null&&(h=Vv(h),h!==null&&D3(h)),d):(d.eventSystemFlags|=R,h=d.targetContainers,P!==null&&h.indexOf(P)===-1&&h.push(P),d)}function jue(d,h,y,R,P){switch(h){case"focusin":return wu=xv(wu,d,h,y,R,P),!0;case"dragenter":return Cu=xv(Cu,d,h,y,R,P),!0;case"mouseover":return Tu=xv(Tu,d,h,y,R,P),!0;case"pointerover":var M=P.pointerId;return Iv.set(M,xv(Iv.get(M)||null,d,h,y,R,P)),!0;case"gotpointercapture":return M=P.pointerId,kv.set(M,xv(kv.get(M)||null,d,h,y,R,P)),!0}return!1}function j9(d){var h=bf(d.target);if(h!==null){var y=_f(h);if(y!==null){if(h=y.tag,h===13){if(h=C9(y),h!==null){d.blockedOn=h,F9(d.priority,function(){N9(y)});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){d.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}d.blockedOn=null}function J_(d){if(d.blockedOn!==null)return!1;for(var h=d.targetContainers;0<h.length;){var y=j3(d.domEventName,d.eventSystemFlags,h[0],d.nativeEvent);if(y===null){y=d.nativeEvent;var R=new y.constructor(y.type,y);ca=R,y.target.dispatchEvent(R),ca=null}else return h=Vv(y),h!==null&&D3(h),d.blockedOn=y,!1;h.shift()}return!0}function $9(d,h,y){J_(d)&&y.delete(h)}function $ue(){F3=!1,wu!==null&&J_(wu)&&(wu=null),Cu!==null&&J_(Cu)&&(Cu=null),Tu!==null&&J_(Tu)&&(Tu=null),Iv.forEach($9),kv.forEach($9)}function Pv(d,h){d.blockedOn===h&&(d.blockedOn=null,F3||(F3=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,$ue)))}function Lv(d){function h(P){return Pv(P,d)}if(0<X_.length){Pv(X_[0],d);for(var y=1;y<X_.length;y++){var R=X_[y];R.blockedOn===d&&(R.blockedOn=null)}}for(wu!==null&&Pv(wu,d),Cu!==null&&Pv(Cu,d),Tu!==null&&Pv(Tu,d),Iv.forEach(h),kv.forEach(h),y=0;y<Ru.length;y++)R=Ru[y],R.blockedOn===d&&(R.blockedOn=null);for(;0<Ru.length&&(y=Ru[0],y.blockedOn===null);)j9(y),y.blockedOn===null&&Ru.shift()}var ap=T.ReactCurrentBatchConfig,Z_=!0;function Bue(d,h,y,R){var P=on,M=ap.transition;ap.transition=null;try{on=1,U3(d,h,y,R)}finally{on=P,ap.transition=M}}function Hue(d,h,y,R){var P=on,M=ap.transition;ap.transition=null;try{on=4,U3(d,h,y,R)}finally{on=P,ap.transition=M}}function U3(d,h,y,R){if(Z_){var P=j3(d,h,y,R);if(P===null)nR(d,h,R,Q_,y),U9(d,R);else if(jue(P,d,h,y,R))R.stopPropagation();else if(U9(d,R),h&4&&-1<Uue.indexOf(d)){for(;P!==null;){var M=Vv(P);if(M!==null&&M9(M),M=j3(d,h,y,R),M===null&&nR(d,h,R,Q_,y),M===P)break;P=M}P!==null&&R.stopPropagation()}else nR(d,h,R,null,y)}}var Q_=null;function j3(d,h,y,R){if(Q_=null,d=tt(R),d=bf(d),d!==null)if(h=_f(d),h===null)d=null;else if(y=h.tag,y===13){if(d=C9(h),d!==null)return d;d=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;d=null}else h!==d&&(d=null);return Q_=d,null}function B9(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xue()){case A3:return 1;case P9:return 4;case q_:case Pue:return 16;case L9:return 536870912;default:return 16}default:return 16}}var Iu=null,$3=null,eb=null;function H9(){if(eb)return eb;var d,h=$3,y=h.length,R,P="value"in Iu?Iu.value:Iu.textContent,M=P.length;for(d=0;d<y&&h[d]===P[d];d++);var j=y-d;for(R=1;R<=j&&h[y-R]===P[M-R];R++);return eb=P.slice(d,1<R?1-R:void 0)}function tb(d){var h=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&h===13&&(d=13)):d=h,d===10&&(d=13),32<=d||d===13?d:0}function nb(){return!0}function V9(){return!1}function Gs(d){function h(y,R,P,M,j){this._reactName=y,this._targetInst=P,this.type=R,this.nativeEvent=M,this.target=j,this.currentTarget=null;for(var Y in d)d.hasOwnProperty(Y)&&(y=d[Y],this[Y]=y?y(M):M[Y]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?nb:V9,this.isPropagationStopped=V9,this}return Z(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=nb)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=nb)},persist:function(){},isPersistent:nb}),h}var lp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},B3=Gs(lp),Av=Z({},lp,{view:0,detail:0}),Vue=Gs(Av),H3,V3,Ov,rb=Z({},Av,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:q3,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Ov&&(Ov&&d.type==="mousemove"?(H3=d.screenX-Ov.screenX,V3=d.screenY-Ov.screenY):V3=H3=0,Ov=d),H3)},movementY:function(d){return"movementY"in d?d.movementY:V3}}),G9=Gs(rb),Gue=Z({},rb,{dataTransfer:0}),que=Gs(Gue),Kue=Z({},Av,{relatedTarget:0}),G3=Gs(Kue),Wue=Z({},lp,{animationName:0,elapsedTime:0,pseudoElement:0}),zue=Gs(Wue),Yue=Z({},lp,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Xue=Gs(Yue),Jue=Z({},lp,{data:0}),q9=Gs(Jue),Zue={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Que={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ede={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tde(d){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(d):(d=ede[d])?!!h[d]:!1}function q3(){return tde}var nde=Z({},Av,{key:function(d){if(d.key){var h=Zue[d.key]||d.key;if(h!=="Unidentified")return h}return d.type==="keypress"?(d=tb(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Que[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:q3,charCode:function(d){return d.type==="keypress"?tb(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?tb(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),rde=Gs(nde),ide=Z({},rb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),K9=Gs(ide),sde=Z({},Av,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:q3}),ode=Gs(sde),ade=Z({},lp,{propertyName:0,elapsedTime:0,pseudoElement:0}),lde=Gs(ade),cde=Z({},rb,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),ude=Gs(cde),dde=[9,13,27,32],K3=a&&"CompositionEvent"in window,Mv=null;a&&"documentMode"in document&&(Mv=document.documentMode);var fde=a&&"TextEvent"in window&&!Mv,W9=a&&(!K3||Mv&&8<Mv&&11>=Mv),z9=" ",Y9=!1;function X9(d,h){switch(d){case"keyup":return dde.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function J9(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var cp=!1;function hde(d,h){switch(d){case"compositionend":return J9(h);case"keypress":return h.which!==32?null:(Y9=!0,z9);case"textInput":return d=h.data,d===z9&&Y9?null:d;default:return null}}function pde(d,h){if(cp)return d==="compositionend"||!K3&&X9(d,h)?(d=H9(),eb=$3=Iu=null,cp=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return W9&&h.locale!=="ko"?null:h.data;default:return null}}var mde={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Z9(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h==="input"?!!mde[d.type]:h==="textarea"}function Q9(d,h,y,R){Ur(R),h=lb(h,"onChange"),0<h.length&&(y=new B3("onChange","change",null,y,R),d.push({event:y,listeners:h}))}var Nv=null,Dv=null;function gde(d){v7(d,0)}function ib(d){var h=pp(d);if(hr(h))return d}function vde(d,h){if(d==="change")return h}var e7=!1;if(a){var W3;if(a){var z3="oninput"in document;if(!z3){var t7=document.createElement("div");t7.setAttribute("oninput","return;"),z3=typeof t7.oninput=="function"}W3=z3}else W3=!1;e7=W3&&(!document.documentMode||9<document.documentMode)}function n7(){Nv&&(Nv.detachEvent("onpropertychange",r7),Dv=Nv=null)}function r7(d){if(d.propertyName==="value"&&ib(Dv)){var h=[];Q9(h,Dv,d,tt(d)),fa(gde,h)}}function yde(d,h,y){d==="focusin"?(n7(),Nv=h,Dv=y,Nv.attachEvent("onpropertychange",r7)):d==="focusout"&&n7()}function _de(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return ib(Dv)}function bde(d,h){if(d==="click")return ib(h)}function Sde(d,h){if(d==="input"||d==="change")return ib(h)}function Ede(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var pa=typeof Object.is=="function"?Object.is:Ede;function Fv(d,h){if(pa(d,h))return!0;if(typeof d!="object"||d===null||typeof h!="object"||h===null)return!1;var y=Object.keys(d),R=Object.keys(h);if(y.length!==R.length)return!1;for(R=0;R<y.length;R++){var P=y[R];if(!l.call(h,P)||!pa(d[P],h[P]))return!1}return!0}function i7(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function s7(d,h){var y=i7(d);d=0;for(var R;y;){if(y.nodeType===3){if(R=d+y.textContent.length,d<=h&&R>=h)return{node:y,offset:h-d};d=R}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=i7(y)}}function o7(d,h){return d&&h?d===h?!0:d&&d.nodeType===3?!1:h&&h.nodeType===3?o7(d,h.parentNode):"contains"in d?d.contains(h):d.compareDocumentPosition?!!(d.compareDocumentPosition(h)&16):!1:!1}function a7(){for(var d=window,h=Ft();h instanceof d.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)d=h.contentWindow;else break;h=Ft(d.document)}return h}function Y3(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h&&(h==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||h==="textarea"||d.contentEditable==="true")}function wde(d){var h=a7(),y=d.focusedElem,R=d.selectionRange;if(h!==y&&y&&y.ownerDocument&&o7(y.ownerDocument.documentElement,y)){if(R!==null&&Y3(y)){if(h=R.start,d=R.end,d===void 0&&(d=h),"selectionStart"in y)y.selectionStart=h,y.selectionEnd=Math.min(d,y.value.length);else if(d=(h=y.ownerDocument||document)&&h.defaultView||window,d.getSelection){d=d.getSelection();var P=y.textContent.length,M=Math.min(R.start,P);R=R.end===void 0?M:Math.min(R.end,P),!d.extend&&M>R&&(P=R,R=M,M=P),P=s7(y,M);var j=s7(y,R);P&&j&&(d.rangeCount!==1||d.anchorNode!==P.node||d.anchorOffset!==P.offset||d.focusNode!==j.node||d.focusOffset!==j.offset)&&(h=h.createRange(),h.setStart(P.node,P.offset),d.removeAllRanges(),M>R?(d.addRange(h),d.extend(j.node,j.offset)):(h.setEnd(j.node,j.offset),d.addRange(h)))}}for(h=[],d=y;d=d.parentNode;)d.nodeType===1&&h.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<h.length;y++)d=h[y],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Cde=a&&"documentMode"in document&&11>=document.documentMode,up=null,X3=null,Uv=null,J3=!1;function l7(d,h,y){var R=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;J3||up==null||up!==Ft(R)||(R=up,"selectionStart"in R&&Y3(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),Uv&&Fv(Uv,R)||(Uv=R,R=lb(X3,"onSelect"),0<R.length&&(h=new B3("onSelect","select",null,h,y),d.push({event:h,listeners:R}),h.target=up)))}function sb(d,h){var y={};return y[d.toLowerCase()]=h.toLowerCase(),y["Webkit"+d]="webkit"+h,y["Moz"+d]="moz"+h,y}var dp={animationend:sb("Animation","AnimationEnd"),animationiteration:sb("Animation","AnimationIteration"),animationstart:sb("Animation","AnimationStart"),transitionend:sb("Transition","TransitionEnd")},Z3={},c7={};a&&(c7=document.createElement("div").style,"AnimationEvent"in window||(delete dp.animationend.animation,delete dp.animationiteration.animation,delete dp.animationstart.animation),"TransitionEvent"in window||delete dp.transitionend.transition);function ob(d){if(Z3[d])return Z3[d];if(!dp[d])return d;var h=dp[d],y;for(y in h)if(h.hasOwnProperty(y)&&y in c7)return Z3[d]=h[y];return d}var u7=ob("animationend"),d7=ob("animationiteration"),f7=ob("animationstart"),h7=ob("transitionend"),p7=new Map,m7="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ku(d,h){p7.set(d,h),s(h,[d])}for(var Q3=0;Q3<m7.length;Q3++){var eR=m7[Q3],Tde=eR.toLowerCase(),Rde=eR[0].toUpperCase()+eR.slice(1);ku(Tde,"on"+Rde)}ku(u7,"onAnimationEnd"),ku(d7,"onAnimationIteration"),ku(f7,"onAnimationStart"),ku("dblclick","onDoubleClick"),ku("focusin","onFocus"),ku("focusout","onBlur"),ku(h7,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ide=new Set("cancel close invalid load scroll toggle".split(" ").concat(jv));function g7(d,h,y){var R=d.type||"unknown-event";d.currentTarget=y,Tue(R,h,void 0,d),d.currentTarget=null}function v7(d,h){h=(h&4)!==0;for(var y=0;y<d.length;y++){var R=d[y],P=R.event;R=R.listeners;e:{var M=void 0;if(h)for(var j=R.length-1;0<=j;j--){var Y=R[j],J=Y.instance,oe=Y.currentTarget;if(Y=Y.listener,J!==M&&P.isPropagationStopped())break e;g7(P,Y,oe),M=J}else for(j=0;j<R.length;j++){if(Y=R[j],J=Y.instance,oe=Y.currentTarget,Y=Y.listener,J!==M&&P.isPropagationStopped())break e;g7(P,Y,oe),M=J}}}if(G_)throw d=L3,G_=!1,L3=null,d}function Pn(d,h){var y=h[lR];y===void 0&&(y=h[lR]=new Set);var R=d+"__bubble";y.has(R)||(y7(h,d,2,!1),y.add(R))}function tR(d,h,y){var R=0;h&&(R|=4),y7(y,d,R,h)}var ab="_reactListening"+Math.random().toString(36).slice(2);function $v(d){if(!d[ab]){d[ab]=!0,r.forEach(function(y){y!=="selectionchange"&&(Ide.has(y)||tR(y,!1,d),tR(y,!0,d))});var h=d.nodeType===9?d:d.ownerDocument;h===null||h[ab]||(h[ab]=!0,tR("selectionchange",!1,h))}}function y7(d,h,y,R){switch(B9(h)){case 1:var P=Bue;break;case 4:P=Hue;break;default:P=U3}y=P.bind(null,h,y,d),P=void 0,!Su||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(P=!0),R?P!==void 0?d.addEventListener(h,y,{capture:!0,passive:P}):d.addEventListener(h,y,!0):P!==void 0?d.addEventListener(h,y,{passive:P}):d.addEventListener(h,y,!1)}function nR(d,h,y,R,P){var M=R;if((h&1)===0&&(h&2)===0&&R!==null)e:for(;;){if(R===null)return;var j=R.tag;if(j===3||j===4){var Y=R.stateNode.containerInfo;if(Y===P||Y.nodeType===8&&Y.parentNode===P)break;if(j===4)for(j=R.return;j!==null;){var J=j.tag;if((J===3||J===4)&&(J=j.stateNode.containerInfo,J===P||J.nodeType===8&&J.parentNode===P))return;j=j.return}for(;Y!==null;){if(j=bf(Y),j===null)return;if(J=j.tag,J===5||J===6){R=M=j;continue e}Y=Y.parentNode}}R=R.return}fa(function(){var oe=M,me=tt(y),ye=[];e:{var pe=p7.get(d);if(pe!==void 0){var Fe=B3,$e=d;switch(d){case"keypress":if(tb(y)===0)break e;case"keydown":case"keyup":Fe=rde;break;case"focusin":$e="focus",Fe=G3;break;case"focusout":$e="blur",Fe=G3;break;case"beforeblur":case"afterblur":Fe=G3;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Fe=G9;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Fe=que;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Fe=ode;break;case u7:case d7:case f7:Fe=zue;break;case h7:Fe=lde;break;case"scroll":Fe=Vue;break;case"wheel":Fe=ude;break;case"copy":case"cut":case"paste":Fe=Xue;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Fe=K9}var He=(h&4)!==0,mr=!He&&d==="scroll",ne=He?pe!==null?pe+"Capture":null:pe;He=[];for(var te=oe,re;te!==null;){re=te;var Ee=re.stateNode;if(re.tag===5&&Ee!==null&&(re=Ee,ne!==null&&(Ee=Li(te,ne),Ee!=null&&He.push(Bv(te,Ee,re)))),mr)break;te=te.return}0<He.length&&(pe=new Fe(pe,$e,null,y,me),ye.push({event:pe,listeners:He}))}}if((h&7)===0){e:{if(pe=d==="mouseover"||d==="pointerover",Fe=d==="mouseout"||d==="pointerout",pe&&y!==ca&&($e=y.relatedTarget||y.fromElement)&&(bf($e)||$e[sc]))break e;if((Fe||pe)&&(pe=me.window===me?me:(pe=me.ownerDocument)?pe.defaultView||pe.parentWindow:window,Fe?($e=y.relatedTarget||y.toElement,Fe=oe,$e=$e?bf($e):null,$e!==null&&(mr=_f($e),$e!==mr||$e.tag!==5&&$e.tag!==6)&&($e=null)):(Fe=null,$e=oe),Fe!==$e)){if(He=G9,Ee="onMouseLeave",ne="onMouseEnter",te="mouse",(d==="pointerout"||d==="pointerover")&&(He=K9,Ee="onPointerLeave",ne="onPointerEnter",te="pointer"),mr=Fe==null?pe:pp(Fe),re=$e==null?pe:pp($e),pe=new He(Ee,te+"leave",Fe,y,me),pe.target=mr,pe.relatedTarget=re,Ee=null,bf(me)===oe&&(He=new He(ne,te+"enter",$e,y,me),He.target=re,He.relatedTarget=mr,Ee=He),mr=Ee,Fe&&$e)t:{for(He=Fe,ne=$e,te=0,re=He;re;re=fp(re))te++;for(re=0,Ee=ne;Ee;Ee=fp(Ee))re++;for(;0<te-re;)He=fp(He),te--;for(;0<re-te;)ne=fp(ne),re--;for(;te--;){if(He===ne||ne!==null&&He===ne.alternate)break t;He=fp(He),ne=fp(ne)}He=null}else He=null;Fe!==null&&_7(ye,pe,Fe,He,!1),$e!==null&&mr!==null&&_7(ye,mr,$e,He,!0)}}e:{if(pe=oe?pp(oe):window,Fe=pe.nodeName&&pe.nodeName.toLowerCase(),Fe==="select"||Fe==="input"&&pe.type==="file")var Ge=vde;else if(Z9(pe))if(e7)Ge=Sde;else{Ge=_de;var it=yde}else(Fe=pe.nodeName)&&Fe.toLowerCase()==="input"&&(pe.type==="checkbox"||pe.type==="radio")&&(Ge=bde);if(Ge&&(Ge=Ge(d,oe))){Q9(ye,Ge,y,me);break e}it&&it(d,pe,oe),d==="focusout"&&(it=pe._wrapperState)&&it.controlled&&pe.type==="number"&&Bs(pe,"number",pe.value)}switch(it=oe?pp(oe):window,d){case"focusin":(Z9(it)||it.contentEditable==="true")&&(up=it,X3=oe,Uv=null);break;case"focusout":Uv=X3=up=null;break;case"mousedown":J3=!0;break;case"contextmenu":case"mouseup":case"dragend":J3=!1,l7(ye,y,me);break;case"selectionchange":if(Cde)break;case"keydown":case"keyup":l7(ye,y,me)}var st;if(K3)e:{switch(d){case"compositionstart":var ft="onCompositionStart";break e;case"compositionend":ft="onCompositionEnd";break e;case"compositionupdate":ft="onCompositionUpdate";break e}ft=void 0}else cp?X9(d,y)&&(ft="onCompositionEnd"):d==="keydown"&&y.keyCode===229&&(ft="onCompositionStart");ft&&(W9&&y.locale!=="ko"&&(cp||ft!=="onCompositionStart"?ft==="onCompositionEnd"&&cp&&(st=H9()):(Iu=me,$3="value"in Iu?Iu.value:Iu.textContent,cp=!0)),it=lb(oe,ft),0<it.length&&(ft=new q9(ft,d,null,y,me),ye.push({event:ft,listeners:it}),st?ft.data=st:(st=J9(y),st!==null&&(ft.data=st)))),(st=fde?hde(d,y):pde(d,y))&&(oe=lb(oe,"onBeforeInput"),0<oe.length&&(me=new q9("onBeforeInput","beforeinput",null,y,me),ye.push({event:me,listeners:oe}),me.data=st))}v7(ye,h)})}function Bv(d,h,y){return{instance:d,listener:h,currentTarget:y}}function lb(d,h){for(var y=h+"Capture",R=[];d!==null;){var P=d,M=P.stateNode;P.tag===5&&M!==null&&(P=M,M=Li(d,y),M!=null&&R.unshift(Bv(d,M,P)),M=Li(d,h),M!=null&&R.push(Bv(d,M,P))),d=d.return}return R}function fp(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function _7(d,h,y,R,P){for(var M=h._reactName,j=[];y!==null&&y!==R;){var Y=y,J=Y.alternate,oe=Y.stateNode;if(J!==null&&J===R)break;Y.tag===5&&oe!==null&&(Y=oe,P?(J=Li(y,M),J!=null&&j.unshift(Bv(y,J,Y))):P||(J=Li(y,M),J!=null&&j.push(Bv(y,J,Y)))),y=y.return}j.length!==0&&d.push({event:h,listeners:j})}var kde=/\r\n?/g,xde=/\u0000|\uFFFD/g;function b7(d){return(typeof d=="string"?d:""+d).replace(kde,`
`).replace(xde,"")}function cb(d,h,y){if(h=b7(h),b7(d)!==h&&y)throw Error(n(425))}function ub(){}var rR=null,iR=null;function sR(d,h){return d==="textarea"||d==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var oR=typeof setTimeout=="function"?setTimeout:void 0,Pde=typeof clearTimeout=="function"?clearTimeout:void 0,S7=typeof Promise=="function"?Promise:void 0,Lde=typeof queueMicrotask=="function"?queueMicrotask:typeof S7<"u"?function(d){return S7.resolve(null).then(d).catch(Ade)}:oR;function Ade(d){setTimeout(function(){throw d})}function aR(d,h){var y=h,R=0;do{var P=y.nextSibling;if(d.removeChild(y),P&&P.nodeType===8)if(y=P.data,y==="/$"){if(R===0){d.removeChild(P),Lv(h);return}R--}else y!=="$"&&y!=="$?"&&y!=="$!"||R++;y=P}while(y);Lv(h)}function xu(d){for(;d!=null;d=d.nextSibling){var h=d.nodeType;if(h===1||h===3)break;if(h===8){if(h=d.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return d}function E7(d){d=d.previousSibling;for(var h=0;d;){if(d.nodeType===8){var y=d.data;if(y==="$"||y==="$!"||y==="$?"){if(h===0)return d;h--}else y==="/$"&&h++}d=d.previousSibling}return null}var hp=Math.random().toString(36).slice(2),sl="__reactFiber$"+hp,Hv="__reactProps$"+hp,sc="__reactContainer$"+hp,lR="__reactEvents$"+hp,Ode="__reactListeners$"+hp,Mde="__reactHandles$"+hp;function bf(d){var h=d[sl];if(h)return h;for(var y=d.parentNode;y;){if(h=y[sc]||y[sl]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(d=E7(d);d!==null;){if(y=d[sl])return y;d=E7(d)}return h}d=y,y=d.parentNode}return null}function Vv(d){return d=d[sl]||d[sc],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function pp(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(n(33))}function db(d){return d[Hv]||null}var cR=[],mp=-1;function Pu(d){return{current:d}}function Ln(d){0>mp||(d.current=cR[mp],cR[mp]=null,mp--)}function Cn(d,h){mp++,cR[mp]=d.current,d.current=h}var Lu={},Ai=Pu(Lu),ds=Pu(!1),Sf=Lu;function gp(d,h){var y=d.type.contextTypes;if(!y)return Lu;var R=d.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===h)return R.__reactInternalMemoizedMaskedChildContext;var P={},M;for(M in y)P[M]=h[M];return R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=h,d.__reactInternalMemoizedMaskedChildContext=P),P}function fs(d){return d=d.childContextTypes,d!=null}function fb(){Ln(ds),Ln(Ai)}function w7(d,h,y){if(Ai.current!==Lu)throw Error(n(168));Cn(Ai,h),Cn(ds,y)}function C7(d,h,y){var R=d.stateNode;if(h=h.childContextTypes,typeof R.getChildContext!="function")return y;R=R.getChildContext();for(var P in R)if(!(P in h))throw Error(n(108,Re(d)||"Unknown",P));return Z({},y,R)}function hb(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Lu,Sf=Ai.current,Cn(Ai,d),Cn(ds,ds.current),!0}function T7(d,h,y){var R=d.stateNode;if(!R)throw Error(n(169));y?(d=C7(d,h,Sf),R.__reactInternalMemoizedMergedChildContext=d,Ln(ds),Ln(Ai),Cn(Ai,d)):Ln(ds),Cn(ds,y)}var oc=null,pb=!1,uR=!1;function R7(d){oc===null?oc=[d]:oc.push(d)}function Nde(d){pb=!0,R7(d)}function Au(){if(!uR&&oc!==null){uR=!0;var d=0,h=on;try{var y=oc;for(on=1;d<y.length;d++){var R=y[d];do R=R(!0);while(R!==null)}oc=null,pb=!1}catch(P){throw oc!==null&&(oc=oc.slice(d+1)),k9(A3,Au),P}finally{on=h,uR=!1}}return null}var vp=[],yp=0,mb=null,gb=0,_o=[],bo=0,Ef=null,ac=1,lc="";function wf(d,h){vp[yp++]=gb,vp[yp++]=mb,mb=d,gb=h}function I7(d,h,y){_o[bo++]=ac,_o[bo++]=lc,_o[bo++]=Ef,Ef=d;var R=ac;d=lc;var P=32-ha(R)-1;R&=~(1<<P),y+=1;var M=32-ha(h)+P;if(30<M){var j=P-P%5;M=(R&(1<<j)-1).toString(32),R>>=j,P-=j,ac=1<<32-ha(h)+P|y<<P|R,lc=M+d}else ac=1<<M|y<<P|R,lc=d}function dR(d){d.return!==null&&(wf(d,1),I7(d,1,0))}function fR(d){for(;d===mb;)mb=vp[--yp],vp[yp]=null,gb=vp[--yp],vp[yp]=null;for(;d===Ef;)Ef=_o[--bo],_o[bo]=null,lc=_o[--bo],_o[bo]=null,ac=_o[--bo],_o[bo]=null}var qs=null,Ks=null,$n=!1,ma=null;function k7(d,h){var y=Co(5,null,null,0);y.elementType="DELETED",y.stateNode=h,y.return=d,h=d.deletions,h===null?(d.deletions=[y],d.flags|=16):h.push(y)}function x7(d,h){switch(d.tag){case 5:var y=d.type;return h=h.nodeType!==1||y.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(d.stateNode=h,qs=d,Ks=xu(h.firstChild),!0):!1;case 6:return h=d.pendingProps===""||h.nodeType!==3?null:h,h!==null?(d.stateNode=h,qs=d,Ks=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(y=Ef!==null?{id:ac,overflow:lc}:null,d.memoizedState={dehydrated:h,treeContext:y,retryLane:1073741824},y=Co(18,null,null,0),y.stateNode=h,y.return=d,d.child=y,qs=d,Ks=null,!0):!1;default:return!1}}function hR(d){return(d.mode&1)!==0&&(d.flags&128)===0}function pR(d){if($n){var h=Ks;if(h){var y=h;if(!x7(d,h)){if(hR(d))throw Error(n(418));h=xu(y.nextSibling);var R=qs;h&&x7(d,h)?k7(R,y):(d.flags=d.flags&-4097|2,$n=!1,qs=d)}}else{if(hR(d))throw Error(n(418));d.flags=d.flags&-4097|2,$n=!1,qs=d}}}function P7(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;qs=d}function vb(d){if(d!==qs)return!1;if(!$n)return P7(d),$n=!0,!1;var h;if((h=d.tag!==3)&&!(h=d.tag!==5)&&(h=d.type,h=h!=="head"&&h!=="body"&&!sR(d.type,d.memoizedProps)),h&&(h=Ks)){if(hR(d))throw L7(),Error(n(418));for(;h;)k7(d,h),h=xu(h.nextSibling)}if(P7(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(n(317));e:{for(d=d.nextSibling,h=0;d;){if(d.nodeType===8){var y=d.data;if(y==="/$"){if(h===0){Ks=xu(d.nextSibling);break e}h--}else y!=="$"&&y!=="$!"&&y!=="$?"||h++}d=d.nextSibling}Ks=null}}else Ks=qs?xu(d.stateNode.nextSibling):null;return!0}function L7(){for(var d=Ks;d;)d=xu(d.nextSibling)}function _p(){Ks=qs=null,$n=!1}function mR(d){ma===null?ma=[d]:ma.push(d)}var Dde=T.ReactCurrentBatchConfig;function Gv(d,h,y){if(d=y.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(n(309));var R=y.stateNode}if(!R)throw Error(n(147,d));var P=R,M=""+d;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===M?h.ref:(h=function(j){var Y=P.refs;j===null?delete Y[M]:Y[M]=j},h._stringRef=M,h)}if(typeof d!="string")throw Error(n(284));if(!y._owner)throw Error(n(290,d))}return d}function yb(d,h){throw d=Object.prototype.toString.call(h),Error(n(31,d==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":d))}function A7(d){var h=d._init;return h(d._payload)}function O7(d){function h(ne,te){if(d){var re=ne.deletions;re===null?(ne.deletions=[te],ne.flags|=16):re.push(te)}}function y(ne,te){if(!d)return null;for(;te!==null;)h(ne,te),te=te.sibling;return null}function R(ne,te){for(ne=new Map;te!==null;)te.key!==null?ne.set(te.key,te):ne.set(te.index,te),te=te.sibling;return ne}function P(ne,te){return ne=$u(ne,te),ne.index=0,ne.sibling=null,ne}function M(ne,te,re){return ne.index=re,d?(re=ne.alternate,re!==null?(re=re.index,re<te?(ne.flags|=2,te):re):(ne.flags|=2,te)):(ne.flags|=1048576,te)}function j(ne){return d&&ne.alternate===null&&(ne.flags|=2),ne}function Y(ne,te,re,Ee){return te===null||te.tag!==6?(te=oI(re,ne.mode,Ee),te.return=ne,te):(te=P(te,re),te.return=ne,te)}function J(ne,te,re,Ee){var Ge=re.type;return Ge===x?me(ne,te,re.props.children,Ee,re.key):te!==null&&(te.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===z&&A7(Ge)===te.type)?(Ee=P(te,re.props),Ee.ref=Gv(ne,te,re),Ee.return=ne,Ee):(Ee=Hb(re.type,re.key,re.props,null,ne.mode,Ee),Ee.ref=Gv(ne,te,re),Ee.return=ne,Ee)}function oe(ne,te,re,Ee){return te===null||te.tag!==4||te.stateNode.containerInfo!==re.containerInfo||te.stateNode.implementation!==re.implementation?(te=aI(re,ne.mode,Ee),te.return=ne,te):(te=P(te,re.children||[]),te.return=ne,te)}function me(ne,te,re,Ee,Ge){return te===null||te.tag!==7?(te=Lf(re,ne.mode,Ee,Ge),te.return=ne,te):(te=P(te,re),te.return=ne,te)}function ye(ne,te,re){if(typeof te=="string"&&te!==""||typeof te=="number")return te=oI(""+te,ne.mode,re),te.return=ne,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case I:return re=Hb(te.type,te.key,te.props,null,ne.mode,re),re.ref=Gv(ne,null,te),re.return=ne,re;case C:return te=aI(te,ne.mode,re),te.return=ne,te;case z:var Ee=te._init;return ye(ne,Ee(te._payload),re)}if(Pi(te)||q(te))return te=Lf(te,ne.mode,re,null),te.return=ne,te;yb(ne,te)}return null}function pe(ne,te,re,Ee){var Ge=te!==null?te.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return Ge!==null?null:Y(ne,te,""+re,Ee);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case I:return re.key===Ge?J(ne,te,re,Ee):null;case C:return re.key===Ge?oe(ne,te,re,Ee):null;case z:return Ge=re._init,pe(ne,te,Ge(re._payload),Ee)}if(Pi(re)||q(re))return Ge!==null?null:me(ne,te,re,Ee,null);yb(ne,re)}return null}function Fe(ne,te,re,Ee,Ge){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return ne=ne.get(re)||null,Y(te,ne,""+Ee,Ge);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case I:return ne=ne.get(Ee.key===null?re:Ee.key)||null,J(te,ne,Ee,Ge);case C:return ne=ne.get(Ee.key===null?re:Ee.key)||null,oe(te,ne,Ee,Ge);case z:var it=Ee._init;return Fe(ne,te,re,it(Ee._payload),Ge)}if(Pi(Ee)||q(Ee))return ne=ne.get(re)||null,me(te,ne,Ee,Ge,null);yb(te,Ee)}return null}function $e(ne,te,re,Ee){for(var Ge=null,it=null,st=te,ft=te=0,ni=null;st!==null&&ft<re.length;ft++){st.index>ft?(ni=st,st=null):ni=st.sibling;var Gt=pe(ne,st,re[ft],Ee);if(Gt===null){st===null&&(st=ni);break}d&&st&&Gt.alternate===null&&h(ne,st),te=M(Gt,te,ft),it===null?Ge=Gt:it.sibling=Gt,it=Gt,st=ni}if(ft===re.length)return y(ne,st),$n&&wf(ne,ft),Ge;if(st===null){for(;ft<re.length;ft++)st=ye(ne,re[ft],Ee),st!==null&&(te=M(st,te,ft),it===null?Ge=st:it.sibling=st,it=st);return $n&&wf(ne,ft),Ge}for(st=R(ne,st);ft<re.length;ft++)ni=Fe(st,ne,ft,re[ft],Ee),ni!==null&&(d&&ni.alternate!==null&&st.delete(ni.key===null?ft:ni.key),te=M(ni,te,ft),it===null?Ge=ni:it.sibling=ni,it=ni);return d&&st.forEach(function(Bu){return h(ne,Bu)}),$n&&wf(ne,ft),Ge}function He(ne,te,re,Ee){var Ge=q(re);if(typeof Ge!="function")throw Error(n(150));if(re=Ge.call(re),re==null)throw Error(n(151));for(var it=Ge=null,st=te,ft=te=0,ni=null,Gt=re.next();st!==null&&!Gt.done;ft++,Gt=re.next()){st.index>ft?(ni=st,st=null):ni=st.sibling;var Bu=pe(ne,st,Gt.value,Ee);if(Bu===null){st===null&&(st=ni);break}d&&st&&Bu.alternate===null&&h(ne,st),te=M(Bu,te,ft),it===null?Ge=Bu:it.sibling=Bu,it=Bu,st=ni}if(Gt.done)return y(ne,st),$n&&wf(ne,ft),Ge;if(st===null){for(;!Gt.done;ft++,Gt=re.next())Gt=ye(ne,Gt.value,Ee),Gt!==null&&(te=M(Gt,te,ft),it===null?Ge=Gt:it.sibling=Gt,it=Gt);return $n&&wf(ne,ft),Ge}for(st=R(ne,st);!Gt.done;ft++,Gt=re.next())Gt=Fe(st,ne,ft,Gt.value,Ee),Gt!==null&&(d&&Gt.alternate!==null&&st.delete(Gt.key===null?ft:Gt.key),te=M(Gt,te,ft),it===null?Ge=Gt:it.sibling=Gt,it=Gt);return d&&st.forEach(function(mfe){return h(ne,mfe)}),$n&&wf(ne,ft),Ge}function mr(ne,te,re,Ee){if(typeof re=="object"&&re!==null&&re.type===x&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case I:e:{for(var Ge=re.key,it=te;it!==null;){if(it.key===Ge){if(Ge=re.type,Ge===x){if(it.tag===7){y(ne,it.sibling),te=P(it,re.props.children),te.return=ne,ne=te;break e}}else if(it.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===z&&A7(Ge)===it.type){y(ne,it.sibling),te=P(it,re.props),te.ref=Gv(ne,it,re),te.return=ne,ne=te;break e}y(ne,it);break}else h(ne,it);it=it.sibling}re.type===x?(te=Lf(re.props.children,ne.mode,Ee,re.key),te.return=ne,ne=te):(Ee=Hb(re.type,re.key,re.props,null,ne.mode,Ee),Ee.ref=Gv(ne,te,re),Ee.return=ne,ne=Ee)}return j(ne);case C:e:{for(it=re.key;te!==null;){if(te.key===it)if(te.tag===4&&te.stateNode.containerInfo===re.containerInfo&&te.stateNode.implementation===re.implementation){y(ne,te.sibling),te=P(te,re.children||[]),te.return=ne,ne=te;break e}else{y(ne,te);break}else h(ne,te);te=te.sibling}te=aI(re,ne.mode,Ee),te.return=ne,ne=te}return j(ne);case z:return it=re._init,mr(ne,te,it(re._payload),Ee)}if(Pi(re))return $e(ne,te,re,Ee);if(q(re))return He(ne,te,re,Ee);yb(ne,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,te!==null&&te.tag===6?(y(ne,te.sibling),te=P(te,re),te.return=ne,ne=te):(y(ne,te),te=oI(re,ne.mode,Ee),te.return=ne,ne=te),j(ne)):y(ne,te)}return mr}var bp=O7(!0),M7=O7(!1),_b=Pu(null),bb=null,Sp=null,gR=null;function vR(){gR=Sp=bb=null}function yR(d){var h=_b.current;Ln(_b),d._currentValue=h}function _R(d,h,y){for(;d!==null;){var R=d.alternate;if((d.childLanes&h)!==h?(d.childLanes|=h,R!==null&&(R.childLanes|=h)):R!==null&&(R.childLanes&h)!==h&&(R.childLanes|=h),d===y)break;d=d.return}}function Ep(d,h){bb=d,gR=Sp=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&h)!==0&&(hs=!0),d.firstContext=null)}function So(d){var h=d._currentValue;if(gR!==d)if(d={context:d,memoizedValue:h,next:null},Sp===null){if(bb===null)throw Error(n(308));Sp=d,bb.dependencies={lanes:0,firstContext:d}}else Sp=Sp.next=d;return h}var Cf=null;function bR(d){Cf===null?Cf=[d]:Cf.push(d)}function N7(d,h,y,R){var P=h.interleaved;return P===null?(y.next=y,bR(h)):(y.next=P.next,P.next=y),h.interleaved=y,cc(d,R)}function cc(d,h){d.lanes|=h;var y=d.alternate;for(y!==null&&(y.lanes|=h),y=d,d=d.return;d!==null;)d.childLanes|=h,y=d.alternate,y!==null&&(y.childLanes|=h),y=d,d=d.return;return y.tag===3?y.stateNode:null}var Ou=!1;function SR(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function D7(d,h){d=d.updateQueue,h.updateQueue===d&&(h.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function uc(d,h){return{eventTime:d,lane:h,tag:0,payload:null,callback:null,next:null}}function Mu(d,h,y){var R=d.updateQueue;if(R===null)return null;if(R=R.shared,(Ut&2)!==0){var P=R.pending;return P===null?h.next=h:(h.next=P.next,P.next=h),R.pending=h,cc(d,y)}return P=R.interleaved,P===null?(h.next=h,bR(R)):(h.next=P.next,P.next=h),R.interleaved=h,cc(d,y)}function Sb(d,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194240)!==0)){var R=h.lanes;R&=d.pendingLanes,y|=R,h.lanes=y,N3(d,y)}}function F7(d,h){var y=d.updateQueue,R=d.alternate;if(R!==null&&(R=R.updateQueue,y===R)){var P=null,M=null;if(y=y.firstBaseUpdate,y!==null){do{var j={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};M===null?P=M=j:M=M.next=j,y=y.next}while(y!==null);M===null?P=M=h:M=M.next=h}else P=M=h;y={baseState:R.baseState,firstBaseUpdate:P,lastBaseUpdate:M,shared:R.shared,effects:R.effects},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=h:d.next=h,y.lastBaseUpdate=h}function Eb(d,h,y,R){var P=d.updateQueue;Ou=!1;var M=P.firstBaseUpdate,j=P.lastBaseUpdate,Y=P.shared.pending;if(Y!==null){P.shared.pending=null;var J=Y,oe=J.next;J.next=null,j===null?M=oe:j.next=oe,j=J;var me=d.alternate;me!==null&&(me=me.updateQueue,Y=me.lastBaseUpdate,Y!==j&&(Y===null?me.firstBaseUpdate=oe:Y.next=oe,me.lastBaseUpdate=J))}if(M!==null){var ye=P.baseState;j=0,me=oe=J=null,Y=M;do{var pe=Y.lane,Fe=Y.eventTime;if((R&pe)===pe){me!==null&&(me=me.next={eventTime:Fe,lane:0,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null});e:{var $e=d,He=Y;switch(pe=h,Fe=y,He.tag){case 1:if($e=He.payload,typeof $e=="function"){ye=$e.call(Fe,ye,pe);break e}ye=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=He.payload,pe=typeof $e=="function"?$e.call(Fe,ye,pe):$e,pe==null)break e;ye=Z({},ye,pe);break e;case 2:Ou=!0}}Y.callback!==null&&Y.lane!==0&&(d.flags|=64,pe=P.effects,pe===null?P.effects=[Y]:pe.push(Y))}else Fe={eventTime:Fe,lane:pe,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},me===null?(oe=me=Fe,J=ye):me=me.next=Fe,j|=pe;if(Y=Y.next,Y===null){if(Y=P.shared.pending,Y===null)break;pe=Y,Y=pe.next,pe.next=null,P.lastBaseUpdate=pe,P.shared.pending=null}}while(!0);if(me===null&&(J=ye),P.baseState=J,P.firstBaseUpdate=oe,P.lastBaseUpdate=me,h=P.shared.interleaved,h!==null){P=h;do j|=P.lane,P=P.next;while(P!==h)}else M===null&&(P.shared.lanes=0);If|=j,d.lanes=j,d.memoizedState=ye}}function U7(d,h,y){if(d=h.effects,h.effects=null,d!==null)for(h=0;h<d.length;h++){var R=d[h],P=R.callback;if(P!==null){if(R.callback=null,R=y,typeof P!="function")throw Error(n(191,P));P.call(R)}}}var qv={},ol=Pu(qv),Kv=Pu(qv),Wv=Pu(qv);function Tf(d){if(d===qv)throw Error(n(174));return d}function ER(d,h){switch(Cn(Wv,h),Cn(Kv,d),Cn(ol,qv),d=h.nodeType,d){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:nl(null,"");break;default:d=d===8?h.parentNode:h,h=d.namespaceURI||null,d=d.tagName,h=nl(h,d)}Ln(ol),Cn(ol,h)}function wp(){Ln(ol),Ln(Kv),Ln(Wv)}function j7(d){Tf(Wv.current);var h=Tf(ol.current),y=nl(h,d.type);h!==y&&(Cn(Kv,d),Cn(ol,y))}function wR(d){Kv.current===d&&(Ln(ol),Ln(Kv))}var Yn=Pu(0);function wb(d){for(var h=d;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var CR=[];function TR(){for(var d=0;d<CR.length;d++)CR[d]._workInProgressVersionPrimary=null;CR.length=0}var Cb=T.ReactCurrentDispatcher,RR=T.ReactCurrentBatchConfig,Rf=0,Xn=null,jr=null,ei=null,Tb=!1,zv=!1,Yv=0,Fde=0;function Oi(){throw Error(n(321))}function IR(d,h){if(h===null)return!1;for(var y=0;y<h.length&&y<d.length;y++)if(!pa(d[y],h[y]))return!1;return!0}function kR(d,h,y,R,P,M){if(Rf=M,Xn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Cb.current=d===null||d.memoizedState===null?Bde:Hde,d=y(R,P),zv){M=0;do{if(zv=!1,Yv=0,25<=M)throw Error(n(301));M+=1,ei=jr=null,h.updateQueue=null,Cb.current=Vde,d=y(R,P)}while(zv)}if(Cb.current=kb,h=jr!==null&&jr.next!==null,Rf=0,ei=jr=Xn=null,Tb=!1,h)throw Error(n(300));return d}function xR(){var d=Yv!==0;return Yv=0,d}function al(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ei===null?Xn.memoizedState=ei=d:ei=ei.next=d,ei}function Eo(){if(jr===null){var d=Xn.alternate;d=d!==null?d.memoizedState:null}else d=jr.next;var h=ei===null?Xn.memoizedState:ei.next;if(h!==null)ei=h,jr=d;else{if(d===null)throw Error(n(310));jr=d,d={memoizedState:jr.memoizedState,baseState:jr.baseState,baseQueue:jr.baseQueue,queue:jr.queue,next:null},ei===null?Xn.memoizedState=ei=d:ei=ei.next=d}return ei}function Xv(d,h){return typeof h=="function"?h(d):h}function PR(d){var h=Eo(),y=h.queue;if(y===null)throw Error(n(311));y.lastRenderedReducer=d;var R=jr,P=R.baseQueue,M=y.pending;if(M!==null){if(P!==null){var j=P.next;P.next=M.next,M.next=j}R.baseQueue=P=M,y.pending=null}if(P!==null){M=P.next,R=R.baseState;var Y=j=null,J=null,oe=M;do{var me=oe.lane;if((Rf&me)===me)J!==null&&(J=J.next={lane:0,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),R=oe.hasEagerState?oe.eagerState:d(R,oe.action);else{var ye={lane:me,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null};J===null?(Y=J=ye,j=R):J=J.next=ye,Xn.lanes|=me,If|=me}oe=oe.next}while(oe!==null&&oe!==M);J===null?j=R:J.next=Y,pa(R,h.memoizedState)||(hs=!0),h.memoizedState=R,h.baseState=j,h.baseQueue=J,y.lastRenderedState=R}if(d=y.interleaved,d!==null){P=d;do M=P.lane,Xn.lanes|=M,If|=M,P=P.next;while(P!==d)}else P===null&&(y.lanes=0);return[h.memoizedState,y.dispatch]}function LR(d){var h=Eo(),y=h.queue;if(y===null)throw Error(n(311));y.lastRenderedReducer=d;var R=y.dispatch,P=y.pending,M=h.memoizedState;if(P!==null){y.pending=null;var j=P=P.next;do M=d(M,j.action),j=j.next;while(j!==P);pa(M,h.memoizedState)||(hs=!0),h.memoizedState=M,h.baseQueue===null&&(h.baseState=M),y.lastRenderedState=M}return[M,R]}function $7(){}function B7(d,h){var y=Xn,R=Eo(),P=h(),M=!pa(R.memoizedState,P);if(M&&(R.memoizedState=P,hs=!0),R=R.queue,AR(G7.bind(null,y,R,d),[d]),R.getSnapshot!==h||M||ei!==null&&ei.memoizedState.tag&1){if(y.flags|=2048,Jv(9,V7.bind(null,y,R,P,h),void 0,null),ti===null)throw Error(n(349));(Rf&30)!==0||H7(y,h,P)}return P}function H7(d,h,y){d.flags|=16384,d={getSnapshot:h,value:y},h=Xn.updateQueue,h===null?(h={lastEffect:null,stores:null},Xn.updateQueue=h,h.stores=[d]):(y=h.stores,y===null?h.stores=[d]:y.push(d))}function V7(d,h,y,R){h.value=y,h.getSnapshot=R,q7(h)&&K7(d)}function G7(d,h,y){return y(function(){q7(h)&&K7(d)})}function q7(d){var h=d.getSnapshot;d=d.value;try{var y=h();return!pa(d,y)}catch{return!0}}function K7(d){var h=cc(d,1);h!==null&&_a(h,d,1,-1)}function W7(d){var h=al();return typeof d=="function"&&(d=d()),h.memoizedState=h.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xv,lastRenderedState:d},h.queue=d,d=d.dispatch=$de.bind(null,Xn,d),[h.memoizedState,d]}function Jv(d,h,y,R){return d={tag:d,create:h,destroy:y,deps:R,next:null},h=Xn.updateQueue,h===null?(h={lastEffect:null,stores:null},Xn.updateQueue=h,h.lastEffect=d.next=d):(y=h.lastEffect,y===null?h.lastEffect=d.next=d:(R=y.next,y.next=d,d.next=R,h.lastEffect=d)),d}function z7(){return Eo().memoizedState}function Rb(d,h,y,R){var P=al();Xn.flags|=d,P.memoizedState=Jv(1|h,y,void 0,R===void 0?null:R)}function Ib(d,h,y,R){var P=Eo();R=R===void 0?null:R;var M=void 0;if(jr!==null){var j=jr.memoizedState;if(M=j.destroy,R!==null&&IR(R,j.deps)){P.memoizedState=Jv(h,y,M,R);return}}Xn.flags|=d,P.memoizedState=Jv(1|h,y,M,R)}function Y7(d,h){return Rb(8390656,8,d,h)}function AR(d,h){return Ib(2048,8,d,h)}function X7(d,h){return Ib(4,2,d,h)}function J7(d,h){return Ib(4,4,d,h)}function Z7(d,h){if(typeof h=="function")return d=d(),h(d),function(){h(null)};if(h!=null)return d=d(),h.current=d,function(){h.current=null}}function Q7(d,h,y){return y=y!=null?y.concat([d]):null,Ib(4,4,Z7.bind(null,h,d),y)}function OR(){}function eN(d,h){var y=Eo();h=h===void 0?null:h;var R=y.memoizedState;return R!==null&&h!==null&&IR(h,R[1])?R[0]:(y.memoizedState=[d,h],d)}function tN(d,h){var y=Eo();h=h===void 0?null:h;var R=y.memoizedState;return R!==null&&h!==null&&IR(h,R[1])?R[0]:(d=d(),y.memoizedState=[d,h],d)}function nN(d,h,y){return(Rf&21)===0?(d.baseState&&(d.baseState=!1,hs=!0),d.memoizedState=y):(pa(y,h)||(y=A9(),Xn.lanes|=y,If|=y,d.baseState=!0),h)}function Ude(d,h){var y=on;on=y!==0&&4>y?y:4,d(!0);var R=RR.transition;RR.transition={};try{d(!1),h()}finally{on=y,RR.transition=R}}function rN(){return Eo().memoizedState}function jde(d,h,y){var R=Uu(d);if(y={lane:R,action:y,hasEagerState:!1,eagerState:null,next:null},iN(d))sN(h,y);else if(y=N7(d,h,y,R),y!==null){var P=zi();_a(y,d,R,P),oN(y,h,R)}}function $de(d,h,y){var R=Uu(d),P={lane:R,action:y,hasEagerState:!1,eagerState:null,next:null};if(iN(d))sN(h,P);else{var M=d.alternate;if(d.lanes===0&&(M===null||M.lanes===0)&&(M=h.lastRenderedReducer,M!==null))try{var j=h.lastRenderedState,Y=M(j,y);if(P.hasEagerState=!0,P.eagerState=Y,pa(Y,j)){var J=h.interleaved;J===null?(P.next=P,bR(h)):(P.next=J.next,J.next=P),h.interleaved=P;return}}catch{}finally{}y=N7(d,h,P,R),y!==null&&(P=zi(),_a(y,d,R,P),oN(y,h,R))}}function iN(d){var h=d.alternate;return d===Xn||h!==null&&h===Xn}function sN(d,h){zv=Tb=!0;var y=d.pending;y===null?h.next=h:(h.next=y.next,y.next=h),d.pending=h}function oN(d,h,y){if((y&4194240)!==0){var R=h.lanes;R&=d.pendingLanes,y|=R,h.lanes=y,N3(d,y)}}var kb={readContext:So,useCallback:Oi,useContext:Oi,useEffect:Oi,useImperativeHandle:Oi,useInsertionEffect:Oi,useLayoutEffect:Oi,useMemo:Oi,useReducer:Oi,useRef:Oi,useState:Oi,useDebugValue:Oi,useDeferredValue:Oi,useTransition:Oi,useMutableSource:Oi,useSyncExternalStore:Oi,useId:Oi,unstable_isNewReconciler:!1},Bde={readContext:So,useCallback:function(d,h){return al().memoizedState=[d,h===void 0?null:h],d},useContext:So,useEffect:Y7,useImperativeHandle:function(d,h,y){return y=y!=null?y.concat([d]):null,Rb(4194308,4,Z7.bind(null,h,d),y)},useLayoutEffect:function(d,h){return Rb(4194308,4,d,h)},useInsertionEffect:function(d,h){return Rb(4,2,d,h)},useMemo:function(d,h){var y=al();return h=h===void 0?null:h,d=d(),y.memoizedState=[d,h],d},useReducer:function(d,h,y){var R=al();return h=y!==void 0?y(h):h,R.memoizedState=R.baseState=h,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:h},R.queue=d,d=d.dispatch=jde.bind(null,Xn,d),[R.memoizedState,d]},useRef:function(d){var h=al();return d={current:d},h.memoizedState=d},useState:W7,useDebugValue:OR,useDeferredValue:function(d){return al().memoizedState=d},useTransition:function(){var d=W7(!1),h=d[0];return d=Ude.bind(null,d[1]),al().memoizedState=d,[h,d]},useMutableSource:function(){},useSyncExternalStore:function(d,h,y){var R=Xn,P=al();if($n){if(y===void 0)throw Error(n(407));y=y()}else{if(y=h(),ti===null)throw Error(n(349));(Rf&30)!==0||H7(R,h,y)}P.memoizedState=y;var M={value:y,getSnapshot:h};return P.queue=M,Y7(G7.bind(null,R,M,d),[d]),R.flags|=2048,Jv(9,V7.bind(null,R,M,y,h),void 0,null),y},useId:function(){var d=al(),h=ti.identifierPrefix;if($n){var y=lc,R=ac;y=(R&~(1<<32-ha(R)-1)).toString(32)+y,h=":"+h+"R"+y,y=Yv++,0<y&&(h+="H"+y.toString(32)),h+=":"}else y=Fde++,h=":"+h+"r"+y.toString(32)+":";return d.memoizedState=h},unstable_isNewReconciler:!1},Hde={readContext:So,useCallback:eN,useContext:So,useEffect:AR,useImperativeHandle:Q7,useInsertionEffect:X7,useLayoutEffect:J7,useMemo:tN,useReducer:PR,useRef:z7,useState:function(){return PR(Xv)},useDebugValue:OR,useDeferredValue:function(d){var h=Eo();return nN(h,jr.memoizedState,d)},useTransition:function(){var d=PR(Xv)[0],h=Eo().memoizedState;return[d,h]},useMutableSource:$7,useSyncExternalStore:B7,useId:rN,unstable_isNewReconciler:!1},Vde={readContext:So,useCallback:eN,useContext:So,useEffect:AR,useImperativeHandle:Q7,useInsertionEffect:X7,useLayoutEffect:J7,useMemo:tN,useReducer:LR,useRef:z7,useState:function(){return LR(Xv)},useDebugValue:OR,useDeferredValue:function(d){var h=Eo();return jr===null?h.memoizedState=d:nN(h,jr.memoizedState,d)},useTransition:function(){var d=LR(Xv)[0],h=Eo().memoizedState;return[d,h]},useMutableSource:$7,useSyncExternalStore:B7,useId:rN,unstable_isNewReconciler:!1};function ga(d,h){if(d&&d.defaultProps){h=Z({},h),d=d.defaultProps;for(var y in d)h[y]===void 0&&(h[y]=d[y]);return h}return h}function MR(d,h,y,R){h=d.memoizedState,y=y(R,h),y=y==null?h:Z({},h,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var xb={isMounted:function(d){return(d=d._reactInternals)?_f(d)===d:!1},enqueueSetState:function(d,h,y){d=d._reactInternals;var R=zi(),P=Uu(d),M=uc(R,P);M.payload=h,y!=null&&(M.callback=y),h=Mu(d,M,P),h!==null&&(_a(h,d,P,R),Sb(h,d,P))},enqueueReplaceState:function(d,h,y){d=d._reactInternals;var R=zi(),P=Uu(d),M=uc(R,P);M.tag=1,M.payload=h,y!=null&&(M.callback=y),h=Mu(d,M,P),h!==null&&(_a(h,d,P,R),Sb(h,d,P))},enqueueForceUpdate:function(d,h){d=d._reactInternals;var y=zi(),R=Uu(d),P=uc(y,R);P.tag=2,h!=null&&(P.callback=h),h=Mu(d,P,R),h!==null&&(_a(h,d,R,y),Sb(h,d,R))}};function aN(d,h,y,R,P,M,j){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(R,M,j):h.prototype&&h.prototype.isPureReactComponent?!Fv(y,R)||!Fv(P,M):!0}function lN(d,h,y){var R=!1,P=Lu,M=h.contextType;return typeof M=="object"&&M!==null?M=So(M):(P=fs(h)?Sf:Ai.current,R=h.contextTypes,M=(R=R!=null)?gp(d,P):Lu),h=new h(y,M),d.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=xb,d.stateNode=h,h._reactInternals=d,R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=P,d.__reactInternalMemoizedMaskedChildContext=M),h}function cN(d,h,y,R){d=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,R),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,R),h.state!==d&&xb.enqueueReplaceState(h,h.state,null)}function NR(d,h,y,R){var P=d.stateNode;P.props=y,P.state=d.memoizedState,P.refs={},SR(d);var M=h.contextType;typeof M=="object"&&M!==null?P.context=So(M):(M=fs(h)?Sf:Ai.current,P.context=gp(d,M)),P.state=d.memoizedState,M=h.getDerivedStateFromProps,typeof M=="function"&&(MR(d,h,M,y),P.state=d.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(h=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),h!==P.state&&xb.enqueueReplaceState(P,P.state,null),Eb(d,y,P,R),P.state=d.memoizedState),typeof P.componentDidMount=="function"&&(d.flags|=4194308)}function Cp(d,h){try{var y="",R=h;do y+=Pe(R),R=R.return;while(R);var P=y}catch(M){P=`
Error generating stack: `+M.message+`
`+M.stack}return{value:d,source:h,stack:P,digest:null}}function DR(d,h,y){return{value:d,source:null,stack:y??null,digest:h??null}}function FR(d,h){try{console.error(h.value)}catch(y){setTimeout(function(){throw y})}}var Gde=typeof WeakMap=="function"?WeakMap:Map;function uN(d,h,y){y=uc(-1,y),y.tag=3,y.payload={element:null};var R=h.value;return y.callback=function(){Db||(Db=!0,ZR=R),FR(d,h)},y}function dN(d,h,y){y=uc(-1,y),y.tag=3;var R=d.type.getDerivedStateFromError;if(typeof R=="function"){var P=h.value;y.payload=function(){return R(P)},y.callback=function(){FR(d,h)}}var M=d.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(y.callback=function(){FR(d,h),typeof R!="function"&&(Du===null?Du=new Set([this]):Du.add(this));var j=h.stack;this.componentDidCatch(h.value,{componentStack:j!==null?j:""})}),y}function fN(d,h,y){var R=d.pingCache;if(R===null){R=d.pingCache=new Gde;var P=new Set;R.set(h,P)}else P=R.get(h),P===void 0&&(P=new Set,R.set(h,P));P.has(y)||(P.add(y),d=ife.bind(null,d,h,y),h.then(d,d))}function hN(d){do{var h;if((h=d.tag===13)&&(h=d.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return d;d=d.return}while(d!==null);return null}function pN(d,h,y,R,P){return(d.mode&1)===0?(d===h?d.flags|=65536:(d.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(h=uc(-1,1),h.tag=2,Mu(y,h,1))),y.lanes|=1),d):(d.flags|=65536,d.lanes=P,d)}var qde=T.ReactCurrentOwner,hs=!1;function Wi(d,h,y,R){h.child=d===null?M7(h,null,y,R):bp(h,d.child,y,R)}function mN(d,h,y,R,P){y=y.render;var M=h.ref;return Ep(h,P),R=kR(d,h,y,R,M,P),y=xR(),d!==null&&!hs?(h.updateQueue=d.updateQueue,h.flags&=-2053,d.lanes&=~P,dc(d,h,P)):($n&&y&&dR(h),h.flags|=1,Wi(d,h,R,P),h.child)}function gN(d,h,y,R,P){if(d===null){var M=y.type;return typeof M=="function"&&!sI(M)&&M.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(h.tag=15,h.type=M,vN(d,h,M,R,P)):(d=Hb(y.type,null,R,h,h.mode,P),d.ref=h.ref,d.return=h,h.child=d)}if(M=d.child,(d.lanes&P)===0){var j=M.memoizedProps;if(y=y.compare,y=y!==null?y:Fv,y(j,R)&&d.ref===h.ref)return dc(d,h,P)}return h.flags|=1,d=$u(M,R),d.ref=h.ref,d.return=h,h.child=d}function vN(d,h,y,R,P){if(d!==null){var M=d.memoizedProps;if(Fv(M,R)&&d.ref===h.ref)if(hs=!1,h.pendingProps=R=M,(d.lanes&P)!==0)(d.flags&131072)!==0&&(hs=!0);else return h.lanes=d.lanes,dc(d,h,P)}return UR(d,h,y,R,P)}function yN(d,h,y){var R=h.pendingProps,P=R.children,M=d!==null?d.memoizedState:null;if(R.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cn(Rp,Ws),Ws|=y;else{if((y&1073741824)===0)return d=M!==null?M.baseLanes|y:y,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:d,cachePool:null,transitions:null},h.updateQueue=null,Cn(Rp,Ws),Ws|=d,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=M!==null?M.baseLanes:y,Cn(Rp,Ws),Ws|=R}else M!==null?(R=M.baseLanes|y,h.memoizedState=null):R=y,Cn(Rp,Ws),Ws|=R;return Wi(d,h,P,y),h.child}function _N(d,h){var y=h.ref;(d===null&&y!==null||d!==null&&d.ref!==y)&&(h.flags|=512,h.flags|=2097152)}function UR(d,h,y,R,P){var M=fs(y)?Sf:Ai.current;return M=gp(h,M),Ep(h,P),y=kR(d,h,y,R,M,P),R=xR(),d!==null&&!hs?(h.updateQueue=d.updateQueue,h.flags&=-2053,d.lanes&=~P,dc(d,h,P)):($n&&R&&dR(h),h.flags|=1,Wi(d,h,y,P),h.child)}function bN(d,h,y,R,P){if(fs(y)){var M=!0;hb(h)}else M=!1;if(Ep(h,P),h.stateNode===null)Lb(d,h),lN(h,y,R),NR(h,y,R,P),R=!0;else if(d===null){var j=h.stateNode,Y=h.memoizedProps;j.props=Y;var J=j.context,oe=y.contextType;typeof oe=="object"&&oe!==null?oe=So(oe):(oe=fs(y)?Sf:Ai.current,oe=gp(h,oe));var me=y.getDerivedStateFromProps,ye=typeof me=="function"||typeof j.getSnapshotBeforeUpdate=="function";ye||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(Y!==R||J!==oe)&&cN(h,j,R,oe),Ou=!1;var pe=h.memoizedState;j.state=pe,Eb(h,R,j,P),J=h.memoizedState,Y!==R||pe!==J||ds.current||Ou?(typeof me=="function"&&(MR(h,y,me,R),J=h.memoizedState),(Y=Ou||aN(h,y,Y,R,pe,J,oe))?(ye||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(h.flags|=4194308)):(typeof j.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=R,h.memoizedState=J),j.props=R,j.state=J,j.context=oe,R=Y):(typeof j.componentDidMount=="function"&&(h.flags|=4194308),R=!1)}else{j=h.stateNode,D7(d,h),Y=h.memoizedProps,oe=h.type===h.elementType?Y:ga(h.type,Y),j.props=oe,ye=h.pendingProps,pe=j.context,J=y.contextType,typeof J=="object"&&J!==null?J=So(J):(J=fs(y)?Sf:Ai.current,J=gp(h,J));var Fe=y.getDerivedStateFromProps;(me=typeof Fe=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(Y!==ye||pe!==J)&&cN(h,j,R,J),Ou=!1,pe=h.memoizedState,j.state=pe,Eb(h,R,j,P);var $e=h.memoizedState;Y!==ye||pe!==$e||ds.current||Ou?(typeof Fe=="function"&&(MR(h,y,Fe,R),$e=h.memoizedState),(oe=Ou||aN(h,y,oe,R,pe,$e,J)||!1)?(me||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(R,$e,J),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(R,$e,J)),typeof j.componentDidUpdate=="function"&&(h.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof j.componentDidUpdate!="function"||Y===d.memoizedProps&&pe===d.memoizedState||(h.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||Y===d.memoizedProps&&pe===d.memoizedState||(h.flags|=1024),h.memoizedProps=R,h.memoizedState=$e),j.props=R,j.state=$e,j.context=J,R=oe):(typeof j.componentDidUpdate!="function"||Y===d.memoizedProps&&pe===d.memoizedState||(h.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||Y===d.memoizedProps&&pe===d.memoizedState||(h.flags|=1024),R=!1)}return jR(d,h,y,R,M,P)}function jR(d,h,y,R,P,M){_N(d,h);var j=(h.flags&128)!==0;if(!R&&!j)return P&&T7(h,y,!1),dc(d,h,M);R=h.stateNode,qde.current=h;var Y=j&&typeof y.getDerivedStateFromError!="function"?null:R.render();return h.flags|=1,d!==null&&j?(h.child=bp(h,d.child,null,M),h.child=bp(h,null,Y,M)):Wi(d,h,Y,M),h.memoizedState=R.state,P&&T7(h,y,!0),h.child}function SN(d){var h=d.stateNode;h.pendingContext?w7(d,h.pendingContext,h.pendingContext!==h.context):h.context&&w7(d,h.context,!1),ER(d,h.containerInfo)}function EN(d,h,y,R,P){return _p(),mR(P),h.flags|=256,Wi(d,h,y,R),h.child}var $R={dehydrated:null,treeContext:null,retryLane:0};function BR(d){return{baseLanes:d,cachePool:null,transitions:null}}function wN(d,h,y){var R=h.pendingProps,P=Yn.current,M=!1,j=(h.flags&128)!==0,Y;if((Y=j)||(Y=d!==null&&d.memoizedState===null?!1:(P&2)!==0),Y?(M=!0,h.flags&=-129):(d===null||d.memoizedState!==null)&&(P|=1),Cn(Yn,P&1),d===null)return pR(h),d=h.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((h.mode&1)===0?h.lanes=1:d.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(j=R.children,d=R.fallback,M?(R=h.mode,M=h.child,j={mode:"hidden",children:j},(R&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=j):M=Vb(j,R,0,null),d=Lf(d,R,y,null),M.return=h,d.return=h,M.sibling=d,h.child=M,h.child.memoizedState=BR(y),h.memoizedState=$R,d):HR(h,j));if(P=d.memoizedState,P!==null&&(Y=P.dehydrated,Y!==null))return Kde(d,h,j,R,Y,P,y);if(M){M=R.fallback,j=h.mode,P=d.child,Y=P.sibling;var J={mode:"hidden",children:R.children};return(j&1)===0&&h.child!==P?(R=h.child,R.childLanes=0,R.pendingProps=J,h.deletions=null):(R=$u(P,J),R.subtreeFlags=P.subtreeFlags&14680064),Y!==null?M=$u(Y,M):(M=Lf(M,j,y,null),M.flags|=2),M.return=h,R.return=h,R.sibling=M,h.child=R,R=M,M=h.child,j=d.child.memoizedState,j=j===null?BR(y):{baseLanes:j.baseLanes|y,cachePool:null,transitions:j.transitions},M.memoizedState=j,M.childLanes=d.childLanes&~y,h.memoizedState=$R,R}return M=d.child,d=M.sibling,R=$u(M,{mode:"visible",children:R.children}),(h.mode&1)===0&&(R.lanes=y),R.return=h,R.sibling=null,d!==null&&(y=h.deletions,y===null?(h.deletions=[d],h.flags|=16):y.push(d)),h.child=R,h.memoizedState=null,R}function HR(d,h){return h=Vb({mode:"visible",children:h},d.mode,0,null),h.return=d,d.child=h}function Pb(d,h,y,R){return R!==null&&mR(R),bp(h,d.child,null,y),d=HR(h,h.pendingProps.children),d.flags|=2,h.memoizedState=null,d}function Kde(d,h,y,R,P,M,j){if(y)return h.flags&256?(h.flags&=-257,R=DR(Error(n(422))),Pb(d,h,j,R)):h.memoizedState!==null?(h.child=d.child,h.flags|=128,null):(M=R.fallback,P=h.mode,R=Vb({mode:"visible",children:R.children},P,0,null),M=Lf(M,P,j,null),M.flags|=2,R.return=h,M.return=h,R.sibling=M,h.child=R,(h.mode&1)!==0&&bp(h,d.child,null,j),h.child.memoizedState=BR(j),h.memoizedState=$R,M);if((h.mode&1)===0)return Pb(d,h,j,null);if(P.data==="$!"){if(R=P.nextSibling&&P.nextSibling.dataset,R)var Y=R.dgst;return R=Y,M=Error(n(419)),R=DR(M,R,void 0),Pb(d,h,j,R)}if(Y=(j&d.childLanes)!==0,hs||Y){if(R=ti,R!==null){switch(j&-j){case 4:P=2;break;case 16:P=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:P=32;break;case 536870912:P=268435456;break;default:P=0}P=(P&(R.suspendedLanes|j))!==0?0:P,P!==0&&P!==M.retryLane&&(M.retryLane=P,cc(d,P),_a(R,d,P,-1))}return iI(),R=DR(Error(n(421))),Pb(d,h,j,R)}return P.data==="$?"?(h.flags|=128,h.child=d.child,h=sfe.bind(null,d),P._reactRetry=h,null):(d=M.treeContext,Ks=xu(P.nextSibling),qs=h,$n=!0,ma=null,d!==null&&(_o[bo++]=ac,_o[bo++]=lc,_o[bo++]=Ef,ac=d.id,lc=d.overflow,Ef=h),h=HR(h,R.children),h.flags|=4096,h)}function CN(d,h,y){d.lanes|=h;var R=d.alternate;R!==null&&(R.lanes|=h),_R(d.return,h,y)}function VR(d,h,y,R,P){var M=d.memoizedState;M===null?d.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:R,tail:y,tailMode:P}:(M.isBackwards=h,M.rendering=null,M.renderingStartTime=0,M.last=R,M.tail=y,M.tailMode=P)}function TN(d,h,y){var R=h.pendingProps,P=R.revealOrder,M=R.tail;if(Wi(d,h,R.children,y),R=Yn.current,(R&2)!==0)R=R&1|2,h.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=h.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&CN(d,y,h);else if(d.tag===19)CN(d,y,h);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===h)break e;for(;d.sibling===null;){if(d.return===null||d.return===h)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}R&=1}if(Cn(Yn,R),(h.mode&1)===0)h.memoizedState=null;else switch(P){case"forwards":for(y=h.child,P=null;y!==null;)d=y.alternate,d!==null&&wb(d)===null&&(P=y),y=y.sibling;y=P,y===null?(P=h.child,h.child=null):(P=y.sibling,y.sibling=null),VR(h,!1,P,y,M);break;case"backwards":for(y=null,P=h.child,h.child=null;P!==null;){if(d=P.alternate,d!==null&&wb(d)===null){h.child=P;break}d=P.sibling,P.sibling=y,y=P,P=d}VR(h,!0,y,null,M);break;case"together":VR(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Lb(d,h){(h.mode&1)===0&&d!==null&&(d.alternate=null,h.alternate=null,h.flags|=2)}function dc(d,h,y){if(d!==null&&(h.dependencies=d.dependencies),If|=h.lanes,(y&h.childLanes)===0)return null;if(d!==null&&h.child!==d.child)throw Error(n(153));if(h.child!==null){for(d=h.child,y=$u(d,d.pendingProps),h.child=y,y.return=h;d.sibling!==null;)d=d.sibling,y=y.sibling=$u(d,d.pendingProps),y.return=h;y.sibling=null}return h.child}function Wde(d,h,y){switch(h.tag){case 3:SN(h),_p();break;case 5:j7(h);break;case 1:fs(h.type)&&hb(h);break;case 4:ER(h,h.stateNode.containerInfo);break;case 10:var R=h.type._context,P=h.memoizedProps.value;Cn(_b,R._currentValue),R._currentValue=P;break;case 13:if(R=h.memoizedState,R!==null)return R.dehydrated!==null?(Cn(Yn,Yn.current&1),h.flags|=128,null):(y&h.child.childLanes)!==0?wN(d,h,y):(Cn(Yn,Yn.current&1),d=dc(d,h,y),d!==null?d.sibling:null);Cn(Yn,Yn.current&1);break;case 19:if(R=(y&h.childLanes)!==0,(d.flags&128)!==0){if(R)return TN(d,h,y);h.flags|=128}if(P=h.memoizedState,P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),Cn(Yn,Yn.current),R)break;return null;case 22:case 23:return h.lanes=0,yN(d,h,y)}return dc(d,h,y)}var RN,GR,IN,kN;RN=function(d,h){for(var y=h.child;y!==null;){if(y.tag===5||y.tag===6)d.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===h)break;for(;y.sibling===null;){if(y.return===null||y.return===h)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},GR=function(){},IN=function(d,h,y,R){var P=d.memoizedProps;if(P!==R){d=h.stateNode,Tf(ol.current);var M=null;switch(y){case"input":P=ze(d,P),R=ze(d,R),M=[];break;case"select":P=Z({},P,{value:void 0}),R=Z({},R,{value:void 0}),M=[];break;case"textarea":P=_u(d,P),R=_u(d,R),M=[];break;default:typeof P.onClick!="function"&&typeof R.onClick=="function"&&(d.onclick=ub)}mn(y,R);var j;y=null;for(oe in P)if(!R.hasOwnProperty(oe)&&P.hasOwnProperty(oe)&&P[oe]!=null)if(oe==="style"){var Y=P[oe];for(j in Y)Y.hasOwnProperty(j)&&(y||(y={}),y[j]="")}else oe!=="dangerouslySetInnerHTML"&&oe!=="children"&&oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&oe!=="autoFocus"&&(i.hasOwnProperty(oe)?M||(M=[]):(M=M||[]).push(oe,null));for(oe in R){var J=R[oe];if(Y=P!=null?P[oe]:void 0,R.hasOwnProperty(oe)&&J!==Y&&(J!=null||Y!=null))if(oe==="style")if(Y){for(j in Y)!Y.hasOwnProperty(j)||J&&J.hasOwnProperty(j)||(y||(y={}),y[j]="");for(j in J)J.hasOwnProperty(j)&&Y[j]!==J[j]&&(y||(y={}),y[j]=J[j])}else y||(M||(M=[]),M.push(oe,y)),y=J;else oe==="dangerouslySetInnerHTML"?(J=J?J.__html:void 0,Y=Y?Y.__html:void 0,J!=null&&Y!==J&&(M=M||[]).push(oe,J)):oe==="children"?typeof J!="string"&&typeof J!="number"||(M=M||[]).push(oe,""+J):oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&(i.hasOwnProperty(oe)?(J!=null&&oe==="onScroll"&&Pn("scroll",d),M||Y===J||(M=[])):(M=M||[]).push(oe,J))}y&&(M=M||[]).push("style",y);var oe=M;(h.updateQueue=oe)&&(h.flags|=4)}},kN=function(d,h,y,R){y!==R&&(h.flags|=4)};function Zv(d,h){if(!$n)switch(d.tailMode){case"hidden":h=d.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var R=null;y!==null;)y.alternate!==null&&(R=y),y=y.sibling;R===null?h||d.tail===null?d.tail=null:d.tail.sibling=null:R.sibling=null}}function Mi(d){var h=d.alternate!==null&&d.alternate.child===d.child,y=0,R=0;if(h)for(var P=d.child;P!==null;)y|=P.lanes|P.childLanes,R|=P.subtreeFlags&14680064,R|=P.flags&14680064,P.return=d,P=P.sibling;else for(P=d.child;P!==null;)y|=P.lanes|P.childLanes,R|=P.subtreeFlags,R|=P.flags,P.return=d,P=P.sibling;return d.subtreeFlags|=R,d.childLanes=y,h}function zde(d,h,y){var R=h.pendingProps;switch(fR(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mi(h),null;case 1:return fs(h.type)&&fb(),Mi(h),null;case 3:return R=h.stateNode,wp(),Ln(ds),Ln(Ai),TR(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(d===null||d.child===null)&&(vb(h)?h.flags|=4:d===null||d.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,ma!==null&&(tI(ma),ma=null))),GR(d,h),Mi(h),null;case 5:wR(h);var P=Tf(Wv.current);if(y=h.type,d!==null&&h.stateNode!=null)IN(d,h,y,R,P),d.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!R){if(h.stateNode===null)throw Error(n(166));return Mi(h),null}if(d=Tf(ol.current),vb(h)){R=h.stateNode,y=h.type;var M=h.memoizedProps;switch(R[sl]=h,R[Hv]=M,d=(h.mode&1)!==0,y){case"dialog":Pn("cancel",R),Pn("close",R);break;case"iframe":case"object":case"embed":Pn("load",R);break;case"video":case"audio":for(P=0;P<jv.length;P++)Pn(jv[P],R);break;case"source":Pn("error",R);break;case"img":case"image":case"link":Pn("error",R),Pn("load",R);break;case"details":Pn("toggle",R);break;case"input":Fr(R,M),Pn("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!M.multiple},Pn("invalid",R);break;case"textarea":Hs(R,M),Pn("invalid",R)}mn(y,M),P=null;for(var j in M)if(M.hasOwnProperty(j)){var Y=M[j];j==="children"?typeof Y=="string"?R.textContent!==Y&&(M.suppressHydrationWarning!==!0&&cb(R.textContent,Y,d),P=["children",Y]):typeof Y=="number"&&R.textContent!==""+Y&&(M.suppressHydrationWarning!==!0&&cb(R.textContent,Y,d),P=["children",""+Y]):i.hasOwnProperty(j)&&Y!=null&&j==="onScroll"&&Pn("scroll",R)}switch(y){case"input":pn(R),nc(R,M,!0);break;case"textarea":pn(R),bu(R);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(R.onclick=ub)}R=P,h.updateQueue=R,R!==null&&(h.flags|=4)}else{j=P.nodeType===9?P:P.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=yf(y)),d==="http://www.w3.org/1999/xhtml"?y==="script"?(d=j.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof R.is=="string"?d=j.createElement(y,{is:R.is}):(d=j.createElement(y),y==="select"&&(j=d,R.multiple?j.multiple=!0:R.size&&(j.size=R.size))):d=j.createElementNS(d,y),d[sl]=h,d[Hv]=R,RN(d,h,!1,!1),h.stateNode=d;e:{switch(j=jn(y,R),y){case"dialog":Pn("cancel",d),Pn("close",d),P=R;break;case"iframe":case"object":case"embed":Pn("load",d),P=R;break;case"video":case"audio":for(P=0;P<jv.length;P++)Pn(jv[P],d);P=R;break;case"source":Pn("error",d),P=R;break;case"img":case"image":case"link":Pn("error",d),Pn("load",d),P=R;break;case"details":Pn("toggle",d),P=R;break;case"input":Fr(d,R),P=ze(d,R),Pn("invalid",d);break;case"option":P=R;break;case"select":d._wrapperState={wasMultiple:!!R.multiple},P=Z({},R,{value:void 0}),Pn("invalid",d);break;case"textarea":Hs(d,R),P=_u(d,R),Pn("invalid",d);break;default:P=R}mn(y,P),Y=P;for(M in Y)if(Y.hasOwnProperty(M)){var J=Y[M];M==="style"?op(d,J):M==="dangerouslySetInnerHTML"?(J=J?J.__html:void 0,J!=null&&sp(d,J)):M==="children"?typeof J=="string"?(y!=="textarea"||J!=="")&&rl(d,J):typeof J=="number"&&rl(d,""+J):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(i.hasOwnProperty(M)?J!=null&&M==="onScroll"&&Pn("scroll",d):J!=null&&k(d,M,J,j))}switch(y){case"input":pn(d),nc(d,R,!1);break;case"textarea":pn(d),bu(d);break;case"option":R.value!=null&&d.setAttribute("value",""+we(R.value));break;case"select":d.multiple=!!R.multiple,M=R.value,M!=null?la(d,!!R.multiple,M,!1):R.defaultValue!=null&&la(d,!!R.multiple,R.defaultValue,!0);break;default:typeof P.onClick=="function"&&(d.onclick=ub)}switch(y){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Mi(h),null;case 6:if(d&&h.stateNode!=null)kN(d,h,d.memoizedProps,R);else{if(typeof R!="string"&&h.stateNode===null)throw Error(n(166));if(y=Tf(Wv.current),Tf(ol.current),vb(h)){if(R=h.stateNode,y=h.memoizedProps,R[sl]=h,(M=R.nodeValue!==y)&&(d=qs,d!==null))switch(d.tag){case 3:cb(R.nodeValue,y,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&cb(R.nodeValue,y,(d.mode&1)!==0)}M&&(h.flags|=4)}else R=(y.nodeType===9?y:y.ownerDocument).createTextNode(R),R[sl]=h,h.stateNode=R}return Mi(h),null;case 13:if(Ln(Yn),R=h.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if($n&&Ks!==null&&(h.mode&1)!==0&&(h.flags&128)===0)L7(),_p(),h.flags|=98560,M=!1;else if(M=vb(h),R!==null&&R.dehydrated!==null){if(d===null){if(!M)throw Error(n(318));if(M=h.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(n(317));M[sl]=h}else _p(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Mi(h),M=!1}else ma!==null&&(tI(ma),ma=null),M=!0;if(!M)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=y,h):(R=R!==null,R!==(d!==null&&d.memoizedState!==null)&&R&&(h.child.flags|=8192,(h.mode&1)!==0&&(d===null||(Yn.current&1)!==0?$r===0&&($r=3):iI())),h.updateQueue!==null&&(h.flags|=4),Mi(h),null);case 4:return wp(),GR(d,h),d===null&&$v(h.stateNode.containerInfo),Mi(h),null;case 10:return yR(h.type._context),Mi(h),null;case 17:return fs(h.type)&&fb(),Mi(h),null;case 19:if(Ln(Yn),M=h.memoizedState,M===null)return Mi(h),null;if(R=(h.flags&128)!==0,j=M.rendering,j===null)if(R)Zv(M,!1);else{if($r!==0||d!==null&&(d.flags&128)!==0)for(d=h.child;d!==null;){if(j=wb(d),j!==null){for(h.flags|=128,Zv(M,!1),R=j.updateQueue,R!==null&&(h.updateQueue=R,h.flags|=4),h.subtreeFlags=0,R=y,y=h.child;y!==null;)M=y,d=R,M.flags&=14680066,j=M.alternate,j===null?(M.childLanes=0,M.lanes=d,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=j.childLanes,M.lanes=j.lanes,M.child=j.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=j.memoizedProps,M.memoizedState=j.memoizedState,M.updateQueue=j.updateQueue,M.type=j.type,d=j.dependencies,M.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),y=y.sibling;return Cn(Yn,Yn.current&1|2),h.child}d=d.sibling}M.tail!==null&&pr()>Ip&&(h.flags|=128,R=!0,Zv(M,!1),h.lanes=4194304)}else{if(!R)if(d=wb(j),d!==null){if(h.flags|=128,R=!0,y=d.updateQueue,y!==null&&(h.updateQueue=y,h.flags|=4),Zv(M,!0),M.tail===null&&M.tailMode==="hidden"&&!j.alternate&&!$n)return Mi(h),null}else 2*pr()-M.renderingStartTime>Ip&&y!==1073741824&&(h.flags|=128,R=!0,Zv(M,!1),h.lanes=4194304);M.isBackwards?(j.sibling=h.child,h.child=j):(y=M.last,y!==null?y.sibling=j:h.child=j,M.last=j)}return M.tail!==null?(h=M.tail,M.rendering=h,M.tail=h.sibling,M.renderingStartTime=pr(),h.sibling=null,y=Yn.current,Cn(Yn,R?y&1|2:y&1),h):(Mi(h),null);case 22:case 23:return rI(),R=h.memoizedState!==null,d!==null&&d.memoizedState!==null!==R&&(h.flags|=8192),R&&(h.mode&1)!==0?(Ws&1073741824)!==0&&(Mi(h),h.subtreeFlags&6&&(h.flags|=8192)):Mi(h),null;case 24:return null;case 25:return null}throw Error(n(156,h.tag))}function Yde(d,h){switch(fR(h),h.tag){case 1:return fs(h.type)&&fb(),d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 3:return wp(),Ln(ds),Ln(Ai),TR(),d=h.flags,(d&65536)!==0&&(d&128)===0?(h.flags=d&-65537|128,h):null;case 5:return wR(h),null;case 13:if(Ln(Yn),d=h.memoizedState,d!==null&&d.dehydrated!==null){if(h.alternate===null)throw Error(n(340));_p()}return d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 19:return Ln(Yn),null;case 4:return wp(),null;case 10:return yR(h.type._context),null;case 22:case 23:return rI(),null;case 24:return null;default:return null}}var Ab=!1,Ni=!1,Xde=typeof WeakSet=="function"?WeakSet:Set,Ue=null;function Tp(d,h){var y=d.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(R){ir(d,h,R)}else y.current=null}function qR(d,h,y){try{y()}catch(R){ir(d,h,R)}}var xN=!1;function Jde(d,h){if(rR=Z_,d=a7(),Y3(d)){if("selectionStart"in d)var y={start:d.selectionStart,end:d.selectionEnd};else e:{y=(y=d.ownerDocument)&&y.defaultView||window;var R=y.getSelection&&y.getSelection();if(R&&R.rangeCount!==0){y=R.anchorNode;var P=R.anchorOffset,M=R.focusNode;R=R.focusOffset;try{y.nodeType,M.nodeType}catch{y=null;break e}var j=0,Y=-1,J=-1,oe=0,me=0,ye=d,pe=null;t:for(;;){for(var Fe;ye!==y||P!==0&&ye.nodeType!==3||(Y=j+P),ye!==M||R!==0&&ye.nodeType!==3||(J=j+R),ye.nodeType===3&&(j+=ye.nodeValue.length),(Fe=ye.firstChild)!==null;)pe=ye,ye=Fe;for(;;){if(ye===d)break t;if(pe===y&&++oe===P&&(Y=j),pe===M&&++me===R&&(J=j),(Fe=ye.nextSibling)!==null)break;ye=pe,pe=ye.parentNode}ye=Fe}y=Y===-1||J===-1?null:{start:Y,end:J}}else y=null}y=y||{start:0,end:0}}else y=null;for(iR={focusedElem:d,selectionRange:y},Z_=!1,Ue=h;Ue!==null;)if(h=Ue,d=h.child,(h.subtreeFlags&1028)!==0&&d!==null)d.return=h,Ue=d;else for(;Ue!==null;){h=Ue;try{var $e=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if($e!==null){var He=$e.memoizedProps,mr=$e.memoizedState,ne=h.stateNode,te=ne.getSnapshotBeforeUpdate(h.elementType===h.type?He:ga(h.type,He),mr);ne.__reactInternalSnapshotBeforeUpdate=te}break;case 3:var re=h.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Ee){ir(h,h.return,Ee)}if(d=h.sibling,d!==null){d.return=h.return,Ue=d;break}Ue=h.return}return $e=xN,xN=!1,$e}function Qv(d,h,y){var R=h.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var P=R=R.next;do{if((P.tag&d)===d){var M=P.destroy;P.destroy=void 0,M!==void 0&&qR(h,y,M)}P=P.next}while(P!==R)}}function Ob(d,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var y=h=h.next;do{if((y.tag&d)===d){var R=y.create;y.destroy=R()}y=y.next}while(y!==h)}}function KR(d){var h=d.ref;if(h!==null){var y=d.stateNode;switch(d.tag){case 5:d=y;break;default:d=y}typeof h=="function"?h(d):h.current=d}}function PN(d){var h=d.alternate;h!==null&&(d.alternate=null,PN(h)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(h=d.stateNode,h!==null&&(delete h[sl],delete h[Hv],delete h[lR],delete h[Ode],delete h[Mde])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function LN(d){return d.tag===5||d.tag===3||d.tag===4}function AN(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||LN(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function WR(d,h,y){var R=d.tag;if(R===5||R===6)d=d.stateNode,h?y.nodeType===8?y.parentNode.insertBefore(d,h):y.insertBefore(d,h):(y.nodeType===8?(h=y.parentNode,h.insertBefore(d,y)):(h=y,h.appendChild(d)),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=ub));else if(R!==4&&(d=d.child,d!==null))for(WR(d,h,y),d=d.sibling;d!==null;)WR(d,h,y),d=d.sibling}function zR(d,h,y){var R=d.tag;if(R===5||R===6)d=d.stateNode,h?y.insertBefore(d,h):y.appendChild(d);else if(R!==4&&(d=d.child,d!==null))for(zR(d,h,y),d=d.sibling;d!==null;)zR(d,h,y),d=d.sibling}var gi=null,va=!1;function Nu(d,h,y){for(y=y.child;y!==null;)ON(d,h,y),y=y.sibling}function ON(d,h,y){if(il&&typeof il.onCommitFiberUnmount=="function")try{il.onCommitFiberUnmount(K_,y)}catch{}switch(y.tag){case 5:Ni||Tp(y,h);case 6:var R=gi,P=va;gi=null,Nu(d,h,y),gi=R,va=P,gi!==null&&(va?(d=gi,y=y.stateNode,d.nodeType===8?d.parentNode.removeChild(y):d.removeChild(y)):gi.removeChild(y.stateNode));break;case 18:gi!==null&&(va?(d=gi,y=y.stateNode,d.nodeType===8?aR(d.parentNode,y):d.nodeType===1&&aR(d,y),Lv(d)):aR(gi,y.stateNode));break;case 4:R=gi,P=va,gi=y.stateNode.containerInfo,va=!0,Nu(d,h,y),gi=R,va=P;break;case 0:case 11:case 14:case 15:if(!Ni&&(R=y.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){P=R=R.next;do{var M=P,j=M.destroy;M=M.tag,j!==void 0&&((M&2)!==0||(M&4)!==0)&&qR(y,h,j),P=P.next}while(P!==R)}Nu(d,h,y);break;case 1:if(!Ni&&(Tp(y,h),R=y.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=y.memoizedProps,R.state=y.memoizedState,R.componentWillUnmount()}catch(Y){ir(y,h,Y)}Nu(d,h,y);break;case 21:Nu(d,h,y);break;case 22:y.mode&1?(Ni=(R=Ni)||y.memoizedState!==null,Nu(d,h,y),Ni=R):Nu(d,h,y);break;default:Nu(d,h,y)}}function MN(d){var h=d.updateQueue;if(h!==null){d.updateQueue=null;var y=d.stateNode;y===null&&(y=d.stateNode=new Xde),h.forEach(function(R){var P=ofe.bind(null,d,R);y.has(R)||(y.add(R),R.then(P,P))})}}function ya(d,h){var y=h.deletions;if(y!==null)for(var R=0;R<y.length;R++){var P=y[R];try{var M=d,j=h,Y=j;e:for(;Y!==null;){switch(Y.tag){case 5:gi=Y.stateNode,va=!1;break e;case 3:gi=Y.stateNode.containerInfo,va=!0;break e;case 4:gi=Y.stateNode.containerInfo,va=!0;break e}Y=Y.return}if(gi===null)throw Error(n(160));ON(M,j,P),gi=null,va=!1;var J=P.alternate;J!==null&&(J.return=null),P.return=null}catch(oe){ir(P,h,oe)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)NN(h,d),h=h.sibling}function NN(d,h){var y=d.alternate,R=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(ya(h,d),ll(d),R&4){try{Qv(3,d,d.return),Ob(3,d)}catch(He){ir(d,d.return,He)}try{Qv(5,d,d.return)}catch(He){ir(d,d.return,He)}}break;case 1:ya(h,d),ll(d),R&512&&y!==null&&Tp(y,y.return);break;case 5:if(ya(h,d),ll(d),R&512&&y!==null&&Tp(y,y.return),d.flags&32){var P=d.stateNode;try{rl(P,"")}catch(He){ir(d,d.return,He)}}if(R&4&&(P=d.stateNode,P!=null)){var M=d.memoizedProps,j=y!==null?y.memoizedProps:M,Y=d.type,J=d.updateQueue;if(d.updateQueue=null,J!==null)try{Y==="input"&&M.type==="radio"&&M.name!=null&&Tr(P,M),jn(Y,j);var oe=jn(Y,M);for(j=0;j<J.length;j+=2){var me=J[j],ye=J[j+1];me==="style"?op(P,ye):me==="dangerouslySetInnerHTML"?sp(P,ye):me==="children"?rl(P,ye):k(P,me,ye,oe)}switch(Y){case"input":Ki(P,M);break;case"textarea":vf(P,M);break;case"select":var pe=P._wrapperState.wasMultiple;P._wrapperState.wasMultiple=!!M.multiple;var Fe=M.value;Fe!=null?la(P,!!M.multiple,Fe,!1):pe!==!!M.multiple&&(M.defaultValue!=null?la(P,!!M.multiple,M.defaultValue,!0):la(P,!!M.multiple,M.multiple?[]:"",!1))}P[Hv]=M}catch(He){ir(d,d.return,He)}}break;case 6:if(ya(h,d),ll(d),R&4){if(d.stateNode===null)throw Error(n(162));P=d.stateNode,M=d.memoizedProps;try{P.nodeValue=M}catch(He){ir(d,d.return,He)}}break;case 3:if(ya(h,d),ll(d),R&4&&y!==null&&y.memoizedState.isDehydrated)try{Lv(h.containerInfo)}catch(He){ir(d,d.return,He)}break;case 4:ya(h,d),ll(d);break;case 13:ya(h,d),ll(d),P=d.child,P.flags&8192&&(M=P.memoizedState!==null,P.stateNode.isHidden=M,!M||P.alternate!==null&&P.alternate.memoizedState!==null||(JR=pr())),R&4&&MN(d);break;case 22:if(me=y!==null&&y.memoizedState!==null,d.mode&1?(Ni=(oe=Ni)||me,ya(h,d),Ni=oe):ya(h,d),ll(d),R&8192){if(oe=d.memoizedState!==null,(d.stateNode.isHidden=oe)&&!me&&(d.mode&1)!==0)for(Ue=d,me=d.child;me!==null;){for(ye=Ue=me;Ue!==null;){switch(pe=Ue,Fe=pe.child,pe.tag){case 0:case 11:case 14:case 15:Qv(4,pe,pe.return);break;case 1:Tp(pe,pe.return);var $e=pe.stateNode;if(typeof $e.componentWillUnmount=="function"){R=pe,y=pe.return;try{h=R,$e.props=h.memoizedProps,$e.state=h.memoizedState,$e.componentWillUnmount()}catch(He){ir(R,y,He)}}break;case 5:Tp(pe,pe.return);break;case 22:if(pe.memoizedState!==null){UN(ye);continue}}Fe!==null?(Fe.return=pe,Ue=Fe):UN(ye)}me=me.sibling}e:for(me=null,ye=d;;){if(ye.tag===5){if(me===null){me=ye;try{P=ye.stateNode,oe?(M=P.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(Y=ye.stateNode,J=ye.memoizedProps.style,j=J!=null&&J.hasOwnProperty("display")?J.display:null,Y.style.display=Vs("display",j))}catch(He){ir(d,d.return,He)}}}else if(ye.tag===6){if(me===null)try{ye.stateNode.nodeValue=oe?"":ye.memoizedProps}catch(He){ir(d,d.return,He)}}else if((ye.tag!==22&&ye.tag!==23||ye.memoizedState===null||ye===d)&&ye.child!==null){ye.child.return=ye,ye=ye.child;continue}if(ye===d)break e;for(;ye.sibling===null;){if(ye.return===null||ye.return===d)break e;me===ye&&(me=null),ye=ye.return}me===ye&&(me=null),ye.sibling.return=ye.return,ye=ye.sibling}}break;case 19:ya(h,d),ll(d),R&4&&MN(d);break;case 21:break;default:ya(h,d),ll(d)}}function ll(d){var h=d.flags;if(h&2){try{e:{for(var y=d.return;y!==null;){if(LN(y)){var R=y;break e}y=y.return}throw Error(n(160))}switch(R.tag){case 5:var P=R.stateNode;R.flags&32&&(rl(P,""),R.flags&=-33);var M=AN(d);zR(d,M,P);break;case 3:case 4:var j=R.stateNode.containerInfo,Y=AN(d);WR(d,Y,j);break;default:throw Error(n(161))}}catch(J){ir(d,d.return,J)}d.flags&=-3}h&4096&&(d.flags&=-4097)}function Zde(d,h,y){Ue=d,DN(d)}function DN(d,h,y){for(var R=(d.mode&1)!==0;Ue!==null;){var P=Ue,M=P.child;if(P.tag===22&&R){var j=P.memoizedState!==null||Ab;if(!j){var Y=P.alternate,J=Y!==null&&Y.memoizedState!==null||Ni;Y=Ab;var oe=Ni;if(Ab=j,(Ni=J)&&!oe)for(Ue=P;Ue!==null;)j=Ue,J=j.child,j.tag===22&&j.memoizedState!==null?jN(P):J!==null?(J.return=j,Ue=J):jN(P);for(;M!==null;)Ue=M,DN(M),M=M.sibling;Ue=P,Ab=Y,Ni=oe}FN(d)}else(P.subtreeFlags&8772)!==0&&M!==null?(M.return=P,Ue=M):FN(d)}}function FN(d){for(;Ue!==null;){var h=Ue;if((h.flags&8772)!==0){var y=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:Ni||Ob(5,h);break;case 1:var R=h.stateNode;if(h.flags&4&&!Ni)if(y===null)R.componentDidMount();else{var P=h.elementType===h.type?y.memoizedProps:ga(h.type,y.memoizedProps);R.componentDidUpdate(P,y.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var M=h.updateQueue;M!==null&&U7(h,M,R);break;case 3:var j=h.updateQueue;if(j!==null){if(y=null,h.child!==null)switch(h.child.tag){case 5:y=h.child.stateNode;break;case 1:y=h.child.stateNode}U7(h,j,y)}break;case 5:var Y=h.stateNode;if(y===null&&h.flags&4){y=Y;var J=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":J.autoFocus&&y.focus();break;case"img":J.src&&(y.src=J.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var oe=h.alternate;if(oe!==null){var me=oe.memoizedState;if(me!==null){var ye=me.dehydrated;ye!==null&&Lv(ye)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Ni||h.flags&512&&KR(h)}catch(pe){ir(h,h.return,pe)}}if(h===d){Ue=null;break}if(y=h.sibling,y!==null){y.return=h.return,Ue=y;break}Ue=h.return}}function UN(d){for(;Ue!==null;){var h=Ue;if(h===d){Ue=null;break}var y=h.sibling;if(y!==null){y.return=h.return,Ue=y;break}Ue=h.return}}function jN(d){for(;Ue!==null;){var h=Ue;try{switch(h.tag){case 0:case 11:case 15:var y=h.return;try{Ob(4,h)}catch(J){ir(h,y,J)}break;case 1:var R=h.stateNode;if(typeof R.componentDidMount=="function"){var P=h.return;try{R.componentDidMount()}catch(J){ir(h,P,J)}}var M=h.return;try{KR(h)}catch(J){ir(h,M,J)}break;case 5:var j=h.return;try{KR(h)}catch(J){ir(h,j,J)}}}catch(J){ir(h,h.return,J)}if(h===d){Ue=null;break}var Y=h.sibling;if(Y!==null){Y.return=h.return,Ue=Y;break}Ue=h.return}}var Qde=Math.ceil,Mb=T.ReactCurrentDispatcher,YR=T.ReactCurrentOwner,wo=T.ReactCurrentBatchConfig,Ut=0,ti=null,Ir=null,vi=0,Ws=0,Rp=Pu(0),$r=0,e0=null,If=0,Nb=0,XR=0,t0=null,ps=null,JR=0,Ip=1/0,fc=null,Db=!1,ZR=null,Du=null,Fb=!1,Fu=null,Ub=0,n0=0,QR=null,jb=-1,$b=0;function zi(){return(Ut&6)!==0?pr():jb!==-1?jb:jb=pr()}function Uu(d){return(d.mode&1)===0?1:(Ut&2)!==0&&vi!==0?vi&-vi:Dde.transition!==null?($b===0&&($b=A9()),$b):(d=on,d!==0||(d=window.event,d=d===void 0?16:B9(d.type)),d)}function _a(d,h,y,R){if(50<n0)throw n0=0,QR=null,Error(n(185));Rv(d,y,R),((Ut&2)===0||d!==ti)&&(d===ti&&((Ut&2)===0&&(Nb|=y),$r===4&&ju(d,vi)),ms(d,R),y===1&&Ut===0&&(h.mode&1)===0&&(Ip=pr()+500,pb&&Au()))}function ms(d,h){var y=d.callbackNode;Due(d,h);var R=Y_(d,d===ti?vi:0);if(R===0)y!==null&&x9(y),d.callbackNode=null,d.callbackPriority=0;else if(h=R&-R,d.callbackPriority!==h){if(y!=null&&x9(y),h===1)d.tag===0?Nde(BN.bind(null,d)):R7(BN.bind(null,d)),Lde(function(){(Ut&6)===0&&Au()}),y=null;else{switch(O9(R)){case 1:y=A3;break;case 4:y=P9;break;case 16:y=q_;break;case 536870912:y=L9;break;default:y=q_}y=YN(y,$N.bind(null,d))}d.callbackPriority=h,d.callbackNode=y}}function $N(d,h){if(jb=-1,$b=0,(Ut&6)!==0)throw Error(n(327));var y=d.callbackNode;if(kp()&&d.callbackNode!==y)return null;var R=Y_(d,d===ti?vi:0);if(R===0)return null;if((R&30)!==0||(R&d.expiredLanes)!==0||h)h=Bb(d,R);else{h=R;var P=Ut;Ut|=2;var M=VN();(ti!==d||vi!==h)&&(fc=null,Ip=pr()+500,xf(d,h));do try{nfe();break}catch(Y){HN(d,Y)}while(!0);vR(),Mb.current=M,Ut=P,Ir!==null?h=0:(ti=null,vi=0,h=$r)}if(h!==0){if(h===2&&(P=O3(d),P!==0&&(R=P,h=eI(d,P))),h===1)throw y=e0,xf(d,0),ju(d,R),ms(d,pr()),y;if(h===6)ju(d,R);else{if(P=d.current.alternate,(R&30)===0&&!efe(P)&&(h=Bb(d,R),h===2&&(M=O3(d),M!==0&&(R=M,h=eI(d,M))),h===1))throw y=e0,xf(d,0),ju(d,R),ms(d,pr()),y;switch(d.finishedWork=P,d.finishedLanes=R,h){case 0:case 1:throw Error(n(345));case 2:Pf(d,ps,fc);break;case 3:if(ju(d,R),(R&130023424)===R&&(h=JR+500-pr(),10<h)){if(Y_(d,0)!==0)break;if(P=d.suspendedLanes,(P&R)!==R){zi(),d.pingedLanes|=d.suspendedLanes&P;break}d.timeoutHandle=oR(Pf.bind(null,d,ps,fc),h);break}Pf(d,ps,fc);break;case 4:if(ju(d,R),(R&4194240)===R)break;for(h=d.eventTimes,P=-1;0<R;){var j=31-ha(R);M=1<<j,j=h[j],j>P&&(P=j),R&=~M}if(R=P,R=pr()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*Qde(R/1960))-R,10<R){d.timeoutHandle=oR(Pf.bind(null,d,ps,fc),R);break}Pf(d,ps,fc);break;case 5:Pf(d,ps,fc);break;default:throw Error(n(329))}}}return ms(d,pr()),d.callbackNode===y?$N.bind(null,d):null}function eI(d,h){var y=t0;return d.current.memoizedState.isDehydrated&&(xf(d,h).flags|=256),d=Bb(d,h),d!==2&&(h=ps,ps=y,h!==null&&tI(h)),d}function tI(d){ps===null?ps=d:ps.push.apply(ps,d)}function efe(d){for(var h=d;;){if(h.flags&16384){var y=h.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var R=0;R<y.length;R++){var P=y[R],M=P.getSnapshot;P=P.value;try{if(!pa(M(),P))return!1}catch{return!1}}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function ju(d,h){for(h&=~XR,h&=~Nb,d.suspendedLanes|=h,d.pingedLanes&=~h,d=d.expirationTimes;0<h;){var y=31-ha(h),R=1<<y;d[y]=-1,h&=~R}}function BN(d){if((Ut&6)!==0)throw Error(n(327));kp();var h=Y_(d,0);if((h&1)===0)return ms(d,pr()),null;var y=Bb(d,h);if(d.tag!==0&&y===2){var R=O3(d);R!==0&&(h=R,y=eI(d,R))}if(y===1)throw y=e0,xf(d,0),ju(d,h),ms(d,pr()),y;if(y===6)throw Error(n(345));return d.finishedWork=d.current.alternate,d.finishedLanes=h,Pf(d,ps,fc),ms(d,pr()),null}function nI(d,h){var y=Ut;Ut|=1;try{return d(h)}finally{Ut=y,Ut===0&&(Ip=pr()+500,pb&&Au())}}function kf(d){Fu!==null&&Fu.tag===0&&(Ut&6)===0&&kp();var h=Ut;Ut|=1;var y=wo.transition,R=on;try{if(wo.transition=null,on=1,d)return d()}finally{on=R,wo.transition=y,Ut=h,(Ut&6)===0&&Au()}}function rI(){Ws=Rp.current,Ln(Rp)}function xf(d,h){d.finishedWork=null,d.finishedLanes=0;var y=d.timeoutHandle;if(y!==-1&&(d.timeoutHandle=-1,Pde(y)),Ir!==null)for(y=Ir.return;y!==null;){var R=y;switch(fR(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&fb();break;case 3:wp(),Ln(ds),Ln(Ai),TR();break;case 5:wR(R);break;case 4:wp();break;case 13:Ln(Yn);break;case 19:Ln(Yn);break;case 10:yR(R.type._context);break;case 22:case 23:rI()}y=y.return}if(ti=d,Ir=d=$u(d.current,null),vi=Ws=h,$r=0,e0=null,XR=Nb=If=0,ps=t0=null,Cf!==null){for(h=0;h<Cf.length;h++)if(y=Cf[h],R=y.interleaved,R!==null){y.interleaved=null;var P=R.next,M=y.pending;if(M!==null){var j=M.next;M.next=P,R.next=j}y.pending=R}Cf=null}return d}function HN(d,h){do{var y=Ir;try{if(vR(),Cb.current=kb,Tb){for(var R=Xn.memoizedState;R!==null;){var P=R.queue;P!==null&&(P.pending=null),R=R.next}Tb=!1}if(Rf=0,ei=jr=Xn=null,zv=!1,Yv=0,YR.current=null,y===null||y.return===null){$r=1,e0=h,Ir=null;break}e:{var M=d,j=y.return,Y=y,J=h;if(h=vi,Y.flags|=32768,J!==null&&typeof J=="object"&&typeof J.then=="function"){var oe=J,me=Y,ye=me.tag;if((me.mode&1)===0&&(ye===0||ye===11||ye===15)){var pe=me.alternate;pe?(me.updateQueue=pe.updateQueue,me.memoizedState=pe.memoizedState,me.lanes=pe.lanes):(me.updateQueue=null,me.memoizedState=null)}var Fe=hN(j);if(Fe!==null){Fe.flags&=-257,pN(Fe,j,Y,M,h),Fe.mode&1&&fN(M,oe,h),h=Fe,J=oe;var $e=h.updateQueue;if($e===null){var He=new Set;He.add(J),h.updateQueue=He}else $e.add(J);break e}else{if((h&1)===0){fN(M,oe,h),iI();break e}J=Error(n(426))}}else if($n&&Y.mode&1){var mr=hN(j);if(mr!==null){(mr.flags&65536)===0&&(mr.flags|=256),pN(mr,j,Y,M,h),mR(Cp(J,Y));break e}}M=J=Cp(J,Y),$r!==4&&($r=2),t0===null?t0=[M]:t0.push(M),M=j;do{switch(M.tag){case 3:M.flags|=65536,h&=-h,M.lanes|=h;var ne=uN(M,J,h);F7(M,ne);break e;case 1:Y=J;var te=M.type,re=M.stateNode;if((M.flags&128)===0&&(typeof te.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Du===null||!Du.has(re)))){M.flags|=65536,h&=-h,M.lanes|=h;var Ee=dN(M,Y,h);F7(M,Ee);break e}}M=M.return}while(M!==null)}qN(y)}catch(Ge){h=Ge,Ir===y&&y!==null&&(Ir=y=y.return);continue}break}while(!0)}function VN(){var d=Mb.current;return Mb.current=kb,d===null?kb:d}function iI(){($r===0||$r===3||$r===2)&&($r=4),ti===null||(If&268435455)===0&&(Nb&268435455)===0||ju(ti,vi)}function Bb(d,h){var y=Ut;Ut|=2;var R=VN();(ti!==d||vi!==h)&&(fc=null,xf(d,h));do try{tfe();break}catch(P){HN(d,P)}while(!0);if(vR(),Ut=y,Mb.current=R,Ir!==null)throw Error(n(261));return ti=null,vi=0,$r}function tfe(){for(;Ir!==null;)GN(Ir)}function nfe(){for(;Ir!==null&&!Iue();)GN(Ir)}function GN(d){var h=zN(d.alternate,d,Ws);d.memoizedProps=d.pendingProps,h===null?qN(d):Ir=h,YR.current=null}function qN(d){var h=d;do{var y=h.alternate;if(d=h.return,(h.flags&32768)===0){if(y=zde(y,h,Ws),y!==null){Ir=y;return}}else{if(y=Yde(y,h),y!==null){y.flags&=32767,Ir=y;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{$r=6,Ir=null;return}}if(h=h.sibling,h!==null){Ir=h;return}Ir=h=d}while(h!==null);$r===0&&($r=5)}function Pf(d,h,y){var R=on,P=wo.transition;try{wo.transition=null,on=1,rfe(d,h,y,R)}finally{wo.transition=P,on=R}return null}function rfe(d,h,y,R){do kp();while(Fu!==null);if((Ut&6)!==0)throw Error(n(327));y=d.finishedWork;var P=d.finishedLanes;if(y===null)return null;if(d.finishedWork=null,d.finishedLanes=0,y===d.current)throw Error(n(177));d.callbackNode=null,d.callbackPriority=0;var M=y.lanes|y.childLanes;if(Fue(d,M),d===ti&&(Ir=ti=null,vi=0),(y.subtreeFlags&2064)===0&&(y.flags&2064)===0||Fb||(Fb=!0,YN(q_,function(){return kp(),null})),M=(y.flags&15990)!==0,(y.subtreeFlags&15990)!==0||M){M=wo.transition,wo.transition=null;var j=on;on=1;var Y=Ut;Ut|=4,YR.current=null,Jde(d,y),NN(y,d),wde(iR),Z_=!!rR,iR=rR=null,d.current=y,Zde(y),kue(),Ut=Y,on=j,wo.transition=M}else d.current=y;if(Fb&&(Fb=!1,Fu=d,Ub=P),M=d.pendingLanes,M===0&&(Du=null),Lue(y.stateNode),ms(d,pr()),h!==null)for(R=d.onRecoverableError,y=0;y<h.length;y++)P=h[y],R(P.value,{componentStack:P.stack,digest:P.digest});if(Db)throw Db=!1,d=ZR,ZR=null,d;return(Ub&1)!==0&&d.tag!==0&&kp(),M=d.pendingLanes,(M&1)!==0?d===QR?n0++:(n0=0,QR=d):n0=0,Au(),null}function kp(){if(Fu!==null){var d=O9(Ub),h=wo.transition,y=on;try{if(wo.transition=null,on=16>d?16:d,Fu===null)var R=!1;else{if(d=Fu,Fu=null,Ub=0,(Ut&6)!==0)throw Error(n(331));var P=Ut;for(Ut|=4,Ue=d.current;Ue!==null;){var M=Ue,j=M.child;if((Ue.flags&16)!==0){var Y=M.deletions;if(Y!==null){for(var J=0;J<Y.length;J++){var oe=Y[J];for(Ue=oe;Ue!==null;){var me=Ue;switch(me.tag){case 0:case 11:case 15:Qv(8,me,M)}var ye=me.child;if(ye!==null)ye.return=me,Ue=ye;else for(;Ue!==null;){me=Ue;var pe=me.sibling,Fe=me.return;if(PN(me),me===oe){Ue=null;break}if(pe!==null){pe.return=Fe,Ue=pe;break}Ue=Fe}}}var $e=M.alternate;if($e!==null){var He=$e.child;if(He!==null){$e.child=null;do{var mr=He.sibling;He.sibling=null,He=mr}while(He!==null)}}Ue=M}}if((M.subtreeFlags&2064)!==0&&j!==null)j.return=M,Ue=j;else e:for(;Ue!==null;){if(M=Ue,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:Qv(9,M,M.return)}var ne=M.sibling;if(ne!==null){ne.return=M.return,Ue=ne;break e}Ue=M.return}}var te=d.current;for(Ue=te;Ue!==null;){j=Ue;var re=j.child;if((j.subtreeFlags&2064)!==0&&re!==null)re.return=j,Ue=re;else e:for(j=te;Ue!==null;){if(Y=Ue,(Y.flags&2048)!==0)try{switch(Y.tag){case 0:case 11:case 15:Ob(9,Y)}}catch(Ge){ir(Y,Y.return,Ge)}if(Y===j){Ue=null;break e}var Ee=Y.sibling;if(Ee!==null){Ee.return=Y.return,Ue=Ee;break e}Ue=Y.return}}if(Ut=P,Au(),il&&typeof il.onPostCommitFiberRoot=="function")try{il.onPostCommitFiberRoot(K_,d)}catch{}R=!0}return R}finally{on=y,wo.transition=h}}return!1}function KN(d,h,y){h=Cp(y,h),h=uN(d,h,1),d=Mu(d,h,1),h=zi(),d!==null&&(Rv(d,1,h),ms(d,h))}function ir(d,h,y){if(d.tag===3)KN(d,d,y);else for(;h!==null;){if(h.tag===3){KN(h,d,y);break}else if(h.tag===1){var R=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Du===null||!Du.has(R))){d=Cp(y,d),d=dN(h,d,1),h=Mu(h,d,1),d=zi(),h!==null&&(Rv(h,1,d),ms(h,d));break}}h=h.return}}function ife(d,h,y){var R=d.pingCache;R!==null&&R.delete(h),h=zi(),d.pingedLanes|=d.suspendedLanes&y,ti===d&&(vi&y)===y&&($r===4||$r===3&&(vi&130023424)===vi&&500>pr()-JR?xf(d,0):XR|=y),ms(d,h)}function WN(d,h){h===0&&((d.mode&1)===0?h=1:(h=z_,z_<<=1,(z_&130023424)===0&&(z_=4194304)));var y=zi();d=cc(d,h),d!==null&&(Rv(d,h,y),ms(d,y))}function sfe(d){var h=d.memoizedState,y=0;h!==null&&(y=h.retryLane),WN(d,y)}function ofe(d,h){var y=0;switch(d.tag){case 13:var R=d.stateNode,P=d.memoizedState;P!==null&&(y=P.retryLane);break;case 19:R=d.stateNode;break;default:throw Error(n(314))}R!==null&&R.delete(h),WN(d,y)}var zN;zN=function(d,h,y){if(d!==null)if(d.memoizedProps!==h.pendingProps||ds.current)hs=!0;else{if((d.lanes&y)===0&&(h.flags&128)===0)return hs=!1,Wde(d,h,y);hs=(d.flags&131072)!==0}else hs=!1,$n&&(h.flags&1048576)!==0&&I7(h,gb,h.index);switch(h.lanes=0,h.tag){case 2:var R=h.type;Lb(d,h),d=h.pendingProps;var P=gp(h,Ai.current);Ep(h,y),P=kR(null,h,R,d,P,y);var M=xR();return h.flags|=1,typeof P=="object"&&P!==null&&typeof P.render=="function"&&P.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,fs(R)?(M=!0,hb(h)):M=!1,h.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,SR(h),P.updater=xb,h.stateNode=P,P._reactInternals=h,NR(h,R,d,y),h=jR(null,h,R,!0,M,y)):(h.tag=0,$n&&M&&dR(h),Wi(null,h,P,y),h=h.child),h;case 16:R=h.elementType;e:{switch(Lb(d,h),d=h.pendingProps,P=R._init,R=P(R._payload),h.type=R,P=h.tag=lfe(R),d=ga(R,d),P){case 0:h=UR(null,h,R,d,y);break e;case 1:h=bN(null,h,R,d,y);break e;case 11:h=mN(null,h,R,d,y);break e;case 14:h=gN(null,h,R,ga(R.type,d),y);break e}throw Error(n(306,R,""))}return h;case 0:return R=h.type,P=h.pendingProps,P=h.elementType===R?P:ga(R,P),UR(d,h,R,P,y);case 1:return R=h.type,P=h.pendingProps,P=h.elementType===R?P:ga(R,P),bN(d,h,R,P,y);case 3:e:{if(SN(h),d===null)throw Error(n(387));R=h.pendingProps,M=h.memoizedState,P=M.element,D7(d,h),Eb(h,R,null,y);var j=h.memoizedState;if(R=j.element,M.isDehydrated)if(M={element:R,isDehydrated:!1,cache:j.cache,pendingSuspenseBoundaries:j.pendingSuspenseBoundaries,transitions:j.transitions},h.updateQueue.baseState=M,h.memoizedState=M,h.flags&256){P=Cp(Error(n(423)),h),h=EN(d,h,R,y,P);break e}else if(R!==P){P=Cp(Error(n(424)),h),h=EN(d,h,R,y,P);break e}else for(Ks=xu(h.stateNode.containerInfo.firstChild),qs=h,$n=!0,ma=null,y=M7(h,null,R,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(_p(),R===P){h=dc(d,h,y);break e}Wi(d,h,R,y)}h=h.child}return h;case 5:return j7(h),d===null&&pR(h),R=h.type,P=h.pendingProps,M=d!==null?d.memoizedProps:null,j=P.children,sR(R,P)?j=null:M!==null&&sR(R,M)&&(h.flags|=32),_N(d,h),Wi(d,h,j,y),h.child;case 6:return d===null&&pR(h),null;case 13:return wN(d,h,y);case 4:return ER(h,h.stateNode.containerInfo),R=h.pendingProps,d===null?h.child=bp(h,null,R,y):Wi(d,h,R,y),h.child;case 11:return R=h.type,P=h.pendingProps,P=h.elementType===R?P:ga(R,P),mN(d,h,R,P,y);case 7:return Wi(d,h,h.pendingProps,y),h.child;case 8:return Wi(d,h,h.pendingProps.children,y),h.child;case 12:return Wi(d,h,h.pendingProps.children,y),h.child;case 10:e:{if(R=h.type._context,P=h.pendingProps,M=h.memoizedProps,j=P.value,Cn(_b,R._currentValue),R._currentValue=j,M!==null)if(pa(M.value,j)){if(M.children===P.children&&!ds.current){h=dc(d,h,y);break e}}else for(M=h.child,M!==null&&(M.return=h);M!==null;){var Y=M.dependencies;if(Y!==null){j=M.child;for(var J=Y.firstContext;J!==null;){if(J.context===R){if(M.tag===1){J=uc(-1,y&-y),J.tag=2;var oe=M.updateQueue;if(oe!==null){oe=oe.shared;var me=oe.pending;me===null?J.next=J:(J.next=me.next,me.next=J),oe.pending=J}}M.lanes|=y,J=M.alternate,J!==null&&(J.lanes|=y),_R(M.return,y,h),Y.lanes|=y;break}J=J.next}}else if(M.tag===10)j=M.type===h.type?null:M.child;else if(M.tag===18){if(j=M.return,j===null)throw Error(n(341));j.lanes|=y,Y=j.alternate,Y!==null&&(Y.lanes|=y),_R(j,y,h),j=M.sibling}else j=M.child;if(j!==null)j.return=M;else for(j=M;j!==null;){if(j===h){j=null;break}if(M=j.sibling,M!==null){M.return=j.return,j=M;break}j=j.return}M=j}Wi(d,h,P.children,y),h=h.child}return h;case 9:return P=h.type,R=h.pendingProps.children,Ep(h,y),P=So(P),R=R(P),h.flags|=1,Wi(d,h,R,y),h.child;case 14:return R=h.type,P=ga(R,h.pendingProps),P=ga(R.type,P),gN(d,h,R,P,y);case 15:return vN(d,h,h.type,h.pendingProps,y);case 17:return R=h.type,P=h.pendingProps,P=h.elementType===R?P:ga(R,P),Lb(d,h),h.tag=1,fs(R)?(d=!0,hb(h)):d=!1,Ep(h,y),lN(h,R,P),NR(h,R,P,y),jR(null,h,R,!0,d,y);case 19:return TN(d,h,y);case 22:return yN(d,h,y)}throw Error(n(156,h.tag))};function YN(d,h){return k9(d,h)}function afe(d,h,y,R){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Co(d,h,y,R){return new afe(d,h,y,R)}function sI(d){return d=d.prototype,!(!d||!d.isReactComponent)}function lfe(d){if(typeof d=="function")return sI(d)?1:0;if(d!=null){if(d=d.$$typeof,d===$)return 11;if(d===H)return 14}return 2}function $u(d,h){var y=d.alternate;return y===null?(y=Co(d.tag,h,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=h,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&14680064,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,h=d.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y}function Hb(d,h,y,R,P,M){var j=2;if(R=d,typeof d=="function")sI(d)&&(j=1);else if(typeof d=="string")j=5;else e:switch(d){case x:return Lf(y.children,P,M,h);case A:j=8,P|=8;break;case N:return d=Co(12,y,h,P|2),d.elementType=N,d.lanes=M,d;case B:return d=Co(13,y,h,P),d.elementType=B,d.lanes=M,d;case W:return d=Co(19,y,h,P),d.elementType=W,d.lanes=M,d;case K:return Vb(y,P,M,h);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case D:j=10;break e;case F:j=9;break e;case $:j=11;break e;case H:j=14;break e;case z:j=16,R=null;break e}throw Error(n(130,d==null?d:typeof d,""))}return h=Co(j,y,h,P),h.elementType=d,h.type=R,h.lanes=M,h}function Lf(d,h,y,R){return d=Co(7,d,R,h),d.lanes=y,d}function Vb(d,h,y,R){return d=Co(22,d,R,h),d.elementType=K,d.lanes=y,d.stateNode={isHidden:!1},d}function oI(d,h,y){return d=Co(6,d,null,h),d.lanes=y,d}function aI(d,h,y){return h=Co(4,d.children!==null?d.children:[],d.key,h),h.lanes=y,h.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},h}function cfe(d,h,y,R,P){this.tag=h,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=M3(0),this.expirationTimes=M3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=M3(0),this.identifierPrefix=R,this.onRecoverableError=P,this.mutableSourceEagerHydrationData=null}function lI(d,h,y,R,P,M,j,Y,J){return d=new cfe(d,h,y,Y,J),h===1?(h=1,M===!0&&(h|=8)):h=0,M=Co(3,null,null,h),d.current=M,M.stateNode=d,M.memoizedState={element:R,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},SR(M),d}function ufe(d,h,y){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:C,key:R==null?null:""+R,children:d,containerInfo:h,implementation:y}}function XN(d){if(!d)return Lu;d=d._reactInternals;e:{if(_f(d)!==d||d.tag!==1)throw Error(n(170));var h=d;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(fs(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(n(171))}if(d.tag===1){var y=d.type;if(fs(y))return C7(d,y,h)}return h}function JN(d,h,y,R,P,M,j,Y,J){return d=lI(y,R,!0,d,P,M,j,Y,J),d.context=XN(null),y=d.current,R=zi(),P=Uu(y),M=uc(R,P),M.callback=h??null,Mu(y,M,P),d.current.lanes=P,Rv(d,P,R),ms(d,R),d}function Gb(d,h,y,R){var P=h.current,M=zi(),j=Uu(P);return y=XN(y),h.context===null?h.context=y:h.pendingContext=y,h=uc(M,j),h.payload={element:d},R=R===void 0?null:R,R!==null&&(h.callback=R),d=Mu(P,h,j),d!==null&&(_a(d,P,j,M),Sb(d,P,j)),j}function qb(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function ZN(d,h){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<h?y:h}}function cI(d,h){ZN(d,h),(d=d.alternate)&&ZN(d,h)}function dfe(){return null}var QN=typeof reportError=="function"?reportError:function(d){console.error(d)};function uI(d){this._internalRoot=d}Kb.prototype.render=uI.prototype.render=function(d){var h=this._internalRoot;if(h===null)throw Error(n(409));Gb(d,h,null,null)},Kb.prototype.unmount=uI.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var h=d.containerInfo;kf(function(){Gb(null,d,null,null)}),h[sc]=null}};function Kb(d){this._internalRoot=d}Kb.prototype.unstable_scheduleHydration=function(d){if(d){var h=D9();d={blockedOn:null,target:d,priority:h};for(var y=0;y<Ru.length&&h!==0&&h<Ru[y].priority;y++);Ru.splice(y,0,d),y===0&&j9(d)}};function dI(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Wb(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function eD(){}function ffe(d,h,y,R,P){if(P){if(typeof R=="function"){var M=R;R=function(){var oe=qb(j);M.call(oe)}}var j=JN(h,R,d,0,null,!1,!1,"",eD);return d._reactRootContainer=j,d[sc]=j.current,$v(d.nodeType===8?d.parentNode:d),kf(),j}for(;P=d.lastChild;)d.removeChild(P);if(typeof R=="function"){var Y=R;R=function(){var oe=qb(J);Y.call(oe)}}var J=lI(d,0,!1,null,null,!1,!1,"",eD);return d._reactRootContainer=J,d[sc]=J.current,$v(d.nodeType===8?d.parentNode:d),kf(function(){Gb(h,J,y,R)}),J}function zb(d,h,y,R,P){var M=y._reactRootContainer;if(M){var j=M;if(typeof P=="function"){var Y=P;P=function(){var J=qb(j);Y.call(J)}}Gb(h,j,d,P)}else j=ffe(y,h,d,P,R);return qb(j)}M9=function(d){switch(d.tag){case 3:var h=d.stateNode;if(h.current.memoizedState.isDehydrated){var y=Tv(h.pendingLanes);y!==0&&(N3(h,y|1),ms(h,pr()),(Ut&6)===0&&(Ip=pr()+500,Au()))}break;case 13:kf(function(){var R=cc(d,1);if(R!==null){var P=zi();_a(R,d,1,P)}}),cI(d,1)}},D3=function(d){if(d.tag===13){var h=cc(d,134217728);if(h!==null){var y=zi();_a(h,d,134217728,y)}cI(d,134217728)}},N9=function(d){if(d.tag===13){var h=Uu(d),y=cc(d,h);if(y!==null){var R=zi();_a(y,d,h,R)}cI(d,h)}},D9=function(){return on},F9=function(d,h){var y=on;try{return on=d,h()}finally{on=y}},Tt=function(d,h,y){switch(h){case"input":if(Ki(d,y),h=y.name,y.type==="radio"&&h!=null){for(y=d;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<y.length;h++){var R=y[h];if(R!==d&&R.form===d.form){var P=db(R);if(!P)throw Error(n(90));hr(R),Ki(R,P)}}}break;case"textarea":vf(d,y);break;case"select":h=y.value,h!=null&&la(d,!!y.multiple,h,!1)}},ua=nI,us=kf;var hfe={usingClientEntryPoint:!1,Events:[Vv,pp,db,Ur,Rr,nI]},r0={findFiberByHostInstance:bf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pfe={bundleType:r0.bundleType,version:r0.version,rendererPackageName:r0.rendererPackageName,rendererConfig:r0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=R9(d),d===null?null:d.stateNode},findFiberByHostInstance:r0.findFiberByHostInstance||dfe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yb.isDisabled&&Yb.supportsFiber)try{K_=Yb.inject(pfe),il=Yb}catch{}}return vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hfe,vs.createPortal=function(d,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dI(h))throw Error(n(200));return ufe(d,h,null,y)},vs.createRoot=function(d,h){if(!dI(d))throw Error(n(299));var y=!1,R="",P=QN;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(R=h.identifierPrefix),h.onRecoverableError!==void 0&&(P=h.onRecoverableError)),h=lI(d,1,!1,null,null,y,!1,R,P),d[sc]=h.current,$v(d.nodeType===8?d.parentNode:d),new uI(h)},vs.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var h=d._reactInternals;if(h===void 0)throw typeof d.render=="function"?Error(n(188)):(d=Object.keys(d).join(","),Error(n(268,d)));return d=R9(h),d=d===null?null:d.stateNode,d},vs.flushSync=function(d){return kf(d)},vs.hydrate=function(d,h,y){if(!Wb(h))throw Error(n(200));return zb(null,d,h,!0,y)},vs.hydrateRoot=function(d,h,y){if(!dI(d))throw Error(n(405));var R=y!=null&&y.hydratedSources||null,P=!1,M="",j=QN;if(y!=null&&(y.unstable_strictMode===!0&&(P=!0),y.identifierPrefix!==void 0&&(M=y.identifierPrefix),y.onRecoverableError!==void 0&&(j=y.onRecoverableError)),h=JN(h,null,d,1,y??null,P,!1,M,j),d[sc]=h.current,$v(d),R)for(d=0;d<R.length;d++)y=R[d],P=y._getVersion,P=P(y._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[y,P]:h.mutableSourceEagerHydrationData.push(y,P);return new Kb(h)},vs.render=function(d,h,y){if(!Wb(h))throw Error(n(200));return zb(null,d,h,!1,y)},vs.unmountComponentAtNode=function(d){if(!Wb(d))throw Error(n(40));return d._reactRootContainer?(kf(function(){zb(null,null,d,!1,function(){d._reactRootContainer=null,d[sc]=null})}),!0):!1},vs.unstable_batchedUpdates=nI,vs.unstable_renderSubtreeIntoContainer=function(d,h,y,R){if(!Wb(y))throw Error(n(200));if(d==null||d._reactInternals===void 0)throw Error(n(38));return zb(d,h,y,!1,R)},vs.version="18.3.1-next-f1338f8080-20240426",vs}var sU;function Mz(){if(sU)return HI.exports;sU=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),HI.exports=Kge(),HI.exports}var oU;function Wge(){if(oU)return uS;oU=1;var t=Mz();return uS.createRoot=t.createRoot,uS.hydrateRoot=t.hydrateRoot,uS}var zge=Wge(),aU={};function Yge(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var Xge=Object.defineProperty,Jge=(t,e,n)=>e in t?Xge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lU=(t,e,n)=>Jge(t,typeof e!="symbol"?e+"":e,n);let ts=class{constructor(){lU(this,"_locking"),lU(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}};function ur(t,e){if(!t)throw new Error(e)}const Zge=34028234663852886e22,Qge=-34028234663852886e22,eve=4294967295,tve=2147483647,nve=-2147483648;function L2(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>tve||t<nve)throw new Error("invalid int 32: "+t)}function Ix(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>eve||t<0)throw new Error("invalid uint 32: "+t)}function Nz(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>Zge||t<Qge))throw new Error("invalid float 32: "+t)}const Dz=Symbol("@bufbuild/protobuf/enum-type");function rve(t){const e=t[Dz];return ur(e,"missing enum type on enum object"),e}function Fz(t,e,n,r){t[Dz]=Uz(e,n.map(i=>({no:i.no,name:i.name,localName:t[i.no]})))}function Uz(t,e,n){const r=Object.create(null),i=Object.create(null),s=[];for(const o of e){const a=jz(o);s.push(a),r[o.name]=a,i[o.no]=a}return{typeName:t,values:s,findName(o){return r[o]},findNumber(o){return i[o]}}}function ive(t,e,n){const r={};for(const i of e){const s=jz(i);r[s.localName]=s.no,r[s.no]=s.localName}return Fz(r,t,e),r}function jz(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class fA{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(n);return i.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(n);return i.readMessage(r,e,s,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,i=r.makeWriteOptions(e),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function sve(t,e,n,r){var i;const s=(i=r==null?void 0:r.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new fA),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,l){return new o().fromBinary(a,l)},fromJson(a,l){return new o().fromJson(a,l)},fromJsonString(a,l){return new o().fromJsonString(a,l)},equals(a,l){return t.util.equals(o,a,l)}}),o}function ove(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function qI(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(n.push(l),!a)return}const r=t>>>28&15|(e&7)<<4,i=e>>3!=0;if(n.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),l=(a?o|128:o)&255;if(n.push(l),!a)return}n.push(e>>>31&1)}}const A2=4294967296;function cU(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let r=0,i=0;function s(o,a){const l=Number(t.slice(o,a));i*=n,r=r*n+l,r>=A2&&(i=i+(r/A2|0),r=r%A2)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?Bz(r,i):hA(r,i)}function ave(t,e){let n=hA(t,e);const r=n.hi&2147483648;r&&(n=Bz(n.lo,n.hi));const i=$z(n.lo,n.hi);return r?"-"+i:i}function $z(t,e){if({lo:t,hi:e}=lve(t,e),e<=2097151)return String(A2*e+t);const n=t&16777215,r=(t>>>24|e<<8)&16777215,i=e>>16&65535;let s=n+r*6777216+i*6710656,o=r+i*8147497,a=i*2;const l=1e7;return s>=l&&(o+=Math.floor(s/l),s%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+uU(o)+uU(s)}function lve(t,e){return{lo:t>>>0,hi:e>>>0}}function hA(t,e){return{lo:t|0,hi:e|0}}function Bz(t,e){return e=~e,t?t=~t+1:e+=1,hA(t,e)}const uU=t=>{const e=String(t);return"0000000".slice(e.length)+e};function dU(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function cve(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function uve(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof aU!="object"||aU.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<i)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>a||c<o)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=i=>ur(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>ur(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),n(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),n(i),cU(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),cU(i)},dec(i,s){return ave(i,s)},uDec(i,s){return $z(i,s)}}}const Wn=uve();var fe;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(fe||(fe={}));var Ud;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Ud||(Ud={}));function Gu(t,e,n){if(e===n)return!0;if(t==fe.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(t){case fe.UINT64:case fe.FIXED64:case fe.INT64:case fe.SFIXED64:case fe.SINT64:return e==n}return!1}function dg(t,e){switch(t){case fe.BOOL:return!1;case fe.UINT64:case fe.FIXED64:case fe.INT64:case fe.SFIXED64:case fe.SINT64:return e==0?Wn.zero:"0";case fe.DOUBLE:case fe.FLOAT:return 0;case fe.BYTES:return new Uint8Array(0);case fe.STRING:return"";default:return 0}}function Hz(t,e){switch(t){case fe.BOOL:return e===!1;case fe.STRING:return e==="";case fe.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var yr;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(yr||(yr={}));class dve{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Ix(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return L2(e),dU(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Nz(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Ix(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){L2(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return L2(e),e=(e<<1^e>>31)>>>0,dU(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=Wn.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=Wn.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=Wn.enc(e);return qI(n.lo,n.hi,this.buf),this}sint64(e){let n=Wn.enc(e),r=n.hi>>31,i=n.lo<<1^r,s=(n.hi<<1|n.lo>>>31)^r;return qI(i,s,this.buf),this}uint64(e){let n=Wn.uEnc(e);return qI(n.lo,n.hi,this.buf),this}}class fve{constructor(e,n){this.varint64=ove,this.uint32=cve,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case yr.Varint:for(;this.buf[this.pos++]&128;);break;case yr.Bit64:this.pos+=4;case yr.Bit32:this.pos+=4;break;case yr.LengthDelimited:let i=this.uint32();this.pos+=i;break;case yr.StartGroup:for(;;){const[s,o]=this.tag();if(o===yr.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Wn.dec(...this.varint64())}uint64(){return Wn.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,Wn.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Wn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Wn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function hve(t,e,n,r){let i;return{typeName:e,extendee:n,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),i=t.util.newFieldList([s]).list()[0]}return i},runtime:t}}function Vz(t){const e=t.field.localName,n=Object.create(null);return n[e]=pve(t),[n,()=>n[e]]}function pve(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return dg(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function mve(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Ac="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),UC=[];for(let t=0;t<Ac.length;t++)UC[Ac[t].charCodeAt(0)]=t;UC[45]=Ac.indexOf("+");UC[95]=Ac.indexOf("/");const Gz={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,i=0,s,o=0;for(let a=0;a<t.length;a++){if(s=UC[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=s,i=1;break;case 1:n[r++]=o<<2|(s&48)>>4,o=s,i=2;break;case 2:n[r++]=(o&15)<<4|(s&60)>>2,o=s,i=3;break;case 3:n[r++]=(o&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(t){let e="",n=0,r,i=0;for(let s=0;s<t.length;s++)switch(r=t[s],n){case 0:e+=Ac[r>>2],i=(r&3)<<4,n=1;break;case 1:e+=Ac[i|r>>4],i=(r&15)<<2,n=2;break;case 2:e+=Ac[i|r>>6],e+=Ac[r&63],n=0;break}return n&&(e+=Ac[i],e+="=",n==1&&(e+="=")),e}};function gve(t,e,n){Kz(e,t);const r=e.runtime.bin.makeReadOptions(n),i=mve(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=Vz(e);for(const a of i)e.runtime.bin.readField(s,r.readerFactory(a.data),e.field,a.wireType,r);return o()}function vve(t,e,n,r){Kz(e,t);const i=e.runtime.bin.makeReadOptions(r),s=e.runtime.bin.makeWriteOptions(r);if(qz(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const l=i.readerFactory(o.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),f=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,f)}}function qz(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(r=>r.no==e.field.no)}function Kz(t,e){ur(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Wz(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Hz(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function fU(t,e){const n=t.localName,r=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=r?t.T.values[0].no:void 0;break;case"scalar":e[n]=r?dg(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function ch(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(fA.prototype).every(r=>r in t&&typeof t[r]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function zz(t,e){return ch(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}fe.DOUBLE,fe.FLOAT,fe.INT64,fe.UINT64,fe.INT32,fe.UINT32,fe.BOOL,fe.STRING,fe.BYTES;const hU={ignoreUnknownFields:!1},pU={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function yve(t){return t?Object.assign(Object.assign({},hU),t):hU}function _ve(t){return t?Object.assign(Object.assign({},pU),t):pU}const JE=Symbol(),O2=Symbol();function bve(){return{makeReadOptions:yve,makeWriteOptions:_ve,readMessage(t,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Tl(e)));r=r??new t;const i=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const l=t.fields.findJsonName(o);if(l){if(l.oneof){if(a===null&&l.kind=="scalar")continue;const c=i.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(o,'"'));i.set(l.oneof,o)}mU(r,a,l,n,t)}else{let c=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[f,p]=Vz(u);mU(f,a,u.field,n,u),vve(r,u,p(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return r},writeMessage(t,e){const n=t.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!Wz(i,t)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!Eve(i))continue}const o=i.oneof?t[i.oneof.localName].value:t[i.localName],a=gU(i,o,e);a!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&qz(t,a)){const l=gve(t,a,e),c=gU(a.field,l,e);c!==void 0&&(r[a.field.jsonName]=c)}}}catch(s){const o=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return r},readScalar(t,e,n){return y1(t,e,n??Ud.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Hz(t,e)))return M2(t,e)},debug:Tl}}function Tl(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function mU(t,e,n,r,i){let s=n.localName;if(n.repeated){if(ur(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,r));break;case"enum":const l=KI(n.T,a,r.ignoreUnknownFields,!0);l!==O2&&o.push(l);break;case"scalar":try{o.push(y1(n.T,a,n.L,!0))}catch(c){let u="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(a));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(e)));const o=t[s];for(const[a,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=Sve(n.K,a)}catch(u){let f="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(e));throw u instanceof Error&&u.message.length>0&&(f+=": ".concat(u.message)),new Error(f)}switch(n.V.kind){case"message":o[c]=n.V.T.fromJson(l,r);break;case"enum":const u=KI(n.V.T,l,r.ignoreUnknownFields,!0);u!==O2&&(o[c]=u);break;case"scalar":try{o[c]=y1(n.V.T,l,Ud.BIGINT,!0)}catch(f){let p="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(e));throw f instanceof Error&&f.message.length>0&&(p+=": ".concat(f.message)),new Error(p)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];ch(a)?a.fromJson(e,r):(t[s]=a=o.fromJson(e,r),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const l=KI(n.T,e,r.ignoreUnknownFields,!1);switch(l){case JE:fU(n,t);break;case O2:break;default:t[s]=l;break}break;case"scalar":try{const c=y1(n.T,e,n.L,!1);switch(c){case JE:fU(n,t);break;default:t[s]=c;break}}catch(c){let u="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Tl(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function Sve(t,e){if(t===fe.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return y1(t,e,Ud.BIGINT,!0).toString()}function y1(t,e,n,r){if(e===null)return r?dg(t,n):JE;switch(t){case fe.DOUBLE:case fe.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return t==fe.FLOAT&&Nz(i),i;case fe.INT32:case fe.FIXED32:case fe.SFIXED32:case fe.SINT32:case fe.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==fe.UINT32||t==fe.FIXED32?Ix(s):L2(s),s;case fe.INT64:case fe.SFIXED64:case fe.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Wn.parse(e);return n?o.toString():o;case fe.FIXED64:case fe.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Wn.uParse(e);return n?a.toString():a;case fe.BOOL:if(typeof e!="boolean")break;return e;case fe.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case fe.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Gz.dec(e)}throw new Error}function KI(t,e,n,r){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:r?t.values[0].no:JE;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=t.findName(e);if(i!==void 0)return i.no;if(n)return O2;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Tl(e)))}function Eve(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function gU(t,e,n){if(t.kind=="map"){ur(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of i)r[o.toString()]=M2(t.V.T,a);break;case"message":for(const[o,a]of i)r[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of i)r[o.toString()]=WI(s,a,n.enumAsInteger);break}return n.emitDefaultValues||i.length>0?r:void 0}if(t.repeated){ur(Array.isArray(e));const r=[];switch(t.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(M2(t.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(WI(t.T,e[i],n.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(t.kind){case"scalar":return M2(t.T,e);case"enum":return WI(t.T,e,n.enumAsInteger);case"message":return zz(t.T,e).toJson(n)}}function WI(t,e,n){var r;if(ur(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const i=t.findNumber(e);return(r=i==null?void 0:i.name)!==null&&r!==void 0?r:e}function M2(t,e){switch(t){case fe.INT32:case fe.SFIXED32:case fe.SINT32:case fe.FIXED32:case fe.UINT32:return ur(typeof e=="number"),e;case fe.FLOAT:case fe.DOUBLE:return ur(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case fe.STRING:return ur(typeof e=="string"),e;case fe.BOOL:return ur(typeof e=="boolean"),e;case fe.UINT64:case fe.FIXED64:case fe.INT64:case fe.SFIXED64:case fe.SINT64:return ur(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case fe.BYTES:return ur(e instanceof Uint8Array),Gz.enc(e)}}const Fp=Symbol("@bufbuild/protobuf/unknown-fields"),vU={readUnknownFields:!0,readerFactory:t=>new fve(t)},yU={writeUnknownFields:!0,writerFactory:()=>new dve};function wve(t){return t?Object.assign(Object.assign({},vU),t):vU}function Cve(t){return t?Object.assign(Object.assign({},yU),t):yU}function Tve(){return{makeReadOptions:wve,makeWriteOptions:Cve,listUnknownFields(t){var e;return(e=t[Fp])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Fp]},writeUnknownFields(t,e){const r=t[Fp];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(t,e,n,r){const i=t;Array.isArray(i[Fp])||(i[Fp]=[]),i[Fp].push({no:e,wireType:n,data:r})},readMessage(t,e,n,r,i){const s=t.getType(),o=i?e.len:e.pos+n;let a,l;for(;e.pos<o&&([a,l]=e.tag(),!(i===!0&&l==yr.EndGroup));){const c=s.fields.find(a);if(!c){const u=e.skip(l,a);r.readUnknownFields&&this.onUnknownField(t,a,l,u);continue}_U(t,e,c,l,r)}if(i&&(l!=yr.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:_U,writeMessage(t,e,n){const r=t.getType();for(const i of r.fields.byNumber()){if(!Wz(i,t)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const s=i.oneof?t[i.oneof.localName].value:t[i.localName];bU(i,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,r){e!==void 0&&bU(t,e,n,r)}}}function _U(t,e,n,r,i){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?fe.INT32:n.T;let l=ZE;if(n.kind=="scalar"&&n.L>0&&(l=Ive),s){let p=t[o];if(r==yr.LengthDelimited&&a!=fe.STRING&&a!=fe.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)p.push(l(e,a))}else p.push(l(e,a))}else t[o]=l(e,a);break;case"message":const c=n.T;s?t[o].push(N2(e,new c,i,n)):ch(t[o])?N2(e,t[o],i,n):(t[o]=N2(e,new c,i,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=c.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,f]=Rve(n,e,i);t[o][u]=f;break}}function N2(t,e,n,r){const i=e.getType().runtime.bin,s=r==null?void 0:r.delimited;return i.readMessage(e,t,s?r.no:t.uint32(),n,s),e}function Rve(t,e,n){const r=e.uint32(),i=e.pos+r;let s,o;for(;e.pos<i;){const[a]=e.tag();switch(a){case 1:s=ZE(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=ZE(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=N2(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=dg(t.K,Ud.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=dg(t.V.T,Ud.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function Ive(t,e){const n=ZE(t,e);return typeof n=="bigint"?n.toString():n}function ZE(t,e){switch(e){case fe.STRING:return t.string();case fe.BOOL:return t.bool();case fe.DOUBLE:return t.double();case fe.FLOAT:return t.float();case fe.INT32:return t.int32();case fe.INT64:return t.int64();case fe.UINT64:return t.uint64();case fe.FIXED64:return t.fixed64();case fe.BYTES:return t.bytes();case fe.FIXED32:return t.fixed32();case fe.SFIXED32:return t.sfixed32();case fe.SFIXED64:return t.sfixed64();case fe.SINT64:return t.sint64();case fe.UINT32:return t.uint32();case fe.SINT32:return t.sint32()}}function bU(t,e,n,r){ur(e!==void 0);const i=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?fe.INT32:t.T;if(i)if(ur(Array.isArray(e)),t.packed)xve(n,s,t.no,e);else for(const o of e)_1(n,s,t.no,o);else _1(n,s,t.no,e);break;case"message":if(i){ur(Array.isArray(e));for(const o of e)SU(n,r,t,o)}else SU(n,r,t,e);break;case"map":ur(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))kve(n,r,t,o,a);break}}function kve(t,e,n,r,i){t.tag(n.no,yr.LengthDelimited),t.fork();let s=r;switch(n.K){case fe.INT32:case fe.FIXED32:case fe.UINT32:case fe.SFIXED32:case fe.SINT32:s=Number.parseInt(r);break;case fe.BOOL:ur(r=="true"||r=="false"),s=r=="true";break}switch(_1(t,n.K,1,s),n.V.kind){case"scalar":_1(t,n.V.T,2,i);break;case"enum":_1(t,fe.INT32,2,i);break;case"message":ur(i!==void 0),t.tag(2,yr.LengthDelimited).bytes(i.toBinary(e));break}t.join()}function SU(t,e,n,r){const i=zz(n.T,r);n.delimited?t.tag(n.no,yr.StartGroup).raw(i.toBinary(e)).tag(n.no,yr.EndGroup):t.tag(n.no,yr.LengthDelimited).bytes(i.toBinary(e))}function _1(t,e,n,r){ur(r!==void 0);let[i,s]=Yz(e);t.tag(n,i)[s](r)}function xve(t,e,n,r){if(!r.length)return;t.tag(n,yr.LengthDelimited).fork();let[,i]=Yz(e);for(let s=0;s<r.length;s++)t[i](r[s]);t.join()}function Yz(t){let e=yr.Varint;switch(t){case fe.BYTES:case fe.STRING:e=yr.LengthDelimited;break;case fe.DOUBLE:case fe.FIXED64:case fe.SFIXED64:e=yr.Bit64;break;case fe.FIXED32:case fe.SFIXED32:case fe.FLOAT:e=yr.Bit32;break}const n=fe[t].toLowerCase();return[e,n]}function Pve(){return{setEnumType:Fz,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const i=r.localName,s=e,o=t;if(o[i]!=null)switch(r.kind){case"oneof":const a=o[i].case;if(a===void 0)continue;const l=r.findField(a);let c=o[i].value;l&&l.kind=="message"&&!ch(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===fe.BYTES&&(c=b0(c)),s[i]={case:a,value:c};break;case"scalar":case"enum":let u=o[i];r.T===fe.BYTES&&(u=r.repeated?u.map(b0):b0(u)),s[i]=u;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===fe.BYTES)for(const[m,v]of Object.entries(o[i]))s[i][m]=b0(v);else Object.assign(s[i],o[i]);break;case"message":const p=r.V.T;for(const m of Object.keys(o[i])){let v=o[i][m];p.fieldWrapper||(v=new p(v)),s[i][m]=v}break}break;case"message":const f=r.T;if(r.repeated)s[i]=o[i].map(p=>ch(p,f)?p:new f(p));else{const p=o[i];f.fieldWrapper?f.typeName==="google.protobuf.BytesValue"?s[i]=b0(p):s[i]=p:s[i]=ch(p,f)?p:new f(p)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(r=>{const i=e[r.localName],s=n[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((o,a)=>r.T.equals(o,s[a]));case"scalar":return i.every((o,a)=>Gu(r.T,o,s[a]));case"enum":return i.every((o,a)=>Gu(fe.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(i,s);case"enum":return Gu(fe.INT32,i,s);case"scalar":return Gu(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const o=r.findField(i.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(i.value,s.value);case"enum":return Gu(fe.INT32,i.value,s.value);case"scalar":return Gu(o.T,i.value,s.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const l=r.V.T;return a.every(u=>l.equals(i[u],s[u]));case"enum":return a.every(u=>Gu(fe.INT32,i[u],s[u]));case"scalar":const c=r.V.T;return a.every(u=>Gu(c,i[u],s[u]))}break}})},clone(t){const e=t.getType(),n=new e,r=n;for(const i of e.fields.byMember()){const s=t[i.localName];let o;if(i.repeated)o=s.map(dS);else if(i.kind=="map"){o=r[i.localName];for(const[a,l]of Object.entries(s))o[a]=dS(l)}else i.kind=="oneof"?o=i.findField(s.case)?{case:s.case,value:dS(s.value)}:{case:void 0}:o=dS(s);r[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return n}}}function dS(t){if(t===void 0)return t;if(ch(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function b0(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Lve(t,e,n){return{syntax:t,json:bve(),bin:Tve(),util:Object.assign(Object.assign({},Pve()),{newFieldList:e,initFields:n}),makeMessageType(r,i,s){return sve(this,r,i,s)},makeEnum:ive,makeEnumType:Uz,getEnumType:rve,makeExtension(r,i,s){return hve(this,r,i,s)}}}class Ave{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function Xz(t,e){const n=Jz(t);return e?n:Uve(Fve(n))}function Ove(t){return Xz(t,!1)}const Mve=Jz;function Jz(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let i=t.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),n.push(i);break}}return n.join("")}const Nve=new Set(["constructor","toString","toJSON","valueOf"]),Dve=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Zz=t=>"".concat(t,"$"),Fve=t=>Dve.has(t)?Zz(t):t,Uve=t=>Nve.has(t)?Zz(t):t;class jve{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Ove(e)}addField(e){ur(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function $ve(t,e){var n,r,i,s,o,a;const l=[];let c;for(const u of typeof t=="function"?t():t){const f=u;if(f.localName=Xz(u.name,u.oneof!==void 0),f.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:Mve(u.name),f.repeated=(r=u.repeated)!==null&&r!==void 0?r:!1,u.kind=="scalar"&&(f.L=(i=u.L)!==null&&i!==void 0?i:Ud.BIGINT),f.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,f.req=(o=u.req)!==null&&o!==void 0?o:!1,f.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(f.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=fe.BYTES&&u.T!=fe.STRING),u.oneof!==void 0){const p=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=p)&&(c=new jve(p)),f.oneof=c,c.addField(f)}l.push(f)}return l}const ce=Lve("proto3",t=>new Ave(t,e=>$ve(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=t;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=dg(e.T,e.L);break}}});class Ts extends fA{constructor(e){super(),this.seconds=Wn.zero,this.nanos=0,ce.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(ce.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Wn.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Ts.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Ts({seconds:Wn.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Ts().fromBinary(e,n)}static fromJson(e,n){return new Ts().fromJson(e,n)}static fromJsonString(e,n){return new Ts().fromJsonString(e,n)}static equals(e,n){return ce.util.equals(Ts,e,n)}}Ts.runtime=ce;Ts.typeName="google.protobuf.Timestamp";Ts.fields=ce.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Bve=ce.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ts},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Hve,repeated:!0},{no:5,name:"events",kind:"message",T:Gve,repeated:!0}]),Hve=ce.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Vve,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Vve=ce.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ts},{no:3,name:"value",kind:"scalar",T:2}]),Gve=ce.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Ts},{no:7,name:"normalized_end_timestamp",kind:"message",T:Ts,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Qz=ce.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Da=ce.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Lr=ce.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Am=ce.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),t1=ce.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),sy=ce.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),ja=ce.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"}]),Up=ce.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),qve=ce.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Aa=ce.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),jC=ce.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:QE,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:dY}]),QE=ce.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Kve=ce.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:ce.getEnumType(Lr),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),wh=ce.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ce.getEnumType(Om)},{no:4,name:"tracks",kind:"message",T:hm,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Kve},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:ce.getEnumType(ew)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:ce.getEnumType(ja)},{no:18,name:"kind_details",kind:"enum",T:ce.getEnumType(Wve),repeated:!0}]),Om=ce.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ew=ce.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Wve=ce.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),so=ce.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),zve=ce.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:uh,repeated:!0}]),hm=ce.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:ce.getEnumType(Da)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:ce.getEnumType(Lr)},{no:10,name:"layers",kind:"message",T:uh,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:zve,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:ce.getEnumType(so)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:dY},{no:19,name:"audio_features",kind:"enum",T:ce.getEnumType(Aa),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:ce.getEnumType(Qz)}]),uh=ce.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:ce.getEnumType(Am)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),bs=ce.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:ce.getEnumType(Bt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:tY,oneof:"value"},{no:3,name:"speaker",kind:"message",T:Yve,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:nY,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Xve,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Bve,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:kx,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:rY,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:iY,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:sY,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Px,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Lx,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ax,oneof:"value"}]),Bt=ce.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),Yve=ce.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:eY,repeated:!0}]),eY=ce.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),tY=ce.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),nY=ce.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Xve=ce.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Jve,repeated:!0}]),Jve=ce.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),kx=ce.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),rY=ce.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),iY=ce.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),sY=ce.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:oY,oneof:"value"}]),oY=ce.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),aY=ce.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Zve=ce.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:ce.getEnumType(lY)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),lY=ce.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Qve=ce.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:ce.getEnumType(cY)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),cY=ce.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"}]),uY=ce.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:EU},{no:2,name:"screen",kind:"message",T:EU},{no:3,name:"resume_connection",kind:"enum",T:ce.getEnumType(sy)},{no:4,name:"disabled_codecs",kind:"message",T:e0e},{no:5,name:"force_relay",kind:"enum",T:ce.getEnumType(sy)}]),EU=ce.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:ce.getEnumType(sy)}]),e0e=ce.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:QE,repeated:!0},{no:2,name:"publish",kind:"message",T:QE,repeated:!0}]),dY=ce.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),xx=ce.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),fY=ce.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:ce.getEnumType(xx)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),hY=ce.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Px=ce.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:ce.getEnumType(so)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:fY,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:hY,oneof:"content_header"}],{localName:"DataStream_Header"}),Lx=ce.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ax=ce.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Fa=ce.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Ox=ce.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),t0e=ce.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),n0e=ce.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ch,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ch,oneof:"message"},{no:3,name:"trickle",kind:"message",T:pA,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Nx,oneof:"message"},{no:5,name:"mute",kind:"message",T:mA,oneof:"message"},{no:6,name:"subscription",kind:"message",T:$C,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:pY,oneof:"message"},{no:8,name:"leave",kind:"message",T:BC,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:gY,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:bY,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:SY,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Sl,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:vY,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:wY,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:mY,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:a0e,oneof:"message"}]),wU=ce.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:r0e,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ch,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ch,oneof:"message"},{no:4,name:"trickle",kind:"message",T:pA,oneof:"message"},{no:5,name:"update",kind:"message",T:o0e,oneof:"message"},{no:6,name:"track_published",kind:"message",T:gA,oneof:"message"},{no:8,name:"leave",kind:"message",T:BC,oneof:"message"},{no:9,name:"mute",kind:"message",T:mA,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:l0e,oneof:"message"},{no:11,name:"room_update",kind:"message",T:c0e,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:d0e,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:h0e,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:m0e,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:g0e,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:s0e,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:i0e,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:y0e,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:S0e,oneof:"message"},{no:22,name:"request_response",kind:"message",T:E0e,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:w0e,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:v0e,oneof:"message"}]),Mx=ce.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),Nx=ce.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:ce.getEnumType(Da)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:ce.getEnumType(Lr)},{no:9,name:"layers",kind:"message",T:uh,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Mx,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:ce.getEnumType(so)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:ce.getEnumType(Qz)},{no:17,name:"audio_features",kind:"enum",T:ce.getEnumType(Aa),repeated:!0}]),pA=ce.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:ce.getEnumType(Fa)},{no:3,name:"final",kind:"scalar",T:8}]),mA=ce.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),r0e=ce.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:jC},{no:2,name:"participant",kind:"message",T:wh},{no:3,name:"other_participants",kind:"message",T:wh,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:yY,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:uY},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Zve},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:QE,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),i0e=ce.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:yY,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:uY}]),gA=ce.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:hm}]),s0e=ce.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ch=ce.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),o0e=ce.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:wh,repeated:!0}]),$C=ce.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:aY,repeated:!0}]),pY=ce.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:ce.getEnumType(Am)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),mY=ce.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:ce.getEnumType(Aa),repeated:!0}]),a0e=ce.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),BC=ce.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:ce.getEnumType(ja)},{no:3,name:"action",kind:"enum",T:ce.getEnumType(Mm)},{no:4,name:"regions",kind:"message",T:_0e}]),Mm=ce.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),gY=ce.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:uh,repeated:!0}]),vY=ce.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),yY=ce.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),l0e=ce.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:eY,repeated:!0}]),c0e=ce.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:jC}]),u0e=ce.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:ce.getEnumType(t1)},{no:3,name:"score",kind:"scalar",T:2}]),d0e=ce.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:u0e,repeated:!0}]),f0e=ce.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:ce.getEnumType(Ox)}]),h0e=ce.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:f0e,repeated:!0}]),vA=ce.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:ce.getEnumType(Am)},{no:2,name:"enabled",kind:"scalar",T:8}]),p0e=ce.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:vA,repeated:!0}]),m0e=ce.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:vA,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:p0e,repeated:!0}]),_Y=ce.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),bY=ce.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:_Y,repeated:!0}]),g0e=ce.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),v0e=ce.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:jC},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:wh},{no:4,name:"other_participants",kind:"message",T:wh,repeated:!0}]),SY=ce.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ch},{no:2,name:"subscription",kind:"message",T:$C},{no:3,name:"publish_tracks",kind:"message",T:gA,repeated:!0},{no:4,name:"data_channels",kind:"message",T:EY,repeated:!0},{no:5,name:"offer",kind:"message",T:Ch},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),EY=ce.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:ce.getEnumType(Fa)}]),Sl=ce.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:ce.getEnumType(t0e),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),wY=ce.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),y0e=ce.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),_0e=ce.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:b0e,repeated:!0}]),b0e=ce.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),S0e=ce.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:ce.getEnumType(qve)}]),E0e=ce.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:ce.getEnumType(yA)},{no:3,name:"message",kind:"scalar",T:9}]),yA=ce.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),w0e=ce.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function C0e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var D2={exports:{}},T0e=D2.exports,CU;function R0e(){return CU||(CU=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(T0e,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&r?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function f(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return c(g)||f.apply(this,arguments)}function m(g,S){var b=this,w,k,T,I="loglevel";typeof g=="string"?I+=":"+g:typeof g=="symbol"&&(I=void 0);function C(F){var $=(i[F]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function x(){var F;if(!(typeof window===n||!I)){try{F=window.localStorage[I]}catch{}if(typeof F===n)try{var $=window.document.cookie,B=encodeURIComponent(I),W=$.indexOf(B+"=");W!==-1&&(F=/^([^;]+)/.exec($.slice(W+B.length+1))[1])}catch{}return b.levels[F]===void 0&&(F=void 0),F}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(F){var $=F;if(typeof $=="string"&&b.levels[$.toUpperCase()]!==void 0&&($=b.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=b.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+F)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return T??k??w},b.setLevel=function(F,$){return T=N(F),$!==!1&&C(T),u.call(b)},b.setDefaultLevel=function(F){k=N(F),x()||b.setLevel(F,!1)},b.resetLevel=function(){T=null,A(),u.call(b)},b.enableAll=function(F){b.setLevel(b.levels.TRACE,F)},b.disableAll=function(F){b.setLevel(b.levels.SILENT,F)},b.rebuild=function(){if(o!==b&&(w=N(o.getLevel())),u.call(b),o===b)for(var F in s)s[F].rebuild()},w=N(o?o.getLevel():"WARN");var D=x();D!=null&&(T=N(D)),u.call(b)}o=new m,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[S];return b||(b=s[S]=new m(S,o.methodFactory)),b};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(D2)),D2.exports}var t_=R0e(),oy;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(oy||(oy={}));var qa;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(qa||(qa={}));let Rt=t_.getLogger("livekit");const CY=Object.values(qa).map(t=>t_.getLogger(t));Rt.setDefaultLevel(oy.info);function nu(t){const e=t_.getLogger(t);return e.setDefaultLevel(Rt.getLevel()),e}function TY(t,e){if(e)t_.getLogger(e).setLevel(t);else for(const n of CY)n.setLevel(t)}function I0e(t,e){CY.forEach(r=>{const i=r.methodFactory;r.methodFactory=(s,o,a)=>{const l=i(s,o,a),c=oy[s],u=c>=o&&c<oy.silent;return(f,p)=>{p?l(f,p):l(f),u&&t(c,f,p)}},r.setLevel(r.getLevel())})}const k0e=t_.getLogger("lk-e2ee"),S0=7e3,x0e=[0,300,2*2*300,3*3*300,4*4*300,S0,S0,S0,S0,S0];class RY{constructor(e){this._retryDelays=e!==void 0?[...e]:x0e}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function P0e(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function X(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}function TU(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cd(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof TU=="function"?TU(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}var fS={exports:{}},RU;function L0e(){if(RU)return fS.exports;RU=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(I,C,x){return Function.prototype.apply.call(I,C,x)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:n=function(I){return Object.getOwnPropertyNames(I)};function r(T){console&&console.warn&&console.warn(T)}var i=Number.isNaN||function(I){return I!==I};function s(){s.init.call(this)}fS.exports=s,fS.exports.once=b,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");o=T}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function l(T){return T._maxListeners===void 0?s.defaultMaxListeners:T._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(I){for(var C=[],x=1;x<arguments.length;x++)C.push(arguments[x]);var A=I==="error",N=this._events;if(N!==void 0)A=A&&N.error===void 0;else if(!A)return!1;if(A){var D;if(C.length>0&&(D=C[0]),D instanceof Error)throw D;var F=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw F.context=D,F}var $=N[I];if($===void 0)return!1;if(typeof $=="function")e($,this,C);else for(var B=$.length,W=v($,B),x=0;x<B;++x)e(W[x],this,C);return!0};function c(T,I,C,x){var A,N,D;if(a(C),N=T._events,N===void 0?(N=T._events=Object.create(null),T._eventsCount=0):(N.newListener!==void 0&&(T.emit("newListener",I,C.listener?C.listener:C),N=T._events),D=N[I]),D===void 0)D=N[I]=C,++T._eventsCount;else if(typeof D=="function"?D=N[I]=x?[C,D]:[D,C]:x?D.unshift(C):D.push(C),A=l(T),A>0&&D.length>A&&!D.warned){D.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.emitter=T,F.type=I,F.count=D.length,r(F)}return T}s.prototype.addListener=function(I,C){return c(this,I,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(I,C){return c(this,I,C,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(T,I,C){var x={fired:!1,wrapFn:void 0,target:T,type:I,listener:C},A=u.bind(x);return A.listener=C,x.wrapFn=A,A}s.prototype.once=function(I,C){return a(C),this.on(I,f(this,I,C)),this},s.prototype.prependOnceListener=function(I,C){return a(C),this.prependListener(I,f(this,I,C)),this},s.prototype.removeListener=function(I,C){var x,A,N,D,F;if(a(C),A=this._events,A===void 0)return this;if(x=A[I],x===void 0)return this;if(x===C||x.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete A[I],A.removeListener&&this.emit("removeListener",I,x.listener||C));else if(typeof x!="function"){for(N=-1,D=x.length-1;D>=0;D--)if(x[D]===C||x[D].listener===C){F=x[D].listener,N=D;break}if(N<0)return this;N===0?x.shift():g(x,N),x.length===1&&(A[I]=x[0]),A.removeListener!==void 0&&this.emit("removeListener",I,F||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(I){var C,x,A;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[I]),this;if(arguments.length===0){var N=Object.keys(x),D;for(A=0;A<N.length;++A)D=N[A],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=x[I],typeof C=="function")this.removeListener(I,C);else if(C!==void 0)for(A=C.length-1;A>=0;A--)this.removeListener(I,C[A]);return this};function p(T,I,C){var x=T._events;if(x===void 0)return[];var A=x[I];return A===void 0?[]:typeof A=="function"?C?[A.listener||A]:[A]:C?S(A):v(A,A.length)}s.prototype.listeners=function(I){return p(this,I,!0)},s.prototype.rawListeners=function(I){return p(this,I,!1)},s.listenerCount=function(T,I){return typeof T.listenerCount=="function"?T.listenerCount(I):m.call(T,I)},s.prototype.listenerCount=m;function m(T){var I=this._events;if(I!==void 0){var C=I[T];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(T,I){for(var C=new Array(I),x=0;x<I;++x)C[x]=T[x];return C}function g(T,I){for(;I+1<T.length;I++)T[I]=T[I+1];T.pop()}function S(T){for(var I=new Array(T.length),C=0;C<I.length;++C)I[C]=T[C].listener||T[C];return I}function b(T,I){return new Promise(function(C,x){function A(D){T.removeListener(I,N),x(D)}function N(){typeof T.removeListener=="function"&&T.removeListener("error",A),C([].slice.call(arguments))}k(T,I,N,{once:!0}),I!=="error"&&w(T,A,{once:!0})})}function w(T,I,C){typeof T.on=="function"&&k(T,"error",I,C)}function k(T,I,C,x){if(typeof T.on=="function")x.once?T.once(I,C):T.on(I,C);else if(typeof T.addEventListener=="function")T.addEventListener(I,function A(N){x.once&&T.removeEventListener(I,A),C(N)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}return fS.exports}var Wl=L0e();let IY=!0,kY=!0;function F2(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function Gh(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const l=c=>{const u=n(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),i.apply(this,[o,l])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function A0e(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(IY=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function O0e(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(kY=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function xY(){if(typeof window=="object"){if(IY)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _A(t,e){kY&&console.warn(t+" is deprecated, please use "+e+" instead.")}function M0e(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=F2(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=F2(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=F2(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function IU(t){return Object.prototype.toString.call(t)==="[object Object]"}function PY(t){return IU(t)?Object.keys(t).reduce(function(e,n){const r=IU(t[n]),i=r?PY(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function Dx(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Dx(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{Dx(t,t.get(i),n)})}))}function kU(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&Dx(t,a,i)})}),i}const xU=xY;function LY(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const f=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){l.optional=l.optional||[];let p={};typeof u.ideal=="number"?(p[f("min",c)]=u.ideal,l.optional.push(p),p={},p[f("max",c)]=u.ideal,l.optional.push(p)):(p[f("",c)]=u.ideal,l.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",c)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(p,c)]=u[p])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},i=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,f,p){f in u&&!(p in u)&&(u[p]=u[f],delete u[f])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let f;if(c.exact==="environment"||c.ideal==="environment"?f=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(p=>{p=p.filter(v=>v.kind==="videoinput");let m=p.find(v=>f.some(g=>v.label.toLowerCase().includes(g)));return!m&&p.length&&f.includes("back")&&(m=p[p.length-1]),m&&(a.video.deviceId=c.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),xU("chrome: "+JSON.stringify(a)),l(a)})}a.video=r(a.video)}return xU("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){i(a,u=>{n.webkitGetUserMedia(u,l,f=>{c&&c(s(f))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return i(l,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function AY(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function OY(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Gh(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function MY(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let c=i.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function NY(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>kU(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Gh(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>kU(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function DY(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(f=>f.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function FY(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return DY(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(f=>this._reverseStreams[f.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const f=new t.MediaStream(u.getTracks());this._streams[u.id]=f,this._reverseStreams[f.id]=u,u=f}r.apply(this,[u])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[f.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[f.id]=g,this._reverseStreams[g.id]=f,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(c,u){let f=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(p=>{const m=c._reverseStreams[p],v=c._streams[m.id];f=f.replace(new RegExp(v.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:f})}function o(c,u){let f=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(p=>{const m=c._reverseStreams[p],v=c._streams[m.id];f=f.replace(new RegExp(m.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:f})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],f={[c](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const g=s(this,v);p[0].apply(null,[g])},v=>{p[1]&&p[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};t.RTCPeerConnection.prototype[c]=f[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(g=>u.track===g)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Fx(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function UY(t,e){Gh(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var PU=Object.freeze({__proto__:null,fixNegotiationNeeded:UY,shimAddTrackRemoveTrack:FY,shimAddTrackRemoveTrackWithNative:DY,shimGetSendersWithDtmf:MY,shimGetUserMedia:LY,shimMediaStream:AY,shimOnTrack:OY,shimPeerConnection:Fx,shimSenderReceiverGetStats:NY});function jY(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){_A("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function N0e(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function $Y(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ux(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,f)=>{l.set(f,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(o,a)}}function BY(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function HY(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Gh(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function VY(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){_A("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function GY(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function qY(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function KY(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function WY(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function zY(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var LU=Object.freeze({__proto__:null,shimAddTransceiver:qY,shimCreateAnswer:zY,shimCreateOffer:WY,shimGetDisplayMedia:N0e,shimGetParameters:KY,shimGetUserMedia:jY,shimOnTrack:$Y,shimPeerConnection:Ux,shimRTCDataChannel:GY,shimReceiverGetStats:HY,shimRemoveStream:VY,shimSenderGetStats:BY});function YY(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function XY(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function JY(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,u){const f=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[f]);return u?(p.then(c,u),Promise.resolve()):p},e.createAnswer=function(c,u){const f=arguments.length>=2?arguments[2]:arguments[0],p=r.apply(this,[f]);return u?(p.then(c,u),Promise.resolve()):p};let a=function(l,c,u){const f=i.apply(this,[l]);return u?(f.then(c,u),Promise.resolve()):f};e.setLocalDescription=a,a=function(l,c,u){const f=s.apply(this,[l]);return u?(f.then(c,u),Promise.resolve()):f},e.setRemoteDescription=a,a=function(l,c,u){const f=o.apply(this,[l]);return u?(f.then(c,u),Promise.resolve()):f},e.addIceCandidate=a}function ZY(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(QY(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function QY(t){return t&&t.video!==void 0?Object.assign({},t,{video:PY(t.video)}):t}function eX(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(_A("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function tX(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nX(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function rX(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var AU=Object.freeze({__proto__:null,shimAudioContext:rX,shimCallbacksAPI:JY,shimConstraints:QY,shimCreateOfferLegacy:nX,shimGetUserMedia:ZY,shimLocalStreamsAPI:YY,shimRTCIceServerUrls:eX,shimRemoteStreamsAPI:XY,shimTrackEventTransceiver:tX}),zI={exports:{}},OU;function D0e(){return OU||(OU=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const l=s[a],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),f=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=f.length?e.parseFmtp(f[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),l=a.length>0&&a[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),i.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:l,codecPayloadType:parseInt(p.parameters.apt,10)};l&&c&&(m.rtx={ssrc:c}),r.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&l&&r.push({ssrc:l});let f=e.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,r.forEach(p=>{p.maxBitrate=f})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e}(zI)),zI.exports}var iX=D0e(),Nm=C0e(iX),F0e=Yge({__proto__:null,default:Nm},[iX]);function U2(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=Nm.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Gh(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function jx(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Gh(t,"icecandidate",e=>{if(e.candidate){const n=Nm.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function j2(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const l=Nm.splitSections(a.sdp);return l.shift(),l.some(c=>{const u=Nm.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},i=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=Nm.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=r(arguments[0]),c=i(l),u=s(arguments[0],l);let f;c===0&&u===0?f=Number.POSITIVE_INFINITY:c===0||u===0?f=Math.max(c,u):f=Math.min(c,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return f}}),this._sctp=p}return o.apply(this,arguments)}}function $2(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&l>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Gh(t,"datachannel",r=>(e(r.channel,r.target),r))}function $x(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Bx(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function B2(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function H2(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var U0e=Object.freeze({__proto__:null,removeExtmapAllowMixed:Bx,shimAddIceCandidateNullOrEmpty:B2,shimConnectionState:$x,shimMaxMessageSize:j2,shimParameterlessSetLocalDescription:H2,shimRTCIceCandidate:U2,shimRTCIceCandidateRelayProtocol:jx,shimSendThrowTypeError:$2});function j0e(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=xY,r=M0e(t),i={browserDetails:r,commonShim:U0e,extractVersion:F2,disableLog:A0e,disableWarnings:O0e,sdp:F0e};switch(r.browser){case"chrome":if(!PU||!Fx||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=PU,B2(t,r),H2(t),LY(t,r),AY(t),Fx(t,r),OY(t),FY(t,r),MY(t),NY(t),UY(t,r),U2(t),jx(t),$x(t),j2(t,r),$2(t),Bx(t,r);break;case"firefox":if(!LU||!Ux||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=LU,B2(t,r),H2(t),jY(t,r),Ux(t,r),$Y(t),VY(t),BY(t),HY(t),GY(t),qY(t),KY(t),WY(t),zY(t),U2(t),$x(t),j2(t,r),$2(t);break;case"safari":if(!AU||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=AU,B2(t,r),H2(t),eX(t),nX(t),JY(t),YY(t),XY(t),tX(t),ZY(t),rX(t),U2(t),jx(t),j2(t,r),$2(t),Bx(t,r);break;default:n("Unsupported browser!");break}return i}j0e({window:typeof window>"u"?void 0:window});const $0e=10,hS="lk_e2ee",B0e="LKFrameEncryptionKey",H0e={sharedKey:!1,ratchetSalt:B0e,ratchetWindowSize:8,failureTolerance:$0e,keyringSize:16};var Rd;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Rd||(Rd={}));var MU;(function(t){t.KeyRatcheted="keyRatcheted"})(MU||(MU={}));var vd;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(vd||(vd={}));var NU;(function(t){t.Error="cryptorError"})(NU||(NU={}));function sX(){return V0e()||Hx()}function Hx(){return typeof window.RTCRtpScriptTransform<"u"}function V0e(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function G0e(t){return X(this,void 0,void 0,function*(){let e=new TextEncoder;return yield crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function q0e(t){return X(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"])})}class oX extends Wl.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r,i)=>{Rt.debug("key ratcheted event received",{ratchetResult:n,participantId:r,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},H0e),e),this.on(Rd.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const i={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),i),this.emit(Rd.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Rd.RatchetRequest,e,n)}}class K0e extends oX{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});super(n)}setKey(e){return X(this,void 0,void 0,function*(){const n=typeof e=="string"?yield G0e(e):yield q0e(e);this.onSetEncryptionKey(n)})}}class nf extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Nt;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest"})(Nt||(Nt={}));class dn extends nf{constructor(e,n,r,i){super(1,e),this.name="ConnectionError",this.status=r,this.reason=n,this.context=i,this.reasonName=Nt[n]}}class bA extends nf{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Oc extends nf{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class W0e extends nf{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Vr extends nf{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Vx extends nf{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class YI extends nf{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class DU extends nf{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:yA[n]}}var tw;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(tw||(tw={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(tw||(tw={}));var FU;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(FU||(FU={}));var ae;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(ae||(ae={}));var se;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(se||(se={}));var ke;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(ke||(ke={}));var Ce;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate"})(Ce||(Ce={}));function z0e(t){return typeof t>"u"?t:typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}const Y0e=/version\/(\d+(\.?_?\d+)+)/i;let XI;function Ka(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(XI===void 0||e){const r=X0e.find(i=>{let{test:s}=i;return s.test(n)});XI=r==null?void 0:r.describe(n)}return XI}const X0e=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:V2(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:JI(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:V2(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:JI(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:V2(Y0e,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:JI(t)}}}];function V2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(t);return r&&r.length>=n&&r[n]||""}function JI(t){return t.includes("mac os")?V2(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var J0e="2.13.0";const Z0e=J0e,Q0e=16;class Ci{}Ci.setTimeout=function(){return setTimeout(...arguments)};Ci.setInterval=function(){return setInterval(...arguments)};Ci.clearTimeout=function(){return clearTimeout(...arguments)};Ci.clearInterval=function(){return clearInterval(...arguments)};const e1e=5e3,E0=[];var jo;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(jo||(jo={}));let ue=class om extends Wl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=om.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Rt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),e1e):this.handleAppVisibilityChanged()},this.log=nu((i=r.loggerName)!==null&&i!==void 0?i:qa.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=om.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),nn(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===om.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===om.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(E0.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&E0.splice(E0.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),pm(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(i?Ce.AudioPlaybackStarted:Ce.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(i?Ce.AudioPlaybackFailed:Ce.VideoPlaybackFailed,s):s.name==="AbortError"?Rt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Rt.warn("could not playback ".concat(i?"audio":"video"),s),i&&e&&r.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Ce.ElementAttached,e),e}detach(e){try{if(e){Dm(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Ce.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{Dm(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(Ce.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=nu(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),E0.forEach(r=>{r.parentElement||(n=!1)}),n&&E0.push(e)}}handleAppVisibilityChanged(){return X(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===om.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ks()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ks()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function pm(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;t.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(t)||(r.forEach(i=>{n.removeTrack(i)}),n.addTrack(t)),(!jd()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(jd()||fg())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Dm(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let r;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(r=t.StreamState||(t.StreamState={}));function i(c){switch(c){case e.Audio:return Da.AUDIO;case e.Video:return Da.VIDEO;default:return Da.DATA}}t.kindToProto=i;function s(c){switch(c){case Da.AUDIO:return e.Audio;case Da.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(c){switch(c){case n.Camera:return Lr.CAMERA;case n.Microphone:return Lr.MICROPHONE;case n.ScreenShare:return Lr.SCREEN_SHARE;case n.ScreenShareAudio:return Lr.SCREEN_SHARE_AUDIO;default:return Lr.UNKNOWN}}t.sourceToProto=o;function a(c){switch(c){case Lr.CAMERA:return n.Camera;case Lr.MICROPHONE:return n.Microphone;case Lr.SCREEN_SHARE:return n.ScreenShare;case Lr.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function l(c){switch(c){case Ox.ACTIVE:return r.Active;case Ox.PAUSED:return r.Paused;default:return r.Unknown}}t.streamStateFromProto=l})(ue||(ue={}));class un{constructor(e,n,r,i,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:i,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const t1e=["vp8","h264"],n1e=["vp8","h264","vp9","av1"];function r1e(t){return!!t1e.find(e=>e===t)}var UU;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(UU||(UU={}));var nw;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(nw||(nw={}));const Ol={h90:new un(160,90,9e4,20),h180:new un(320,180,16e4,20),h216:new un(384,216,18e4,20),h360:new un(640,360,45e4,20),h540:new un(960,540,8e5,25),h720:new un(1280,720,17e5,30),h1080:new un(1920,1080,3e6,30),h1440:new un(2560,1440,5e6,30),h2160:new un(3840,2160,8e6,30)},Gx={h120:new un(160,120,7e4,20),h180:new un(240,180,125e3,20),h240:new un(320,240,14e4,20),h360:new un(480,360,33e4,20),h480:new un(640,480,5e5,20),h540:new un(720,540,6e5,25),h720:new un(960,720,13e5,30),h1080:new un(1440,1080,23e5,30),h1440:new un(1920,1440,38e5,30)},HC={h360fps3:new un(640,360,2e5,3,"medium"),h360fps15:new un(640,360,4e5,15,"medium"),h720fps5:new un(1280,720,8e5,5,"medium"),h720fps15:new un(1280,720,15e5,15,"medium"),h720fps30:new un(1280,720,2e6,30,"medium"),h1080fps15:new un(1920,1080,25e5,15,"medium"),h1080fps30:new un(1920,1080,5e6,30,"medium"),original:new un(0,0,7e6,30,"medium")},i1e="|",jU="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function s1e(t){const e=t.split(i1e);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ls(t){return X(this,void 0,void 0,function*(){return new Promise(e=>Ci.setTimeout(e,t))})}function qx(){return"addTransceiver"in RTCPeerConnection.prototype}function Kx(){return"addTrack"in RTCPeerConnection.prototype}function o1e(){if(!("getCapabilities"in RTCRtpSender)||jd())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function a1e(){if(!("getCapabilities"in RTCRtpSender)||fg())return!1;if(jd()){const n=Ka();if(n!=null&&n.version&&Th(n.version,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function b1(t){return t==="av1"||t==="vp9"}function Wx(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function l1e(){return typeof RTCPeerConnection>"u"?!1:qx()||Kx()}function fg(){var t;return((t=Ka())===null||t===void 0?void 0:t.name)==="Firefox"}function jd(){var t;return((t=Ka())===null||t===void 0?void 0:t.name)==="Safari"}function c1e(){const t=Ka();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")}function aX(){var t,e;return ks()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function u1e(){const t=Ka(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Th(e,t.osVersion)>=0?!0:t.name==="Safari"&&Th(e,t.version)>=0}function ks(){return typeof document<"u"}function Ul(){return navigator.product=="ReactNative"}function zx(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function lX(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function cX(){if(!Ul())return;let t=lX();if(t)return t.platform}function $U(){if(ks())return window.devicePixelRatio;if(Ul()){let t=lX();if(t)return t.devicePixelRatio}return 1}function Th(t,e){const n=t.split("."),r=e.split("."),i=Math.min(n.length,r.length);for(let s=0;s<i;++s){const o=parseInt(n[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1;if(s===i-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function d1e(t){for(const e of t)e.target.handleResize(e)}function f1e(t){for(const e of t)e.target.handleVisibilityChanged(e)}let ZI=null;const BU=()=>(ZI||(ZI=new ResizeObserver(d1e)),ZI);let QI=null;const HU=()=>(QI||(QI=new IntersectionObserver(f1e,{root:null,rootMargin:"0px"})),QI);function h1e(){var t;const e=new Qve({sdk:cY.JS,protocol:Q0e,version:Z0e});return Ul()&&(e.os=(t=cX())!==null&&t!==void 0?t:""),e}function VU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d");s==null||s.fillRect(0,0,i.width,i.height),r&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=i.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let w0;function ek(){if(!w0){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const r=t.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[w0]=r.stream.getAudioTracks(),!w0)throw Error("Could not get empty media stream audio track");w0.enabled=!1}return w0.clone()}class SA{constructor(e,n){this.onFinally=n,this.promise=new Promise((r,i)=>X(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}function p1e(t){return n1e.includes(t)}function Id(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function m1e(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Yx(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function g1e(t,e){return t.segments.map(n=>{let{id:r,text:i,language:s,startTime:o,endTime:a,final:l}=n;var c;const u=(c=e.get(r))!==null&&c!==void 0?c:Date.now(),f=Date.now();return l?e.delete(r):e.set(r,u),{id:r,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:l,language:s,firstReceivedTime:u,lastReceivedTime:f}})}function v1e(t){const{id:e,timestamp:n,message:r,editTimestamp:i}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function GU(t){switch(t.reason){case Nt.LeaveRequest:return t.context;case Nt.Cancelled:return ja.CLIENT_INITIATED;case Nt.NotAllowed:return ja.USER_REJECTED;case Nt.ServerUnreachable:return ja.JOIN_FAILURE;default:return ja.UNKNOWN_REASON}}function G2(t){return t!==void 0?Number(t):void 0}function Yf(t){return t!==void 0?BigInt(t):void 0}function dh(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function ru(t){return!!t&&t.kind==ue.Kind.Audio}function Gg(t){return!!t&&t.kind==ue.Kind.Video}function qu(t){return dh(t)&&Gg(t)}function Xf(t){return dh(t)&&ru(t)}function Xx(t){return!!t&&!t.isLocal}function y1e(t){return!!t&&!t.isLocal}function tk(t){return Xx(t)&&Gg(t)}function _1e(t){return t.isLocal}function b1e(t,e){const n=[];let r=new TextEncoder().encode(t);for(;r.length>e;){let i=e;for(;i>0;){const s=r[i];if(s!==void 0&&(s&192)!==128)break;i--}n.push(r.slice(0,i)),r=r.slice(i)}return r.length>0&&n.push(r),n}function uX(t,e,n){var r,i,s,o;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=hX(t??{}),u=e==null?void 0:e.processor,f=n==null?void 0:n.processor,p=a??{};return p.audio===!0&&(p.audio={}),p.video===!0&&(p.video={}),p.audio&&(Jx(p.audio,e),(r=(s=p.audio).deviceId)!==null&&r!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(p.audio.processor=l??u)),p.video&&(Jx(p.video,n),(i=(o=p.video).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(c||f)&&(p.video.processor=c??f)),p}function Jx(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function EA(t){var e,n,r,i;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":Jx(a,l.resolution);break;default:a[c]=l[c]}}),s.video=o,(e=(r=s.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(i=s.audio).deviceId)!==null&&n!==void 0||(i.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function dX(t){return X(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const r=fX();if(r){const i=r.createAnalyser();i.fftSize=2048;const s=i.frequencyBinCount,o=new Uint8Array(s);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield Ls(n),i.getByteTimeDomainData(o);const l=o.some(c=>c!==128&&c!==0);return r.close(),!l}return!1}()})}function fX(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const r=()=>X(this,void 0,void 0,function*(){var i;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}(i=window.document.body)===null||i===void 0||i.removeEventListener("click",r)});window.document.body.addEventListener("click",r)}return n}}function S1e(t){return t==="audioinput"?ue.Source.Microphone:t==="videoinput"?ue.Source.Camera:ue.Source.Unknown}function qU(t){return t===ue.Source.Microphone?"audioinput":t===ue.Source.Camera?"videoinput":void 0}function E1e(t){var e,n;let r=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(r=typeof r=="boolean"?{}:r,jd()?r=Object.assign(Object.assign({},r),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:r,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function q2(t){return t.split("/")[1].toLowerCase()}function w1e(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new gA({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function nn(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?nn(t.track):{})}}function C1e(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function T1e(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(t)],i={};for(const s of r)t[s]!==e[s]&&(i[s]=(n=e[s])!==null&&n!==void 0?n:"");return i}function hX(t){const e=Object.assign({},t);let n,r;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:z0e(e)}}function R1e(t){switch(t){case Lr.CAMERA:return ue.Source.Camera;case Lr.MICROPHONE:return ue.Source.Microphone;case Lr.SCREEN_SHARE:return ue.Source.ScreenShare;case Lr.SCREEN_SHARE_AUDIO:return ue.Source.ScreenShareAudio;default:return ue.Source.Unknown}}class I1e extends Wl.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var r,i;const{kind:s,data:o}=n.data;switch(s){case"error":Rt.error(o.error.message),this.emit(vd.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(vd.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(i=this.room)===null||i===void 0?void 0:i.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(vd.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Rd.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break}},this.onWorkerError=n=>{Rt.error("e2ee worker encountered an error:",{error:n.error}),this.emit(vd.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!sX())throw new bA("tried to setup end-to-end encryption on an unsupported browser");if(Rt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:k0e.getLevel()}};this.worker&&(Rt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Rt.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Rt.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(ke.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(ae.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==so.NONE,i.identity)),e.on(ae.ConnectionStateChanged,r=>{r===kt.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==so.NONE,i.identity)})})}).on(ae.TrackUnsubscribed,(r,i,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:r.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(ae.TrackSubscribed,(r,i,s)=>{this.setupE2EEReceiver(r,s.identity,i.trackInfo)}).on(ae.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(se.LocalTrackPublished,r=>X(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),n.on(Rd.SetKey,r=>this.postKey(r)).on(Rd.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:i}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?q2(r.mimeType):void 0)}}setupE2EESender(e,n){if(!dh(e)||!n){n||Rt.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,i){return X(this,void 0,void 0,function*(){if(this.worker){if(Hx()){const s={kind:"decode",participantIdentity:r,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(hS in e&&i){const l={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(l);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,o=l.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(a,[o,s])}e[hS]=!0}})}handleSender(e,n,r){var i;if(!(hS in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Hx()){Rt.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Rt.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o,[s.readable,s.writable])}e[hS]=!0}}}const nk="default";class di{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new di),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=di.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Rt.debug("awaiting getUserMedia promise");try{n?yield di.userMediaPromiseMap.get(n):yield Promise.all(di.userMediaPromiseMap.values())}catch{Rt.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(i&&!(jd()&&r.hasDeviceInUse(n))&&(o.filter(l=>l.kind===n).length===0||o.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);o=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return r._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,r){return X(this,void 0,void 0,function*(){if(n!==nk)return n;const i=yield this.getDevices(e),s=i.find(a=>a.deviceId===nk);if(!s){Rt.warn("could not reliably determine default device");return}const o=i.find(a=>a.deviceId!==nk&&a.groupId===(r??s.groupId));if(!o){Rt.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?di.userMediaPromiseMap.has(e):di.userMediaPromiseMap.size>0}}di.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];di.userMediaPromiseMap=new Map;var S1;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(S1||(S1={}));class k1e{constructor(){this.pendingTasks=new Map,this.taskMutex=new ts,this.nextTaskIndex=0}run(e){return X(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:S1.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=S1.RUNNING,yield e()}finally{n.status=S1.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return X(this,void 0,void 0,function*(){return this.run(()=>X(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function x1e(t,e){const n=new URL(m1e(t));return e.forEach((r,i)=>{n.searchParams.set(i,r)}),pX(n,"rtc")}function P1e(t){const e=new URL(Yx(t));return pX(e,"validate")}function L1e(t){return t.endsWith("/")?t:"".concat(t,"/")}function pX(t,e){return t.pathname="".concat(L1e(t.pathname)).concat(e),t.toString()}const A1e=["syncState","trickle","offer","answer","simulate","leave"];function O1e(t){const e=A1e.indexOf(t.case)>=0;return Rt.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var An;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(An||(An={}));class wA{get currentState(){return this.state}get isDisconnected(){return this.state===An.DISCONNECTING||this.state===An.DISCONNECTED}get isEstablishingConnection(){return this.state===An.CONNECTING||this.state===An.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=An.DISCONNECTED,this.log=Rt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=nu((r=n.loggerName)!==null&&r!==void 0?r:qa.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new k1e,this.queuedRequests=[],this.closingLock=new ts,this.connectionLock=new ts,this.state=An.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,i){return X(this,void 0,void 0,function*(){return this.state=An.CONNECTING,this.options=r,yield this.connect(e,n,r,i)})}reconnect(e,n,r,i){return X(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=An.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,n,r,i){this.connectOptions=r;const s=h1e(),o=M1e(n,s,r),a=x1e(e,o),l=P1e(a);return new Promise((c,u)=>X(this,void 0,void 0,function*(){const f=yield this.connectionLock.lock();try{const p=()=>X(this,void 0,void 0,function*(){this.close(),clearTimeout(m),u(new dn("room connection has been cancelled (signal)",Nt.Cancelled))}),m=setTimeout(()=>{this.close(),u(new dn("room connection has timed out (signal)",Nt.ServerUnreachable))},r.websocketTimeout);i!=null&&i.aborted&&p(),i==null||i.addEventListener("abort",p);const v=new URL(a);v.searchParams.has("access_token")&&v.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(v),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(m)},this.ws.onerror=g=>X(this,void 0,void 0,function*(){if(this.state!==An.CONNECTED){this.state=An.DISCONNECTED,clearTimeout(m);try{const S=yield fetch(l);if(S.status.toFixed(0).startsWith("4")){const b=yield S.text();u(new dn(b,Nt.NotAllowed,S.status))}else u(new dn("Encountered unknown websocket error during connection: ".concat(g.toString()),Nt.InternalError,S.status))}catch(S){u(new dn(S instanceof Error?S.message:"server was not reachable",Nt.ServerUnreachable))}return}this.handleWSError(g)}),this.ws.onmessage=g=>X(this,void 0,void 0,function*(){var S,b,w;let k;if(typeof g.data=="string"){const T=JSON.parse(g.data);k=wU.fromJson(T,{ignoreUnknownFields:!0})}else if(g.data instanceof ArrayBuffer)k=wU.fromBinary(new Uint8Array(g.data));else{this.log.error("could not decode websocket message: ".concat(typeof g.data),this.logContext);return}if(this.state!==An.CONNECTED){let T=!1;if(((S=k.message)===null||S===void 0?void 0:S.case)==="join"?(this.state=An.CONNECTED,i==null||i.removeEventListener("abort",p),this.pingTimeoutDuration=k.message.value.pingTimeout,this.pingIntervalDuration=k.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),c(k.message.value)):this.state===An.RECONNECTING&&k.message.case!=="leave"?(this.state=An.CONNECTED,i==null||i.removeEventListener("abort",p),this.startPingInterval(),((b=k.message)===null||b===void 0?void 0:b.case)==="reconnect"?c(k.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),c(void 0),T=!0)):this.isEstablishingConnection&&k.message.case==="leave"?u(new dn("Received leave request while trying to (re)connect",Nt.LeaveRequest,void 0,k.message.value.reason)):r.reconnect||u(new dn("did not receive join response, got ".concat((w=k.message)===null||w===void 0?void 0:w.case," instead"),Nt.InternalError)),!T)return}this.signalLatency&&(yield Ls(this.signalLatency)),this.handleSignalResponse(k)}),this.ws.onclose=g=>{this.isEstablishingConnection&&u(new dn("Websocket got closed during a (re)connection attempt",Nt.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:g.reason,code:g.code,wasClean:g.wasClean,state:this.state})),this.handleOnClose(g.reason)}}finally{f()}}))}close(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=An.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const i=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([i,Ls(250)])),e.ws=void 0}}finally{n&&(e.state=An.DISCONNECTED),r()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:rw(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:rw(e)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new pA({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new mA({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new vY({requestId:a,metadata:r,name:i,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new gY({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new bY({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Wn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new wY({timestamp:Wn.parse(Date.now()),rtt:Wn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new mY({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new BC({reason:ja.CLIENT_INITIATED,action:Mm.DISCONNECT})})}sendRequest(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!i&&!O1e(n)&&r.state===An.RECONNECTING){r.queuedRequests.push(()=>X(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield Ls(r.signalLatency)),!r.ws||r.ws.readyState!==r.ws.OPEN){r.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),r.logContext);return}const o=new n0e({message:n});try{r.useJSON?r.ws.send(o.toJsonString()):r.ws.send(o.toBinary())}catch(a){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(i.case==="answer"){const o=KU(i.value);this.onAnswer&&this.onAnswer(o)}else if(i.case==="offer"){const o=KU(i.value);this.onOffer&&this.onOffer(o)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=i.value.participants)!==null&&n!==void 0?n:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):i.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return X(this,void 0,void 0,function*(){if(this.state===An.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Ci.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Ci.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Ci.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Ci.clearInterval(this.pingInterval)}}function KU(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function rw(t){return new Ch({sdp:t.sdp,type:t.type})}function M1e(t,e,n){var r;const i=new URLSearchParams;return i.set("access_token",t),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",Ul()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),i}var Ea={},rk={},ik={exports:{}},WU;function CA(){if(WU)return ik.exports;WU=1;var t=ik.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),ik.exports}var zU;function N1e(){return zU||(zU=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,c,u){if(u&&!c)l[u]=e(a[1]);else for(var f=0;f<c.length;f+=1)a[f+1]!=null&&(l[c[f]]=e(a[f+1]))},r=function(a,l,c){var u=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:u&&!l[a.name]&&(l[a.name]={});var f=a.push?{}:u?l[a.name]:l;n(c.match(a.reg),f,a.names,a.name),a.push&&l[a.push].push(f)},i=CA(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},c=[],u=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(f){var p=f[0],m=f.slice(2);p==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(i[p]||[]).length;v+=1){var g=i[p][v];if(g.reg.test(m))return r(g,u,m)}}),l.media=c,l};var o=function(a,l){var c=l.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&l.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],c=a.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(c){var u,f=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),f=!0),{scid:u,paused:f}})})}}(rk)),rk}var sk,YU;function D1e(){if(YU)return sk;YU=1;var t=CA(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,c=l.length;return o.replace(e,function(u){if(a>=c)return u;var f=l[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},r=function(o,a,l){var c=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,u=[o+"="+c];if(a.names)for(var f=0;f<a.names.length;f+=1){var p=a.names[f];a.name?u.push(l[a.name][p]):u.push(l[a.names[f]])}else u.push(l[a.name]);return n.apply(null,u)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return sk=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var l=a.outerOrder||i,c=a.innerOrder||s,u=[];return l.forEach(function(f){t[f].forEach(function(p){p.name in o&&o[p.name]!=null?u.push(r(f,p,o)):p.push in o&&o[p.push]!=null&&o[p.push].forEach(function(m){u.push(r(f,p,m))})})}),o.media.forEach(function(f){u.push(r("m",t.m[0],f)),c.forEach(function(p){t[p].forEach(function(m){m.name in f&&f[m.name]!=null?u.push(r(p,m,f)):m.push in f&&f[m.push]!=null&&f[m.push].forEach(function(v){u.push(r(p,m,v))})})})}),u.join(`\r
`)+`\r
`},sk}var XU;function F1e(){if(XU)return Ea;XU=1;var t=N1e(),e=D1e(),n=CA();return Ea.grammar=n,Ea.write=e,Ea.parse=t.parse,Ea.parseParams=t.parseParams,Ea.parseFmtpConfig=t.parseFmtpConfig,Ea.parsePayloads=t.parsePayloads,Ea.parseRemoteCandidates=t.parseRemoteCandidates,Ea.parseImageAttributes=t.parseImageAttributes,Ea.parseSimulcastStreamList=t.parseSimulcastStreamList,Ea}var ed=F1e();function TA(t,e,n){var r,i,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(r=n.isImmediate)!=null&&r,a=(i=n.callback)!=null&&i,l=n.maxWait,c=Date.now(),u=[];function f(){if(l!==void 0){var m=Date.now()-c;if(m+e>=l)return l-m}return e}var p=function(){var m=[].slice.call(arguments),v=this;return new Promise(function(g,S){var b=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!o){var k=t.apply(v,m);a&&a(k),u.forEach(function(T){return(0,T.resolve)(k)}),u=[]}},f()),b){var w=t.apply(v,m);return a&&a(w),g(w)}u.push({resolve:g,reject:S})})};return p.cancel=function(m){s!==void 0&&clearTimeout(s),u.forEach(function(v){return(0,v.reject)(m)}),u=[]},p}const U1e=.7,j1e=20,Fm={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class JU extends Wl.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=Rt,this.ddExtID=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=TA(i=>X(this,void 0,void 0,function*(){this.emit(Fm.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(i)i(s);else throw s}}),j1e),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=nu((r=n.loggerName)!==null&&r!==void 0?r:qa.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return X(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return X(this,void 0,void 0,function*(){var n;let r;if(e.type==="offer"){let{stereoMids:i,nackMids:s}=$1e(e);this.remoteStereoMids=i,this.remoteNackMids=s}else if(e.type==="answer"){const i=ed.parse((n=e.sdp)!==null&&n!==void 0?n:"");i.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(o=>{if(!o.transceiver||s.mid!=o.transceiver.mid)return!1;let a=0;if(s.rtp.some(c=>c.codec.toUpperCase()===o.codec.toUpperCase()?(a=c.payload,!0):!1),a===0)return!0;let l=!1;for(const c of s.fmtp)if(c.payload===a){c.config=c.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),o.maxbr>0&&(c.config+=";maxaveragebitrate=".concat(o.maxbr*1e3)),l=!0;break}return l||o.maxbr>0&&s.fmtp.push({payload:a,config:"maxaveragebitrate=".concat(o.maxbr*1e3)}),!0})}),r=ed.write(i)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(i=>{this.pc.addIceCandidate(i)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Fm.NegotiationComplete),e.sdp&&ed.parse(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(Fm.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(e){return X(this,void 0,void 0,function*(){var n;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&s)yield this._pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const i=ed.parse((n=r.sdp)!==null&&n!==void 0?n:"");i.media.forEach(s=>{QU(s),s.type==="audio"?ZU(s,[],[]):s.type==="video"&&this.trackBitrates.some(o=>{if(!s.msid||!o.cid||!s.msid.includes(o.cid))return!1;let a=0;if(s.rtp.some(c=>c.codec.toUpperCase()===o.codec.toUpperCase()?(a=c.payload,!0):!1),a===0||(b1(o.codec)&&this.ensureVideoDDExtensionForSVC(s,i),o.codec!=="av1"))return!0;const l=Math.round(o.maxbr*U1e);for(const c of s.fmtp)if(c.payload===a){c.config.includes("x-google-start-bitrate")||(c.config+=";x-google-start-bitrate=".concat(l));break}return!0})}),yield this.setMungedSDP(r,ed.write(i)),this.onOffer(r)})}createAndSetAnswer(){return X(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=ed.parse((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{QU(i),i.type==="audio"&&ZU(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,ed.write(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Vr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Vr("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return X(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),r.set(a.id,a);break;case"remote-candidate":i.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return i.get(o)})}setMungedSDP(e,n,r){return X(this,void 0,void 0,function*(){if(n){const i=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let s="unknown error";i instanceof Error?s=i.message:typeof i=="string"&&(s=i);const o={error:s,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Vx(s)}})}ensureVideoDDExtensionForSVC(e,n){var r,i;if(!((r=e.ext)===null||r===void 0?void 0:r.some(o=>o.uri===jU))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var l;a.type==="video"&&((l=a.ext)===null||l===void 0||l.forEach(c=>{c.value>o&&(o=c.value)}))}),this.ddExtID=o+1}(i=e.ext)===null||i===void 0||i.push({value:this.ddExtID,uri:jU})}}}function ZU(t,e,n){let r=0;t.rtp.some(i=>i.codec==="opus"?(r=i.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(i=>i.payload===r&&i.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(i=>i.payload===r?(i.config.includes("stereo=1")||(i.config+=";stereo=1"),!0):!1))}function $1e(t){var e;const n=[],r=[],i=ed.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return i.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&r.push(o.mid),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:r}}function QU(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Zx="vp8",B1e={audioPreset:nw.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:HC.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Zx,backupCodec:!0},mX={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},gX={deviceId:{ideal:"default"},resolution:Ol.h720.resolution},H1e={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new RY,disconnectOnPageLeave:!0,webAudioMix:!1},RA={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var lr;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(lr||(lr={}));class V1e{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var i;this.peerConnectionTimeout=RA.peerConnectionTimeout,this.log=Rt,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(l=>l.getConnectionState());a.every(l=>l==="connected")?this.state=lr.CONNECTED:a.some(l=>l==="failed")?this.state=lr.FAILED:a.some(l=>l==="connecting")?this.state=lr.CONNECTING:a.every(l=>l==="closed")?this.state=lr.CLOSED:a.some(l=>l==="closed")?this.state=lr.CLOSING:a.every(l=>l==="new")&&(this.state=lr.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(lr[o]," to ").concat(lr[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=nu((i=r.loggerName)!==null&&i!==void 0?i:qa.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new JU(e,r),this.subscriber=new JU(e,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Fa.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Fa.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=s=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,s)},this.state=lr.NEW,this.connectionLock=new ts,this.remoteOfferLock=new ts}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return X(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return X(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return X(this,void 0,void 0,function*(){n===Fa.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return X(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return X(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(s=>this.ensureTransportConnected(s,e,n)))}finally{i()}})}negotiate(e){return X(this,void 0,void 0,function*(){return new Promise((n,r)=>X(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Fm.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Fm.NegotiationComplete,()=>{clearTimeout(i),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(i),r(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Fa.PUBLISHER?this.publisher.getConnectedAddress():e===Fa.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(r.getConnectionState()!=="connected")return new Promise((l,c)=>X(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Ci.clearTimeout(f),c(new dn("room connection has been cancelled",Nt.Cancelled))};i!=null&&i.signal.aborted&&u(),i==null||i.signal.addEventListener("abort",u);const f=Ci.setTimeout(()=>{i==null||i.signal.removeEventListener("abort",u),c(new dn("could not establish pc connection",Nt.InternalError))},o);for(;this.state!==lr.CONNECTED;)if(yield Ls(50),i!=null&&i.signal.aborted){c(new dn("room connection has been cancelled",Nt.Cancelled));return}Ci.clearTimeout(f),i==null||i.signal.removeEventListener("abort",u),l()}))}()})}}class dr extends Error{constructor(e,n,r){super(n),this.code=e,this.message=ej(n,dr.MAX_MESSAGE_BYTES),this.data=r?ej(r,dr.MAX_DATA_BYTES):void 0}static fromProto(e){return new dr(e.code,e.message,e.data)}toProto(){return new oY({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new dr(dr.ErrorCode[e],dr.ErrorMessage[e],n)}}dr.MAX_MESSAGE_BYTES=256;dr.MAX_DATA_BYTES=15360;dr.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};dr.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const vX=15360;function IA(t){return new TextEncoder().encode(t).length}function ej(t,e){if(IA(t)<=e)return t;let n=0,r=t.length;const i=new TextEncoder;for(;n<r;){const s=Math.floor((n+r+1)/2);i.encode(t.slice(0,s)).length<=e?n=s:r=s-1}return t.slice(0,n)}const kA=2e3;function VC(t,e){if(!e)return 0;let n,r;return"bytesReceived"in t?(n=t.bytesReceived,r=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,r=e.bytesSent),n===void 0||r===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(t.timestamp-e.timestamp)}const G1e=1e3;class GC extends ue{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=TA(()=>X(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>X(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Ce.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new ts,this.pauseUpstreamLock=new ts,this.processorLock=new ts,this.restartLock=new ts,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ue.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return X(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Dm(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e){const s=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(pm(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}finally{s()}}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(i??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{pm(i??e,s)}))})}waitForDimensions(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G1e;return function*(){var r;if(e.kind===ue.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=Ka())===null||r===void 0?void 0:r.os)==="iOS"&&(yield Ls(10));const i=Date.now();for(;Date.now()-i<n;){const s=e.dimensions;if(s)return s;yield Ls(50)}throw new Oc("unable to get track dimensions after timeout")}()})}setDeviceId(e){return X(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Id(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Id(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===ue.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),s=e.kind===ue.Kind.Audio?"audioinput":"videoinput";return n?di.getInstance().normalizeDeviceId(s,r,i):r}()})}mute(){return X(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return X(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return X(this,void 0,void 0,function*(){if(!this.sender)throw new Oc("unable to replace an unpublished track");let r,i;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,i=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return X(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:i}=e,s=P0e(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===ue.Kind.Video?o.video=r||i?{deviceId:r,facingMode:i}:!0:o.audio=r?{deviceId:r}:!0,this.attachedElements.forEach(c=>{Dm(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return yield l.applyConstraints(s),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(Ce.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ce.Muted:Ce.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),aX()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return X(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Ce.UpstreamPaused,this);const r=Ka();if((r==null?void 0:r.name)==="Safari"&&Th(r.version,"12.0")<0)throw new bA("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return X(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Ce.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return X(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield r.processorLock.lock();try{r.log.debug("setting up processor",r.logContext);const a=document.createElement(r.kind),l={kind:r.kind,track:r._mediaStreamTrack,element:a,audioContext:r.audioContext};if(yield n.init(l),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.stopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(pm(r._mediaStreamTrack,a),a.muted=!0,a.play().catch(c=>r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:c}))),r.processor=n,r.processorElement=a,r.processor.processedTrack){for(const c of r.attachedElements)c!==r.processorElement&&i&&(Dm(r._mediaStreamTrack,c),pm(r.processor.processedTrack,c));yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(r.processor.processedTrack)}r.emit(Ce.TrackProcessorUpdate,r.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Ce.TrackProcessorUpdate))}()})}}class iw extends GC{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,ue.Kind.Audio,n,r,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>X(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=VC(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Ce.AudioTrackFeatureUpdate,this,Aa.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Ce.AudioTrackFeatureUpdate,this,Aa.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ue.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Id(this._constraints.deviceId);return this.source===ue.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return X(this,void 0,void 0,function*(){let n;if(e){const r=EA({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return X(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){ks()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},kA)))}setProcessor(e){return X(this,void 0,void 0,function*(){var n;const r=yield this.processorLock.lock();try{if(!Ul()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Ce.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return X(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return X(this,void 0,void 0,function*(){const e=yield dX(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Ce.AudioSilenceDetected)),e})}}function q1e(t,e,n){switch(t.kind){case"audio":return new iw(t,e,!1,void 0,n);case"video":return new hg(t,e,!1,n);default:throw new Oc("unsupported track type: ".concat(t.kind))}}const K1e=Object.values(Ol),W1e=Object.values(Gx),z1e=Object.values(HC),Y1e=[Ol.h180,Ol.h360],X1e=[Gx.h180,Gx.h360],J1e=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var r,i;return new un(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=t.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((i=n.fps)!==null&&i!==void 0?i:30))))),n.fps,t.encoding.priority)}),Qx=["q","h","f"];function eP(t,e,n,r){var i,s;let o=r==null?void 0:r.videoEncoding;t&&(o=r==null?void 0:r.screenShareEncoding);const a=r==null?void 0:r.simulcast,l=r==null?void 0:r.scalabilityMode,c=r==null?void 0:r.videoCodec;if(!o&&!a&&!l||!e||!n)return[{}];o||(o=Q1e(t,e,n,c),Rt.debug("using video encoding",o));const u=o.maxFramerate,f=new un(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(l&&b1(c)){const v=new sw(l),g=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const S=Ka();if(jd()||Ul()||(S==null?void 0:S.name)==="Chrome"&&Th(S==null?void 0:S.version,"113")<0){const b=v.suffix=="h"?2:3;for(let w=0;w<v.spatial;w+=1)g.push({rid:Qx[2-w],maxBitrate:o.maxBitrate/Math.pow(b,w),maxFramerate:f.encoding.maxFramerate});g[0].scalabilityMode=l}else g.push({maxBitrate:o.maxBitrate,maxFramerate:f.encoding.maxFramerate,scalabilityMode:l});return f.encoding.priority&&(g[0].priority=f.encoding.priority,g[0].networkPriority=f.encoding.priority),Rt.debug("using svc encoding",{encodings:g}),g}if(!a)return[o];let p=[];t?p=(i=nj(r==null?void 0:r.screenShareSimulcastLayers))!==null&&i!==void 0?i:tj(t,f):p=(s=nj(r==null?void 0:r.videoSimulcastLayers))!==null&&s!==void 0?s:tj(t,f);let m;if(p.length>0){const v=p[0];p.length>1&&([,m]=p);const g=Math.max(e,n);if(g>=960&&m)return ok(e,n,[v,m,f],u);if(g>=480)return ok(e,n,[v,f],u)}return ok(e,n,[f])}function Z1e(t,e,n){var r,i,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Rt.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),l=(r=a.width)!==null&&r!==void 0?r:(i=t.dimensions)===null||i===void 0?void 0:i.width,c=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===ue.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),eP(t.source===ue.Source.ScreenShare,l,c,n)}function Q1e(t,e,n,r){const i=eye(t,e,n);let{encoding:s}=i[0];const o=Math.max(e,n);for(let a=0;a<i.length;a+=1){const l=i[a];if(s=l.encoding,l.width>=o)break}if(r)switch(r){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function eye(t,e,n){if(t)return z1e;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?K1e:W1e}function tj(t,e){if(t)return J1e(e);const{width:n,height:r}=e,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?Y1e:X1e}function ok(t,e,n,r){const i=[];if(n.forEach((s,o)=>{if(o>=Qx.length)return;const a=Math.min(t,e),c={rid:Qx[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=r&&s.encoding.maxFramerate?Math.min(r,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(c.maxFramerate=u);const f=fg()||o===0;s.encoding.priority&&f&&(c.priority=s.encoding.priority,c.networkPriority=s.encoding.priority),i.push(c)}),Ul()&&cX()==="ios"){let s;i.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;i.forEach(a=>{var l;a.maxFramerate!=s&&(o&&(o=!1,Rt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Rt.info('Setting framerate of encoding "'.concat((l=a.rid)!==null&&l!==void 0?l:"",'" to ').concat(s)),a.maxFramerate=s)})}return i}function nj(t){if(t)return t.sort((e,n)=>{const{encoding:r}=e,{encoding:i}=n;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class sw{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function tye(t){return t.source===ue.Source.ScreenShare||t.constraints.height&&Id(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const nye=5e3;class hg extends GC{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,ue.Kind.Video,n,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>X(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}const o=new Map(s.map(a=>[a.rid,a]));if(this.prevStats){let a=0;o.forEach((l,c)=>{var u;const f=(u=this.prevStats)===null||u===void 0?void 0:u.get(c);a+=VC(l,f)}),this._currentBitrate=a}this.prevStats=o}),this.senderLock=new ts}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ks())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},kA))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return X(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,l=cd(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0)s=c.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){r={error:u}}finally{try{!a&&!n&&(i=l.return)&&(yield i.call(l))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return X(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,l=cd(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0){s=c.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){r={error:u}}finally{try{!a&&!n&&(i=l.return)&&(yield i.call(l))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ue.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===ue.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return X(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(i=>{var s;if(i.type==="outbound-rtp"){const o={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(s=i.rid)!==null&&s!==void 0?s:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},a=r.get(i.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((i,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=i.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let r=jo.LOW;r<=jo.HIGH;r+=1)n.push(new vA({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}restartTrack(e){return X(this,void 0,void 0,function*(){var n,r,i,s,o;let a;if(e){const f=EA({video:e});typeof f.video!="boolean"&&(a=f.video)}yield this.restart(a);try{for(var l=!0,c=cd(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){s=u.value,l=!1;const f=s;f.sender&&((o=f.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(f.mediaStreamTrack=this.mediaStreamTrack.clone(),yield f.sender.replaceTrack(f.mediaStreamTrack))}}catch(f){r={error:f}}finally{try{!l&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return X(this,arguments,void 0,function(r){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,l,c,u,f;if(yield n.setProcessor.call(i,r,s),!((u=i.processor)===null||u===void 0)&&u.processedTrack)try{for(var p=!0,m=cd(i.simulcastCodecs.values()),v;v=yield m.next(),o=v.done,!o;p=!0)c=v.value,p=!1,yield(f=c.sender)===null||f===void 0?void 0:f.replaceTrack(i.processor.processedTrack)}catch(g){a={error:g}}finally{try{!p&&!o&&(l=m.return)&&(yield l.call(m))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return X(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},nye))}setPublishingCodecs(e){return X(this,void 0,void 0,function*(){var n,r,i,s,o,a,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,r=cd(e);i=yield r.next(),s=i.done,!s;n=!0){l=i.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const f=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:f})),!f||!f.sender){for(const p of u.qualities)if(p.enabled){c.push(u.codec);break}}else f.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield rj(f.sender,f.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e){return X(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield rj(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),aX()&&this.isInBackground&&this.source===ue.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function rj(t,e,n,r,i,s){return X(this,void 0,void 0,function*(){const o=yield r.lock();i.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:t,qualities:n,senderEncodings:e}));try{const a=t.getParameters(),{encodings:l}=a;if(!l)return;if(l.length!==e.length){i.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:l,senderEncodings:e}));return}let c=!1;const u=Ka();if((u==null?void 0:u.name)==="Chrome"&&Th(u==null?void 0:u.version,"133")>0&&l[0].scalabilityMode){const p=l[0],m=new sw(p.scalabilityMode);let v=Am.OFF;if(n.forEach(g=>{g.enabled&&(v===Am.OFF||g.quality>v)&&(v=g.quality)}),v===Am.OFF)p.active&&(p.active=!1,c=!0);else if(!p.active||m.spatial!==v+1){c=!0,p.active=!0;const g=new sw(e[0].scalabilityMode);m.spatial=v+1,m.suffix=g.suffix,m.spatial===1&&(m.suffix=void 0),p.scalabilityMode=m.toString(),p.scaleResolutionDownBy=Math.pow(2,2-v),e[0].maxBitrate&&(p.maxBitrate=e[0].maxBitrate/(p.scaleResolutionDownBy*p.scaleResolutionDownBy))}}else l.forEach((p,m)=>{var v;let g=(v=p.rid)!==null&&v!==void 0?v:"";g===""&&(g="q");const S=yX(g),b=n.find(w=>w.quality===S);b&&p.active!==b.enabled&&(c=!0,p.active=b.enabled,i.debug("setting layer ".concat(b.quality," to ").concat(p.active?"enabled":"disabled"),s),fg()&&(b.enabled?(p.scaleResolutionDownBy=e[m].scaleResolutionDownBy,p.maxBitrate=e[m].maxBitrate,p.maxFrameRate=e[m].maxFrameRate):(p.scaleResolutionDownBy=4,p.maxBitrate=10,p.maxFrameRate=2)))});c&&(a.encodings=l,i.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:a.encodings})),yield t.setParameters(a))}finally{o()}})}function yX(t){switch(t){case"f":return jo.HIGH;case"h":return jo.MEDIUM;case"q":return jo.LOW;default:return jo.HIGH}}function ij(t,e,n,r){if(!n)return[new uh({quality:jo.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(r){const i=n[0].scalabilityMode,s=new sw(i),o=[],a=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let c=0;c<s.spatial;c+=1)o.push(new uh({quality:Math.min(jo.HIGH,s.spatial-1)-c,width:Math.ceil(t/Math.pow(a,c)),height:Math.ceil(e/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return o}return n.map(i=>{var s,o,a;const l=(s=i.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=yX((o=i.rid)!==null&&o!==void 0?o:"");return new uh({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(a=i.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const sj="_lossy",oj="_reliable",rye=2*1e3,ak="leave-reconnect";var Ca;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ca||(Ca={}));class iye extends Wl.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=RA.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Ca.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Rt,this.handleDataChannel=r=>X(this,[r],void 0,function(i){var s=this;let{channel:o}=i;return function*(){if(o){if(o.label===oj)s.reliableDCSub=o;else if(o.label===sj)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=r=>X(this,void 0,void 0,function*(){var i,s;const o=yield this.dataProcessLock.lock();try{let a;if(r.data instanceof ArrayBuffer)a=r.data;else if(r.data instanceof Blob)a=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const l=bs.fromBinary(new Uint8Array(a));((i=l.value)===null||i===void 0?void 0:i.case)==="speaker"?this.emit(ke.ActiveSpeakersUpdate,l.value.value.speakers):(((s=l.value)===null||s===void 0?void 0:s.case)==="user"&&oye(l,l.value.value),this.emit(ke.DataPacketReceived,l))}finally{o()}}),this.handleDataError=r=>{const s=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:o}=r.error;this.log.error("DataChannel error on ".concat(s,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const s=r.currentTarget.maxRetransmits===0?Bt.LOSSY:Bt.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(ke.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}r===ak&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Ci.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===Ca.Connected&&r();const s=()=>{this.off(ke.Disconnected,o),r()},o=()=>{this.off(ke.Restarted,s),i()};this.once(ke.Restarted,s),this.once(ke.Disconnected,o)}),this.updateAndEmitDCBufferStatus=r=>{const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit(ke.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===An.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Up.RR_SIGNAL_DISCONNECTED))},this.log=nu((n=e.loggerName)!==null&&n!==void 0?n:qa.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new wA(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new ts,this.dataProcessLock=new ts,this.dcBufferStatus=new Map([[Bt.LOSSY,!0],[Bt.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(ke.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(ke.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(ke.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(ke.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(ke.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(ke.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(ke.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(ke.SignalRequestResponse,r)}get logContext(){var e,n,r,i,s,o,a,l;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:(l=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.participant)===null||l===void 0?void 0:l.sid}}join(e,n,r,i){return X(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,r,i);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,setTimeout(()=>{this.emit(ke.SignalConnected)},10),s}catch(s){if(s instanceof dn&&s.reason===Nt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,i);throw s}})}close(){return X(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ke.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return X(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return X(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Oc("a track with the same ID has already been published");return new Promise((n,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new dn("publication of local track timed out, no response from server",Nt.InternalError))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(i),n(s)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return X(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return X(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==lr.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new V1e(i,e.subscriberPrimary,this.loggerOptions),this.emit(ke.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=s=>{this.client.sendOffer(s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>X(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===lr.CONNECTED){const u=this.pcState===Ca.New;this.pcState=Ca.Connected,u&&this.emit(ke.Connected,e)}else s===lr.FAILED&&this.pcState===Ca.Connected&&(this.pcState=Ca.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?Up.RR_SUBSCRIBER_FAILED:Up.RR_PUBLISHER_FAILED));const l=this.client.isDisconnected||this.client.currentState===An.RECONNECTING,c=[lr.FAILED,lr.CLOSING,lr.CLOSED].includes(s);l&&c&&!this._isClosed&&this.emit(ke.Offline)}),this.pcManager.onTrack=s=>{this.emit(ke.MediaTrackAdded,s.track,s.streams[0],s.receiver)},sye((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>X(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=e=>X(this,void 0,void 0,function*(){if(!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(ke.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(ke.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(ke.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(ke.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.emit(ke.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Up.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Mm.DISCONNECT:this.emit(ke.Disconnected,e==null?void 0:e.reason),this.close();break;case Mm.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ak);break;case Mm.RESUME:this.handleDisconnect(ak)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),i.push(o)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===sy.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(sj,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(oj,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,r){return X(this,void 0,void 0,function*(){if(qx())return yield this.createTransceiverRTCRtpSender(e,n,r);if(Kx())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Vr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,i){return X(this,void 0,void 0,function*(){if(qx())return this.createSimulcastTransceiverSender(e,n,r,i);if(Kx())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Vr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new Vr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Gg(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:i};return r&&(s.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,r,i){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new Vr("publisher is closed");const s={direction:"sendonly"};i&&(s.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new Vr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return X(this,void 0,void 0,function*(){var n,r,i;if(!this._isClosed){if(this.attemptingReconnect){Rt.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===sy.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:lr.NEW)===lr.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Vr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof jp||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Up.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ke.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return X(this,void 0,void 0,function*(){var n,r,i;try{if(!this.url||!this.token)throw new Vr("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ke.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new jp;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof dn&&o.reason===Nt.NotAllowed?new Vr("could not reconnect, token might be expired"):new jp}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ke.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==An.CONNECTED)throw new jp("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(ke.Restarted)}catch(s){const o=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),s}})}resumeConnection(e){return X(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Vr("could not reconnect, url or token not saved");if(!this.pcManager)throw new Vr("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ke.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let s="";throw i instanceof Error&&(s=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof dn&&i.reason===Nt.NotAllowed?new Vr("could not reconnect, token might be expired"):i instanceof dn&&i.reason===Nt.LeaveRequest?i:new jp(s)}if(this.emit(ke.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==An.CONNECTED)throw new jp("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(ke.Resumed)})}waitForPCInitialConnection(e,n){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new Vr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return X(this,void 0,void 0,function*(){this.pcState=Ca.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ls(rye),!this.pcManager)throw new Vr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ca.Connected}catch(e){throw this.pcState=Ca.Disconnected,new dn("could not establish PC connection, ".concat(e.message),Nt.InternalError)}})}publishRpcResponse(e,n,r,i){return X(this,void 0,void 0,function*(){const s=new bs({destinationIdentities:[e],kind:Bt.RELIABLE,value:{case:"rpcResponse",value:new sY({requestId:n,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(s,Bt.RELIABLE)})}publishRpcAck(e,n){return X(this,void 0,void 0,function*(){const r=new bs({destinationIdentities:[e],kind:Bt.RELIABLE,value:{case:"rpcAck",value:new iY({requestId:n})}});yield this.sendDataPacket(r,Bt.RELIABLE)})}sendDataPacket(e,n){return X(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(n);const i=this.dataChannelForKind(n);i&&i.send(r),this.updateAndEmitDCBufferStatus(n)})}waitForBufferStatusLow(e){return new Promise((n,r)=>X(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const i=()=>r("Engine closed");for(this.once(ke.Closing,i);!this.dcBufferStatus.get(e);)yield Ls(10);this.off(ke.Closing,i),n()}}))}ensureDataTransportConnected(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!r.pcManager)throw new Vr("PC manager is closed");const o=i?r.pcManager.subscriber:r.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new dn("".concat(a," connection not set"),Nt.InternalError);let l=!1;!i&&!r.dataChannelForKind(n,i)&&(r.createDataChannels(),l=!0),!l&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&r.negotiate();const c=r.dataChannelForKind(n,i);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=r.dataChannelForKind(n,i))===null||s===void 0?void 0:s.readyState)==="open")return;yield Ls(50)}throw new dn("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),Nt.InternalError)}()})}ensurePublisherConnected(e){return X(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==lr.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return X(this,void 0,void 0,function*(){return new Promise((e,n)=>X(this,void 0,void 0,function*(){if(!this.pcManager){n(new Vx("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(ke.Closing,i),this.pcManager.publisher.once(Fm.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const l=a.codec.toLowerCase();p1e(l)&&o.set(a.payload,l)}),this.emit(ke.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(r),e()}catch(s){s instanceof Vx&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Up.RR_UNKNOWN),n(s)}finally{this.off(ke.Closing,i)}}))})}dataChannelForKind(e,n){if(n){if(e===Bt.LOSSY)return this.lossyDCSub;if(e===Bt.RELIABLE)return this.reliableDCSub}else{if(e===Bt.LOSSY)return this.lossyDC;if(e===Bt.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,i;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(i=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&i!==void 0?i:!0,l=new Array,c=new Array;e.forEach(u=>{u.isDesired!==a&&l.push(u.trackSid),u.isEnabled||c.push(u.trackSid)}),this.client.sendSyncState(new SY({answer:s?rw({sdp:s.sdp,type:s.type}):void 0,offer:o?rw({sdp:o.sdp,type:o.type}):void 0,subscription:new $C({trackSids:l,subscribe:!a,participantTracks:[]}),publishTracks:w1e(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,i)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new EY({label:r.label,id:r.id,target:i}))};return n(this.dataChannelForKind(Bt.LOSSY),Fa.PUBLISHER),n(this.dataChannelForKind(Bt.RELIABLE),Fa.PUBLISHER),n(this.dataChannelForKind(Bt.LOSSY,!0),Fa.SUBSCRIBER),n(this.dataChannelForKind(Bt.RELIABLE,!0),Fa.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Ci.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ks()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){ks()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class jp extends Error{}function sye(t){return t!==void 0&&t>13}function oye(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const r=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=r,e.destinationIdentities=r}class tP{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return zx(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return X(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(i=>i.url===r.url));if(n.length>0){const r=n[0];return this.attemptedRegions.push(r),Rt.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return X(this,void 0,void 0,function*(){const n=yield fetch("".concat(aye(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const r=yield n.json();return this.lastUpdateAt=Date.now(),r}else throw new dn("Could not fetch region settings: ".concat(n.statusText),n.status===401?Nt.NotAllowed:Nt.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function aye(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class _X{get info(){return this._info}constructor(e,n,r){this.reader=n,this.totalByteSize=r,this._info=e,this.bytesReceived=0}}class lye extends _X{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>X(this,void 0,void 0,function*(){try{const{done:n,value:r}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:r.content})}catch{return{done:!0,value:void 0}}}),return(){return X(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return X(this,void 0,void 0,function*(){var e,n,r,i;let s=new Set;try{for(var o=!0,a=cd(this),l;l=yield a.next(),e=l.done,!e;o=!0){i=l.value,o=!1;const c=i;s.add(c)}}catch(c){n={error:c}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(n)throw n.error}}return Array.from(s)})}}class cye extends _X{constructor(e,n,r){super(e,n,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const r=G2(e.chunkIndex),i=this.receivedChunks.get(r);if(i&&i.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength;const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>X(this,void 0,void 0,function*(){try{const{done:r,value:i}=yield e.read();return r?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:n.decode(i.content)})}catch{return{done:!0,value:void 0}}}),return(){return X(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return X(this,void 0,void 0,function*(){var e,n,r,i;let s="";try{for(var o=!0,a=cd(this),l;l=yield a.next(),e=l.done,!e;o=!0)i=l.value,o=!1,s+=i}catch(c){n={error:c}}finally{try{!o&&!e&&(r=a.return)&&(yield r.call(a))}finally{if(n)throw n.error}}return s})}}class bX{constructor(e,n,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return X(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class uye extends bX{}class dye extends bX{}class xA extends ue{constructor(e,n,r,i,s){super(e,r,s),this.sid=n,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ce.Muted:Ce.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Ce.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return X(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),kA)),C1e()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:s}=r;s&&this.rtpTimestamp!==s&&(this.emit(Ce.TimeSyncUpdate,{timestamp:i,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class SX extends xA{constructor(e,n,r,i,s,o){super(e,n,ue.Kind.Audio,r,o),this.monitorReceiver=()=>X(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=VC(a,this.prevStats)),this.prevStats=a}),this.audioContext=i,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;Ul()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Ul())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return X(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(Wx(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Wx(e)&&e.setSinkId(this.sinkId).catch(r=>{this.log.error("Failed to set sink id on remote audio track",r,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Ce.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(Ce.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return X(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const lk=100;class fye extends xA{constructor(e,n,r,i,s){super(e,n,ue.Kind.Video,r,s),this.elementInfos=[],this.monitorReceiver=()=>X(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=VC(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=TA(()=>{this.updateDimensions()},lk),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Dm(this._mediaStreamTrack,n):pm(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new hye(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return X(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",i=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(r=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&i.set(s.id,s)}),n&&r!==""&&i.get(r)&&(n.mimeType=i.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const r=this.elementInfos.reduce((a,l)=>Math.max(a,l.visibilityChangedAt||0),0),i=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!i||s;if(this.lastVisible!==o){if(!o&&Date.now()-r<lk){Ci.setTimeout(()=>{this.updateVisibility()},lk);return}this.lastVisible=o,this.emit(Ce.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let r=0,i=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,l=o.height()*s;a+l>r+i&&(r=a,i=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===i||(this.lastDimensions={width:r,height:i},this.emit(Ce.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?$U():n||($U()>2?2:1)}}class hye{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var i;const{target:s,isIntersecting:o}=r;s===this.element&&(this.isIntersecting=o,this.isPiP=C0(this.element),this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r,i,s;(i=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP),this.isPiP=C0(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=C0(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??nP(e),this.isPiP=ks()&&C0(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,r;this.isIntersecting=nP(this.element),this.isPiP=C0(this.element),this.element.handleResize=()=>{var i;(i=this.handleResize)===null||i===void 0||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,HU().observe(this.element),BU().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,r,i,s;(e=HU())===null||e===void 0||e.unobserve(this.element),(n=BU())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function C0(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?nP(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function nP(t,e){const n=e||window;let r=t.offsetTop,i=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,r+=t.offsetTop,i+=t.offsetLeft;return r<n.pageYOffset+n.innerHeight&&i<n.pageXOffset+n.innerWidth&&r+o>n.pageYOffset&&i+s>n.pageXOffset&&!a&&l!=="none"}class Ic extends Wl.EventEmitter{constructor(e,n,r,i){var s;super(),this.metadataMuted=!1,this.encryption=so.NONE,this.log=Rt,this.handleMuted=()=>{this.emit(Ce.Muted)},this.handleUnmuted=()=>{this.emit(Ce.Unmuted)},this.log=nu((s=i==null?void 0:i.loggerName)!==null&&s!==void 0?s:qa.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=ue.Source.Unknown}setTrack(e){this.track&&(this.track.off(Ce.Muted,this.handleMuted),this.track.off(Ce.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Ce.Muted,this.handleMuted),e.on(Ce.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),nn(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==so.NONE}get audioTrack(){if(ru(this.track))return this.track}get videoTrack(){if(Gg(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ue.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ue.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Ic||(Ic={}));class rP extends Ic{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Ce.Ended)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&this.track.off(Ce.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Ce.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return X(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return X(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return X(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return X(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(ru(this.track)){const n=this.track.getSourceTrackSettings(),r=new Set;return n.autoGainControl&&r.add(Aa.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(Aa.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(Aa.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(Aa.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(Aa.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(Aa.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function n_(t,e){return X(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:r,videoProcessor:i,optionsWithoutProcessor:s}=hX(t);let o=s.audio,a=s.video;if(r&&typeof s.audio=="object"&&(s.audio.processor=r),i&&typeof s.video=="object"&&(s.video.processor=i),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const f=s.audio.deviceId;s.audio.deviceId={exact:f},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:f}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const f=s.video.deviceId;s.video.deviceId={exact:f},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:f}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const l=uX(s,mX,gX),c=EA(l),u=navigator.mediaDevices.getUserMedia(c);s.audio&&(di.userMediaPromiseMap.set("audioinput",u),u.catch(()=>di.userMediaPromiseMap.delete("audioinput"))),s.video&&(di.userMediaPromiseMap.set("videoinput",u),u.catch(()=>di.userMediaPromiseMap.delete("videoinput")));try{const f=yield u;return yield Promise.all(f.getTracks().map(p=>X(this,void 0,void 0,function*(){const m=p.kind==="audio";let v=m?l.audio:l.video;(typeof v=="boolean"||!v)&&(v={});let g;const S=m?c.audio:c.video;typeof S!="boolean"&&(g=S);const b=p.getSettings().deviceId;g!=null&&g.deviceId&&Id(g.deviceId)!==b?g.deviceId=b:g||(g={deviceId:b});const w=q1e(p,g,e);return w.kind===ue.Kind.Video?w.source=ue.Source.Camera:w.kind===ue.Kind.Audio&&(w.source=ue.Source.Microphone),w.mediaStream=f,ru(w)&&r?yield w.setProcessor(r):Gg(w)&&i&&(yield w.setProcessor(i)),w})))}catch(f){if(!n)throw f;return n_(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function pye(t){return X(this,void 0,void 0,function*(){return(yield n_({audio:!1,video:!0}))[0]})}function mye(t){return X(this,void 0,void 0,function*(){return(yield n_({audio:!0,video:!1}))[0]})}var ud;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(ud||(ud={}));function gye(t){switch(t){case t1.EXCELLENT:return ud.Excellent;case t1.GOOD:return ud.Good;case t1.POOR:return ud.Poor;case t1.LOST:return ud.Lost;default:return ud.Unknown}}class EX extends Wl.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===ew.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Om.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,i,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ew.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ud.Unknown,this.log=Rt,this.log=nu((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:qa.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new SA,this.once(se.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(ue.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(ue.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ue.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Om.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Om.ACTIVE&&this.emit(se.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(se.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(se.ParticipantNameChanged,e)}_setAttributes(e){const n=T1e(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(se.AttributesChanged,n)}setPermissions(e){var n,r,i,s,o,a;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,f)=>{var p;return u!==((p=this.permissions)===null||p===void 0?void 0:p.canPublishSources[f])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(se.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(se.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=gye(e),n!==this._connectionQuality&&this.emit(se.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>ru(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(Ce.Muted,()=>{this.emit(se.TrackMuted,e)}),e.on(Ce.Unmuted,()=>{this.emit(se.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ue.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ue.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function vye(t){var e,n,r;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new _Y({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=t.allowAll)!==null&&r!==void 0?r:!1,trackSids:t.allowedTrackSids||[]})}const aj=15e3;class yye extends EX{constructor(e,n,r,i,s){super(e,n,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=so.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new SA)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(l=>this.log.warn(l.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=o=>{const{requestId:a,reason:l,message:c}=o,u=this.pendingSignalRequests.get(a);u&&(l!==yA.OK&&u.reject(new DU(c,l)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let a=o.value.value,l=null,c=null;a.value.case==="payload"?l=a.value.value:a.value.case==="error"&&(c=dr.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,l,c);break;case"rpcAck":let u=o.value.value;this.handleIncomingRpcAck(u.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>vye(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),nn(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),nn(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),nn(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const a=this.audioTrackPublications.get(o.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.handleSubscribedQualityUpdate=o=>X(this,void 0,void 0,function*(){var a,l,c,u,f,p;if(!(!((f=this.roomOptions)===null||f===void 0)&&f.dynacast))return;const m=this.videoTrackPublications.get(o.trackSid);if(!m){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(o.subscribedCodecs.length>0){if(!m.videoTrack)return;const b=yield m.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var v=!0,g=cd(b),S;S=yield g.next(),a=S.done,!a;v=!0){u=S.value,v=!1;const w=u;r1e(w)&&(this.log.debug("publish ".concat(w," for ").concat(m.videoTrack.sid),Object.assign(Object.assign({},this.logContext),nn(m))),yield this.publishAdditionalCodecForTrack(m.videoTrack,w,m.options))}}catch(w){l={error:w}}finally{try{!v&&!a&&(c=g.return)&&(yield c.call(g))}finally{if(l)throw l.error}}}else o.subscribedQualities.length>0&&(yield(p=m.videoTrack)===null||p===void 0?void 0:p.setPublishingLayers(o.subscribedQualities))}),this.handleLocalTrackUnpublished=o=>{const a=this.trackPublications.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>X(this,void 0,void 0,function*(){if(o.source===ue.Source.ScreenShare||o.source===ue.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),nn(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(Xf(o)||qu(o))try{if(ks())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===ue.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),nn(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),nn(o))),Xf(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),nn(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==so.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on(ke.RemoteMute,(n,r)=>{const i=this.trackPublications.get(n);!i||!i.track||(r?i.mute():i.unmute())}),this.engine.on(ke.Connected,this.handleReconnected).on(ke.SignalRestarted,this.handleReconnected).on(ke.SignalResumed,this.handleReconnected).on(ke.Restarting,this.handleReconnecting).on(ke.Resuming,this.handleReconnecting).on(ke.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ke.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ke.Disconnected,this.handleDisconnected).on(ke.SignalRequestResponse,this.handleSignalRequestResponse).on(ke.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return X(this,arguments,void 0,function(n){var r=this;let{metadata:i,name:s,attributes:o}=n;return function*(){return new Promise((a,l)=>X(r,void 0,void 0,function*(){var c,u;try{let f=!1;const p=yield this.engine.client.sendUpdateLocalMetadata((c=i??this.metadata)!==null&&c!==void 0?c:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),m=performance.now();for(this.pendingSignalRequests.set(p,{resolve:a,reject:v=>{l(v),f=!0},values:{name:s,metadata:i,attributes:o}});performance.now()-m<5e3&&!f;){if((!s||this.name===s)&&(!i||this.metadata===i)&&(!o||Object.entries(o).every(v=>{let[g,S]=v;return this.attributes[g]===S||S===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(p),a();return}yield Ls(50)}l(new DU("Request to update local metadata timed out","TimeoutError"))}catch(f){f instanceof Error&&l(f)}}))}()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(ue.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(ue.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(ue.Source.ScreenShare,e,n,r)}setPermissions(e){const n=this.permissions,r=super.setPermissions(e);return r&&n&&this.emit(se.ParticipantPermissionsChanged,n),r}setE2EEEnabled(e){return X(this,void 0,void 0,function*(){this.encryptionType=e?so.GCM:so.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,i){return X(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case ue.Source.Camera:l=yield this.createTracks({video:(s=r)!==null&&s!==void 0?s:!0});break;case ue.Source.Microphone:l=yield this.createTracks({audio:(o=r)!==null&&o!==void 0?o:!0});break;case ue.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Oc(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(se.MediaDevicesError,c),this.pendingPublishing.delete(e),c}try{const c=[];for(const f of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),nn(f))),c.push(this.publishTrack(f,i));[a]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===ue.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const l=this.getTrackPublication(ue.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return X(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(ue.Source.Camera)||this.pendingPublishing.has(ue.Source.Microphone))){this.pendingPublishing.add(ue.Source.Camera),this.pendingPublishing.add(ue.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(ue.Source.Camera),this.pendingPublishing.delete(ue.Source.Microphone)}}})}createTracks(e){return X(this,void 0,void 0,function*(){var n,r;e??(e={});const i=uX(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield n_(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(ru(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=ue.Source.Microphone,this.emit(se.AudioStreamAcquired)),Gg(a)&&(this.cameraError=void 0,a.source=ue.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return X(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new bA("getDisplayMedia not supported");e.resolution===void 0&&!c1e()&&(e.resolution=HC.h1080fps30.resolution);const n=E1e(e),r=yield navigator.mediaDevices.getDisplayMedia(n),i=r.getVideoTracks();if(i.length===0)throw new Oc("no video track found");const s=new hg(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=ue.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(r.getAudioTracks().length>0){this.emit(se.AudioStreamAcquired);const a=new iw(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=ue.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return X(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,l,c,u;Xf(r)&&r.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),dh(r)&&s.pendingPublishPromises.has(r)&&(yield s.pendingPublishPromises.get(r));let f;if(r instanceof MediaStreamTrack)f=r.getConstraints();else{f=r.constraints;let b;switch(r.source){case ue.Source.Microphone:b="audioinput";break;case ue.Source.Camera:b="videoinput"}b&&s.activeDeviceMap.has(b)&&(f=Object.assign(Object.assign({},f),{deviceId:s.activeDeviceMap.get(b)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new iw(r,f,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":r=new hg(r,f,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Oc("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let p;if(s.trackPublications.forEach(b=>{b.track&&b.track===r&&(p=b)}),p)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),nn(p))),p;const m="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,v=(l=i==null?void 0:i.forceStereo)!==null&&l!==void 0?l:m;v&&(i||(i={}),i.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),nn(r))),i.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=i.dtx)!==null&&c!==void 0||(i.dtx=!1),(u=i.red)!==null&&u!==void 0||(i.red=!1));const g=Object.assign(Object.assign({},s.roomOptions.publishDefaults),i);!u1e()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),g.simulcast=!1),g.source&&(r.source=g.source);const S=new Promise((b,w)=>X(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==An.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:nn(r)}));const k=()=>X(this,void 0,void 0,function*(){try{const T=yield this.publish(r,g,v);b(T)}catch(T){w(T)}});setTimeout(()=>{this.engine.off(ke.SignalConnected,k),w(new YI("publishing rejected as engine not connected within timeout",408))},15e3),this.engine.once(ke.SignalConnected,k),this.engine.on(ke.Closing,()=>{this.engine.off(ke.SignalConnected,k),w(new YI("publishing rejected as engine closed",499))})}else try{const k=yield this.publish(r,g,v);b(k)}catch(k){w(k)}}catch(k){w(k)}}));s.pendingPublishPromises.set(r,S);try{return yield S}catch(b){throw b}finally{s.pendingPublishPromises.delete(r)}}()})}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),nn(e))),!1;const{canPublish:n,canPublishSources:r}=this.permissions;return n&&(r.length===0||r.map(i=>R1e(i)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),nn(e))),!1)}publish(e,n,r){return X(this,void 0,void 0,function*(){var i,s,o,a,l,c,u,f,p,m;if(!this.hasPermissionsToPublish(e))throw new YI("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(I=>dh(e)&&I.source===e.source)&&e.source!==ue.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),nn(e))),n.stopMicTrackOnMute&&ru(e)&&(e.stopOnMute=!0),e.source===ue.Source.ScreenShare&&fg()&&(n.simulcast=!1),n.videoCodec==="av1"&&!o1e()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!a1e()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Zx),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(I=>n.videoCodec===q2(I.mime))||(n.videoCodec=q2(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(Ce.Muted,this.onTrackMuted),e.on(Ce.Unmuted,this.onTrackUnmuted),e.on(Ce.Ended,this.handleTrackEnded),e.on(Ce.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Ce.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const S=new Nx({cid:e.mediaStreamTrack.id,name:n.name,type:ue.kindToProto(e.kind),muted:e.isMuted,source:ue.sourceToProto(e.source),disableDtx:!(!((i=n.dtx)!==null&&i!==void 0)||i),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy});let b;if(e.kind===ue.Kind.Video){let I={width:0,height:0};try{I=yield e.waitForDimensions()}catch{const x=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Ol.h720.resolution;I={width:x.width,height:x.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),nn(e)),{dims:I}))}S.width=I.width,S.height=I.height,qu(e)&&(b1(g)&&(e.source===ue.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),nn(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),S.simulcastCodecs=[new Mx({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Zx}),n.backupCodec&&g!==n.backupCodec.codec&&S.encryption===so.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new Mx({codec:n.backupCodec.codec,cid:""})))),b=eP(e.source===ue.Source.ScreenShare,S.width,S.height,n),S.layers=ij(S.width,S.height,b,b1(n.videoCodec))}else e.kind===ue.Kind.Audio&&(b=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(f=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&f!==void 0?f:"high",networkPriority:(m=(p=n.audioPreset)===null||p===void 0?void 0:p.priority)!==null&&m!==void 0?m:"high"}]);if(!this.engine||this.engine.isClosed)throw new Vr("cannot publish track when not connected");const w=()=>X(this,void 0,void 0,function*(){var I,C,x;if(!this.engine.pcManager)throw new Vr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,b),qu(e)&&((I=n.degradationPreference)!==null&&I!==void 0||(n.degradationPreference=tye(e)),e.setDegradationPreference(n.degradationPreference)),b)if(fg()&&e.kind===ue.Kind.Audio){let A;for(const N of this.engine.pcManager.publisher.getTransceivers())if(N.sender===e.sender){A=N;break}A&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:A,codec:"opus",maxbr:!((C=b[0])===null||C===void 0)&&C.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&b1(e.codec)&&(!((x=b[0])===null||x===void 0)&&x.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;if(this.enabledPublishVideoCodecs.length>0)k=(yield Promise.all([this.engine.addTrack(S),w()]))[0];else{k=yield this.engine.addTrack(S);let I;if(k.codecs.forEach(C=>{I===void 0&&(I=C.mimeType)}),I&&e.kind===ue.Kind.Video){const C=q2(I);C!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),nn(e)),{codec:C})),n.videoCodec=C,b=eP(e.source===ue.Source.ScreenShare,S.width,S.height,n))}yield w()}const T=new rP(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return T.options=n,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),qu(e)?e.startMonitor(this.engine.client):Xf(e)&&e.startMonitor(),this.addTrackPublication(T),this.emit(se.LocalTrackPublished,T),T})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return X(this,void 0,void 0,function*(){var i;if(this.encryptionType!==so.NONE)return;let s;if(this.trackPublications.forEach(m=>{m.track&&m.track===e&&(s=m)}),!s)throw new Oc("track is not published");if(!qu(e))throw new Oc("track is not a video track");const o=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),a=Z1e(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),nn(e)));return}const l=e.addSimulcastTrack(n,a);if(!l)return;const c=new Nx({cid:l.mediaStreamTrack.id,type:ue.kindToProto(e.kind),muted:e.isMuted,source:ue.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=ij(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new Vr("cannot publish track when not connected");const u=()=>X(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,o,a),yield this.engine.negotiate()}),p=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:p}))})}unpublishTrack(e,n){return X(this,void 0,void 0,function*(){var r,i;if(dh(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),nn(e))),yield c)}const s=this.getPublicationForTrack(e),o=s?nn(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(Ce.Muted,this.onTrackMuted),e.off(Ce.Unmuted,this.onTrackUnmuted),e.off(Ce.Ended,this.handleTrackEnded),e.off(Ce.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Ce.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Ce.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),n?e.stop():e.stopMonitor();let a=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<lr.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",a=!0);if(this.engine.removeTrack(l)&&(a=!0),qu(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(a=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case ue.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case ue.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(se.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return X(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((s,o)=>X(r,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),a.push(l))}),yield Promise.all(a.map(l=>X(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),i&&!c.isMuted&&c.source!==ue.Source.ScreenShare&&c.source!==ue.Source.ScreenShareAudio&&(Xf(c)||qu(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield r.republishPromise}()})}publishData(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=i.reliable?Bt.RELIABLE:Bt.LOSSY,o=i.destinationIdentities,a=i.topic,l=new bs({kind:s,value:{case:"user",value:new tY({participantIdentity:r.identity,payload:n,destinationIdentities:o,topic:a})}});yield r.engine.sendDataPacket(l,s)}()})}publishDtmf(e,n){return X(this,void 0,void 0,function*(){const r=new bs({kind:Bt.RELIABLE,value:{case:"sipDtmf",value:new nY({code:e,digit:n})}});yield this.engine.sendDataPacket(r,Bt.RELIABLE)})}sendChatMessage(e,n){return X(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},i=new bs({value:{case:"chatMessage",value:new kx(Object.assign(Object.assign({},r),{timestamp:Wn.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(i,Bt.RELIABLE),this.emit(se.ChatMessage,r),r})}editChatMessage(e,n){return X(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),i=new bs({value:{case:"chatMessage",value:new kx(Object.assign(Object.assign({},r),{timestamp:Wn.parse(r.timestamp),editTimestamp:Wn.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,Bt.RELIABLE),this.emit(se.ChatMessage,r),r})}sendText(e,n){return X(this,void 0,void 0,function*(){var r;const i=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(r=n==null?void 0:n.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),l=new Array(a?a.length+1:1).fill(0),c=(f,p)=>{var m;l[p]=f;const v=l.reduce((g,S)=>g+S,0);(m=n==null?void 0:n.onProgress)===null||m===void 0||m.call(n,v)},u=yield this.streamText({streamId:i,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((f,p)=>X(this,void 0,void 0,function*(){return this._sendFile(a[p],f,{topic:n.topic,mimeType:f.type,onProgress:m=>{c(m,p+1)}})})))),u.info})}streamText(e){return X(this,void 0,void 0,function*(){var n,r;const i=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},o=new Px({streamId:i,mimeType:s.mimeType,topic:s.topic,timestamp:Yf(s.timestamp),totalLength:Yf(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new fY({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?xx.UPDATE:xx.CREATE})}}),a=e==null?void 0:e.destinationIdentities,l=new bs({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(l,Bt.RELIABLE);let c=0;const u=this,f=new WritableStream({write(v){return X(this,void 0,void 0,function*(){for(const g of b1e(v,aj)){yield u.engine.waitForBufferStatusLow(Bt.RELIABLE);const S=new Lx({content:g,streamId:i,chunkIndex:Yf(c)}),b=new bs({destinationIdentities:a,value:{case:"streamChunk",value:S}});yield u.engine.sendDataPacket(b,Bt.RELIABLE),c+=1}})},close(){return X(this,void 0,void 0,function*(){const v=new Ax({streamId:i}),g=new bs({destinationIdentities:a,value:{case:"streamTrailer",value:v}});yield u.engine.sendDataPacket(g,Bt.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let p=()=>X(this,void 0,void 0,function*(){yield m.close()});u.engine.once(ke.Closing,p);const m=new uye(f,s,()=>this.engine.off(ke.Closing,p));return m})}sendFile(e,n){return X(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,n),{id:r}})}_sendFile(e,n,r){return X(this,void 0,void 0,function*(){var i;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:n.type,topic:r==null?void 0:r.topic,destinationIdentities:r==null?void 0:r.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:l}=yield o.read();if(a)break;yield s.write(l)}return yield s.close(),s.info})}streamBytes(e){return X(this,void 0,void 0,function*(){var n,r,i,s,o;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e==null?void 0:e.destinationIdentities,c={id:a,mimeType:(r=e==null?void 0:e.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown"},u=new Px({totalLength:Yf((o=c.size)!==null&&o!==void 0?o:0),mimeType:c.mimeType,streamId:a,topic:c.topic,timestamp:Yf(Date.now()),attributes:c.attributes,contentHeader:{case:"byteHeader",value:new hY({name:c.name})}}),f=new bs({destinationIdentities:l,value:{case:"streamHeader",value:u}});yield this.engine.sendDataPacket(f,Bt.RELIABLE);let p=0;const m=new ts,v=this.engine,g=this.log,S=new WritableStream({write(w){return X(this,void 0,void 0,function*(){const k=yield m.lock();let T=0;try{for(;T<w.byteLength;){const I=w.slice(T,T+aj);yield v.waitForBufferStatusLow(Bt.RELIABLE);const C=new bs({destinationIdentities:l,value:{case:"streamChunk",value:new Lx({content:I,streamId:a,chunkIndex:Yf(p)})}});yield v.sendDataPacket(C,Bt.RELIABLE),p+=1,T+=I.byteLength}}finally{k()}})},close(){return X(this,void 0,void 0,function*(){const w=new Ax({streamId:a}),k=new bs({destinationIdentities:l,value:{case:"streamTrailer",value:w}});yield v.sendDataPacket(k,Bt.RELIABLE)})},abort(w){g.error("Sink error:",w)}});return new dye(S,c)})}performRpc(e){return X(this,arguments,void 0,function(n){var r=this;let{destinationIdentity:i,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((c,u)=>X(r,void 0,void 0,function*(){var f,p,m,v;if(IA(o)>vX){u(dr.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((p=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||p===void 0)&&p.version&&Th((v=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){u(dr.builtIn("UNSUPPORTED_SERVER"));return}const g=crypto.randomUUID();yield this.publishRpcRequest(i,g,s,o,a-2e3);const S=setTimeout(()=>{this.pendingAcks.delete(g),u(dr.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(b)},2e3);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(S)},participantIdentity:i});const b=setTimeout(()=>{this.pendingResponses.delete(g),u(dr.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(g,{resolve:(w,k)=>{clearTimeout(b),this.pendingAcks.has(g)&&(console.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(S)),k?u(k):c(w??"")},participantIdentity:i})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,r){const i=this.pendingResponses.get(e);i?(i.resolve(n,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,r,i,s){return X(this,void 0,void 0,function*(){const o=new bs({destinationIdentities:[e],kind:Bt.RELIABLE,value:{case:"rpcRequest",value:new rY({id:n,method:r,payload:i,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,Bt.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:r,resolve:i}]of this.pendingResponses)r===e&&(i(null,dr.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var r,i;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((i=(r=s.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),nn(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(Xf(i)||qu(i))&&i.mediaStreamTrack===e&&(n=r):e===i&&(n=r))}),n}waitForPendingPublicationOfSource(e){return X(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const i=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(i)return i[1];yield Ls(20)}})}}class ow extends Ic{constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=jo.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(Ce.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new $C({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new aY({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Ce.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Ic.SubscriptionStatus.Unsubscribed:super.isSubscribed?Ic.SubscriptionStatus.Subscribed:Ic.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Ic.PermissionStatus.Allowed:Ic.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(tk(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&tk(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Ce.VisibilityChanged,this.handleVisibilityChange),i.off(Ce.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Ce.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Ce.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Ce.VisibilityChanged,this.handleVisibilityChange),e.on(Ce.Ended,this.handleEnded),this.emit(Ce.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(Ce.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?Ce.Muted:Ce.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(Ce.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Ce.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===ue.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return tk(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new pY({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=jo.HIGH,this.emit(Ce.UpdateSettings,e)}}class aw extends EX{static fromParticipantInfo(e,n,r){return new aw(e,n.sid,n.identity,n.name,n.metadata,n.attributes,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,i,s,o,a){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ew.STANDARD;super(n,r||"",i,s,o,a,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Ce.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),nn(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(Ce.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(Ce.SubscriptionPermissionChanged,n=>{this.emit(se.TrackSubscriptionPermissionChanged,e,n)}),e.on(Ce.SubscriptionStatusChanged,n=>{this.emit(se.TrackSubscriptionStatusChanged,e,n)}),e.on(Ce.Subscribed,n=>{this.emit(se.TrackSubscribed,n,e)}),e.on(Ce.Unsubscribed,n=>{this.emit(se.TrackUnsubscribed,n,e)}),e.on(Ce.SubscriptionFailed,n=>{this.emit(se.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ue.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ue.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,i,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(se.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,i,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),nn(a))),this.emit(se.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new fye(e,n,i,s):c=new SX(e,n,i,this.audioContext,this.audioOutput),c.source=a.source,c.isMuted=a.isMuted,c.setMediaStream(r),c.start(),a.setTrack(c),this.volumeMap.has(a.source)&&Xx(c)&&ru(c)&&c.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(i=>{var s,o;let a=this.getTrackPublicationBySid(i.sid);if(a)a.updateInfo(i);else{const l=ue.kindFromProto(i.type);if(!l)return;a=new ow(l,i,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(i),r.set(i.sid,a);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));c&&a.source!==ue.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:nn(c),newTrack:nn(a)})),this.addTrackPublication(a)}n.set(i.sid,a)}),this.trackPublications.forEach(i=>{n.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),nn(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(se.TrackPublished,i)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case ue.Kind.Audio:this.audioTrackPublications.delete(e);break;case ue.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(se.TrackUnpublished,r)}setAudioOutput(e){return X(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var i;ru(r.track)&&Xx(r.track)&&n.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var kt;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(kt||(kt={}));const _ye=4*1e3;class iu extends Wl.EventEmitter{constructor(e){var n,r,i,s;if(super(),n=this,this.state=kt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Rt,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(o,a,l)=>X(this,void 0,void 0,function*(){var c;if(!l1e())throw Ul()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===kt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(kt.Connecting),((c=this.regionUrlProvider)===null||c===void 0?void 0:c.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),zx(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new tP(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(m=>{var v;(v=this.regionUrlProvider)===null||v===void 0||v.setServerReportedRegions(m)}).catch(m=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:m}))}));const f=(m,v,g)=>X(this,void 0,void 0,function*(){var S,b;this.abortController&&this.abortController.abort();const w=new AbortController;this.abortController=w,u==null||u();try{yield this.attemptConnection(g??o,a,l,w),this.abortController=void 0,m()}catch(k){if(this.regionUrlProvider&&k instanceof dn&&k.reason!==Nt.Cancelled&&k.reason!==Nt.NotAllowed){let T=null;try{T=yield this.regionUrlProvider.getNextBestRegionUrl((S=this.abortController)===null||S===void 0?void 0:S.signal)}catch(I){if(I instanceof dn&&(I.status===401||I.reason===Nt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),v(I);return}}T&&!(!((b=this.abortController)===null||b===void 0)&&b.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(k.message,". Retrying with another region: ").concat(T),this.logContext),this.recreateEngine(),yield f(m,v,T)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,GU(k)),v(k))}else{let T=ja.UNKNOWN_REASON;k instanceof dn&&(T=GU(k)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,T),v(k)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new SA((m,v)=>{f(m,v,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,l,c,u,f)=>X(this,void 0,void 0,function*(){var p,m,v;const g=yield l.join(o,a,{autoSubscribe:c.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:c.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:c.websocketTimeout},f.signal);let S=g.serverInfo;if(S||(S={version:g.serverVersion,region:g.serverRegion}),this.serverInfo=S,this.log.debug("connected to Livekit Server ".concat(Object.entries(S).map(b=>{let[w,k]=b;return"".concat(w,": ").concat(k)}).join(", ")),{room:(p=g.room)===null||p===void 0?void 0:p.name,roomSid:(m=g.room)===null||m===void 0?void 0:m.sid,identity:(v=g.participant)===null||v===void 0?void 0:v.identity}),!S.version)throw new W0e("unknown server version");return S.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),g}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,l,c)=>X(this,void 0,void 0,function*(){var u,f;this.state===kt.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((f=this.regionUrlProvider)===null||f===void 0)&&f.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},RA),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,c);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(ae.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const m=new dn("could not establish signal connection",Nt.ServerUnreachable);throw p instanceof Error&&(m.message="".concat(m.message,": ").concat(p.message)),p instanceof dn&&(m.reason=p.reason,m.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),m}if(c.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new dn("Connection attempt aborted",Nt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,c)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}ks()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ks()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(kt.Connected),this.emit(ae.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return X(n,[...a],void 0,function(){var c=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var f,p,m,v;const g=yield c.disconnectLock.lock();try{if(c.state===kt.Disconnected){c.log.debug("already disconnected",c.logContext);return}c.log.info("disconnect from room",Object.assign({},c.logContext)),(c.state===kt.Connecting||c.state===kt.Reconnecting||c.isResuming)&&(c.log.warn("abort connection attempt",c.logContext),(f=c.abortController)===null||f===void 0||f.abort(),(m=(p=c.connectFuture)===null||p===void 0?void 0:p.reject)===null||m===void 0||m.call(p,new dn("Client initiated disconnect",Nt.Cancelled)),c.connectFuture=void 0),!((v=c.engine)===null||v===void 0)&&v.client.isDisconnected||(yield c.engine.client.sendLeave()),c.engine&&(yield c.engine.close()),c.handleDisconnect(u,ja.CLIENT_INITIATED),c.engine=void 0}finally{g()}}()})},this.onPageLeave=()=>X(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>X(this,void 0,void 0,function*(){const o=[],a=Ka();if(a&&a.os==="iOS"){const l="livekit-dummy-audio-el";let c=document.getElementById(l);if(!c){c=document.createElement("audio"),c.id=l,c.autoplay=!0,c.hidden=!0;const u=ek();u.enabled=!0;const f=new MediaStream([u]);c.srcObject=f,document.addEventListener("visibilitychange",()=>{c&&(c.srcObject=document.hidden?null:f,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(c),this.once(ae.Disconnected,()=>{c==null||c.remove(),c=null})}o.push(c)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(c=>{c.track&&c.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>X(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(l=>{var c;(c=l.track)===null||c===void 0||c.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(kt.Reconnecting)&&this.emit(ae.Reconnecting)},this.handleSignalRestarted=o=>X(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(kt.Connected),this.emit(ae.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var l;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(l=this.sidToIdentity.get(a.sid))!==null&&l!==void 0?l:"");let c=this.remoteParticipants.get(a.identity);a.state===Om.DISCONNECTED?this.handleParticipantDisconnected(a.identity,c):c=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],l={};o.forEach(c=>{if(l[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(c.sid);u&&(u.audioLevel=c.level,u.setIsSpeaking(!0),a.push(u))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(c=>{l[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(ae.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(c=>{const u=this.remoteParticipants.get(c.identity);u&&u.sid!==c.sid||a.set(c.sid,c)}),o.forEach(c=>{let u=this.getRemoteParticipantBySid(c.sid);c.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=c.level,u.setIsSpeaking(c.active),c.active?a.set(c.sid,u):a.delete(c.sid))});const l=Array.from(a.values());l.sort((c,u)=>u.audioLevel-c.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(ae.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);if(!c||!c.track)return;const u=ue.streamStateFromProto(a.state);u!==c.track.streamState&&(c.track.streamState=u,l.emit(se.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected(ae.TrackStreamStateChanged,c,c.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const l=a.getTrackPublicationBySid(o.trackSid);l&&l.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(c=>c.trackPublications.has(o.trackSid));if(!a)return;const l=a.getTrackPublicationBySid(o.trackSid);l&&l.setSubscriptionError(o.err)},this.handleDataPacket=o=>{const a=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(a,o.value.value,o.kind);else if(o.value.case==="transcription")this.handleTranscription(a,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(a,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(a,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,a);else if(o.value.case==="streamHeader")this.handleStreamHeader(o.value.value,o.participantIdentity);else if(o.value.case==="streamChunk")this.handleStreamChunk(o.value.value);else if(o.value.case==="streamTrailer")this.handleStreamTrailer(o.value.value);else if(o.value.case==="rpcRequest"){const l=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(o,a,l)=>{this.emit(ae.DataReceived,a.payload,o,l,a.topic),o==null||o.emit(se.DataReceived,a.payload,l)},this.handleSipDtmf=(o,a)=>{this.emit(ae.SipDTMFReceived,a,o),o==null||o.emit(se.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(o,a)=>{const l=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),c=l==null?void 0:l.trackPublications.get(a.trackId),u=g1e(a,this.transcriptionReceivedTimes);c==null||c.emit(Ce.TranscriptionReceived,u),l==null||l.emit(se.TranscriptionReceived,u,c),this.emit(ae.TranscriptionReceived,u,l,c)},this.handleChatMessage=(o,a)=>{const l=v1e(a);this.emit(ae.ChatMessage,l,o)},this.handleMetrics=(o,a)=>{this.emit(ae.MetricsReceived,o,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ae.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ae.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ae.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ae.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>X(this,void 0,void 0,function*(){var o,a,l;const c=di.getInstance().previousDevices,u=yield di.getInstance().getDevices(void 0,!1),f=Ka();if((f==null?void 0:f.name)==="Chrome"&&f.os!=="iOS")for(let m of u){const v=c.find(g=>g.deviceId===m.deviceId);v&&v.label!==""&&v.kind===m.kind&&v.label!==m.label&&this.getActiveDevice(m.kind)==="default"&&this.emit(ae.ActiveDeviceChanged,m.kind,m.deviceId)}const p=["audiooutput","audioinput","videoinput"];for(let m of p){const v=S1e(m),g=this.localParticipant.getTrackPublication(v);if(g&&(!((o=g.track)===null||o===void 0)&&o.isUserProvided))continue;const S=u.filter(w=>w.kind===m),b=this.getActiveDevice(m);if(b===((a=c.filter(w=>w.kind===m)[0])===null||a===void 0?void 0:a.deviceId)&&S.length>0&&((l=S[0])===null||l===void 0?void 0:l.deviceId)!==b){yield this.switchActiveDevice(m,S[0].deviceId);continue}m==="audioinput"&&!jd()||m==="videoinput"||S.length>0&&!S.find(w=>w.deviceId===this.getActiveDevice(m))&&(yield this.switchActiveDevice(m,S[0].deviceId))}this.emit(ae.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(ae.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(ae.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const l=this.getRemoteParticipantBySid(a.participantSid);l&&l.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(ae.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(ae.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(ae.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(ae.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(ae.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>X(this,void 0,void 0,function*(){var a,l,c,u,f,p;(a=o.track)===null||a===void 0||a.on(Ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.on(Ce.Restarted,this.onLocalTrackRestarted),(f=(u=(c=o.track)===null||c===void 0?void 0:c.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||f===void 0||f.call(u,this),this.emit(ae.LocalTrackPublished,o,this.localParticipant),Xf(o.track)&&(yield o.track.checkForSilence())&&this.emit(ae.LocalAudioSilenceDetected,o);const m=yield(p=o.track)===null||p===void 0?void 0:p.getDeviceId(!1),v=qU(o.source);v&&m&&m!==this.localParticipant.activeDeviceMap.get(v)&&(this.localParticipant.activeDeviceMap.set(v,m),this.emit(ae.ActiveDeviceChanged,v,m))}),this.onLocalTrackUnpublished=o=>{var a,l;(a=o.track)===null||a===void 0||a.off(Ce.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.off(Ce.Restarted,this.onLocalTrackRestarted),this.emit(ae.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>X(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),l=qU(o.source);l&&a&&a!==this.localParticipant.activeDeviceMap.get(l)&&(this.log.debug("local track restarted, setting ".concat(l," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(l,a),this.emit(ae.ActiveDeviceChanged,l,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(ae.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=o=>{this.emit(ae.MediaDevicesError,o)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(ae.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(ae.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},H1e),e),this.log=nu((r=this.options.loggerName)!==null&&r!==void 0?r:qa.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},mX),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},gX),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},B1e),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new ts,this.localParticipant=new yye("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Id(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Id(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",Id(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),ks()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),iu.cleanupRegistry&&iu.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,r,i,s,o){return X(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,dr.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(r);if(!a){yield this.engine.publishRpcResponse(e,n,null,dr.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:i,responseTimeout:s});IA(u)>vX?(l=dr.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):c=u}catch(u){u instanceof dr?l=u:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),u),l=dr.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}setE2EEEnabled(e){return X(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new I1e(this.options.e2ee),this.e2eeManager.on(vd.ParticipantEncryptionStatusChanged,(n,r)=>{_1e(r)&&(this.isE2EEEnabled=n),this.emit(ae.ParticipantEncryptionStatusChanged,n,r)}),this.e2eeManager.on(vd.EncryptionError,n=>this.emit(ae.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return X(this,void 0,void 0,function*(){return this.state===kt.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=i=>{i.sid!==""&&(this.engine.off(ke.RoomUpdate,r),e(i.sid))};this.engine.on(ke.RoomUpdate,r),this.once(ae.Disconnected,()=>{this.engine.off(ke.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new iye(this.options),this.engine.on(ke.ParticipantUpdate,this.handleParticipantUpdates).on(ke.RoomUpdate,this.handleRoomUpdate).on(ke.SpeakersChanged,this.handleSpeakersChanged).on(ke.StreamStateChanged,this.handleStreamStateUpdate).on(ke.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ke.SubscriptionError,this.handleSubscriptionError).on(ke.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ke.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on(ke.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(ke.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ke.DataPacketReceived,this.handleDataPacket).on(ke.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(kt.SignalReconnecting)&&this.emit(ae.SignalReconnecting)}).on(ke.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(kt.Connected)&&this.emit(ae.Reconnected)}).on(ke.SignalResumed,()=>{this.bufferedEvents=[],(this.state===kt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ke.Restarting,this.handleRestarting).on(ke.SignalRestarted,this.handleSignalRestarted).on(ke.Offline,()=>{this.setAndEmitConnectionState(kt.Reconnecting)&&this.emit(ae.Reconnecting)}).on(ke.DCBufferStatusChanged,(e,n)=>{this.emit(ae.DCBufferStatusChanged,e,n)}).on(ke.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(se.LocalTrackSubscribed,n),this.emitWhenConnected(ae.LocalTrackSubscribed,n,this.localParticipant)}).on(ke.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,r)=>{this.handleParticipantDisconnected(r,n)}),this.emit(ae.Moved,e.room.name,e.token),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return di.getInstance().getDevices(e,n)}prepareConnection(e,n){return X(this,void 0,void 0,function*(){if(this.state===kt.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(zx(new URL(e))&&n){this.regionUrlProvider=new tP(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===kt.Disconnected&&(this.regionUrl=r,yield fetch(Yx(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(Yx(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return X(this,void 0,void 0,function*(){let r=()=>{},i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new Sl({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new Sl({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new Sl({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new Sl({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>X(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Sl({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>X(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Sl({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new Sl({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>X(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new BC({reason:ja.CLIENT_INITIATED,action:Mm.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new Sl({scenario:{case:"subscriberBandwidth",value:Yf(n)}});break;case"leave-full-reconnect":i=new Sl({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,l,c,u,f,p,m,v;let g=!0,S=!1;const b=o?{exact:i}:i;if(r==="audioinput"){S=s.localParticipant.audioTrackPublications.size===0;const w=(a=s.getActiveDevice(r))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=b;const k=Array.from(s.localParticipant.audioTrackPublications.values()).filter(T=>T.source===ue.Source.Microphone);try{g=(yield Promise.all(k.map(T=>{var I;return(I=T.audioTrack)===null||I===void 0?void 0:I.setDeviceId(b)}))).every(T=>T===!0)}catch(T){throw s.options.audioCaptureDefaults.deviceId=w,T}}else if(r==="videoinput"){S=s.localParticipant.videoTrackPublications.size===0;const w=(l=s.getActiveDevice(r))!==null&&l!==void 0?l:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=b;const k=Array.from(s.localParticipant.videoTrackPublications.values()).filter(T=>T.source===ue.Source.Camera);try{g=(yield Promise.all(k.map(T=>{var I;return(I=T.videoTrack)===null||I===void 0?void 0:I.setDeviceId(b)}))).every(T=>T===!0)}catch(T){throw s.options.videoCaptureDefaults.deviceId=w,T}}else if(r==="audiooutput"){if(!Wx()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(i=(c=yield di.getInstance().normalizeDeviceId("audiooutput",i))!==null&&c!==void 0?c:""),(u=(v=s.options).audioOutput)!==null&&u!==void 0||(v.audioOutput={});const w=(f=s.getActiveDevice(r))!==null&&f!==void 0?f:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=i;try{s.options.webAudioMix&&((p=s.audioContext)===null||p===void 0||p.setSinkId(i)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(k=>k.setAudioOutput({deviceId:i})))}catch(k){throw s.options.audioOutput.deviceId=w,k}}return(S||r==="audiooutput")&&(s.localParticipant.activeDeviceMap.set(r,r==="audiooutput"&&((m=s.options.audioOutput)===null||m===void 0?void 0:m.deviceId)||i),s.emit(ae.ActiveDeviceChanged,r,i)),g}()})}setupLocalParticipantEvents(){this.localParticipant.on(se.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(se.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(se.AttributesChanged,this.onLocalAttributesChanged).on(se.TrackMuted,this.onLocalTrackMuted).on(se.TrackUnmuted,this.onLocalTrackUnmuted).on(se.LocalTrackPublished,this.onLocalTrackPublished).on(se.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(se.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(se.MediaDevicesError,this.onMediaDevicesError).on(se.AudioStreamAcquired,this.startAudio).on(se.ChatMessage,this.onLocalChatMessageSent).on(se.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===kt.Connecting||this.state===kt.Reconnecting){const u=()=>{this.onTrackAdded(e,n,r),f()},f=()=>{this.off(ae.Reconnected,u),this.off(ae.Connected,u),this.off(ae.Disconnected,f)};this.once(ae.Reconnected,u),this.once(ae.Connected,u),this.once(ae.Disconnected,f);return}if(this.state===kt.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const i=s1e(n.id),s=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={}),l.addSubscribedMediaTrack(e,a,n,r,c)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==kt.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{i.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var s,o,a;i.track&&this.localParticipant.unpublishTrack(i.track,e),e?((s=i.track)===null||s===void 0||s.detach(),(o=i.track)===null||o===void 0||o.stop()):(a=i.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(se.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(se.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(se.AttributesChanged,this.onLocalAttributesChanged).off(se.TrackMuted,this.onLocalTrackMuted).off(se.TrackUnmuted,this.onLocalTrackUnmuted).off(se.LocalTrackPublished,this.onLocalTrackPublished).off(se.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(se.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(se.MediaDevicesError,this.onMediaDevicesError).off(se.AudioStreamAcquired,this.startAudio).off(se.ChatMessage,this.onLocalChatMessageSent).off(se.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ks()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(kt.Disconnected),this.emit(ae.Disconnected,n)}}}handleParticipantDisconnected(e,n){var r;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(i=>{n.unpublishTrack(i.trackSid,!0)}),this.emit(ae.ParticipantDisconnected,n),n.setDisconnected(),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return X(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const i=this.byteStreamHandlers.get(e.topic);if(!i){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:G2(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:l=>{s=l,this.byteStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});i(new lye(o,a,G2(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const i=this.textStreamHandlers.get(e.topic);if(!i){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:l=>{s=l,this.textStreamControllers.set(e.streamId,{info:o,controller:s,startTime:Date.now()})}});i(new cye(o,a,G2(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const r=this.textStreamControllers.get(e.streamId);r&&e.content.length>0&&r.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.byteStreamControllers.delete(e.streamId))}acquireAudioContext(){return X(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=fX())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ls(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(ae.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let i;return n?i=aw.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new aw(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),i}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return n&&i.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),i}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(ae.ParticipantConnected,r),r.on(se.TrackPublished,i=>{this.emitWhenConnected(ae.TrackPublished,i,r)}).on(se.TrackSubscribed,(i,s)=>{i.kind===ue.Kind.Audio?(i.on(Ce.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(Ce.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===ue.Kind.Video&&(i.on(Ce.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(Ce.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ae.TrackSubscribed,i,s,r)}).on(se.TrackUnpublished,i=>{this.emit(ae.TrackUnpublished,i,r)}).on(se.TrackUnsubscribed,(i,s)=>{this.emit(ae.TrackUnsubscribed,i,s,r)}).on(se.TrackMuted,i=>{this.emitWhenConnected(ae.TrackMuted,i,r)}).on(se.TrackUnmuted,i=>{this.emitWhenConnected(ae.TrackUnmuted,i,r)}).on(se.ParticipantMetadataChanged,i=>{this.emitWhenConnected(ae.ParticipantMetadataChanged,i,r)}).on(se.ParticipantNameChanged,i=>{this.emitWhenConnected(ae.ParticipantNameChanged,i,r)}).on(se.AttributesChanged,i=>{this.emitWhenConnected(ae.ParticipantAttributesChanged,i,r)}).on(se.ConnectionQualityChanged,i=>{this.emitWhenConnected(ae.ConnectionQualityChanged,i,r)}).on(se.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(ae.ParticipantPermissionsChanged,i,r)}).on(se.TrackSubscriptionStatusChanged,(i,s)=>{this.emitWhenConnected(ae.TrackSubscriptionStatusChanged,i,s,r)}).on(se.TrackSubscriptionFailed,(i,s)=>{this.emit(ae.TrackSubscriptionFailed,i,r,s)}).on(se.TrackSubscriptionPermissionChanged,(i,s)=>{this.emitWhenConnected(ae.TrackSubscriptionPermissionChanged,i,s,r)}).on(se.Active,()=>{this.emitWhenConnected(ae.ParticipantActive,r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&y1e(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Ci.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,ja.STATE_MISMATCH))):e=0},_ye)}clearConnectionReconcile(){this.connectionReconcileInterval&&Ci.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(ae.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.state===kt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===kt.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return X(this,void 0,void 0,function*(){var n,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new jC({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Wn.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new wh({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ae.SignalConnected),this.emit(ae.Connected),this.setAndEmitConnectionState(kt.Connected),i.video){const o=new rP(ue.Kind.Video,new hm({source:Lr.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Da.AUDIO,name:"video-dummy"}),new hg(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:VU(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(se.LocalTrackPublished,o)}if(i.audio){const o=new rP(ue.Kind.Audio,new hm({source:Lr.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Da.AUDIO}),new iw(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:ek(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(se.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new wh({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:Om.ACTIVE,tracks:[],joinedAt:Wn.parse(Date.now())});const l=this.getOrCreateParticipant(a.identity,a);if(s.video){const c=VU(160*((r=s.aspectRatios[o%s.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),u=new hm({source:Lr.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Da.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const c=ek(),u=new hm({source:Lr.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Da.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}l.updateInfo(a)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(e!==ae.ActiveSpeakersChanged&&e!==ae.TranscriptionReceived){const s=wX(r).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...r)}}iu.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function wX(t){return t.map(e=>{if(e)return Array.isArray(e)?wX(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var xa;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(xa||(xa={}));class rf extends Wl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=xa.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new iu(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return X(this,void 0,void 0,function*(){if(this.status!==xa.IDLE)throw Error("check is running already");this.setStatus(xa.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==xa.SKIPPED&&this.setStatus(this.isSuccess()?xa.SUCCESS:xa.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return X(this,void 0,void 0,function*(){return this.room.state===kt.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return X(this,void 0,void 0,function*(){this.room&&this.room.state!==kt.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(xa.SKIPPED)}switchProtocol(e){return X(this,void 0,void 0,function*(){let n=!1,r=!1;if(this.room.on(ae.Reconnecting,()=>{n=!0}),this.room.once(ae.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const i=Date.now()+1e4;for(;Date.now()<i;){if(r)return;yield Ls(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class bye extends rf{get description(){return"Cloud regions"}perform(){return X(this,void 0,void 0,function*(){const e=new tP(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],r=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(r.has(o))continue;r.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const i=n[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return X(this,void 0,void 0,function*(){var n,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const i=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!i)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,l=1e6/o,c="A".repeat(o),u=Date.now();for(let v=0;v<l;v++)yield s.write(c);yield s.close();const f=Date.now(),p=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),m={region:i,rtt:1e4,duration:f-u};return p==null||p.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(m.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),m})}}const ck=1e4;class Sye extends rf{get description(){return"Connection via UDP vs TCP"}perform(){return X(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(ck/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(ck/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return X(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const r=n.getContext("2d");if(!r)throw new Error("Could not get canvas context");let i=0;const s=()=>{i=(i+1)%360,r.fillStyle="hsl(".concat(i,", 100%, 50%)"),r.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},f=setInterval(()=>X(this,void 0,void 0,function*(){const p=yield c.getRTCStatsReport();p==null||p.forEach(m=>{m.type==="outbound-rtp"?(u.packetsSent=m.packetsSent,u.qualityLimitationDurations=m.qualityLimitationDurations,u.bitrateTotal+=m.targetBitrate,u.count++):m.type==="remote-inbound-rtp"&&(u.packetsLost=m.packetsLost,u.rttTotal+=m.roundTripTime,u.jitterTotal+=m.jitter)})}),1e3);return yield new Promise(p=>setTimeout(p,ck)),clearInterval(f),a.stop(),n.remove(),yield this.disconnect(),u})}}class Eye extends rf{get description(){return"Can publish audio"}perform(){return X(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield mye();if(yield dX(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(r),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class wye extends rf{get description(){return"Can publish video"}perform(){return X(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield pye();yield this.checkForVideo(r.mediaStreamTrack),n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return X(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const r=document.createElement("video");r.srcObject=n,r.muted=!0,yield new Promise(i=>{r.onplay=()=>{setTimeout(()=>{var s,o,a,l;const c=document.createElement("canvas"),u=e.getSettings(),f=(o=(s=u.width)!==null&&s!==void 0?s:r.videoWidth)!==null&&o!==void 0?o:1280,p=(l=(a=u.height)!==null&&a!==void 0?a:r.videoHeight)!==null&&l!==void 0?l:720;c.width=f,c.height=p;const m=c.getContext("2d");m.drawImage(r,0,0);const g=m.getImageData(0,0,c.width,c.height).data;let S=!0;for(let b=0;b<g.length;b+=4)if(g[b]!==0||g[b+1]!==0||g[b+2]!==0){S=!1;break}S?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),i()},1e3)},r.play()}),r.remove()})}}class Cye extends rf{get description(){return"Resuming connection after interruption"}perform(){return X(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,i=!1,s;const o=new Promise(c=>{setTimeout(c,5e3),s=c}),a=()=>{r=!0};n.on(ae.SignalReconnecting,a).on(ae.Reconnecting,a).on(ae.Reconnected,()=>{i=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield o,r){if(!i||n.state!==kt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Tye extends rf{get description(){return"Can connect via TURN"}perform(){return X(this,void 0,void 0,function*(){var e,n;const r=new wA,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let l of i.iceServers)for(let c of l.urls)c.startsWith("turn:")?(o=!0,a=!0):c.startsWith("turns:")&&(o=!0,a=!0,s=!0),c.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class Rye extends rf{get description(){return"Establishing WebRTC connection"}perform(){return X(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(ae.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,s)=>{if(i.candidate){const o=new RTCIceCandidate(i);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(Iye(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}r&&r(i,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=i=>{i instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(i.errorCode," ").concat(i.errorText," ").concat(i.url))})});try{yield this.connect(),Rt.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Iye(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class kye extends rf{get description(){return"Connecting to signal connection via WebSocket"}perform(){return X(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new wA;const s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===lY.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=s.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class Nnt extends Wl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:xa.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==xa.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return X(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=o=>{this.updateCheck(n,o)};r.on("update",i);const s=yield r.run();return r.off("update",i),s})}checkWebsocket(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(kye)})}checkWebRTC(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Rye)})}checkTURN(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Tye)})}checkReconnect(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Cye)})}checkPublishAudio(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Eye)})}checkPublishVideo(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(wye)})}checkConnectionProtocol(){return X(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(Sye);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(bye)})}}function PA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;const r=dh(t)?t.mediaStreamTrack:t,i=r.getSettings();let s={facingMode:(n=e.defaultFacingMode)!==null&&n!==void 0?n:"user",confidence:"low"};if("facingMode"in i){const o=i.facingMode;Rt.trace("rawFacingMode",{rawFacingMode:o}),o&&typeof o=="string"&&Lye(o)&&(s={facingMode:o,confidence:"high"})}if(["low","medium"].includes(s.confidence)){Rt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const o=Pye(r.label);o!==void 0&&(s=o)}return s}const lj=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),xye=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function Pye(t){var e;const n=t.trim().toLowerCase();if(n!=="")return lj.has(n)?lj.get(n):(e=Array.from(xye.entries()).find(r=>{let[i]=r;return n.includes(i)}))===null||e===void 0?void 0:e[1]}function Lye(t){return t===void 0||["user","environment","left","right"].includes(t)}var T0={},cj;function Aye(){if(cj)return T0;cj=1,Object.defineProperty(T0,"__esModule",{value:!0}),T0.parse=o,T0.serialize=c;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,s=(()=>{const p=function(){};return p.prototype=Object.create(null),p})();function o(p,m){const v=new s,g=p.length;if(g<2)return v;const S=(m==null?void 0:m.decode)||u;let b=0;do{const w=p.indexOf("=",b);if(w===-1)break;const k=p.indexOf(";",b),T=k===-1?g:k;if(w>T){b=p.lastIndexOf(";",w-1)+1;continue}const I=a(p,b,w),C=l(p,w,I),x=p.slice(I,C);if(v[x]===void 0){let A=a(p,w+1,T),N=l(p,T,A);const D=S(p.slice(A,N));v[x]=D}b=T+1}while(b<g);return v}function a(p,m,v){do{const g=p.charCodeAt(m);if(g!==32&&g!==9)return m}while(++m<v);return v}function l(p,m,v){for(;m>v;){const g=p.charCodeAt(--m);if(g!==32&&g!==9)return m+1}return v}function c(p,m,v){const g=(v==null?void 0:v.encode)||encodeURIComponent;if(!t.test(p))throw new TypeError(`argument name is invalid: ${p}`);const S=g(m);if(!e.test(S))throw new TypeError(`argument val is invalid: ${m}`);let b=p+"="+S;if(!v)return b;if(v.maxAge!==void 0){if(!Number.isInteger(v.maxAge))throw new TypeError(`option maxAge is invalid: ${v.maxAge}`);b+="; Max-Age="+v.maxAge}if(v.domain){if(!n.test(v.domain))throw new TypeError(`option domain is invalid: ${v.domain}`);b+="; Domain="+v.domain}if(v.path){if(!r.test(v.path))throw new TypeError(`option path is invalid: ${v.path}`);b+="; Path="+v.path}if(v.expires){if(!f(v.expires)||!Number.isFinite(v.expires.valueOf()))throw new TypeError(`option expires is invalid: ${v.expires}`);b+="; Expires="+v.expires.toUTCString()}if(v.httpOnly&&(b+="; HttpOnly"),v.secure&&(b+="; Secure"),v.partitioned&&(b+="; Partitioned"),v.priority)switch(typeof v.priority=="string"?v.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${v.priority}`)}if(v.sameSite)switch(typeof v.sameSite=="string"?v.sameSite.toLowerCase():v.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${v.sameSite}`)}return b}function u(p){if(p.indexOf("%")===-1)return p;try{return decodeURIComponent(p)}catch{return p}}function f(p){return i.call(p)==="[object Date]"}return T0}Aye();/**
 * react-router v7.2.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var uj="popstate";function Oye(t={}){function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return iP("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:ay(i)}return Nye(e,n,null,t)}function tr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function jl(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Mye(){return Math.random().toString(36).substring(2,10)}function dj(t,e){return{usr:t.state,key:t.key,idx:e}}function iP(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?qg(e):e,state:n,key:e&&e.key||r||Mye()}}function ay({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function qg(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Nye(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",l=null,c=u();c==null&&(c=0,o.replaceState({...o.state,idx:c},""));function u(){return(o.state||{idx:null}).idx}function f(){a="POP";let S=u(),b=S==null?null:S-c;c=S,l&&l({action:a,location:g.location,delta:b})}function p(S,b){a="PUSH";let w=iP(g.location,S,b);c=u()+1;let k=dj(w,c),T=g.createHref(w);try{o.pushState(k,"",T)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;i.location.assign(T)}s&&l&&l({action:a,location:g.location,delta:1})}function m(S,b){a="REPLACE";let w=iP(g.location,S,b);c=u();let k=dj(w,c),T=g.createHref(w);o.replaceState(k,"",T),s&&l&&l({action:a,location:g.location,delta:0})}function v(S){let b=i.location.origin!=="null"?i.location.origin:i.location.href,w=typeof S=="string"?S:ay(S);return w=w.replace(/ $/,"%20"),tr(b,`No window.location.(origin|href) available to create URL for href: ${w}`),new URL(w,b)}let g={get action(){return a},get location(){return t(i,o)},listen(S){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(uj,f),l=S,()=>{i.removeEventListener(uj,f),l=null}},createHref(S){return e(i,S)},createURL:v,encodeLocation(S){let b=v(S);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:m,go(S){return o.go(S)}};return g}function LA(t,e,n="/"){return Dye(t,e,n,!1)}function Dye(t,e,n,r){let i=typeof e=="string"?qg(e):e,s=$d(i.pathname||"/",n);if(s==null)return null;let o=CX(t);Fye(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=zye(s);a=Kye(o[l],c,r)}return a}function CX(t,e=[],n=[],r=""){let i=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(tr(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let c=Vc([r,l.relativePath]),u=n.concat(l);s.children&&s.children.length>0&&(tr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),CX(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:Gye(c,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let l of TX(s.path))i(s,o,l)}),e}function TX(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=TX(r.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),i&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function Fye(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:qye(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var Uye=/^:[\w-]+$/,jye=3,$ye=2,Bye=1,Hye=10,Vye=-2,fj=t=>t==="*";function Gye(t,e){let n=t.split("/"),r=n.length;return n.some(fj)&&(r+=Vye),e&&(r+=$ye),n.filter(i=>!fj(i)).reduce((i,s)=>i+(Uye.test(s)?jye:s===""?Bye:Hye),r)}function qye(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function Kye(t,e,n=!1){let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=s==="/"?e:e.slice(s.length)||"/",f=lw({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),p=l.route;if(!f&&c&&n&&!r[r.length-1].route.index&&(f=lw({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:Vc([s,f.pathname]),pathnameBase:Zye(Vc([s,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(s=Vc([s,f.pathnameBase]))}return o}function lw(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Wye(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((c,{paramName:u,isOptional:f},p)=>{if(u==="*"){let v=a[p]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const m=a[p];return f&&!m?c[u]=void 0:c[u]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:t}}function Wye(t,e=!1,n=!0){jl(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function zye(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return jl(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function $d(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function Yye(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?qg(t):t;return{pathname:n?n.startsWith("/")?n:Xye(n,e):e,search:Qye(r),hash:e_e(i)}}function Xye(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function uk(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Jye(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function RX(t){let e=Jye(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function IX(t,e,n,r=!1){let i;typeof t=="string"?i=qg(t):(i={...t},tr(!i.pathname||!i.pathname.includes("?"),uk("?","pathname","search",i)),tr(!i.pathname||!i.pathname.includes("#"),uk("#","pathname","hash",i)),tr(!i.search||!i.search.includes("#"),uk("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}a=f>=0?e[f]:"/"}let l=Yye(i,a),c=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var Vc=t=>t.join("/").replace(/\/\/+/g,"/"),Zye=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Qye=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,e_e=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function t_e(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var kX=["POST","PUT","PATCH","DELETE"];new Set(kX);var n_e=["GET",...kX];new Set(n_e);var Kg=_.createContext(null);Kg.displayName="DataRouter";var qC=_.createContext(null);qC.displayName="DataRouterState";var xX=_.createContext({isTransitioning:!1});xX.displayName="ViewTransition";var r_e=_.createContext(new Map);r_e.displayName="Fetchers";var i_e=_.createContext(null);i_e.displayName="Await";var zl=_.createContext(null);zl.displayName="Navigation";var Wg=_.createContext(null);Wg.displayName="Location";var pu=_.createContext({outlet:null,matches:[],isDataRoute:!1});pu.displayName="Route";var AA=_.createContext(null);AA.displayName="RouteError";function PX(t,{relative:e}={}){tr(r_(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=_.useContext(zl),{hash:i,pathname:s,search:o}=i_(t,{relative:e}),a=s;return n!=="/"&&(a=s==="/"?n:Vc([n,s])),r.createHref({pathname:a,search:o,hash:i})}function r_(){return _.useContext(Wg)!=null}function qi(){return tr(r_(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(Wg).location}function s_e(){return _.useContext(Wg).navigationType}var LX="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function AX(t){_.useContext(zl).static||_.useLayoutEffect(t)}function Yl(){let{isDataRoute:t}=_.useContext(pu);return t?y_e():o_e()}function o_e(){tr(r_(),"useNavigate() may be used only in the context of a <Router> component.");let t=_.useContext(Kg),{basename:e,navigator:n}=_.useContext(zl),{matches:r}=_.useContext(pu),{pathname:i}=qi(),s=JSON.stringify(RX(r)),o=_.useRef(!1);return AX(()=>{o.current=!0}),_.useCallback((l,c={})=>{if(jl(o.current,LX),!o.current)return;if(typeof l=="number"){n.go(l);return}let u=IX(l,JSON.parse(s),i,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:Vc([e,u.pathname])),(c.replace?n.replace:n.push)(u,c.state,c)},[e,n,s,i,t])}_.createContext(null);function i_(t,{relative:e}={}){let{matches:n}=_.useContext(pu),{pathname:r}=qi(),i=JSON.stringify(RX(n));return _.useMemo(()=>IX(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function a_e(t,e){return OX(t,e)}function OX(t,e,n,r){var w;tr(r_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i,static:s}=_.useContext(zl),{matches:o}=_.useContext(pu),a=o[o.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",f=a&&a.route;{let k=f&&f.path||"";MX(c,!f||k.endsWith("*")||k.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${k}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${k}"> to <Route path="${k==="/"?"*":`${k}/*`}">.`)}let p=qi(),m;if(e){let k=typeof e=="string"?qg(e):e;tr(u==="/"||((w=k.pathname)==null?void 0:w.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${k.pathname}" was given in the \`location\` prop.`),m=k}else m=p;let v=m.pathname||"/",g=v;if(u!=="/"){let k=u.replace(/^\//,"").split("/");g="/"+v.replace(/^\//,"").split("/").slice(k.length).join("/")}let S=!s&&n&&n.matches&&n.matches.length>0?n.matches:LA(t,{pathname:g});jl(f||S!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),jl(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=f_e(S&&S.map(k=>Object.assign({},k,{params:Object.assign({},l,k.params),pathname:Vc([u,i.encodeLocation?i.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?u:Vc([u,i.encodeLocation?i.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),o,n,r);return e&&b?_.createElement(Wg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},b):b}function l_e(){let t=v_e(),e=t_e(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:s},"ErrorBoundary")," or"," ",_.createElement("code",{style:s},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),n?_.createElement("pre",{style:i},n):null,o)}var c_e=_.createElement(l_e,null),u_e=class extends _.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?_.createElement(pu.Provider,{value:this.props.routeContext},_.createElement(AA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function d_e({routeContext:t,match:e,children:n}){let r=_.useContext(Kg);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),_.createElement(pu.Provider,{value:t},n)}function f_e(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,s=n==null?void 0:n.errors;if(s!=null){let l=i.findIndex(c=>c.route.id&&(s==null?void 0:s[c.route.id])!==void 0);tr(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,l+1))}let o=!1,a=-1;if(n)for(let l=0;l<i.length;l++){let c=i[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(a=l),c.route.id){let{loaderData:u,errors:f}=n,p=c.route.loader&&!u.hasOwnProperty(c.route.id)&&(!f||f[c.route.id]===void 0);if(c.route.lazy||p){o=!0,a>=0?i=i.slice(0,a+1):i=[i[0]];break}}}return i.reduceRight((l,c,u)=>{let f,p=!1,m=null,v=null;n&&(f=s&&c.route.id?s[c.route.id]:void 0,m=c.route.errorElement||c_e,o&&(a<0&&u===0?(MX("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,v=null):a===u&&(p=!0,v=c.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,u+1)),S=()=>{let b;return f?b=m:p?b=v:c.route.Component?b=_.createElement(c.route.Component,null):c.route.element?b=c.route.element:b=l,_.createElement(d_e,{match:c,routeContext:{outlet:l,matches:g,isDataRoute:n!=null},children:b})};return n&&(c.route.ErrorBoundary||c.route.errorElement||u===0)?_.createElement(u_e,{location:n.location,revalidation:n.revalidation,component:m,error:f,children:S(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):S()},null)}function OA(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function h_e(t){let e=_.useContext(Kg);return tr(e,OA(t)),e}function p_e(t){let e=_.useContext(qC);return tr(e,OA(t)),e}function m_e(t){let e=_.useContext(pu);return tr(e,OA(t)),e}function MA(t){let e=m_e(t),n=e.matches[e.matches.length-1];return tr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function g_e(){return MA("useRouteId")}function v_e(){var r;let t=_.useContext(AA),e=p_e("useRouteError"),n=MA("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function y_e(){let{router:t}=h_e("useNavigate"),e=MA("useNavigate"),n=_.useRef(!1);return AX(()=>{n.current=!0}),_.useCallback(async(i,s={})=>{jl(n.current,LX),n.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...s}))},[t,e])}var hj={};function MX(t,e,n){!e&&!hj[t]&&(hj[t]=!0,jl(!1,n))}_.memo(__e);function __e({routes:t,future:e,state:n}){return OX(t,void 0,n,e)}function NX(t){tr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function b_e({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:s=!1}){tr(!r_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),a=_.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof n=="string"&&(n=qg(n));let{pathname:l="/",search:c="",hash:u="",state:f=null,key:p="default"}=n,m=_.useMemo(()=>{let v=$d(l,o);return v==null?null:{location:{pathname:v,search:c,hash:u,state:f,key:p},navigationType:r}},[o,l,c,u,f,p,r]);return jl(m!=null,`<Router basename="${o}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:_.createElement(zl.Provider,{value:a},_.createElement(Wg.Provider,{children:e,value:m}))}function S_e({children:t,location:e}){return a_e(cw(t),e)}function cw(t,e=[]){let n=[];return _.Children.forEach(t,(r,i)=>{if(!_.isValidElement(r))return;let s=[...e,i];if(r.type===_.Fragment){n.push.apply(n,cw(r.props.children,s));return}tr(r.type===NX,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),tr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=cw(r.props.children,s)),n.push(o)}),n}var K2="get",W2="application/x-www-form-urlencoded";function KC(t){return t!=null&&typeof t.tagName=="string"}function E_e(t){return KC(t)&&t.tagName.toLowerCase()==="button"}function w_e(t){return KC(t)&&t.tagName.toLowerCase()==="form"}function C_e(t){return KC(t)&&t.tagName.toLowerCase()==="input"}function T_e(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function R_e(t,e){return t.button===0&&(!e||e==="_self")&&!T_e(t)}var pS=null;function I_e(){if(pS===null)try{new FormData(document.createElement("form"),0),pS=!1}catch{pS=!0}return pS}var k_e=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function dk(t){return t!=null&&!k_e.has(t)?(jl(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${W2}"`),null):t}function x_e(t,e){let n,r,i,s,o;if(w_e(t)){let a=t.getAttribute("action");r=a?$d(a,e):null,n=t.getAttribute("method")||K2,i=dk(t.getAttribute("enctype"))||W2,s=new FormData(t)}else if(E_e(t)||C_e(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?$d(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||K2,i=dk(t.getAttribute("formenctype"))||dk(a.getAttribute("enctype"))||W2,s=new FormData(a,t),!I_e()){let{name:c,type:u,value:f}=t;if(u==="image"){let p=c?`${c}.`:"";s.append(`${p}x`,"0"),s.append(`${p}y`,"0")}else c&&s.append(c,f)}}else{if(KC(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=K2,r=null,i=W2,o=t}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:s,body:o}}function NA(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function P_e(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function L_e(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function A_e(t,e,n){let r=await Promise.all(t.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await P_e(s,n);return o.links?o.links():[]}return[]}));return D_e(r.flat(1).filter(L_e).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function pj(t,e,n,r,i,s){let o=(l,c)=>n[c]?l.route.id!==n[c].route.id:!0,a=(l,c)=>{var u;return n[c].pathname!==l.pathname||((u=n[c].route.path)==null?void 0:u.endsWith("*"))&&n[c].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,c)=>o(l,c)||a(l,c)):s==="data"?e.filter((l,c)=>{var f;let u=r.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(o(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let p=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function O_e(t,e,{includeHydrateFallback:n}={}){return M_e(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function M_e(t){return[...new Set(t)]}function N_e(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function D_e(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let s=JSON.stringify(N_e(i));return n.has(s)||(n.add(s),r.push({key:s,link:i})),r},[])}function F_e(t){let e=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function U_e(){let t=_.useContext(Kg);return NA(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function j_e(){let t=_.useContext(qC);return NA(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var DA=_.createContext(void 0);DA.displayName="FrameworkContext";function DX(){let t=_.useContext(DA);return NA(t,"You must render this element inside a <HydratedRouter> element"),t}function $_e(t,e){let n=_.useContext(DA),[r,i]=_.useState(!1),[s,o]=_.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:f}=e,p=_.useRef(null);_.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let g=b=>{b.forEach(w=>{o(w.isIntersecting)})},S=new IntersectionObserver(g,{threshold:.5});return p.current&&S.observe(p.current),()=>{S.disconnect()}}},[t]),_.useEffect(()=>{if(r){let g=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(g)}}},[r]);let m=()=>{i(!0)},v=()=>{i(!1),o(!1)};return n?t!=="intent"?[s,p,{}]:[s,p,{onFocus:R0(a,m),onBlur:R0(l,v),onMouseEnter:R0(c,m),onMouseLeave:R0(u,v),onTouchStart:R0(f,m)}]:[!1,p,{}]}function R0(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function B_e({page:t,...e}){let{router:n}=U_e(),r=_.useMemo(()=>LA(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?_.createElement(V_e,{page:t,matches:r,...e}):null}function H_e(t){let{manifest:e,routeModules:n}=DX(),[r,i]=_.useState([]);return _.useEffect(()=>{let s=!1;return A_e(t,e,n).then(o=>{s||i(o)}),()=>{s=!0}},[t,e,n]),r}function V_e({page:t,matches:e,...n}){let r=qi(),{manifest:i,routeModules:s}=DX(),{loaderData:o,matches:a}=j_e(),l=_.useMemo(()=>pj(t,e,a,i,r,"data"),[t,e,a,i,r]),c=_.useMemo(()=>pj(t,e,a,i,r,"assets"),[t,e,a,i,r]),u=_.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,v=!1;if(e.forEach(S=>{var w;let b=i.routes[S.route.id];!b||!b.hasLoader||(!l.some(k=>k.route.id===S.route.id)&&S.route.id in o&&((w=s[S.route.id])!=null&&w.shouldRevalidate)||b.hasClientLoader?v=!0:m.add(S.route.id))}),m.size===0)return[];let g=F_e(t);return v&&m.size>0&&g.searchParams.set("_routes",e.filter(S=>m.has(S.route.id)).map(S=>S.route.id).join(",")),[g.pathname+g.search]},[o,r,i,l,e,t,s]),f=_.useMemo(()=>O_e(c,i),[c,i]),p=H_e(c);return _.createElement(_.Fragment,null,u.map(m=>_.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),f.map(m=>_.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),p.map(({key:m,link:v})=>_.createElement("link",{key:m,...v})))}function G_e(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var FX=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{FX&&(window.__reactRouterVersion="7.2.0")}catch{}function q_e({basename:t,children:e,window:n}){let r=_.useRef();r.current==null&&(r.current=Oye({window:n,v5Compat:!0}));let i=r.current,[s,o]=_.useState({action:i.action,location:i.location}),a=_.useCallback(l=>{_.startTransition(()=>o(l))},[o]);return _.useLayoutEffect(()=>i.listen(a),[i,a]),_.createElement(b_e,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:i})}var UX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,WC=_.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:f,...p},m){let{basename:v}=_.useContext(zl),g=typeof c=="string"&&UX.test(c),S,b=!1;if(typeof c=="string"&&g&&(S=c,FX))try{let N=new URL(window.location.href),D=c.startsWith("//")?new URL(N.protocol+c):new URL(c),F=$d(D.pathname,v);D.origin===N.origin&&F!=null?c=F+D.search+D.hash:b=!0}catch{jl(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=PX(c,{relative:i}),[k,T,I]=$_e(r,p),C=$X(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:i,viewTransition:f});function x(N){e&&e(N),N.defaultPrevented||C(N)}let A=_.createElement("a",{...p,...I,href:S||w,onClick:b||s?e:x,ref:G_e(m,T),target:l,"data-discover":!g&&n==="render"?"true":void 0});return k&&!g?_.createElement(_.Fragment,null,A,_.createElement(B_e,{page:w})):A});WC.displayName="Link";var K_e=_.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:l,...c},u){let f=i_(o,{relative:c.relative}),p=qi(),m=_.useContext(qC),{navigator:v,basename:g}=_.useContext(zl),S=m!=null&&Q_e(f)&&a===!0,b=v.encodeLocation?v.encodeLocation(f).pathname:f.pathname,w=p.pathname,k=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;n||(w=w.toLowerCase(),k=k?k.toLowerCase():null,b=b.toLowerCase()),k&&g&&(k=$d(k,g)||k);const T=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let I=w===b||!i&&w.startsWith(b)&&w.charAt(T)==="/",C=k!=null&&(k===b||!i&&k.startsWith(b)&&k.charAt(b.length)==="/"),x={isActive:I,isPending:C,isTransitioning:S},A=I?e:void 0,N;typeof r=="function"?N=r(x):N=[r,I?"active":null,C?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let D=typeof s=="function"?s(x):s;return _.createElement(WC,{...c,"aria-current":A,className:N,ref:u,style:D,to:o,viewTransition:a},typeof l=="function"?l(x):l)});K_e.displayName="NavLink";var W_e=_.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:s,method:o=K2,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:f,...p},m)=>{let v=J_e(),g=Z_e(a,{relative:c}),S=o.toLowerCase()==="get"?"get":"post",b=typeof a=="string"&&UX.test(a),w=k=>{if(l&&l(k),k.defaultPrevented)return;k.preventDefault();let T=k.nativeEvent.submitter,I=(T==null?void 0:T.getAttribute("formmethod"))||o;v(T||k.currentTarget,{fetcherKey:e,method:I,navigate:n,replace:i,state:s,relative:c,preventScrollReset:u,viewTransition:f})};return _.createElement("form",{ref:m,method:S,action:g,onSubmit:r?l:w,...p,"data-discover":!b&&t==="render"?"true":void 0})});W_e.displayName="Form";function z_e(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jX(t){let e=_.useContext(Kg);return tr(e,z_e(t)),e}function $X(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=Yl(),l=qi(),c=i_(t,{relative:s});return _.useCallback(u=>{if(R_e(u,e)){u.preventDefault();let f=n!==void 0?n:ay(l)===ay(c);a(t,{replace:f,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[l,a,c,n,r,e,t,i,s,o])}var Y_e=0,X_e=()=>`__${String(++Y_e)}__`;function J_e(){let{router:t}=jX("useSubmit"),{basename:e}=_.useContext(zl),n=g_e();return _.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:l,body:c}=x_e(r,e);if(i.navigate===!1){let u=i.fetcherKey||X_e();await t.fetch(u,n,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await t.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,n])}function Z_e(t,{relative:e}={}){let{basename:n}=_.useContext(zl),r=_.useContext(pu);tr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...i_(t||".",{relative:e})},o=qi();if(t==null){s.search=o.search;let a=new URLSearchParams(s.search),l=a.getAll("index");if(l.some(u=>u==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let u=a.toString();s.search=u?`?${u}`:""}}return(!t||t===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:Vc([n,s.pathname])),ay(s)}function Q_e(t,e={}){let n=_.useContext(xX);tr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=jX("useViewTransitionState"),i=i_(t,{relative:e.relative});if(!n.isTransitioning)return!1;let s=$d(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=$d(n.nextLocation.pathname,r)||n.nextLocation.pathname;return lw(i.pathname,o)!=null||lw(i.pathname,s)!=null}new TextEncoder;var zg=Mz();const BX=Xa(zg),bt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,fh="8.55.0",Yt=globalThis;function zC(t,e,n){const r=n||Yt,i=r.__SENTRY__=r.__SENTRY__||{},s=i[fh]=i[fh]||{};return s[t]||(s[t]=e())}const sf=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,ebe="Sentry Logger ",sP=["debug","info","warn","error","log","assert","trace"],uw={};function qh(t){if(!("console"in Yt))return t();const e=Yt.console,n={},r=Object.keys(uw);r.forEach(i=>{const s=uw[i];n[i]=e[i],e[i]=s});try{return t()}finally{r.forEach(i=>{e[i]=n[i]})}}function tbe(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return sf?sP.forEach(n=>{e[n]=(...r)=>{t&&qh(()=>{Yt.console[n](`${ebe}[${n}]:`,...r)})}}):sP.forEach(n=>{e[n]=()=>{}}),e}const Oe=zC("logger",tbe),HX=50,Rh="?",mj=/\(error: (.*)\)/,gj=/captureMessage|captureException/;function VX(...t){const e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,i=0)=>{const s=[],o=n.split(`
`);for(let a=r;a<o.length;a++){const l=o[a];if(l.length>1024)continue;const c=mj.test(l)?l.replace(mj,"$1"):l;if(!c.match(/\S*Error: /)){for(const u of e){const f=u(c);if(f){s.push(f);break}}if(s.length>=HX+i)break}}return rbe(s.slice(i))}}function nbe(t){return Array.isArray(t)?VX(...t):t}function rbe(t){if(!t.length)return[];const e=Array.from(t);return/sentryWrapped/.test(mS(e).function||"")&&e.pop(),e.reverse(),gj.test(mS(e).function||"")&&(e.pop(),gj.test(mS(e).function||"")&&e.pop()),e.slice(0,HX).map(n=>({...n,filename:n.filename||mS(e).filename,function:n.function||Rh}))}function mS(t){return t[t.length-1]||{}}const fk="<anonymous>";function su(t){try{return!t||typeof t!="function"?fk:t.name||fk}catch{return fk}}function vj(t){const e=t.exception;if(e){const n=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&n.push(...r.stacktrace.frames)}),n}catch{return}}}const z2={},yj={};function of(t,e){z2[t]=z2[t]||[],z2[t].push(e)}function af(t,e){if(!yj[t]){yj[t]=!0;try{e()}catch(n){sf&&Oe.error(`Error while instrumenting ${t}`,n)}}}function Go(t,e){const n=t&&z2[t];if(n)for(const r of n)try{r(e)}catch(i){sf&&Oe.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${su(r)}
Error:`,i)}}let hk=null;function GX(t){const e="error";of(e,t),af(e,ibe)}function ibe(){hk=Yt.onerror,Yt.onerror=function(t,e,n,r,i){return Go("error",{column:r,error:i,line:n,msg:t,url:e}),hk?hk.apply(this,arguments):!1},Yt.onerror.__SENTRY_INSTRUMENTED__=!0}let pk=null;function qX(t){const e="unhandledrejection";of(e,t),af(e,sbe)}function sbe(){pk=Yt.onunhandledrejection,Yt.onunhandledrejection=function(t){return Go("unhandledrejection",t),pk?pk.apply(this,arguments):!0},Yt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Kh(){return FA(Yt),Yt}function FA(t){const e=t.__SENTRY__=t.__SENTRY__||{};return e.version=e.version||fh,e[fh]=e[fh]||{}}const KX=Object.prototype.toString;function YC(t){switch(KX.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return ou(t,Error)}}function Yg(t,e){return KX.call(t)===`[object ${e}]`}function WX(t){return Yg(t,"ErrorEvent")}function _j(t){return Yg(t,"DOMError")}function obe(t){return Yg(t,"DOMException")}function Gc(t){return Yg(t,"String")}function UA(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function jA(t){return t===null||UA(t)||typeof t!="object"&&typeof t!="function"}function pg(t){return Yg(t,"Object")}function XC(t){return typeof Event<"u"&&ou(t,Event)}function abe(t){return typeof Element<"u"&&ou(t,Element)}function lbe(t){return Yg(t,"RegExp")}function JC(t){return!!(t&&t.then&&typeof t.then=="function")}function cbe(t){return pg(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function ou(t,e){try{return t instanceof e}catch{return!1}}function zX(t){return!!(typeof t=="object"&&t!==null&&(t.__isVue||t._isVue))}const Um=Yt,ube=80;function Ih(t,e={}){if(!t)return"<unknown>";try{let n=t;const r=5,i=[];let s=0,o=0;const a=" > ",l=a.length;let c;const u=Array.isArray(e)?e:e.keyAttrs,f=!Array.isArray(e)&&e.maxStringLength||ube;for(;n&&s++<r&&(c=dbe(n,u),!(c==="html"||s>1&&o+i.length*l+c.length>=f));)i.push(c),o+=c.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function dbe(t,e){const n=t,r=[];if(!n||!n.tagName)return"";if(Um.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>n.getAttribute(o)).map(o=>[o,n.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const o=n.className;if(o&&Gc(o)){const a=o.split(/\s+/);for(const l of a)r.push(`.${l}`)}}const s=["aria-label","type","name","title","alt"];for(const o of s){const a=n.getAttribute(o);a&&r.push(`[${o}="${a}"]`)}return r.join("")}function fbe(){try{return Um.document.location.href}catch{return""}}function hbe(t){return Um.document&&Um.document.querySelector?Um.document.querySelector(t):null}function YX(t){if(!Um.HTMLElement)return null;let e=t;const n=5;for(let r=0;r<n;r++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}function jm(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function bj(t,e){if(!Array.isArray(t))return"";const n=[];for(let r=0;r<t.length;r++){const i=t[r];try{zX(i)?n.push("[VueViewModel]"):n.push(String(i))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function pbe(t,e,n=!1){return Gc(t)?lbe(e)?e.test(t):Gc(e)?n?t===e:t.includes(e):!1:!1}function hh(t,e=[],n=!1){return e.some(r=>pbe(t,r,n))}function ao(t,e,n){if(!(e in t))return;const r=t[e],i=n(r);typeof i=="function"&&XX(i,r);try{t[e]=i}catch{sf&&Oe.log(`Failed to replace method "${e}" in object`,t)}}function Xo(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{sf&&Oe.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function XX(t,e){try{const n=e.prototype||{};t.prototype=e.prototype=n,Xo(t,"__sentry_original__",e)}catch{}}function $A(t){return t.__sentry_original__}function JX(t){if(YC(t))return{message:t.message,name:t.name,stack:t.stack,...Ej(t)};if(XC(t)){const e={type:t.type,target:Sj(t.target),currentTarget:Sj(t.currentTarget),...Ej(t)};return typeof CustomEvent<"u"&&ou(t,CustomEvent)&&(e.detail=t.detail),e}else return t}function Sj(t){try{return abe(t)?Ih(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}function Ej(t){if(typeof t=="object"&&t!==null){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}else return{}}function mbe(t,e=40){const n=Object.keys(JX(t));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=e)return jm(r,e);for(let i=n.length;i>0;i--){const s=n.slice(0,i).join(", ");if(!(s.length>e))return i===n.length?s:jm(s,e)}return""}function Ti(t){return oP(t,new Map)}function oP(t,e){if(gbe(t)){const n=e.get(t);if(n!==void 0)return n;const r={};e.set(t,r);for(const i of Object.getOwnPropertyNames(t))typeof t[i]<"u"&&(r[i]=oP(t[i],e));return r}if(Array.isArray(t)){const n=e.get(t);if(n!==void 0)return n;const r=[];return e.set(t,r),t.forEach(i=>{r.push(oP(i,e))}),r}return t}function gbe(t){if(!pg(t))return!1;try{const e=Object.getPrototypeOf(t).constructor.name;return!e||e==="Object"}catch{return!0}}const ZX=1e3;function s_(){return Date.now()/ZX}function vbe(){const{performance:t}=Yt;if(!t||!t.now)return s_;const e=Date.now()-t.now(),n=t.timeOrigin==null?e:t.timeOrigin;return()=>(n+t.now())/ZX}const rs=vbe(),Ds=(()=>{const{performance:t}=Yt;if(!t||!t.now)return;const e=3600*1e3,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,s=i<e,o=t.timing&&t.timing.navigationStart,l=typeof o=="number"?Math.abs(o+n-r):e,c=l<e;return s||c?i<=l?t.timeOrigin:o:r})();function qo(){const t=Yt,e=t.crypto||t.msCrypto;let n=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function QX(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function sd(t){const{message:e,event_id:n}=t;if(e)return e;const r=QX(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function aP(t,e,n){const r=t.exception=t.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function mg(t,e){const n=QX(t);if(!n)return;const r={type:"generic",handled:!0},i=n.mechanism;if(n.mechanism={...r,...i,...e},e&&"data"in e){const s={...i&&i.data,...e.data};n.mechanism.data=s}}function wj(t){if(ybe(t))return!0;try{Xo(t,"__sentry_captured__",!0)}catch{}return!1}function ybe(t){try{return t.__sentry_captured__}catch{}}var Sc;(function(t){t[t.PENDING=0]="PENDING";const n=1;t[t.RESOLVED=n]="RESOLVED";const r=2;t[t.REJECTED=r]="REJECTED"})(Sc||(Sc={}));function kh(t){return new Ao(e=>{e(t)})}function dw(t){return new Ao((e,n)=>{n(t)})}class Ao{constructor(e){Ao.prototype.__init.call(this),Ao.prototype.__init2.call(this),Ao.prototype.__init3.call(this),Ao.prototype.__init4.call(this),this._state=Sc.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new Ao((r,i)=>{this._handlers.push([!1,s=>{if(!e)r(s);else try{r(e(s))}catch(o){i(o)}},s=>{if(!n)i(s);else try{r(n(s))}catch(o){i(o)}}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new Ao((n,r)=>{let i,s;return this.then(o=>{s=!1,i=o,e&&e()},o=>{s=!0,i=o,e&&e()}).then(()=>{if(s){r(i);return}n(i)})})}__init(){this._resolve=e=>{this._setResult(Sc.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Sc.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{if(this._state===Sc.PENDING){if(JC(n)){n.then(this._resolve,this._reject);return}this._state=e,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===Sc.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===Sc.RESOLVED&&n[1](this._value),this._state===Sc.REJECTED&&n[2](this._value),n[0]=!0)})}}}function _be(t){const e=rs(),n={sid:qo(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Sbe(n)};return t&&gg(n,t),n}function gg(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||rs(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:qo()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{const n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}function bbe(t,e){let n={};t.status==="ok"&&(n={status:"exited"}),gg(t,n)}function Sbe(t){return Ti({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,abnormal_mechanism:t.abnormal_mechanism,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}function Bd(){return qo()}function Hd(){return qo().substring(16)}function ZC(t,e,n=2){if(!e||typeof e!="object"||n<=0)return e;if(t&&e&&Object.keys(e).length===0)return t;const r={...t};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=ZC(r[i],e[i],n-1));return r}const lP="_sentrySpan";function ly(t,e){e?Xo(t,lP,e):delete t[lP]}function fw(t){return t[lP]}const Ebe=100;class BA{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Bd(),spanId:Hd()}}clone(){const e=new BA;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,ly(e,fw(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&gg(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const n=typeof e=="function"?e(this):e,[r,i]=n instanceof Vd?[n.getScopeData(),n.getRequestSession()]:pg(n)?[e,e.requestSession]:[],{tags:s,extra:o,user:a,contexts:l,level:c,fingerprint:u=[],propagationContext:f}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...o},this._contexts={...this._contexts,...l},a&&Object.keys(a).length&&(this._user=a),c&&(this._level=c),u.length&&(this._fingerprint=u),f&&(this._propagationContext=f),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,ly(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Bd()}),this._notifyScopeListeners(),this}addBreadcrumb(e,n){const r=typeof n=="number"?n:Ebe;if(r<=0)return this;const i={timestamp:s_(),...e};return this._breadcrumbs.push(i),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:fw(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=ZC(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:Hd(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,n){const r=n&&n.event_id?n.event_id:qo();if(!this._client)return Oe.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureMessage(e,n,r){const i=r&&r.event_id?r.event_id:qo();if(!this._client)return Oe.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,n,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,n){const r=n&&n.event_id?n.event_id:qo();return this._client?(this._client.captureEvent(e,{...n,event_id:r},this),r):(Oe.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const Vd=BA;function wbe(){return zC("defaultCurrentScope",()=>new Vd)}function Cbe(){return zC("defaultIsolationScope",()=>new Vd)}class Tbe{constructor(e,n){let r;e?r=e:r=new Vd;let i;n?i=n:i=new Vd,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const n=this._pushScope();let r;try{r=e(n)}catch(i){throw this._popScope(),i}return JC(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function vg(){const t=Kh(),e=FA(t);return e.stack=e.stack||new Tbe(wbe(),Cbe())}function Rbe(t){return vg().withScope(t)}function Ibe(t,e){const n=vg();return n.withScope(()=>(n.getStackTop().scope=t,e(t)))}function Cj(t){return vg().withScope(()=>t(vg().getIsolationScope()))}function kbe(){return{withIsolationScope:Cj,withScope:Rbe,withSetScope:Ibe,withSetIsolationScope:(t,e)=>Cj(e),getCurrentScope:()=>vg().getScope(),getIsolationScope:()=>vg().getIsolationScope()}}function Xg(t){const e=FA(t);return e.acs?e.acs:kbe()}function En(){const t=Kh();return Xg(t).getCurrentScope()}function Xl(){const t=Kh();return Xg(t).getIsolationScope()}function xbe(){return zC("globalScope",()=>new Vd)}function QC(...t){const e=Kh(),n=Xg(e);if(t.length===2){const[r,i]=t;return r?n.withSetScope(r,i):n.withScope(i)}return n.withScope(t[0])}function en(){return En().getClient()}function Pbe(t){const e=t.getPropagationContext(),{traceId:n,spanId:r,parentSpanId:i}=e;return Ti({trace_id:n,span_id:r,parent_span_id:i})}const Lbe="_sentryMetrics";function cP(t){const e=t[Lbe];if(!e)return;const n={};for(const[,[r,i]]of e)(n[r]||(n[r]=[])).push(Ti(i));return n}const $o="sentry.source",eJ="sentry.sample_rate",au="sentry.op",Dr="sentry.origin",uP="sentry.idle_span_finish_reason",eT="sentry.measurement_unit",tT="sentry.measurement_value",Tj="sentry.custom_span_name",Abe="sentry.profile_id",HA="sentry.exclusive_time",Obe=0,tJ=1,oi=2;function Mbe(t){if(t<400&&t>=100)return{code:tJ};if(t>=400&&t<500)switch(t){case 401:return{code:oi,message:"unauthenticated"};case 403:return{code:oi,message:"permission_denied"};case 404:return{code:oi,message:"not_found"};case 409:return{code:oi,message:"already_exists"};case 413:return{code:oi,message:"failed_precondition"};case 429:return{code:oi,message:"resource_exhausted"};case 499:return{code:oi,message:"cancelled"};default:return{code:oi,message:"invalid_argument"}}if(t>=500&&t<600)switch(t){case 501:return{code:oi,message:"unimplemented"};case 503:return{code:oi,message:"unavailable"};case 504:return{code:oi,message:"deadline_exceeded"};default:return{code:oi,message:"internal_error"}}return{code:oi,message:"unknown_error"}}function nJ(t,e){t.setAttribute("http.response.status_code",e);const n=Mbe(e);n.message!=="unknown_error"&&t.setStatus(n)}const VA="sentry-",Nbe=/^sentry-/,Dbe=8192;function rJ(t){const e=Ube(t);if(!e)return;const n=Object.entries(e).reduce((r,[i,s])=>{if(i.match(Nbe)){const o=i.slice(VA.length);r[o]=s}return r},{});if(Object.keys(n).length>0)return n}function Fbe(t){if(!t)return;const e=Object.entries(t).reduce((n,[r,i])=>(i&&(n[`${VA}${r}`]=i),n),{});return jbe(e)}function Ube(t){if(!(!t||!Gc(t)&&!Array.isArray(t)))return Array.isArray(t)?t.reduce((e,n)=>{const r=Rj(n);return Object.entries(r).forEach(([i,s])=>{e[i]=s}),e},{}):Rj(t)}function Rj(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(n&&r&&(e[n]=r),e),{})}function jbe(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,r],i)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,o=i===0?s:`${e},${s}`;return o.length>Dbe?(sf&&Oe.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):o},"")}const iJ=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function $be(t){if(!t)return;const e=t.match(iJ);if(!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}function Bbe(t,e){const n=$be(t),r=rJ(e);if(!n||!n.traceId)return{traceId:Bd(),spanId:Hd()};const{traceId:i,parentSpanId:s,parentSampled:o}=n,a=Hd();return{traceId:i,parentSpanId:s,spanId:a,sampled:o,dsc:r||{}}}function sJ(t=Bd(),e=Hd(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${t}-${e}${r}`}const oJ=0,aJ=1;let Ij=!1;function Hbe(t){const{spanId:e,traceId:n}=t.spanContext(),{data:r,op:i,parent_span_id:s,status:o,origin:a}=Qt(t);return Ti({parent_span_id:s,span_id:e,trace_id:n,data:r,op:i,status:o,origin:a})}function Vbe(t){const{spanId:e,traceId:n,isRemote:r}=t.spanContext(),i=r?e:Qt(t).parent_span_id,s=r?Hd():e;return Ti({parent_span_id:i,span_id:s,trace_id:n})}function Gbe(t){const{traceId:e,spanId:n}=t.spanContext(),r=Wh(t);return sJ(e,n,r)}function ph(t){return typeof t=="number"?kj(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?kj(t.getTime()):rs()}function kj(t){return t>9999999999?t/1e3:t}function Qt(t){if(Kbe(t))return t.getSpanJSON();try{const{spanId:e,traceId:n}=t.spanContext();if(qbe(t)){const{attributes:r,startTime:i,name:s,endTime:o,parentSpanId:a,status:l}=t;return Ti({span_id:e,trace_id:n,data:r,description:s,parent_span_id:a,start_timestamp:ph(i),timestamp:ph(o)||void 0,status:lJ(l),op:r[au],origin:r[Dr],_metrics_summary:cP(t)})}return{span_id:e,trace_id:n}}catch{return{}}}function qbe(t){const e=t;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function Kbe(t){return typeof t.getSpanJSON=="function"}function Wh(t){const{traceFlags:e}=t.spanContext();return e===aJ}function lJ(t){if(!(!t||t.code===Obe))return t.code===tJ?"ok":t.message||"unknown_error"}const mh="_sentryChildSpans",dP="_sentryRootSpan";function cJ(t,e){const n=t[dP]||t;Xo(e,dP,n),t[mh]?t[mh].add(e):Xo(t,mh,new Set([e]))}function Wbe(t,e){t[mh]&&t[mh].delete(e)}function Y2(t){const e=new Set;function n(r){if(!e.has(r)&&Wh(r)){e.add(r);const i=r[mh]?Array.from(r[mh]):[];for(const s of i)n(s)}}return n(t),Array.from(e)}function Ii(t){return t[dP]||t}function xi(){const t=Kh(),e=Xg(t);return e.getActiveSpan?e.getActiveSpan():fw(En())}function uJ(){Ij||(qh(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),Ij=!0)}let xj=!1;function zbe(){xj||(xj=!0,GX(fP),qX(fP))}function fP(){const t=xi(),e=t&&Ii(t);if(e){const n="internal_error";bt&&Oe.log(`[Tracing] Root span: ${n} -> Global error occurred`),e.setStatus({code:oi,message:n})}}fP.tag="sentry_tracingErrorCallback";const dJ="_sentryScope",fJ="_sentryIsolationScope";function Ybe(t,e,n){t&&(Xo(t,fJ,n),Xo(t,dJ,e))}function Pj(t){return{scope:t[dJ],isolationScope:t[fJ]}}function Gd(t){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=en(),n=t||e&&e.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class Jg{constructor(e={}){this._traceId=e.traceId||Bd(),this._spanId=e.spanId||Hd()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:oJ}}end(e){}setAttribute(e,n){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,n,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,n){}}const GA="production",hJ="_frozenDsc";function Lj(t,e){Xo(t,hJ,e)}function pJ(t,e){const n=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=Ti({environment:n.environment||GA,release:n.release,public_key:r,trace_id:t});return e.emit("createDsc",i),i}function mJ(t,e){const n=e.getPropagationContext();return n.dsc||pJ(n.traceId,t)}function Zg(t){const e=en();if(!e)return{};const n=Ii(t),r=n[hJ];if(r)return r;const i=n.spanContext().traceState,s=i&&i.get("sentry.dsc"),o=s&&rJ(s);if(o)return o;const a=pJ(t.spanContext().traceId,e),l=Qt(n),c=l.data||{},u=c[eJ];u!=null&&(a.sample_rate=`${u}`);const f=c[$o],p=l.description;return f!=="url"&&p&&(a.transaction=p),Gd()&&(a.sampled=String(Wh(n))),e.emit("createDsc",a,n),a}function Xbe(t){if(!bt)return;const{description:e="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Qt(t),{spanId:i}=t.spanContext(),s=Wh(t),o=Ii(t),a=o===t,l=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,c=[`op: ${n}`,`name: ${e}`,`ID: ${i}`];if(r&&c.push(`parent ID: ${r}`),!a){const{op:u,description:f}=Qt(o);c.push(`root ID: ${o.spanContext().spanId}`),u&&c.push(`root op: ${u}`),f&&c.push(`root description: ${f}`)}Oe.log(`${l}
  ${c.join(`
  `)}`)}function Jbe(t){if(!bt)return;const{description:e="< unknown name >",op:n="< unknown op >"}=Qt(t),{spanId:r}=t.spanContext(),s=Ii(t)===t,o=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${e}" with ID ${r}`;Oe.log(o)}function gJ(t){if(typeof t=="boolean")return Number(t);const e=typeof t=="string"?parseFloat(t):t;if(typeof e!="number"||isNaN(e)||e<0||e>1){bt&&Oe.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`);return}return e}function Zbe(t,e){if(!Gd(t))return[!1];const n=Xl().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...e,normalizedRequest:e.normalizedRequest||n};let i;typeof t.tracesSampler=="function"?i=t.tracesSampler(r):r.parentSampled!==void 0?i=r.parentSampled:typeof t.tracesSampleRate<"u"?i=t.tracesSampleRate:i=1;const s=gJ(i);return s===void 0?(bt&&Oe.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):s?Math.random()<s?[!0,s]:(bt&&Oe.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,s]):(bt&&Oe.log(`[Tracing] Discarding transaction because ${typeof t.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s])}const Qbe=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function eSe(t){return t==="http"||t==="https"}function Qg(t,e=!1){const{host:n,path:r,pass:i,port:s,projectId:o,protocol:a,publicKey:l}=t;return`${a}://${l}${e&&i?`:${i}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${o}`}function tSe(t){const e=Qbe.exec(t);if(!e){qh(()=>{console.error(`Invalid Sentry Dsn: ${t}`)});return}const[n,r,i="",s="",o="",a=""]=e.slice(1);let l="",c=a;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const f=c.match(/^\d+/);f&&(c=f[0])}return vJ({host:s,pass:i,path:l,projectId:c,port:o,protocol:n,publicKey:r})}function vJ(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function nSe(t){if(!sf)return!0;const{port:e,projectId:n,protocol:r}=t;return["protocol","publicKey","host","projectId"].find(o=>t[o]?!1:(Oe.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:n.match(/^\d+$/)?eSe(r)?e&&isNaN(parseInt(e,10))?(Oe.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(Oe.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Oe.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function yJ(t){const e=typeof t=="string"?tSe(t):vJ(t);if(!(!e||!nSe(e)))return e}function rSe(){const t=typeof WeakSet=="function",e=t?new WeakSet:[];function n(i){if(t)return e.has(i)?!0:(e.add(i),!1);for(let s=0;s<e.length;s++)if(e[s]===i)return!0;return e.push(i),!1}function r(i){if(t)e.delete(i);else for(let s=0;s<e.length;s++)if(e[s]===i){e.splice(s,1);break}}return[n,r]}function Ec(t,e=100,n=1/0){try{return hP("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function _J(t,e=3,n=100*1024){const r=Ec(t,e);return aSe(r)>n?_J(t,e-1,n):r}function hP(t,e,n=1/0,r=1/0,i=rSe()){const[s,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const a=iSe(t,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;const l=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(l===0)return a.replace("object ","");if(s(e))return"[Circular ~]";const c=e;if(c&&typeof c.toJSON=="function")try{const m=c.toJSON();return hP("",m,l-1,r,i)}catch{}const u=Array.isArray(e)?[]:{};let f=0;const p=JX(e);for(const m in p){if(!Object.prototype.hasOwnProperty.call(p,m))continue;if(f>=r){u[m]="[MaxProperties ~]";break}const v=p[m];u[m]=hP(m,v,l-1,r,i),f++}return o(e),u}function iSe(t,e){try{if(t==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(t==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(zX(e))return"[VueViewModel]";if(cbe(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${su(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const n=sSe(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function sSe(t){const e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}function oSe(t){return~-encodeURI(t).split(/%..|./).length}function aSe(t){return oSe(JSON.stringify(t))}function ev(t,e=[]){return[t,e]}function lSe(t,e){const[n,r]=t;return[n,[...r,e]]}function Aj(t,e){const n=t[1];for(const r of n){const i=r[0].type;if(e(r,i))return!0}return!1}function pP(t){return Yt.__SENTRY__&&Yt.__SENTRY__.encodePolyfill?Yt.__SENTRY__.encodePolyfill(t):new TextEncoder().encode(t)}function cSe(t){const[e,n]=t;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[pP(r),s]:r.push(typeof s=="string"?pP(s):s)}for(const s of n){const[o,a]=s;if(i(`
${JSON.stringify(o)}
`),typeof a=="string"||a instanceof Uint8Array)i(a);else{let l;try{l=JSON.stringify(a)}catch{l=JSON.stringify(Ec(a))}i(l)}}return typeof r=="string"?r:uSe(r)}function uSe(t){const e=t.reduce((i,s)=>i+s.length,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}function dSe(t){return[{type:"span"},t]}function fSe(t){const e=typeof t.data=="string"?pP(t.data):t.data;return[Ti({type:"attachment",length:e.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),e]}const hSe={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function Oj(t){return hSe[t]}function bJ(t){if(!t||!t.sdk)return;const{name:e,version:n}=t.sdk;return{name:e,version:n}}function pSe(t,e,n,r){const i=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:Qg(r)},...i&&{trace:Ti({...i})}}}function mSe(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}function gSe(t,e,n,r){const i=bJ(n),s={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:Qg(e)}},o="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()];return ev(s,[o])}function vSe(t,e,n,r){const i=bJ(n),s=t.type&&t.type!=="replay_event"?t.type:"event";mSe(t,n&&n.sdk);const o=pSe(t,i,r,e);return delete t.sdkProcessingMetadata,ev(o,[[{type:s},t]])}function ySe(t,e){function n(u){return!!u.trace_id&&!!u.public_key}const r=Zg(t[0]),i=e&&e.getDsn(),s=e&&e.getOptions().tunnel,o={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&i&&{dsn:Qg(i)}},a=e&&e.getOptions().beforeSendSpan,l=a?u=>{const f=a(Qt(u));return f||uJ(),f}:u=>Qt(u),c=[];for(const u of t){const f=l(u);f&&c.push(dSe(f))}return ev(o,c)}function _Se(t,e,n,r=xi()){const i=r&&Ii(r);i&&(bt&&Oe.log(`[Measurement] Setting measurement on root span: ${t} = ${e} ${n}`),i.addEvent(t,{[tT]:e,[eT]:n}))}function Mj(t){if(!t||t.length===0)return;const e={};return t.forEach(n=>{const r=n.attributes||{},i=r[eT],s=r[tT];typeof i=="string"&&typeof s=="number"&&(e[n.name]={value:s,unit:i})}),e}const Nj=1e3;class qA{constructor(e={}){this._traceId=e.traceId||Bd(),this._spanId=e.spanId||Hd(),this._startTime=e.startTimestamp||rs(),this._attributes={},this.setAttributes({[Dr]:"manual",[au]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,n){}spanContext(){const{_spanId:e,_traceId:n,_sampled:r}=this;return{spanId:e,traceId:n,traceFlags:r?aJ:oJ}}setAttribute(e,n){return n===void 0?delete this._attributes[e]:this._attributes[e]=n,this}setAttributes(e){return Object.keys(e).forEach(n=>this.setAttribute(n,e[n])),this}updateStartTime(e){this._startTime=ph(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute($o,"custom"),this}end(e){this._endTime||(this._endTime=ph(e),Jbe(this),this._onSpanEnded())}getSpanJSON(){return Ti({data:this._attributes,description:this._name,op:this._attributes[au],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:lJ(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Dr],_metrics_summary:cP(this),profile_id:this._attributes[Abe],exclusive_time:this._attributes[HA],measurements:Mj(this._events),is_segment:this._isStandaloneSpan&&Ii(this)===this||void 0,segment_id:this._isStandaloneSpan?Ii(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,n,r){bt&&Oe.log("[Tracing] Adding an event to span:",e);const i=Dj(n)?n:r||rs(),s=Dj(n)?{}:n||{},o={name:e,time:ph(i),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=en();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===Ii(this)))return;if(this._isStandaloneSpan){this._sampled?SSe(ySe([this],e)):(bt&&Oe.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(Pj(this).scope||En()).captureEvent(r)}_convertSpanToTransaction(){if(!Fj(Qt(this)))return;this._name||(bt&&Oe.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:n}=Pj(this),i=(e||En()).getClient()||en();if(this._sampled!==!0){bt&&Oe.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const o=Y2(this).filter(f=>f!==this&&!bSe(f)).map(f=>Qt(f)).filter(Fj),a=this._attributes[$o];delete this._attributes[Tj],o.forEach(f=>{f.data&&delete f.data[Tj]});const l={contexts:{trace:Hbe(this)},spans:o.length>Nj?o.sort((f,p)=>f.start_timestamp-p.start_timestamp).slice(0,Nj):o,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:n,...Ti({dynamicSamplingContext:Zg(this)})},_metrics_summary:cP(this),...a&&{transaction_info:{source:a}}},c=Mj(this._events);return c&&Object.keys(c).length&&(bt&&Oe.log("[Measurements] Adding measurements to transaction event",JSON.stringify(c,void 0,2)),l.measurements=c),l}}function Dj(t){return t&&typeof t=="number"||t instanceof Date||Array.isArray(t)}function Fj(t){return!!t.start_timestamp&&!!t.timestamp&&!!t.span_id&&!!t.trace_id}function bSe(t){return t instanceof qA&&t.isStandaloneSpan()}function SSe(t){const e=en();if(!e)return;const n=t[1];if(!n||n.length===0){e.recordDroppedEvent("before_send","span");return}e.sendEnvelope(t)}const SJ="__SENTRY_SUPPRESS_TRACING__";function o_(t){const e=wJ();if(e.startInactiveSpan)return e.startInactiveSpan(t);const n=wSe(t),{forceTransaction:r,parentSpan:i}=t;return(t.scope?o=>QC(t.scope,o):i!==void 0?o=>EJ(i,o):o=>o())(()=>{const o=En(),a=TSe(o);return t.onlyIfParent&&!a?new Jg:ESe({parentSpan:a,spanArguments:n,forceTransaction:r,scope:o})})}function EJ(t,e){const n=wJ();return n.withActiveSpan?n.withActiveSpan(t,e):QC(r=>(ly(r,t||void 0),e(r)))}function ESe({parentSpan:t,spanArguments:e,forceTransaction:n,scope:r}){if(!Gd())return new Jg;const i=Xl();let s;if(t&&!n)s=CSe(t,r,e),cJ(t,s);else if(t){const o=Zg(t),{traceId:a,spanId:l}=t.spanContext(),c=Wh(t);s=Uj({traceId:a,parentSpanId:l,...e},r,c),Lj(s,o)}else{const{traceId:o,dsc:a,parentSpanId:l,sampled:c}={...i.getPropagationContext(),...r.getPropagationContext()};s=Uj({traceId:o,parentSpanId:l,...e},r,c),a&&Lj(s,a)}return Xbe(s),Ybe(s,r,i),s}function wSe(t){const n={isStandalone:(t.experimental||{}).standalone,...t};if(t.startTime){const r={...n};return r.startTimestamp=ph(t.startTime),delete r.startTime,r}return n}function wJ(){const t=Kh();return Xg(t)}function Uj(t,e,n){const r=en(),i=r&&r.getOptions()||{},{name:s="",attributes:o}=t,[a,l]=e.getScopeData().sdkProcessingMetadata[SJ]?[!1]:Zbe(i,{name:s,parentSampled:n,attributes:o,transactionContext:{name:s,parentSampled:n}}),c=new qA({...t,attributes:{[$o]:"custom",...t.attributes},sampled:a});return l!==void 0&&c.setAttribute(eJ,l),r&&r.emit("spanStart",c),c}function CSe(t,e,n){const{spanId:r,traceId:i}=t.spanContext(),s=e.getScopeData().sdkProcessingMetadata[SJ]?!1:Wh(t),o=s?new qA({...n,parentSpanId:r,traceId:i,sampled:s}):new Jg({traceId:i});cJ(t,o);const a=en();return a&&(a.emit("spanStart",o),n.endTimestamp&&a.emit("spanEnd",o)),o}function TSe(t){const e=fw(t);if(!e)return;const n=en();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?Ii(e):e}const X2={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},RSe="heartbeatFailed",ISe="idleTimeout",kSe="finalTimeout",xSe="externalFinish";function CJ(t,e={}){const n=new Map;let r=!1,i,s=xSe,o=!e.disableAutoFinish;const a=[],{idleTimeout:l=X2.idleTimeout,finalTimeout:c=X2.finalTimeout,childSpanTimeout:u=X2.childSpanTimeout,beforeSpanEnd:f}=e,p=en();if(!p||!Gd())return new Jg;const m=En(),v=xi(),g=PSe(t);g.end=new Proxy(g.end,{apply(C,x,A){f&&f(g);const[N,...D]=A,F=N||rs(),$=ph(F),B=Y2(g).filter(V=>V!==g);if(!B.length)return I($),Reflect.apply(C,x,[$,...D]);const W=B.map(V=>Qt(V).timestamp).filter(V=>!!V),H=W.length?Math.max(...W):void 0,z=Qt(g).start_timestamp,K=Math.min(z?z+c/1e3:1/0,Math.max(z||-1/0,Math.min($,H||1/0)));return I(K),Reflect.apply(C,x,[K,...D])}});function S(){i&&(clearTimeout(i),i=void 0)}function b(C){S(),i=setTimeout(()=>{!r&&n.size===0&&o&&(s=ISe,g.end(C))},l)}function w(C){i=setTimeout(()=>{!r&&o&&(s=RSe,g.end(C))},u)}function k(C){S(),n.set(C,!0);const x=rs();w(x+u/1e3)}function T(C){if(n.has(C)&&n.delete(C),n.size===0){const x=rs();b(x+l/1e3)}}function I(C){r=!0,n.clear(),a.forEach($=>$()),ly(m,v);const x=Qt(g),{start_timestamp:A}=x;if(!A)return;(x.data||{})[uP]||g.setAttribute(uP,s),Oe.log(`[Tracing] Idle span "${x.op}" finished`);const D=Y2(g).filter($=>$!==g);let F=0;D.forEach($=>{$.isRecording()&&($.setStatus({code:oi,message:"cancelled"}),$.end(C),bt&&Oe.log("[Tracing] Cancelling span since span ended early",JSON.stringify($,void 0,2)));const B=Qt($),{timestamp:W=0,start_timestamp:H=0}=B,z=H<=C,K=(c+l)/1e3,V=W-H<=K;if(bt){const q=JSON.stringify($,void 0,2);z?V||Oe.log("[Tracing] Discarding span since it finished after idle span final timeout",q):Oe.log("[Tracing] Discarding span since it happened after idle span was finished",q)}(!V||!z)&&(Wbe(g,$),F++)}),F>0&&g.setAttribute("sentry.idle_span_discarded_spans",F)}return a.push(p.on("spanStart",C=>{if(r||C===g||Qt(C).timestamp)return;Y2(g).includes(C)&&k(C.spanContext().spanId)})),a.push(p.on("spanEnd",C=>{r||T(C.spanContext().spanId)})),a.push(p.on("idleSpanEnableAutoFinish",C=>{C===g&&(o=!0,b(),n.size&&w())})),e.disableAutoFinish||b(),setTimeout(()=>{r||(g.setStatus({code:oi,message:"deadline_exceeded"}),s=kSe,g.end())},c),g}function PSe(t){const e=o_(t);return ly(En(),e),bt&&Oe.log("[Tracing] Started span is an idle span"),e}function mP(t,e,n,r=0){return new Ao((i,s)=>{const o=t[r];if(e===null||typeof o!="function")i(e);else{const a=o({...e},n);bt&&o.id&&a===null&&Oe.log(`Event processor "${o.id}" dropped event`),JC(a)?a.then(l=>mP(t,l,n,r+1).then(i)).then(null,s):mP(t,a,n,r+1).then(i).then(null,s)}})}let gS,jj,vS;function LSe(t){const e=Yt._sentryDebugIds;if(!e)return{};const n=Object.keys(e);return vS&&n.length===jj||(jj=n.length,vS=n.reduce((r,i)=>{gS||(gS={});const s=gS[i];if(s)r[s[0]]=s[1];else{const o=t(i);for(let a=o.length-1;a>=0;a--){const l=o[a],c=l&&l.filename,u=e[i];if(c&&u){r[c]=u,gS[i]=[c,u];break}}}return r},{})),vS}function ASe(t,e){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;OSe(t,e),r&&DSe(t,r),FSe(t,n),MSe(t,i),NSe(t,s)}function $j(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,sdkProcessingMetadata:a,breadcrumbs:l,fingerprint:c,eventProcessors:u,attachments:f,propagationContext:p,transactionName:m,span:v}=e;yS(t,"extra",n),yS(t,"tags",r),yS(t,"user",i),yS(t,"contexts",s),t.sdkProcessingMetadata=ZC(t.sdkProcessingMetadata,a,2),o&&(t.level=o),m&&(t.transactionName=m),v&&(t.span=v),l.length&&(t.breadcrumbs=[...t.breadcrumbs,...l]),c.length&&(t.fingerprint=[...t.fingerprint,...c]),u.length&&(t.eventProcessors=[...t.eventProcessors,...u]),f.length&&(t.attachments=[...t.attachments,...f]),t.propagationContext={...t.propagationContext,...p}}function yS(t,e,n){t[e]=ZC(t[e],n,1)}function OSe(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,transactionName:a}=e,l=Ti(n);l&&Object.keys(l).length&&(t.extra={...l,...t.extra});const c=Ti(r);c&&Object.keys(c).length&&(t.tags={...c,...t.tags});const u=Ti(i);u&&Object.keys(u).length&&(t.user={...u,...t.user});const f=Ti(s);f&&Object.keys(f).length&&(t.contexts={...f,...t.contexts}),o&&(t.level=o),a&&t.type!=="transaction"&&(t.transaction=a)}function MSe(t,e){const n=[...t.breadcrumbs||[],...e];t.breadcrumbs=n.length?n:void 0}function NSe(t,e){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e}}function DSe(t,e){t.contexts={trace:Vbe(e),...t.contexts},t.sdkProcessingMetadata={dynamicSamplingContext:Zg(e),...t.sdkProcessingMetadata};const n=Ii(e),r=Qt(n).description;r&&!t.transaction&&t.type==="transaction"&&(t.transaction=r)}function FSe(t,e){t.fingerprint=t.fingerprint?Array.isArray(t.fingerprint)?t.fingerprint:[t.fingerprint]:[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}function USe(t,e,n,r,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:a=1e3}=t,l={...e,event_id:e.event_id||n.event_id||qo(),timestamp:e.timestamp||s_()},c=n.integrations||t.integrations.map(S=>S.name);jSe(l,t),HSe(l,c),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&$Se(l,t.stackParser);const u=GSe(r,n.captureContext);n.mechanism&&mg(l,n.mechanism);const f=i?i.getEventProcessors():[],p=xbe().getScopeData();if(s){const S=s.getScopeData();$j(p,S)}if(u){const S=u.getScopeData();$j(p,S)}const m=[...n.attachments||[],...p.attachments];m.length&&(n.attachments=m),ASe(l,p);const v=[...f,...p.eventProcessors];return mP(v,l,n).then(S=>(S&&BSe(S),typeof o=="number"&&o>0?VSe(S,o,a):S))}function jSe(t,e){const{environment:n,release:r,dist:i,maxValueLength:s=250}=e;t.environment=t.environment||n||GA,!t.release&&r&&(t.release=r),!t.dist&&i&&(t.dist=i),t.message&&(t.message=jm(t.message,s));const o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=jm(o.value,s));const a=t.request;a&&a.url&&(a.url=jm(a.url,s))}function $Se(t,e){const n=LSe(e);try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{n&&i.filename&&(i.debug_id=n[i.filename])})})}catch{}}function BSe(t){const e={};try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const n=t.debug_meta.images;Object.entries(e).forEach(([r,i])=>{n.push({type:"sourcemap",code_file:r,debug_id:i})})}function HSe(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function VSe(t,e,n){if(!t)return null;const r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(i=>({...i,...i.data&&{data:Ec(i.data,e,n)}}))},...t.user&&{user:Ec(t.user,e,n)},...t.contexts&&{contexts:Ec(t.contexts,e,n)},...t.extra&&{extra:Ec(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=Ec(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map(i=>({...i,...i.data&&{data:Ec(i.data,e,n)}}))),t.contexts&&t.contexts.flags&&r.contexts&&(r.contexts.flags=Ec(t.contexts.flags,3,n)),r}function GSe(t,e){if(!e)return t;const n=t?t.clone():new Vd;return n.update(e),n}function qSe(t){if(t)return KSe(t)?{captureContext:t}:zSe(t)?{captureContext:t}:t}function KSe(t){return t instanceof Vd||typeof t=="function"}const WSe=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function zSe(t){return Object.keys(t).some(e=>WSe.includes(e))}function nT(t,e){return En().captureException(t,qSe(e))}function YSe(t,e){const r={captureContext:e};return En().captureMessage(t,void 0,r)}function TJ(t,e){return En().captureEvent(t,e)}function XSe(t,e){Xl().setContext(t,e)}function JSe(){return Xl().lastEventId()}function ZSe(){const t=en();return!!t&&t.getOptions().enabled!==!1&&!!t.getTransport()}function Bj(t){const e=en(),n=Xl(),r=En(),{release:i,environment:s=GA}=e&&e.getOptions()||{},{userAgent:o}=Yt.navigator||{},a=_be({release:i,environment:s,user:r.getUser()||n.getUser(),...o&&{userAgent:o},...t}),l=n.getSession();return l&&l.status==="ok"&&gg(l,{status:"exited"}),RJ(),n.setSession(a),r.setSession(a),a}function RJ(){const t=Xl(),e=En(),n=e.getSession()||t.getSession();n&&bbe(n),IJ(),t.setSession(),e.setSession()}function IJ(){const t=Xl(),e=En(),n=en(),r=e.getSession()||t.getSession();r&&n&&n.captureSession(r)}function Hj(t=!1){if(t){RJ();return}IJ()}const QSe="7";function kJ(t){const e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}function e2e(t){return`${kJ(t)}${t.projectId}/envelope/`}function t2e(t,e){const n={sentry_version:QSe};return t.publicKey&&(n.sentry_key=t.publicKey),e&&(n.sentry_client=`${e.name}/${e.version}`),new URLSearchParams(n).toString()}function n2e(t,e,n){return e||`${e2e(t)}?${t2e(t,n)}`}function r2e(t,e){const n=yJ(t);if(!n)return"";const r=`${kJ(n)}embed/error-page/`;let i=`dsn=${Qg(n)}`;for(const s in e)if(s!=="dsn"&&s!=="onClose")if(s==="user"){const o=e.user;if(!o)continue;o.name&&(i+=`&name=${encodeURIComponent(o.name)}`),o.email&&(i+=`&email=${encodeURIComponent(o.email)}`)}else i+=`&${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`;return`${r}?${i}`}const Vj=[];function i2e(t){const e={};return t.forEach(n=>{const{name:r}=n,i=e[r];i&&!i.isDefaultInstance&&n.isDefaultInstance||(e[r]=n)}),Object.values(e)}function s2e(t){const e=t.defaultIntegrations||[],n=t.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...e,...n];else if(typeof n=="function"){const o=n(e);r=Array.isArray(o)?o:[o]}else r=e;const i=i2e(r),s=i.findIndex(o=>o.name==="Debug");if(s>-1){const[o]=i.splice(s,1);i.push(o)}return i}function o2e(t,e){const n={};return e.forEach(r=>{r&&xJ(t,r,n)}),n}function Gj(t,e){for(const n of e)n&&n.afterAllSetup&&n.afterAllSetup(t)}function xJ(t,e,n){if(n[e.name]){bt&&Oe.log(`Integration skipped because it was already installed: ${e.name}`);return}if(n[e.name]=e,Vj.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Vj.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,s)=>r(i,s,t))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,o)=>r(s,o,t),{id:e.name});t.addEventProcessor(i)}bt&&Oe.log(`Integration installed: ${e.name}`)}function a2e(t,e,n){const r=[{type:"client_report"},{timestamp:s_(),discarded_events:t}];return ev(e?{dsn:e}:{},[r])}class Oa extends Error{constructor(e,n="warn"){super(e),this.message=e,this.logLevel=n}}const qj="Not capturing exception because it's already been captured.";class l2e{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=yJ(e.dsn):bt&&Oe.warn("No DSN provided, client will not send events."),this._dsn){const i=n2e(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:i})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find(i=>i in e&&e[i]==null);r&&qh(()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,n,r){const i=qo();if(wj(e))return bt&&Oe.log(qj),i;const s={event_id:i,...n};return this._process(this.eventFromException(e,s).then(o=>this._captureEvent(o,s,r))),s.event_id}captureMessage(e,n,r,i){const s={event_id:qo(),...r},o=UA(e)?e:String(e),a=jA(e)?this.eventFromMessage(o,n,s):this.eventFromException(e,s);return this._process(a.then(l=>this._captureEvent(l,s,i))),s.event_id}captureEvent(e,n,r){const i=qo();if(n&&n.originalException&&wj(n.originalException))return bt&&Oe.log(qj),i;const s={event_id:i,...n},a=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,a||r)),s.event_id}captureSession(e){typeof e.release!="string"?bt&&Oe.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),gg(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const n=this._transport;return n?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>n.flush(e).then(i=>r&&i))):kh(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,this.emit("close"),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const n=this._integrations[e.name];xJ(this,e,this._integrations),n||Gj(this,[e])}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=vSe(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of n.attachments||[])r=lSe(r,fSe(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const n=gSe(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${n}`;bt&&Oe.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,n){const r=this._hooks[e]=this._hooks[e]||[];return r.push(n),()=>{const i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){const r=this._hooks[e];r&&r.forEach(i=>i(...n))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,n=>(bt&&Oe.error("Error while sending envelope:",n),n)):(bt&&Oe.error("Transport disabled"),kh({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=o2e(this,e),Gj(this,e)}_updateSessionFromEvent(e,n){let r=n.level==="fatal",i=!1;const s=n.exception&&n.exception.values;if(s){i=!0;for(const l of s){const c=l.mechanism;if(c&&c.handled===!1){r=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&r)&&(gg(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Ao(n=>{let r=0;const i=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),n(!0)):(r+=i,e&&r>=e&&(clearInterval(s),n(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r=En(),i=Xl()){const s=this.getOptions(),o=Object.keys(this._integrations);return!n.integrations&&o.length>0&&(n.integrations=o),this.emit("preprocessEvent",e,n),e.type||i.setLastEventId(e.event_id||n.event_id),USe(s,e,n,r,this,i).then(a=>{if(a===null)return a;a.contexts={trace:Pbe(r),...a.contexts};const l=mJ(this,r);return a.sdkProcessingMetadata={dynamicSamplingContext:l,...a.sdkProcessingMetadata},a})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(i=>i.event_id,i=>{bt&&(i instanceof Oa&&i.logLevel==="log"?Oe.log(i.message):Oe.warn(i))})}_processEvent(e,n,r){const i=this.getOptions(),{sampleRate:s}=i,o=LJ(e),a=PJ(e),l=e.type||"error",c=`before send for type \`${l}\``,u=typeof s>"u"?void 0:gJ(s);if(a&&typeof u=="number"&&Math.random()>u)return this.recordDroppedEvent("sample_rate","error",e),dw(new Oa(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const f=l==="replay_event"?"replay":l,m=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,n,r,m).then(v=>{if(v===null)throw this.recordDroppedEvent("event_processor",f,e),new Oa("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return v;const S=u2e(this,i,v,n);return c2e(S,c)}).then(v=>{if(v===null){if(this.recordDroppedEvent("before_send",f,e),o){const w=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",w)}throw new Oa(`${c} returned \`null\`, will not send event.`,"log")}const g=r&&r.getSession();if(!o&&g&&this._updateSessionFromEvent(g,v),o){const b=v.sdkProcessingMetadata&&v.sdkProcessingMetadata.spanCountBeforeProcessing||0,w=v.spans?v.spans.length:0,k=b-w;k>0&&this.recordDroppedEvent("before_send","span",k)}const S=v.transaction_info;if(o&&S&&v.transaction!==e.transaction){const b="custom";v.transaction_info={...S,source:b}}return this.sendEvent(v,n),v}).then(null,v=>{throw v instanceof Oa?v:(this.captureException(v,{data:{__sentry__:!0},originalException:v}),new Oa(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${v}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([n,r])=>{const[i,s]=n.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){bt&&Oe.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){bt&&Oe.log("No outcomes to send");return}if(!this._dsn){bt&&Oe.log("No dsn provided, will not send outcomes");return}bt&&Oe.log("Sending outcomes:",e);const n=a2e(e,this._options.tunnel&&Qg(this._dsn));this.sendEnvelope(n)}}function c2e(t,e){const n=`${e} must return \`null\` or a valid event.`;if(JC(t))return t.then(r=>{if(!pg(r)&&r!==null)throw new Oa(n);return r},r=>{throw new Oa(`${e} rejected with ${r}`)});if(!pg(t)&&t!==null)throw new Oa(n);return t}function u2e(t,e,n,r){const{beforeSend:i,beforeSendTransaction:s,beforeSendSpan:o}=e;if(PJ(n)&&i)return i(n,r);if(LJ(n)){if(n.spans&&o){const a=[];for(const l of n.spans){const c=o(l);c?a.push(c):(uJ(),t.recordDroppedEvent("before_send","span"))}n.spans=a}if(s){if(n.spans){const a=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:a}}return s(n,r)}}return n}function PJ(t){return t.type===void 0}function LJ(t){return t.type==="transaction"}function d2e(t,e){e.debug===!0&&(bt?Oe.enable():qh(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),En().update(e.initialScope);const r=new t(e);return f2e(r),r.init(),r}function f2e(t){En().setClient(t)}function h2e(t){const e=[];function n(){return t===void 0||e.length<t}function r(o){return e.splice(e.indexOf(o),1)[0]||Promise.resolve(void 0)}function i(o){if(!n())return dw(new Oa("Not adding Promise because buffer limit was reached."));const a=o();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function s(o){return new Ao((a,l)=>{let c=e.length;if(!c)return a(!0);const u=setTimeout(()=>{o&&o>0&&a(!1)},o);e.forEach(f=>{kh(f).then(()=>{--c||(clearTimeout(u),a(!0))},l)})})}return{$:e,add:i,drain:s}}const p2e=60*1e3;function m2e(t,e=Date.now()){const n=parseInt(`${t}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${t}`);return isNaN(r)?p2e:r-e}function g2e(t,e){return t[e]||t.all||0}function v2e(t,e,n=Date.now()){return g2e(t,e)>n}function y2e(t,{statusCode:e,headers:n},r=Date.now()){const i={...t},s=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(s)for(const a of s.trim().split(",")){const[l,c,,,u]=a.split(":",5),f=parseInt(l,10),p=(isNaN(f)?60:f)*1e3;if(!c)i.all=r+p;else for(const m of c.split(";"))m==="metric_bucket"?(!u||u.split(";").includes("custom"))&&(i[m]=r+p):i[m]=r+p}else o?i.all=r+m2e(o,r):e===429&&(i.all=r+60*1e3);return i}const _2e=64;function b2e(t,e,n=h2e(t.bufferSize||_2e)){let r={};const i=o=>n.drain(o);function s(o){const a=[];if(Aj(o,(f,p)=>{const m=Oj(p);if(v2e(r,m)){const v=Kj(f,p);t.recordDroppedEvent("ratelimit_backoff",m,v)}else a.push(f)}),a.length===0)return kh({});const l=ev(o[0],a),c=f=>{Aj(l,(p,m)=>{const v=Kj(p,m);t.recordDroppedEvent(f,Oj(m),v)})},u=()=>e({body:cSe(l)}).then(f=>(f.statusCode!==void 0&&(f.statusCode<200||f.statusCode>=300)&&bt&&Oe.warn(`Sentry responded with status code ${f.statusCode} to sent event.`),r=y2e(r,f),f),f=>{throw c("network_error"),f});return n.add(u).then(f=>f,f=>{if(f instanceof Oa)return bt&&Oe.error("Skipped sending event because buffer is full."),c("queue_overflow"),kh({});throw f})}return{send:s,flush:i}}function Kj(t,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(t)?t[1]:void 0}function AJ(t,e,n=[e],r="npm"){const i=t._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:fh})),version:fh}),t._metadata=i}function OJ(t={}){const e=en();if(!ZSe()||!e)return{};const n=Kh(),r=Xg(n);if(r.getTraceData)return r.getTraceData(t);const i=En(),s=t.span||xi(),o=s?Gbe(s):S2e(i),a=s?Zg(s):mJ(e,i),l=Fbe(a);return iJ.test(o)?{"sentry-trace":o,baggage:l}:(Oe.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function S2e(t){const{traceId:e,sampled:n,spanId:r}=t.getPropagationContext();return sJ(e,r,n)}const E2e=100;function xh(t,e){const n=en(),r=Xl();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=E2e}=n.getOptions();if(s<=0)return;const a={timestamp:s_(),...t},l=i?qh(()=>i(a,e)):a;l!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",l,e),r.addBreadcrumb(l,s))}let Wj;const w2e="FunctionToString",zj=new WeakMap,C2e=()=>({name:w2e,setupOnce(){Wj=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=$A(this),n=zj.has(en())&&e!==void 0?e:this;return Wj.apply(n,t)}}catch{}},setup(t){zj.set(t,!0)}}),T2e=C2e,R2e=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],I2e="InboundFilters",k2e=(t={})=>({name:I2e,processEvent(e,n,r){const i=r.getOptions(),s=P2e(t,i);return L2e(e,s)?null:e}}),x2e=k2e;function P2e(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:R2e],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}function L2e(t,e){return e.ignoreInternal&&F2e(t)?(bt&&Oe.warn(`Event dropped due to being internal Sentry Error.
Event: ${sd(t)}`),!0):A2e(t,e.ignoreErrors)?(bt&&Oe.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${sd(t)}`),!0):j2e(t)?(bt&&Oe.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${sd(t)}`),!0):O2e(t,e.ignoreTransactions)?(bt&&Oe.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${sd(t)}`),!0):M2e(t,e.denyUrls)?(bt&&Oe.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${sd(t)}.
Url: ${hw(t)}`),!0):N2e(t,e.allowUrls)?!1:(bt&&Oe.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${sd(t)}.
Url: ${hw(t)}`),!0)}function A2e(t,e){return t.type||!e||!e.length?!1:D2e(t).some(n=>hh(n,e))}function O2e(t,e){if(t.type!=="transaction"||!e||!e.length)return!1;const n=t.transaction;return n?hh(n,e):!1}function M2e(t,e){if(!e||!e.length)return!1;const n=hw(t);return n?hh(n,e):!1}function N2e(t,e){if(!e||!e.length)return!0;const n=hw(t);return n?hh(n,e):!0}function D2e(t){const e=[];t.message&&e.push(t.message);let n;try{n=t.exception.values[t.exception.values.length-1]}catch{}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),e}function F2e(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}function U2e(t=[]){for(let e=t.length-1;e>=0;e--){const n=t[e];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function hw(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?U2e(e):null}catch{return bt&&Oe.error(`Cannot extract url for event ${sd(t)}`),null}}function j2e(t){return t.type||!t.exception||!t.exception.values||t.exception.values.length===0?!1:!t.message&&!t.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}function $2e(t,e,n=250,r,i,s,o){if(!s.exception||!s.exception.values||!o||!ou(o.originalException,Error))return;const a=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;a&&(s.exception.values=B2e(gP(t,e,i,o.originalException,r,s.exception.values,a,0),n))}function gP(t,e,n,r,i,s,o,a){if(s.length>=n+1)return s;let l=[...s];if(ou(r[i],Error)){Yj(o,a);const c=t(e,r[i]),u=l.length;Xj(c,i,u,a),l=gP(t,e,n,r[i],i,[c,...l],c,u)}return Array.isArray(r.errors)&&r.errors.forEach((c,u)=>{if(ou(c,Error)){Yj(o,a);const f=t(e,c),p=l.length;Xj(f,`errors[${u}]`,p,a),l=gP(t,e,n,c,i,[f,...l],f,p)}}),l}function Yj(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,...t.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function Xj(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function B2e(t,e){return t.map(n=>(n.value&&(n.value=jm(n.value,e)),n))}function gh(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}function Jj(t){return t.split(/\\?\//).filter(e=>e.length>0&&e!==",").length}function H2e(t){const e="console";of(e,t),af(e,V2e)}function V2e(){"console"in Yt&&sP.forEach(function(t){t in Yt.console&&ao(Yt.console,t,function(e){return uw[t]=e,function(...n){Go("console",{args:n,level:t});const i=uw[t];i&&i.apply(Yt.console,n)}})})}function G2e(t){return t==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(t)?t:"log"}const q2e="Dedupe",K2e=()=>{let t;return{name:q2e,processEvent(e){if(e.type)return e;try{if(z2e(e,t))return bt&&Oe.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return t=e}}},W2e=K2e;function z2e(t,e){return e?!!(Y2e(t,e)||X2e(t,e)):!1}function Y2e(t,e){const n=t.message,r=e.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!NJ(t,e)||!MJ(t,e))}function X2e(t,e){const n=Zj(e),r=Zj(t);return!(!n||!r||n.type!==r.type||n.value!==r.value||!NJ(t,e)||!MJ(t,e))}function MJ(t,e){let n=vj(t),r=vj(e);if(!n&&!r)return!0;if(n&&!r||!n&&r||(n=n,r=r,r.length!==n.length))return!1;for(let i=0;i<r.length;i++){const s=r[i],o=n[i];if(s.filename!==o.filename||s.lineno!==o.lineno||s.colno!==o.colno||s.function!==o.function)return!1}return!0}function NJ(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;n=n,r=r;try{return n.join("")===r.join("")}catch{return!1}}function Zj(t){return t.exception&&t.exception.values&&t.exception.values[0]}function J2e(t,e,n,r,i="auto.http.browser"){if(!t.fetchData)return;const s=Gd()&&e(t.fetchData.url);if(t.endTimestamp&&s){const p=t.fetchData.__span;if(!p)return;const m=r[p];m&&(eEe(m,t),delete r[p]);return}const{method:o,url:a}=t.fetchData,l=Q2e(a),c=l?gh(l).host:void 0,u=!!xi(),f=s&&u?o_({name:`${o} ${a}`,attributes:{url:a,type:"fetch","http.method":o,"http.url":l,"server.address":c,[Dr]:i,[au]:"http.client"}}):new Jg;if(t.fetchData.__span=f.spanContext().spanId,r[f.spanContext().spanId]=f,n(t.fetchData.url)){const p=t.args[0],m=t.args[1]||{},v=Z2e(p,m,Gd()&&u?f:void 0);v&&(t.args[1]=m,m.headers=v)}return f}function Z2e(t,e,n){const r=OJ({span:n}),i=r["sentry-trace"],s=r.baggage;if(!i)return;const o=e.headers||(tEe(t)?t.headers:void 0);if(o)if(nEe(o)){const a=new Headers(o);if(a.set("sentry-trace",i),s){const l=a.get("baggage");if(l){const c=_S(l);a.set("baggage",c?`${c},${s}`:s)}else a.set("baggage",s)}return a}else if(Array.isArray(o)){const a=[...o.filter(l=>!(Array.isArray(l)&&l[0]==="sentry-trace")).map(l=>{if(Array.isArray(l)&&l[0]==="baggage"&&typeof l[1]=="string"){const[c,u,...f]=l;return[c,_S(u),...f]}else return l}),["sentry-trace",i]];return s&&a.push(["baggage",s]),a}else{const a="baggage"in o?o.baggage:void 0;let l=[];return Array.isArray(a)?l=a.map(c=>typeof c=="string"?_S(c):c).filter(c=>c===""):a&&l.push(_S(a)),s&&l.push(s),{...o,"sentry-trace":i,baggage:l.length>0?l.join(","):void 0}}else return{...r}}function Q2e(t){try{return new URL(t).href}catch{return}}function eEe(t,e){if(e.response){nJ(t,e.response.status);const n=e.response&&e.response.headers&&e.response.headers.get("content-length");if(n){const r=parseInt(n);r>0&&t.setAttribute("http.response_content_length",r)}}else e.error&&t.setStatus({code:oi,message:"internal_error"});t.end()}function _S(t){return t.split(",").filter(e=>!e.split("=")[0].startsWith(VA)).join(",")}function tEe(t){return typeof Request<"u"&&ou(t,Request)}function nEe(t){return typeof Headers<"u"&&ou(t,Headers)}function DJ(t){if(t!==void 0)return t>=400&&t<500?"warning":t>=500?"error":void 0}const vP=Yt;function FJ(){if(!("fetch"in vP))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function yP(t){return t&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function rEe(){if(typeof EdgeRuntime=="string")return!0;if(!FJ())return!1;if(yP(vP.fetch))return!0;let t=!1;const e=vP.document;if(e&&typeof e.createElement=="function")try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=yP(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){sf&&Oe.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}function UJ(t,e){const n="fetch";of(n,t),af(n,()=>jJ(void 0,e))}function iEe(t){const e="fetch-body-resolved";of(e,t),af(e,()=>jJ(oEe))}function jJ(t,e=!1){e&&!rEe()||ao(Yt,"fetch",function(n){return function(...r){const i=new Error,{method:s,url:o}=aEe(r),a={args:r,fetchData:{method:s,url:o},startTimestamp:rs()*1e3,virtualError:i};return t||Go("fetch",{...a}),n.apply(Yt,r).then(async l=>(t?t(l):Go("fetch",{...a,endTimestamp:rs()*1e3,response:l}),l),l=>{throw Go("fetch",{...a,endTimestamp:rs()*1e3,error:l}),YC(l)&&l.stack===void 0&&(l.stack=i.stack,Xo(l,"framesToPop",1)),l})}})}async function sEe(t,e){if(t&&t.body){const n=t.body,r=n.getReader(),i=setTimeout(()=>{n.cancel().then(null,()=>{})},90*1e3);let s=!0;for(;s;){let o;try{o=setTimeout(()=>{n.cancel().then(null,()=>{})},5e3);const{done:a}=await r.read();clearTimeout(o),a&&(e(),s=!1)}catch{s=!1}finally{clearTimeout(o)}}clearTimeout(i),r.releaseLock(),n.cancel().then(null,()=>{})}}function oEe(t){let e;try{e=t.clone()}catch{return}sEe(e,()=>{Go("fetch-body-resolved",{endTimestamp:rs()*1e3,response:t})})}function _P(t,e){return!!t&&typeof t=="object"&&!!t[e]}function Qj(t){return typeof t=="string"?t:t?_P(t,"url")?t.url:t.toString?t.toString():"":""}function aEe(t){if(t.length===0)return{method:"GET",url:""};if(t.length===2){const[n,r]=t;return{url:Qj(n),method:_P(r,"method")?String(r.method).toUpperCase():"GET"}}const e=t[0];return{url:Qj(e),method:_P(e,"method")?String(e.method).toUpperCase():"GET"}}function lEe(){return"npm"}const bS=Yt;function cEe(){const t=bS.chrome,e=t&&t.app&&t.app.runtime,n="history"in bS&&!!bS.history.pushState&&!!bS.history.replaceState;return!e&&n}const ot=Yt;let bP=0;function $J(){return bP>0}function uEe(){bP++,setTimeout(()=>{bP--})}function yg(t,e={}){function n(i){return typeof i=="function"}if(!n(t))return t;try{const i=t.__sentry_wrapped__;if(i)return typeof i=="function"?i:t;if($A(t))return t}catch{return t}const r=function(...i){try{const s=i.map(o=>yg(o,e));return t.apply(this,s)}catch(s){throw uEe(),QC(o=>{o.addEventProcessor(a=>(e.mechanism&&(aP(a,void 0),mg(a,e.mechanism)),a.extra={...a.extra,arguments:i},a)),nT(s)}),s}};try{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}catch{}XX(r,t),Xo(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return t.name}})}catch{}return r}const co=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function KA(t,e){const n=WA(t,e),r={type:mEe(e),value:gEe(e)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function dEe(t,e,n,r){const i=en(),s=i&&i.getOptions().normalizeDepth,o=SEe(e),a={__serialized__:_J(e,s)};if(o)return{exception:{values:[KA(t,o)]},extra:a};const l={exception:{values:[{type:XC(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:_Ee(e,{isUnhandledRejection:r})}]},extra:a};if(n){const c=WA(t,n);c.length&&(l.exception.values[0].stacktrace={frames:c})}return l}function mk(t,e){return{exception:{values:[KA(t,e)]}}}function WA(t,e){const n=e.stacktrace||e.stack||"",r=hEe(e),i=pEe(e);try{return t(n,r,i)}catch{}return[]}const fEe=/Minified React error #\d+;/i;function hEe(t){return t&&fEe.test(t.message)?1:0}function pEe(t){return typeof t.framesToPop=="number"?t.framesToPop:0}function BJ(t){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?t instanceof WebAssembly.Exception:!1}function mEe(t){const e=t&&t.name;return!e&&BJ(t)?t.message&&Array.isArray(t.message)&&t.message.length==2?t.message[0]:"WebAssembly.Exception":e}function gEe(t){const e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:BJ(t)&&Array.isArray(t.message)&&t.message.length==2?t.message[1]:e:"No error message"}function vEe(t,e,n,r){const i=n&&n.syntheticException||void 0,s=zA(t,e,i,r);return mg(s),s.level="error",n&&n.event_id&&(s.event_id=n.event_id),kh(s)}function yEe(t,e,n="info",r,i){const s=r&&r.syntheticException||void 0,o=SP(t,e,s,i);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),kh(o)}function zA(t,e,n,r,i){let s;if(WX(e)&&e.error)return mk(t,e.error);if(_j(e)||obe(e)){const o=e;if("stack"in e)s=mk(t,e);else{const a=o.name||(_j(o)?"DOMError":"DOMException"),l=o.message?`${a}: ${o.message}`:a;s=SP(t,l,n,r),aP(s,l)}return"code"in o&&(s.tags={...s.tags,"DOMException.code":`${o.code}`}),s}return YC(e)?mk(t,e):pg(e)||XC(e)?(s=dEe(t,e,n,i),mg(s,{synthetic:!0}),s):(s=SP(t,e,n,r),aP(s,`${e}`),mg(s,{synthetic:!0}),s)}function SP(t,e,n,r){const i={};if(r&&n){const s=WA(t,n);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]}),mg(i,{synthetic:!0})}if(UA(e)){const{__sentry_template_string__:s,__sentry_template_values__:o}=e;return i.logentry={message:s,params:o},i}return i.message=e,i}function _Ee(t,{isUnhandledRejection:e}){const n=mbe(t),r=e?"promise rejection":"exception";return WX(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:XC(t)?`Event \`${bEe(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function bEe(t){try{const e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch{}}function SEe(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];if(n instanceof Error)return n}}function EEe(t,{metadata:e,tunnel:n,dsn:r}){const i={event_id:t.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!n&&!!r&&{dsn:Qg(r)}},s=wEe(t);return ev(i,[s])}function wEe(t){return[{type:"user_report"},t]}class CEe extends l2e{constructor(e){const n={parentSpanIsAlwaysRootSpan:!0,...e},r=ot.SENTRY_SDK_SOURCE||lEe();AJ(n,"browser",["browser"],r),super(n),n.sendClientReports&&ot.document&&ot.document.addEventListener("visibilitychange",()=>{ot.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,n){return vEe(this._options.stackParser,e,n,this._options.attachStacktrace)}eventFromMessage(e,n="info",r){return yEe(this._options.stackParser,e,n,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){co&&Oe.warn("SDK not enabled, will not capture user feedback.");return}const n=EEe(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(n)}_prepareEvent(e,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,n,r)}}const YA=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,TEe=(t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good",tv=(t,e,n,r)=>{let i,s;return o=>{e.value>=0&&(o||r)&&(s=e.value-(i||0),(s||i===void 0)&&(i=e.value,e.delta=s,e.rating=TEe(e.value,n),t(e)))}},lt=Yt,REe=()=>`v4-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,a_=(t=!0)=>{const e=lt.performance&&lt.performance.getEntriesByType&&lt.performance.getEntriesByType("navigation")[0];if(!t||e&&e.responseStart>0&&e.responseStart<performance.now())return e},l_=()=>{const t=a_();return t&&t.activationStart||0},nv=(t,e)=>{const n=a_();let r="navigate";return n&&(lt.document&&lt.document.prerendering||l_()>0?r="prerender":lt.document&&lt.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:REe(),navigationType:r}},zh=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return r.observe(Object.assign({type:t,buffered:!0},n||{})),r}}catch{}},rv=t=>{const e=n=>{(n.type==="pagehide"||lt.document&&lt.document.visibilityState==="hidden")&&t(n)};lt.document&&(addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0))},rT=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let E1=-1;const IEe=()=>lt.document.visibilityState==="hidden"&&!lt.document.prerendering?0:1/0,pw=t=>{lt.document.visibilityState==="hidden"&&E1>-1&&(E1=t.type==="visibilitychange"?t.timeStamp:0,xEe())},kEe=()=>{addEventListener("visibilitychange",pw,!0),addEventListener("prerenderingchange",pw,!0)},xEe=()=>{removeEventListener("visibilitychange",pw,!0),removeEventListener("prerenderingchange",pw,!0)},iT=()=>(lt.document&&E1<0&&(E1=IEe(),kEe()),{get firstHiddenTime(){return E1}}),c_=t=>{lt.document&&lt.document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},PEe=[1800,3e3],LEe=(t,e={})=>{c_(()=>{const n=iT(),r=nv("FCP");let i;const o=zh("paint",a=>{a.forEach(l=>{l.name==="first-contentful-paint"&&(o.disconnect(),l.startTime<n.firstHiddenTime&&(r.value=Math.max(l.startTime-l_(),0),r.entries.push(l),i(!0)))})});o&&(i=tv(t,r,PEe,e.reportAllChanges))})},AEe=[.1,.25],OEe=(t,e={})=>{LEe(rT(()=>{const n=nv("CLS",0);let r,i=0,s=[];const o=l=>{l.forEach(c=>{if(!c.hadRecentInput){const u=s[0],f=s[s.length-1];i&&u&&f&&c.startTime-f.startTime<1e3&&c.startTime-u.startTime<5e3?(i+=c.value,s.push(c)):(i=c.value,s=[c])}}),i>n.value&&(n.value=i,n.entries=s,r())},a=zh("layout-shift",o);a&&(r=tv(t,n,AEe,e.reportAllChanges),rv(()=>{o(a.takeRecords()),r(!0)}),setTimeout(r,0))}))},MEe=[100,300],NEe=(t,e={})=>{c_(()=>{const n=iT(),r=nv("FID");let i;const s=l=>{l.startTime<n.firstHiddenTime&&(r.value=l.processingStart-l.startTime,r.entries.push(l),i(!0))},o=l=>{l.forEach(s)},a=zh("first-input",o);i=tv(t,r,MEe,e.reportAllChanges),a&&rv(rT(()=>{o(a.takeRecords()),a.disconnect()}))})};let HJ=0,gk=1/0,SS=0;const DEe=t=>{t.forEach(e=>{e.interactionId&&(gk=Math.min(gk,e.interactionId),SS=Math.max(SS,e.interactionId),HJ=SS?(SS-gk)/7+1:0)})};let EP;const FEe=()=>EP?HJ:performance.interactionCount||0,UEe=()=>{"interactionCount"in performance||EP||(EP=zh("event",DEe,{type:"event",buffered:!0,durationThreshold:0}))},wc=[],vk=new Map,jEe=40;let $Ee=0;const BEe=()=>FEe()-$Ee,HEe=()=>{const t=Math.min(wc.length-1,Math.floor(BEe()/50));return wc[t]},yk=10,VEe=[],GEe=t=>{if(VEe.forEach(r=>r(t)),!(t.interactionId||t.entryType==="first-input"))return;const e=wc[wc.length-1],n=vk.get(t.interactionId);if(n||wc.length<yk||e&&t.duration>e.latency){if(n)t.duration>n.latency?(n.entries=[t],n.latency=t.duration):t.duration===n.latency&&t.startTime===(n.entries[0]&&n.entries[0].startTime)&&n.entries.push(t);else{const r={id:t.interactionId,latency:t.duration,entries:[t]};vk.set(r.id,r),wc.push(r)}wc.sort((r,i)=>i.latency-r.latency),wc.length>yk&&wc.splice(yk).forEach(r=>vk.delete(r.id))}},VJ=t=>{const e=lt.requestIdleCallback||lt.setTimeout;let n=-1;return t=rT(t),lt.document&&lt.document.visibilityState==="hidden"?t():(n=e(t),rv(t)),n},qEe=[200,500],KEe=(t,e={})=>{"PerformanceEventTiming"in lt&&"interactionId"in PerformanceEventTiming.prototype&&c_(()=>{UEe();const n=nv("INP");let r;const i=o=>{VJ(()=>{o.forEach(GEe);const a=HEe();a&&a.latency!==n.value&&(n.value=a.latency,n.entries=a.entries,r())})},s=zh("event",i,{durationThreshold:e.durationThreshold!=null?e.durationThreshold:jEe});r=tv(t,n,qEe,e.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),rv(()=>{i(s.takeRecords()),r(!0)}))})},WEe=[2500,4e3],e$={},zEe=(t,e={})=>{c_(()=>{const n=iT(),r=nv("LCP");let i;const s=a=>{e.reportAllChanges||(a=a.slice(-1)),a.forEach(l=>{l.startTime<n.firstHiddenTime&&(r.value=Math.max(l.startTime-l_(),0),r.entries=[l],i())})},o=zh("largest-contentful-paint",s);if(o){i=tv(t,r,WEe,e.reportAllChanges);const a=rT(()=>{e$[r.id]||(s(o.takeRecords()),o.disconnect(),e$[r.id]=!0,i(!0))});["keydown","click"].forEach(l=>{lt.document&&addEventListener(l,()=>VJ(a),{once:!0,capture:!0})}),rv(a)}})},YEe=[800,1800],wP=t=>{lt.document&&lt.document.prerendering?c_(()=>wP(t)):lt.document&&lt.document.readyState!=="complete"?addEventListener("load",()=>wP(t),!0):setTimeout(t,0)},XEe=(t,e={})=>{const n=nv("TTFB"),r=tv(t,n,YEe,e.reportAllChanges);wP(()=>{const i=a_();i&&(n.value=Math.max(i.responseStart-l_(),0),n.entries=[i],r(!0))})},w1={},mw={};let GJ,qJ,KJ,WJ,zJ;function YJ(t,e=!1){return u_("cls",t,twe,GJ,e)}function JEe(t,e=!1){return u_("lcp",t,rwe,KJ,e)}function ZEe(t){return u_("fid",t,nwe,qJ)}function QEe(t){return u_("ttfb",t,iwe,WJ)}function ewe(t){return u_("inp",t,swe,zJ)}function cy(t,e){return XJ(t,e),mw[t]||(owe(t),mw[t]=!0),JJ(t,e)}function iv(t,e){const n=w1[t];if(!(!n||!n.length))for(const r of n)try{r(e)}catch(i){YA&&Oe.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${su(r)}
Error:`,i)}}function twe(){return OEe(t=>{iv("cls",{metric:t}),GJ=t},{reportAllChanges:!0})}function nwe(){return NEe(t=>{iv("fid",{metric:t}),qJ=t})}function rwe(){return zEe(t=>{iv("lcp",{metric:t}),KJ=t},{reportAllChanges:!0})}function iwe(){return XEe(t=>{iv("ttfb",{metric:t}),WJ=t})}function swe(){return KEe(t=>{iv("inp",{metric:t}),zJ=t})}function u_(t,e,n,r,i=!1){XJ(t,e);let s;return mw[t]||(s=n(),mw[t]=!0),r&&e({metric:r}),JJ(t,e,i?s:void 0)}function owe(t){const e={};t==="event"&&(e.durationThreshold=0),zh(t,n=>{iv(t,{entries:n})},e)}function XJ(t,e){w1[t]=w1[t]||[],w1[t].push(e)}function JJ(t,e,n){return()=>{n&&n();const r=w1[t];if(!r)return;const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}function awe(t){return"duration"in t}function _k(t){return typeof t=="number"&&isFinite(t)}function lu(t,e,n,{...r}){const i=Qt(t).start_timestamp;return i&&i>e&&typeof t.updateStartTime=="function"&&t.updateStartTime(e),EJ(t,()=>{const s=o_({startTime:e,...r});return s&&s.end(n),s})}function ZJ(t){const e=en();if(!e)return;const{name:n,transaction:r,attributes:i,startTime:s}=t,{release:o,environment:a}=e.getOptions(),l=e.getIntegrationByName("Replay"),c=l&&l.getReplayId(),u=En(),f=u.getUser(),p=f!==void 0?f.email||f.id||f.ip_address:void 0;let m;try{m=u.getScopeData().contexts.profile.profile_id}catch{}const v={release:o,environment:a,user:p||void 0,profile_id:m||void 0,replay_id:c||void 0,transaction:r,"user_agent.original":lt.navigator&&lt.navigator.userAgent,...i};return o_({name:n,attributes:v,startTime:s,experimental:{standalone:!0}})}function XA(){return lt&&lt.addEventListener&&lt.performance}function _r(t){return t/1e3}function QJ(t){let e="unknown",n="unknown",r="";for(const i of t){if(i==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(i))){e=r==="h"?"http":r,n=t.split(r)[1];break}r+=i}return r===t&&(e=r),{name:e,version:n}}function lwe(){let t=0,e,n;if(!uwe())return;let r=!1;function i(){r||(r=!0,n&&cwe(t,e,n),s())}const s=YJ(({metric:o})=>{const a=o.entries[o.entries.length-1];a&&(t=o.value,e=a)},!0);rv(()=>{i()}),setTimeout(()=>{const o=en();if(!o)return;const a=o.on("startNavigationSpan",()=>{i(),a&&a()}),l=xi(),c=l&&Ii(l),u=c&&Qt(c);u&&u.op==="pageload"&&(n=c.spanContext().spanId)},0)}function cwe(t,e,n){YA&&Oe.log(`Sending CLS span (${t})`);const r=_r((Ds||0)+(e&&e.startTime||0)),i=En().getScopeData().transactionName,s=e?Ih(e.sources[0]&&e.sources[0].node):"Layout shift",o=Ti({[Dr]:"auto.http.browser.cls",[au]:"ui.webvital.cls",[HA]:e&&e.duration||0,"sentry.pageload.span_id":n}),a=ZJ({name:s,transaction:i,attributes:o,startTime:r});a&&(a.addEvent("cls",{[eT]:"",[tT]:t}),a.end(r))}function uwe(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const dwe=2147483647;let t$=0,bi={},_s,C1;function fwe({recordClsStandaloneSpans:t}){const e=XA();if(e&&Ds){e.mark&&lt.performance.mark("sentry-tracing-init");const n=ywe(),r=vwe(),i=_we(),s=t?lwe():gwe();return()=>{n(),r(),i(),s&&s()}}return()=>{}}function hwe(){cy("longtask",({entries:t})=>{const e=xi();if(!e)return;const{op:n,start_timestamp:r}=Qt(e);for(const i of t){const s=_r(Ds+i.startTime),o=_r(i.duration);n==="navigation"&&r&&s<r||lu(e,s,s+o,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[Dr]:"auto.ui.browser.metrics"}})}})}function pwe(){new PerformanceObserver(e=>{const n=xi();if(n)for(const r of e.getEntries()){if(!r.scripts[0])continue;const i=_r(Ds+r.startTime),{start_timestamp:s,op:o}=Qt(n);if(o==="navigation"&&s&&i<s)continue;const a=_r(r.duration),l={[Dr]:"auto.ui.browser.metrics"},c=r.scripts[0],{invoker:u,invokerType:f,sourceURL:p,sourceFunctionName:m,sourceCharPosition:v}=c;l["browser.script.invoker"]=u,l["browser.script.invoker_type"]=f,p&&(l["code.filepath"]=p),m&&(l["code.function"]=m),v!==-1&&(l["browser.script.source_char_position"]=v),lu(n,i,i+a,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:l})}}).observe({type:"long-animation-frame",buffered:!0})}function mwe(){cy("event",({entries:t})=>{const e=xi();if(e){for(const n of t)if(n.name==="click"){const r=_r(Ds+n.startTime),i=_r(n.duration),s={name:Ih(n.target),op:`ui.interaction.${n.name}`,startTime:r,attributes:{[Dr]:"auto.ui.browser.metrics"}},o=YX(n.target);o&&(s.attributes["ui.component_name"]=o),lu(e,r,r+i,s)}}})}function gwe(){return YJ(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(bi.cls={value:t.value,unit:""},C1=e)},!0)}function vwe(){return JEe(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(bi.lcp={value:t.value,unit:"millisecond"},_s=e)},!0)}function ywe(){return ZEe(({metric:t})=>{const e=t.entries[t.entries.length-1];if(!e)return;const n=_r(Ds),r=_r(e.startTime);bi.fid={value:t.value,unit:"millisecond"},bi["mark.fid"]={value:n+r,unit:"second"}})}function _we(){return QEe(({metric:t})=>{t.entries[t.entries.length-1]&&(bi.ttfb={value:t.value,unit:"millisecond"})})}function bwe(t,e){const n=XA();if(!n||!n.getEntries||!Ds)return;const r=_r(Ds),i=n.getEntries(),{op:s,start_timestamp:o}=Qt(t);if(i.slice(t$).forEach(a=>{const l=_r(a.startTime),c=_r(Math.max(0,a.duration));if(!(s==="navigation"&&o&&r+l<o))switch(a.entryType){case"navigation":{Ewe(t,a,r);break}case"mark":case"paint":case"measure":{Swe(t,a,l,c,r);const u=iT(),f=a.startTime<u.firstHiddenTime;a.name==="first-paint"&&f&&(bi.fp={value:a.startTime,unit:"millisecond"}),a.name==="first-contentful-paint"&&f&&(bi.fcp={value:a.startTime,unit:"millisecond"});break}case"resource":{Twe(t,a,a.name,l,c,r);break}}}),t$=Math.max(i.length-1,0),Rwe(t),s==="pageload"){kwe(bi);const a=bi["mark.fid"];a&&bi.fid&&(lu(t,a.value,a.value+_r(bi.fid.value),{name:"first input delay",op:"ui.action",attributes:{[Dr]:"auto.ui.browser.metrics"}}),delete bi["mark.fid"]),(!("fcp"in bi)||!e.recordClsOnPageloadSpan)&&delete bi.cls,Object.entries(bi).forEach(([l,c])=>{_Se(l,c.value,c.unit)}),t.setAttribute("performance.timeOrigin",r),t.setAttribute("performance.activationStart",l_()),Iwe(t)}_s=void 0,C1=void 0,bi={}}function Swe(t,e,n,r,i){const s=a_(!1),o=_r(s?s.requestStart:0),a=i+Math.max(n,o),l=i+n,c=l+r,u={[Dr]:"auto.resource.browser.metrics"};return a!==l&&(u["sentry.browser.measure_happened_before_request"]=!0,u["sentry.browser.measure_start_time"]=a),lu(t,a,c,{name:e.name,op:e.entryType,attributes:u}),a}function Ewe(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{ES(t,e,r,n)}),ES(t,e,"secureConnection",n,"TLS/SSL"),ES(t,e,"fetch",n,"cache"),ES(t,e,"domainLookup",n,"DNS"),Cwe(t,e,n)}function ES(t,e,n,r,i=n){const s=wwe(n),o=e[s],a=e[`${n}Start`];!a||!o||lu(t,r+_r(a),r+_r(o),{op:`browser.${i}`,name:e.name,attributes:{[Dr]:"auto.ui.browser.metrics"}})}function wwe(t){return t==="secureConnection"?"connectEnd":t==="fetch"?"domainLookupStart":`${t}End`}function Cwe(t,e,n){const r=n+_r(e.requestStart),i=n+_r(e.responseEnd),s=n+_r(e.responseStart);e.responseEnd&&(lu(t,r,i,{op:"browser.request",name:e.name,attributes:{[Dr]:"auto.ui.browser.metrics"}}),lu(t,s,i,{op:"browser.response",name:e.name,attributes:{[Dr]:"auto.ui.browser.metrics"}}))}function Twe(t,e,n,r,i,s){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const o=gh(n),a={[Dr]:"auto.resource.browser.metrics"};bk(a,e,"transferSize","http.response_transfer_size"),bk(a,e,"encodedBodySize","http.response_content_length"),bk(a,e,"decodedBodySize","http.decoded_response_content_length");const l=e.deliveryType;l!=null&&(a["http.response_delivery_type"]=l);const c=e.renderBlockingStatus;c&&(a["resource.render_blocking_status"]=c),o.protocol&&(a["url.scheme"]=o.protocol.split(":").pop()),o.host&&(a["server.address"]=o.host),a["url.same_origin"]=n.includes(lt.location.origin);const{name:u,version:f}=QJ(e.nextHopProtocol);a["network.protocol.name"]=u,a["network.protocol.version"]=f;const p=s+r,m=p+i;lu(t,p,m,{name:n.replace(lt.location.origin,""),op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",attributes:a})}function Rwe(t){const e=lt.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&t.setAttribute("connectionType",n.type),_k(n.rtt)&&(bi["connection.rtt"]={value:n.rtt,unit:"millisecond"})),_k(e.deviceMemory)&&t.setAttribute("deviceMemory",`${e.deviceMemory} GB`),_k(e.hardwareConcurrency)&&t.setAttribute("hardwareConcurrency",String(e.hardwareConcurrency))}function Iwe(t){_s&&(_s.element&&t.setAttribute("lcp.element",Ih(_s.element)),_s.id&&t.setAttribute("lcp.id",_s.id),_s.url&&t.setAttribute("lcp.url",_s.url.trim().slice(0,200)),_s.loadTime!=null&&t.setAttribute("lcp.loadTime",_s.loadTime),_s.renderTime!=null&&t.setAttribute("lcp.renderTime",_s.renderTime),t.setAttribute("lcp.size",_s.size)),C1&&C1.sources&&C1.sources.forEach((e,n)=>t.setAttribute(`cls.source.${n+1}`,Ih(e.node)))}function bk(t,e,n,r){const i=e[n];i!=null&&i<dwe&&(t[r]=i)}function kwe(t){const e=a_(!1);if(!e)return;const{responseStart:n,requestStart:r}=e;r<=n&&(t["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const xwe=1e3;let n$,CP,TP;function Pwe(t){const e="dom";of(e,t),af(e,Lwe)}function Lwe(){if(!lt.document)return;const t=Go.bind(null,"dom"),e=r$(t,!0);lt.document.addEventListener("click",e,!1),lt.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{const i=lt[n],s=i&&i.prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(ao(s,"addEventListener",function(o){return function(a,l,c){if(a==="click"||a=="keypress")try{const u=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},f=u[a]=u[a]||{refCount:0};if(!f.handler){const p=r$(t);f.handler=p,o.call(this,a,p,c)}f.refCount++}catch{}return o.call(this,a,l,c)}}),ao(s,"removeEventListener",function(o){return function(a,l,c){if(a==="click"||a=="keypress")try{const u=this.__sentry_instrumentation_handlers__||{},f=u[a];f&&(f.refCount--,f.refCount<=0&&(o.call(this,a,f.handler,c),f.handler=void 0,delete u[a]),Object.keys(u).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return o.call(this,a,l,c)}}))})}function Awe(t){if(t.type!==CP)return!1;try{if(!t.target||t.target._sentryId!==TP)return!1}catch{}return!0}function Owe(t,e){return t!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function r$(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const r=Mwe(n);if(Owe(n.type,r))return;Xo(n,"_sentryCaptured",!0),r&&!r._sentryId&&Xo(r,"_sentryId",qo());const i=n.type==="keypress"?"input":n.type;Awe(n)||(t({event:n,name:i,global:e}),CP=n.type,TP=r?r._sentryId:void 0),clearTimeout(n$),n$=lt.setTimeout(()=>{TP=void 0,CP=void 0},xwe)}}function Mwe(t){try{return t.target}catch{return null}}let wS;function JA(t){const e="history";of(e,t),af(e,Nwe)}function Nwe(){if(!cEe())return;const t=lt.onpopstate;lt.onpopstate=function(...n){const r=lt.location.href,i=wS;if(wS=r,Go("history",{from:i,to:r}),t)try{return t.apply(this,n)}catch{}};function e(n){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const s=wS,o=String(i);wS=o,Go("history",{from:s,to:o})}return n.apply(this,r)}}ao(lt.history,"pushState",e),ao(lt.history,"replaceState",e)}const J2={};function Dwe(t){const e=J2[t];if(e)return e;let n=lt[t];if(yP(n))return J2[t]=n.bind(lt);const r=lt.document;if(r&&typeof r.createElement=="function")try{const i=r.createElement("iframe");i.hidden=!0,r.head.appendChild(i);const s=i.contentWindow;s&&s[t]&&(n=s[t]),r.head.removeChild(i)}catch(i){YA&&Oe.warn(`Could not create sandbox iframe for ${t} check, bailing to window.${t}: `,i)}return n&&(J2[t]=n.bind(lt))}function i$(t){J2[t]=void 0}const mm="__sentry_xhr_v3__";function eZ(t){const e="xhr";of(e,t),af(e,Fwe)}function Fwe(){if(!lt.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(e,n,r){const i=new Error,s=rs()*1e3,o=Gc(r[0])?r[0].toUpperCase():void 0,a=Uwe(r[1]);if(!o||!a)return e.apply(n,r);n[mm]={method:o,url:a,request_headers:{}},o==="POST"&&a.match(/sentry_key/)&&(n.__sentry_own_request__=!0);const l=()=>{const c=n[mm];if(c&&n.readyState===4){try{c.status_code=n.status}catch{}const u={endTimestamp:rs()*1e3,startTimestamp:s,xhr:n,virtualError:i};Go("xhr",u)}};return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?n.onreadystatechange=new Proxy(n.onreadystatechange,{apply(c,u,f){return l(),c.apply(u,f)}}):n.addEventListener("readystatechange",l),n.setRequestHeader=new Proxy(n.setRequestHeader,{apply(c,u,f){const[p,m]=f,v=u[mm];return v&&Gc(p)&&Gc(m)&&(v.request_headers[p.toLowerCase()]=m),c.apply(u,f)}}),e.apply(n,r)}}),t.send=new Proxy(t.send,{apply(e,n,r){const i=n[mm];if(!i)return e.apply(n,r);r[0]!==void 0&&(i.body=r[0]);const s={startTimestamp:rs()*1e3,xhr:n};return Go("xhr",s),e.apply(n,r)}})}function Uwe(t){if(Gc(t))return t;try{return t.toString()}catch{}}const Sk=[],Z2=new Map;function jwe(){if(XA()&&Ds){const e=$we();return()=>{e()}}return()=>{}}const s$={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function $we(){return ewe(({metric:t})=>{if(t.value==null)return;const e=t.entries.find(v=>v.duration===t.value&&s$[v.name]);if(!e)return;const{interactionId:n}=e,r=s$[e.name],i=_r(Ds+e.startTime),s=_r(t.value),o=xi(),a=o?Ii(o):void 0,c=(n!=null?Z2.get(n):void 0)||a,u=c?Qt(c).description:En().getScopeData().transactionName,f=Ih(e.target),p=Ti({[Dr]:"auto.http.browser.inp",[au]:`ui.interaction.${r}`,[HA]:e.duration}),m=ZJ({name:f,transaction:u,attributes:p,startTime:i});m&&(m.addEvent("inp",{[eT]:"millisecond",[tT]:t.value}),m.end(i+s))})}function Bwe(t){const e=({entries:n})=>{const r=xi(),i=r&&Ii(r);n.forEach(s=>{if(!awe(s)||!i)return;const o=s.interactionId;if(o!=null&&!Z2.has(o)){if(Sk.length>10){const a=Sk.shift();Z2.delete(a)}Sk.push(o),Z2.set(o,i)}})};cy("event",e),cy("first-input",e)}function Hwe(t,e=Dwe("fetch")){let n=0,r=0;function i(s){const o=s.body.length;n+=o,r++;const a={body:s.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};if(!e)return i$("fetch"),dw("No fetch implementation available");try{return e(t.url,a).then(l=>(n-=o,r--,{statusCode:l.status,headers:{"x-sentry-rate-limits":l.headers.get("X-Sentry-Rate-Limits"),"retry-after":l.headers.get("Retry-After")}}))}catch(l){return i$("fetch"),n-=o,r--,dw(l)}}return b2e(t,i)}const Vwe=30,Gwe=50;function RP(t,e,n,r){const i={filename:t,function:e==="<anonymous>"?Rh:e,in_app:!0};return n!==void 0&&(i.lineno=n),r!==void 0&&(i.colno=r),i}const qwe=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Kwe=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Wwe=/\((\S*)(?::(\d+))(?::(\d+))\)/,zwe=t=>{const e=qwe.exec(t);if(e){const[,r,i,s]=e;return RP(r,Rh,+i,+s)}const n=Kwe.exec(t);if(n){if(n[2]&&n[2].indexOf("eval")===0){const o=Wwe.exec(n[2]);o&&(n[2]=o[1],n[3]=o[2],n[4]=o[3])}const[i,s]=tZ(n[1]||Rh,n[2]);return RP(s,i,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},Ywe=[Vwe,zwe],Xwe=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Jwe=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Zwe=t=>{const e=Xwe.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const s=Jwe.exec(e[3]);s&&(e[1]=e[1]||"eval",e[3]=s[1],e[4]=s[2],e[5]="")}let r=e[3],i=e[1]||Rh;return[i,r]=tZ(i,r),RP(r,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},Qwe=[Gwe,Zwe],eCe=[Ywe,Qwe],tCe=VX(...eCe),tZ=(t,e)=>{const n=t.indexOf("safari-extension")!==-1,r=t.indexOf("safari-web-extension")!==-1;return n||r?[t.indexOf("@")!==-1?t.split("@")[0]:Rh,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},CS=1024,nCe="Breadcrumbs",rCe=(t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:nCe,setup(n){e.console&&H2e(aCe(n)),e.dom&&Pwe(oCe(n,e.dom)),e.xhr&&eZ(lCe(n)),e.fetch&&UJ(cCe(n)),e.history&&JA(uCe(n)),e.sentry&&n.on("beforeSendEvent",sCe(n))}}},iCe=rCe;function sCe(t){return function(n){en()===t&&xh({category:`sentry.${n.type==="transaction"?"transaction":"event"}`,event_id:n.event_id,level:n.level,message:sd(n)},{event:n})}}function oCe(t,e){return function(r){if(en()!==t)return;let i,s,o=typeof e=="object"?e.serializeAttribute:void 0,a=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;a&&a>CS&&(co&&Oe.warn(`\`dom.maxStringLength\` cannot exceed ${CS}, but a value of ${a} was configured. Sentry will use ${CS} instead.`),a=CS),typeof o=="string"&&(o=[o]);try{const c=r.event,u=dCe(c)?c.target:c;i=Ih(u,{keyAttrs:o,maxStringLength:a}),s=YX(u)}catch{i="<unknown>"}if(i.length===0)return;const l={category:`ui.${r.name}`,message:i};s&&(l.data={"ui.component_name":s}),xh(l,{event:r.event,name:r.name,global:r.global})}}function aCe(t){return function(n){if(en()!==t)return;const r={category:"console",data:{arguments:n.args,logger:"console"},level:G2e(n.level),message:bj(n.args," ")};if(n.level==="assert")if(n.args[0]===!1)r.message=`Assertion failed: ${bj(n.args.slice(1)," ")||"console.assert"}`,r.data.arguments=n.args.slice(1);else return;xh(r,{input:n.args,level:n.level})}}function lCe(t){return function(n){if(en()!==t)return;const{startTimestamp:r,endTimestamp:i}=n,s=n.xhr[mm];if(!r||!i||!s)return;const{method:o,url:a,status_code:l,body:c}=s,u={method:o,url:a,status_code:l},f={xhr:n.xhr,input:c,startTimestamp:r,endTimestamp:i},p=DJ(l);xh({category:"xhr",data:u,type:"http",level:p},f)}}function cCe(t){return function(n){if(en()!==t)return;const{startTimestamp:r,endTimestamp:i}=n;if(i&&!(n.fetchData.url.match(/sentry_key/)&&n.fetchData.method==="POST"))if(n.error){const s=n.fetchData,o={data:n.error,input:n.args,startTimestamp:r,endTimestamp:i};xh({category:"fetch",data:s,level:"error",type:"http"},o)}else{const s=n.response,o={...n.fetchData,status_code:s&&s.status},a={input:n.args,response:s,startTimestamp:r,endTimestamp:i},l=DJ(o.status_code);xh({category:"fetch",data:o,type:"http",level:l},a)}}}function uCe(t){return function(n){if(en()!==t)return;let r=n.from,i=n.to;const s=gh(ot.location.href);let o=r?gh(r):void 0;const a=gh(i);(!o||!o.path)&&(o=s),s.protocol===a.protocol&&s.host===a.host&&(i=a.relative),s.protocol===o.protocol&&s.host===o.host&&(r=o.relative),xh({category:"navigation",data:{from:r,to:i}})}}function dCe(t){return!!t&&!!t.target}const fCe=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],hCe="BrowserApiErrors",pCe=(t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:hCe,setupOnce(){e.setTimeout&&ao(ot,"setTimeout",o$),e.setInterval&&ao(ot,"setInterval",o$),e.requestAnimationFrame&&ao(ot,"requestAnimationFrame",gCe),e.XMLHttpRequest&&"XMLHttpRequest"in ot&&ao(XMLHttpRequest.prototype,"send",vCe);const n=e.eventTarget;n&&(Array.isArray(n)?n:fCe).forEach(yCe)}}},mCe=pCe;function o$(t){return function(...e){const n=e[0];return e[0]=yg(n,{mechanism:{data:{function:su(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function gCe(t){return function(e){return t.apply(this,[yg(e,{mechanism:{data:{function:"requestAnimationFrame",handler:su(t)},handled:!1,type:"instrument"}})])}}function vCe(t){return function(...e){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(i=>{i in n&&typeof n[i]=="function"&&ao(n,i,function(s){const o={mechanism:{data:{function:i,handler:su(s)},handled:!1,type:"instrument"}},a=$A(s);return a&&(o.mechanism.data.handler=su(a)),yg(s,o)})}),t.apply(this,e)}}function yCe(t){const n=ot[t],r=n&&n.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(ao(r,"addEventListener",function(i){return function(s,o,a){try{_Ce(o)&&(o.handleEvent=yg(o.handleEvent,{mechanism:{data:{function:"handleEvent",handler:su(o),target:t},handled:!1,type:"instrument"}}))}catch{}return i.apply(this,[s,yg(o,{mechanism:{data:{function:"addEventListener",handler:su(o),target:t},handled:!1,type:"instrument"}}),a])}}),ao(r,"removeEventListener",function(i){return function(s,o,a){try{const l=o.__sentry_wrapped__;l&&i.call(this,s,l,a)}catch{}return i.call(this,s,o,a)}}))}function _Ce(t){return typeof t.handleEvent=="function"}const bCe=()=>({name:"BrowserSession",setupOnce(){if(typeof ot.document>"u"){co&&Oe.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.");return}Bj({ignoreDuration:!0}),Hj(),JA(({from:t,to:e})=>{t!==void 0&&t!==e&&(Bj({ignoreDuration:!0}),Hj())})}}),SCe="GlobalHandlers",ECe=(t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:SCe,setupOnce(){Error.stackTraceLimit=50},setup(n){e.onerror&&(CCe(n),a$("onerror")),e.onunhandledrejection&&(TCe(n),a$("onunhandledrejection"))}}},wCe=ECe;function CCe(t){GX(e=>{const{stackParser:n,attachStacktrace:r}=nZ();if(en()!==t||$J())return;const{msg:i,url:s,line:o,column:a,error:l}=e,c=kCe(zA(n,l||i,void 0,r,!1),s,o,a);c.level="error",TJ(c,{originalException:l,mechanism:{handled:!1,type:"onerror"}})})}function TCe(t){qX(e=>{const{stackParser:n,attachStacktrace:r}=nZ();if(en()!==t||$J())return;const i=RCe(e),s=jA(i)?ICe(i):zA(n,i,void 0,r,!0);s.level="error",TJ(s,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function RCe(t){if(jA(t))return t;try{if("reason"in t)return t.reason;if("detail"in t&&"reason"in t.detail)return t.detail.reason}catch{}return t}function ICe(t){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(t)}`}]}}}function kCe(t,e,n,r){const i=t.exception=t.exception||{},s=i.values=i.values||[],o=s[0]=s[0]||{},a=o.stacktrace=o.stacktrace||{},l=a.frames=a.frames||[],c=r,u=n,f=Gc(e)&&e.length>0?e:fbe();return l.length===0&&l.push({colno:c,filename:f,function:Rh,in_app:!0,lineno:u}),t}function a$(t){co&&Oe.log(`Global Handler attached: ${t}`)}function nZ(){const t=en();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const xCe=()=>({name:"HttpContext",preprocessEvent(t){if(!ot.navigator&&!ot.location&&!ot.document)return;const e=t.request&&t.request.url||ot.location&&ot.location.href,{referrer:n}=ot.document||{},{userAgent:r}=ot.navigator||{},i={...t.request&&t.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},s={...t.request,...e&&{url:e},headers:i};t.request=s}}),PCe="cause",LCe=5,ACe="LinkedErrors",OCe=(t={})=>{const e=t.limit||LCe,n=t.key||PCe;return{name:ACe,preprocessEvent(r,i,s){const o=s.getOptions();$2e(KA,o.stackParser,o.maxValueLength,n,e,r,i)}}},MCe=OCe;function NCe(t){const e=[x2e(),T2e(),mCe(),iCe(),wCe(),MCe(),W2e(),xCe()];return t.autoSessionTracking!==!1&&e.push(bCe()),e}function DCe(t={}){const e={defaultIntegrations:NCe(t),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:ot.SENTRY_RELEASE&&ot.SENTRY_RELEASE.id?ot.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return t.defaultIntegrations==null&&delete t.defaultIntegrations,{...e,...t}}function FCe(){const t=typeof ot.window<"u"&&ot;if(!t)return!1;const e=t.chrome?"chrome":"browser",n=t[e],r=n&&n.runtime&&n.runtime.id,i=ot.location&&ot.location.href||"",s=["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"],o=!!r&&ot===ot.top&&s.some(l=>i.startsWith(`${l}//`)),a=typeof t.nw<"u";return!!r&&!o&&!a}function UCe(t={}){const e=DCe(t);if(!e.skipBrowserExtensionCheck&&FCe()){qh(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}co&&(FJ()||Oe.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...e,stackParser:nbe(e.stackParser||tCe),integrations:s2e(e),transport:e.transport||Hwe};return d2e(CEe,n)}function l$(t={}){if(!ot.document){co&&Oe.error("Global document not defined in showReportDialog call");return}const e=En(),n=e.getClient(),r=n&&n.getDsn();if(!r){co&&Oe.error("DSN not configured for showReportDialog call");return}if(e&&(t.user={...e.getUser(),...t.user}),!t.eventId){const a=JSe();a&&(t.eventId=a)}const i=ot.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=r2e(r,t),t.onLoad&&(i.onload=t.onLoad);const{onClose:s}=t;if(s){const a=l=>{if(l.data==="__sentry_reportdialog_closed__")try{s()}finally{ot.removeEventListener("message",a)}};ot.addEventListener("message",a)}const o=ot.document.head||ot.document.body;o?o.appendChild(i):co&&Oe.error("Not injecting report dialog. No injection point found in HTML")}const c$=new WeakMap,Ek=new Map,Q2={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function jCe(t,e){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:s,enableHTTPTimings:o,tracePropagationTargets:a}={traceFetch:Q2.traceFetch,traceXHR:Q2.traceXHR,trackFetchStreamPerformance:Q2.trackFetchStreamPerformance,...e},l=typeof s=="function"?s:f=>!0,c=f=>HCe(f,a),u={};n&&(t.addEventProcessor(f=>(f.type==="transaction"&&f.spans&&f.spans.forEach(p=>{if(p.op==="http.client"){const m=Ek.get(p.span_id);m&&(p.timestamp=m/1e3,Ek.delete(p.span_id))}}),f)),i&&iEe(f=>{if(f.response){const p=c$.get(f.response);p&&f.endTimestamp&&Ek.set(p,f.endTimestamp)}}),UJ(f=>{const p=J2e(f,l,c,u);if(f.response&&f.fetchData.__span&&c$.set(f.response,f.fetchData.__span),p){const m=rZ(f.fetchData.url),v=m?gh(m).host:void 0;p.setAttributes({"http.url":m,"server.address":v})}o&&p&&u$(p)})),r&&eZ(f=>{const p=VCe(f,l,c,u);o&&p&&u$(p)})}function $Ce(t){return t.entryType==="resource"&&"initiatorType"in t&&typeof t.nextHopProtocol=="string"&&(t.initiatorType==="fetch"||t.initiatorType==="xmlhttprequest")}function u$(t){const{url:e}=Qt(t).data||{};if(!e||typeof e!="string")return;const n=cy("resource",({entries:r})=>{r.forEach(i=>{$Ce(i)&&i.name.endsWith(e)&&(BCe(i).forEach(o=>t.setAttribute(...o)),setTimeout(n))})})}function dl(t=0){return((Ds||performance.timeOrigin)+t)/1e3}function BCe(t){const{name:e,version:n}=QJ(t.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",e]),Ds?[...r,["http.request.redirect_start",dl(t.redirectStart)],["http.request.fetch_start",dl(t.fetchStart)],["http.request.domain_lookup_start",dl(t.domainLookupStart)],["http.request.domain_lookup_end",dl(t.domainLookupEnd)],["http.request.connect_start",dl(t.connectStart)],["http.request.secure_connection_start",dl(t.secureConnectionStart)],["http.request.connection_end",dl(t.connectEnd)],["http.request.request_start",dl(t.requestStart)],["http.request.response_start",dl(t.responseStart)],["http.request.response_end",dl(t.responseEnd)]]:r}function HCe(t,e){const n=ot.location&&ot.location.href;if(n){let r,i;try{r=new URL(t,n),i=new URL(n).origin}catch{return!1}const s=r.origin===i;return e?hh(r.toString(),e)||s&&hh(r.pathname,e):s}else{const r=!!t.match(/^\/(?!\/)/);return e?hh(t,e):r}}function VCe(t,e,n,r){const i=t.xhr,s=i&&i[mm];if(!i||i.__sentry_own_request__||!s)return;const o=Gd()&&e(s.url);if(t.endTimestamp&&o){const f=i.__sentry_xhr_span_id__;if(!f)return;const p=r[f];p&&s.status_code!==void 0&&(nJ(p,s.status_code),p.end(),delete r[f]);return}const a=rZ(s.url),l=a?gh(a).host:void 0,c=!!xi(),u=o&&c?o_({name:`${s.method} ${s.url}`,attributes:{type:"xhr","http.method":s.method,"http.url":a,url:s.url,"server.address":l,[Dr]:"auto.http.browser",[au]:"http.client"}}):new Jg;return i.__sentry_xhr_span_id__=u.spanContext().spanId,r[i.__sentry_xhr_span_id__]=u,n(s.url)&&GCe(i,Gd()&&c?u:void 0),u}function GCe(t,e){const{"sentry-trace":n,baggage:r}=OJ({span:e});n&&qCe(t,n,r)}function qCe(t,e,n){try{t.setRequestHeader("sentry-trace",e),n&&t.setRequestHeader("baggage",n)}catch{}}function rZ(t){try{return new URL(t,ot.location.origin).href}catch{return}}function KCe(){ot&&ot.document?ot.document.addEventListener("visibilitychange",()=>{const t=xi();if(!t)return;const e=Ii(t);if(ot.document.hidden&&e){const n="cancelled",{op:r,status:i}=Qt(e);co&&Oe.log(`[Tracing] Transaction: ${n} -> since tab moved to the background, op: ${r}`),i||e.setStatus({code:oi,message:n}),e.setAttribute("sentry.cancellation_reason","document.hidden"),e.end()}}):co&&Oe.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const WCe="BrowserTracing",zCe={...X2,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...Q2},YCe=(t={})=>{zbe();const{enableInp:e,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:s},beforeStartSpan:o,idleTimeout:a,finalTimeout:l,childSpanTimeout:c,markBackgroundSpan:u,traceFetch:f,traceXHR:p,trackFetchStreamPerformance:m,shouldCreateSpanForRequest:v,enableHTTPTimings:g,instrumentPageLoad:S,instrumentNavigation:b}={...zCe,...t},w=fwe({recordClsStandaloneSpans:s||!1});e&&jwe(),r&&Yt.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?pwe():n&&hwe(),i&&mwe();const k={name:void 0,source:void 0};function T(I,C){const x=C.op==="pageload",A=o?o(C):C,N=A.attributes||{};C.name!==A.name&&(N[$o]="custom",A.attributes=N),k.name=A.name,k.source=N[$o];const D=CJ(A,{idleTimeout:a,finalTimeout:l,childSpanTimeout:c,disableAutoFinish:x,beforeSpanEnd:$=>{w(),bwe($,{recordClsOnPageloadSpan:!s})}});function F(){["interactive","complete"].includes(ot.document.readyState)&&I.emit("idleSpanEnableAutoFinish",D)}return x&&ot.document&&(ot.document.addEventListener("readystatechange",()=>{F()}),F()),D}return{name:WCe,afterAllSetup(I){let C,x=ot.location&&ot.location.href;function A(){C&&!Qt(C).timestamp&&(co&&Oe.log(`[Tracing] Finishing current active span with op: ${Qt(C).op}`),C.end())}I.on("startNavigationSpan",N=>{en()===I&&(A(),C=T(I,{op:"navigation",...N}))}),I.on("startPageLoadSpan",(N,D={})=>{if(en()!==I)return;A();const F=D.sentryTrace||d$("sentry-trace"),$=D.baggage||d$("baggage"),B=Bbe(F,$);En().setPropagationContext(B),C=T(I,{op:"pageload",...N})}),I.on("spanEnd",N=>{const D=Qt(N).op;if(N!==Ii(N)||D!=="navigation"&&D!=="pageload")return;const F=En(),$=F.getPropagationContext();F.setPropagationContext({...$,sampled:$.sampled!==void 0?$.sampled:Wh(N),dsc:$.dsc||Zg(N)})}),ot.location&&(S&&iZ(I,{name:ot.location.pathname,startTime:Ds?Ds/1e3:void 0,attributes:{[$o]:"url",[Dr]:"auto.pageload.browser"}}),b&&JA(({to:N,from:D})=>{if(D===void 0&&x&&x.indexOf(N)!==-1){x=void 0;return}D!==N&&(x=void 0,sZ(I,{name:ot.location.pathname,attributes:{[$o]:"url",[Dr]:"auto.navigation.browser"}}))})),u&&KCe(),i&&XCe(a,l,c,k),e&&Bwe(),jCe(I,{traceFetch:f,traceXHR:p,trackFetchStreamPerformance:m,tracePropagationTargets:I.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:v,enableHTTPTimings:g})}}};function iZ(t,e,n){t.emit("startPageLoadSpan",e,n),En().setTransactionName(e.name);const r=xi();return(r&&Qt(r).op)==="pageload"?r:void 0}function sZ(t,e){Xl().setPropagationContext({traceId:Bd()}),En().setPropagationContext({traceId:Bd()}),t.emit("startNavigationSpan",e),En().setTransactionName(e.name);const n=xi();return(n&&Qt(n).op)==="navigation"?n:void 0}function d$(t){const e=hbe(`meta[name=${t}]`);return e?e.getAttribute("content"):void 0}function XCe(t,e,n,r){let i;const s=()=>{const o="ui.action.click",a=xi(),l=a&&Ii(a);if(l){const c=Qt(l).op;if(["navigation","pageload"].includes(c)){co&&Oe.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`);return}}if(i&&(i.setAttribute(uP,"interactionInterrupted"),i.end(),i=void 0),!r.name){co&&Oe.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}i=CJ({name:r.name,op:o,attributes:{[$o]:r.source||"url"}},{idleTimeout:t,finalTimeout:e,childSpanTimeout:n})};ot.document&&addEventListener("click",s,{once:!1,capture:!0})}function JCe(t){const e={...t};return AJ(e,"react"),XSe("react",{version:_.version}),UCe(e)}function ZCe(t){const e=t.match(/^([^.]+)/);return e!==null&&parseInt(e[0])>=17}function QCe(t,e){const n=new WeakSet;function r(i,s){if(!n.has(i)){if(i.cause)return n.add(i),r(i.cause,s);i.cause=s}}r(t,e)}function eTe(t,{componentStack:e},n){if(ZCe(_.version)&&YC(t)&&e){const r=new Error(t.message);r.name=`React ErrorBoundary ${t.name}`,r.stack=e,QCe(t,r)}return nT(t,{...n,captureContext:{contexts:{react:{componentStack:e}}}})}var wk={exports:{}},tn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$;function tTe(){if(f$)return tn;f$=1;var t=typeof Symbol=="function"&&Symbol.for,e=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,r=t?Symbol.for("react.fragment"):60107,i=t?Symbol.for("react.strict_mode"):60108,s=t?Symbol.for("react.profiler"):60114,o=t?Symbol.for("react.provider"):60109,a=t?Symbol.for("react.context"):60110,l=t?Symbol.for("react.async_mode"):60111,c=t?Symbol.for("react.concurrent_mode"):60111,u=t?Symbol.for("react.forward_ref"):60112,f=t?Symbol.for("react.suspense"):60113,p=t?Symbol.for("react.suspense_list"):60120,m=t?Symbol.for("react.memo"):60115,v=t?Symbol.for("react.lazy"):60116,g=t?Symbol.for("react.block"):60121,S=t?Symbol.for("react.fundamental"):60117,b=t?Symbol.for("react.responder"):60118,w=t?Symbol.for("react.scope"):60119;function k(I){if(typeof I=="object"&&I!==null){var C=I.$$typeof;switch(C){case e:switch(I=I.type,I){case l:case c:case r:case s:case i:case f:return I;default:switch(I=I&&I.$$typeof,I){case a:case u:case v:case m:case o:return I;default:return C}}case n:return C}}}function T(I){return k(I)===c}return tn.AsyncMode=l,tn.ConcurrentMode=c,tn.ContextConsumer=a,tn.ContextProvider=o,tn.Element=e,tn.ForwardRef=u,tn.Fragment=r,tn.Lazy=v,tn.Memo=m,tn.Portal=n,tn.Profiler=s,tn.StrictMode=i,tn.Suspense=f,tn.isAsyncMode=function(I){return T(I)||k(I)===l},tn.isConcurrentMode=T,tn.isContextConsumer=function(I){return k(I)===a},tn.isContextProvider=function(I){return k(I)===o},tn.isElement=function(I){return typeof I=="object"&&I!==null&&I.$$typeof===e},tn.isForwardRef=function(I){return k(I)===u},tn.isFragment=function(I){return k(I)===r},tn.isLazy=function(I){return k(I)===v},tn.isMemo=function(I){return k(I)===m},tn.isPortal=function(I){return k(I)===n},tn.isProfiler=function(I){return k(I)===s},tn.isStrictMode=function(I){return k(I)===i},tn.isSuspense=function(I){return k(I)===f},tn.isValidElementType=function(I){return typeof I=="string"||typeof I=="function"||I===r||I===c||I===s||I===i||I===f||I===p||typeof I=="object"&&I!==null&&(I.$$typeof===v||I.$$typeof===m||I.$$typeof===o||I.$$typeof===a||I.$$typeof===u||I.$$typeof===S||I.$$typeof===b||I.$$typeof===w||I.$$typeof===g)},tn.typeOf=k,tn}var h$;function nTe(){return h$||(h$=1,wk.exports=tTe()),wk.exports}var Ck,p$;function rTe(){if(p$)return Ck;p$=1;var t=nTe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[t.ForwardRef]=r,s[t.Memo]=i;function o(v){return t.isMemo(v)?i:s[v.$$typeof]||e}var a=Object.defineProperty,l=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,p=Object.prototype;function m(v,g,S){if(typeof g!="string"){if(p){var b=f(g);b&&b!==p&&m(v,b,S)}var w=l(g);c&&(w=w.concat(c(g)));for(var k=o(v),T=o(g),I=0;I<w.length;++I){var C=w[I];if(!n[C]&&!(S&&S[C])&&!(T&&T[C])&&!(k&&k[C])){var x=u(g,C);try{a(v,C,x)}catch{}}}}return v}return Ck=m,Ck}var iTe=rTe();const sTe=Xa(iTe),oZ=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,m$={componentStack:null,error:null,eventId:null};class sT extends _.Component{constructor(e){super(e),sT.prototype.__init.call(this),this.state=m$,this._openFallbackReportDialog=!0;const n=en();n&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=n.on("afterSendEvent",r=>{!r.type&&this._lastEventId&&r.event_id===this._lastEventId&&l$({...e.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(e,n){const{componentStack:r}=n,i=r??void 0,{beforeCapture:s,onError:o,showDialog:a,dialogOptions:l}=this.props;QC(c=>{s&&s(c,e,i);const u=this.props.handled!=null?this.props.handled:!!this.props.fallback,f=eTe(e,n,{mechanism:{handled:u}});o&&o(e,i,f),a&&(this._lastEventId=f,this._openFallbackReportDialog&&l$({...l,eventId:f})),this.setState({error:e,componentStack:r,eventId:f})})}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:n,eventId:r}=this.state,{onUnmount:i}=this.props;i&&i(e,n,r),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:n,componentStack:r,eventId:i}=this.state;e&&e(n,r,i),this.setState(m$)}}render(){const{fallback:e,children:n}=this.props,r=this.state;if(r.error){let i;return typeof e=="function"?i=_.createElement(e,{error:r.error,componentStack:r.componentStack,resetError:this.resetErrorBoundary,eventId:r.eventId}):i=e,_.isValidElement(i)?i:(e&&oZ&&Oe.warn("fallback did not produce a valid ReactElement"),null)}return typeof n=="function"?n():n}}let eE,tE,nE,rE,Ph,gm=!1;const aZ=new WeakSet,Tk=new Set;function oTe(t,e){const n=YCe({...t,instrumentPageLoad:!1,instrumentNavigation:!1}),{useEffect:r,useLocation:i,useNavigationType:s,createRoutesFromChildren:o,matchRoutes:a,stripBasename:l,instrumentPageLoad:c=!0,instrumentNavigation:u=!0}=t;return{...n,setup(){eE=r,tE=i,nE=s,Ph=a,rE=o,gm=l||!1},afterAllSetup(f){n.afterAllSetup(f);const p=ot&&ot.location&&ot.location.pathname;c&&p&&iZ(f,{name:p,attributes:{[$o]:"url",[au]:"pageload",[Dr]:`auto.pageload.react.reactrouter_v${e}`}}),u&&aZ.add(f)}}}function aTe(t){const{location:e,routes:n,navigationType:r,version:i,matches:s,basename:o,allRoutes:a}=t,l=Array.isArray(s)?s:Ph(n,e,o),c=en();if(!(!c||!aZ.has(c))&&(r==="PUSH"||r==="POP")&&l){let u,f="url";const p=cZ(e,a||n);p&&(u=uy(ZA(a||n,e)),f="route"),(!p||!u)&&([u,f]=dZ(n,e,l,o)),sZ(c,{name:u,attributes:{[$o]:f,[au]:"navigation",[Dr]:`auto.navigation.react.reactrouter_v${i}`}})}}function gw(t,e){if(!e||e==="/"||!t.toLowerCase().startsWith(e.toLowerCase()))return t;const n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?t:t.slice(n)||"/"}function lTe(t,e,n){const r=t||gm?gw(e,n):e;return[r[r.length-1]==="/"||r.slice(-2)==="/*"?r.slice(0,-1):r,"route"]}function lZ(t){return t.endsWith("*")}function g$(t,e){return lZ(t)&&e.route.children&&e.route.children.length>0||!1}function cTe(t){return!!(!t.children&&t.element&&t.path&&t.path.endsWith("/*"))}function cZ(t,e){const n=Ph(e,t);if(n){for(const r of n)if(cTe(r.route)&&dTe(r))return!0}return!1}function uZ(t,e=new Set){return e.has(t)||(e.add(t),t.children&&!t.index&&t.children.forEach(n=>{uZ(n,e).forEach(i=>e.add(i))})),e}function uTe(t){return fTe(t.route.path||"")}function dTe(t){return t.params["*"]||""}function fTe(t){return t[t.length-1]==="*"?t.slice(0,-1):t}function T1(t){return t[t.length-1]==="/"?t.slice(0,-1):t}function uy(t){return t[0]==="/"?t:`/${t}`}function ZA(t,e){const n=Ph(t,e);if(!n||n.length===0)return"";for(const r of n)if(r.route.path&&r.route.path!=="*"){const i=uTe(r),s=gw(e.pathname,uy(r.pathnameBase));return T1(T1(i||"")+uy(ZA(t.filter(o=>o!==r.route),{pathname:s})))}return""}function dZ(t,e,n,r=""){if(!t||t.length===0)return[gm?gw(e.pathname,r):e.pathname,"url"];let i="";if(n)for(const o of n){const a=o.route;if(a){if(a.index)return lTe(i,o.pathname,r);const l=a.path;if(l&&!g$(l,o)){const c=l[0]==="/"||i[i.length-1]==="/"?l:`/${l}`;if(i=T1(i)+uy(c),T1(e.pathname)===T1(r+o.pathname))return Jj(i)!==Jj(o.pathname)&&!lZ(i)?[(gm?"":r)+c,"route"]:(g$(i,o)&&(i=i.slice(0,-1)),[(gm?"":r)+i,"route"])}}}return[gm?gw(e.pathname,r):e.pathname||"/","url"]}function hTe(t,e,n,r,i,s){const o=Array.isArray(r)?r:Ph(s||n,e,i);if(o){let a,l="url";const c=cZ(e,s||n);c&&(a=uy(ZA(s||n,e)),l="route"),(!c||!a)&&([a,l]=dZ(n,e,o,i)),En().setTransactionName(a||"/"),t&&(t.updateName(a),t.setAttribute($o,l))}}function pTe(t,e){if(!eE||!tE||!nE||!rE||!Ph)return oZ&&Oe.warn(`reactRouterV6Instrumentation was unable to wrap Routes because of one or more missing parameters.
      useEffect: ${eE}. useLocation: ${tE}. useNavigationType: ${nE}.
      createRoutesFromChildren: ${rE}. matchRoutes: ${Ph}.`),t;const n=r=>{const i=_.useRef(!0),s=tE(),o=nE();return eE(()=>{const a=rE(r.children);i.current?(a.forEach(l=>{uZ(l).forEach(u=>{Tk.add(u)})}),hTe(mTe(),s,a,void 0,void 0,Array.from(Tk)),i.current=!1):aTe({location:s,routes:a,navigationType:o,version:e,allRoutes:Array.from(Tk)})},[s,o]),_.createElement(t,{...r})};return sTe(n,t),n}function mTe(){const t=xi(),e=t?Ii(t):void 0;if(!e)return;const n=Qt(e).op;return n==="navigation"||n==="pageload"?e:void 0}function gTe(t){return oTe(t,"7")}function vTe(t){return pTe(t,"7")}var Rk={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var v$;function yTe(){return v$||(v$=1,function(t){(function(){var e={}.hasOwnProperty;function n(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return n.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}t.exports?(n.default=n,t.exports=n):window.classNames=n})()}(Rk)),Rk.exports}var _Te=yTe();const Ne=Xa(_Te);function fZ(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m10.6 13.8-2.15-2.15a.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275.948.948 0 0 0-.275.7.95.95 0 0 0 .275.7L9.9 15.9c.2.2.433.3.7.3.267 0 .5-.1.7-.3l5.65-5.65a.948.948 0 0 0 .275-.7.948.948 0 0 0-.275-.7.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275L10.6 13.8ZM12 22a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Zm0-2c2.233 0 4.125-.775 5.675-2.325C19.225 16.125 20 14.233 20 12c0-2.233-.775-4.125-2.325-5.675C16.125 4.775 14.233 4 12 4c-2.233 0-4.125.775-5.675 2.325C4.775 7.875 4 9.767 4 12c0 2.233.775 4.125 2.325 5.675C7.875 19.225 9.767 20 12 20Z"})})}fZ.displayName="CheckCircleIcon";const bTe=_.forwardRef(fZ);function hZ(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 17a.97.97 0 0 0 .713-.288A.968.968 0 0 0 13 16a.968.968 0 0 0-.287-.713A.968.968 0 0 0 12 15a.968.968 0 0 0-.713.287A.968.968 0 0 0 11 16c0 .283.096.52.287.712.192.192.43.288.713.288Zm0-4c.283 0 .52-.096.713-.287A.968.968 0 0 0 13 12V8a.967.967 0 0 0-.287-.713A.968.968 0 0 0 12 7a.968.968 0 0 0-.713.287A.967.967 0 0 0 11 8v4c0 .283.096.52.287.713.192.191.43.287.713.287Zm0 9a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Z"})})}hZ.displayName="ErrorIcon";const oT=_.forwardRef(hZ);function pZ(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M11.287 7.287A.968.968 0 0 1 12 7c.283 0 .52.096.713.287.191.192.287.43.287.713s-.096.52-.287.713A.968.968 0 0 1 12 9a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 8c0-.283.096-.52.287-.713Zm0 4A.968.968 0 0 1 12 11c.283 0 .52.096.713.287.191.192.287.43.287.713v4a.97.97 0 0 1-.287.712A.968.968 0 0 1 12 17a.968.968 0 0 1-.713-.288A.968.968 0 0 1 11 16v-4c0-.283.096-.52.287-.713Z"}),E.jsx("path",{fillRule:"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 1-16 0 8 8 0 0 1 16 0Z",clipRule:"evenodd"})]})}pZ.displayName="InfoIcon";const STe=_.forwardRef(pZ);function mZ(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414Z"})})}mZ.displayName="CloseIcon";const aT=_.forwardRef(mZ),ETe="_alert_1bz08_19",wTe="_content_1bz08_46",CTe="_icon_1bz08_57",TTe="_actions_1bz08_73",$p={alert:ETe,content:wTe,"text-content":"_text-content_1bz08_53",icon:CTe,actions:TTe},RTe="_typography_yh5dq_162",y$={"font-body-xs-regular":"_font-body-xs-regular_yh5dq_21","font-body-xs-semibold":"_font-body-xs-semibold_yh5dq_26","font-body-xs-medium":"_font-body-xs-medium_yh5dq_31","font-body-sm-regular":"_font-body-sm-regular_yh5dq_40","font-body-sm-semibold":"_font-body-sm-semibold_yh5dq_45","font-body-sm-medium":"_font-body-sm-medium_yh5dq_50","font-body-md-regular":"_font-body-md-regular_yh5dq_59","font-body-md-semibold":"_font-body-md-semibold_yh5dq_64","font-body-md-medium":"_font-body-md-medium_yh5dq_69","font-body-lg-regular":"_font-body-lg-regular_yh5dq_78","font-body-lg-semibold":"_font-body-lg-semibold_yh5dq_83","font-body-lg-medium":"_font-body-lg-medium_yh5dq_88","font-heading-sm-regular":"_font-heading-sm-regular_yh5dq_97","font-heading-sm-semibold":"_font-heading-sm-semibold_yh5dq_102","font-heading-sm-medium":"_font-heading-sm-medium_yh5dq_107","font-heading-md-regular":"_font-heading-md-regular_yh5dq_116","font-heading-md-semibold":"_font-heading-md-semibold_yh5dq_121","font-heading-lg-regular":"_font-heading-lg-regular_yh5dq_130","font-heading-lg-semibold":"_font-heading-lg-semibold_yh5dq_135","font-heading-xl-regular":"_font-heading-xl-regular_yh5dq_144","font-heading-xl-semibold":"_font-heading-xl-semibold_yh5dq_149",typography:RTe},gZ=({as:t,children:e,type:n="body",weight:r="regular",size:i="md",className:s,...o})=>{const a=t||"p";return E.jsx(a,{...o,className:Ne(y$.typography,y$[`font-${n}-${i}-${r}`],s),children:e})},ln=({as:t="p",children:e,...n})=>E.jsx(gZ,{as:t,type:"body",...n,children:e}),ITe="_destructive_bh2qc_83",Ik={"icon-button":"_icon-button_bh2qc_17","subtle-bg":"_subtle-bg_bh2qc_38",destructive:ITe},vZ=_.forwardRef(function({as:e,children:n,className:r,disabled:i,...s},o){const a=e||"button",{onClick:l,onSubmit:c,onPointerDown:u,onPointerUp:f,onKeyDown:p,onKeyUp:m,onKeyPress:v,...g}=s,S=i?{}:{onClick:l,onSubmit:c,onPointerDown:u,onPointerUp:f,onKeyDown:p,onKeyUp:m,onKeyPress:v};return E.jsx(a,{...g,ref:o,className:r,role:e==="a"?"link":"button",tabIndex:0,...S,"aria-disabled":i,children:n})}),kTe={"indicator-icon":"_indicator-icon_133tf_26"},xTe=_.forwardRef(function({children:e,className:n,size:r="100%",colour:i,indicator:s},o){const a=Ne(kTe["indicator-icon"],n);return E.jsx("div",{ref:o,className:a,"data-indicator":s,style:{"--cpd-icon-button-size":r,"--cpd-color-icon-tertiary":i},children:Se.Children.only(e)})}),yZ=_.createContext(null);function QA(){const t=_.useContext(yZ);if(t==null)throw new Error("Tooltip components must be wrapped in <Tooltip />");return t}function lT(){return typeof window<"u"}function sv(t){return _Z(t)?(t.nodeName||"").toLowerCase():"#document"}function As(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Jl(t){var e;return(e=(_Z(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function _Z(t){return lT()?t instanceof Node||t instanceof As(t).Node:!1}function In(t){return lT()?t instanceof Element||t instanceof As(t).Element:!1}function uo(t){return lT()?t instanceof HTMLElement||t instanceof As(t).HTMLElement:!1}function IP(t){return!lT()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof As(t).ShadowRoot}function d_(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=fo(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function PTe(t){return["table","td","th"].includes(sv(t))}function cT(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function eO(t){const e=uT(),n=In(t)?fo(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function LTe(t){let e=cu(t);for(;uo(e)&&!qc(e);){if(eO(e))return e;if(cT(e))return null;e=cu(e)}return null}function uT(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function qc(t){return["html","body","#document"].includes(sv(t))}function fo(t){return As(t).getComputedStyle(t)}function dT(t){return In(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function cu(t){if(sv(t)==="html")return t;const e=t.assignedSlot||t.parentNode||IP(t)&&t.host||Jl(t);return IP(e)?e.host:e}function bZ(t){const e=cu(t);return qc(e)?t.ownerDocument?t.ownerDocument.body:t.body:uo(e)&&d_(e)?e:bZ(e)}function kd(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=bZ(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=As(i);if(s){const a=kP(o);return e.concat(o,o.visualViewport||[],d_(i)?i:[],a&&n?kd(a):[])}return e.concat(i,kd(i,[],n))}function kP(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function xP(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function _g(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&IP(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function SZ(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function EZ(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}function ATe(t){return MTe()?!1:!_$()&&t.width===0&&t.height===0||_$()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}function wZ(){return/apple/i.test(navigator.vendor)}function _$(){const t=/android/i;return t.test(SZ())||t.test(EZ())}function OTe(){return SZ().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function MTe(){return EZ().includes("jsdom/")}function PP(t,e){const n=["mouse","pen"];return n.push("",void 0),n.includes(t)}function NTe(t){return"nativeEvent"in t}function DTe(t){return t.matches("html,body")}function yd(t){return(t==null?void 0:t.ownerDocument)||document}function kk(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}function am(t){return"composedPath"in t?t.composedPath()[0]:t.target}const FTe="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function UTe(t){return uo(t)&&t.matches(FTe)}const jTe=["top","right","bottom","left"],qd=Math.min,oo=Math.max,vw=Math.round,TS=Math.floor,Fl=t=>({x:t,y:t}),$Te={left:"right",right:"left",bottom:"top",top:"bottom"},BTe={start:"end",end:"start"};function LP(t,e,n){return oo(t,qd(e,n))}function uu(t,e){return typeof t=="function"?t(e):t}function du(t){return t.split("-")[0]}function ov(t){return t.split("-")[1]}function tO(t){return t==="x"?"y":"x"}function nO(t){return t==="y"?"height":"width"}function Kd(t){return["top","bottom"].includes(du(t))?"y":"x"}function rO(t){return tO(Kd(t))}function HTe(t,e,n){n===void 0&&(n=!1);const r=ov(t),i=rO(t),s=nO(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=yw(o)),[o,yw(o)]}function VTe(t){const e=yw(t);return[AP(t),e,AP(e)]}function AP(t){return t.replace(/start|end/g,e=>BTe[e])}function GTe(t,e,n){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function qTe(t,e,n,r){const i=ov(t);let s=GTe(du(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(AP)))),s}function yw(t){return t.replace(/left|right|bottom|top/g,e=>$Te[e])}function KTe(t){return{top:0,right:0,bottom:0,left:0,...t}}function CZ(t){return typeof t!="number"?KTe(t):{top:t,right:t,bottom:t,left:t}}function _w(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var WTe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],OP=WTe.join(","),TZ=typeof Element>"u",dy=TZ?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,bw=!TZ&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},Sw=function t(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&t(e.parentNode);return o},zTe=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},YTe=function(e,n,r){if(Sw(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(OP));return n&&dy.call(e,OP)&&i.unshift(e),i=i.filter(r),i},XTe=function t(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!Sw(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?i.push.apply(i,c):i.push({scopeParent:o,candidates:c})}else{var u=dy.call(o,OP);u&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var f=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),p=!Sw(f,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(f&&p){var m=t(f===!0?o.children:f.children,!0,r);r.flatten?i.push.apply(i,m):i.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return i},RZ=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},IZ=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||zTe(e))&&!RZ(e)?0:e.tabIndex},JTe=function(e,n){var r=IZ(e);return r<0&&n&&!RZ(e)?0:r},ZTe=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},kZ=function(e){return e.tagName==="INPUT"},QTe=function(e){return kZ(e)&&e.type==="hidden"},e3e=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},t3e=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},n3e=function(e){if(!e.name)return!0;var n=e.form||bw(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=t3e(i,e.form);return!s||s===e},r3e=function(e){return kZ(e)&&e.type==="radio"},i3e=function(e){return r3e(e)&&!n3e(e)},s3e=function(e){var n,r=e&&bw(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&i;){var c,u,f;r=bw(i),i=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=i)!==null&&u!==void 0&&(f=u.ownerDocument)!==null&&f!==void 0&&f.contains(i))}}return s},b$=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},o3e=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=dy.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(dy.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var l=e.parentElement,c=bw(e);if(l&&!l.shadowRoot&&i(l)===!0)return b$(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(s3e(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return b$(e);return!1},a3e=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return dy.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},l3e=function(e,n){return!(n.disabled||Sw(n)||QTe(n)||o3e(n,e)||e3e(n)||a3e(n))},S$=function(e,n){return!(i3e(n)||IZ(n)<0||!l3e(e,n))},c3e=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},u3e=function t(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,l=JTe(a,o),c=o?t(i.candidates):a;l===0?o?n.push.apply(n,c):n.push(a):r.push({documentOrder:s,tabIndex:l,item:i,isScope:o,content:c})}),r.sort(ZTe).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},xZ=function(e,n){n=n||{};var r;return n.getShadowRoot?r=XTe([e],n.includeContainer,{filter:S$.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:c3e}):r=YTe(e,n.includeContainer,S$.bind(null,n)),u3e(r)};function E$(t,e,n){let{reference:r,floating:i}=t;const s=Kd(e),o=rO(e),a=nO(o),l=du(e),c=s==="y",u=r.x+r.width/2-i.width/2,f=r.y+r.height/2-i.height/2,p=r[a]/2-i[a]/2;let m;switch(l){case"top":m={x:u,y:r.y-i.height};break;case"bottom":m={x:u,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:f};break;case"left":m={x:r.x-i.width,y:f};break;default:m={x:r.x,y:r.y}}switch(ov(e)){case"start":m[o]-=p*(n&&c?-1:1);break;case"end":m[o]+=p*(n&&c?-1:1);break}return m}const d3e=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:f}=E$(c,r,l),p=r,m={},v=0;for(let g=0;g<a.length;g++){const{name:S,fn:b}=a[g],{x:w,y:k,data:T,reset:I}=await b({x:u,y:f,initialPlacement:r,placement:p,strategy:i,middlewareData:m,rects:c,platform:o,elements:{reference:t,floating:e}});u=w??u,f=k??f,m={...m,[S]:{...m[S],...T}},I&&v<=50&&(v++,typeof I=="object"&&(I.placement&&(p=I.placement),I.rects&&(c=I.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):I.rects),{x:u,y:f}=E$(c,p,l)),g=-1)}return{x:u,y:f,placement:p,strategy:i,middlewareData:m}};async function fy(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:p=!1,padding:m=0}=uu(e,t),v=CZ(m),S=a[p?f==="floating"?"reference":"floating":f],b=_w(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(S)))==null||n?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),w=f==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,k=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),T=await(s.isElement==null?void 0:s.isElement(k))?await(s.getScale==null?void 0:s.getScale(k))||{x:1,y:1}:{x:1,y:1},I=_w(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:k,strategy:l}):w);return{top:(b.top-I.top+v.top)/T.y,bottom:(I.bottom-b.bottom+v.bottom)/T.y,left:(b.left-I.left+v.left)/T.x,right:(I.right-b.right+v.right)/T.x}}const f3e=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=uu(t,e)||{};if(c==null)return{};const f=CZ(u),p={x:n,y:r},m=rO(i),v=nO(m),g=await o.getDimensions(c),S=m==="y",b=S?"top":"left",w=S?"bottom":"right",k=S?"clientHeight":"clientWidth",T=s.reference[v]+s.reference[m]-p[m]-s.floating[v],I=p[m]-s.reference[m],C=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let x=C?C[k]:0;(!x||!await(o.isElement==null?void 0:o.isElement(C)))&&(x=a.floating[k]||s.floating[v]);const A=T/2-I/2,N=x/2-g[v]/2-1,D=qd(f[b],N),F=qd(f[w],N),$=D,B=x-g[v]-F,W=x/2-g[v]/2+A,H=LP($,W,B),z=!l.arrow&&ov(i)!=null&&W!==H&&s.reference[v]/2-(W<$?D:F)-g[v]/2<0,K=z?W<$?W-$:W-B:0;return{[m]:p[m]+K,data:{[m]:H,centerOffset:W-H-K,...z&&{alignmentOffset:K}},reset:z}}}),h3e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:g=!0,...S}=uu(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const b=du(i),w=Kd(a),k=du(a)===a,T=await(l.isRTL==null?void 0:l.isRTL(c.floating)),I=p||(k||!g?[yw(a)]:VTe(a)),C=v!=="none";!p&&C&&I.push(...qTe(a,g,v,T));const x=[a,...I],A=await fy(e,S),N=[];let D=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&N.push(A[b]),f){const W=HTe(i,o,T);N.push(A[W[0]],A[W[1]])}if(D=[...D,{placement:i,overflows:N}],!N.every(W=>W<=0)){var F,$;const W=(((F=s.flip)==null?void 0:F.index)||0)+1,H=x[W];if(H)return{data:{index:W,overflows:D},reset:{placement:H}};let z=($=D.filter(K=>K.overflows[0]<=0).sort((K,V)=>K.overflows[1]-V.overflows[1])[0])==null?void 0:$.placement;if(!z)switch(m){case"bestFit":{var B;const K=(B=D.filter(V=>{if(C){const q=Kd(V.placement);return q===w||q==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(q=>q>0).reduce((q,Z)=>q+Z,0)]).sort((V,q)=>V[1]-q[1])[0])==null?void 0:B[0];K&&(z=K);break}case"initialPlacement":z=a;break}if(i!==z)return{reset:{placement:z}}}return{}}}};function w$(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function C$(t){return jTe.some(e=>t[e]>=0)}const p3e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=uu(t,e);switch(r){case"referenceHidden":{const s=await fy(e,{...i,elementContext:"reference"}),o=w$(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:C$(o)}}}case"escaped":{const s=await fy(e,{...i,altBoundary:!0}),o=w$(s,n.floating);return{data:{escapedOffsets:o,escaped:C$(o)}}}default:return{}}}}};async function m3e(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=du(n),a=ov(n),l=Kd(n)==="y",c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,f=uu(e,t);let{mainAxis:p,crossAxis:m,alignmentAxis:v}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return a&&typeof v=="number"&&(m=a==="end"?v*-1:v),l?{x:m*u,y:p*c}:{x:p*c,y:m*u}}const g3e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await m3e(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},v3e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:b,y:w}=S;return{x:b,y:w}}},...l}=uu(t,e),c={x:n,y:r},u=await fy(e,l),f=Kd(du(i)),p=tO(f);let m=c[p],v=c[f];if(s){const S=p==="y"?"top":"left",b=p==="y"?"bottom":"right",w=m+u[S],k=m-u[b];m=LP(w,m,k)}if(o){const S=f==="y"?"top":"left",b=f==="y"?"bottom":"right",w=v+u[S],k=v-u[b];v=LP(w,v,k)}const g=a.fn({...e,[p]:m,[f]:v});return{...g,data:{x:g.x-n,y:g.y-r,enabled:{[p]:s,[f]:o}}}}}},y3e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=uu(t,e),u={x:n,y:r},f=Kd(i),p=tO(f);let m=u[p],v=u[f];const g=uu(a,e),S=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const k=p==="y"?"height":"width",T=s.reference[p]-s.floating[k]+S.mainAxis,I=s.reference[p]+s.reference[k]-S.mainAxis;m<T?m=T:m>I&&(m=I)}if(c){var b,w;const k=p==="y"?"width":"height",T=["top","left"].includes(du(i)),I=s.reference[f]-s.floating[k]+(T&&((b=o.offset)==null?void 0:b[f])||0)+(T?0:S.crossAxis),C=s.reference[f]+s.reference[k]+(T?0:((w=o.offset)==null?void 0:w[f])||0)-(T?S.crossAxis:0);v<I?v=I:v>C&&(v=C)}return{[p]:m,[f]:v}}}},_3e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=uu(t,e),u=await fy(e,c),f=du(i),p=ov(i),m=Kd(i)==="y",{width:v,height:g}=s.floating;let S,b;f==="top"||f==="bottom"?(S=f,b=p===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(b=f,S=p==="end"?"top":"bottom");const w=g-u.top-u.bottom,k=v-u.left-u.right,T=qd(g-u[S],w),I=qd(v-u[b],k),C=!e.middlewareData.shift;let x=T,A=I;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(A=k),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(x=w),C&&!p){const D=oo(u.left,0),F=oo(u.right,0),$=oo(u.top,0),B=oo(u.bottom,0);m?A=v-2*(D!==0||F!==0?D+F:oo(u.left,u.right)):x=g-2*($!==0||B!==0?$+B:oo(u.top,u.bottom))}await l({...e,availableWidth:A,availableHeight:x});const N=await o.getDimensions(a.floating);return v!==N.width||g!==N.height?{reset:{rects:!0}}:{}}}};function PZ(t){const e=fo(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=uo(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=vw(n)!==s||vw(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function iO(t){return In(t)?t:t.contextElement}function $m(t){const e=iO(t);if(!uo(e))return Fl(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=PZ(e);let o=(s?vw(n.width):n.width)/r,a=(s?vw(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const b3e=Fl(0);function LZ(t){const e=As(t);return!uT()||!e.visualViewport?b3e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function S3e(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==As(t)?!1:e}function Lh(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=iO(t);let o=Fl(1);e&&(r?In(r)&&(o=$m(r)):o=$m(t));const a=S3e(s,n,r)?LZ(s):Fl(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,f=i.height/o.y;if(s){const p=As(s),m=r&&In(r)?As(r):r;let v=p,g=kP(v);for(;g&&r&&m!==v;){const S=$m(g),b=g.getBoundingClientRect(),w=fo(g),k=b.left+(g.clientLeft+parseFloat(w.paddingLeft))*S.x,T=b.top+(g.clientTop+parseFloat(w.paddingTop))*S.y;l*=S.x,c*=S.y,u*=S.x,f*=S.y,l+=k,c+=T,v=As(g),g=kP(v)}}return _w({width:u,height:f,x:l,y:c})}function sO(t,e){const n=dT(t).scrollLeft;return e?e.left+n:Lh(Jl(t)).left+n}function AZ(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),i=r.left+e.scrollLeft-(n?0:sO(t,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function E3e(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=Jl(r),a=e?cT(e.floating):!1;if(r===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=Fl(1);const u=Fl(0),f=uo(r);if((f||!f&&!s)&&((sv(r)!=="body"||d_(o))&&(l=dT(r)),uo(r))){const m=Lh(r);c=$m(r),u.x=m.x+r.clientLeft,u.y=m.y+r.clientTop}const p=o&&!f&&!s?AZ(o,l,!0):Fl(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+p.x,y:n.y*c.y-l.scrollTop*c.y+u.y+p.y}}function w3e(t){return Array.from(t.getClientRects())}function C3e(t){const e=Jl(t),n=dT(t),r=t.ownerDocument.body,i=oo(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=oo(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+sO(t);const a=-n.scrollTop;return fo(r).direction==="rtl"&&(o+=oo(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function T3e(t,e){const n=As(t),r=Jl(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const c=uT();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}function R3e(t,e){const n=Lh(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=uo(t)?$m(t):Fl(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function T$(t,e,n){let r;if(e==="viewport")r=T3e(t,n);else if(e==="document")r=C3e(Jl(t));else if(In(e))r=R3e(e,n);else{const i=LZ(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return _w(r)}function OZ(t,e){const n=cu(t);return n===e||!In(n)||qc(n)?!1:fo(n).position==="fixed"||OZ(n,e)}function I3e(t,e){const n=e.get(t);if(n)return n;let r=kd(t,[],!1).filter(a=>In(a)&&sv(a)!=="body"),i=null;const s=fo(t).position==="fixed";let o=s?cu(t):t;for(;In(o)&&!qc(o);){const a=fo(o),l=eO(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||d_(o)&&!l&&OZ(t,o))?r=r.filter(u=>u!==o):i=a,o=cu(o)}return e.set(t,r),r}function k3e(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?cT(e)?[]:I3e(e,this._c):[].concat(n),r],a=o[0],l=o.reduce((c,u)=>{const f=T$(e,u,i);return c.top=oo(f.top,c.top),c.right=qd(f.right,c.right),c.bottom=qd(f.bottom,c.bottom),c.left=oo(f.left,c.left),c},T$(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function x3e(t){const{width:e,height:n}=PZ(t);return{width:e,height:n}}function P3e(t,e,n){const r=uo(e),i=Jl(e),s=n==="fixed",o=Lh(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Fl(0);if(r||!r&&!s)if((sv(e)!=="body"||d_(i))&&(a=dT(e)),r){const p=Lh(e,!0,s,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else i&&(l.x=sO(i));const c=i&&!r&&!s?AZ(i,a):Fl(0),u=o.left+a.scrollLeft-l.x-c.x,f=o.top+a.scrollTop-l.y-c.y;return{x:u,y:f,width:o.width,height:o.height}}function xk(t){return fo(t).position==="static"}function R$(t,e){if(!uo(t)||fo(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Jl(t)===n&&(n=n.ownerDocument.body),n}function MZ(t,e){const n=As(t);if(cT(t))return n;if(!uo(t)){let i=cu(t);for(;i&&!qc(i);){if(In(i)&&!xk(i))return i;i=cu(i)}return n}let r=R$(t,e);for(;r&&PTe(r)&&xk(r);)r=R$(r,e);return r&&qc(r)&&xk(r)&&!eO(r)?n:r||LTe(t)||n}const L3e=async function(t){const e=this.getOffsetParent||MZ,n=this.getDimensions,r=await n(t.floating);return{reference:P3e(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function A3e(t){return fo(t).direction==="rtl"}const O3e={convertOffsetParentRelativeRectToViewportRelativeRect:E3e,getDocumentElement:Jl,getClippingRect:k3e,getOffsetParent:MZ,getElementRects:L3e,getClientRects:w3e,getDimensions:x3e,getScale:$m,isElement:In,isRTL:A3e};function NZ(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function M3e(t,e){let n=null,r;const i=Jl(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:f,width:p,height:m}=c;if(a||e(),!p||!m)return;const v=TS(f),g=TS(i.clientWidth-(u+p)),S=TS(i.clientHeight-(f+m)),b=TS(u),k={rootMargin:-v+"px "+-g+"px "+-S+"px "+-b+"px",threshold:oo(0,qd(1,l))||1};let T=!0;function I(C){const x=C[0].intersectionRatio;if(x!==l){if(!T)return o();x?o(!1,x):r=setTimeout(()=>{o(!1,1e-7)},1e3)}x===1&&!NZ(c,t.getBoundingClientRect())&&o(),T=!1}try{n=new IntersectionObserver(I,{...k,root:i.ownerDocument})}catch{n=new IntersectionObserver(I,k)}n.observe(t)}return o(!0),s}function DZ(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=iO(t),u=i||s?[...c?kd(c):[],...kd(e)]:[];u.forEach(b=>{i&&b.addEventListener("scroll",n,{passive:!0}),s&&b.addEventListener("resize",n)});const f=c&&a?M3e(c,n):null;let p=-1,m=null;o&&(m=new ResizeObserver(b=>{let[w]=b;w&&w.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var k;(k=m)==null||k.observe(e)})),n()}),c&&!l&&m.observe(c),m.observe(e));let v,g=l?Lh(t):null;l&&S();function S(){const b=Lh(t);g&&!NZ(g,b)&&n(),g=b,v=requestAnimationFrame(S)}return n(),()=>{var b;u.forEach(w=>{i&&w.removeEventListener("scroll",n),s&&w.removeEventListener("resize",n)}),f==null||f(),(b=m)==null||b.disconnect(),m=null,l&&cancelAnimationFrame(v)}}const N3e=g3e,D3e=v3e,F3e=h3e,U3e=_3e,j3e=p3e,I$=f3e,$3e=y3e,B3e=(t,e,n)=>{const r=new Map,i={platform:O3e,...n},s={...i.platform,_c:r};return d3e(t,e,{...i,platform:s})};var iE=typeof document<"u"?_.useLayoutEffect:_.useEffect;function Ew(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!Ew(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const s=i[r];if(!(s==="_owner"&&t.$$typeof)&&!Ew(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function FZ(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function k$(t,e){const n=FZ(t);return Math.round(e*n)/n}function Pk(t){const e=_.useRef(t);return iE(()=>{e.current=t}),e}function UZ(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,f]=_.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[p,m]=_.useState(r);Ew(p,r)||m(r);const[v,g]=_.useState(null),[S,b]=_.useState(null),w=_.useCallback(V=>{V!==C.current&&(C.current=V,g(V))},[]),k=_.useCallback(V=>{V!==x.current&&(x.current=V,b(V))},[]),T=s||v,I=o||S,C=_.useRef(null),x=_.useRef(null),A=_.useRef(u),N=l!=null,D=Pk(l),F=Pk(i),$=Pk(c),B=_.useCallback(()=>{if(!C.current||!x.current)return;const V={placement:e,strategy:n,middleware:p};F.current&&(V.platform=F.current),B3e(C.current,x.current,V).then(q=>{const Z={...q,isPositioned:$.current!==!1};W.current&&!Ew(A.current,Z)&&(A.current=Z,zg.flushSync(()=>{f(Z)}))})},[p,e,n,F,$]);iE(()=>{c===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,f(V=>({...V,isPositioned:!1})))},[c]);const W=_.useRef(!1);iE(()=>(W.current=!0,()=>{W.current=!1}),[]),iE(()=>{if(T&&(C.current=T),I&&(x.current=I),T&&I){if(D.current)return D.current(T,I,B);B()}},[T,I,B,D,N]);const H=_.useMemo(()=>({reference:C,floating:x,setReference:w,setFloating:k}),[w,k]),z=_.useMemo(()=>({reference:T,floating:I}),[T,I]),K=_.useMemo(()=>{const V={position:n,left:0,top:0};if(!z.floating)return V;const q=k$(z.floating,u.x),Z=k$(z.floating,u.y);return a?{...V,transform:"translate("+q+"px, "+Z+"px)",...FZ(z.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:q,top:Z}},[n,a,z.floating,u.x,u.y]);return _.useMemo(()=>({...u,update:B,refs:H,elements:z,floatingStyles:K}),[u,B,H,z,K])}const H3e=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?I$({element:r.current,padding:i}).fn(n):{}:r?I$({element:r,padding:i}).fn(n):{}}}},jZ=(t,e)=>({...N3e(t),options:[t,e]}),$Z=(t,e)=>({...D3e(t),options:[t,e]}),V3e=(t,e)=>({...$3e(t),options:[t,e]}),BZ=(t,e)=>({...F3e(t),options:[t,e]}),G3e=(t,e)=>({...U3e(t),options:[t,e]}),q3e=(t,e)=>({...j3e(t),options:[t,e]}),HZ=(t,e)=>({...H3e(t),options:[t,e]});function VZ(t){return _.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})},t)}const GZ={...Oz},K3e=GZ.useInsertionEffect,W3e=K3e||(t=>t());function Mc(t){const e=_.useRef(()=>{});return W3e(()=>{e.current=t}),_.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var is=typeof document<"u"?_.useLayoutEffect:_.useEffect;let x$=!1,z3e=0;const P$=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+z3e++;function Y3e(){const[t,e]=_.useState(()=>x$?P$():void 0);return is(()=>{t==null&&e(P$())},[]),_.useEffect(()=>{x$=!0},[]),t}const X3e=GZ.useId,bg=X3e||Y3e,J3e=_.forwardRef(function(e,n){const{context:{placement:r,elements:{floating:i},middlewareData:{arrow:s,shift:o}},width:a=14,height:l=7,tipRadius:c=0,strokeWidth:u=0,staticOffset:f,stroke:p,d:m,style:{transform:v,...g}={},...S}=e,b=bg(),[w,k]=_.useState(!1);if(is(()=>{if(!i)return;fo(i).direction==="rtl"&&k(!0)},[i]),!i)return null;const[T,I]=r.split("-"),C=T==="top"||T==="bottom";let x=f;(C&&o!=null&&o.x||!C&&o!=null&&o.y)&&(x=null);const A=u*2,N=A/2,D=a/2*(c/-8+1),F=l/2*c/4,$=!!m,B=x&&I==="end"?"bottom":"top";let W=x&&I==="end"?"right":"left";x&&w&&(W=I==="end"?"left":"right");const H=(s==null?void 0:s.x)!=null?x||s.x:"",z=(s==null?void 0:s.y)!=null?x||s.y:"",K=m||"M0,0"+(" H"+a)+(" L"+(a-D)+","+(l-F))+(" Q"+a/2+","+l+" "+D+","+(l-F))+" Z",V={top:$?"rotate(180deg)":"",left:$?"rotate(90deg)":"rotate(-90deg)",bottom:$?"":"rotate(180deg)",right:$?"rotate(-90deg)":"rotate(90deg)"}[T];return E.jsxs("svg",{...S,"aria-hidden":!0,ref:n,width:$?a:a+A,height:a,viewBox:"0 0 "+a+" "+(l>a?l:a),style:{position:"absolute",pointerEvents:"none",[W]:H,[B]:z,[T]:C||$?"100%":"calc(100% - "+A/2+"px)",transform:[V,v].filter(q=>!!q).join(" "),...g},children:[A>0&&E.jsx("path",{clipPath:"url(#"+b+")",fill:"none",stroke:p,strokeWidth:A+(m?0:1),d:K}),E.jsx("path",{stroke:A&&!m?S.fill:"none",d:K}),E.jsx("clipPath",{id:b,children:E.jsx("rect",{x:-N,y:N*($?-1:1),width:a+A,height:a})})]})});function Z3e(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(i=>i(n))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){var r;t.set(e,((r=t.get(e))==null?void 0:r.filter(i=>i!==n))||[])}}}const Q3e=_.createContext(null),eRe=_.createContext(null),oO=()=>{var t;return((t=_.useContext(Q3e))==null?void 0:t.id)||null},aO=()=>_.useContext(eRe);function f_(t){return"data-floating-ui-"+t}function Lk(t){const e=_.useRef(t);return is(()=>{e.current=t}),e}const L$=f_("safe-polygon");function sE(t,e,n){return n&&!PP(n)?0:typeof t=="number"?t:t==null?void 0:t[e]}function tRe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,dataRef:i,events:s,elements:o}=t,{enabled:a=!0,delay:l=0,handleClose:c=null,mouseOnly:u=!1,restMs:f=0,move:p=!0}=e,m=aO(),v=oO(),g=Lk(c),S=Lk(l),b=Lk(n),w=_.useRef(),k=_.useRef(-1),T=_.useRef(),I=_.useRef(-1),C=_.useRef(!0),x=_.useRef(!1),A=_.useRef(()=>{}),N=_.useRef(!1),D=_.useCallback(()=>{var K;const V=(K=i.current.openEvent)==null?void 0:K.type;return(V==null?void 0:V.includes("mouse"))&&V!=="mousedown"},[i]);_.useEffect(()=>{if(!a)return;function K(V){let{open:q}=V;q||(clearTimeout(k.current),clearTimeout(I.current),C.current=!0,N.current=!1)}return s.on("openchange",K),()=>{s.off("openchange",K)}},[a,s]),_.useEffect(()=>{if(!a||!g.current||!n)return;function K(q){D()&&r(!1,q,"hover")}const V=yd(o.floating).documentElement;return V.addEventListener("mouseleave",K),()=>{V.removeEventListener("mouseleave",K)}},[o.floating,n,r,a,g,D]);const F=_.useCallback(function(K,V,q){V===void 0&&(V=!0),q===void 0&&(q="hover");const Z=sE(S.current,"close",w.current);Z&&!T.current?(clearTimeout(k.current),k.current=window.setTimeout(()=>r(!1,K,q),Z)):V&&(clearTimeout(k.current),r(!1,K,q))},[S,r]),$=Mc(()=>{A.current(),T.current=void 0}),B=Mc(()=>{if(x.current){const K=yd(o.floating).body;K.style.pointerEvents="",K.removeAttribute(L$),x.current=!1}}),W=Mc(()=>i.current.openEvent?["click","mousedown"].includes(i.current.openEvent.type):!1);_.useEffect(()=>{if(!a)return;function K(G){if(clearTimeout(k.current),C.current=!1,u&&!PP(w.current)||f>0&&!sE(S.current,"open"))return;const Q=sE(S.current,"open",w.current);Q?k.current=window.setTimeout(()=>{b.current||r(!0,G,"hover")},Q):n||r(!0,G,"hover")}function V(G){if(W())return;A.current();const Q=yd(o.floating);if(clearTimeout(I.current),N.current=!1,g.current&&i.current.floatingContext){n||clearTimeout(k.current),T.current=g.current({...i.current.floatingContext,tree:m,x:G.clientX,y:G.clientY,onClose(){B(),$(),W()||F(G,!0,"safe-polygon")}});const _e=T.current;Q.addEventListener("mousemove",_e),A.current=()=>{Q.removeEventListener("mousemove",_e)};return}(w.current==="touch"?!_g(o.floating,G.relatedTarget):!0)&&F(G)}function q(G){W()||i.current.floatingContext&&(g.current==null||g.current({...i.current.floatingContext,tree:m,x:G.clientX,y:G.clientY,onClose(){B(),$(),W()||F(G)}})(G))}if(In(o.domReference)){var Z;const G=o.domReference;return n&&G.addEventListener("mouseleave",q),(Z=o.floating)==null||Z.addEventListener("mouseleave",q),p&&G.addEventListener("mousemove",K,{once:!0}),G.addEventListener("mouseenter",K),G.addEventListener("mouseleave",V),()=>{var Q;n&&G.removeEventListener("mouseleave",q),(Q=o.floating)==null||Q.removeEventListener("mouseleave",q),p&&G.removeEventListener("mousemove",K),G.removeEventListener("mouseenter",K),G.removeEventListener("mouseleave",V)}}},[o,a,t,u,f,p,F,$,B,r,n,b,m,S,g,i,W]),is(()=>{var K;if(a&&n&&(K=g.current)!=null&&K.__options.blockPointerEvents&&D()){x.current=!0;const q=o.floating;if(In(o.domReference)&&q){var V;const Z=yd(o.floating).body;Z.setAttribute(L$,"");const G=o.domReference,Q=m==null||(V=m.nodesRef.current.find(ge=>ge.id===v))==null||(V=V.context)==null?void 0:V.elements.floating;return Q&&(Q.style.pointerEvents=""),Z.style.pointerEvents="none",G.style.pointerEvents="auto",q.style.pointerEvents="auto",()=>{Z.style.pointerEvents="",G.style.pointerEvents="",q.style.pointerEvents=""}}}},[a,n,v,o,m,g,D]),is(()=>{n||(w.current=void 0,N.current=!1,$(),B())},[n,$,B]),_.useEffect(()=>()=>{$(),clearTimeout(k.current),clearTimeout(I.current),B()},[a,o.domReference,$,B]);const H=_.useMemo(()=>{function K(V){w.current=V.pointerType}return{onPointerDown:K,onPointerEnter:K,onMouseMove(V){const{nativeEvent:q}=V;function Z(){!C.current&&!b.current&&r(!0,q,"hover")}u&&!PP(w.current)||n||f===0||N.current&&V.movementX**2+V.movementY**2<2||(clearTimeout(I.current),w.current==="touch"?Z():(N.current=!0,I.current=window.setTimeout(Z,f)))}}},[u,r,n,b,f]),z=_.useMemo(()=>({onMouseEnter(){clearTimeout(k.current)},onMouseLeave(K){W()||F(K.nativeEvent,!1)}}),[F,W]);return _.useMemo(()=>a?{reference:H,floating:z}:{},[a,H,z])}const MP=()=>{},qZ=_.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:MP,setState:MP,isInstantPhase:!1}),nRe=()=>_.useContext(qZ);function rRe(t){const{children:e,delay:n,timeoutMs:r=0}=t,[i,s]=_.useReducer((l,c)=>({...l,...c}),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),o=_.useRef(null),a=_.useCallback(l=>{s({currentId:l})},[]);return is(()=>{i.currentId?o.current===null?o.current=i.currentId:i.isInstantPhase||s({isInstantPhase:!0}):(i.isInstantPhase&&s({isInstantPhase:!1}),o.current=null)},[i.currentId,i.isInstantPhase]),E.jsx(qZ.Provider,{value:_.useMemo(()=>({...i,setState:s,setCurrentId:a}),[i,a]),children:e})}function iRe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,floatingId:i}=t,{id:s,enabled:o=!0}=e,a=s??i,l=nRe(),{currentId:c,setCurrentId:u,initialDelay:f,setState:p,timeoutMs:m}=l;return is(()=>{o&&c&&(p({delay:{open:1,close:sE(f,"close")}}),c!==a&&r(!1))},[o,a,r,p,c,f]),is(()=>{function v(){r(!1),p({delay:f,currentId:null})}if(o&&c&&!n&&c===a){if(m){const g=window.setTimeout(v,m);return()=>{clearTimeout(g)}}v()}},[o,n,p,c,a,r,f,m]),is(()=>{o&&(u===MP||!n||u(a))},[o,n,u,a]),l}function Ak(t,e){let n=t.filter(i=>{var s;return i.parentId===e&&((s=i.context)==null?void 0:s.open)}),r=n;for(;r.length;)r=t.filter(i=>{var s;return(s=r)==null?void 0:s.some(o=>{var a;return i.parentId===o.id&&((a=i.context)==null?void 0:a.open)})}),n=n.concat(r);return n}const KZ=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function WZ(t,e){const n=xZ(t,KZ());e==="prev"&&n.reverse();const r=n.indexOf(xP(yd(t)));return n.slice(r+1)[0]}function sRe(){return WZ(document.body,"next")}function oRe(){return WZ(document.body,"prev")}function Ok(t,e){const n=e||t.currentTarget,r=t.relatedTarget;return!r||!_g(n,r)}function aRe(t){xZ(t,KZ()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function A$(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const r=n.dataset.tabindex;delete n.dataset.tabindex,r?n.setAttribute("tabindex",r):n.removeAttribute("tabindex")})}const zZ={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let lRe;function O$(t){t.key==="Tab"&&(t.target,clearTimeout(lRe))}const M$=_.forwardRef(function(e,n){const[r,i]=_.useState();is(()=>(wZ()&&i("button"),document.addEventListener("keydown",O$),()=>{document.removeEventListener("keydown",O$)}),[]);const s={ref:n,tabIndex:0,role:r,"aria-hidden":r?void 0:!0,[f_("focus-guard")]:"",style:zZ};return E.jsx("span",{...e,...s})}),YZ=_.createContext(null),N$=f_("portal");function cRe(t){t===void 0&&(t={});const{id:e,root:n}=t,r=bg(),i=dRe(),[s,o]=_.useState(null),a=_.useRef(null);return is(()=>()=>{s==null||s.remove(),queueMicrotask(()=>{a.current=null})},[s]),is(()=>{if(!r||a.current)return;const l=e?document.getElementById(e):null;if(!l)return;const c=document.createElement("div");c.id=r,c.setAttribute(N$,""),l.appendChild(c),a.current=c,o(c)},[e,r]),is(()=>{if(n===null||!r||a.current)return;let l=n||(i==null?void 0:i.portalNode);l&&!In(l)&&(l=l.current),l=l||document.body;let c=null;e&&(c=document.createElement("div"),c.id=e,l.appendChild(c));const u=document.createElement("div");u.id=r,u.setAttribute(N$,""),l=c||l,l.appendChild(u),a.current=u,o(u)},[e,n,r,i]),s}function uRe(t){const{children:e,id:n,root:r,preserveTabOrder:i=!0}=t,s=cRe({id:n,root:r}),[o,a]=_.useState(null),l=_.useRef(null),c=_.useRef(null),u=_.useRef(null),f=_.useRef(null),p=o==null?void 0:o.modal,m=o==null?void 0:o.open,v=!!o&&!o.modal&&o.open&&i&&!!(r||s);return _.useEffect(()=>{if(!s||!i||p)return;function g(S){s&&Ok(S)&&(S.type==="focusin"?A$:aRe)(s)}return s.addEventListener("focusin",g,!0),s.addEventListener("focusout",g,!0),()=>{s.removeEventListener("focusin",g,!0),s.removeEventListener("focusout",g,!0)}},[s,i,p]),_.useEffect(()=>{s&&(m||A$(s))},[m,s]),E.jsxs(YZ.Provider,{value:_.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:l,afterOutsideRef:c,beforeInsideRef:u,afterInsideRef:f,portalNode:s,setFocusManagerState:a}),[i,s]),children:[v&&s&&E.jsx(M$,{"data-type":"outside",ref:l,onFocus:g=>{if(Ok(g,s)){var S;(S=u.current)==null||S.focus()}else{const b=oRe()||(o==null?void 0:o.domReference);b==null||b.focus()}}}),v&&s&&E.jsx("span",{"aria-owns":s.id,style:zZ}),s&&zg.createPortal(e,s),v&&s&&E.jsx(M$,{"data-type":"outside",ref:c,onFocus:g=>{if(Ok(g,s)){var S;(S=f.current)==null||S.focus()}else{const b=sRe()||(o==null?void 0:o.domReference);b==null||b.focus(),o!=null&&o.closeOnFocusOut&&(o==null||o.onOpenChange(!1,g.nativeEvent,"focus-out"))}}})]})}const dRe=()=>_.useContext(YZ),fRe="data-floating-ui-focusable",hRe={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},pRe={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},D$=t=>{var e,n;return{escapeKey:typeof t=="boolean"?t:(e=t==null?void 0:t.escapeKey)!=null?e:!1,outsidePress:typeof t=="boolean"?t:(n=t==null?void 0:t.outsidePress)!=null?n:!0}};function mRe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,elements:i,dataRef:s}=t,{enabled:o=!0,escapeKey:a=!0,outsidePress:l=!0,outsidePressEvent:c="pointerdown",referencePress:u=!1,referencePressEvent:f="pointerdown",ancestorScroll:p=!1,bubbles:m,capture:v}=e,g=aO(),S=Mc(typeof l=="function"?l:()=>!1),b=typeof l=="function"?S:l,w=_.useRef(!1),k=_.useRef(!1),{escapeKey:T,outsidePress:I}=D$(m),{escapeKey:C,outsidePress:x}=D$(v),A=_.useRef(!1),N=Mc(H=>{var z;if(!n||!o||!a||H.key!=="Escape"||A.current)return;const K=(z=s.current.floatingContext)==null?void 0:z.nodeId,V=g?Ak(g.nodesRef.current,K):[];if(!T&&(H.stopPropagation(),V.length>0)){let q=!0;if(V.forEach(Z=>{var G;if((G=Z.context)!=null&&G.open&&!Z.context.dataRef.current.__escapeKeyBubbles){q=!1;return}}),!q)return}r(!1,NTe(H)?H.nativeEvent:H,"escape-key")}),D=Mc(H=>{var z;const K=()=>{var V;N(H),(V=am(H))==null||V.removeEventListener("keydown",K)};(z=am(H))==null||z.addEventListener("keydown",K)}),F=Mc(H=>{var z;const K=w.current;w.current=!1;const V=k.current;if(k.current=!1,c==="click"&&V||K||typeof b=="function"&&!b(H))return;const q=am(H),Z="["+f_("inert")+"]",G=yd(i.floating).querySelectorAll(Z);let Q=In(q)?q:null;for(;Q&&!qc(Q);){const Te=cu(Q);if(qc(Te)||!In(Te))break;Q=Te}if(G.length&&In(q)&&!DTe(q)&&!_g(q,i.floating)&&Array.from(G).every(Te=>!_g(Q,Te)))return;if(uo(q)&&W){const Te=qc(q),Re=fo(q),we=/auto|scroll/,ve=Te||we.test(Re.overflowX),We=Te||we.test(Re.overflowY),pn=ve&&q.clientWidth>0&&q.scrollWidth>q.clientWidth,hr=We&&q.clientHeight>0&&q.scrollHeight>q.clientHeight,Ft=Re.direction==="rtl",ze=hr&&(Ft?H.offsetX<=q.offsetWidth-q.clientWidth:H.offsetX>q.clientWidth),Fr=pn&&H.offsetY>q.clientHeight;if(ze||Fr)return}const ge=(z=s.current.floatingContext)==null?void 0:z.nodeId,_e=g&&Ak(g.nodesRef.current,ge).some(Te=>{var Re;return kk(H,(Re=Te.context)==null?void 0:Re.elements.floating)});if(kk(H,i.floating)||kk(H,i.domReference)||_e)return;const Pe=g?Ak(g.nodesRef.current,ge):[];if(Pe.length>0){let Te=!0;if(Pe.forEach(Re=>{var we;if((we=Re.context)!=null&&we.open&&!Re.context.dataRef.current.__outsidePressBubbles){Te=!1;return}}),!Te)return}r(!1,H,"outside-press")}),$=Mc(H=>{var z;const K=()=>{var V;F(H),(V=am(H))==null||V.removeEventListener(c,K)};(z=am(H))==null||z.addEventListener(c,K)});_.useEffect(()=>{if(!n||!o)return;s.current.__escapeKeyBubbles=T,s.current.__outsidePressBubbles=I;let H=-1;function z(G){r(!1,G,"ancestor-scroll")}function K(){window.clearTimeout(H),A.current=!0}function V(){H=window.setTimeout(()=>{A.current=!1},uT()?5:0)}const q=yd(i.floating);a&&(q.addEventListener("keydown",C?D:N,C),q.addEventListener("compositionstart",K),q.addEventListener("compositionend",V)),b&&q.addEventListener(c,x?$:F,x);let Z=[];return p&&(In(i.domReference)&&(Z=kd(i.domReference)),In(i.floating)&&(Z=Z.concat(kd(i.floating))),!In(i.reference)&&i.reference&&i.reference.contextElement&&(Z=Z.concat(kd(i.reference.contextElement)))),Z=Z.filter(G=>{var Q;return G!==((Q=q.defaultView)==null?void 0:Q.visualViewport)}),Z.forEach(G=>{G.addEventListener("scroll",z,{passive:!0})}),()=>{a&&(q.removeEventListener("keydown",C?D:N,C),q.removeEventListener("compositionstart",K),q.removeEventListener("compositionend",V)),b&&q.removeEventListener(c,x?$:F,x),Z.forEach(G=>{G.removeEventListener("scroll",z)}),window.clearTimeout(H)}},[s,i,a,b,c,n,r,p,o,T,I,N,C,D,F,x,$]),_.useEffect(()=>{w.current=!1},[b,c]);const B=_.useMemo(()=>({onKeyDown:N,...u&&{[hRe[f]]:H=>{r(!1,H.nativeEvent,"reference-press")},...f!=="click"&&{onClick(H){r(!1,H.nativeEvent,"reference-press")}}}}),[N,r,u,f]),W=_.useMemo(()=>({onKeyDown:N,onMouseDown(){k.current=!0},onMouseUp(){k.current=!0},[pRe[c]]:()=>{w.current=!0}}),[N,c]);return _.useMemo(()=>o?{reference:B,floating:W}:{},[o,B,W])}function gRe(t){const{open:e=!1,onOpenChange:n,elements:r}=t,i=bg(),s=_.useRef({}),[o]=_.useState(()=>Z3e()),a=oO()!=null,[l,c]=_.useState(r.reference),u=Mc((m,v,g)=>{s.current.openEvent=m?v:void 0,o.emit("openchange",{open:m,event:v,reason:g,nested:a}),n==null||n(m,v,g)}),f=_.useMemo(()=>({setPositionReference:c}),[]),p=_.useMemo(()=>({reference:l||r.reference||null,floating:r.floating||null,domReference:r.reference}),[l,r.reference,r.floating]);return _.useMemo(()=>({dataRef:s,open:e,onOpenChange:u,elements:p,events:o,floatingId:i,refs:f}),[e,u,p,o,i,f])}function vRe(t){t===void 0&&(t={});const{nodeId:e}=t,n=gRe({...t,elements:{reference:null,floating:null,...t.elements}}),r=t.rootContext||n,i=r.elements,[s,o]=_.useState(null),[a,l]=_.useState(null),u=(i==null?void 0:i.domReference)||s,f=_.useRef(null),p=aO();is(()=>{u&&(f.current=u)},[u]);const m=UZ({...t,elements:{...i,...a&&{reference:a}}}),v=_.useCallback(k=>{const T=In(k)?{getBoundingClientRect:()=>k.getBoundingClientRect(),contextElement:k}:k;l(T),m.refs.setReference(T)},[m.refs]),g=_.useCallback(k=>{(In(k)||k===null)&&(f.current=k,o(k)),(In(m.refs.reference.current)||m.refs.reference.current===null||k!==null&&!In(k))&&m.refs.setReference(k)},[m.refs]),S=_.useMemo(()=>({...m.refs,setReference:g,setPositionReference:v,domReference:f}),[m.refs,g,v]),b=_.useMemo(()=>({...m.elements,domReference:u}),[m.elements,u]),w=_.useMemo(()=>({...m,...r,refs:S,elements:b,nodeId:e}),[m,S,b,e,r]);return is(()=>{r.dataRef.current.floatingContext=w;const k=p==null?void 0:p.nodesRef.current.find(T=>T.id===e);k&&(k.context=w)}),_.useMemo(()=>({...m,context:w,refs:S,elements:b}),[m,S,b,w])}function yRe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,events:i,dataRef:s,elements:o}=t,{enabled:a=!0,visibleOnly:l=!0}=e,c=_.useRef(!1),u=_.useRef(),f=_.useRef(!0);_.useEffect(()=>{if(!a)return;const m=As(o.domReference);function v(){!n&&uo(o.domReference)&&o.domReference===xP(yd(o.domReference))&&(c.current=!0)}function g(){f.current=!0}return m.addEventListener("blur",v),m.addEventListener("keydown",g,!0),()=>{m.removeEventListener("blur",v),m.removeEventListener("keydown",g,!0)}},[o.domReference,n,a]),_.useEffect(()=>{if(!a)return;function m(v){let{reason:g}=v;(g==="reference-press"||g==="escape-key")&&(c.current=!0)}return i.on("openchange",m),()=>{i.off("openchange",m)}},[i,a]),_.useEffect(()=>()=>{clearTimeout(u.current)},[]);const p=_.useMemo(()=>({onPointerDown(m){ATe(m.nativeEvent)||(f.current=!1)},onMouseLeave(){c.current=!1},onFocus(m){if(c.current)return;const v=am(m.nativeEvent);if(l&&In(v))try{if(wZ()&&OTe())throw Error();if(!v.matches(":focus-visible"))return}catch{if(!f.current&&!UTe(v))return}r(!0,m.nativeEvent,"focus")},onBlur(m){c.current=!1;const v=m.relatedTarget,g=m.nativeEvent,S=In(v)&&v.hasAttribute(f_("focus-guard"))&&v.getAttribute("data-type")==="outside";u.current=window.setTimeout(()=>{var b;const w=xP(o.domReference?o.domReference.ownerDocument:document);!v&&w===o.domReference||_g((b=s.current.floatingContext)==null?void 0:b.refs.floating.current,w)||_g(o.domReference,w)||S||r(!1,g,"focus")})}}),[s,o.domReference,r,l]);return _.useMemo(()=>a?{reference:p}:{},[a,p])}const F$="active",U$="selected";function Mk(t,e,n){const r=new Map,i=n==="item";let s=t;if(i&&t){const{[F$]:o,[U$]:a,...l}=t;s=l}return{...n==="floating"&&{tabIndex:-1,[fRe]:""},...s,...e.map(o=>{const a=o?o[n]:null;return typeof a=="function"?t?a(t):null:a}).concat(t).reduce((o,a)=>(a&&Object.entries(a).forEach(l=>{let[c,u]=l;if(!(i&&[F$,U$].includes(c)))if(c.indexOf("on")===0){if(r.has(c)||r.set(c,[]),typeof u=="function"){var f;(f=r.get(c))==null||f.push(u),o[c]=function(){for(var p,m=arguments.length,v=new Array(m),g=0;g<m;g++)v[g]=arguments[g];return(p=r.get(c))==null?void 0:p.map(S=>S(...v)).find(S=>S!==void 0)}}}else o[c]=u}),o),{})}}function _Re(t){t===void 0&&(t=[]);const e=t.map(a=>a==null?void 0:a.reference),n=t.map(a=>a==null?void 0:a.floating),r=t.map(a=>a==null?void 0:a.item),i=_.useCallback(a=>Mk(a,t,"reference"),e),s=_.useCallback(a=>Mk(a,t,"floating"),n),o=_.useCallback(a=>Mk(a,t,"item"),r);return _.useMemo(()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:o}),[i,s,o])}const bRe=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function SRe(t,e){var n;e===void 0&&(e={});const{open:r,floatingId:i}=t,{enabled:s=!0,role:o="dialog"}=e,a=(n=bRe.get(o))!=null?n:o,l=bg(),u=oO()!=null,f=_.useMemo(()=>a==="tooltip"||o==="label"?{["aria-"+(o==="label"?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":a==="alertdialog"?"dialog":a,"aria-controls":r?i:void 0,...a==="listbox"&&{role:"combobox"},...a==="menu"&&{id:l},...a==="menu"&&u&&{role:"menuitem"},...o==="select"&&{"aria-autocomplete":"none"},...o==="combobox"&&{"aria-autocomplete":"list"}},[a,i,u,r,l,o]),p=_.useMemo(()=>{const v={id:i,...a&&{role:a}};return a==="tooltip"||o==="label"?v:{...v,...a==="menu"&&{"aria-labelledby":l}}},[a,i,l,o]),m=_.useCallback(v=>{let{active:g,selected:S}=v;const b={role:"option",...g&&{id:i+"-option"}};switch(o){case"select":return{...b,"aria-selected":g&&S};case"combobox":return{...b,...g&&{"aria-selected":!0}}}return{}},[i,o]);return _.useMemo(()=>s?{reference:f,floating:p,item:m}:{},[s,f,p,m])}const ERe="_tooltip_1pslb_17",wRe="_invisible_1pslb_30",CRe="_caption_1pslb_37",TRe="_arrow_1pslb_42",oE={tooltip:ERe,invisible:wRe,caption:CRe,arrow:TRe},XZ={open:300,close:0},JZ=({children:t})=>E.jsx(rRe,{delay:XZ,timeoutMs:300,children:t});JZ.displayName="TooltipProvider";function RRe({open:t,disabled:e=!1,onOpenChange:n,placement:r="bottom",isTriggerInteractive:i,caption:s,"aria-atomic":o,"aria-live":a,...l}){const c=bg(),u=bg(),f=_.useRef(null),[p,m]=_.useState(!1),v=e?!1:t??p,g=(B,W,H)=>{n==null||n(B,W,H),t===void 0&&m(B)},S=vRe({placement:r,open:v,onOpenChange:g,whileElementsMounted:DZ,middleware:[jZ(6),BZ({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),$Z({padding:5}),HZ({element:f})]}),b=S.context,{delay:w,initialDelay:k}=iRe(b);if(k!==XZ)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const T=tRe(b,{move:!1,enabled:t===void 0,delay:i?w:{},mouseOnly:!0}),I=yRe(b,{enabled:t===void 0}),C=_.useRef(void 0);_.useEffect(()=>()=>window.clearTimeout(C.current),[]);const x=_.useMemo(()=>{const B=()=>{C.current===void 0?C.current=window.setTimeout(()=>{g(!1),C.current=void 0},1500):window.clearTimeout(C.current)};return{reference:{onTouchStart:()=>{C.current!==void 0&&window.clearTimeout(C.current),C.current=window.setTimeout(()=>{g(!0),C.current=void 0},500)},onTouchEnd:B,onTouchCancel:B}}},[]),A=mRe(b),N="label"in l?"label":"description",D=SRe(b,{enabled:N==="description",role:"tooltip"}),F=_.useMemo(()=>N==="label"?{reference:{"aria-labelledby":c,"aria-describedby":s?u:void 0}}:{},[N,c,u]),$=_Re([T,I,x,A,D,F]);return _.useMemo(()=>({labelId:c,captionId:s?u:void 0,caption:s,purpose:N,open:v,setOpen:g,tooltipProps:{"aria-atomic":o,"aria-live":a},...$,...S,arrowRef:f}),[c,u,s,D,v,g,$,S,f])}const IRe=t=>"label"in t&&!!t.label;function Vi({children:t,isTriggerInteractive:e=!0,nonInteractiveTriggerTabIndex:n=0,...r}){const i=RRe({isTriggerInteractive:e,...r});return E.jsxs(yZ.Provider,{value:i,children:[E.jsx(PRe,{isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n,children:t}),E.jsxs(xRe,{children:[E.jsx("span",{id:i.labelId,children:IRe(r)?r.label:r.description}),E.jsx(kRe,{})]})]})}function kRe(){const{caption:t,captionId:e}=QA();if(!t)return null;const r=typeof t=="string"?"span":"div";return E.jsx(r,{id:e,className:Ne(oE.caption,"cpd-theme-dark"),children:t})}function xRe({children:t}){const{context:e,open:n,arrowRef:r,purpose:i,...s}=QA();return!n&&i!=="label"?null:E.jsx(uRe,{children:E.jsxs("div",{ref:s.refs.setFloating,style:s.floatingStyles,...s.tooltipProps,...s.getFloatingProps(),className:Ne(oE.tooltip,{[oE.invisible]:i==="label"&&!n}),children:[E.jsx(J3e,{ref:r,context:e,width:10,height:6,className:oE.arrow}),t]})})}const PRe=({children:t,isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n})=>{const r=QA(),i=t==null?void 0:t.ref,s=VZ([r.refs.setReference,i]),o=_.useMemo(()=>{if(_.isValidElement(t))if(e){const a=r.getReferenceProps({ref:s});return _.cloneElement(t,a)}else{const a=r.getReferenceProps({ref:s,tabIndex:n}),{"aria-labelledby":l,"aria-describedby":c,...u}=a;return E.jsx("span",{tabIndex:n,...u,children:_.cloneElement(t,{"aria-labelledby":l,"aria-describedby":c})})}},[r,s,t]);if(!o)throw new Error("Tooltip anchor must be a single valid React element");return o},ZZ=_.forwardRef(function({children:e,className:n,indicator:r,size:i="32px",style:s,disabled:o,destructive:a,tooltip:l,subtleBackground:c,...u},f){const p=Ne(Ik["icon-button"],n,{[Ik.destructive]:a,[Ik["subtle-bg"]]:c}),m=E.jsx(vZ,{as:"button",ref:f,className:p,style:{"--cpd-icon-button-size":i,...s},disabled:o,...u,"data-indicator":r,children:E.jsx(xTe,{indicator:r,colour:o?"var(--cpd-color-icon-disabled)":void 0,children:Se.Children.only(e)})});return l?E.jsx(Vi,{label:l,children:m}):m}),LRe=({type:t,title:e,children:n,className:r,actions:i,onClose:s,...o})=>{const a=Ne($p.alert,r),l=_.useCallback(c=>{switch(t){case"critical":return E.jsx(oT,{...c});case"info":return E.jsx(STe,{...c});case"success":return E.jsx(bTe,{...c})}},[t]);return E.jsxs("div",{...o,className:a,"data-type":t,children:[l({width:24,height:24,className:$p.icon,"aria-hidden":!0}),E.jsxs("div",{className:$p.content,children:[E.jsxs("div",{className:$p["text-content"],children:[E.jsx(ln,{size:"md",weight:"semibold",children:e}),E.jsx(ln,{size:"sm",weight:"regular",children:n})]}),i&&E.jsx("div",{className:$p.actions,children:i})]}),s&&E.jsx(ZZ,{onClick:s,"aria-label":"Close",role:"button",className:$p.close,children:E.jsx(aT,{})})]})},ARe="@",ORe="#",MRe="+",NRe=new Intl.Segmenter;function DRe(t){if(t.length<1)return"";const e=t[0];[ARe,ORe,MRe].includes(e)&&(t=t.substring(1));const n=NRe.segment(t)[Symbol.iterator]().next();return n.done?"":n.value.segment}const FRe="_avatar_mcap2_17",URe="_image_mcap2_50",Nk={avatar:FRe,image:URe,"avatar-imageless":"_avatar-imageless_mcap2_61"};function jRe(t){return t.split("").reduce((i,s)=>i+s.charCodeAt(0),0)%6+1}function $Re(t){return!!(t.onClick||t.onKeyDown||t.onKeyUp)}const BRe=_.forwardRef(function({src:e,id:n,name:r="",type:i="round",className:s="",size:o,style:a={},onError:l,...c},u){return Se.createElement($Re(c)?"button":"span",{ref:u,role:"img","aria-label":n,...c,"data-type":i,"data-color":jRe(n),className:Ne(Nk.avatar,s,{[Nk["avatar-imageless"]]:!e}),style:{...a,"--cpd-avatar-size":o}},E.jsx(Se.Fragment,{children:e?E.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:Ne(Nk.image),"data-type":i,style:a,width:o,height:o,onError:l}):DRe(r)}))});function Qe(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t==null||t(i),n===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function HRe(t,e){const n=_.createContext(e),r=s=>{const{children:o,...a}=s,l=_.useMemo(()=>a,Object.values(a));return E.jsx(n.Provider,{value:l,children:o})};r.displayName=t+"Provider";function i(s){const o=_.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,i]}function Zl(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),l=n.length;n=[...n,o];const c=f=>{var b;const{scope:p,children:m,...v}=f,g=((b=p==null?void 0:p[t])==null?void 0:b[l])||a,S=_.useMemo(()=>v,Object.values(v));return E.jsx(g.Provider,{value:S,children:m})};c.displayName=s+"Provider";function u(f,p){var g;const m=((g=p==null?void 0:p[t])==null?void 0:g[l])||a,v=_.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${s}\``)}return[c,u]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const l=(a==null?void 0:a[t])||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return i.scopeName=t,[r,VRe(i,...e)]}function VRe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:l,scopeName:c})=>{const f=l(s)[`__scope${c}`];return{...a,...f}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function j$(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Ql(...t){return e=>{let n=!1;const r=t.map(i=>{const s=j$(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():j$(t[i],null)}}}}function hn(...t){return _.useCallback(Ql(...t),t)}var Sg=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(qRe);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(NP,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(NP,{...r,ref:e,children:n})});Sg.displayName="Slot";var NP=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=WRe(n);return _.cloneElement(n,{...KRe(r,n.props),ref:e?Ql(e,i):i})}return _.Children.count(n)>1?_.Children.only(null):null});NP.displayName="SlotClone";var GRe=({children:t})=>E.jsx(E.Fragment,{children:t});function qRe(t){return _.isValidElement(t)&&t.type===GRe}function KRe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function WRe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var zRe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Cr=zRe.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Sg:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function YRe(t,e){t&&zg.flushSync(()=>t.dispatchEvent(e))}function QZ(t){const e=t+"CollectionProvider",[n,r]=Zl(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:v,children:g}=m,S=Se.useRef(null),b=Se.useRef(new Map).current;return E.jsx(i,{scope:v,itemMap:b,collectionRef:S,children:g})};o.displayName=e;const a=t+"CollectionSlot",l=Se.forwardRef((m,v)=>{const{scope:g,children:S}=m,b=s(a,g),w=hn(v,b.collectionRef);return E.jsx(Sg,{ref:w,children:S})});l.displayName=a;const c=t+"CollectionItemSlot",u="data-radix-collection-item",f=Se.forwardRef((m,v)=>{const{scope:g,children:S,...b}=m,w=Se.useRef(null),k=hn(v,w),T=s(c,g);return Se.useEffect(()=>(T.itemMap.set(w,{ref:w,...b}),()=>void T.itemMap.delete(w))),E.jsx(Sg,{[u]:"",ref:k,children:S})});f.displayName=c;function p(m){const v=s(t+"CollectionConsumer",m);return Se.useCallback(()=>{const S=v.collectionRef.current;if(!S)return[];const b=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((T,I)=>b.indexOf(T.ref.current)-b.indexOf(I.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:l,ItemSlot:f},p,r]}var XRe=_.createContext(void 0);function lO(t){const e=_.useContext(XRe);return t||e||"ltr"}var eQ=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(ZRe);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(DP,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(DP,{...r,ref:e,children:n})});eQ.displayName="Slot";var DP=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=eIe(n),s=QRe(r,n.props);return n.type!==_.Fragment&&(s.ref=e?Ql(e,i):i),_.cloneElement(n,s)}return _.Children.count(n)>1?_.Children.only(null):null});DP.displayName="SlotClone";var JRe=({children:t})=>E.jsx(E.Fragment,{children:t});function ZRe(t){return _.isValidElement(t)&&t.type===JRe}function QRe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function eIe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var tIe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],tQ=tIe.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?eQ:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function nIe(t,e){t&&zg.flushSync(()=>t.dispatchEvent(e))}function Fs(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>{var r;return(r=e.current)==null?void 0:r.call(e,...n)},[])}function rIe(t,e=globalThis==null?void 0:globalThis.document){const n=Fs(t);_.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var iIe="DismissableLayer",FP="dismissableLayer.update",sIe="dismissableLayer.pointerDownOutside",oIe="dismissableLayer.focusOutside",$$,nQ=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),cO=_.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...l}=t,c=_.useContext(nQ),[u,f]=_.useState(null),p=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=_.useState({}),v=hn(e,x=>f(x)),g=Array.from(c.layers),[S]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=g.indexOf(S),w=u?g.indexOf(u):-1,k=c.layersWithOutsidePointerEventsDisabled.size>0,T=w>=b,I=cIe(x=>{const A=x.target,N=[...c.branches].some(D=>D.contains(A));!T||N||(i==null||i(x),o==null||o(x),x.defaultPrevented||a==null||a())},p),C=uIe(x=>{const A=x.target;[...c.branches].some(D=>D.contains(A))||(s==null||s(x),o==null||o(x),x.defaultPrevented||a==null||a())},p);return rIe(x=>{w===c.layers.size-1&&(r==null||r(x),!x.defaultPrevented&&a&&(x.preventDefault(),a()))},p),_.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&($$=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),B$(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=$$)}},[u,p,n,c]),_.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),B$())},[u,c]),_.useEffect(()=>{const x=()=>m({});return document.addEventListener(FP,x),()=>document.removeEventListener(FP,x)},[]),E.jsx(tQ.div,{...l,ref:v,style:{pointerEvents:k?T?"auto":"none":void 0,...t.style},onFocusCapture:Qe(t.onFocusCapture,C.onFocusCapture),onBlurCapture:Qe(t.onBlurCapture,C.onBlurCapture),onPointerDownCapture:Qe(t.onPointerDownCapture,I.onPointerDownCapture)})});cO.displayName=iIe;var aIe="DismissableLayerBranch",lIe=_.forwardRef((t,e)=>{const n=_.useContext(nQ),r=_.useRef(null),i=hn(e,r);return _.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),E.jsx(tQ.div,{...t,ref:i})});lIe.displayName=aIe;function cIe(t,e=globalThis==null?void 0:globalThis.document){const n=Fs(t),r=_.useRef(!1),i=_.useRef(()=>{});return _.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){rQ(sIe,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function uIe(t,e=globalThis==null?void 0:globalThis.document){const n=Fs(t),r=_.useRef(!1);return _.useEffect(()=>{const i=s=>{s.target&&!r.current&&rQ(oIe,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function B$(){const t=new CustomEvent(FP);document.dispatchEvent(t)}function rQ(t,e,n,{discrete:r}){const i=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?nIe(i,s):i.dispatchEvent(s)}var Dk=0;function iQ(){_.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??H$()),document.body.insertAdjacentElement("beforeend",t[1]??H$()),Dk++,()=>{Dk===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Dk--}},[])}function H$(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Fk="focusScope.autoFocusOnMount",Uk="focusScope.autoFocusOnUnmount",V$={bubbles:!1,cancelable:!0},dIe="FocusScope",sQ=_.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,l]=_.useState(null),c=Fs(i),u=Fs(s),f=_.useRef(null),p=hn(e,g=>l(g)),m=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let g=function(k){if(m.paused||!a)return;const T=k.target;a.contains(T)?f.current=T:td(f.current,{select:!0})},S=function(k){if(m.paused||!a)return;const T=k.relatedTarget;T!==null&&(a.contains(T)||td(f.current,{select:!0}))},b=function(k){if(document.activeElement===document.body)for(const I of k)I.removedNodes.length>0&&td(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",S);const w=new MutationObserver(b);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",S),w.disconnect()}}},[r,a,m.paused]),_.useEffect(()=>{if(a){q$.add(m);const g=document.activeElement;if(!a.contains(g)){const b=new CustomEvent(Fk,V$);a.addEventListener(Fk,c),a.dispatchEvent(b),b.defaultPrevented||(fIe(vIe(oQ(a)),{select:!0}),document.activeElement===g&&td(a))}return()=>{a.removeEventListener(Fk,c),setTimeout(()=>{const b=new CustomEvent(Uk,V$);a.addEventListener(Uk,u),a.dispatchEvent(b),b.defaultPrevented||td(g??document.body,{select:!0}),a.removeEventListener(Uk,u),q$.remove(m)},0)}}},[a,c,u,m]);const v=_.useCallback(g=>{if(!n&&!r||m.paused)return;const S=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,b=document.activeElement;if(S&&b){const w=g.currentTarget,[k,T]=hIe(w);k&&T?!g.shiftKey&&b===T?(g.preventDefault(),n&&td(k,{select:!0})):g.shiftKey&&b===k&&(g.preventDefault(),n&&td(T,{select:!0})):b===w&&g.preventDefault()}},[n,r,m.paused]);return E.jsx(Cr.div,{tabIndex:-1,...o,ref:p,onKeyDown:v})});sQ.displayName=dIe;function fIe(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(td(r,{select:e}),document.activeElement!==n)return}function hIe(t){const e=oQ(t),n=G$(e,t),r=G$(e.reverse(),t);return[n,r]}function oQ(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function G$(t,e){for(const n of t)if(!pIe(n,{upTo:e}))return n}function pIe(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function mIe(t){return t instanceof HTMLInputElement&&"select"in t}function td(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&mIe(t)&&e&&t.select()}}var q$=gIe();function gIe(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=K$(t,e),t.unshift(e)},remove(e){var n;t=K$(t,e),(n=t[0])==null||n.resume()}}}function K$(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function vIe(t){return t.filter(e=>e.tagName!=="A")}var Wd=globalThis!=null&&globalThis.document?_.useLayoutEffect:()=>{},yIe=Oz.useId||(()=>{}),_Ie=0;function Kc(t){const[e,n]=_.useState(yIe());return Wd(()=>{n(r=>r??String(_Ie++))},[t]),t||(e?`radix-${e}`:"")}var bIe="Arrow",aQ=_.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...s}=t;return E.jsx(Cr.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:E.jsx("polygon",{points:"0,0 30,0 15,10"})})});aQ.displayName=bIe;var SIe=aQ;function lQ(t){const[e,n]=_.useState(void 0);return Wd(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var uO="Popper",[cQ,uQ]=Zl(uO),[EIe,dQ]=cQ(uO),fQ=t=>{const{__scopePopper:e,children:n}=t,[r,i]=_.useState(null);return E.jsx(EIe,{scope:e,anchor:r,onAnchorChange:i,children:n})};fQ.displayName=uO;var hQ="PopperAnchor",pQ=_.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,s=dQ(hQ,n),o=_.useRef(null),a=hn(e,o);return _.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||o.current)}),r?null:E.jsx(Cr.div,{...i,ref:a})});pQ.displayName=hQ;var dO="PopperContent",[wIe,CIe]=cQ(dO),mQ=_.forwardRef((t,e)=>{var Re,we,ve,We,pn,hr;const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:f="partial",hideWhenDetached:p=!1,updatePositionStrategy:m="optimized",onPlaced:v,...g}=t,S=dQ(dO,n),[b,w]=_.useState(null),k=hn(e,Ft=>w(Ft)),[T,I]=_.useState(null),C=lQ(T),x=(C==null?void 0:C.width)??0,A=(C==null?void 0:C.height)??0,N=r+(s!=="center"?"-"+s:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},F=Array.isArray(c)?c:[c],$=F.length>0,B={padding:D,boundary:F.filter(RIe),altBoundary:$},{refs:W,floatingStyles:H,placement:z,isPositioned:K,middlewareData:V}=UZ({strategy:"fixed",placement:N,whileElementsMounted:(...Ft)=>DZ(...Ft,{animationFrame:m==="always"}),elements:{reference:S.anchor},middleware:[jZ({mainAxis:i+A,alignmentAxis:o}),l&&$Z({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?V3e():void 0,...B}),l&&BZ({...B}),G3e({...B,apply:({elements:Ft,rects:ze,availableWidth:Fr,availableHeight:Tr})=>{const{width:Ki,height:nc}=ze.reference,Bs=Ft.floating.style;Bs.setProperty("--radix-popper-available-width",`${Fr}px`),Bs.setProperty("--radix-popper-available-height",`${Tr}px`),Bs.setProperty("--radix-popper-anchor-width",`${Ki}px`),Bs.setProperty("--radix-popper-anchor-height",`${nc}px`)}}),T&&HZ({element:T,padding:a}),IIe({arrowWidth:x,arrowHeight:A}),p&&q3e({strategy:"referenceHidden",...B})]}),[q,Z]=yQ(z),G=Fs(v);Wd(()=>{K&&(G==null||G())},[K,G]);const Q=(Re=V.arrow)==null?void 0:Re.x,ge=(we=V.arrow)==null?void 0:we.y,_e=((ve=V.arrow)==null?void 0:ve.centerOffset)!==0,[Pe,Te]=_.useState();return Wd(()=>{b&&Te(window.getComputedStyle(b).zIndex)},[b]),E.jsx("div",{ref:W.setFloating,"data-radix-popper-content-wrapper":"",style:{...H,transform:K?H.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Pe,"--radix-popper-transform-origin":[(We=V.transformOrigin)==null?void 0:We.x,(pn=V.transformOrigin)==null?void 0:pn.y].join(" "),...((hr=V.hide)==null?void 0:hr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:E.jsx(wIe,{scope:n,placedSide:q,onArrowChange:I,arrowX:Q,arrowY:ge,shouldHideArrow:_e,children:E.jsx(Cr.div,{"data-side":q,"data-align":Z,...g,ref:k,style:{...g.style,animation:K?void 0:"none"}})})})});mQ.displayName=dO;var gQ="PopperArrow",TIe={top:"bottom",right:"left",bottom:"top",left:"right"},vQ=_.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,s=CIe(gQ,r),o=TIe[s.placedSide];return E.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:E.jsx(SIe,{...i,ref:n,style:{...i.style,display:"block"}})})});vQ.displayName=gQ;function RIe(t){return t!==null}var IIe=t=>({name:"transformOrigin",options:t,fn(e){var S,b,w;const{placement:n,rects:r,middlewareData:i}=e,o=((S=i.arrow)==null?void 0:S.centerOffset)!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=yQ(n),f={start:"0%",center:"50%",end:"100%"}[u],p=(((b=i.arrow)==null?void 0:b.x)??0)+a/2,m=(((w=i.arrow)==null?void 0:w.y)??0)+l/2;let v="",g="";return c==="bottom"?(v=o?f:`${p}px`,g=`${-l}px`):c==="top"?(v=o?f:`${p}px`,g=`${r.floating.height+l}px`):c==="right"?(v=`${-l}px`,g=o?f:`${m}px`):c==="left"&&(v=`${r.floating.width+l}px`,g=o?f:`${m}px`),{data:{x:v,y:g}}}});function yQ(t){const[e,n="center"]=t.split("-");return[e,n]}var kIe=fQ,xIe=pQ,PIe=mQ,LIe=vQ,AIe="Portal",_Q=_.forwardRef((t,e)=>{var a;const{container:n,...r}=t,[i,s]=_.useState(!1);Wd(()=>s(!0),[]);const o=n||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?BX.createPortal(E.jsx(Cr.div,{...r,ref:e}),o):null});_Q.displayName=AIe;function OIe(t,e){return _.useReducer((n,r)=>e[n][r]??n,t)}var lf=t=>{const{present:e,children:n}=t,r=MIe(e),i=typeof n=="function"?n({present:r.isPresent}):_.Children.only(n),s=hn(r.ref,NIe(i));return typeof n=="function"||r.isPresent?_.cloneElement(i,{ref:s}):null};lf.displayName="Presence";function MIe(t){const[e,n]=_.useState(),r=_.useRef({}),i=_.useRef(t),s=_.useRef("none"),o=t?"mounted":"unmounted",[a,l]=OIe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const c=RS(r.current);s.current=a==="mounted"?c:"none"},[a]),Wd(()=>{const c=r.current,u=i.current;if(u!==t){const p=s.current,m=RS(c);t?l("MOUNT"):m==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&p!==m?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,l]),Wd(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,f=m=>{const g=RS(r.current).includes(m.animationName);if(m.target===e&&g&&(l("ANIMATION_END"),!i.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},p=m=>{m.target===e&&(s.current=RS(r.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",f),e.addEventListener("animationend",f),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",f),e.removeEventListener("animationend",f)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function RS(t){return(t==null?void 0:t.animationName)||"none"}function NIe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function fT({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=DIe({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=Fs(n),l=_.useCallback(c=>{if(s){const f=typeof c=="function"?c(t):c;f!==t&&a(f)}else i(c)},[s,t,i,a]);return[o,l]}function DIe({defaultProp:t,onChange:e}){const n=_.useState(t),[r]=n,i=_.useRef(r),s=Fs(e);return _.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}var jk="rovingFocusGroup.onEntryFocus",FIe={bubbles:!1,cancelable:!0},hT="RovingFocusGroup",[UP,bQ,UIe]=QZ(hT),[jIe,SQ]=Zl(hT,[UIe]),[$Ie,BIe]=jIe(hT),EQ=_.forwardRef((t,e)=>E.jsx(UP.Provider,{scope:t.__scopeRovingFocusGroup,children:E.jsx(UP.Slot,{scope:t.__scopeRovingFocusGroup,children:E.jsx(HIe,{...t,ref:e})})}));EQ.displayName=hT;var HIe=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...f}=t,p=_.useRef(null),m=hn(e,p),v=lO(s),[g=null,S]=fT({prop:o,defaultProp:a,onChange:l}),[b,w]=_.useState(!1),k=Fs(c),T=bQ(n),I=_.useRef(!1),[C,x]=_.useState(0);return _.useEffect(()=>{const A=p.current;if(A)return A.addEventListener(jk,k),()=>A.removeEventListener(jk,k)},[k]),E.jsx($Ie,{scope:n,orientation:r,dir:v,loop:i,currentTabStopId:g,onItemFocus:_.useCallback(A=>S(A),[S]),onItemShiftTab:_.useCallback(()=>w(!0),[]),onFocusableItemAdd:_.useCallback(()=>x(A=>A+1),[]),onFocusableItemRemove:_.useCallback(()=>x(A=>A-1),[]),children:E.jsx(Cr.div,{tabIndex:b||C===0?-1:0,"data-orientation":r,...f,ref:m,style:{outline:"none",...t.style},onMouseDown:Qe(t.onMouseDown,()=>{I.current=!0}),onFocus:Qe(t.onFocus,A=>{const N=!I.current;if(A.target===A.currentTarget&&N&&!b){const D=new CustomEvent(jk,FIe);if(A.currentTarget.dispatchEvent(D),!D.defaultPrevented){const F=T().filter(z=>z.focusable),$=F.find(z=>z.active),B=F.find(z=>z.id===g),H=[$,B,...F].filter(Boolean).map(z=>z.ref.current);TQ(H,u)}}I.current=!1}),onBlur:Qe(t.onBlur,()=>w(!1))})})}),wQ="RovingFocusGroupItem",CQ=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:s,...o}=t,a=Kc(),l=s||a,c=BIe(wQ,n),u=c.currentTabStopId===l,f=bQ(n),{onFocusableItemAdd:p,onFocusableItemRemove:m}=c;return _.useEffect(()=>{if(r)return p(),()=>m()},[r,p,m]),E.jsx(UP.ItemSlot,{scope:n,id:l,focusable:r,active:i,children:E.jsx(Cr.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...o,ref:e,onMouseDown:Qe(t.onMouseDown,v=>{r?c.onItemFocus(l):v.preventDefault()}),onFocus:Qe(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:Qe(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){c.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const g=qIe(v,c.orientation,c.dir);if(g!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let b=f().filter(w=>w.focusable).map(w=>w.ref.current);if(g==="last")b.reverse();else if(g==="prev"||g==="next"){g==="prev"&&b.reverse();const w=b.indexOf(v.currentTarget);b=c.loop?KIe(b,w+1):b.slice(w+1)}setTimeout(()=>TQ(b))}})})})});CQ.displayName=wQ;var VIe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function GIe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function qIe(t,e,n){const r=GIe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return VIe[r]}function TQ(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function KIe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var WIe=EQ,zIe=CQ,YIe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Bp=new WeakMap,IS=new WeakMap,kS={},$k=0,RQ=function(t){return t&&(t.host||RQ(t.parentNode))},XIe=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=RQ(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},JIe=function(t,e,n,r){var i=XIe(e,Array.isArray(t)?t:[t]);kS[n]||(kS[n]=new WeakMap);var s=kS[n],o=[],a=new Set,l=new Set(i),c=function(f){!f||a.has(f)||(a.add(f),c(f.parentNode))};i.forEach(c);var u=function(f){!f||l.has(f)||Array.prototype.forEach.call(f.children,function(p){if(a.has(p))u(p);else try{var m=p.getAttribute(r),v=m!==null&&m!=="false",g=(Bp.get(p)||0)+1,S=(s.get(p)||0)+1;Bp.set(p,g),s.set(p,S),o.push(p),g===1&&v&&IS.set(p,!0),S===1&&p.setAttribute(n,"true"),v||p.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",p,b)}})};return u(e),a.clear(),$k++,function(){o.forEach(function(f){var p=Bp.get(f)-1,m=s.get(f)-1;Bp.set(f,p),s.set(f,m),p||(IS.has(f)||f.removeAttribute(r),IS.delete(f)),m||f.removeAttribute(n)}),$k--,$k||(Bp=new WeakMap,Bp=new WeakMap,IS=new WeakMap,kS={})}},IQ=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=YIe(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),JIe(r,i,n,"aria-hidden")):function(){return null}},jP=function(t,e){return jP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},jP(t,e)};function ia(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");jP(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var hi=function(){return hi=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},hi.apply(this,arguments)};function h_(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function kQ(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function xQ(t,e){return function(n,r){e(n,r,t)}}function PQ(t,e,n,r,i,s){function o(b){if(b!==void 0&&typeof b!="function")throw new TypeError("Function expected");return b}for(var a=r.kind,l=a==="getter"?"get":a==="setter"?"set":"value",c=!e&&t?r.static?t:t.prototype:null,u=e||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),f,p=!1,m=n.length-1;m>=0;m--){var v={};for(var g in r)v[g]=g==="access"?{}:r[g];for(var g in r.access)v.access[g]=r.access[g];v.addInitializer=function(b){if(p)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(b||null))};var S=(0,n[m])(a==="accessor"?{get:u.get,set:u.set}:u[l],v);if(a==="accessor"){if(S===void 0)continue;if(S===null||typeof S!="object")throw new TypeError("Object expected");(f=o(S.get))&&(u.get=f),(f=o(S.set))&&(u.set=f),(f=o(S.init))&&i.unshift(f)}else(f=o(S))&&(a==="field"?i.unshift(f):u[l]=f)}c&&Object.defineProperty(c,r.name,u),p=!0}function LQ(t,e,n){for(var r=arguments.length>2,i=0;i<e.length;i++)n=r?e[i].call(t,n):e[i].call(t);return r?n:void 0}function AQ(t){return typeof t=="symbol"?t:"".concat(t)}function OQ(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function MQ(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function fO(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}function pT(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var mT=Object.create?function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};function NQ(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&mT(e,t,n)}function zd(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Jo(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function DQ(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Jo(arguments[e]));return t}function FQ(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Zo(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Wc(t){return this instanceof Wc?(this.v=t,this):new Wc(t)}function hO(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(m){return function(v){return Promise.resolve(v).then(m,f)}}function a(m,v){r[m]&&(i[m]=function(g){return new Promise(function(S,b){s.push([m,g,S,b])>1||l(m,g)})},v&&(i[m]=v(i[m])))}function l(m,v){try{c(r[m](v))}catch(g){p(s[0][3],g)}}function c(m){m.value instanceof Wc?Promise.resolve(m.value.v).then(u,f):p(s[0][2],m)}function u(m){l("next",m)}function f(m){l("throw",m)}function p(m,v){m(v),s.shift(),s.length&&l(s[0][0],s[0][1])}}function UQ(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Wc(t[i](o)),done:!1}:s?s(o):o}:s}}function pO(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof zd=="function"?zd(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function jQ(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var ZIe=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},$P=function(t){return $P=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},$P(t)};function $Q(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=$P(t),r=0;r<n.length;r++)n[r]!=="default"&&mT(e,t,n[r]);return ZIe(e,t),e}function BQ(t){return t&&t.__esModule?t:{default:t}}function HQ(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function VQ(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function GQ(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function qQ(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var QIe=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function KQ(t){function e(s){t.error=t.hasError?new QIe(s,t.error,"An error was suppressed during disposal."):s,t.hasError=!0}var n,r=0;function i(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(i);if(n.dispose){var s=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return i()}function WQ(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?n:i+s+"."+o.toLowerCase()+"js"}):t}const eke={__extends:ia,__assign:hi,__rest:h_,__decorate:kQ,__param:xQ,__esDecorate:PQ,__runInitializers:LQ,__propKey:AQ,__setFunctionName:OQ,__metadata:MQ,__awaiter:fO,__generator:pT,__createBinding:mT,__exportStar:NQ,__values:zd,__read:Jo,__spread:DQ,__spreadArrays:FQ,__spreadArray:Zo,__await:Wc,__asyncGenerator:hO,__asyncDelegator:UQ,__asyncValues:pO,__makeTemplateObject:jQ,__importStar:$Q,__importDefault:BQ,__classPrivateFieldGet:HQ,__classPrivateFieldSet:VQ,__classPrivateFieldIn:GQ,__addDisposableResource:qQ,__disposeResources:KQ,__rewriteRelativeImportExtension:WQ},Dnt=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:qQ,get __assign(){return hi},__asyncDelegator:UQ,__asyncGenerator:hO,__asyncValues:pO,__await:Wc,__awaiter:fO,__classPrivateFieldGet:HQ,__classPrivateFieldIn:GQ,__classPrivateFieldSet:VQ,__createBinding:mT,__decorate:kQ,__disposeResources:KQ,__esDecorate:PQ,__exportStar:NQ,__extends:ia,__generator:pT,__importDefault:BQ,__importStar:$Q,__makeTemplateObject:jQ,__metadata:MQ,__param:xQ,__propKey:AQ,__read:Jo,__rest:h_,__rewriteRelativeImportExtension:WQ,__runInitializers:LQ,__setFunctionName:OQ,__spread:DQ,__spreadArray:Zo,__spreadArrays:FQ,__values:zd,default:eke},Symbol.toStringTag,{value:"Module"}));var R1="right-scroll-bar-position",I1="width-before-scroll-bar",tke="with-scroll-bars-hidden",nke="--removed-body-scroll-bar-size";function Bk(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function rke(t,e){var n=_.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var ike=typeof window<"u"?_.useLayoutEffect:_.useEffect,W$=new WeakMap;function zQ(t,e){var n=rke(null,function(r){return t.forEach(function(i){return Bk(i,r)})});return ike(function(){var r=W$.get(n);if(r){var i=new Set(r),s=new Set(t),o=n.current;i.forEach(function(a){s.has(a)||Bk(a,null)}),s.forEach(function(a){i.has(a)||Bk(a,o)})}W$.set(n,t)},[t]),n}function ske(t){return t}function oke(t,e){e===void 0&&(e=ske);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,r);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var l=function(){var u=o;o=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),n}}}};return i}function YQ(t){t===void 0&&(t={});var e=oke(null);return e.options=hi({async:!0,ssr:!1},t),e}var XQ=function(t){var e=t.sideCar,n=h_(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,hi({},n))};XQ.isSideCarExport=!0;function JQ(t,e){return t.useMedium(e),XQ}var ZQ=YQ(),Hk=function(){},gT=_.forwardRef(function(t,e){var n=_.useRef(null),r=_.useState({onScrollCapture:Hk,onWheelCapture:Hk,onTouchMoveCapture:Hk}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,f=t.shards,p=t.sideCar,m=t.noIsolation,v=t.inert,g=t.allowPinchZoom,S=t.as,b=S===void 0?"div":S,w=t.gapMode,k=h_(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),T=p,I=zQ([n,e]),C=hi(hi({},k),i);return _.createElement(_.Fragment,null,u&&_.createElement(T,{sideCar:ZQ,removeScrollBar:c,shards:f,noIsolation:m,inert:v,setCallbacks:s,allowPinchZoom:!!g,lockRef:n,gapMode:w}),o?_.cloneElement(_.Children.only(a),hi(hi({},C),{ref:I})):_.createElement(b,hi({},C,{className:l,ref:I}),a))});gT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gT.classNames={fullWidth:I1,zeroRight:R1};var ake=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function lke(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=ake();return e&&t.setAttribute("nonce",e),t}function cke(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function uke(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var dke=function(){var t=0,e=null;return{add:function(n){t==0&&(e=lke())&&(cke(e,n),uke(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},fke=function(){var t=dke();return function(e,n){_.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},mO=function(){var t=fke(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},hke={left:0,top:0,right:0,gap:0},Vk=function(t){return parseInt(t||"",10)||0},pke=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[Vk(n),Vk(r),Vk(i)]},mke=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return hke;var e=pke(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},gke=mO(),Bm="data-scroll-locked",vke=function(t,e,n,r){var i=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(tke,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Bm,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(R1,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(I1,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(R1," .").concat(R1,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(I1," .").concat(I1,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Bm,`] {
    `).concat(nke,": ").concat(a,`px;
  }
`)},z$=function(){var t=parseInt(document.body.getAttribute(Bm)||"0",10);return isFinite(t)?t:0},yke=function(){_.useEffect(function(){return document.body.setAttribute(Bm,(z$()+1).toString()),function(){var t=z$()-1;t<=0?document.body.removeAttribute(Bm):document.body.setAttribute(Bm,t.toString())}},[])},QQ=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;yke();var s=_.useMemo(function(){return mke(i)},[i]);return _.createElement(gke,{styles:vke(s,!e,i,n?"":"!important")})},BP=!1;if(typeof window<"u")try{var xS=Object.defineProperty({},"passive",{get:function(){return BP=!0,!0}});window.addEventListener("test",xS,xS),window.removeEventListener("test",xS,xS)}catch{BP=!1}var Hp=BP?{passive:!1}:!1,_ke=function(t){return t.tagName==="TEXTAREA"},eee=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!_ke(t)&&n[e]==="visible")},bke=function(t){return eee(t,"overflowY")},Ske=function(t){return eee(t,"overflowX")},Y$=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=tee(t,r);if(i){var s=nee(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Eke=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},wke=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},tee=function(t,e){return t==="v"?bke(e):Ske(e)},nee=function(t,e){return t==="v"?Eke(e):wke(e)},Cke=function(t,e){return t==="h"&&e==="rtl"?-1:1},Tke=function(t,e,n,r,i){var s=Cke(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,l=e.contains(a),c=!1,u=o>0,f=0,p=0;do{var m=nee(t,a),v=m[0],g=m[1],S=m[2],b=g-S-s*v;(v||b)&&tee(t,a)&&(f+=b,p+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(f)<1||!u&&Math.abs(p)<1)&&(c=!0),c},PS=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},X$=function(t){return[t.deltaX,t.deltaY]},J$=function(t){return t&&"current"in t?t.current:t},Rke=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ike=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},kke=0,Vp=[];function xke(t){var e=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(kke++)[0],s=_.useState(mO)[0],o=_.useRef(t);_.useEffect(function(){o.current=t},[t]),_.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var g=Zo([t.lockRef.current],(t.shards||[]).map(J$),!0).filter(Boolean);return g.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),g.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=_.useCallback(function(g,S){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var b=PS(g),w=n.current,k="deltaX"in g?g.deltaX:w[0]-b[0],T="deltaY"in g?g.deltaY:w[1]-b[1],I,C=g.target,x=Math.abs(k)>Math.abs(T)?"h":"v";if("touches"in g&&x==="h"&&C.type==="range")return!1;var A=Y$(x,C);if(!A)return!0;if(A?I=x:(I=x==="v"?"h":"v",A=Y$(x,C)),!A)return!1;if(!r.current&&"changedTouches"in g&&(k||T)&&(r.current=I),!I)return!0;var N=r.current||I;return Tke(N,S,g,N==="h"?k:T)},[]),l=_.useCallback(function(g){var S=g;if(!(!Vp.length||Vp[Vp.length-1]!==s)){var b="deltaY"in S?X$(S):PS(S),w=e.current.filter(function(I){return I.name===S.type&&(I.target===S.target||S.target===I.shadowParent)&&Rke(I.delta,b)})[0];if(w&&w.should){S.cancelable&&S.preventDefault();return}if(!w){var k=(o.current.shards||[]).map(J$).filter(Boolean).filter(function(I){return I.contains(S.target)}),T=k.length>0?a(S,k[0]):!o.current.noIsolation;T&&S.cancelable&&S.preventDefault()}}},[]),c=_.useCallback(function(g,S,b,w){var k={name:g,delta:S,target:b,should:w,shadowParent:Pke(b)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(T){return T!==k})},1)},[]),u=_.useCallback(function(g){n.current=PS(g),r.current=void 0},[]),f=_.useCallback(function(g){c(g.type,X$(g),g.target,a(g,t.lockRef.current))},[]),p=_.useCallback(function(g){c(g.type,PS(g),g.target,a(g,t.lockRef.current))},[]);_.useEffect(function(){return Vp.push(s),t.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",l,Hp),document.addEventListener("touchmove",l,Hp),document.addEventListener("touchstart",u,Hp),function(){Vp=Vp.filter(function(g){return g!==s}),document.removeEventListener("wheel",l,Hp),document.removeEventListener("touchmove",l,Hp),document.removeEventListener("touchstart",u,Hp)}},[]);var m=t.removeScrollBar,v=t.inert;return _.createElement(_.Fragment,null,v?_.createElement(s,{styles:Ike(i)}):null,m?_.createElement(QQ,{gapMode:t.gapMode}):null)}function Pke(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Lke=JQ(ZQ,xke);var ree=_.forwardRef(function(t,e){return _.createElement(gT,hi({},t,{ref:e,sideCar:Lke}))});ree.classNames=gT.classNames;var HP=["Enter"," "],Ake=["ArrowDown","PageUp","Home"],iee=["ArrowUp","PageDown","End"],Oke=[...Ake,...iee],Mke={ltr:[...HP,"ArrowRight"],rtl:[...HP,"ArrowLeft"]},Nke={ltr:["ArrowLeft"],rtl:["ArrowRight"]},p_="Menu",[hy,Dke,Fke]=QZ(p_),[Yh,vT]=Zl(p_,[Fke,uQ,SQ]),yT=uQ(),see=SQ(),[Uke,Xh]=Yh(p_),[jke,m_]=Yh(p_),oee=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=t,a=yT(e),[l,c]=_.useState(null),u=_.useRef(!1),f=Fs(s),p=lO(i);return _.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),E.jsx(kIe,{...a,children:E.jsx(Uke,{scope:e,open:n,onOpenChange:f,content:l,onContentChange:c,children:E.jsx(jke,{scope:e,onClose:_.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:u,dir:p,modal:o,children:r})})})};oee.displayName=p_;var $ke="MenuAnchor",gO=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=yT(n);return E.jsx(xIe,{...i,...r,ref:e})});gO.displayName=$ke;var vO="MenuPortal",[Bke,aee]=Yh(vO,{forceMount:void 0}),lee=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,s=Xh(vO,e);return E.jsx(Bke,{scope:e,forceMount:n,children:E.jsx(lf,{present:n||s.open,children:E.jsx(_Q,{asChild:!0,container:i,children:r})})})};lee.displayName=vO;var Ko="MenuContent",[Hke,yO]=Yh(Ko),cee=_.forwardRef((t,e)=>{const n=aee(Ko,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Xh(Ko,t.__scopeMenu),o=m_(Ko,t.__scopeMenu);return E.jsx(hy.Provider,{scope:t.__scopeMenu,children:E.jsx(lf,{present:r||s.open,children:E.jsx(hy.Slot,{scope:t.__scopeMenu,children:o.modal?E.jsx(Vke,{...i,ref:e}):E.jsx(Gke,{...i,ref:e})})})})}),Vke=_.forwardRef((t,e)=>{const n=Xh(Ko,t.__scopeMenu),r=_.useRef(null),i=hn(e,r);return _.useEffect(()=>{const s=r.current;if(s)return IQ(s)},[]),E.jsx(_O,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Qe(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Gke=_.forwardRef((t,e)=>{const n=Xh(Ko,t.__scopeMenu);return E.jsx(_O,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),_O=_.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:p,onDismiss:m,disableOutsideScroll:v,...g}=t,S=Xh(Ko,n),b=m_(Ko,n),w=yT(n),k=see(n),T=Dke(n),[I,C]=_.useState(null),x=_.useRef(null),A=hn(e,x,S.onContentChange),N=_.useRef(0),D=_.useRef(""),F=_.useRef(0),$=_.useRef(null),B=_.useRef("right"),W=_.useRef(0),H=v?ree:_.Fragment,z=v?{as:Sg,allowPinchZoom:!0}:void 0,K=q=>{var Re,we;const Z=D.current+q,G=T().filter(ve=>!ve.disabled),Q=document.activeElement,ge=(Re=G.find(ve=>ve.ref.current===Q))==null?void 0:Re.textValue,_e=G.map(ve=>ve.textValue),Pe=n4e(_e,Z,ge),Te=(we=G.find(ve=>ve.textValue===Pe))==null?void 0:we.ref.current;(function ve(We){D.current=We,window.clearTimeout(N.current),We!==""&&(N.current=window.setTimeout(()=>ve(""),1e3))})(Z),Te&&setTimeout(()=>Te.focus())};_.useEffect(()=>()=>window.clearTimeout(N.current),[]),iQ();const V=_.useCallback(q=>{var G,Q;return B.current===((G=$.current)==null?void 0:G.side)&&i4e(q,(Q=$.current)==null?void 0:Q.area)},[]);return E.jsx(Hke,{scope:n,searchRef:D,onItemEnter:_.useCallback(q=>{V(q)&&q.preventDefault()},[V]),onItemLeave:_.useCallback(q=>{var Z;V(q)||((Z=x.current)==null||Z.focus(),C(null))},[V]),onTriggerLeave:_.useCallback(q=>{V(q)&&q.preventDefault()},[V]),pointerGraceTimerRef:F,onPointerGraceIntentChange:_.useCallback(q=>{$.current=q},[]),children:E.jsx(H,{...z,children:E.jsx(sQ,{asChild:!0,trapped:i,onMountAutoFocus:Qe(s,q=>{var Z;q.preventDefault(),(Z=x.current)==null||Z.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:E.jsx(cO,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:p,onDismiss:m,children:E.jsx(WIe,{asChild:!0,...k,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:I,onCurrentTabStopIdChange:C,onEntryFocus:Qe(l,q=>{b.isUsingKeyboardRef.current||q.preventDefault()}),preventScrollOnEntryFocus:!0,children:E.jsx(PIe,{role:"menu","aria-orientation":"vertical","data-state":Tee(S.open),"data-radix-menu-content":"",dir:b.dir,...w,...g,ref:A,style:{outline:"none",...g.style},onKeyDown:Qe(g.onKeyDown,q=>{const G=q.target.closest("[data-radix-menu-content]")===q.currentTarget,Q=q.ctrlKey||q.altKey||q.metaKey,ge=q.key.length===1;G&&(q.key==="Tab"&&q.preventDefault(),!Q&&ge&&K(q.key));const _e=x.current;if(q.target!==_e||!Oke.includes(q.key))return;q.preventDefault();const Te=T().filter(Re=>!Re.disabled).map(Re=>Re.ref.current);iee.includes(q.key)&&Te.reverse(),e4e(Te)}),onBlur:Qe(t.onBlur,q=>{q.currentTarget.contains(q.target)||(window.clearTimeout(N.current),D.current="")}),onPointerMove:Qe(t.onPointerMove,py(q=>{const Z=q.target,G=W.current!==q.clientX;if(q.currentTarget.contains(Z)&&G){const Q=q.clientX>W.current?"right":"left";B.current=Q,W.current=q.clientX}}))})})})})})})});cee.displayName=Ko;var qke="MenuGroup",bO=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return E.jsx(Cr.div,{role:"group",...r,ref:e})});bO.displayName=qke;var Kke="MenuLabel",uee=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return E.jsx(Cr.div,{...r,ref:e})});uee.displayName=Kke;var ww="MenuItem",Z$="menu.itemSelect",_T=_.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,s=_.useRef(null),o=m_(ww,t.__scopeMenu),a=yO(ww,t.__scopeMenu),l=hn(e,s),c=_.useRef(!1),u=()=>{const f=s.current;if(!n&&f){const p=new CustomEvent(Z$,{bubbles:!0,cancelable:!0});f.addEventListener(Z$,m=>r==null?void 0:r(m),{once:!0}),YRe(f,p),p.defaultPrevented?c.current=!1:o.onClose()}};return E.jsx(dee,{...i,ref:l,disabled:n,onClick:Qe(t.onClick,u),onPointerDown:f=>{var p;(p=t.onPointerDown)==null||p.call(t,f),c.current=!0},onPointerUp:Qe(t.onPointerUp,f=>{var p;c.current||(p=f.currentTarget)==null||p.click()}),onKeyDown:Qe(t.onKeyDown,f=>{const p=a.searchRef.current!=="";n||p&&f.key===" "||HP.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});_T.displayName=ww;var dee=_.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...s}=t,o=yO(ww,n),a=see(n),l=_.useRef(null),c=hn(e,l),[u,f]=_.useState(!1),[p,m]=_.useState("");return _.useEffect(()=>{const v=l.current;v&&m((v.textContent??"").trim())},[s.children]),E.jsx(hy.ItemSlot,{scope:n,disabled:r,textValue:i??p,children:E.jsx(zIe,{asChild:!0,...a,focusable:!r,children:E.jsx(Cr.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:c,onPointerMove:Qe(t.onPointerMove,py(v=>{r?o.onItemLeave(v):(o.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Qe(t.onPointerLeave,py(v=>o.onItemLeave(v))),onFocus:Qe(t.onFocus,()=>f(!0)),onBlur:Qe(t.onBlur,()=>f(!1))})})})}),Wke="MenuCheckboxItem",fee=_.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return E.jsx(vee,{scope:t.__scopeMenu,checked:n,children:E.jsx(_T,{role:"menuitemcheckbox","aria-checked":Cw(n)?"mixed":n,...i,ref:e,"data-state":EO(n),onSelect:Qe(i.onSelect,()=>r==null?void 0:r(Cw(n)?!0:!n),{checkForDefaultPrevented:!1})})})});fee.displayName=Wke;var hee="MenuRadioGroup",[zke,Yke]=Yh(hee,{value:void 0,onValueChange:()=>{}}),pee=_.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,s=Fs(r);return E.jsx(zke,{scope:t.__scopeMenu,value:n,onValueChange:s,children:E.jsx(bO,{...i,ref:e})})});pee.displayName=hee;var mee="MenuRadioItem",gee=_.forwardRef((t,e)=>{const{value:n,...r}=t,i=Yke(mee,t.__scopeMenu),s=n===i.value;return E.jsx(vee,{scope:t.__scopeMenu,checked:s,children:E.jsx(_T,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":EO(s),onSelect:Qe(r.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,n)},{checkForDefaultPrevented:!1})})})});gee.displayName=mee;var SO="MenuItemIndicator",[vee,Xke]=Yh(SO,{checked:!1}),yee=_.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,s=Xke(SO,n);return E.jsx(lf,{present:r||Cw(s.checked)||s.checked===!0,children:E.jsx(Cr.span,{...i,ref:e,"data-state":EO(s.checked)})})});yee.displayName=SO;var Jke="MenuSeparator",_ee=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return E.jsx(Cr.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});_ee.displayName=Jke;var Zke="MenuArrow",bee=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=yT(n);return E.jsx(LIe,{...i,...r,ref:e})});bee.displayName=Zke;var Qke="MenuSub",[Fnt,See]=Yh(Qke),n1="MenuSubTrigger",Eee=_.forwardRef((t,e)=>{const n=Xh(n1,t.__scopeMenu),r=m_(n1,t.__scopeMenu),i=See(n1,t.__scopeMenu),s=yO(n1,t.__scopeMenu),o=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=s,c={__scopeMenu:t.__scopeMenu},u=_.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return _.useEffect(()=>u,[u]),_.useEffect(()=>{const f=a.current;return()=>{window.clearTimeout(f),l(null)}},[a,l]),E.jsx(gO,{asChild:!0,...c,children:E.jsx(dee,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":Tee(n.open),...t,ref:Ql(e,i.onTriggerChange),onClick:f=>{var p;(p=t.onClick)==null||p.call(t,f),!(t.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Qe(t.onPointerMove,py(f=>{s.onItemEnter(f),!f.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:Qe(t.onPointerLeave,py(f=>{var m,v;u();const p=(m=n.content)==null?void 0:m.getBoundingClientRect();if(p){const g=(v=n.content)==null?void 0:v.dataset.side,S=g==="right",b=S?-5:5,w=p[S?"left":"right"],k=p[S?"right":"left"];s.onPointerGraceIntentChange({area:[{x:f.clientX+b,y:f.clientY},{x:w,y:p.top},{x:k,y:p.top},{x:k,y:p.bottom},{x:w,y:p.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(f),f.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Qe(t.onKeyDown,f=>{var m;const p=s.searchRef.current!=="";t.disabled||p&&f.key===" "||Mke[r.dir].includes(f.key)&&(n.onOpenChange(!0),(m=n.content)==null||m.focus(),f.preventDefault())})})})});Eee.displayName=n1;var wee="MenuSubContent",Cee=_.forwardRef((t,e)=>{const n=aee(Ko,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Xh(Ko,t.__scopeMenu),o=m_(Ko,t.__scopeMenu),a=See(wee,t.__scopeMenu),l=_.useRef(null),c=hn(e,l);return E.jsx(hy.Provider,{scope:t.__scopeMenu,children:E.jsx(lf,{present:r||s.open,children:E.jsx(hy.Slot,{scope:t.__scopeMenu,children:E.jsx(_O,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var f;o.isUsingKeyboardRef.current&&((f=l.current)==null||f.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Qe(t.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Qe(t.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:Qe(t.onKeyDown,u=>{var m;const f=u.currentTarget.contains(u.target),p=Nke[o.dir].includes(u.key);f&&p&&(s.onOpenChange(!1),(m=a.trigger)==null||m.focus(),u.preventDefault())})})})})})});Cee.displayName=wee;function Tee(t){return t?"open":"closed"}function Cw(t){return t==="indeterminate"}function EO(t){return Cw(t)?"indeterminate":t?"checked":"unchecked"}function e4e(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function t4e(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function n4e(t,e,n){const i=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=t4e(t,Math.max(s,0));i.length===1&&(o=o.filter(c=>c!==n));const l=o.find(c=>c.toLowerCase().startsWith(i.toLowerCase()));return l!==n?l:void 0}function r4e(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,l=e[s].y,c=e[o].x,u=e[o].y;l>r!=u>r&&n<(c-a)*(r-l)/(u-l)+a&&(i=!i)}return i}function i4e(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return r4e(n,e)}function py(t){return e=>e.pointerType==="mouse"?t(e):void 0}var Ree=oee,Iee=gO,kee=lee,xee=cee,Pee=bO,Lee=uee,Aee=_T,Oee=fee,Mee=pee,Nee=gee,Dee=yee,Fee=_ee,Uee=bee,jee=Eee,$ee=Cee,wO="ContextMenu",[s4e,Unt]=Zl(wO,[vT]),os=vT(),[o4e,Bee]=s4e(wO),Hee=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:i,modal:s=!0}=t,[o,a]=_.useState(!1),l=os(e),c=Fs(r),u=_.useCallback(f=>{a(f),c(f)},[c]);return E.jsx(o4e,{scope:e,open:o,onOpenChange:u,modal:s,children:E.jsx(Ree,{...l,dir:i,open:o,onOpenChange:u,modal:s,children:n})})};Hee.displayName=wO;var Vee="ContextMenuTrigger",Gee=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=t,s=Bee(Vee,n),o=os(n),a=_.useRef({x:0,y:0}),l=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=_.useRef(0),u=_.useCallback(()=>window.clearTimeout(c.current),[]),f=p=>{a.current={x:p.clientX,y:p.clientY},s.onOpenChange(!0)};return _.useEffect(()=>u,[u]),_.useEffect(()=>void(r&&u()),[r,u]),E.jsxs(E.Fragment,{children:[E.jsx(Iee,{...o,virtualRef:l}),E.jsx(Cr.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:Qe(t.onContextMenu,p=>{u(),f(p),p.preventDefault()}),onPointerDown:r?t.onPointerDown:Qe(t.onPointerDown,LS(p=>{u(),c.current=window.setTimeout(()=>f(p),700)})),onPointerMove:r?t.onPointerMove:Qe(t.onPointerMove,LS(u)),onPointerCancel:r?t.onPointerCancel:Qe(t.onPointerCancel,LS(u)),onPointerUp:r?t.onPointerUp:Qe(t.onPointerUp,LS(u))})]})});Gee.displayName=Vee;var a4e="ContextMenuPortal",qee=t=>{const{__scopeContextMenu:e,...n}=t,r=os(e);return E.jsx(kee,{...r,...n})};qee.displayName=a4e;var Kee="ContextMenuContent",Wee=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Bee(Kee,n),s=os(n),o=_.useRef(!1);return E.jsx(xee,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=t.onCloseAutoFocus)==null||l.call(t,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var l;(l=t.onInteractOutside)==null||l.call(t,a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Wee.displayName=Kee;var l4e="ContextMenuGroup",c4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Pee,{...i,...r,ref:e})});c4e.displayName=l4e;var u4e="ContextMenuLabel",d4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Lee,{...i,...r,ref:e})});d4e.displayName=u4e;var f4e="ContextMenuItem",zee=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Aee,{...i,...r,ref:e})});zee.displayName=f4e;var h4e="ContextMenuCheckboxItem",p4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Oee,{...i,...r,ref:e})});p4e.displayName=h4e;var m4e="ContextMenuRadioGroup",g4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Mee,{...i,...r,ref:e})});g4e.displayName=m4e;var v4e="ContextMenuRadioItem",y4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Nee,{...i,...r,ref:e})});y4e.displayName=v4e;var _4e="ContextMenuItemIndicator",b4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Dee,{...i,...r,ref:e})});b4e.displayName=_4e;var S4e="ContextMenuSeparator",E4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Fee,{...i,...r,ref:e})});E4e.displayName=S4e;var w4e="ContextMenuArrow",C4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(Uee,{...i,...r,ref:e})});C4e.displayName=w4e;var T4e="ContextMenuSubTrigger",R4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx(jee,{...i,...r,ref:e})});R4e.displayName=T4e;var I4e="ContextMenuSubContent",k4e=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=os(n);return E.jsx($ee,{...i,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});k4e.displayName=I4e;function LS(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var Q$=Hee,x4e=Gee,P4e=qee,L4e=Wee;const A4e="_menu_1x5h1_17",O4e="_title_1x5h1_83",Yee={menu:A4e,title:O4e},M4e=({title:t,id:e})=>E.jsx(ln,{as:"h3",id:e,className:Yee.title,size:"sm",weight:"semibold",children:t}),CO=_.forwardRef(({title:t,showTitle:e=!0,className:n,children:r,...i},s)=>{const o=_.useId();return E.jsxs("div",{role:"menu",ref:s,"aria-label":e?void 0:t,"aria-labelledby":e?o:void 0,className:Ne(n,Yee.menu),...i,children:[e&&E.jsx(M4e,{title:t,id:o}),r]})});CO.displayName="FloatingMenu";var Xee=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(D4e);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(VP,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(VP,{...r,ref:e,children:n})});Xee.displayName="Slot";var VP=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=U4e(n),s=F4e(r,n.props);return n.type!==_.Fragment&&(s.ref=e?Ql(e,i):i),_.cloneElement(n,s)}return _.Children.count(n)>1?_.Children.only(null):null});VP.displayName="SlotClone";var N4e=({children:t})=>E.jsx(E.Fragment,{children:t});function D4e(t){return _.isValidElement(t)&&t.type===N4e}function F4e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function U4e(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var j4e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$4e=j4e.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Xee:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{}),Gk="focusScope.autoFocusOnMount",qk="focusScope.autoFocusOnUnmount",eB={bubbles:!1,cancelable:!0},B4e="FocusScope",Jee=_.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,l]=_.useState(null),c=Fs(i),u=Fs(s),f=_.useRef(null),p=hn(e,g=>l(g)),m=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let g=function(k){if(m.paused||!a)return;const T=k.target;a.contains(T)?f.current=T:nd(f.current,{select:!0})},S=function(k){if(m.paused||!a)return;const T=k.relatedTarget;T!==null&&(a.contains(T)||nd(f.current,{select:!0}))},b=function(k){if(document.activeElement===document.body)for(const I of k)I.removedNodes.length>0&&nd(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",S);const w=new MutationObserver(b);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",S),w.disconnect()}}},[r,a,m.paused]),_.useEffect(()=>{if(a){nB.add(m);const g=document.activeElement;if(!a.contains(g)){const b=new CustomEvent(Gk,eB);a.addEventListener(Gk,c),a.dispatchEvent(b),b.defaultPrevented||(H4e(W4e(Zee(a)),{select:!0}),document.activeElement===g&&nd(a))}return()=>{a.removeEventListener(Gk,c),setTimeout(()=>{const b=new CustomEvent(qk,eB);a.addEventListener(qk,u),a.dispatchEvent(b),b.defaultPrevented||nd(g??document.body,{select:!0}),a.removeEventListener(qk,u),nB.remove(m)},0)}}},[a,c,u,m]);const v=_.useCallback(g=>{if(!n&&!r||m.paused)return;const S=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,b=document.activeElement;if(S&&b){const w=g.currentTarget,[k,T]=V4e(w);k&&T?!g.shiftKey&&b===T?(g.preventDefault(),n&&nd(k,{select:!0})):g.shiftKey&&b===k&&(g.preventDefault(),n&&nd(T,{select:!0})):b===w&&g.preventDefault()}},[n,r,m.paused]);return E.jsx($4e.div,{tabIndex:-1,...o,ref:p,onKeyDown:v})});Jee.displayName=B4e;function H4e(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(nd(r,{select:e}),document.activeElement!==n)return}function V4e(t){const e=Zee(t),n=tB(e,t),r=tB(e.reverse(),t);return[n,r]}function Zee(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function tB(t,e){for(const n of t)if(!G4e(n,{upTo:e}))return n}function G4e(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function q4e(t){return t instanceof HTMLInputElement&&"select"in t}function nd(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&q4e(t)&&e&&t.select()}}var nB=K4e();function K4e(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=rB(t,e),t.unshift(e)},remove(e){var n;t=rB(t,e),(n=t[0])==null||n.resume()}}}function rB(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function W4e(t){return t.filter(e=>e.tagName!=="A")}var Qee=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(Y4e);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(GP,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(GP,{...r,ref:e,children:n})});Qee.displayName="Slot";var GP=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=J4e(n),s=X4e(r,n.props);return n.type!==_.Fragment&&(s.ref=e?Ql(e,i):i),_.cloneElement(n,s)}return _.Children.count(n)>1?_.Children.only(null):null});GP.displayName="SlotClone";var z4e=({children:t})=>E.jsx(E.Fragment,{children:t});function Y4e(t){return _.isValidElement(t)&&t.type===z4e}function X4e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function J4e(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Z4e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Q4e=Z4e.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Qee:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{}),e6e="Portal",ete=_.forwardRef((t,e)=>{var a;const{container:n,...r}=t,[i,s]=_.useState(!1);Wd(()=>s(!0),[]);const o=n||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?BX.createPortal(E.jsx(Q4e.div,{...r,ref:e}),o):null});ete.displayName=e6e;var TO=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(n6e);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(qP,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(qP,{...r,ref:e,children:n})});TO.displayName="Slot";var qP=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=i6e(n),s=r6e(r,n.props);return n.type!==_.Fragment&&(s.ref=e?Ql(e,i):i),_.cloneElement(n,s)}return _.Children.count(n)>1?_.Children.only(null):null});qP.displayName="SlotClone";var t6e=({children:t})=>E.jsx(E.Fragment,{children:t});function n6e(t){return _.isValidElement(t)&&t.type===t6e}function r6e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function i6e(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var s6e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],g_=s6e.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?TO:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{}),tte=YQ(),Kk=function(){},bT=_.forwardRef(function(t,e){var n=_.useRef(null),r=_.useState({onScrollCapture:Kk,onWheelCapture:Kk,onTouchMoveCapture:Kk}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,f=t.shards,p=t.sideCar,m=t.noIsolation,v=t.inert,g=t.allowPinchZoom,S=t.as,b=S===void 0?"div":S,w=t.gapMode,k=h_(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),T=p,I=zQ([n,e]),C=hi(hi({},k),i);return _.createElement(_.Fragment,null,u&&_.createElement(T,{sideCar:tte,removeScrollBar:c,shards:f,noIsolation:m,inert:v,setCallbacks:s,allowPinchZoom:!!g,lockRef:n,gapMode:w}),o?_.cloneElement(_.Children.only(a),hi(hi({},C),{ref:I})):_.createElement(b,hi({},C,{className:l,ref:I}),a))});bT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};bT.classNames={fullWidth:I1,zeroRight:R1};var KP=!1;if(typeof window<"u")try{var AS=Object.defineProperty({},"passive",{get:function(){return KP=!0,!0}});window.addEventListener("test",AS,AS),window.removeEventListener("test",AS,AS)}catch{KP=!1}var Gp=KP?{passive:!1}:!1,o6e=function(t){return t.tagName==="TEXTAREA"},nte=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!o6e(t)&&n[e]==="visible")},a6e=function(t){return nte(t,"overflowY")},l6e=function(t){return nte(t,"overflowX")},iB=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=rte(t,r);if(i){var s=ite(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},c6e=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},u6e=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},rte=function(t,e){return t==="v"?a6e(e):l6e(e)},ite=function(t,e){return t==="v"?c6e(e):u6e(e)},d6e=function(t,e){return t==="h"&&e==="rtl"?-1:1},f6e=function(t,e,n,r,i){var s=d6e(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,l=e.contains(a),c=!1,u=o>0,f=0,p=0;do{var m=ite(t,a),v=m[0],g=m[1],S=m[2],b=g-S-s*v;(v||b)&&rte(t,a)&&(f+=b,p+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(f)<1||!u&&Math.abs(p)<1)&&(c=!0),c},OS=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},sB=function(t){return[t.deltaX,t.deltaY]},oB=function(t){return t&&"current"in t?t.current:t},h6e=function(t,e){return t[0]===e[0]&&t[1]===e[1]},p6e=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},m6e=0,qp=[];function g6e(t){var e=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(m6e++)[0],s=_.useState(mO)[0],o=_.useRef(t);_.useEffect(function(){o.current=t},[t]),_.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var g=Zo([t.lockRef.current],(t.shards||[]).map(oB),!0).filter(Boolean);return g.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),g.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=_.useCallback(function(g,S){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var b=OS(g),w=n.current,k="deltaX"in g?g.deltaX:w[0]-b[0],T="deltaY"in g?g.deltaY:w[1]-b[1],I,C=g.target,x=Math.abs(k)>Math.abs(T)?"h":"v";if("touches"in g&&x==="h"&&C.type==="range")return!1;var A=iB(x,C);if(!A)return!0;if(A?I=x:(I=x==="v"?"h":"v",A=iB(x,C)),!A)return!1;if(!r.current&&"changedTouches"in g&&(k||T)&&(r.current=I),!I)return!0;var N=r.current||I;return f6e(N,S,g,N==="h"?k:T)},[]),l=_.useCallback(function(g){var S=g;if(!(!qp.length||qp[qp.length-1]!==s)){var b="deltaY"in S?sB(S):OS(S),w=e.current.filter(function(I){return I.name===S.type&&(I.target===S.target||S.target===I.shadowParent)&&h6e(I.delta,b)})[0];if(w&&w.should){S.cancelable&&S.preventDefault();return}if(!w){var k=(o.current.shards||[]).map(oB).filter(Boolean).filter(function(I){return I.contains(S.target)}),T=k.length>0?a(S,k[0]):!o.current.noIsolation;T&&S.cancelable&&S.preventDefault()}}},[]),c=_.useCallback(function(g,S,b,w){var k={name:g,delta:S,target:b,should:w,shadowParent:v6e(b)};e.current.push(k),setTimeout(function(){e.current=e.current.filter(function(T){return T!==k})},1)},[]),u=_.useCallback(function(g){n.current=OS(g),r.current=void 0},[]),f=_.useCallback(function(g){c(g.type,sB(g),g.target,a(g,t.lockRef.current))},[]),p=_.useCallback(function(g){c(g.type,OS(g),g.target,a(g,t.lockRef.current))},[]);_.useEffect(function(){return qp.push(s),t.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",l,Gp),document.addEventListener("touchmove",l,Gp),document.addEventListener("touchstart",u,Gp),function(){qp=qp.filter(function(g){return g!==s}),document.removeEventListener("wheel",l,Gp),document.removeEventListener("touchmove",l,Gp),document.removeEventListener("touchstart",u,Gp)}},[]);var m=t.removeScrollBar,v=t.inert;return _.createElement(_.Fragment,null,v?_.createElement(s,{styles:p6e(i)}):null,m?_.createElement(QQ,{gapMode:t.gapMode}):null)}function v6e(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const y6e=JQ(tte,g6e);var ste=_.forwardRef(function(t,e){return _.createElement(bT,hi({},t,{ref:e,sideCar:y6e}))});ste.classNames=bT.classNames;var RO="Dialog",[ote,jnt]=Zl(RO),[_6e,Ja]=ote(RO),ate=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=_.useRef(null),l=_.useRef(null),[c=!1,u]=fT({prop:r,defaultProp:i,onChange:s});return E.jsx(_6e,{scope:e,triggerRef:a,contentRef:l,contentId:Kc(),titleId:Kc(),descriptionId:Kc(),open:c,onOpenChange:u,onOpenToggle:_.useCallback(()=>u(f=>!f),[u]),modal:o,children:n})};ate.displayName=RO;var lte="DialogTrigger",cte=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Ja(lte,n),s=hn(e,i.triggerRef);return E.jsx(g_.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":xO(i.open),...r,ref:s,onClick:Qe(t.onClick,i.onOpenToggle)})});cte.displayName=lte;var IO="DialogPortal",[b6e,ute]=ote(IO,{forceMount:void 0}),dte=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=Ja(IO,e);return E.jsx(b6e,{scope:e,forceMount:n,children:_.Children.map(r,o=>E.jsx(lf,{present:n||s.open,children:E.jsx(ete,{asChild:!0,container:i,children:o})}))})};dte.displayName=IO;var Tw="DialogOverlay",fte=_.forwardRef((t,e)=>{const n=ute(Tw,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=Ja(Tw,t.__scopeDialog);return s.modal?E.jsx(lf,{present:r||s.open,children:E.jsx(S6e,{...i,ref:e})}):null});fte.displayName=Tw;var S6e=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Ja(Tw,n);return E.jsx(ste,{as:TO,allowPinchZoom:!0,shards:[i.contentRef],children:E.jsx(g_.div,{"data-state":xO(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Ah="DialogContent",hte=_.forwardRef((t,e)=>{const n=ute(Ah,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=Ja(Ah,t.__scopeDialog);return E.jsx(lf,{present:r||s.open,children:s.modal?E.jsx(E6e,{...i,ref:e}):E.jsx(w6e,{...i,ref:e})})});hte.displayName=Ah;var E6e=_.forwardRef((t,e)=>{const n=Ja(Ah,t.__scopeDialog),r=_.useRef(null),i=hn(e,n.contentRef,r);return _.useEffect(()=>{const s=r.current;if(s)return IQ(s)},[]),E.jsx(pte,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Qe(t.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=n.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Qe(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Qe(t.onFocusOutside,s=>s.preventDefault())})}),w6e=_.forwardRef((t,e)=>{const n=Ja(Ah,t.__scopeDialog),r=_.useRef(!1),i=_.useRef(!1);return E.jsx(pte,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var l,c;(l=t.onInteractOutside)==null||l.call(t,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((c=n.triggerRef.current)==null?void 0:c.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),pte=_.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=Ja(Ah,n),l=_.useRef(null),c=hn(e,l);return iQ(),E.jsxs(E.Fragment,{children:[E.jsx(Jee,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:E.jsx(cO,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":xO(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),E.jsxs(E.Fragment,{children:[E.jsx(T6e,{titleId:a.titleId}),E.jsx(I6e,{contentRef:l,descriptionId:a.descriptionId})]})]})}),kO="DialogTitle",mte=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Ja(kO,n);return E.jsx(g_.h2,{id:i.titleId,...r,ref:e})});mte.displayName=kO;var gte="DialogDescription",C6e=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Ja(gte,n);return E.jsx(g_.p,{id:i.descriptionId,...r,ref:e})});C6e.displayName=gte;var vte="DialogClose",yte=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Ja(vte,n);return E.jsx(g_.button,{type:"button",...r,ref:e,onClick:Qe(t.onClick,()=>i.onOpenChange(!1))})});yte.displayName=vte;function xO(t){return t?"open":"closed"}var _te="DialogTitleWarning",[$nt,bte]=HRe(_te,{contentName:Ah,titleName:kO,docsSlug:"dialog"}),T6e=({titleId:t})=>{const e=bte(_te),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return _.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},R6e="DialogDescriptionWarning",I6e=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${bte(R6e).contentName}}.`;return _.useEffect(()=>{var s;const i=(s=t.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},PO=ate,k6e=cte,LO=dte,AO=fte,OO=hte,MO=mte,Ste=yte;function x6e(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const Ete=Se.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),v_=()=>{const t=Se.useContext(Ete);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};x6e(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function P6e(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function L6e(){return NO(/^Mac/)}function A6e(){return NO(/^iPhone/)}function aB(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function O6e(){return NO(/^iPad/)||L6e()&&navigator.maxTouchPoints>1}function wte(){return A6e()||O6e()}function NO(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const M6e=24,N6e=typeof window<"u"?_.useLayoutEffect:_.useEffect;function lB(...t){return(...e)=>{for(let n of t)typeof n=="function"&&n(...e)}}const Wk=typeof document<"u"&&window.visualViewport;function cB(t){let e=window.getComputedStyle(t);return/(auto|scroll)/.test(e.overflow+e.overflowX+e.overflowY)}function Cte(t){for(cB(t)&&(t=t.parentElement);t&&!cB(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const D6e=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let MS=0,zk;function F6e(t={}){let{isDisabled:e}=t;N6e(()=>{if(!e)return MS++,MS===1&&wte()&&(zk=U6e()),()=>{MS--,MS===0&&(zk==null||zk())}},[e])}function U6e(){let t,e=0,n=f=>{t=Cte(f.target),!(t===document.documentElement&&t===document.body)&&(e=f.changedTouches[0].pageY)},r=f=>{if(!t||t===document.documentElement||t===document.body){f.preventDefault();return}let p=f.changedTouches[0].pageY,m=t.scrollTop,v=t.scrollHeight-t.clientHeight;v!==0&&((m<=0&&p>e||m>=v&&p<e)&&f.preventDefault(),e=p)},i=f=>{let p=f.target;WP(p)&&p!==document.activeElement&&(f.preventDefault(),p.style.transform="translateY(-2000px)",p.focus(),requestAnimationFrame(()=>{p.style.transform=""}))},s=f=>{let p=f.target;WP(p)&&(p.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{p.style.transform="",Wk&&(Wk.height<window.innerHeight?requestAnimationFrame(()=>{uB(p)}):Wk.addEventListener("resize",()=>uB(p),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},a=window.pageXOffset,l=window.pageYOffset,c=lB(j6e(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let u=lB(I0(document,"touchstart",n,{passive:!1,capture:!0}),I0(document,"touchmove",r,{passive:!1,capture:!0}),I0(document,"touchend",i,{passive:!1,capture:!0}),I0(document,"focus",s,!0),I0(window,"scroll",o));return()=>{c(),u(),window.scrollTo(a,l)}}function j6e(t,e,n){let r=t.style[e];return t.style[e]=n,()=>{t.style[e]=r}}function I0(t,e,n,r){return t.addEventListener(e,n,r),()=>{t.removeEventListener(e,n,r)}}function uB(t){let e=document.scrollingElement||document.documentElement;for(;t&&t!==e;){let n=Cte(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,i=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom+M6e;s>o&&(n.scrollTop+=i-r)}t=n.parentElement}}function WP(t){return t instanceof HTMLInputElement&&!D6e.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function $6e(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function B6e(...t){return e=>t.forEach(n=>$6e(n,e))}function Tte(...t){return _.useCallback(B6e(...t),t)}const Rte=new WeakMap;function Gr(t,e,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(e).forEach(([i,s])=>{if(i.startsWith("--")){t.style.setProperty(i,s);return}r[i]=t.style[i],t.style[i]=s}),!n&&Rte.set(t,r)}function H6e(t,e){if(!t||!(t instanceof HTMLElement))return;let n=Rte.get(t);n&&(t.style[e]=n[e])}const Pr=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function NS(t,e){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[Pr(e)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[Pr(e)?5:4]):null)}function V6e(t){return 8*(Math.log(t+1)-2)}function Yk(t,e){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,e),()=>{t.style.cssText=n}}function G6e(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}const Qn={DURATION:.5,EASE:[.32,.72,0,1]},Ite=.4,q6e=.25,K6e=100,kte=8,DS=16,zP=26,Xk="vaul-dragging";function xte(t){const e=Se.useRef(t);return Se.useEffect(()=>{e.current=t}),Se.useMemo(()=>(...n)=>e.current==null?void 0:e.current.call(e,...n),[])}function W6e({defaultProp:t,onChange:e}){const n=Se.useState(t),[r]=n,i=Se.useRef(r),s=xte(e);return Se.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function Pte({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=W6e({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=xte(n),l=Se.useCallback(c=>{if(s){const f=typeof c=="function"?c(t):c;f!==t&&a(f)}else i(c)},[s,t,i,a]);return[o,l]}function z6e({activeSnapPointProp:t,setActiveSnapPointProp:e,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:s,onSnapPointChange:o,direction:a="bottom",container:l,snapToSequentialPoint:c}){const[u,f]=Pte({prop:t,defaultProp:n==null?void 0:n[0],onChange:e}),[p,m]=Se.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Se.useEffect(()=>{function x(){m({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const v=Se.useMemo(()=>u===(n==null?void 0:n[n.length-1])||null,[n,u]),g=Se.useMemo(()=>{var x;return(x=n==null?void 0:n.findIndex(A=>A===u))!=null?x:null},[n,u]),S=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===u||!n,b=Se.useMemo(()=>{const x=l?{width:l.getBoundingClientRect().width,height:l.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var A;return(A=n==null?void 0:n.map(N=>{const D=typeof N=="string";let F=0;if(D&&(F=parseInt(N,10)),Pr(a)){const B=D?F:p?N*x.height:0;return p?a==="bottom"?x.height-B:-x.height+B:B}const $=D?F:p?N*x.width:0;return p?a==="right"?x.width-$:-x.width+$:$}))!=null?A:[]},[n,p,l]),w=Se.useMemo(()=>g!==null?b==null?void 0:b[g]:null,[b,g]),k=Se.useCallback(x=>{var A;const N=(A=b==null?void 0:b.findIndex(D=>D===x))!=null?A:null;o(N),Gr(r.current,{transition:`transform ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`,transform:Pr(a)?`translate3d(0, ${x}px, 0)`:`translate3d(${x}px, 0, 0)`}),b&&N!==b.length-1&&s!==void 0&&N!==s&&N<s?Gr(i.current,{transition:`opacity ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`,opacity:"0"}):Gr(i.current,{transition:`opacity ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`,opacity:"1"}),f(n==null?void 0:n[Math.max(N,0)])},[r.current,n,b,s,i,f]);Se.useEffect(()=>{if(u||t){var x;const A=(x=n==null?void 0:n.findIndex(N=>N===t||N===u))!=null?x:-1;b&&A!==-1&&typeof b[A]=="number"&&k(b[A])}},[u,t,n,b,k]);function T({draggedDistance:x,closeDrawer:A,velocity:N,dismissible:D}){if(s===void 0)return;const F=a==="bottom"||a==="right"?(w??0)-x:(w??0)+x,$=g===s-1,B=g===0,W=x>0;if($&&Gr(i.current,{transition:`opacity ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`}),!c&&N>2&&!W){D?A():k(b[0]);return}if(!c&&N>2&&W&&b&&n){k(b[n.length-1]);return}const H=b==null?void 0:b.reduce((K,V)=>typeof K!="number"||typeof V!="number"?K:Math.abs(V-F)<Math.abs(K-F)?V:K),z=Pr(a)?window.innerHeight:window.innerWidth;if(N>Ite&&Math.abs(x)<z*.4){const K=W?1:-1;if(K>0&&v&&n){k(b[n.length-1]);return}if(B&&K<0&&D&&A(),g===null)return;k(b[g+K]);return}k(H)}function I({draggedDistance:x}){if(w===null)return;const A=a==="bottom"||a==="right"?w-x:w+x;(a==="bottom"||a==="right")&&A<b[b.length-1]||(a==="top"||a==="left")&&A>b[b.length-1]||Gr(r.current,{transform:Pr(a)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`})}function C(x,A){if(!n||typeof g!="number"||!b||s===void 0)return null;const N=g===s-1;if(g>=s&&A)return 0;if(N&&!A)return 1;if(!S&&!N)return null;const F=N?g+1:g-1,$=N?b[F]-b[F-1]:b[F+1]-b[F],B=x/Math.abs($);return N?1-B:B}return{isLastSnapPoint:v,activeSnapPoint:u,shouldFade:S,getPercentageDragged:C,setActiveSnapPoint:f,activeSnapPointIndex:g,onRelease:T,onDrag:I,snapPointsOffset:b}}const Y6e=()=>()=>{};function X6e(){const{direction:t,isOpen:e,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:i}=v_(),s=Se.useRef(null),o=_.useMemo(()=>document.body.style.backgroundColor,[]);function a(){return(window.innerWidth-zP)/window.innerWidth}Se.useEffect(()=>{if(e&&n){s.current&&clearTimeout(s.current);const l=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!l)return;G6e(r&&!i?Yk(document.body,{background:"black"}):Y6e,Yk(l,{transformOrigin:Pr(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Qn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Qn.EASE.join(",")})`}));const c=Yk(l,{borderRadius:`${kte}px`,overflow:"hidden",...Pr(t)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{c(),s.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},Qn.DURATION*1e3)}}},[e,n,o])}let k0=null;function J6e({isOpen:t,modal:e,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:s}){const[o,a]=Se.useState(()=>typeof window<"u"?window.location.href:""),l=Se.useRef(0),c=Se.useCallback(()=>{if(aB()&&k0===null&&t&&!s){k0={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:f,innerHeight:p}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-l.current}px`,left:`${-f}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const m=p-window.innerHeight;m&&l.current>=p&&(document.body.style.top=`${-(l.current+m)}px`)}),300)}},[t]),u=Se.useCallback(()=>{if(aB()&&k0!==null&&!s){const f=-parseInt(document.body.style.top,10),p=-parseInt(document.body.style.left,10);Object.assign(document.body.style,k0),window.requestAnimationFrame(()=>{if(i&&o!==window.location.href){a(window.location.href);return}window.scrollTo(p,f)}),k0=null}},[o]);return Se.useEffect(()=>{function f(){l.current=window.scrollY}return f(),window.addEventListener("scroll",f),()=>{window.removeEventListener("scroll",f)}},[]),Se.useEffect(()=>{if(e)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||u()}},[e,u]),Se.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&c(),e||window.setTimeout(()=>{u()},500)):u())},[t,r,o,e,n,c,u]),{restorePositionSetting:u}}function Z6e({open:t,onOpenChange:e,children:n,onDrag:r,onRelease:i,snapPoints:s,shouldScaleBackground:o=!1,setBackgroundColorOnScale:a=!0,closeThreshold:l=q6e,scrollLockTimeout:c=K6e,dismissible:u=!0,handleOnly:f=!1,fadeFromIndex:p=s&&s.length-1,activeSnapPoint:m,setActiveSnapPoint:v,fixed:g,modal:S=!0,onClose:b,nested:w,noBodyStyles:k=!1,direction:T="bottom",defaultOpen:I=!1,disablePreventScroll:C=!0,snapToSequentialPoint:x=!1,preventScrollRestoration:A=!1,repositionInputs:N=!0,onAnimationEnd:D,container:F,autoFocus:$=!1}){var B,W;const[H=!1,z]=Pte({defaultProp:I,prop:t,onChange:tt=>{e==null||e(tt),!tt&&!w&&nl(),setTimeout(()=>{D==null||D(tt)},Qn.DURATION*1e3),tt&&!S&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),tt||(document.body.style.pointerEvents="auto")}}),[K,V]=Se.useState(!1),[q,Z]=Se.useState(!1),[G,Q]=Se.useState(!1),ge=Se.useRef(null),_e=Se.useRef(null),Pe=Se.useRef(null),Te=Se.useRef(null),Re=Se.useRef(null),we=Se.useRef(!1),ve=Se.useRef(null),We=Se.useRef(0),pn=Se.useRef(!1),hr=Se.useRef(!I),Ft=Se.useRef(0),ze=Se.useRef(null),Fr=Se.useRef(((B=ze.current)==null?void 0:B.getBoundingClientRect().height)||0),Tr=Se.useRef(((W=ze.current)==null?void 0:W.getBoundingClientRect().width)||0),Ki=Se.useRef(0),nc=Se.useCallback(tt=>{s&&tt===Hs.length-1&&(_e.current=new Date)},[]),{activeSnapPoint:Bs,activeSnapPointIndex:Pi,setActiveSnapPoint:la,onRelease:_u,snapPointsOffset:Hs,onDrag:vf,shouldFade:bu,getPercentageDragged:yf}=z6e({snapPoints:s,activeSnapPointProp:m,setActiveSnapPointProp:v,drawerRef:ze,fadeFromIndex:p,overlayRef:ge,onSnapPointChange:nc,direction:T,container:F,snapToSequentialPoint:x});F6e({isDisabled:!H||q||!S||G||!K||!N||!C});const{restorePositionSetting:nl}=J6e({isOpen:H,modal:S,nested:w??!1,hasBeenOpened:K,preventScrollRestoration:A,noBodyStyles:k});function yo(){return(window.innerWidth-zP)/window.innerWidth}function sp(tt){var Tt,It;!u&&!s||ze.current&&!ze.current.contains(tt.target)||(Fr.current=((Tt=ze.current)==null?void 0:Tt.getBoundingClientRect().height)||0,Tr.current=((It=ze.current)==null?void 0:It.getBoundingClientRect().width)||0,Z(!0),Pe.current=new Date,wte()&&window.addEventListener("touchend",()=>we.current=!1,{once:!0}),tt.target.setPointerCapture(tt.pointerId),We.current=Pr(T)?tt.pageY:tt.pageX)}function rl(tt,Tt){var It;let Et=tt;const wn=(It=window.getSelection())==null?void 0:It.toString(),Ur=ze.current?NS(ze.current,T):null,Rr=new Date;if(Et.tagName==="SELECT"||Et.hasAttribute("data-vaul-no-drag")||Et.closest("[data-vaul-no-drag]"))return!1;if(T==="right"||T==="left")return!0;if(_e.current&&Rr.getTime()-_e.current.getTime()<500)return!1;if(Ur!==null&&(T==="bottom"?Ur>0:Ur<0))return!0;if(wn&&wn.length>0)return!1;if(Re.current&&Rr.getTime()-Re.current.getTime()<c&&Ur===0||Tt)return Re.current=Rr,!1;for(;Et;){if(Et.scrollHeight>Et.clientHeight){if(Et.scrollTop!==0)return Re.current=new Date,!1;if(Et.getAttribute("role")==="dialog")return!0}Et=Et.parentNode}return!0}function rc(tt){if(ze.current&&q){const Tt=T==="bottom"||T==="right"?1:-1,It=(We.current-(Pr(T)?tt.pageY:tt.pageX))*Tt,Et=It>0,wn=s&&!u&&!Et;if(wn&&Pi===0)return;const Ur=Math.abs(It),Rr=document.querySelector("[data-vaul-drawer-wrapper]"),ua=T==="bottom"||T==="top"?Fr.current:Tr.current;let us=Ur/ua;const da=yf(Ur,Et);if(da!==null&&(us=da),wn&&us>=1||!we.current&&!rl(tt.target,Et))return;if(ze.current.classList.add(Xk),we.current=!0,Gr(ze.current,{transition:"none"}),Gr(ge.current,{transition:"none"}),s&&vf({draggedDistance:It}),Et&&!s){const Li=V6e(It),Su=Math.min(Li*-1,0)*Tt;Gr(ze.current,{transform:Pr(T)?`translate3d(0, ${Su}px, 0)`:`translate3d(${Su}px, 0, 0)`});return}const fa=1-us;if((bu||p&&Pi===p-1)&&(r==null||r(tt,us),Gr(ge.current,{opacity:`${fa}`,transition:"none"},!0)),Rr&&ge.current&&o){const Li=Math.min(yo()+us*(1-yo()),1),Su=8-us*8,Eu=Math.max(0,14-us*14);Gr(Rr,{borderRadius:`${Su}px`,transform:Pr(T)?`scale(${Li}) translate3d(0, ${Eu}px, 0)`:`scale(${Li}) translate3d(${Eu}px, 0, 0)`,transition:"none"},!0)}if(!s){const Li=Ur*Tt;Gr(ze.current,{transform:Pr(T)?`translate3d(0, ${Li}px, 0)`:`translate3d(${Li}px, 0, 0)`})}}}Se.useEffect(()=>{window.requestAnimationFrame(()=>{hr.current=!0})},[]),Se.useEffect(()=>{var tt;function Tt(){if(!ze.current||!N)return;const It=document.activeElement;if(WP(It)||pn.current){var Et;const wn=((Et=window.visualViewport)==null?void 0:Et.height)||0,Ur=window.innerHeight;let Rr=Ur-wn;const ua=ze.current.getBoundingClientRect().height||0,us=ua>Ur*.8;Ki.current||(Ki.current=ua);const da=ze.current.getBoundingClientRect().top;if(Math.abs(Ft.current-Rr)>60&&(pn.current=!pn.current),s&&s.length>0&&Hs&&Pi){const fa=Hs[Pi]||0;Rr+=fa}if(Ft.current=Rr,ua>wn||pn.current){const fa=ze.current.getBoundingClientRect().height;let Li=fa;fa>wn&&(Li=wn-(us?da:zP)),g?ze.current.style.height=`${fa-Math.max(Rr,0)}px`:ze.current.style.height=`${Math.max(Li,wn-da)}px`}else P6e()||(ze.current.style.height=`${Ki.current}px`);s&&s.length>0&&!pn.current?ze.current.style.bottom="0px":ze.current.style.bottom=`${Math.max(Rr,0)}px`}}return(tt=window.visualViewport)==null||tt.addEventListener("resize",Tt),()=>{var It;return(It=window.visualViewport)==null?void 0:It.removeEventListener("resize",Tt)}},[Pi,s,Hs]);function ic(tt){op(),b==null||b(),tt||z(!1),setTimeout(()=>{s&&la(s[0])},Qn.DURATION*1e3)}function Vs(){if(!ze.current)return;const tt=document.querySelector("[data-vaul-drawer-wrapper]"),Tt=NS(ze.current,T);Gr(ze.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`}),Gr(ge.current,{transition:`opacity ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`,opacity:"1"}),o&&Tt&&Tt>0&&H&&Gr(tt,{borderRadius:`${kte}px`,overflow:"hidden",...Pr(T)?{transform:`scale(${yo()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${yo()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Qn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Qn.EASE.join(",")})`},!0)}function op(){!q||!ze.current||(ze.current.classList.remove(Xk),we.current=!1,Z(!1),Te.current=new Date)}function ct(tt){if(!q||!ze.current)return;ze.current.classList.remove(Xk),we.current=!1,Z(!1),Te.current=new Date;const Tt=NS(ze.current,T);if(!tt||!rl(tt.target,!1)||!Tt||Number.isNaN(Tt)||Pe.current===null)return;const It=Te.current.getTime()-Pe.current.getTime(),Et=We.current-(Pr(T)?tt.pageY:tt.pageX),wn=Math.abs(Et)/It;if(wn>.05&&(Q(!0),setTimeout(()=>{Q(!1)},200)),s){_u({draggedDistance:Et*(T==="bottom"||T==="right"?1:-1),closeDrawer:ic,velocity:wn,dismissible:u}),i==null||i(tt,!0);return}if(T==="bottom"||T==="right"?Et>0:Et<0){Vs(),i==null||i(tt,!0);return}if(wn>Ite){ic(),i==null||i(tt,!1);return}var Ur;const Rr=Math.min((Ur=ze.current.getBoundingClientRect().height)!=null?Ur:0,window.innerHeight);var ua;const us=Math.min((ua=ze.current.getBoundingClientRect().width)!=null?ua:0,window.innerWidth),da=T==="left"||T==="right";if(Math.abs(Tt)>=(da?us:Rr)*l){ic(),i==null||i(tt,!1);return}i==null||i(tt,!0),Vs()}Se.useEffect(()=>(H&&(Gr(document.documentElement,{scrollBehavior:"auto"}),_e.current=new Date),()=>{H6e(document.documentElement,"scrollBehavior")}),[H]);function mn(tt){const Tt=tt?(window.innerWidth-DS)/window.innerWidth:1,It=tt?-16:0;ve.current&&window.clearTimeout(ve.current),Gr(ze.current,{transition:`transform ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`,transform:Pr(T)?`scale(${Tt}) translate3d(0, ${It}px, 0)`:`scale(${Tt}) translate3d(${It}px, 0, 0)`}),!tt&&ze.current&&(ve.current=setTimeout(()=>{const Et=NS(ze.current,T);Gr(ze.current,{transition:"none",transform:Pr(T)?`translate3d(0, ${Et}px, 0)`:`translate3d(${Et}px, 0, 0)`})},500))}function jn(tt,Tt){if(Tt<0)return;const It=(window.innerWidth-DS)/window.innerWidth,Et=It+Tt*(1-It),wn=-16+Tt*DS;Gr(ze.current,{transform:Pr(T)?`scale(${Et}) translate3d(0, ${wn}px, 0)`:`scale(${Et}) translate3d(${wn}px, 0, 0)`,transition:"none"})}function ca(tt,Tt){const It=Pr(T)?window.innerHeight:window.innerWidth,Et=Tt?(It-DS)/It:1,wn=Tt?-16:0;Tt&&Gr(ze.current,{transition:`transform ${Qn.DURATION}s cubic-bezier(${Qn.EASE.join(",")})`,transform:Pr(T)?`scale(${Et}) translate3d(0, ${wn}px, 0)`:`scale(${Et}) translate3d(${wn}px, 0, 0)`})}return Se.useEffect(()=>{S||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[S]),Se.createElement(PO,{defaultOpen:I,onOpenChange:tt=>{!u&&!tt||(tt?V(!0):ic(!0),z(tt))},open:H},Se.createElement(Ete.Provider,{value:{activeSnapPoint:Bs,snapPoints:s,setActiveSnapPoint:la,drawerRef:ze,overlayRef:ge,onOpenChange:e,onPress:sp,onRelease:ct,onDrag:rc,dismissible:u,shouldAnimate:hr,handleOnly:f,isOpen:H,isDragging:q,shouldFade:bu,closeDrawer:ic,onNestedDrag:jn,onNestedOpenChange:mn,onNestedRelease:ca,keyboardIsOpen:pn,modal:S,snapPointsOffset:Hs,activeSnapPointIndex:Pi,direction:T,shouldScaleBackground:o,setBackgroundColorOnScale:a,noBodyStyles:k,container:F,autoFocus:$}},n))}const Lte=Se.forwardRef(function({...t},e){const{overlayRef:n,snapPoints:r,onRelease:i,shouldFade:s,isOpen:o,modal:a,shouldAnimate:l}=v_(),c=Tte(e,n),u=r&&r.length>0;if(!a)return null;const f=Se.useCallback(p=>i(p),[i]);return Se.createElement(AO,{onMouseUp:f,ref:c,"data-vaul-overlay":"","data-vaul-snap-points":o&&u?"true":"false","data-vaul-snap-points-overlay":o&&s?"true":"false","data-vaul-animate":l!=null&&l.current?"true":"false",...t})});Lte.displayName="Drawer.Overlay";const Ate=Se.forwardRef(function({onPointerDownOutside:t,style:e,onOpenAutoFocus:n,...r},i){const{drawerRef:s,onPress:o,onRelease:a,onDrag:l,keyboardIsOpen:c,snapPointsOffset:u,activeSnapPointIndex:f,modal:p,isOpen:m,direction:v,snapPoints:g,container:S,handleOnly:b,shouldAnimate:w,autoFocus:k}=v_(),[T,I]=Se.useState(!1),C=Tte(i,s),x=Se.useRef(null),A=Se.useRef(null),N=Se.useRef(!1),D=g&&g.length>0;X6e();const F=(B,W,H=0)=>{if(N.current)return!0;const z=Math.abs(B.y),K=Math.abs(B.x),V=K>z,q=["bottom","right"].includes(W)?1:-1;if(W==="left"||W==="right"){if(!(B.x*q<0)&&K>=0&&K<=H)return V}else if(!(B.y*q<0)&&z>=0&&z<=H)return!V;return N.current=!0,!0};Se.useEffect(()=>{D&&window.requestAnimationFrame(()=>{I(!0)})},[]);function $(B){x.current=null,N.current=!1,a(B)}return Se.createElement(OO,{"data-vaul-drawer-direction":v,"data-vaul-drawer":"","data-vaul-delayed-snap-points":T?"true":"false","data-vaul-snap-points":m&&D?"true":"false","data-vaul-custom-container":S?"true":"false","data-vaul-animate":w!=null&&w.current?"true":"false",...r,ref:C,style:u&&u.length>0?{"--snap-point-height":`${u[f??0]}px`,...e}:e,onPointerDown:B=>{b||(r.onPointerDown==null||r.onPointerDown.call(r,B),x.current={x:B.pageX,y:B.pageY},o(B))},onOpenAutoFocus:B=>{n==null||n(B),k||B.preventDefault()},onPointerDownOutside:B=>{if(t==null||t(B),!p||B.defaultPrevented){B.preventDefault();return}c.current&&(c.current=!1)},onFocusOutside:B=>{if(!p){B.preventDefault();return}},onPointerMove:B=>{if(A.current=B,b||(r.onPointerMove==null||r.onPointerMove.call(r,B),!x.current))return;const W=B.pageY-x.current.y,H=B.pageX-x.current.x,z=B.pointerType==="touch"?10:2;F({x:H,y:W},v,z)?l(B):(Math.abs(H)>z||Math.abs(W)>z)&&(x.current=null)},onPointerUp:B=>{r.onPointerUp==null||r.onPointerUp.call(r,B),x.current=null,N.current=!1,a(B)},onPointerOut:B=>{r.onPointerOut==null||r.onPointerOut.call(r,B),$(A.current)},onContextMenu:B=>{r.onContextMenu==null||r.onContextMenu.call(r,B),A.current&&$(A.current)}})});Ate.displayName="Drawer.Content";const Q6e=250,exe=120,txe=Se.forwardRef(function({preventCycle:t=!1,children:e,...n},r){const{closeDrawer:i,isDragging:s,snapPoints:o,activeSnapPoint:a,setActiveSnapPoint:l,dismissible:c,handleOnly:u,isOpen:f,onPress:p,onDrag:m}=v_(),v=Se.useRef(null),g=Se.useRef(!1);function S(){if(g.current){k();return}window.setTimeout(()=>{b()},exe)}function b(){if(s||t||g.current){k();return}if(k(),!o||o.length===0){c||i();return}if(a===o[o.length-1]&&c){i();return}const I=o.findIndex(x=>x===a);if(I===-1)return;const C=o[I+1];l(C)}function w(){v.current=window.setTimeout(()=>{g.current=!0},Q6e)}function k(){v.current&&window.clearTimeout(v.current),g.current=!1}return Se.createElement("div",{onClick:S,onPointerCancel:k,onPointerDown:T=>{u&&p(T),w()},onPointerMove:T=>{u&&m(T)},ref:r,"data-vaul-drawer-visible":f?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},Se.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},e))});txe.displayName="Drawer.Handle";function nxe(t){const e=v_(),{container:n=e.container,...r}=t;return Se.createElement(LO,{container:n,...r})}const Rs={Root:Z6e,Content:Ate,Overlay:Lte,Trigger:k6e,Portal:nxe,Title:MO},rxe="_bg_gd68h_17",ixe="_drawer_gd68h_26",sxe="_body_gd68h_60",Rw={bg:rxe,drawer:ixe,body:sxe},DO=_.createContext(null);function FO(){var e;const t=(e=globalThis.navigator)==null?void 0:e.userAgent;return/android/i.test(t)?"android":/iPad|iPhone|iPod|Mac/.test(t)&&"ontouchend"in document?"ios":"other"}const UO=_.forwardRef(({title:t,children:e,className:n,...r},i)=>E.jsx("div",{ref:i,className:Ne(n,Rw.drawer),"aria-label":t,"data-platform":FO(),...r,role:"menu",children:E.jsx("div",{className:Rw.body,children:e})}));UO.displayName="DrawerMenu";const oxe=({onSelect:t,children:e})=>E.jsx(zee,{onSelect:t??void 0,asChild:!0,children:e}),axe=({title:t,onOpenChange:e,trigger:n,hasAccessibleAlternative:r,children:i})=>{const[s,o]=_.useState(!1),a=_.useCallback(m=>{o(m),e==null||e(m)},[o,e]),l=FO(),c=l==="android"||l==="ios",u=_.useMemo(()=>({MenuItemWrapper:c?null:oxe,onOpenChange:a}),[a]),f=E.jsx(DO.Provider,{value:u,children:i}),p=E.jsx(x4e,{"aria-haspopup":"menu",tabIndex:r?void 0:0,asChild:!0,children:n});return c?E.jsxs(E.Fragment,{children:[E.jsx(Q$,{onOpenChange:a,children:p}),E.jsx(Rs.Root,{open:s,onOpenChange:a,children:E.jsxs(Rs.Portal,{children:[E.jsx(Rs.Overlay,{className:Ne(Rw.bg)}),E.jsx(Rs.Content,{asChild:!0,children:E.jsx(UO,{title:t,children:f})})]})})]}):E.jsxs(Q$,{onOpenChange:a,children:[p,E.jsx(P4e,{children:E.jsx(L4e,{asChild:!0,children:E.jsx(CO,{title:t,children:f})})})]})},lxe="_glass_1x9g9_17",cxe={glass:lxe},Ote=_.forwardRef(({children:t,className:e,...n},r)=>E.jsx("div",{ref:r,className:Ne(e,cxe.glass),...n,children:_.Children.only(t)}));Ote.displayName="Glass";const cf=({as:t="h1",children:e,...n})=>E.jsx(gZ,{as:t,type:"heading",...n,children:e}),uxe="_link_ue21z_17",dxe={link:uxe},fxe=_.forwardRef(function({children:e,className:n,kind:r="primary",size:i="medium",...s},o){return E.jsx("a",{ref:o,...s,rel:"noreferrer noopener",className:Ne(dxe.link,n),"data-kind":r,"data-size":i,children:e})});var jO="DropdownMenu",[hxe,Bnt]=Zl(jO,[vT]),as=vT(),[pxe,Mte]=hxe(jO),Nte=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=t,l=as(e),c=_.useRef(null),[u=!1,f]=fT({prop:i,defaultProp:s,onChange:o});return E.jsx(pxe,{scope:e,triggerId:Kc(),triggerRef:c,contentId:Kc(),open:u,onOpenChange:f,onOpenToggle:_.useCallback(()=>f(p=>!p),[f]),modal:a,children:E.jsx(Ree,{...l,open:u,onOpenChange:f,dir:r,modal:a,children:n})})};Nte.displayName=jO;var Dte="DropdownMenuTrigger",Fte=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=t,s=Mte(Dte,n),o=as(n);return E.jsx(Iee,{asChild:!0,...o,children:E.jsx(Cr.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:Ql(e,s.triggerRef),onPointerDown:Qe(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Qe(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});Fte.displayName=Dte;var mxe="DropdownMenuPortal",Ute=t=>{const{__scopeDropdownMenu:e,...n}=t,r=as(e);return E.jsx(kee,{...r,...n})};Ute.displayName=mxe;var jte="DropdownMenuContent",$te=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Mte(jte,n),s=as(n),o=_.useRef(!1);return E.jsx(xee,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:Qe(t.onCloseAutoFocus,a=>{var l;o.current||(l=i.triggerRef.current)==null||l.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:Qe(t.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!i.modal||u)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$te.displayName=jte;var gxe="DropdownMenuGroup",vxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Pee,{...i,...r,ref:e})});vxe.displayName=gxe;var yxe="DropdownMenuLabel",_xe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Lee,{...i,...r,ref:e})});_xe.displayName=yxe;var bxe="DropdownMenuItem",Bte=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Aee,{...i,...r,ref:e})});Bte.displayName=bxe;var Sxe="DropdownMenuCheckboxItem",Exe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Oee,{...i,...r,ref:e})});Exe.displayName=Sxe;var wxe="DropdownMenuRadioGroup",Cxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Mee,{...i,...r,ref:e})});Cxe.displayName=wxe;var Txe="DropdownMenuRadioItem",Rxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Nee,{...i,...r,ref:e})});Rxe.displayName=Txe;var Ixe="DropdownMenuItemIndicator",kxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Dee,{...i,...r,ref:e})});kxe.displayName=Ixe;var xxe="DropdownMenuSeparator",Pxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Fee,{...i,...r,ref:e})});Pxe.displayName=xxe;var Lxe="DropdownMenuArrow",Axe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(Uee,{...i,...r,ref:e})});Axe.displayName=Lxe;var Oxe="DropdownMenuSubTrigger",Mxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx(jee,{...i,...r,ref:e})});Mxe.displayName=Oxe;var Nxe="DropdownMenuSubContent",Dxe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=as(n);return E.jsx($ee,{...i,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Dxe.displayName=Nxe;var Fxe=Nte,Uxe=Fte,jxe=Ute,$xe=$te;const Bxe=({onSelect:t,children:e})=>E.jsx(Bte,{onSelect:t??void 0,asChild:!0,children:e}),$O=({title:t,showTitle:e=!0,open:n,onOpenChange:r,trigger:i,children:s,side:o="bottom",align:a="center"})=>{const l=FO(),c=l==="android"||l==="ios",u=_.useMemo(()=>({MenuItemWrapper:c?null:Bxe,onOpenChange:r}),[r]),f=E.jsx(DO.Provider,{value:u,children:s});return c?E.jsxs(Rs.Root,{open:n,onOpenChange:r,children:[E.jsx(Rs.Trigger,{asChild:!0,children:i}),E.jsxs(Rs.Portal,{children:[E.jsx(Rs.Overlay,{className:Ne(Rw.bg)}),E.jsx(Rs.Content,{asChild:!0,children:E.jsx(UO,{title:t,children:f})})]})]}):E.jsxs(Fxe,{open:n,onOpenChange:r,children:[E.jsx(Uxe,{asChild:!0,children:i}),E.jsx(jxe,{children:E.jsx($xe,{asChild:!0,side:o,align:a,sideOffset:8,onCloseAutoFocus:p=>{p.preventDefault()},children:E.jsx(CO,{title:t,showTitle:e,children:f})})})]})},Hxe="_item_8j2l6_17",Vxe="_interactive_8j2l6_35",Gxe="_icon_8j2l6_43",qxe="_label_8j2l6_52",Kxe="_disabled_8j2l6_118",Ku={item:Hxe,interactive:Vxe,"no-label":"_no-label_8j2l6_39",icon:Gxe,label:qxe,"nav-hint":"_nav-hint_8j2l6_59",disabled:Kxe};function Hte(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M8.7 17.3a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l3.9-3.9-3.9-3.9a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l4.6 4.6c.1.1.17.208.213.325.041.117.062.242.062.375s-.02.258-.063.375a.877.877 0 0 1-.212.325l-4.6 4.6a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}Hte.displayName="ChevronRightIcon";const Vte=_.forwardRef(Hte),Eg=({as:t,className:e,Icon:n,label:r,labelProps:i,onSelect:s,kind:o="primary",children:a,onClick:l,disabled:c,...u})=>{const f=t??"button",p=_.useContext(DO),m=_.useCallback(w=>{if(l==null||l(w),s!==null&&(p==null?void 0:p.MenuItemWrapper)==null){const k=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});s(k),k.defaultPrevented||p==null||p.onOpenChange(!1)}},[p,s]),v=_.isValidElement(n),g=n,S=n,b=E.jsxs(f,{role:"menuitem",...u,className:Ne(e,Ku.item,{[Ku.interactive]:s!==null,[Ku["no-label"]]:r===null,[Ku.disabled]:c}),"data-kind":o,onClick:m,disabled:f==="button"?c:void 0,"aria-disabled":f==="button"?void 0:c,children:[v?E.jsx(Sg,{className:Ku.icon,children:g}):E.jsx(S,{width:24,height:24,className:Ku.icon,"aria-hidden":!0}),r!==null&&E.jsx(ln,{className:Ku.label,size:"md",weight:"medium",as:"span",...i,children:r}),(f==="button"||f==="a")&&E.jsx(Vte,{width:8,height:24,className:Ku["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return(p==null?void 0:p.MenuItemWrapper)==null||s===null?b:E.jsx(p.MenuItemWrapper,{onSelect:s,children:b})};var Wxe="Label",Gte=_.forwardRef((t,e)=>E.jsx(Cr.label,{...t,ref:e,onMouseDown:n=>{var i;n.target.closest("button, input, select, textarea")||((i=t.onMouseDown)==null||i.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Gte.displayName=Wxe;var[BO,Hnt]=Zl("Form"),HO="Form",[zxe,y_]=BO(HO),[Yxe,qte]=BO(HO),Kte=_.forwardRef((t,e)=>{const{__scopeForm:n,onClearServerErrors:r=()=>{},...i}=t,s=_.useRef(null),o=hn(e,s),[a,l]=_.useState({}),c=_.useCallback(D=>a[D],[a]),u=_.useCallback((D,F)=>l($=>({...$,[D]:{...$[D]??{},...F}})),[]),f=_.useCallback(D=>{l(F=>({...F,[D]:void 0})),w(F=>({...F,[D]:{}}))},[]),[p,m]=_.useState({}),v=_.useCallback(D=>p[D]??[],[p]),g=_.useCallback((D,F)=>{m($=>({...$,[D]:[...$[D]??[],F]}))},[]),S=_.useCallback((D,F)=>{m($=>({...$,[D]:($[D]??[]).filter(B=>B.id!==F)}))},[]),[b,w]=_.useState({}),k=_.useCallback(D=>b[D]??{},[b]),T=_.useCallback((D,F)=>{w($=>({...$,[D]:{...$[D]??{},...F}}))},[]),[I,C]=_.useState({}),x=_.useCallback((D,F)=>{C($=>{const B=new Set($[D]).add(F);return{...$,[D]:B}})},[]),A=_.useCallback((D,F)=>{C($=>{const B=new Set($[D]);return B.delete(F),{...$,[D]:B}})},[]),N=_.useCallback(D=>Array.from(I[D]??[]).join(" ")||void 0,[I]);return E.jsx(zxe,{scope:n,getFieldValidity:c,onFieldValidityChange:u,getFieldCustomMatcherEntries:v,onFieldCustomMatcherEntryAdd:g,onFieldCustomMatcherEntryRemove:S,getFieldCustomErrors:k,onFieldCustomErrorsChange:T,onFieldValiditionClear:f,children:E.jsx(Yxe,{scope:n,onFieldMessageIdAdd:x,onFieldMessageIdRemove:A,getFieldDescription:N,children:E.jsx(Cr.form,{...i,ref:o,onInvalid:Qe(t.onInvalid,D=>{const F=Xte(D.currentTarget);F===D.target&&F.focus(),D.preventDefault()}),onSubmit:Qe(t.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:Qe(t.onReset,r)})})})});Kte.displayName=HO;var VO="FormField",[Xxe,GO]=BO(VO),Wte=_.forwardRef((t,e)=>{const{__scopeForm:n,name:r,serverInvalid:i=!1,...s}=t,a=y_(VO,n).getFieldValidity(r),l=Kc();return E.jsx(Xxe,{scope:n,id:l,name:r,serverInvalid:i,children:E.jsx(Cr.div,{"data-valid":KO(a,i),"data-invalid":WO(a,i),...s,ref:e})})});Wte.displayName=VO;var YP="FormLabel",zte=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=y_(YP,n),s=GO(YP,n),o=r.htmlFor||s.id,a=i.getFieldValidity(s.name);return E.jsx(Gte,{"data-valid":KO(a,s.serverInvalid),"data-invalid":WO(a,s.serverInvalid),...r,ref:e,htmlFor:o})});zte.displayName=YP;var aE="FormControl",Yte=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=y_(aE,n),s=GO(aE,n),o=qte(aE,n),a=_.useRef(null),l=hn(e,a),c=r.name||s.name,u=r.id||s.id,f=i.getFieldCustomMatcherEntries(c),{onFieldValidityChange:p,onFieldCustomErrorsChange:m,onFieldValiditionClear:v}=i,g=_.useCallback(async w=>{if(Jte(w.validity)){const $=Jk(w.validity);p(c,$);return}const k=w.form?new FormData(w.form):new FormData,T=[w.value,k],I=[],C=[];f.forEach($=>{oPe($,T)?C.push($):aPe($)&&I.push($)});const x=I.map(({id:$,match:B})=>[$,B(...T)]),A=Object.fromEntries(x),N=Object.values(A).some(Boolean),D=N;w.setCustomValidity(D?my:"");const F=Jk(w.validity);if(p(c,F),m(c,A),!N&&C.length>0){const $=C.map(({id:V,match:q})=>q(...T).then(Z=>[V,Z])),B=await Promise.all($),W=Object.fromEntries(B),z=Object.values(W).some(Boolean);w.setCustomValidity(z?my:"");const K=Jk(w.validity);p(c,K),m(c,W)}},[f,c,m,p]);_.useEffect(()=>{const w=a.current;if(w){const k=()=>g(w);return w.addEventListener("change",k),()=>w.removeEventListener("change",k)}},[g]);const S=_.useCallback(()=>{const w=a.current;w&&(w.setCustomValidity(""),v(c))},[c,v]);_.useEffect(()=>{var k;const w=(k=a.current)==null?void 0:k.form;if(w)return w.addEventListener("reset",S),()=>w.removeEventListener("reset",S)},[S]),_.useEffect(()=>{const w=a.current,k=w==null?void 0:w.closest("form");if(k&&s.serverInvalid){const T=Xte(k);T===w&&T.focus()}},[s.serverInvalid]);const b=i.getFieldValidity(c);return E.jsx(Cr.input,{"data-valid":KO(b,s.serverInvalid),"data-invalid":WO(b,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(c),title:"",...r,ref:l,id:u,name:c,onInvalid:Qe(t.onInvalid,w=>{const k=w.currentTarget;g(k)}),onChange:Qe(t.onChange,w=>{S()})})});Yte.displayName=aE;var my="This value is not valid",Jxe={badInput:my,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},__="FormMessage",Zxe=_.forwardRef((t,e)=>{const{match:n,name:r,...i}=t,s=GO(__,t.__scopeForm),o=r??s.name;return n===void 0?E.jsx(qO,{...i,ref:e,name:o,children:t.children||my}):typeof n=="function"?E.jsx(ePe,{match:n,...i,ref:e,name:o}):E.jsx(Qxe,{match:n,...i,ref:e,name:o})});Zxe.displayName=__;var Qxe=_.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,children:s,...o}=t,l=y_(__,o.__scopeForm).getFieldValidity(i);return r||(l==null?void 0:l[n])?E.jsx(qO,{ref:e,...o,name:i,children:s??Jxe[n]}):null}),ePe=_.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,id:s,children:o,...a}=t,l=y_(__,a.__scopeForm),c=_.useRef(null),u=hn(e,c),f=Kc(),p=s??f,m=_.useMemo(()=>({id:p,match:n}),[p,n]),{onFieldCustomMatcherEntryAdd:v,onFieldCustomMatcherEntryRemove:g}=l;_.useEffect(()=>(v(i,m),()=>g(i,m.id)),[m,i,v,g]);const S=l.getFieldValidity(i),w=l.getFieldCustomErrors(i)[p];return r||S&&!Jte(S)&&w?E.jsx(qO,{id:p,ref:u,...a,name:i,children:o??my}):null}),qO=_.forwardRef((t,e)=>{const{__scopeForm:n,id:r,name:i,...s}=t,o=qte(__,n),a=Kc(),l=r??a,{onFieldMessageIdAdd:c,onFieldMessageIdRemove:u}=o;return _.useEffect(()=>(c(i,l),()=>u(i,l)),[i,l,c,u]),E.jsx(Cr.span,{id:l,...s,ref:e})}),tPe="FormSubmit",nPe=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t;return E.jsx(Cr.button,{type:"submit",...r,ref:e})});nPe.displayName=tPe;function Jk(t){const e={};for(const n in t)e[n]=t[n];return e}function rPe(t){return t instanceof HTMLElement}function iPe(t){return"validity"in t}function sPe(t){return iPe(t)&&(t.validity.valid===!1||t.getAttribute("aria-invalid")==="true")}function Xte(t){const e=t.elements,[n]=Array.from(e).filter(rPe).filter(sPe);return n}function oPe(t,e){return t.match.constructor.name==="AsyncFunction"||lPe(t.match,e)}function aPe(t){return t.match.constructor.name==="Function"}function lPe(t,e){return t(...e)instanceof Promise}function Jte(t){let e=!1;for(const n in t){const r=n;if(r!=="valid"&&r!=="customError"&&t[r]){e=!0;break}}return e}function KO(t,e){if((t==null?void 0:t.valid)===!0&&!e)return!0}function WO(t,e){if((t==null?void 0:t.valid)===!1||e)return!0}var cPe=Kte,uPe=Wte,dPe=zte,Zte=Yte;const fPe="_root_ssths_24",hPe="_label_ssths_67",k1={root:fPe,"inline-field":"_inline-field_ssths_40","inline-field-body":"_inline-field-body_ssths_46","inline-field-control":"_inline-field-control_ssths_52",label:hPe},pPe=_.forwardRef(function({children:e,...n},r){const i=Ne(k1.label,n.className);return E.jsx(dPe,{ref:r,...n,className:i,children:e})});var mPe="Separator",dB="horizontal",gPe=["horizontal","vertical"],Qte=_.forwardRef((t,e)=>{const{decorative:n,orientation:r=dB,...i}=t,s=vPe(r)?r:dB,a=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return E.jsx(Cr.div,{"data-orientation":s,...a,...i,ref:e})});Qte.displayName=mPe;function vPe(t){return gPe.includes(t)}var yPe=Qte;const _Pe="_separator_144s5_17",bPe={separator:_Pe},fB="--cpd-separator-spacing",zO=_.forwardRef(({className:t,spacing:e,kind:n="primary",...r},i)=>{const s=Ne(bPe.separator,t),o=_.useRef(null),a=VZ([o,i]);return _.useEffect(()=>{var c;const l=(c=o.current)==null?void 0:c.style;e?l==null||l.setProperty(fB,e):l==null||l.removeProperty(fB)},[e]),E.jsx(yPe,{...r,className:s,ref:a,"data-kind":n})});zO.displayName="Separator";const SPe="_container_qnvru_18",EPe="_input_qnvru_32",wPe="_ui_qnvru_42",Zk={container:SPe,input:EPe,ui:wPe},ene=_.forwardRef(function({className:e,...n},r){const i=Ne(Zk.container,e);return E.jsxs("div",{className:i,children:[E.jsx("input",{ref:r,className:Zk.input,...n,type:"checkbox"}),E.jsx("div",{className:Zk.ui})]})});_.forwardRef(function(e,n){return E.jsx(Zte,{asChild:!0,children:E.jsx(ene,{ref:n,...e})})});const YO=_.forwardRef(function({className:e,Icon:n,label:r,onSelect:i,checked:s,disabled:o},a){const l=_.useId(),c=_.useCallback(()=>{},[]);return E.jsx(Eg,{as:"div",role:"menuitemcheckbox","aria-checked":s,className:e,Icon:n,label:r,onSelect:i,disabled:o,children:E.jsx(ene,{id:l,ref:a,"aria-hidden":!0,checked:s,disabled:o,onChange:c})})}),hB=_.forwardRef(function({children:e,...n},r){const i=Ne(k1.root,n.className);return E.jsx(cPe,{ref:r,...n,className:i,children:e})}),CPe=_.forwardRef(function({className:e,control:n,children:r,...i},s){const o=Ne(k1["inline-field"],e);return E.jsxs(uPe,{ref:s,...i,className:o,children:[E.jsx("div",{className:k1["inline-field-control"],children:n}),E.jsx("div",{className:k1["inline-field-body"],children:r})]})}),TPe="_icon_1ye7b_27",RPe={icon:TPe};function tne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2Z",clipRule:"evenodd"})})}tne.displayName="SpinnerIcon";const IPe=_.forwardRef(tne),kPe=_.forwardRef(function({size:e=20,...n},r){return E.jsx(IPe,{ref:r,className:RPe.icon,style:{width:e,height:e},...n})}),xPe="_button_i91xf_17",PPe="_destructive_i91xf_116",x0={button:xPe,"icon-only":"_icon-only_i91xf_59","has-icon":"_has-icon_i91xf_66",destructive:PPe},Dt=_.forwardRef(function({as:e,kind:n="primary",size:r="lg",children:i,className:s,iconOnly:o,Icon:a,destructive:l,disabled:c,...u},f){const[p,m]=n==="destructive"?["secondary",!0]:[n,l],v=Ne(x0.button,s,{[x0["has-icon"]]:a,[x0["icon-only"]]:o,[x0.destructive]:m}),g=o&&r==="lg"?24:20;return E.jsxs(vZ,{...u,as:e||"button",ref:f,className:v,"data-size":r,"data-kind":p,tabIndex:0,disabled:c,children:[a&&E.jsx(a,{width:g,height:g,className:x0.icon,"aria-hidden":!0}),i]})});function nne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 16c1.25 0 2.313-.438 3.188-1.313.874-.874 1.312-1.937 1.312-3.187 0-1.25-.438-2.313-1.313-3.188C14.313 7.439 13.25 7 12 7c-1.25 0-2.312.438-3.187 1.313C7.938 9.187 7.5 10.25 7.5 11.5c0 1.25.438 2.313 1.313 3.188C9.688 15.562 10.75 16 12 16Zm0-1.8c-.75 0-1.387-.262-1.912-.787A2.604 2.604 0 0 1 9.3 11.5c0-.75.263-1.387.787-1.912A2.604 2.604 0 0 1 12 8.8c.75 0 1.387.262 1.912.787.525.526.788 1.163.788 1.913s-.262 1.387-.787 1.912A2.604 2.604 0 0 1 12 14.2Zm0 4.8c-2.317 0-4.433-.613-6.35-1.837-1.917-1.226-3.367-2.88-4.35-4.963a.812.812 0 0 1-.1-.313 2.93 2.93 0 0 1 0-.774.812.812 0 0 1 .1-.313c.983-2.083 2.433-3.738 4.35-4.963C7.567 4.614 9.683 4 12 4c2.317 0 4.433.612 6.35 1.838 1.917 1.224 3.367 2.879 4.35 4.962a.81.81 0 0 1 .1.313 2.925 2.925 0 0 1 0 .774.81.81 0 0 1-.1.313c-.983 2.083-2.433 3.738-4.35 4.963C16.433 18.387 14.317 19 12 19Zm0-2a9.544 9.544 0 0 0 5.188-1.488A9.773 9.773 0 0 0 20.8 11.5a9.773 9.773 0 0 0-3.613-4.013A9.544 9.544 0 0 0 12 6a9.545 9.545 0 0 0-5.187 1.487A9.773 9.773 0 0 0 3.2 11.5a9.773 9.773 0 0 0 3.613 4.012A9.544 9.544 0 0 0 12 17Z"})})}nne.displayName="VisibilityOnIcon";const LPe=_.forwardRef(nne);function rne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M9.55 17.575c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212L4.55 13c-.183-.183-.27-.42-.263-.713.009-.291.105-.529.288-.712a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275L9.55 15.15l8.475-8.475c.183-.183.42-.275.713-.275.291 0 .529.092.712.275.183.183.275.42.275.713 0 .291-.092.529-.275.712l-9.2 9.2c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}rne.displayName="CheckIcon";const ine=_.forwardRef(rne),APe="_container_1vw5h_18",OPe="_input_1vw5h_26",MPe="_ui_1vw5h_27",Qk={container:APe,input:OPe,ui:MPe},NPe=_.forwardRef(function({className:e,...n},r){const i=Ne(Qk.container,e);return E.jsxs("div",{className:i,children:[E.jsx("input",{ref:r,...n,className:Qk.input,type:"radio"}),E.jsx("div",{className:Qk.ui})]})}),DPe=_.forwardRef(function(e,n){return E.jsx(Zte,{asChild:!0,children:E.jsx(NPe,{ref:n,...e})})}),FPe="_content_md016_17",UPe="_destructive_md016_43",jPe="_success_md016_48",e4={content:FPe,destructive:UPe,success:jPe};function $Pe({className:t,size:e="large",destructive:n=!1,success:r=!1,children:i}){return E.jsx("div",{className:Ne(e4.content,t,{[e4.destructive]:n,[e4.success]:r}),"data-size":e,children:Se.Children.only(i)})}const gy={"nav-bar":"_nav-bar_135dy_16","nav-bar-items":"_nav-bar-items_135dy_22","nav-tab":"_nav-tab_135dy_33","nav-item":"_nav-item_135dy_55"},BPe=({children:t,className:e,role:n,"aria-label":r,...i})=>{const s=Ne(e,gy["nav-bar"]),o=n!=="tablist"?{role:"navigation","aria-label":r}:{role:"presentation"},a=n==="tablist"?{role:"tablist","aria-label":r}:{};return E.jsx("nav",{...o,...i,className:s,children:E.jsx("ul",{...a,className:gy["nav-bar-items"],children:t})})},HPe=_.forwardRef(function({children:e,href:n,onClick:r,...i},s){return E.jsx("a",{href:n,onClick:r,className:gy["nav-item"],...i,ref:s,children:e})}),VPe=_.forwardRef(function({children:e,disabled:n,onClick:r,...i},s){return E.jsx("button",{onClick:r,className:gy["nav-item"],disabled:n,ref:s,...i,children:e})}),GPe=t=>"href"in t&&!!t.href,qPe=_.forwardRef(function(e,n){const r=e["aria-controls"],s=!!r?{"aria-controls":r,role:"tab","aria-selected":e.active}:{"aria-current":e.active?!0:void 0},o={...e};delete o.active;let a;if(GPe(o)){const l=n;a=E.jsx(HPe,{...o,...s,ref:l})}else{const l=n;a=E.jsx(VPe,{...o,...s,ref:l})}return E.jsx("li",{className:gy["nav-tab"],"data-current":e.active?!0:void 0,role:"presentation",children:a})});function sne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 14.95c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212l-4.6-4.6a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l3.9 3.9 3.9-3.9a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7l-4.6 4.6c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}sne.displayName="ChevronDownIcon";const KPe=_.forwardRef(sne);function one(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m13.3 17.3-4.6-4.6a.877.877 0 0 1-.213-.325A1.106 1.106 0 0 1 8.425 12c0-.133.02-.258.062-.375A.878.878 0 0 1 8.7 11.3l4.6-4.6a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7L10.8 12l3.9 3.9a.949.949 0 0 1 .275.7.948.948 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}one.displayName="ChevronLeftIcon";const WPe=_.forwardRef(one);var t4,pB;function zPe(){return pB||(pB=1,t4={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),t4}var YPe=zPe();const XPe=Xa(YPe);var JPe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function mB(t){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(XPe[n[1]]||t.charAt(t.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}for(var i=new RegExp(JPe),s=null;(s=i.exec(t))!==null;)if(s[0].trim())if(s[1]){var o=s[1].trim(),a=[o,""];o.indexOf("=")>-1&&(a=o.split("=")),e.attrs[a[0]]=a[1],i.lastIndex--}else s[2]&&(e.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return e}var ZPe=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,QPe=/^\s*$/,e5e=Object.create(null);function ane(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?function(n){var r=[];for(var i in n)r.push(i+'="'+n[i]+'"');return r.length?" "+r.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(ane,"")+"</"+e.name+">";case"comment":return t+"<!--"+e.comment+"-->"}}var t5e={parse:function(t,e){e||(e={}),e.components||(e.components=e5e);var n,r=[],i=[],s=-1,o=!1;if(t.indexOf("<")!==0){var a=t.indexOf("<");r.push({type:"text",content:a===-1?t:t.substring(0,a)})}return t.replace(ZPe,function(l,c){if(o){if(l!=="</"+n.name+">")return;o=!1}var u,f=l.charAt(1)!=="/",p=l.startsWith("<!--"),m=c+l.length,v=t.charAt(m);if(p){var g=mB(l);return s<0?(r.push(g),r):((u=i[s]).children.push(g),r)}if(f&&(s++,(n=mB(l)).type==="tag"&&e.components[n.name]&&(n.type="component",o=!0),n.voidElement||o||!v||v==="<"||n.children.push({type:"text",content:t.slice(m,t.indexOf("<",m))}),s===0&&r.push(n),(u=i[s-1])&&u.children.push(n),i[s]=n),(!f||n.voidElement)&&(s>-1&&(n.voidElement||n.name===l.slice(2,-1))&&(s--,n=s===-1?r:i[s]),!o&&v!=="<"&&v)){u=s===-1?r:i[s].children;var S=t.indexOf("<",m),b=t.slice(m,S===-1?void 0:S);QPe.test(b)&&(b=" "),(S>-1&&s+u.length>=0||b!==" ")&&u.push({type:"text",content:b})}}),r},stringify:function(t){return t.reduce(function(e,n){return e+ane("",n)},"")}};const lE=(t,e,n,r)=>{var s,o,a,l;const i=[n,{code:e,...r||{}}];if((o=(s=t==null?void 0:t.services)==null?void 0:s.logger)!=null&&o.forward)return t.services.logger.forward(i,"warn","react-i18next::",!0);Wo(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),(l=(a=t==null?void 0:t.services)==null?void 0:a.logger)!=null&&l.warn?t.services.logger.warn(...i):console!=null&&console.warn&&console.warn(...i)},gB={},vy=(t,e,n,r)=>{Wo(n)&&gB[n]||(Wo(n)&&(gB[n]=new Date),lE(t,e,n,r))},lne=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}},XP=(t,e,n)=>{t.loadNamespaces(e,lne(t,n))},vB=(t,e,n,r)=>{if(Wo(n)&&(n=[n]),t.options.preload&&t.options.preload.indexOf(e)>-1)return XP(t,n,r);n.forEach(i=>{t.options.ns.indexOf(i)<0&&t.options.ns.push(i)}),t.loadLanguages(e,lne(t,r))},n5e=(t,e,n={})=>!e.languages||!e.languages.length?(vy(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:n.lng,precheck:(r,i)=>{var s;if(((s=n.bindI18n)==null?void 0:s.indexOf("languageChanging"))>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,t))return!1}}),Wo=t=>typeof t=="string",nh=t=>typeof t=="object"&&t!==null,r5e=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,i5e={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},s5e=t=>i5e[t],o5e=t=>t.replace(r5e,s5e);let JP={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:o5e};const a5e=(t={})=>{JP={...JP,...t}},cne=()=>JP;let une;const l5e=t=>{une=t},XO=()=>une,n4=(t,e)=>{var r;if(!t)return!1;const n=((r=t.props)==null?void 0:r.children)??t.children;return e?n.length>0:!!n},r4=t=>{var n,r;if(!t)return[];const e=((n=t.props)==null?void 0:n.children)??t.children;return(r=t.props)!=null&&r.i18nIsDynamicList?vm(e):e},c5e=t=>Array.isArray(t)&&t.every(_.isValidElement),vm=t=>Array.isArray(t)?t:[t],u5e=(t,e)=>{const n={...e};return n.props=Object.assign(t.props,e.props),n},dne=(t,e,n,r)=>{if(!t)return"";let i="";const s=vm(t),o=e!=null&&e.transSupportBasicHtmlNodes?e.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((a,l)=>{if(Wo(a)){i+=`${a}`;return}if(_.isValidElement(a)){const{props:c,type:u}=a,f=Object.keys(c).length,p=o.indexOf(u)>-1,m=c.children;if(!m&&p&&!f){i+=`<${u}/>`;return}if(!m&&(!p||f)||c.i18nIsDynamicList){i+=`<${l}></${l}>`;return}if(p&&f===1&&Wo(m)){i+=`<${u}>${m}</${u}>`;return}const v=dne(m,e,n,r);i+=`<${l}>${v}</${l}>`;return}if(a===null){lE(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:r});return}if(nh(a)){const{format:c,...u}=a,f=Object.keys(u);if(f.length===1){const p=c?`${f[0]}, ${c}`:f[0];i+=`{{${p}}}`;return}lE(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:r,child:a});return}lE(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:r,child:a})}),i},d5e=(t,e,n,r,i,s)=>{if(e==="")return[];const o=r.transKeepBasicHtmlNodesFor||[],a=e&&new RegExp(o.map(S=>`<${S}`).join("|")).test(e);if(!t&&!a&&!s)return[e];const l={},c=S=>{vm(S).forEach(w=>{Wo(w)||(n4(w)?c(r4(w)):nh(w)&&!_.isValidElement(w)&&Object.assign(l,w))})};c(t);const u=t5e.parse(`<0>${e}</0>`),f={...l,...i},p=(S,b,w)=>{var I;const k=r4(S),T=v(k,b.children,w);return c5e(k)&&T.length===0||(I=S.props)!=null&&I.i18nIsDynamicList?k:T},m=(S,b,w,k,T)=>{S.dummy?(S.children=b,w.push(_.cloneElement(S,{key:k},T?void 0:b))):w.push(..._.Children.map([S],I=>{const C={...I.props};return delete C.i18nIsDynamicList,_.createElement(I.type,{...C,key:k,ref:I.ref},T?null:b)}))},v=(S,b,w)=>{const k=vm(S);return vm(b).reduce((I,C,x)=>{var N,D;const A=((D=(N=C.children)==null?void 0:N[0])==null?void 0:D.content)&&n.services.interpolator.interpolate(C.children[0].content,f,n.language);if(C.type==="tag"){let F=k[parseInt(C.name,10)];w.length===1&&!F&&(F=w[0][C.name]),F||(F={});const $=Object.keys(C.attrs).length!==0?u5e({props:C.attrs},F):F,B=_.isValidElement($),W=B&&n4(C,!0)&&!C.voidElement,H=a&&nh($)&&$.dummy&&!B,z=nh(t)&&Object.hasOwnProperty.call(t,C.name);if(Wo($)){const K=n.services.interpolator.interpolate($,f,n.language);I.push(K)}else if(n4($)||W){const K=p($,C,w);m($,K,I,x)}else if(H){const K=v(k,C.children,w);m($,K,I,x)}else if(Number.isNaN(parseFloat(C.name)))if(z){const K=p($,C,w);m($,K,I,x,C.voidElement)}else if(r.transSupportBasicHtmlNodes&&o.indexOf(C.name)>-1)if(C.voidElement)I.push(_.createElement(C.name,{key:`${C.name}-${x}`}));else{const K=v(k,C.children,w);I.push(_.createElement(C.name,{key:`${C.name}-${x}`},K))}else if(C.voidElement)I.push(`<${C.name} />`);else{const K=v(k,C.children,w);I.push(`<${C.name}>${K}</${C.name}>`)}else if(nh($)&&!B){const K=C.children[0]?A:null;K&&I.push(K)}else m($,A,I,x,C.children.length!==1||!A)}else if(C.type==="text"){const F=r.transWrapTextNodes,$=s?r.unescape(n.services.interpolator.interpolate(C.content,f,n.language)):n.services.interpolator.interpolate(C.content,f,n.language);F?I.push(_.createElement(F,{key:`${C.name}-${x}`},$)):I.push($)}return I},[])},g=v([{dummy:!0,children:t||[]}],u,vm(t||[]));return r4(g[0])},fne=(t,e,n)=>{const r=t.key||e,i=_.cloneElement(t,{key:r});if(!i.props||!i.props.children||n.indexOf(`${e}/>`)<0&&n.indexOf(`${e} />`)<0)return i;function s(){return _.createElement(_.Fragment,null,i)}return _.createElement(s,{key:r})},f5e=(t,e)=>t.map((n,r)=>fne(n,r,e)),h5e=(t,e)=>{const n={};return Object.keys(t).forEach(r=>{Object.assign(n,{[r]:fne(t[r],r,e)})}),n},p5e=(t,e,n,r)=>t?Array.isArray(t)?f5e(t,e):nh(t)?h5e(t,e):(vy(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:r}),null):null;function m5e({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:l,ns:c,i18n:u,t:f,shouldUnescape:p,...m}){var $,B,W,H,z,K;const v=u||XO();if(!v)return vy(v,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:r}),t;const g=f||v.t.bind(v)||(V=>V),S={...cne(),...($=v.options)==null?void 0:$.react};let b=c||g.ns||((B=v.options)==null?void 0:B.defaultNS);b=Wo(b)?[b]:b||["translation"];const w=dne(t,S,v,r),k=a||w||S.transEmptyNodeValue||r,{hashTransKey:T}=S,I=r||(T?T(w||k):w||k);(H=(W=v.options)==null?void 0:W.interpolation)!=null&&H.defaultVariables&&(o=o&&Object.keys(o).length>0?{...o,...v.options.interpolation.defaultVariables}:{...v.options.interpolation.defaultVariables});const C=o||e!==void 0&&!((K=(z=v.options)==null?void 0:z.interpolation)!=null&&K.alwaysFormat)||!t?s.interpolation:{interpolation:{...s.interpolation,prefix:"#$?",suffix:"?$#"}},x={...s,context:i||s.context,count:e,...o,...C,defaultValue:k,ns:b},A=I?g(I,x):k,N=p5e(l,A,v,r),D=d5e(N||t,A,v,S,x,p),F=n??S.defaultTransParent;return F?_.createElement(F,m,D):D}const g5e={type:"3rdParty",init(t){a5e(t.options.react),l5e(t)}},hne=_.createContext();class v5e{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function Os({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:l,ns:c,i18n:u,t:f,shouldUnescape:p,...m}){var w;const{i18n:v,defaultNS:g}=_.useContext(hne)||{},S=u||v||XO(),b=f||(S==null?void 0:S.t.bind(S));return m5e({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s,values:o,defaults:a,components:l,ns:c||(b==null?void 0:b.ns)||g||((w=S==null?void 0:S.options)==null?void 0:w.defaultNS),i18n:S,t:f,shouldUnescape:p,...m})}const y5e=(t,e)=>{const n=_.useRef();return _.useEffect(()=>{n.current=t},[t,e]),n.current},pne=(t,e,n,r)=>t.getFixedT(e,n,r),_5e=(t,e,n,r)=>_.useCallback(pne(t,e,n,r),[t,e,n,r]),et=(t,e={})=>{var T,I,C,x;const{i18n:n}=e,{i18n:r,defaultNS:i}=_.useContext(hne)||{},s=n||r||XO();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new v5e),!s){vy(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const A=(D,F)=>Wo(F)?F:nh(F)&&Wo(F.defaultValue)?F.defaultValue:Array.isArray(D)?D[D.length-1]:D,N=[A,{},!1];return N.t=A,N.i18n={},N.ready=!1,N}(T=s.options.react)!=null&&T.wait&&vy(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...cne(),...s.options.react,...e},{useSuspense:a,keyPrefix:l}=o;let c=i||((I=s.options)==null?void 0:I.defaultNS);c=Wo(c)?[c]:c||["translation"],(x=(C=s.reportNamespaces).addUsedNamespaces)==null||x.call(C,c);const u=(s.isInitialized||s.initializedStoreOnce)&&c.every(A=>n5e(A,s,o)),f=_5e(s,e.lng||null,o.nsMode==="fallback"?c:c[0],l),p=()=>f,m=()=>pne(s,e.lng||null,o.nsMode==="fallback"?c:c[0],l),[v,g]=_.useState(p);let S=c.join();e.lng&&(S=`${e.lng}${S}`);const b=y5e(S),w=_.useRef(!0);_.useEffect(()=>{const{bindI18n:A,bindI18nStore:N}=o;w.current=!0,!u&&!a&&(e.lng?vB(s,e.lng,c,()=>{w.current&&g(m)}):XP(s,c,()=>{w.current&&g(m)})),u&&b&&b!==S&&w.current&&g(m);const D=()=>{w.current&&g(m)};return A&&(s==null||s.on(A,D)),N&&(s==null||s.store.on(N,D)),()=>{w.current=!1,s&&(A==null||A.split(" ").forEach(F=>s.off(F,D))),N&&s&&N.split(" ").forEach(F=>s.store.off(F,D))}},[s,S]),_.useEffect(()=>{w.current&&u&&g(p)},[s,l,u]);const k=[v,s,u];if(k.t=v,k.i18n=s,k.ready=u,u||!u&&!a)return k;throw new Promise(A=>{e.lng?vB(s,e.lng,c,()=>A()):XP(s,c,()=>A())})};function mne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"m12 4.236-6 3V12c0 5.156 4.239 7.254 6 7.898 1.761-.644 6-2.742 6-7.898V7.236l-6-3Zm-.894-1.789a2 2 0 0 1 1.788 0l6 3A2 2 0 0 1 20 7.236V12c0 6.742-5.773 9.246-7.51 9.846-.32.111-.66.111-.98 0C9.774 21.246 4 18.742 4 12V7.236a2 2 0 0 1 1.106-1.789l6-3Z",clipRule:"evenodd"})})}mne.displayName="AdminIcon";const b5e=_.forwardRef(mne);function gne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m12 10.775-3.9 3.9a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l4.6-4.6c.1-.1.208-.17.325-.213.117-.041.242-.062.375-.062s.258.02.375.062a.877.877 0 0 1 .325.213l4.6 4.6a.948.948 0 0 1 .275.7.949.949 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275l-3.9-3.9Z"})})}gne.displayName="ChevronUpIcon";const S5e=_.forwardRef(gne);function vne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 11.034a.996.996 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 1 0 0-2h-5.586L22 3.446a1 1 0 0 0-1.414-1.415L14 8.617V3.031a1 1 0 1 0-2 0v8.003Zm0 1.963a.997.997 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 11 12H3a1 1 0 0 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 1 0 2 0v-8.003Z"})})}vne.displayName="CollapseIcon";const E5e=_.forwardRef(vne);function yne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M7 21c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 5 19V6a.968.968 0 0 1-.713-.287A.968.968 0 0 1 4 5c0-.283.096-.52.287-.713A.968.968 0 0 1 5 4h4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 10 3h4a.97.97 0 0 1 .713.288A.968.968 0 0 1 15 4h4a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 19 6v13c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 17 21H7ZM7 6v13h10V6H7Zm2 10c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 11 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 10 8a.968.968 0 0 0-.713.287A.968.968 0 0 0 9 9v7Zm4 0c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 15 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 14 8a.968.968 0 0 0-.713.287A.967.967 0 0 0 13 9v7Z"})})}yne.displayName="DeleteIcon";const w5e=_.forwardRef(yne);function _ne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.212l1.414-5.657a1 1 0 0 1 .263-.465L15.706 2.637Zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.77 3.771-.942L16.93 9.9Z",clipRule:"evenodd"})})}_ne.displayName="EditIcon";const yB=_.forwardRef(_ne);function bne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.018 1.018 0 0 1 0 12.852c0-.304.098-.555.295-.751a15.64 15.64 0 0 1 5.316-3.786A15.89 15.89 0 0 1 12 7c2.237 0 4.367.443 6.39 1.329a15.977 15.977 0 0 1 5.315 3.772c.197.196.295.447.295.751 0 .305-.098.555-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.067 1.067 0 0 1-.322-.376 1.066 1.066 0 0 1-.108-.483v-2.27a13.593 13.593 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.175.175c-.715.116-1.422.29-2.12.523v2.271c0 .179-.036.34-.108.483a1.066 1.066 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107Z"})})}bne.displayName="EndCallIcon";const Sne=_.forwardRef(bne);function Ene(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M21 3.997a.996.996 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a.997.997 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0V3.997Z"})})}Ene.displayName="ExpandIcon";const wne=_.forwardRef(Ene);function Cne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M4 11a.967.967 0 0 1-.712-.287A.968.968 0 0 1 3 10V4c0-.283.096-.52.288-.712A.968.968 0 0 1 4 3h6a.97.97 0 0 1 .713.288A.968.968 0 0 1 11 4v6c0 .283-.096.52-.287.713A.968.968 0 0 1 10 11H4Zm5-2V5H5v4h4Zm5 12a.968.968 0 0 1-.713-.288A.968.968 0 0 1 13 20v-6c0-.283.096-.52.287-.713A.968.968 0 0 1 14 13h6a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v6c0 .283-.096.52-.288.712A.968.968 0 0 1 20 21h-6Zm5-2v-4h-4v4h4ZM4 21a.967.967 0 0 1-.712-.288A.968.968 0 0 1 3 20v-6a.97.97 0 0 1 .288-.713A.967.967 0 0 1 4 13h6c.283 0 .52.096.713.287.191.192.287.43.287.713v6a.97.97 0 0 1-.287.712A.968.968 0 0 1 10 21H4Zm5-2v-4H5v4h4Zm5-8a.968.968 0 0 1-.713-.287A.968.968 0 0 1 13 10V4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 14 3h6c.283 0 .52.096.712.288A.965.965 0 0 1 21 4v6a.97.97 0 0 1-.288.713A.968.968 0 0 1 20 11h-6Zm5-2V5h-4v4h4Z"})})}Cne.displayName="GridIcon";const C5e=_.forwardRef(Cne);function Tne(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M16.712 6.713A.968.968 0 0 1 16 7a.968.968 0 0 1-.713-.287A.967.967 0 0 1 15 6c0-.283.096-.52.287-.713A.968.968 0 0 1 16 5a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713Z"}),E.jsx("path",{fillRule:"evenodd",d:"M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H6Zm12 2H6v4h12V4ZM6 12v-2h12v2H6Zm0 2v2h12v-2H6Zm0 6v-2h12v2H6Z",clipRule:"evenodd"})]})}Tne.displayName="HostIcon";const T5e=_.forwardRef(Tne);function Rne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 19.071c-.978.978-2.157 1.467-3.536 1.467-1.378 0-2.557-.489-3.535-1.467-.978-.978-1.467-2.157-1.467-3.536 0-1.378.489-2.557 1.467-3.535L7.05 9.879c.2-.2.436-.3.707-.3.271 0 .507.1.707.3.2.2.301.436.301.707 0 .27-.1.506-.3.707l-2.122 2.121a2.893 2.893 0 0 0-.884 2.122c0 .824.295 1.532.884 2.12.59.59 1.296.885 2.121.885s1.533-.295 2.122-.884l2.121-2.121c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707L12 19.07Zm-1.414-4.243c-.2.2-.436.3-.707.3a.967.967 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l4.243-4.242c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707l-4.242 4.242Zm6.364-.707c-.2.2-.436.3-.707.3a.968.968 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l2.122-2.121c.59-.59.884-1.297.884-2.122s-.295-1.532-.884-2.12a2.893 2.893 0 0 0-2.121-.885c-.825 0-1.532.295-2.122.884l-2.121 2.121c-.2.2-.436.301-.707.301a.968.968 0 0 1-.707-.3.97.97 0 0 1-.3-.708c0-.27.1-.506.3-.707L12 4.93c.978-.978 2.157-1.467 3.536-1.467 1.378 0 2.557.489 3.535 1.467.978.978 1.467 2.157 1.467 3.535 0 1.38-.489 2.558-1.467 3.536l-2.121 2.121Z"})})}Rne.displayName="LinkIcon";const R5e=_.forwardRef(Rne);function Ine(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.587-1.412.212-.212.446-.366.703-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 0 1-1.414 1.414l-.896-.896A1.935 1.935 0 0 1 18 22H6Zm14-4.834V10c0-.55-.196-1.02-.587-1.412A1.926 1.926 0 0 0 18 8h-1V6c0-1.383-.488-2.563-1.463-3.538C14.563 1.487 13.383 1 12 1s-2.563.488-3.538 1.462A4.876 4.876 0 0 0 7.243 4.41L9 6.166V6c0-.833.292-1.542.875-2.125A2.893 2.893 0 0 1 12 3c.833 0 1.542.292 2.125.875S15 5.167 15 6v2h-4.166L20 17.166Z"})})}Ine.displayName="LockOffIcon";const I5e=_.forwardRef(Ine);function kne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 8h1V6c0-1.383.487-2.563 1.463-3.538C9.438 1.487 10.617 1 12 1s2.563.488 3.537 1.462C16.512 3.438 17 4.617 17 6v2h1c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v10c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 22H6ZM9 8h6V6c0-.833-.292-1.542-.875-2.125A2.893 2.893 0 0 0 12 3c-.833 0-1.542.292-2.125.875A2.893 2.893 0 0 0 9 6v2Z"})})}kne.displayName="LockSolidIcon";const k5e=_.forwardRef(kne);function xne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.949 7.949 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Zm9.417 6.583 1.478 1.477A7.963 7.963 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583ZM8.073 5.238l7.793 7.793c.087-.329.134-.674.134-1.031V6a4 4 0 0 0-7.927-.762Z"})})}xne.displayName="MicOffSolidIcon";const Pne=_.forwardRef(xne);function Lne(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.947 7.947 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Z",clipRule:"evenodd"}),E.jsx("path",{d:"M14 6v5.166l1.866 1.866c.087-.33.134-.675.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0Zm3.417 8.583 1.477 1.477A7.963 7.963 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583Z"})]})}Lne.displayName="MicOffIcon";const x5e=_.forwardRef(Lne);function Ane(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0V6Z"}),E.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8.001 8.001 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 0 1 1-1Z"})]})}Ane.displayName="MicOnSolidIcon";const JO=_.forwardRef(Ane);function One(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414l4.113 4.114a5.484 5.484 0 0 0-.184 1.069A5.002 5.002 0 0 0 7 20h10.172l1.914 1.914A1 1 0 0 0 20.5 20.5l-.979-.979.004-.002L7.145 7.14l-.002.004L3.5 3.5Zm18.5 12a4.48 4.48 0 0 1-.928 2.738L8.637 5.803A5.474 5.474 0 0 1 11.5 5a5.49 5.49 0 0 1 4.25 2.008 4 4 0 0 1 4.187 4.708A4.497 4.497 0 0 1 22 15.5Z"})})}One.displayName="OfflineIcon";const P5e=_.forwardRef(One);function Mne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 14c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 4 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 6 14Zm6 0c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 12 14Zm6 0c-.55 0-1.02-.196-1.413-.588A1.926 1.926 0 0 1 16 12c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 18 10c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412 0 .55-.196 1.02-.587 1.412A1.926 1.926 0 0 1 18 14Z"})})}Mne.displayName="OverflowHorizontalIcon";const L5e=_.forwardRef(Mne);function Nne(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"}),E.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2Z"})]})}Nne.displayName="PopOutIcon";const Dne=_.forwardRef(Nne);function Fne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M11 3a1 1 0 1 1 2 0v8.5a.5.5 0 0 0 1 0V4a1 1 0 1 1 2 0v10.2l3.284-2.597a1.081 1.081 0 0 1 1.47 1.577c-.613.673-1.214 1.367-1.818 2.064-1.267 1.463-2.541 2.934-3.944 4.235A6 6 0 0 1 5 15V7a1 1 0 0 1 2 0v5.5a.5.5 0 0 0 1 0V4a1 1 0 0 1 2 0v7.5a.5.5 0 0 0 1 0V3Z"})})}Fne.displayName="RaisedHandSolidIcon";const Une=_.forwardRef(Fne);function jne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{fillRule:"evenodd",d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Zm3.536-6.464a1 1 0 0 0-1.415-1.415A2.988 2.988 0 0 1 12 15a2.988 2.988 0 0 1-2.121-.879 1 1 0 1 0-1.414 1.415A4.987 4.987 0 0 0 12 17c1.38 0 2.632-.56 3.536-1.464ZM10 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm5.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z",clipRule:"evenodd"})})}jne.displayName="ReactionSolidIcon";const A5e=_.forwardRef(jne);function $ne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286.085.034.17.07.253.106.531.23 1.162.16 1.572-.25a1.269 1.269 0 0 1 1.794 0l1.034 1.035a1.269 1.269 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572.036.084.07.168.105.253.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935-.033.085-.068.17-.104.253-.232.531-.161 1.162.248 1.572a1.269 1.269 0 0 1 0 1.794l-1.034 1.034a1.269 1.269 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a7.935 7.935 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a7.975 7.975 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.269 1.269 0 0 1-1.794 0l-1.034-1.034a1.269 1.269 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a7.89 7.89 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935.034-.085.07-.17.106-.253.23-.531.16-1.162-.25-1.572a1.269 1.269 0 0 1 0-1.794l1.035-1.034a1.269 1.269 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a7.93 7.93 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2h1.462ZM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"})})}$ne.displayName="SettingsSolidIcon";const O5e=_.forwardRef($ne);function Bne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M1.288 20.712A.965.965 0 0 0 2 21h20c.283 0 .52-.096.712-.288A.968.968 0 0 0 23 20a.968.968 0 0 0-.288-.712A.968.968 0 0 0 22 19H2a.967.967 0 0 0-.712.288A.968.968 0 0 0 1 20c0 .283.096.52.288.712Zm1.299-3.299A1.926 1.926 0 0 1 2 16V5c0-.55.196-1.02.587-1.413A1.926 1.926 0 0 1 4 3h16c.55 0 1.02.196 1.413.587.39.393.587.863.587 1.413v11c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 18H4c-.55 0-1.02-.196-1.413-.587Zm10.12-10.12a1 1 0 0 0-1.414 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414l-2.5-2.5Z"})})}Bne.displayName="ShareScreenSolidIcon";const M5e=_.forwardRef(Bne);function Hne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12 16a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 15V7.85L9.125 9.725c-.2.2-.433.3-.7.3-.267 0-.508-.108-.725-.325a.93.93 0 0 1-.288-.712A.977.977 0 0 1 7.7 8.3l3.6-3.6c.1-.1.208-.17.325-.212.117-.042.242-.063.375-.063s.258.02.375.063a.877.877 0 0 1 .325.212l3.6 3.6c.2.2.296.438.287.713a.977.977 0 0 1-.287.687c-.2.2-.438.304-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15c0 .283-.096.52-.287.713A.968.968 0 0 1 12 16Zm-6 4c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 18v-2c0-.283.096-.52.287-.713A.968.968 0 0 1 5 15c.283 0 .52.096.713.287.191.192.287.43.287.713v2h12v-2a.97.97 0 0 1 .288-.713A.968.968 0 0 1 19 15a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v2c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 20H6Z"})})}Hne.displayName="ShareIcon";const N5e=_.forwardRef(Hne);function Vne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5V5Zm10 14v-4h4v4h-4ZM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2Z"})})}Vne.displayName="SpotlightIcon";const D5e=_.forwardRef(Vne);function Gne(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M16.293 2.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-2 2a1 1 0 1 1-1.414-1.414L16.586 6H6a2 2 0 0 0-2 2v7a1 1 0 1 1-2 0V8a4 4 0 0 1 4-4h10.586l-.293-.293a1 1 0 0 1 0-1.414ZM18 18H7.414l.293-.293a1 1 0 1 0-1.414-1.414l-2 2a1 1 0 0 0 0 1.414l2 2a1 1 0 0 0 1.414-1.414L7.414 20H18a4 4 0 0 0 4-4V9a1 1 0 1 0-2 0v7a2 2 0 0 1-2 2Z"}),E.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"})]})}Gne.displayName="SwitchCameraSolidIcon";const F5e=_.forwardRef(Gne);function qne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M12.999 13.011v-.004.005Zm-9.412 7.402C3.98 20.803 4.45 21 5 21h14c.55 0 1.02-.196 1.413-.587A1.93 1.93 0 0 0 21 19V5c0-.55-.196-1.02-.587-1.413A1.926 1.926 0 0 0 19 3H5c-.55 0-1.02.196-1.413.587A1.926 1.926 0 0 0 3 5v14c0 .55.196 1.02.587 1.413ZM12 9a1 1 0 0 0-1 1 1 1 0 1 1-2 0 3 3 0 1 1 4.44 2.633 1.404 1.404 0 0 0-.383.288.3.3 0 0 0-.057.085A1 1 0 0 1 11 13c0-.58.253-1.047.539-1.38.281-.33.63-.572.94-.742A1 1 0 0 0 12 9Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"})})}qne.displayName="UnknownSolidIcon";const U5e=_.forwardRef(qne);function Kne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M10 12c-1.1 0-2.042-.392-2.825-1.175C6.392 10.042 6 9.1 6 8s.392-2.042 1.175-2.825C7.958 4.392 8.9 4 10 4s2.042.392 2.825 1.175C13.608 5.958 14 6.9 14 8s-.392 2.042-1.175 2.825C12.042 11.608 11.1 12 10 12Zm-8 6v-.8c0-.567.146-1.087.438-1.563A2.911 2.911 0 0 1 3.6 14.55a14.843 14.843 0 0 1 3.15-1.163A13.76 13.76 0 0 1 10 13c1.1 0 2.183.13 3.25.387 1.067.259 2.117.646 3.15 1.163.483.25.87.612 1.163 1.087.291.476.437.996.437 1.563v.8c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 16 20H4c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18Zm2 0h12v-.8a.973.973 0 0 0-.5-.85c-.9-.45-1.808-.787-2.725-1.012a11.6 11.6 0 0 0-5.55 0c-.917.225-1.825.562-2.725 1.012a.973.973 0 0 0-.5.85v.8Zm6-8c.55 0 1.02-.196 1.412-.588C11.804 9.021 12 8.55 12 8c0-.55-.196-1.02-.588-1.412A1.926 1.926 0 0 0 10 6c-.55 0-1.02.196-1.412.588A1.926 1.926 0 0 0 8 8c0 .55.196 1.02.588 1.412.391.392.862.588 1.412.588Zm7 1h2v2c0 .283.096.52.288.713.191.191.429.287.712.287s.52-.096.712-.287A.968.968 0 0 0 21 13v-2h2a.97.97 0 0 0 .712-.287A.968.968 0 0 0 24 10a.967.967 0 0 0-.288-.713A.968.968 0 0 0 23 9h-2V7a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 6a.968.968 0 0 0-.712.287A.967.967 0 0 0 19 7v2h-2a.968.968 0 0 0-.712.287A.967.967 0 0 0 16 10c0 .283.096.52.288.713A.968.968 0 0 0 17 11Z"})})}Kne.displayName="UserAddIcon";const j5e=_.forwardRef(Kne);function Wne(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M9.175 13.825C9.958 14.608 10.9 15 12 15s2.042-.392 2.825-1.175C15.608 13.042 16 12.1 16 11s-.392-2.042-1.175-2.825C14.042 7.392 13.1 7 12 7s-2.042.392-2.825 1.175C8.392 8.958 8 9.9 8 11s.392 2.042 1.175 2.825Zm4.237-1.412A1.926 1.926 0 0 1 12 13c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 11c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 9c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412Z"}),E.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"}),E.jsx("path",{d:"M16.23 18.792a12.47 12.47 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0c-.487.12-.972.271-1.455.455a8.04 8.04 0 0 1-1.729-1.454c.89-.412 1.794-.729 2.709-.95A13.76 13.76 0 0 1 12 16c1.1 0 2.183.13 3.25.387a14.78 14.78 0 0 1 2.709.95 8.042 8.042 0 0 1-1.73 1.455Z"})]})}Wne.displayName="UserProfileIcon";const zne=_.forwardRef(Wne);function Yne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A1.992 1.992 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414ZM18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715v1.45Z"})})}Yne.displayName="VideoCallOffSolidIcon";const $5e=_.forwardRef(Yne);function Xne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4Z"})})}Xne.displayName="VideoCallSolidIcon";const Jne=_.forwardRef(Xne);function Zne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2l3.293 3.293c.63.63 1.707.184 1.707-.707v-3.758l7.086 7.086A1 1 0 0 0 20.5 20.5l-2.136-2.136.003-.003-1.414-1.414-.003.003-1.414-1.414.003-.003-1.415-1.415-.002.003L12 12v-.006L7.503 7.497 7.5 7.5l-4-4Zm11.496 8.662 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}Zne.displayName="VolumeOffSolidIcon";const B5e=_.forwardRef(Zne);function Qne(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5ZM7.172 10H5v4h2.828L10 16.17v-3.343L7.172 10Zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}Qne.displayName="VolumeOffIcon";const H5e=_.forwardRef(Qne);function ere(t,e){return E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[E.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4Zm4.828 4L10 16.172V7.828L7.828 10H5v4h2.828Zm6.293-5.536a1 1 0 0 1 1.415 0A4.988 4.988 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 2.987 2.987 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414Z"}),E.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.975 6.975 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.975 8.975 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364Z"})]})}ere.displayName="VolumeOnIcon";const V5e=_.forwardRef(ere);function tre(t,e){return E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:E.jsx("path",{d:"M4 20c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18V6c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 4 4h16c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v12c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 20H4Zm0-2h16V8H4v10Z"})})}tre.displayName="WebBrowserIcon";const G5e=_.forwardRef(tre),q5e="_header_p1omj_8",K5e="_nav_p1omj_18",W5e="_headerLogo_p1omj_26",z5e="_leftNav_p1omj_33",Y5e="_hideMobile_p1omj_33",X5e="_rightNav_p1omj_45",J5e="_roomHeaderInfo_p1omj_61",Z5e="_roomAvatar_p1omj_76",Q5e="_nameLine_p1omj_81",eLe="_participantsLine_p1omj_100",Bo={header:q5e,nav:K5e,headerLogo:W5e,leftNav:z5e,hideMobile:Y5e,rightNav:X5e,roomHeaderInfo:J5e,roomAvatar:Z5e,nameLine:Q5e,participantsLine:eLe},tLe=(t,e)=>_.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("desc",null,"Element Call (Beta)"),_.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),_.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),_.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),_.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),_.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),_.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),_.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),_.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),nLe=_.forwardRef(tLe);var av=(t=>(t.XS="xs",t.SM="sm",t.MD="md",t.LG="lg",t.XL="xl",t))(av||{});const rLe=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]);function iLe(t,e,n=96){const r=Math.floor(n*window.devicePixelRatio),i=Math.floor(n*window.devicePixelRatio),s=n<=96?"crop":"scale";return e?t.mxcUrlToHttp(e,r,i,s,!1,!0,!0):null}const lv=({className:t,id:e,name:n,src:r,size:i="md",style:s,...o})=>{const a=fv(),l=_.useMemo(()=>Object.values(av).includes(i)?rLe.get(i):i,[i]),[c,u]=_.useState(void 0);return _.useEffect(()=>{if((a==null?void 0:a.state)!=="valid")return;const{authenticated:f,supportedFeatures:p}=a,m=f==null?void 0:f.client;if(!m||!r||!l||!p.thumbnails)return;const v=m.getAccessToken();if(!v)return;const g=iLe(m,r,l);if(!g){u(void 0);return}let S;return fetch(g,{headers:{Authorization:`Bearer ${v}`}}).then(async b=>b.blob()).then(b=>{S=URL.createObjectURL(b),u(S)}).catch(b=>{u(void 0)}),()=>{S&&URL.revokeObjectURL(S)}},[a,r,l]),E.jsx(BRe,{className:t,id:e,name:n,size:`${l}px`,src:c,style:s,...o})},sLe="_lock_zf62g_8",oLe={lock:sLe},aLe=({encrypted:t})=>{const{t:e}=et(),n=t?k5e:I5e,r=e(t?"common.encrypted":"common.unencrypted");return E.jsx(Vi,{label:r,placement:"right",isTriggerInteractive:!1,children:E.jsx(n,{width:16,height:16,className:oLe.lock,"data-encrypted":t})})};function x1(t,e,n,r){_.useEffect(()=>{if(t)return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)},[t,e,n,r])}function ST(t,e,n){_.useEffect(()=>(t.on(e,n),()=>{t.off(e,n)}),[t,e,n])}function ET(t){const e=_.useMemo(()=>window.matchMedia(t),[t]),[n,r]=_.useState(0);return x1(e,"change",_.useCallback(()=>r(i=>i+1),[r])),_.useMemo(()=>e.matches,[e,n])}const uf=_.forwardRef(({children:t,className:e,...n},r)=>E.jsx("header",{ref:r,className:Ne(Bo.header,e),...n,children:t}));uf.displayName="Header";const Jh=({children:t,className:e,hideMobile:n,...r})=>E.jsx("div",{className:Ne(Bo.nav,Bo.leftNav,{[Bo.hideMobile]:n},e),...r,children:t}),Zh=({children:t,className:e,hideMobile:n,...r})=>E.jsx("div",{className:Ne(Bo.nav,Bo.rightNav,{[Bo.hideMobile]:n},e),...r,children:t}),Oh=({className:t})=>{const{t:e}=et();return E.jsx(WC,{className:Ne(Bo.headerLogo,t),to:"/","aria-label":e("header_label"),children:E.jsx(nLe,{})})},nre=({id:t,name:e,avatarUrl:n,encrypted:r,participantCount:i})=>{const{t:s}=et(),o=ET("(max-width: 550px)")?"sm":"lg";return E.jsxs("div",{className:Bo.roomHeaderInfo,"data-size":o,children:[E.jsx(lv,{className:Bo.roomAvatar,id:t,name:e,size:o==="sm"?av.SM:56,src:n??void 0}),E.jsxs("div",{className:Bo.nameLine,children:[E.jsx(cf,{type:o==="sm"?"body":"heading",size:o==="sm"?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:e}),E.jsx(aLe,{encrypted:r})]}),(i??0)>0&&E.jsxs("div",{className:Bo.participantsLine,children:[E.jsx(zne,{width:20,height:20,"aria-label":s("header_participants_label")}),E.jsx(ln,{as:"span",size:"sm",weight:"medium","data-testid":"roomHeader_participants_count",children:s("participant_count",{count:i??0})})]})]})},lLe="_page_fvtgn_8",cLe="_container_fvtgn_20",uLe="_content_fvtgn_28",i4={page:lLe,container:cLe,content:uLe};var rre=typeof global=="object"&&global&&global.Object===Object&&global,dLe=typeof self=="object"&&self&&self.Object===Object&&self,Qh=rre||dLe||Function("return this")(),Iw=Qh.Symbol,ire=Object.prototype,fLe=ire.hasOwnProperty,hLe=ire.toString,P0=Iw?Iw.toStringTag:void 0;function pLe(t){var e=fLe.call(t,P0),n=t[P0];try{t[P0]=void 0;var r=!0}catch{}var i=hLe.call(t);return r&&(e?t[P0]=n:delete t[P0]),i}var mLe=Object.prototype,gLe=mLe.toString;function vLe(t){return gLe.call(t)}var yLe="[object Null]",_Le="[object Undefined]",_B=Iw?Iw.toStringTag:void 0;function b_(t){return t==null?t===void 0?_Le:yLe:_B&&_B in Object(t)?pLe(t):vLe(t)}function cv(t){return t!=null&&typeof t=="object"}var bLe="[object Symbol]";function SLe(t){return typeof t=="symbol"||cv(t)&&b_(t)==bLe}var ZP=Array.isArray,ELe=/\s/;function wLe(t){for(var e=t.length;e--&&ELe.test(t.charAt(e)););return e}var CLe=/^\s+/;function TLe(t){return t&&t.slice(0,wLe(t)+1).replace(CLe,"")}function Wa(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var bB=NaN,RLe=/^[-+]0x[0-9a-f]+$/i,ILe=/^0b[01]+$/i,kLe=/^0o[0-7]+$/i,xLe=parseInt;function SB(t){if(typeof t=="number")return t;if(SLe(t))return bB;if(Wa(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Wa(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=TLe(t);var n=ILe.test(t);return n||kLe.test(t)?xLe(t.slice(2),n?2:8):RLe.test(t)?bB:+t}function sre(t){return t}var PLe="[object AsyncFunction]",LLe="[object Function]",ALe="[object GeneratorFunction]",OLe="[object Proxy]";function ZO(t){if(!Wa(t))return!1;var e=b_(t);return e==LLe||e==ALe||e==PLe||e==OLe}var s4=Qh["__core-js_shared__"],EB=function(){var t=/[^.]+$/.exec(s4&&s4.keys&&s4.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function MLe(t){return!!EB&&EB in t}var NLe=Function.prototype,DLe=NLe.toString;function FLe(t){if(t!=null){try{return DLe.call(t)}catch{}try{return t+""}catch{}}return""}var ULe=/[\\^$.*+?()[\]{}|]/g,jLe=/^\[object .+?Constructor\]$/,$Le=Function.prototype,BLe=Object.prototype,HLe=$Le.toString,VLe=BLe.hasOwnProperty,GLe=RegExp("^"+HLe.call(VLe).replace(ULe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function qLe(t){if(!Wa(t)||MLe(t))return!1;var e=ZO(t)?GLe:jLe;return e.test(FLe(t))}function KLe(t,e){return t==null?void 0:t[e]}function QO(t,e){var n=KLe(t,e);return qLe(n)?n:void 0}var wB=Object.create,WLe=function(){function t(){}return function(e){if(!Wa(e))return{};if(wB)return wB(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function zLe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function YLe(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var XLe=800,JLe=16,ZLe=Date.now;function QLe(t){var e=0,n=0;return function(){var r=ZLe(),i=JLe-(r-n);if(n=r,i>0){if(++e>=XLe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function eAe(t){return function(){return t}}var kw=function(){try{var t=QO(Object,"defineProperty");return t({},"",{}),t}catch{}}(),tAe=kw?function(t,e){return kw(t,"toString",{configurable:!0,enumerable:!1,value:eAe(e),writable:!0})}:sre,nAe=QLe(tAe),rAe=9007199254740991,iAe=/^(?:0|[1-9]\d*)$/;function ore(t,e){var n=typeof t;return e=e??rAe,!!e&&(n=="number"||n!="symbol"&&iAe.test(t))&&t>-1&&t%1==0&&t<e}function e8(t,e,n){e=="__proto__"&&kw?kw(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function wT(t,e){return t===e||t!==t&&e!==e}var sAe=Object.prototype,oAe=sAe.hasOwnProperty;function aAe(t,e,n){var r=t[e];(!(oAe.call(t,e)&&wT(r,n))||n===void 0&&!(e in t))&&e8(t,e,n)}function lAe(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=void 0;l===void 0&&(l=t[a]),i?e8(n,a,l):aAe(n,a,l)}return n}var CB=Math.max;function cAe(t,e,n){return e=CB(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=CB(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),zLe(t,this,a)}}function uAe(t,e){return nAe(cAe(t,e,sre),t+"")}var dAe=9007199254740991;function are(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=dAe}function t8(t){return t!=null&&are(t.length)&&!ZO(t)}function fAe(t,e,n){if(!Wa(n))return!1;var r=typeof e;return(r=="number"?t8(n)&&ore(e,n.length):r=="string"&&e in n)?wT(n[e],t):!1}function hAe(t){return uAe(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&fAe(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var pAe=Object.prototype;function lre(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||pAe;return t===n}function mAe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var gAe="[object Arguments]";function TB(t){return cv(t)&&b_(t)==gAe}var cre=Object.prototype,vAe=cre.hasOwnProperty,yAe=cre.propertyIsEnumerable,QP=TB(function(){return arguments}())?TB:function(t){return cv(t)&&vAe.call(t,"callee")&&!yAe.call(t,"callee")};function _Ae(){return!1}var ure=typeof exports=="object"&&exports&&!exports.nodeType&&exports,RB=ure&&typeof module=="object"&&module&&!module.nodeType&&module,bAe=RB&&RB.exports===ure,IB=bAe?Qh.Buffer:void 0,SAe=IB?IB.isBuffer:void 0,dre=SAe||_Ae,EAe="[object Arguments]",wAe="[object Array]",CAe="[object Boolean]",TAe="[object Date]",RAe="[object Error]",IAe="[object Function]",kAe="[object Map]",xAe="[object Number]",PAe="[object Object]",LAe="[object RegExp]",AAe="[object Set]",OAe="[object String]",MAe="[object WeakMap]",NAe="[object ArrayBuffer]",DAe="[object DataView]",FAe="[object Float32Array]",UAe="[object Float64Array]",jAe="[object Int8Array]",$Ae="[object Int16Array]",BAe="[object Int32Array]",HAe="[object Uint8Array]",VAe="[object Uint8ClampedArray]",GAe="[object Uint16Array]",qAe="[object Uint32Array]",On={};On[FAe]=On[UAe]=On[jAe]=On[$Ae]=On[BAe]=On[HAe]=On[VAe]=On[GAe]=On[qAe]=!0;On[EAe]=On[wAe]=On[NAe]=On[CAe]=On[DAe]=On[TAe]=On[RAe]=On[IAe]=On[kAe]=On[xAe]=On[PAe]=On[LAe]=On[AAe]=On[OAe]=On[MAe]=!1;function KAe(t){return cv(t)&&are(t.length)&&!!On[b_(t)]}function WAe(t){return function(e){return t(e)}}var fre=typeof exports=="object"&&exports&&!exports.nodeType&&exports,P1=fre&&typeof module=="object"&&module&&!module.nodeType&&module,zAe=P1&&P1.exports===fre,o4=zAe&&rre.process,kB=function(){try{var t=P1&&P1.require&&P1.require("util").types;return t||o4&&o4.binding&&o4.binding("util")}catch{}}(),xB=kB&&kB.isTypedArray,hre=xB?WAe(xB):KAe;function YAe(t,e){var n=ZP(t),r=!n&&QP(t),i=!n&&!r&&dre(t),s=!n&&!r&&!i&&hre(t),o=n||r||i||s,a=o?mAe(t.length,String):[],l=a.length;for(var c in t)o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ore(c,l))||a.push(c);return a}function XAe(t,e){return function(n){return t(e(n))}}function JAe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var ZAe=Object.prototype,QAe=ZAe.hasOwnProperty;function eOe(t){if(!Wa(t))return JAe(t);var e=lre(t),n=[];for(var r in t)r=="constructor"&&(e||!QAe.call(t,r))||n.push(r);return n}function pre(t){return t8(t)?YAe(t):eOe(t)}var yy=QO(Object,"create");function tOe(){this.__data__=yy?yy(null):{},this.size=0}function nOe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var rOe="__lodash_hash_undefined__",iOe=Object.prototype,sOe=iOe.hasOwnProperty;function oOe(t){var e=this.__data__;if(yy){var n=e[t];return n===rOe?void 0:n}return sOe.call(e,t)?e[t]:void 0}var aOe=Object.prototype,lOe=aOe.hasOwnProperty;function cOe(t){var e=this.__data__;return yy?e[t]!==void 0:lOe.call(e,t)}var uOe="__lodash_hash_undefined__";function dOe(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=yy&&e===void 0?uOe:e,this}function Mh(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Mh.prototype.clear=tOe;Mh.prototype.delete=nOe;Mh.prototype.get=oOe;Mh.prototype.has=cOe;Mh.prototype.set=dOe;function fOe(){this.__data__=[],this.size=0}function CT(t,e){for(var n=t.length;n--;)if(wT(t[n][0],e))return n;return-1}var hOe=Array.prototype,pOe=hOe.splice;function mOe(t){var e=this.__data__,n=CT(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():pOe.call(e,n,1),--this.size,!0}function gOe(t){var e=this.__data__,n=CT(e,t);return n<0?void 0:e[n][1]}function vOe(t){return CT(this.__data__,t)>-1}function yOe(t,e){var n=this.__data__,r=CT(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function mu(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}mu.prototype.clear=fOe;mu.prototype.delete=mOe;mu.prototype.get=gOe;mu.prototype.has=vOe;mu.prototype.set=yOe;var mre=QO(Qh,"Map");function _Oe(){this.size=0,this.__data__={hash:new Mh,map:new(mre||mu),string:new Mh}}function bOe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function TT(t,e){var n=t.__data__;return bOe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function SOe(t){var e=TT(this,t).delete(t);return this.size-=e?1:0,e}function EOe(t){return TT(this,t).get(t)}function wOe(t){return TT(this,t).has(t)}function COe(t,e){var n=TT(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function uv(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}uv.prototype.clear=_Oe;uv.prototype.delete=SOe;uv.prototype.get=EOe;uv.prototype.has=wOe;uv.prototype.set=COe;var gre=XAe(Object.getPrototypeOf,Object),TOe="[object Object]",ROe=Function.prototype,IOe=Object.prototype,vre=ROe.toString,kOe=IOe.hasOwnProperty,xOe=vre.call(Object);function POe(t){if(!cv(t)||b_(t)!=TOe)return!1;var e=gre(t);if(e===null)return!0;var n=kOe.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&vre.call(n)==xOe}function LOe(){this.__data__=new mu,this.size=0}function AOe(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function OOe(t){return this.__data__.get(t)}function MOe(t){return this.__data__.has(t)}var NOe=200;function DOe(t,e){var n=this.__data__;if(n instanceof mu){var r=n.__data__;if(!mre||r.length<NOe-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new uv(r)}return n.set(t,e),this.size=n.size,this}function dv(t){var e=this.__data__=new mu(t);this.size=e.size}dv.prototype.clear=LOe;dv.prototype.delete=AOe;dv.prototype.get=OOe;dv.prototype.has=MOe;dv.prototype.set=DOe;var yre=typeof exports=="object"&&exports&&!exports.nodeType&&exports,PB=yre&&typeof module=="object"&&module&&!module.nodeType&&module,FOe=PB&&PB.exports===yre,LB=FOe?Qh.Buffer:void 0;LB&&LB.allocUnsafe;function UOe(t,e){return t.slice()}var AB=Qh.Uint8Array;function jOe(t){var e=new t.constructor(t.byteLength);return new AB(e).set(new AB(t)),e}function $Oe(t,e){var n=jOe(t.buffer);return new t.constructor(n,t.byteOffset,t.length)}function BOe(t){return typeof t.constructor=="function"&&!lre(t)?WLe(gre(t)):{}}function HOe(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[++i];if(n(s[l],l,s)===!1)break}return e}}var VOe=HOe(),a4=function(){return Qh.Date.now()},GOe="Expected a function",qOe=Math.max,KOe=Math.min;function WOe(t,e,n){var r,i,s,o,a,l,c=0,u=!1,f=!1,p=!0;if(typeof t!="function")throw new TypeError(GOe);e=SB(e)||0,Wa(n)&&(u=!!n.leading,f="maxWait"in n,s=f?qOe(SB(n.maxWait)||0,e):s,p="trailing"in n?!!n.trailing:p);function m(C){var x=r,A=i;return r=i=void 0,c=C,o=t.apply(A,x),o}function v(C){return c=C,a=setTimeout(b,e),u?m(C):o}function g(C){var x=C-l,A=C-c,N=e-x;return f?KOe(N,s-A):N}function S(C){var x=C-l,A=C-c;return l===void 0||x>=e||x<0||f&&A>=s}function b(){var C=a4();if(S(C))return w(C);a=setTimeout(b,g(C))}function w(C){return a=void 0,p&&r?m(C):(r=i=void 0,o)}function k(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function T(){return a===void 0?o:w(a4())}function I(){var C=a4(),x=S(C);if(r=arguments,i=this,l=C,x){if(a===void 0)return v(l);if(f)return clearTimeout(a),a=setTimeout(b,e),m(l)}return a===void 0&&(a=setTimeout(b,e)),o}return I.cancel=k,I.flush=T,I}function e5(t,e,n){(n!==void 0&&!wT(t[e],n)||n===void 0&&!(e in t))&&e8(t,e,n)}function zOe(t){return cv(t)&&t8(t)}function t5(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function YOe(t){return lAe(t,pre(t))}function XOe(t,e,n,r,i,s,o){var a=t5(t,n),l=t5(e,n),c=o.get(l);if(c){e5(t,n,c);return}var u=s?s(a,l,n+"",t,e,o):void 0,f=u===void 0;if(f){var p=ZP(l),m=!p&&dre(l),v=!p&&!m&&hre(l);u=l,p||m||v?ZP(a)?u=a:zOe(a)?u=YLe(a):m?(f=!1,u=UOe(l)):v?(f=!1,u=$Oe(l)):u=[]:POe(l)||QP(l)?(u=a,QP(a)?u=YOe(a):(!Wa(a)||ZO(a))&&(u=BOe(l))):f=!1}f&&(o.set(l,u),i(u,l,r,s,o),o.delete(l)),e5(t,n,u)}function _re(t,e,n,r,i){t!==e&&VOe(e,function(s,o){if(i||(i=new dv),Wa(s))XOe(t,e,o,n,_re,r,i);else{var a=r?r(t5(t,o),s,o+"",t,e,i):void 0;a===void 0&&(a=s),e5(t,o,a)}},pre)}var JOe=hAe(function(t,e,n){_re(t,e,n)}),ZOe="Expected a function";function QOe(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(ZOe);return Wa(n)&&(r="leading"in n?!1:r,i="trailing"in n?!0:i),WOe(t,e,{leading:r,maxWait:e,trailing:i})}const n5={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},features:{feature_use_device_session_member_events:!0},ssla:"https://static.element.io/legal/element-software-and-services-license-agreement-uk-1.pdf",media_devices:{enable_audio:!0,enable_video:!0},app_prompt:!0};function n8(t){return!(t.ok||t.url.startsWith("file:")&&t.status===0)}class Zt{static get(){var e;if(!((e=this.internalInstance)!=null&&e.config))throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){var e;if(!((e=Zt.internalInstance)!=null&&e.initPromise)){const n=new Zt;Zt.internalInstance=n;let r;window.location.pathname.endsWith("/room/")||window.location.pathname.endsWith("/room")?r=new URL("/config.json",window.location.href).href:r="config.json",Zt.internalInstance.initPromise=e8e(r).then(i=>{n.config=JOe({},n5,i)})}return Zt.internalInstance.initPromise}static initDefault(){Zt.internalInstance=new Zt,Zt.internalInstance.config={...n5}}static defaultHomeserverUrl(){var e;return Ri().homeserver??((e=Zt.get().default_server_config)==null?void 0:e["m.homeserver"].base_url)}static defaultServerName(){var n;const e=Ri().homeserver;return e?new URL(e).hostname:(n=Zt.get().default_server_config)==null?void 0:n["m.homeserver"].server_name}}async function e8e(t){const e=await fetch(t);return n8(e)?n5:e.json()}var zt=(t=>(t[t.NONE=0]="NONE",t[t.PER_PARTICIPANT=1]="PER_PARTICIPANT",t[t.SHARED_KEY=2]="SHARED_KEY",t))(zt||{}),bre=(t=>(t.StartNewCall="start_call",t.JoinExistingCall="join_existing",t.Unknown="unknown",t))(bre||{});function t8e(t,e){const n=t.indexOf("?"),r=e(new URLSearchParams(n===-1?"":t.substring(n)));return`${t.substring(0,n)}?${r.toString()}`}class Sre{constructor(e,n){this.queryParams=new URLSearchParams(e);const r=n.indexOf("?");this.fragmentParams=new URLSearchParams(r===-1?"":n.substring(r))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,n=!1){const r=this.getParam(e);return r===null?n:r!=="false"}}const Ri=(t=window.location.search,e=window.location.hash)=>{const n=new Sre(t,e),r=parseFloat(n.getParam("fontScale")??"");let i=n.getParam("intent");(!i||!Object.values(bre).includes(i))&&(i="unknown");const s=n.getParam("widgetId"),o=n.getParam("parentUrl"),a=!!s&&!!o;return{widgetId:s,parentUrl:o,roomId:n.getParam("roomId"),password:n.getParam("password"),confineToRoom:n.getFlagParam("confineToRoom")||n.getFlagParam("embed"),appPrompt:n.getFlagParam("appPrompt",!0),preload:a?n.getFlagParam("preload"):!1,hideHeader:n.getFlagParam("hideHeader"),showControls:n.getFlagParam("showControls",!0),hideScreensharing:n.getFlagParam("hideScreensharing"),e2eEnabled:n.getFlagParam("enableE2EE",!0),userId:a?n.getParam("userId"):null,displayName:n.getParam("displayName"),deviceId:a?n.getParam("deviceId"):null,baseUrl:a?n.getParam("baseUrl"):null,lang:n.getParam("lang"),fonts:n.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,allowIceFallback:n.getFlagParam("allowIceFallback"),perParticipantE2EE:n.getFlagParam("perParticipantE2EE"),controlledAudioDevices:n.getFlagParam("controlledAudioDevices",n.getFlagParam("controlledMediaDevices")),skipLobby:n.getFlagParam("skipLobby",a&&i==="start_call"),returnToLobby:a?n.getFlagParam("returnToLobby"):!1,theme:n.getParam("theme"),viaServers:a?null:n.getParam("viaServers"),homeserver:a?null:n.getParam("homeserver"),intent:i,posthogApiHost:n.getParam("posthogApiHost"),posthogApiKey:n.getParam("posthogApiKey"),posthogUserId:n.getParam("posthogUserId")??n.getParam("analyticsID"),rageshakeSubmitUrl:n.getParam("rageshakeSubmitUrl"),sentryDsn:n.getParam("sentryDsn"),sentryEnvironment:n.getParam("sentryEnvironment")}},sa=()=>{const{search:t,hash:e}=qi();return _.useMemo(()=>Ri(t,e),[t,e])};function n8e(t,e,n){let r=null;t=t.substring(1);const i=t.split("/"),s=i[0]=="room",o=i.length>1;n===""||n.startsWith("#?")?(o&&s&&(r=i[1]),s||(r=i[0])):r=n,r=(r==null?void 0:r.split("?")[0])??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${Zt.defaultServerName()}`)));const a=new Sre(e,n);let l=a.getParam("roomId");return l!=null&&l.startsWith("!")&&l.includes("")||(l=null),{roomAlias:r,roomId:l,viaServers:a.getAllParams("viaServers")}}const r8e=()=>{const{pathname:t,search:e,hash:n}=qi();return _.useMemo(()=>n8e(t,e,n),[t,e,n])};function i8e(t,e,n){const r=new URLSearchParams;switch(e==null?void 0:e.kind){case zt.SHARED_KEY:{const i=encodeURIComponent(e.secret);i!==e.secret&&O.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",i);break}case zt.PER_PARTICIPANT:r.set("perParticipantE2EE","true");break}return r.set("roomId",t),r}const s8e="_rageshakeControl_65ekp_8",OB={rageshakeControl:s8e},MB=1024*1024*5,o8e=2*1e3,a8e=3;class l8e extends NL{constructor(){super(...arguments),this.logs="",this.log=(e,...n)=>{const r=new Date().toISOString();n=n.map(s=>s instanceof DOMException?s.message+` (${s.name} | ${s.code})`:s instanceof Error?s.message+(s.stack?`
${s.stack}`:""):typeof s=="object"?JSON.stringify(s,p8e()):s);let i=`${r} ${e} ${n.join(" ")}
`;i=i.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=i,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class c8e{constructor(e,n){this.indexedDB=e,this.loggerInstance=n,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=QOe(()=>this.flush,o8e,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?this.flushAgainPromise?this.flushAgainPromise:(this.flushAgainPromise=this.flushPromise.then(this.flush).then(()=>{this.flushAgainPromise=void 0}),this.flushAgainPromise):(this.flushPromise=new Promise((r,i)=>{if(!this.db){i(new Error("No connected database"));return}const s=this.loggerInstance.popLogs();if(s.length===0){r();return}const o=this.db.transaction(["logs","logslastmod"],"readwrite"),a=o.objectStore("logs");o.oncomplete=()=>{r()},o.onerror=c=>{var u;O.error("Failed to flush logs : ",c),i(new Error("Failed to write logs: "+((u=o==null?void 0:o.error)==null?void 0:u.message)))},a.add(this.generateLogEntry(s)),o.objectStore("logslastmod").put(this.generateLastModifiedTime())}).then(()=>{this.flushPromise=void 0}),this.flushPromise),this.id="instance-"+lo(16),n.on("log",this.onLoggerLog),window.addEventListener("beforeunload",()=>{this.flush().catch(r=>O.error("Failed to flush logs before unload",r))})}async connect(){const e=this.indexedDB.open("logs");return new Promise((n,r)=>{e.onsuccess=()=>{this.db=e.result,n()},e.onerror=()=>{var s;const i="Failed to open log database: "+((s=e==null?void 0:e.error)==null?void 0:s.name);O.error(i),r(new Error(i))},e.onupgradeneeded=()=>{const i=e.result,s=i.createObjectStore("logs",{keyPath:["id","index"]});s.createIndex("id","id",{unique:!1}),s.add(this.generateLogEntry(new Date+" ::: Log database was created.")),i.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}})}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function n(c,u){const f=e.transaction("logs","readonly").objectStore("logs");return new Promise((p,m)=>{const v=f.index("id").openCursor(IDBKeyRange.only(c),"prev");let g="";v.onerror=()=>{var S;m(new Error("Query failed: "+((S=v==null?void 0:v.error)==null?void 0:S.message)))},v.onsuccess=()=>{const S=v.result;if(!S){p(g);return}g=S.value.lines+g,g.length>=u?p(g):S.continue()}})}async function r(){const c=e.transaction("logslastmod","readonly").objectStore("logslastmod");return u8e(c,void 0,u=>({id:u.value.id,ts:u.value.ts})).then(u=>u.sort((f,p)=>p.ts-f.ts).map(f=>f.id))}async function i(c){return new Promise((u,f)=>{const p=e.transaction(["logs","logslastmod"],"readwrite"),m=p.objectStore("logs"),v=m.index("id").openKeyCursor(IDBKeyRange.only(c));v.onsuccess=()=>{const S=v.result;S&&(m.delete(S.primaryKey),S.continue())},p.oncomplete=()=>{u()},p.onerror=()=>{var S;f(new Error(`Failed to delete logs for '${c}' : ${(S=p==null?void 0:p.error)==null?void 0:S.message}`))},p.objectStore("logslastmod").delete(c)})}const s=await r();let o=[];const a=[];let l=0;for(let c=0;c<s.length;c++){const u=await n(s[c],MB-l);if(a.push({lines:u,id:s[c]}),l+=u.length,l>=MB){o=s.slice(c+1).map(f=>parseInt(f,10));break}}return o.length>0&&(O.log("Removing logs: ",o),Promise.all(o.map(async c=>i(c))).then(()=>{O.log(`Removed ${o.length} old logs.`)},c=>{O.error(c)})),a}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function u8e(t,e,n){const r=t.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r==null?void 0:r.error)==null?void 0:a.message)))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}async function d8e(){return global.mx_rage_logger=new l8e,m8e(O,global.mx_rage_logger.log),["trace","debug","info","warn","error"].forEach(t=>{const e=window.console[t];if(!e)return;const n=`${t.toUpperCase()} matrix_sdk`;window.console[t]=(...r)=>{e(...r),typeof r[0]=="string"&&r[0].startsWith(n)&&global.mx_rage_logger.log(r8[t],"matrix_sdk",...r)}}),f8e()}async function f8e(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;O.log("Configuring rageshake persistence...");let t;try{t=window.indexedDB}catch(e){O.warn("Could not get indexDB from window.",e)}return t?(global.mx_rage_store=new c8e(t,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function h8e(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const p8e=()=>{const t=new WeakSet,e=new WeakMap;return function(n,r){if(typeof r=="object"&&r!==null){if(t.has(r))return"<$ cycle-trimmed $>";t.add(r);let i=0;if(this&&(i=e.get(this)??0),e.set(r,i+1),i>a8e)return"<$ object-pruned $>"}return r}};var r8=(t=>(t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent",t))(r8||{});function m8e(t,e){const n=t,r=n.methodFactory;n.methodFactory=function(i,s,o){const a=r(i,s,o),l=r8[i],c=l>=s&&l<5;return(...u)=>{a.apply(this,u),c&&e(l,o==null?void 0:o.toString(),...u)}},n.setLevel(n.getLevel())}var g8e=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},rh="1.9.0",NB=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function v8e(t){var e=new Set([t]),n=new Set,r=t.match(NB);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(l){return l===t};function s(a){return n.add(a),!1}function o(a){return e.add(a),!0}return function(l){if(e.has(l))return!0;if(n.has(l))return!1;var c=l.match(NB);if(!c)return s(l);var u={major:+c[1],minor:+c[2],patch:+c[3],prerelease:c[4]};return u.prerelease!=null||i.major!==u.major?s(l):i.major===0?i.minor===u.minor&&i.patch<=u.patch?o(l):s(l):i.minor<=u.minor?o(l):s(l)}}var y8e=v8e(rh),_8e=rh.split(".")[0],_y=Symbol.for("opentelemetry.js.api."+_8e),by=g8e;function RT(t,e,n,r){var i;r===void 0&&(r=!1);var s=by[_y]=(i=by[_y])!==null&&i!==void 0?i:{version:rh};if(!r&&s[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(o.stack||o.message),!1}if(s.version!==rh){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+t+" does not match previously registered API v"+rh);return n.error(o.stack||o.message),!1}return s[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+rh+"."),!0}function wg(t){var e,n,r=(e=by[_y])===null||e===void 0?void 0:e.version;if(!(!r||!y8e(r)))return(n=by[_y])===null||n===void 0?void 0:n[t]}function IT(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+rh+".");var n=by[_y];n&&delete n[t]}var b8e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},S8e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},E8e=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return L0("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return L0("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return L0("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return L0("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return L0("verbose",this._namespace,e)},t}();function L0(t,e,n){var r=wg("diag");if(r)return n.unshift(e),r[t].apply(r,S8e([],b8e(n),!1))}var gr;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(gr||(gr={}));function w8e(t,e){t<gr.NONE?t=gr.NONE:t>gr.ALL&&(t=gr.ALL),e=e||{};function n(r,i){var s=e[r];return typeof s=="function"&&t>=i?s.bind(e):function(){}}return{error:n("error",gr.ERROR),warn:n("warn",gr.WARN),info:n("info",gr.INFO),debug:n("debug",gr.DEBUG),verbose:n("verbose",gr.VERBOSE)}}var C8e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},T8e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},R8e="diag",Yd=function(){function t(){function e(i){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=wg("diag");if(a)return a[i].apply(a,T8e([],C8e(s),!1))}}var n=this,r=function(i,s){var o,a,l;if(s===void 0&&(s={logLevel:gr.INFO}),i===n){var c=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=c.stack)!==null&&o!==void 0?o:c.message),!1}typeof s=="number"&&(s={logLevel:s});var u=wg("diag"),f=w8e((a=s.logLevel)!==null&&a!==void 0?a:gr.INFO,i);if(u&&!s.suppressOverrideMessage){var p=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";u.warn("Current logger will be overwritten from "+p),f.warn("Current logger will overwrite one already registered from "+p)}return RT("diag",f,n,!0)};n.setLogger=r,n.disable=function(){IT(R8e,n)},n.createComponentLogger=function(i){return new E8e(i)},n.verbose=e("verbose"),n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),I8e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},k8e=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},x8e=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var n=this._entries.get(e);if(n)return Object.assign({},n)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var n=I8e(e,2),r=n[0],i=n[1];return[r,i]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=new t(this._entries);try{for(var o=k8e(r),a=o.next();!a.done;a=o.next()){var l=a.value;s._entries.delete(l)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return s},t.prototype.clear=function(){return new t},t}(),P8e=Symbol("BaggageEntryMetadata"),L8e=Yd.instance();function A8e(t){return t===void 0&&(t={}),new x8e(new Map(Object.entries(t)))}function O8e(t){return typeof t!="string"&&(L8e.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:P8e,toString:function(){return t}}}function i8(t){return Symbol.for(t)}var M8e=function(){function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,i){var s=new t(n._currentContext);return s._currentContext.set(r,i),s},n.deleteValue=function(r){var i=new t(n._currentContext);return i._currentContext.delete(r),i}}return t}(),lm=new M8e,N8e={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},D8e={set:function(t,e,n){t!=null&&(t[e]=n)}},F8e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},U8e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},j8e=function(){function t(){}return t.prototype.active=function(){return lm},t.prototype.with=function(e,n,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return n.call.apply(n,U8e([r],F8e(i),!1))},t.prototype.bind=function(e,n){return n},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),$8e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},B8e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},l4="context",H8e=new j8e,kT=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return RT(l4,e,Yd.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,n,r){for(var i,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(i=this._getContextManager()).with.apply(i,B8e([e,n,r],$8e(s),!1))},t.prototype.bind=function(e,n){return this._getContextManager().bind(e,n)},t.prototype._getContextManager=function(){return wg(l4)||H8e},t.prototype.disable=function(){this._getContextManager().disable(),IT(l4,Yd.instance())},t}(),$l;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})($l||($l={}));var Ere="0000000000000000",wre="00000000000000000000000000000000",Cre={traceId:wre,spanId:Ere,traceFlags:$l.NONE},L1=function(){function t(e){e===void 0&&(e=Cre),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,n){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,n){},t}(),s8=i8("OpenTelemetry Context Key SPAN");function o8(t){return t.getValue(s8)||void 0}function V8e(){return o8(kT.getInstance().active())}function a8(t,e){return t.setValue(s8,e)}function G8e(t){return t.deleteValue(s8)}function q8e(t,e){return a8(t,new L1(e))}function Tre(t){var e;return(e=o8(t))===null||e===void 0?void 0:e.spanContext()}var K8e=/^([0-9a-f]{32})$/i,W8e=/^[0-9a-f]{16}$/i;function Rre(t){return K8e.test(t)&&t!==wre}function z8e(t){return W8e.test(t)&&t!==Ere}function xT(t){return Rre(t.traceId)&&z8e(t.spanId)}function Y8e(t){return new L1(t)}var c4=kT.getInstance(),Ire=function(){function t(){}return t.prototype.startSpan=function(e,n,r){r===void 0&&(r=c4.active());var i=!!(n!=null&&n.root);if(i)return new L1;var s=r&&Tre(r);return X8e(s)&&xT(s)?new L1(s):new L1},t.prototype.startActiveSpan=function(e,n,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,o=r,a=i);var l=o??c4.active(),c=this.startSpan(e,s,l),u=a8(l,c);return c4.with(u,a,void 0,c)}},t}();function X8e(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var J8e=new Ire,Z8e=function(){function t(e,n,r,i){this._provider=e,this.name=n,this.version=r,this.options=i}return t.prototype.startSpan=function(e,n,r){return this._getTracer().startSpan(e,n,r)},t.prototype.startActiveSpan=function(e,n,r,i){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):J8e},t}(),Q8e=function(){function t(){}return t.prototype.getTracer=function(e,n,r){return new Ire},t}(),eMe=new Q8e,DB=function(){function t(){}return t.prototype.getTracer=function(e,n,r){var i;return(i=this.getDelegateTracer(e,n,r))!==null&&i!==void 0?i:new Z8e(this,e,n,r)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:eMe},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,n,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,n,r)},t}(),xw;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(xw||(xw={}));var r5;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(r5||(r5={}));var i5;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(i5||(i5={}));var xd=kT.getInstance(),Ot=Yd.instance(),tMe=function(){function t(){}return t.prototype.inject=function(e,n){},t.prototype.extract=function(e,n){return e},t.prototype.fields=function(){return[]},t}(),l8=i8("OpenTelemetry Baggage Key");function kre(t){return t.getValue(l8)||void 0}function nMe(){return kre(kT.getInstance().active())}function rMe(t,e){return t.setValue(l8,e)}function iMe(t){return t.deleteValue(l8)}var u4="propagation",sMe=new tMe,oMe=function(){function t(){this.createBaggage=A8e,this.getBaggage=kre,this.getActiveBaggage=nMe,this.setBaggage=rMe,this.deleteBaggage=iMe}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return RT(u4,e,Yd.instance())},t.prototype.inject=function(e,n,r){return r===void 0&&(r=D8e),this._getGlobalPropagator().inject(e,n,r)},t.prototype.extract=function(e,n,r){return r===void 0&&(r=N8e),this._getGlobalPropagator().extract(e,n,r)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){IT(u4,Yd.instance())},t.prototype._getGlobalPropagator=function(){return wg(u4)||sMe},t}(),cE=oMe.getInstance(),d4="trace",aMe=function(){function t(){this._proxyTracerProvider=new DB,this.wrapSpanContext=Y8e,this.isSpanContextValid=xT,this.deleteSpan=G8e,this.getSpan=o8,this.getActiveSpan=V8e,this.getSpanContext=Tre,this.setSpan=a8,this.setSpanContext=q8e}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var n=RT(d4,this._proxyTracerProvider,Yd.instance());return n&&this._proxyTracerProvider.setDelegate(e),n},t.prototype.getTracerProvider=function(){return wg(d4)||this._proxyTracerProvider},t.prototype.getTracer=function(e,n){return this.getTracerProvider().getTracer(e,n)},t.prototype.disable=function(){IT(d4,Yd.instance()),this._proxyTracerProvider=new DB},t}(),Ma=aMe.getInstance();const f4={trace:Ma};var xre=i8("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Pre(t){return t.setValue(xre,!0)}function c8(t){return t.getValue(xre)===!0}var lMe="=",s5=";",o5=",",h4="baggage",cMe=180,uMe=4096,dMe=8192,fMe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function hMe(t){return t.reduce(function(e,n){var r=""+e+(e!==""?o5:"")+n;return r.length>dMe?e:r},"")}function pMe(t){return t.getAllEntries().map(function(e){var n=fMe(e,2),r=n[0],i=n[1],s=encodeURIComponent(r)+"="+encodeURIComponent(i.value);return i.metadata!==void 0&&(s+=s5+i.metadata.toString()),s})}function mMe(t){var e=t.split(s5);if(!(e.length<=0)){var n=e.shift();if(n){var r=n.indexOf(lMe);if(!(r<=0)){var i=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim()),o;return e.length>0&&(o=O8e(e.join(s5))),{key:i,value:s,metadata:o}}}}}var gMe=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=cE.getBaggage(e);if(!(!i||c8(e))){var s=pMe(i).filter(function(a){return a.length<=uMe}).slice(0,cMe),o=hMe(s);o.length>0&&r.set(n,h4,o)}},t.prototype.extract=function(e,n,r){var i=r.get(n,h4),s=Array.isArray(i)?i.join(o5):i;if(!s)return e;var o={};if(s.length===0)return e;var a=s.split(o5);return a.forEach(function(l){var c=mMe(l);if(c){var u={value:c.value};c.metadata&&(u.metadata=c.metadata),o[c.key]=u}}),Object.entries(o).length===0?e:cE.setBaggage(e,cE.createBaggage(o))},t.prototype.fields=function(){return[h4]},t}(),Lre=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vMe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function uE(t){var e,n,r={};if(typeof t!="object"||t==null)return r;try{for(var i=Lre(Object.entries(t)),s=i.next();!s.done;s=i.next()){var o=vMe(s.value,2),a=o[0],l=o[1];if(!yMe(a)){Ot.warn("Invalid attribute key: "+a);continue}if(!Are(l)){Ot.warn("Invalid attribute value set for key: "+a);continue}Array.isArray(l)?r[a]=l.slice():r[a]=l}}catch(c){e={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function yMe(t){return typeof t=="string"&&t.length>0}function Are(t){return t==null?!0:Array.isArray(t)?_Me(t):Ore(t)}function _Me(t){var e,n,r;try{for(var i=Lre(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!=null){if(!r){if(Ore(o)){r=typeof o;continue}return!1}if(typeof o!==r)return!1}}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0}function Ore(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}function bMe(){return function(t){Ot.error(SMe(t))}}function SMe(t){return typeof t=="string"?t:JSON.stringify(EMe(t))}function EMe(t){for(var e={},n=t;n!==null;)Object.getOwnPropertyNames(n).forEach(function(r){if(!e[r]){var i=n[r];i&&(e[r]=String(i))}}),n=Object.getPrototypeOf(n);return e}var wMe=bMe();function zc(t){try{wMe(t)}catch{}}var kl;(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(kl||(kl={}));var CMe=",",TMe=["OTEL_SDK_DISABLED"];function RMe(t){return TMe.indexOf(t)>-1}var IMe=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function kMe(t){return IMe.indexOf(t)>-1}var xMe=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS","OTEL_SEMCONV_STABILITY_OPT_IN"];function PMe(t){return xMe.indexOf(t)>-1}var dE=1/0,fE=128,LMe=128,AMe=128,Mre={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:gr.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:dE,OTEL_ATTRIBUTE_COUNT_LIMIT:fE,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:dE,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:fE,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:dE,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:fE,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:LMe,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:AMe,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:kl.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative",OTEL_SEMCONV_STABILITY_OPT_IN:[]};function OMe(t,e,n){if(!(typeof n[t]>"u")){var r=String(n[t]);e[t]=r.toLowerCase()==="true"}}function MMe(t,e,n,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof n[t]<"u"){var s=Number(n[t]);isNaN(s)||(s<r?e[t]=r:s>i?e[t]=i:e[t]=s)}}function NMe(t,e,n,r){r===void 0&&(r=CMe);var i=n[t];typeof i=="string"&&(e[t]=i.split(r).map(function(s){return s.trim()}))}var DMe={ALL:gr.ALL,VERBOSE:gr.VERBOSE,DEBUG:gr.DEBUG,INFO:gr.INFO,WARN:gr.WARN,ERROR:gr.ERROR,NONE:gr.NONE};function FMe(t,e,n){var r=n[t];if(typeof r=="string"){var i=DMe[r.toUpperCase()];i!=null&&(e[t]=i)}}function Nre(t){var e={};for(var n in Mre){var r=n;switch(r){case"OTEL_LOG_LEVEL":FMe(r,e,t);break;default:if(RMe(r))OMe(r,e,t);else if(kMe(r))MMe(r,e,t);else if(PMe(r))NMe(r,e,t);else{var i=t[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}var Dre=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{};function Sy(){var t=Nre(Dre);return Object.assign({},Mre,t)}function UMe(){return Nre(Dre)}function FB(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function u8(t){for(var e=new Uint8Array(t.length/2),n=0,r=0;r<t.length;r+=2){var i=FB(t.charCodeAt(r)),s=FB(t.charCodeAt(r+1));e[n++]=i<<4|s}return e}var Hm=performance,jMe="1.30.1",$Me="process.runtime.name",BMe="telemetry.sdk.name",HMe="telemetry.sdk.language",VMe="telemetry.sdk.version",GMe=$Me,qMe=BMe,KMe=HMe,WMe=VMe,zMe="webjs",YMe=zMe,Kp,p4=(Kp={},Kp[qMe]="opentelemetry",Kp[GMe]="browser",Kp[KMe]=YMe,Kp[WMe]=jMe,Kp);var XMe=9,JMe=6,ZMe=Math.pow(10,JMe),Pw=Math.pow(10,XMe);function ym(t){var e=t/1e3,n=Math.trunc(e),r=Math.round(t%1e3*ZMe);return[n,r]}function Fre(){var t=Hm.timeOrigin;if(typeof t!="number"){var e=Hm;t=e.timing&&e.timing.fetchStart}return t}function QMe(t){var e=ym(Fre()),n=ym(typeof t=="number"?t:Hm.now());return jre(e,n)}function e9e(t,e){var n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=Pw),[n,r]}function t9e(t){return t[0]*Pw+t[1]}function UB(t){return t[0]*1e3+t[1]/1e6}function m4(t){return t[0]*1e6+t[1]/1e3}function Ure(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function jB(t){return Ure(t)||typeof t=="number"||t instanceof Date}function jre(t,e){var n=[t[0]+e[0],t[1]+e[1]];return n[1]>=Pw&&(n[1]-=Pw,n[0]+=1),n}var Pa;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(Pa||(Pa={}));var n9e=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r9e=function(){function t(e){e===void 0&&(e={});var n;this._propagators=(n=e.propagators)!==null&&n!==void 0?n:[],this._fields=Array.from(new Set(this._propagators.map(function(r){return typeof r.fields=="function"?r.fields():[]}).reduce(function(r,i){return r.concat(i)},[])))}return t.prototype.inject=function(e,n,r){var i,s;try{for(var o=n9e(this._propagators),a=o.next();!a.done;a=o.next()){var l=a.value;try{l.inject(e,n,r)}catch(c){Ot.warn("Failed to inject with "+l.constructor.name+". Err: "+c.message)}}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.extract=function(e,n,r){return this._propagators.reduce(function(i,s){try{return s.extract(i,n,r)}catch(o){Ot.warn("Failed to extract with "+s.constructor.name+". Err: "+o.message)}return i},e)},t.prototype.fields=function(){return this._fields.slice()},t}(),a5="[_0-9a-z-*/]",i9e="[a-z]"+a5+"{0,255}",s9e="[a-z0-9]"+a5+"{0,240}@[a-z]"+a5+"{0,13}",o9e=new RegExp("^(?:"+i9e+"|"+s9e+")$"),a9e=/^[ -~]{0,255}[!-~]$/,l9e=/,|=/;function c9e(t){return o9e.test(t)}function u9e(t){return a9e.test(t)&&!l9e.test(t)}var $B=32,d9e=512,BB=",",HB="=",f9e=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,n){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,n),r},t.prototype.unset=function(e){var n=this._clone();return n._internalState.delete(e),n},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(n,r){return n.push(r+HB+e.get(r)),n},[]).join(BB)},t.prototype._parse=function(e){e.length>d9e||(this._internalState=e.split(BB).reverse().reduce(function(n,r){var i=r.trim(),s=i.indexOf(HB);if(s!==-1){var o=i.slice(0,s),a=i.slice(s+1,r.length);c9e(o)&&u9e(a)&&n.set(o,a)}return n},new Map),this._internalState.size>$B&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,$B))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}(),g4="traceparent",v4="tracestate",h9e="00",p9e="(?!ff)[\\da-f]{2}",m9e="(?![0]{32})[\\da-f]{32}",g9e="(?![0]{16})[\\da-f]{16}",v9e="[\\da-f]{2}",y9e=new RegExp("^\\s?("+p9e+")-("+m9e+")-("+g9e+")-("+v9e+")(-.*)?\\s?$");function _9e(t){var e=y9e.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var b9e=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=Ma.getSpanContext(e);if(!(!i||c8(e)||!xT(i))){var s=h9e+"-"+i.traceId+"-"+i.spanId+"-0"+Number(i.traceFlags||$l.NONE).toString(16);r.set(n,g4,s),i.traceState&&r.set(n,v4,i.traceState.serialize())}},t.prototype.extract=function(e,n,r){var i=r.get(n,g4);if(!i)return e;var s=Array.isArray(i)?i[0]:i;if(typeof s!="string")return e;var o=_9e(s);if(!o)return e;o.isRemote=!0;var a=r.get(n,v4);if(a){var l=Array.isArray(a)?a.join(","):a;o.traceState=new f9e(typeof l=="string"?l:void 0)}return Ma.setSpanContext(e,o)},t.prototype.fields=function(){return[g4,v4]},t}(),S9e="[object Object]",E9e="[object Null]",w9e="[object Undefined]",C9e=Function.prototype,$re=C9e.toString,T9e=$re.call(Object),R9e=I9e(Object.getPrototypeOf,Object),Bre=Object.prototype,Hre=Bre.hasOwnProperty,Zf=Symbol?Symbol.toStringTag:void 0,Vre=Bre.toString;function I9e(t,e){return function(n){return t(e(n))}}function VB(t){if(!k9e(t)||x9e(t)!==S9e)return!1;var e=R9e(t);if(e===null)return!0;var n=Hre.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&$re.call(n)===T9e}function k9e(t){return t!=null&&typeof t=="object"}function x9e(t){return t==null?t===void 0?w9e:E9e:Zf&&Zf in Object(t)?P9e(t):L9e(t)}function P9e(t){var e=Hre.call(t,Zf),n=t[Zf],r=!1;try{t[Zf]=void 0,r=!0}catch{}var i=Vre.call(t);return r&&(e?t[Zf]=n:delete t[Zf]),i}function L9e(t){return Vre.call(t)}var A9e=20;function O9e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t.shift(),r=new WeakMap;t.length>0;)n=Gre(n,t.shift(),0,r);return n}function y4(t){return Lw(t)?t.slice():t}function Gre(t,e,n,r){n===void 0&&(n=0);var i;if(!(n>A9e)){if(n++,hE(t)||hE(e)||qre(e))i=y4(e);else if(Lw(t)){if(i=t.slice(),Lw(e))for(var s=0,o=e.length;s<o;s++)i.push(y4(e[s]));else if(A0(e))for(var a=Object.keys(e),s=0,o=a.length;s<o;s++){var l=a[s];i[l]=y4(e[l])}}else if(A0(t))if(A0(e)){if(!M9e(t,e))return e;i=Object.assign({},t);for(var a=Object.keys(e),s=0,o=a.length;s<o;s++){var l=a[s],c=e[l];if(hE(c))typeof c>"u"?delete i[l]:i[l]=c;else{var u=i[l],f=c;if(GB(t,l,r)||GB(e,l,r))delete i[l];else{if(A0(u)&&A0(f)){var p=r.get(u)||[],m=r.get(f)||[];p.push({obj:t,key:l}),m.push({obj:e,key:l}),r.set(u,p),r.set(f,m)}i[l]=Gre(i[l],c,n,r)}}}}else i=e;return i}}function GB(t,e,n){for(var r=n.get(t[e])||[],i=0,s=r.length;i<s;i++){var o=r[i];if(o.key===e&&o.obj===t)return!0}return!1}function Lw(t){return Array.isArray(t)}function qre(t){return typeof t=="function"}function A0(t){return!hE(t)&&!Lw(t)&&!qre(t)&&typeof t=="object"}function hE(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function M9e(t,e){return!(!VB(t)||!VB(e))}var N9e=function(){function t(){var e=this;this._promise=new Promise(function(n,r){e._resolve=n,e._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}(),D9e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},F9e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},Kre=function(){function t(e,n){this._callback=e,this._that=n,this._isCalled=!1,this._deferred=new N9e}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,F9e([this._that],D9e(r),!1))).then(function(s){return n._deferred.resolve(s)},function(s){return n._deferred.reject(s)})}catch(s){this._deferred.reject(s)}}return this._deferred.promise},t}();function U9e(t,e){return new Promise(function(n){xd.with(Pre(xd.active()),function(){t.export(e,function(r){n(r)})})})}var j9e={_export:U9e},$9e="exception.type",B9e="exception.message",H9e="exception.stacktrace",_4=$9e,b4=B9e,V9e=H9e,G9e="exception",l5=function(){return l5=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},l5.apply(this,arguments)},q9e=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},qB=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},K9e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},W9e=function(){function t(e,n,r,i,s,o,a,l,c,u){a===void 0&&(a=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:i5.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=i,this.parentSpanId=o,this.kind=s,this.links=a;var f=Date.now();this._performanceStartTime=Hm.now(),this._performanceOffset=f-(this._performanceStartTime+Fre()),this._startTimeProvided=l!=null,this.startTime=this._getTime(l??f),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,u!=null&&this.setAttributes(u),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,n)}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return n==null||this._isSpanEnded()?this:e.length===0?(Ot.warn("Invalid attribute key: "+e),this):Are(n)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(n),this):(Ot.warn("Invalid attribute value set for key: "+e),this)},t.prototype.setAttributes=function(e){var n,r;try{for(var i=q9e(Object.entries(e)),s=i.next();!s.done;s=i.next()){var o=qB(s.value,2),a=o[0],l=o[1];this.setAttribute(a,l)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return this},t.prototype.addEvent=function(e,n,r){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return Ot.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(this._droppedEventsCount===0&&Ot.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),jB(n)&&(jB(r)||(r=n),n=void 0);var i=uE(n);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this},t.prototype.addLink=function(e){return this.links.push(e),this},t.prototype.addLinks=function(e){var n;return(n=this.links).push.apply(n,K9e([],qB(e),!1)),this},t.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=l5({},e),this.status.message!=null&&typeof e.message!="string"&&(Ot.warn("Dropping invalid status.message of type '"+typeof e.message+"', expected 'string'"),delete this.status.message),this)},t.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},t.prototype.end=function(e){if(this._isSpanEnded()){Ot.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=e9e(this.startTime,this.endTime),this._duration[0]<0&&(Ot.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&Ot.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this)},t.prototype._getTime=function(e){if(typeof e=="number"&&e<=Hm.now())return QMe(e+this._performanceOffset);if(typeof e=="number")return ym(e);if(e instanceof Date)return ym(e.getTime());if(Ure(e))return e;if(this._startTimeProvided)return ym(Date.now());var n=Hm.now()-this._performanceStartTime;return jre(this.startTime,ym(n))},t.prototype.isRecording=function(){return this._ended===!1},t.prototype.recordException=function(e,n){var r={};typeof e=="string"?r[b4]=e:e&&(e.code?r[_4]=e.code.toString():e.name&&(r[_4]=e.name),e.message&&(r[b4]=e.message),e.stack&&(r[V9e]=e.stack)),r[_4]||r[b4]?this.addEvent(G9e,r,n):Ot.warn("Failed to record an exception "+e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),t.prototype._isSpanEnded=function(){return this._ended&&Ot.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},t.prototype._truncateToLimitUtil=function(e,n){return e.length<=n?e:e.substring(0,n)},t.prototype._truncateToSize=function(e){var n=this,r=this._attributeValueLengthLimit;return r<=0?(Ot.warn("Attribute value limit must be positive, got "+r),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(i){return typeof i=="string"?n._truncateToLimitUtil(i,r):i}):e},t}(),Cg;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Cg||(Cg={}));var Aw=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:Cg.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}(),Vm=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:Cg.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}(),S4=function(){function t(e){var n,r,i,s;this._root=e.root,this._root||(zc(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Vm),this._remoteParentSampled=(n=e.remoteParentSampled)!==null&&n!==void 0?n:new Vm,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new Aw,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new Vm,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new Aw}return t.prototype.shouldSample=function(e,n,r,i,s,o){var a=Ma.getSpanContext(e);return!a||!xT(a)?this._root.shouldSample(e,n,r,i,s,o):a.isRemote?a.traceFlags&$l.SAMPLED?this._remoteParentSampled.shouldSample(e,n,r,i,s,o):this._remoteParentNotSampled.shouldSample(e,n,r,i,s,o):a.traceFlags&$l.SAMPLED?this._localParentSampled.shouldSample(e,n,r,i,s,o):this._localParentNotSampled.shouldSample(e,n,r,i,s,o)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}(),KB=function(){function t(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return t.prototype.shouldSample=function(e,n){return{decision:Rre(n)&&this._accumulate(n)<this._upperBound?Cg.RECORD_AND_SAMPLED:Cg.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},t.prototype._accumulate=function(e){for(var n=0,r=0;r<e.length/8;r++){var i=r*8,s=parseInt(e.slice(i,i+8),16);n=(n^s)>>>0}return n},t}(),z9e=kl.AlwaysOn,Wp=1;function Wre(){var t=Sy();return{sampler:zre(t),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:t.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:t.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:t.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:t.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT},mergeResourceWithDefaults:!0}}function zre(t){switch(t===void 0&&(t=Sy()),t.OTEL_TRACES_SAMPLER){case kl.AlwaysOn:return new Vm;case kl.AlwaysOff:return new Aw;case kl.ParentBasedAlwaysOn:return new S4({root:new Vm});case kl.ParentBasedAlwaysOff:return new S4({root:new Aw});case kl.TraceIdRatio:return new KB(WB(t));case kl.ParentBasedTraceIdRatio:return new S4({root:new KB(WB(t))});default:return Ot.error('OTEL_TRACES_SAMPLER value "'+t.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+z9e+'".'),new Vm}}function WB(t){if(t.OTEL_TRACES_SAMPLER_ARG===void 0||t.OTEL_TRACES_SAMPLER_ARG==="")return Ot.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+Wp+"."),Wp;var e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Ot.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+Wp+"."),Wp):e<0||e>1?(Ot.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+Wp+"."),Wp):e}function Y9e(t){var e={sampler:zre()},n=Wre(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}function X9e(t){var e,n,r,i,s,o,a,l,c,u,f,p,m=Object.assign({},t.spanLimits),v=UMe();return m.attributeCountLimit=(o=(s=(i=(n=(e=t.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&n!==void 0?n:(r=t.generalLimits)===null||r===void 0?void 0:r.attributeCountLimit)!==null&&i!==void 0?i:v.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&s!==void 0?s:v.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&o!==void 0?o:fE,m.attributeValueLengthLimit=(p=(f=(u=(l=(a=t.spanLimits)===null||a===void 0?void 0:a.attributeValueLengthLimit)!==null&&l!==void 0?l:(c=t.generalLimits)===null||c===void 0?void 0:c.attributeValueLengthLimit)!==null&&u!==void 0?u:v.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&f!==void 0?f:v.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&p!==void 0?p:dE,Object.assign({},t,{spanLimits:m})}var J9e=function(){function t(e,n){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=Sy();this._maxExportBatchSize=typeof(n==null?void 0:n.maxExportBatchSize)=="number"?n.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(n==null?void 0:n.maxQueueSize)=="number"?n.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(n==null?void 0:n.scheduledDelayMillis)=="number"?n.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(n==null?void 0:n.exportTimeoutMillis)=="number"?n.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new Kre(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Ot.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return t.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){this._shutdownOnce.isCalled||(e.spanContext().traceFlags&$l.SAMPLED)!==0&&this._addToBuffer(e)},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},t.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&Ot.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(Ot.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},t.prototype._flushAll=function(){var e=this;return new Promise(function(n,r){for(var i=[],s=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),o=0,a=s;o<a;o++)i.push(e._flushOneBatch());Promise.all(i).then(function(){n()}).catch(r)})},t.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(n,r){var i=setTimeout(function(){r(new Error("Timeout"))},e._exportTimeoutMillis);xd.with(Pre(xd.active()),function(){var s;e._finishedSpans.length<=e._maxExportBatchSize?(s=e._finishedSpans,e._finishedSpans=[]):s=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var o=function(){return e._exporter.export(s,function(f){var p;clearTimeout(i),f.code===Pa.SUCCESS?n():r((p=f.error)!==null&&p!==void 0?p:new Error("BatchSpanProcessor: span export failed"))})},a=null,l=0,c=s.length;l<c;l++){var u=s[l];u.resource.asyncAttributesPending&&u.resource.waitForAsyncAttributes&&(a??(a=[]),a.push(u.resource.waitForAsyncAttributes()))}a===null?o():Promise.all(a).then(o,function(f){zc(f),r(f)})})})},t.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var n=function(){e._isExporting=!0,e._flushOneBatch().finally(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){e._isExporting=!1,zc(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return n();this._timer===void 0&&(this._timer=setTimeout(function(){return n()},this._scheduledDelayMillis),this._timer,void 0)}},t.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},t}(),Z9e=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Q9e=function(t){Z9e(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.onInit(r),i}return e.prototype.onInit=function(n){var r=this;(n==null?void 0:n.disableAutoFlushOnDocumentHide)!==!0&&typeof document<"u"&&(this._visibilityChangeListener=function(){document.visibilityState==="hidden"&&r.forceFlush().catch(function(i){zc(i)})},this._pageHideListener=function(){r.forceFlush().catch(function(i){zc(i)})},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},e.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},e}(J9e),e7e=8,t7e=16,n7e=function(){function t(){this.generateTraceId=zB(t7e),this.generateSpanId=zB(e7e)}return t}(),FS=Array(32);function zB(t){return function(){for(var n=0;n<t*2;n++)FS[n]=Math.floor(Math.random()*16)+48,FS[n]>=58&&(FS[n]+=39);return String.fromCharCode.apply(null,FS.slice(0,t*2))}}var r7e=function(){function t(e,n,r){this._tracerProvider=r;var i=Y9e(n);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=n.idGenerator||new n7e,this.resource=r.resource,this.instrumentationLibrary=e}return t.prototype.startSpan=function(e,n,r){var i,s,o;n===void 0&&(n={}),r===void 0&&(r=xd.active()),n.root&&(r=Ma.deleteSpan(r));var a=Ma.getSpan(r);if(c8(r)){Ot.debug("Instrumentation suppressed, returning Noop Span");var l=Ma.wrapSpanContext(Cre);return l}var c=a==null?void 0:a.spanContext(),u=this._idGenerator.generateSpanId(),f,p,m;!c||!Ma.isSpanContextValid(c)?f=this._idGenerator.generateTraceId():(f=c.traceId,p=c.traceState,m=c.spanId);var v=(i=n.kind)!==null&&i!==void 0?i:r5.INTERNAL,g=((s=n.links)!==null&&s!==void 0?s:[]).map(function(C){return{context:C.context,attributes:uE(C.attributes)}}),S=uE(n.attributes),b=this._sampler.shouldSample(r,f,e,v,S,g);p=(o=b.traceState)!==null&&o!==void 0?o:p;var w=b.decision===xw.RECORD_AND_SAMPLED?$l.SAMPLED:$l.NONE,k={traceId:f,spanId:u,traceFlags:w,traceState:p};if(b.decision===xw.NOT_RECORD){Ot.debug("Recording is off, propagating context in a non-recording span");var l=Ma.wrapSpanContext(k);return l}var T=uE(Object.assign(S,b.attributes)),I=new W9e(this,r,e,k,v,m,g,n.startTime,void 0,T);return I},t.prototype.startActiveSpan=function(e,n,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,o=r,a=i);var l=o??xd.active(),c=this.startSpan(e,s,l),u=Ma.setSpan(l,c);return xd.with(u,a,void 0,c)}},t.prototype.getGeneralLimits=function(){return this._generalLimits},t.prototype.getSpanLimits=function(){return this._spanLimits},t.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},t}(),i7e="service.name",s7e="telemetry.sdk.name",o7e="telemetry.sdk.language",a7e="telemetry.sdk.version",l7e=i7e,YB=s7e,XB=o7e,JB=a7e;function c7e(){return"unknown_service"}var od=function(){return od=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},od.apply(this,arguments)},u7e=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},d7e=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},f7e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},c5=function(){function t(e,n){var r=this,i;this._attributes=e,this.asyncAttributesPending=n!=null,this._syncAttributes=(i=this._attributes)!==null&&i!==void 0?i:{},this._asyncAttributesPromise=n==null?void 0:n.then(function(s){return r._attributes=Object.assign({},r._attributes,s),r.asyncAttributesPending=!1,s},function(s){return Ot.debug("a resource's async attributes promise rejected: %s",s),r.asyncAttributesPending=!1,{}})}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[l7e]=c7e(),e[XB]=p4[XB],e[YB]=p4[YB],e[JB]=p4[JB],e))},Object.defineProperty(t.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&Ot.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),t.prototype.waitForAsyncAttributes=function(){return u7e(this,void 0,void 0,function(){return d7e(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.merge=function(e){var n=this,r;if(!e)return this;var i=od(od({},this._syncAttributes),(r=e._syncAttributes)!==null&&r!==void 0?r:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new t(i);var s=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(o){var a,l=f7e(o,2),c=l[0],u=l[1];return od(od(od(od({},n._syncAttributes),c),(a=e._syncAttributes)!==null&&a!==void 0?a:e.attributes),u)});return new t(i,s)},t.EMPTY=new t({}),t}(),US=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ZB=function(){function t(e){this._spanProcessors=e}return t.prototype.forceFlush=function(){var e,n,r=[];try{for(var i=US(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;r.push(o.forceFlush())}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(a){Promise.all(r).then(function(){a()}).catch(function(l){zc(l||new Error("MultiSpanProcessor: forceFlush failed")),a()})})},t.prototype.onStart=function(e,n){var r,i;try{for(var s=US(this._spanProcessors),o=s.next();!o.done;o=s.next()){var a=o.value;a.onStart(e,n)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.prototype.onEnd=function(e){var n,r;try{for(var i=US(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;o.onEnd(e)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.shutdown=function(){var e,n,r=[];try{for(var i=US(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;r.push(o.shutdown())}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(a,l){Promise.all(r).then(function(){a()},l)})},t}(),h7e=function(){function t(){}return t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){},t.prototype.shutdown=function(){return Promise.resolve()},t.prototype.forceFlush=function(){return Promise.resolve()},t}(),p7e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},m7e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},Qf;(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(Qf||(Qf={}));var g7e=function(){function t(e){e===void 0&&(e={});var n,r;this._registeredSpanProcessors=[],this._tracers=new Map;var i=O9e({},Wre(),X9e(e));if(this.resource=(n=i.resource)!==null&&n!==void 0?n:c5.empty(),i.mergeResourceWithDefaults&&(this.resource=c5.default().merge(this.resource)),this._config=Object.assign({},i,{resource:this.resource}),!((r=e.spanProcessors)===null||r===void 0)&&r.length)this._registeredSpanProcessors=m7e([],p7e(e.spanProcessors),!1),this.activeSpanProcessor=new ZB(this._registeredSpanProcessors);else{var s=this._buildExporterFromEnv();if(s!==void 0){var o=new Q9e(s);this.activeSpanProcessor=o}else this.activeSpanProcessor=new h7e}}return t.prototype.getTracer=function(e,n,r){var i=e+"@"+(n||"")+":"+((r==null?void 0:r.schemaUrl)||"");return this._tracers.has(i)||this._tracers.set(i,new r7e({name:e,version:n,schemaUrl:r==null?void 0:r.schemaUrl},this._config,this)),this._tracers.get(i)},t.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(n){return Ot.error("Error while trying to shutdown current span processor",n)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new ZB(this._registeredSpanProcessors)},t.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},t.prototype.register=function(e){e===void 0&&(e={}),Ma.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&xd.setGlobalContextManager(e.contextManager),e.propagator&&cE.setGlobalPropagator(e.propagator)},t.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,n=this._registeredSpanProcessors.map(function(r){return new Promise(function(i){var s,o=setTimeout(function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),s=Qf.timeout},e);r.forceFlush().then(function(){clearTimeout(o),s!==Qf.timeout&&(s=Qf.resolved,i(s))}).catch(function(a){clearTimeout(o),s=Qf.error,i(a)})})});return new Promise(function(r,i){Promise.all(n).then(function(s){var o=s.filter(function(a){return a!==Qf.resolved});o.length>0?i(o):r()}).catch(function(s){return i([s])})})},t.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},t.prototype._getPropagator=function(e){var n;return(n=this.constructor._registeredPropagators.get(e))===null||n===void 0?void 0:n()},t.prototype._getSpanExporter=function(e){var n;return(n=this.constructor._registeredExporters.get(e))===null||n===void 0?void 0:n()},t.prototype._buildPropagatorFromEnv=function(){var e=this,n=Array.from(new Set(Sy().OTEL_PROPAGATORS)),r=n.map(function(s){var o=e._getPropagator(s);return o||Ot.warn('Propagator "'+s+'" requested through environment variable is unavailable.'),o}),i=r.reduce(function(s,o){return o&&s.push(o),s},[]);if(i.length!==0)return n.length===1?i[0]:new r9e({propagators:i})},t.prototype._buildExporterFromEnv=function(){var e=Sy().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var n=this._getSpanExporter(e);return n||Ot.error('Exporter "'+e+'" requested through environment variable is unavailable.'),n}},t._registeredPropagators=new Map([["tracecontext",function(){return new b9e}],["baggage",function(){return new gMe}]]),t._registeredExporters=new Map,t}(),v7e=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},y7e=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},_7e=function(){function t(e){this._exporter=e,this._shutdownOnce=new Kre(this._shutdown,this),this._unresolvedExports=new Set}return t.prototype.forceFlush=function(){return v7e(this,void 0,void 0,function(){return y7e(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._unresolvedExports))];case 1:return e.sent(),this._exporter.forceFlush?[4,this._exporter.forceFlush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){var n=this,r,i;if(!this._shutdownOnce.isCalled&&(e.spanContext().traceFlags&$l.SAMPLED)!==0){var s=function(){return j9e._export(n._exporter,[e]).then(function(a){var l;a.code!==Pa.SUCCESS&&zc((l=a.error)!==null&&l!==void 0?l:new Error("SimpleSpanProcessor: span export failed (status "+a+")"))}).catch(function(a){zc(a)})};if(e.resource.asyncAttributesPending){var o=(i=(r=e.resource).waitForAsyncAttributes)===null||i===void 0?void 0:i.call(r).then(function(){return o!=null&&n._unresolvedExports.delete(o),s()},function(a){return zc(a)});o!=null&&this._unresolvedExports.add(o)}else s()}},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){return this._exporter.shutdown()},t}(),b7e=function(){function t(e){this._delegate=e}return t.prototype.export=function(e,n){this._delegate.export(e,n)},t.prototype.forceFlush=function(){return this._delegate.forceFlush()},t.prototype.shutdown=function(){return this._delegate.shutdown()},t}(),S7e=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),QB=function(t){S7e(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.name="OTLPExporterError",s.data=i,s.code=r,s}return e}(Error);function E7e(t){if(!Number.isNaN(t)&&Number.isFinite(t)&&t>0)return t;throw new Error("Configuration: timeoutMillis is invalid, expected number greater than 0 (actual: '"+t+"')")}function w7e(t){if(t!=null)return function(){return t}}function C7e(t,e,n){var r,i,s,o,a,l;return{timeoutMillis:E7e((i=(r=t.timeoutMillis)!==null&&r!==void 0?r:e.timeoutMillis)!==null&&i!==void 0?i:n.timeoutMillis),concurrencyLimit:(o=(s=t.concurrencyLimit)!==null&&s!==void 0?s:e.concurrencyLimit)!==null&&o!==void 0?o:n.concurrencyLimit,compression:(l=(a=t.compression)!==null&&a!==void 0?a:e.compression)!==null&&l!==void 0?l:n.compression}}function T7e(){return{timeoutMillis:1e4,concurrencyLimit:30,compression:"none"}}var R7e=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},I7e=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},k7e=function(){function t(e){this._sendingPromises=[],this._concurrencyLimit=e}return t.prototype.pushPromise=function(e){var n=this;if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(e);var r=function(){var i=n._sendingPromises.indexOf(e);n._sendingPromises.splice(i,1)};e.then(r,r)},t.prototype.hasReachedLimit=function(){return this._sendingPromises.length>=this._concurrencyLimit},t.prototype.awaitAll=function(){return R7e(this,void 0,void 0,function(){return I7e(this,function(e){switch(e.label){case 0:return[4,Promise.all(this._sendingPromises)];case 1:return e.sent(),[2]}})})},t}();function x7e(t){return new k7e(t.concurrencyLimit)}function P7e(t){return Object.prototype.hasOwnProperty.call(t,"partialSuccess")}function L7e(){return{handleResponse:function(t){t==null||!P7e(t)||t.partialSuccess==null||Object.keys(t.partialSuccess).length===0||Ot.warn("Received Partial Success response:",JSON.stringify(t.partialSuccess))}}}var A7e=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},O7e=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},M7e=function(){function t(e,n,r,i,s){this._transport=e,this._serializer=n,this._responseHandler=r,this._promiseQueue=i,this._timeout=s,this._diagLogger=Ot.createComponentLogger({namespace:"OTLPExportDelegate"})}return t.prototype.export=function(e,n){var r=this;if(this._diagLogger.debug("items to be sent",e),this._promiseQueue.hasReachedLimit()){n({code:Pa.FAILED,error:new Error("Concurrent export limit reached")});return}var i=this._serializer.serializeRequest(e);if(i==null){n({code:Pa.FAILED,error:new Error("Nothing to send")});return}this._promiseQueue.pushPromise(this._transport.send(i,this._timeout).then(function(s){if(s.status==="success"){if(s.data!=null)try{r._responseHandler.handleResponse(r._serializer.deserializeResponse(s.data))}catch(o){r._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",o,s.data)}n({code:Pa.SUCCESS});return}else if(s.status==="failure"&&s.error){n({code:Pa.FAILED,error:s.error});return}else s.status==="retryable"?n({code:Pa.FAILED,error:new QB("Export failed with retryable status")}):n({code:Pa.FAILED,error:new QB("Export failed with unknown error")})},function(s){return n({code:Pa.FAILED,error:s})}))},t.prototype.forceFlush=function(){return this._promiseQueue.awaitAll()},t.prototype.shutdown=function(){return A7e(this,void 0,void 0,function(){return O7e(this,function(e){switch(e.label){case 0:return this._diagLogger.debug("shutdown started"),[4,this.forceFlush()];case 1:return e.sent(),this._transport.shutdown(),[2]}})})},t}();function N7e(t,e){return new M7e(t.transport,t.serializer,L7e(),t.promiseHandler,e.timeout)}function Yre(t,e,n){return N7e({transport:n,serializer:e,promiseHandler:x7e(t)},{timeout:t.timeoutMillis})}function Xre(t){var e=BigInt(1e9);return BigInt(t[0])*e+BigInt(t[1])}function D7e(t){var e=Number(BigInt.asUintN(32,t)),n=Number(BigInt.asUintN(32,t>>BigInt(32)));return{low:e,high:n}}function Jre(t){var e=Xre(t);return D7e(e)}function F7e(t){var e=Xre(t);return e.toString()}var U7e=typeof BigInt<"u"?F7e:t9e;function eH(t){return t}function Zre(t){if(t!==void 0)return u8(t)}var j7e={encodeHrTime:Jre,encodeSpanContext:u8,encodeOptionalSpanContext:Zre};function $7e(t){var e,n;if(t===void 0)return j7e;var r=(e=t.useLongBits)!==null&&e!==void 0?e:!0,i=(n=t.useHex)!==null&&n!==void 0?n:!1;return{encodeHrTime:r?Jre:U7e,encodeSpanContext:i?eH:u8,encodeOptionalSpanContext:i?eH:Zre}}var B7e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function H7e(t){return{attributes:PT(t.attributes),droppedAttributesCount:0}}function V7e(t){return{name:t.name,version:t.version}}function PT(t){return Object.keys(t).map(function(e){return Qre(e,t[e])})}function Qre(t,e){return{key:t,value:eie(e)}}function eie(t){var e=typeof t;return e==="string"?{stringValue:t}:e==="number"?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:e==="boolean"?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(eie)}}:e==="object"&&t!=null?{kvlistValue:{values:Object.entries(t).map(function(n){var r=B7e(n,2),i=r[0],s=r[1];return Qre(i,s)})}}:{}}var G7e=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},q7e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function K7e(t,e){var n,r=t.spanContext(),i=t.status;return{traceId:e.encodeSpanContext(r.traceId),spanId:e.encodeSpanContext(r.spanId),parentSpanId:e.encodeOptionalSpanContext(t.parentSpanId),traceState:(n=r.traceState)===null||n===void 0?void 0:n.serialize(),name:t.name,kind:t.kind==null?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:PT(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(function(s){return z7e(s,e)}),droppedEventsCount:t.droppedEventsCount,status:{code:i.code,message:i.message},links:t.links.map(function(s){return W7e(s,e)}),droppedLinksCount:t.droppedLinksCount}}function W7e(t,e){var n;return{attributes:t.attributes?PT(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:(n=t.context.traceState)===null||n===void 0?void 0:n.serialize(),droppedAttributesCount:t.droppedAttributesCount||0}}function z7e(t,e){return{attributes:t.attributes?PT(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}function Y7e(t,e){var n=$7e(e);return{resourceSpans:J7e(t,n)}}function X7e(t){var e,n,r=new Map;try{for(var i=G7e(t),s=i.next();!s.done;s=i.next()){var o=s.value,a=r.get(o.resource);a||(a=new Map,r.set(o.resource,a));var l=o.instrumentationLibrary.name+"@"+(o.instrumentationLibrary.version||"")+":"+(o.instrumentationLibrary.schemaUrl||""),c=a.get(l);c||(c=[],a.set(l,c)),c.push(o)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function J7e(t,e){for(var n=X7e(t),r=[],i=n.entries(),s=i.next();!s.done;){for(var o=q7e(s.value,2),a=o[0],l=o[1],c=[],u=l.values(),f=u.next();!f.done;){var p=f.value;if(p.length>0){var m=p.map(function(g){return K7e(g,e)});c.push({scope:V7e(p[0].instrumentationLibrary),spans:m,schemaUrl:p[0].instrumentationLibrary.schemaUrl})}f=u.next()}var v={resource:H7e(a),scopeSpans:c,schemaUrl:void 0};r.push(v),s=i.next()}return r}var Z7e={serializeRequest:function(t){var e=Y7e(t,{useHex:!0,useLongBits:!1}),n=new TextEncoder;return n.encode(JSON.stringify(e))},deserializeResponse:function(t){var e=new TextDecoder;return JSON.parse(e.decode(t))}},Q7e=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},eNe=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},tNe=5,nNe=1e3,rNe=5e3,iNe=1.5,tH=.2;function sNe(){return Math.random()*(2*tH)-tH}var oNe=function(){function t(e){this._transport=e}return t.prototype.retry=function(e,n,r){var i=this;return new Promise(function(s,o){setTimeout(function(){i._transport.send(e,n).then(s,o)},r)})},t.prototype.send=function(e,n){var r;return Q7e(this,void 0,void 0,function(){var i,s,o,a,l,c,u;return eNe(this,function(f){switch(f.label){case 0:return i=Date.now()+n,[4,this._transport.send(e,n)];case 1:s=f.sent(),o=tNe,a=nNe,f.label=2;case 2:return s.status==="retryable"&&o>0?(o--,l=Math.max(Math.min(a,rNe)+sNe(),0),a=a*iNe,c=(r=s.retryInMillis)!==null&&r!==void 0?r:l,u=i-Date.now(),c>u?[2,s]:[4,this.retry(e,u,c)]):[3,4];case 3:return s=f.sent(),[3,2];case 4:return[2,s]}})})},t.prototype.shutdown=function(){return this._transport.shutdown()},t}();function tie(t){return new oNe(t.transport)}function aNe(t){var e=[429,502,503,504];return e.includes(t)}function lNe(t){if(t!=null){var e=Number.parseInt(t,10);if(Number.isInteger(e))return e>0?e*1e3:-1;var n=new Date(t).getTime()-Date.now();return n>=0?n:0}}var cNe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},uNe=function(){function t(e){this._parameters=e}return t.prototype.send=function(e,n){var r=this;return new Promise(function(i){var s=new XMLHttpRequest;s.timeout=n,s.open("POST",r._parameters.url);var o=r._parameters.headers();Object.entries(o).forEach(function(a){var l=cNe(a,2),c=l[0],u=l[1];s.setRequestHeader(c,u)}),s.ontimeout=function(a){i({status:"failure",error:new Error("XHR request timed out")})},s.onreadystatechange=function(){s.status>=200&&s.status<=299?(Ot.debug("XHR success"),i({status:"success"})):s.status&&aNe(s.status)?i({status:"retryable",retryInMillis:lNe(s.getResponseHeader("Retry-After"))}):s.status!==0&&i({status:"failure",error:new Error("XHR request failed with non-retryable status")})},s.onabort=function(){i({status:"failure",error:new Error("XHR request aborted")})},s.onerror=function(){i({status:"failure",error:new Error("XHR request errored")})},s.send(e)})},t.prototype.shutdown=function(){},t}();function dNe(t){return new uNe(t)}var fNe=function(){function t(e){this._params=e}return t.prototype.send=function(e){var n=this;return new Promise(function(r){navigator.sendBeacon(n._params.url,new Blob([e],{type:n._params.blobType}))?(Ot.debug("SendBeacon success"),r({status:"success"})):r({status:"failure",error:new Error("SendBeacon failed")})})},t.prototype.shutdown=function(){},t}();function hNe(t){return new fNe(t)}function pNe(t,e){return Yre(t,e,tie({transport:dNe(t)}))}function mNe(t,e){return Yre(t,e,tie({transport:hNe({url:t.url,blobType:t.headers()["Content-Type"]})}))}var gNe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function vNe(t){return function(){var e,n={};return Object.entries((e=t==null?void 0:t())!==null&&e!==void 0?e:{}).forEach(function(r){var i=gNe(r,2),s=i[0],o=i[1];typeof o<"u"?n[s]=String(o):Ot.warn('Header "'+s+'" has invalid value ('+o+") and will be ignored")}),n}}var Nh=function(){return Nh=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Nh.apply(this,arguments)};function yNe(t,e,n){var r=Nh({},n()),i={};return function(){return e!=null&&Object.assign(i,e()),t!=null&&Object.assign(i,t()),Object.assign(i,r)}}function _Ne(t){if(t!=null)try{return new URL(t),t}catch{throw new Error("Configuration: Could not parse user-provided export URL: '"+t+"'")}}function bNe(t,e,n){var r,i,s,o;return Nh(Nh({},C7e(t,e,n)),{headers:yNe(vNe(t.headers),e.headers,n.headers),url:(i=(r=_Ne(t.url))!==null&&r!==void 0?r:e.url)!==null&&i!==void 0?i:n.url,agentOptions:(o=(s=t.agentOptions)!==null&&s!==void 0?s:e.agentOptions)!==null&&o!==void 0?o:n.agentOptions})}function SNe(t,e){return Nh(Nh({},T7e()),{headers:function(){return t},url:"http://localhost:4318/"+e,agentOptions:{keepAlive:!0}})}function ENe(t,e,n){return bNe({url:t.url,timeoutMillis:t.timeoutMillis,headers:w7e(t.headers),concurrencyLimit:t.concurrencyLimit},{},SNe(n,e))}function wNe(t,e,n,r){var i=!!t.headers||typeof navigator.sendBeacon!="function",s=ENe(t,n,r);return i?pNe(s,e):mNe(s,e)}var CNe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),TNe=function(t){CNe(e,t);function e(n){return n===void 0&&(n={}),t.call(this,wNe(n,Z7e,"v1/traces",{"Content-Type":"application/json"}))||this}return e}(b7e),RNe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},INe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},kNe=function(){function t(){this._enabled=!1,this._currentContext=lm}return t.prototype._bindFunction=function(e,n){e===void 0&&(e=lm);var r=this,i=function(){for(var s=this,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return r.with(e,function(){return n.apply(s,o)})};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:n.length}),i},t.prototype.active=function(){return this._currentContext},t.prototype.bind=function(e,n){return e===void 0&&(e=this.active()),typeof n=="function"?this._bindFunction(e,n):n},t.prototype.disable=function(){return this._currentContext=lm,this._enabled=!1,this},t.prototype.enable=function(){return this._enabled?this:(this._enabled=!0,this._currentContext=lm,this)},t.prototype.with=function(e,n,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];var o=this._currentContext;this._currentContext=e||lm;try{return n.call.apply(n,INe([r],RNe(i),!1))}finally{this._currentContext=o}},t}(),xNe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),PNe=function(t){xNe(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;if(n.contextManager)throw"contextManager should be defined in register method not in constructor";if(n.propagator)throw"propagator should be defined in register method not in constructor";return r}return e.prototype.register=function(n){n===void 0&&(n={}),n.contextManager===void 0&&(n.contextManager=new kNe),n.contextManager&&n.contextManager.enable(),t.prototype.register.call(this,n)},e}(g7e);function LNe(t){for(var e={},n=t.length,r=0;r<n;r++){var i=t[r];i&&(e[String(i).toUpperCase().replace(/[-.]/g,"_")]=i)}return e}var ANe="cloud.provider",ONe="cloud.account.id",MNe="cloud.region",NNe="cloud.availability_zone",DNe="cloud.platform",FNe="aws.ecs.container.arn",UNe="aws.ecs.cluster.arn",jNe="aws.ecs.launchtype",$Ne="aws.ecs.task.arn",BNe="aws.ecs.task.family",HNe="aws.ecs.task.revision",VNe="aws.eks.cluster.arn",GNe="aws.log.group.names",qNe="aws.log.group.arns",KNe="aws.log.stream.names",WNe="aws.log.stream.arns",zNe="container.name",YNe="container.id",XNe="container.runtime",JNe="container.image.name",ZNe="container.image.tag",QNe="deployment.environment",eDe="device.id",tDe="device.model.identifier",nDe="device.model.name",rDe="faas.name",iDe="faas.id",sDe="faas.version",oDe="faas.instance",aDe="faas.max_memory",lDe="host.id",cDe="host.name",uDe="host.type",dDe="host.arch",fDe="host.image.name",hDe="host.image.id",pDe="host.image.version",mDe="k8s.cluster.name",gDe="k8s.node.name",vDe="k8s.node.uid",yDe="k8s.namespace.name",_De="k8s.pod.uid",bDe="k8s.pod.name",SDe="k8s.container.name",EDe="k8s.replicaset.uid",wDe="k8s.replicaset.name",CDe="k8s.deployment.uid",TDe="k8s.deployment.name",RDe="k8s.statefulset.uid",IDe="k8s.statefulset.name",kDe="k8s.daemonset.uid",xDe="k8s.daemonset.name",PDe="k8s.job.uid",LDe="k8s.job.name",ADe="k8s.cronjob.uid",ODe="k8s.cronjob.name",MDe="os.type",NDe="os.description",DDe="os.name",FDe="os.version",UDe="process.pid",jDe="process.executable.name",$De="process.executable.path",BDe="process.command",HDe="process.command_line",VDe="process.command_args",GDe="process.owner",qDe="process.runtime.name",KDe="process.runtime.version",WDe="process.runtime.description",zDe="service.name",YDe="service.namespace",XDe="service.instance.id",JDe="service.version",ZDe="telemetry.sdk.name",QDe="telemetry.sdk.language",eFe="telemetry.sdk.version",tFe="telemetry.auto.version",nFe="webengine.name",rFe="webengine.version",iFe="webengine.description",sFe=LNe([ANe,ONe,MNe,NNe,DNe,FNe,UNe,jNe,$Ne,BNe,HNe,VNe,GNe,qNe,KNe,WNe,zNe,YNe,XNe,JNe,ZNe,QNe,eDe,tDe,nDe,rDe,iDe,sDe,oDe,aDe,lDe,cDe,uDe,dDe,fDe,hDe,pDe,mDe,gDe,vDe,yDe,_De,bDe,SDe,EDe,wDe,CDe,TDe,RDe,IDe,kDe,xDe,PDe,LDe,ADe,ODe,MDe,NDe,DDe,FDe,UDe,jDe,$De,BDe,HDe,VDe,GDe,qDe,KDe,WDe,zDe,YDe,XDe,JDe,ZDe,QDe,eFe,tFe,nFe,rFe,iFe]);function nH(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function De(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nH(Object(n),!0).forEach(function(r){de(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nH(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ey(t){return Ey=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ey(t)}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rH(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jt(t,e,n){return e&&rH(t.prototype,e),n&&rH(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function de(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function oFe(t,e){if(t==null)return{};var n,r,i=function(o,a){if(o==null)return{};var l,c,u={},f=Object.keys(o);for(c=0;c<f.length;c++)l=f[c],a.indexOf(l)>=0||(u[l]=o[l]);return u}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Qi(t,e){return function(n){if(Array.isArray(n))return n}(t)||function(n,r){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s,o,a=[],l=!0,c=!1;try{for(i=i.call(n);!(l=(s=i.next()).done)&&(a.push(s.value),!r||a.length!==r);l=!0);}catch(u){c=!0,o=u}finally{try{l||i.return==null||i.return()}finally{if(c)throw o}}return a}}(t,e)||d8(t,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Yc(t){return function(e){if(Array.isArray(e))return u5(e)}(t)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(t)||d8(t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function d8(t,e){if(t){if(typeof t=="string")return u5(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u5(t,e):void 0}}function u5(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Qo(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=d8(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}var Oo={DEBUG:!1,LIB_VERSION:"1.160.3"},aFe=Array.isArray,nie=Object.prototype,rie=nie.hasOwnProperty,LT=nie.toString,Xr=aFe||function(t){return LT.call(t)==="[object Array]"},Ho=function(t){return typeof t=="function"},wi=function(t){return t===Object(t)&&!Xr(t)},pE=function(t){if(wi(t)){for(var e in t)if(rie.call(t,e))return!1;return!0}return!1},rt=function(t){return t===void 0},Hi=function(t){return LT.call(t)=="[object String]"},iH=function(t){return Hi(t)&&t.trim().length===0},gu=function(t){return t===null},Ms=function(t){return rt(t)||gu(t)},Mo=function(t){return LT.call(t)=="[object Number]"},ih=function(t){return LT.call(t)==="[object Boolean]"},lFe=function(t){return t instanceof FormData},ie=typeof window<"u"?window:void 0,xs=typeof globalThis<"u"?globalThis:ie,iie=Array.prototype,sH=iie.forEach,oH=iie.indexOf,$a=xs==null?void 0:xs.navigator,Be=xs==null?void 0:xs.document,Ss=xs==null?void 0:xs.location,d5=xs==null?void 0:xs.fetch,f5=xs!=null&&xs.XMLHttpRequest&&"withCredentials"in new xs.XMLHttpRequest?xs.XMLHttpRequest:void 0,aH=xs==null?void 0:xs.AbortController,ai=$a==null?void 0:$a.userAgent,qn=ie??{},lH="[PostHog.js]",he={_log:function(t){if(ie&&(Oo.DEBUG||qn.POSTHOG_DEBUG)&&!rt(ie.console)&&ie.console){for(var e=("__rrweb_original__"in ie.console[t])?ie.console[t].__rrweb_original__:ie.console[t],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.apply(void 0,[lH].concat(r))}},info:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];he._log.apply(he,["log"].concat(e))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];he._log.apply(he,["warn"].concat(e))},error:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];he._log.apply(he,["error"].concat(e))},critical:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).error.apply(t,[lH].concat(n))},uninitializedWarning:function(t){he.error("You must initialize PostHog before calling ".concat(t))}},Ow={},AT=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Gm(t,e,n){if(Xr(t)){if(sH&&t.forEach===sH)t.forEach(e,n);else if("length"in t&&t.length===+t.length){for(var r=0,i=t.length;r<i;r++)if(r in t&&e.call(n,t[r],r)===Ow)return}}}function Sn(t,e,n){if(!Ms(t)){if(Xr(t))return Gm(t,e,n);if(lFe(t)){var r,i=Qo(t.entries());try{for(i.s();!(r=i.n()).done;){var s=r.value;if(e.call(n,s[1],s[0])===Ow)return}}catch(a){i.e(a)}finally{i.f()}}else for(var o in t)if(rie.call(t,o)&&e.call(n,t[o],o)===Ow)return}}var es=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Gm(n,function(i){for(var s in i)i[s]!==void 0&&(t[s]=i[s])}),t};function Lt(t,e){return t.indexOf(e)!==-1}function mE(t){for(var e=Object.keys(t),n=e.length,r=new Array(n);n--;)r[n]=[e[n],t[e[n]]];return r}var sie=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},cH=function(t){try{return t()}catch{return}},cFe=function(t){return function(){try{for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(this,n)}catch(i){he.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),he.critical(i)}}},h5=function(t){var e={};return Sn(t,function(n,r){Hi(n)&&n.length>0&&(e[r]=n)}),e},p5=function(t){return t.replace(/^\$/,"")};function uFe(t,e){return n=t,r=function(s){return Hi(s)&&!gu(e)?s.slice(0,e):s},i=new Set,function s(o,a){return o!==Object(o)?r?r(o,a):o:i.has(o)?void 0:(i.add(o),Xr(o)?(l=[],Gm(o,function(c){l.push(s(c))})):(l={},Sn(o,function(c,u){i.has(c)||(l[u]=s(c,u))})),l);var l}(n);var n,r,i}var Ua,dFe=function(t){var e,n,r,i,s="";for(e=n=0,r=(t=(t+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<r;i++){var o=t.charCodeAt(i),a=null;o<128?n++:a=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),gu(a)||(n>e&&(s+=t.substring(e,n)),s+=a,e=n=i+1)}return n>e&&(s+=t.substring(e,t.length)),s},Nc=function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation),e}return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},function(e,n,r,i,s){if(e)if(e.addEventListener&&!i)e.addEventListener(n,r,!!s);else{var o="on"+n,a=e[o];e[o]=function(l,c,u){return function(f){if(f=f||t(ie==null?void 0:ie.event)){var p,m=!0;Ho(u)&&(p=u(f));var v=c.call(l,f);return p!==!1&&v!==!1||(m=!1),m}}}(e,r,a)}else he.error("No valid element provided to register_event")}}();function oie(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]}(function(t){t.GZipJS="gzip-js",t.Base64="base64"})(Ua||(Ua={}));var aie="$people_distinct_id",r1="__alias",i1="__timers",uH="$autocapture_disabled_server_side",m5="$heatmaps_enabled_server_side",dH="$exception_capture_enabled_server_side",fH="$exception_capture_endpoint_suffix",hH="$web_vitals_enabled_server_side",g5="$session_recording_enabled_server_side",pH="$console_log_recording_enabled_server_side",mH="$session_recording_network_payload_capture",gH="$session_recording_canvas_recording",vH="$replay_sample_rate",yH="$replay_minimum_duration",Mw="$sesid",A1="$session_is_sampled",_m="$enabled_feature_flags",v5="$early_access_features",bm="$stored_person_properties",ad="$stored_group_properties",y5="$surveys",jS="$surveys_activated",Nw="$flag_call_reported",Cc="$user_state",_5="$client_session_props",b5="$capture_rate_limit",S5="$initial_campaign_params",E5="$initial_referrer_info",_H="$initial_person_info",Dw="$epp",w5="__POSTHOG_TOOLBAR__",fFe=[aie,r1,"__cmpns",i1,g5,m5,Mw,_m,Cc,v5,ad,bm,y5,Nw,_5,b5,S5,E5,Dw],E4="$active_feature_flags",$S="$override_feature_flags",bH="$feature_flag_payloads",SH=function(t){var e,n={},r=Qo(mE(t||{}));try{for(r.s();!(e=r.n()).done;){var i=Qi(e.value,2),s=i[0],o=i[1];o&&(n[s]=o)}}catch(a){r.e(a)}finally{r.f()}return n},hFe=function(){function t(e){Xt(this,t),this.instance=e,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return Jt(t,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(_m),n=this.instance.get_property($S);if(!n)return e||{};for(var r=es({},e),i=Object.keys(n),s=0;s<i.length;s++)r[i[s]]=n[i[s]];return this._override_warning||(he.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:n,finalFlags:r}),this._override_warning=!0),r}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(bH)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout(function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())},5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var n=this.instance.config.token,r=this.instance.get_property(bm),i=this.instance.get_property(ad),s={token:n,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:r,group_properties:i,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:s,compression:this.instance.config.disable_compression?void 0:Ua.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(o){var a;e.setReloadingPaused(!1);var l=!0;o.statusCode===200&&(e.$anon_distinct_id=void 0,l=!1),e.receivedFeatureFlags((a=o.json)!==null&&a!==void 0?a:{},l),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var r,i=this.getFlagVariants()[e],s="".concat(i),o=this.instance.get_property(Nw)||{};return(n.send_event||!("send_event"in n))&&(!(e in o)||!o[e].includes(s))&&(Xr(o[e])?o[e].push(s):o[e]=[s],(r=this.instance.persistence)===null||r===void 0||r.register(de({},Nw,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:i})),i}he.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,n);he.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(function(n){return n!==e})}},{key:"receivedFeatureFlags",value:function(e,n){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var r=this.getFlagVariants(),i=this.getFlagPayloads();(function(s,o){var a,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=s.featureFlags,f=s.featureFlagPayloads;if(u)if(Xr(u)){var p,m={};if(u)for(var v=0;v<u.length;v++)m[u[v]]=!0;o&&o.register((de(p={},E4,u),de(p,_m,m),p))}else{var g=u,S=f;s.errorsWhileComputingFlags&&(g=De(De({},l),g),S=De(De({},c),S)),o&&o.register((de(a={},E4,Object.keys(SH(g))),de(a,_m,g||{}),de(a,bH,S||{}),a))}})(e,this.instance.persistence,r,i),this._fireFeatureFlagsCallbacks(n)}}},{key:"override",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return he.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=n,e===!1)this.instance.persistence.unregister($S);else if(Xr(e)){for(var r={},i=0;i<e.length;i++)r[e[i]]=!0;this.instance.persistence.register(de({},$S,r))}else this.instance.persistence.register(de({},$S,e))}},{key:"onFeatureFlags",value:function(e){var n=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var r=this._prepareFeatureFlagsForCallbacks(),i=r.flags,s=r.flagVariants;e(i,s)}return function(){return n.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){var r,i,s=de({},"$feature_enrollment/".concat(e),n);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:n,$set:s}),this.setPersonPropertiesForFlags(s,!1);var o=De(De({},this.getFlagVariants()),{},de({},e,n));(r=this.instance.persistence)===null||r===void 0||r.register((de(i={},E4,Object.keys(SH(o))),de(i,_m,o),i)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=this.instance.get_property(v5);if(i&&!r)return e(i);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(s){var o;if(s.json){var a=s.json.earlyAccessFeatures;return(o=n.instance.persistence)===null||o===void 0||o.register(de({},v5,a)),e(a)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),n=this.getFlagVariants();return{flags:e.filter(function(r){return n[r]}),flagVariants:Object.keys(n).filter(function(r){return n[r]}).reduce(function(r,i){return r[i]=n[i],r},{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var n=this._prepareFeatureFlagsForCallbacks(),r=n.flags,i=n.flagVariants;this.featureFlagEventHandlers.forEach(function(s){return s(r,i,{errorsLoading:e})})}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(bm)||{};this.instance.register(de({},bm,De(De({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(bm)}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(ad)||{};Object.keys(r).length!==0&&Object.keys(r).forEach(function(i){r[i]=De(De({},r[i]),e[i]),delete e[i]}),this.instance.register(de({},ad,De(De({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var n=this.instance.get_property(ad)||{};this.instance.register(de({},ad,De(De({},n),{},de({},e,{}))))}else this.instance.unregister(ad)}}]),t}();Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Number.isInteger||(Number.isInteger=function(t){return Mo(t)&&isFinite(t)&&Math.floor(t)===t});var EH="0123456789abcdef",pFe=function(){function t(e){if(Xt(this,t),this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}return Jt(t,[{key:"toString",value:function(){for(var e="",n=0;n<this.bytes.length;n++)e=e+EH.charAt(this.bytes[n]>>>4)+EH.charAt(15&this.bytes[n]),n!==3&&n!==5&&n!==7&&n!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new t(this.bytes.slice(0))}},{key:"equals",value:function(e){return this.compareTo(e)===0}},{key:"compareTo",value:function(e){for(var n=0;n<16;n++){var r=this.bytes[n]-e.bytes[n];if(r!==0)return Math.sign(r)}return 0}}],[{key:"fromFieldsV7",value:function(e,n,r,i){if(!Number.isInteger(e)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(i)||e<0||n<0||r<0||i<0||e>0xffffffffffff||n>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var s=new Uint8Array(16);return s[0]=e/Math.pow(2,40),s[1]=e/Math.pow(2,32),s[2]=e/Math.pow(2,24),s[3]=e/Math.pow(2,16),s[4]=e/Math.pow(2,8),s[5]=e,s[6]=112|n>>>8,s[7]=n,s[8]=128|r>>>24,s[9]=r>>>16,s[10]=r>>>8,s[11]=r,s[12]=i>>>24,s[13]=i>>>16,s[14]=i>>>8,s[15]=i,new t(s)}}]),t}(),mFe=function(){function t(){Xt(this,t),de(this,"timestamp",0),de(this,"counter",0),de(this,"random",new gFe)}return Jt(t,[{key:"generate",value:function(){var e=this.generateOrAbort();if(rt(e)){this.timestamp=0;var n=this.generateOrAbort();if(rt(n))throw new Error("Could not generate UUID after timestamp reset");return n}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return pFe.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),t}(),lie=function(t){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<t.length;e++)t[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return t};ie&&!rt(ie.crypto)&&crypto.getRandomValues&&(lie=function(t){return crypto.getRandomValues(t)});var wH,gFe=function(){function t(){Xt(this,t),de(this,"buffer",new Uint32Array(8)),de(this,"cursor",1/0)}return Jt(t,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(lie(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),t}(),_d=function(){return vFe().toString()},vFe=function(){return(wH||(wH=new mFe)).generate()},yFe="Thu, 01 Jan 1970 00:00:00 GMT",O0="",_Fe=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function bFe(t,e){if(e){var n=function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Be;if(O0)return O0;if(!s||["localhost","127.0.0.1"].includes(i))return"";for(var o=i.split("."),a=Math.min(o.length,8),l="dmn_chk_"+_d(),c=new RegExp("(^|;)\\s*"+l+"=1");!O0&&a--;){var u=o.slice(a).join("."),f=l+"=1;domain=."+u;s.cookie=f,c.test(s.cookie)&&(s.cookie=f+";expires="+yFe,O0=u)}return O0}(t);if(!n){var r=function(i){var s=i.match(_Fe);return s?s[0]:""}(t);r!==n&&he.info("Warning: cookie subdomain discovery mismatch",r,n),n=r}return n?"; domain=."+n:""}return""}var yi,Xc={is_supported:function(){return!!Be},error:function(t){he.error("cookieStore error: "+t)},get:function(t){if(Be){try{for(var e=t+"=",n=Be.cookie.split(";").filter(function(s){return s.length}),r=0;r<n.length;r++){for(var i=n[r];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},parse:function(t){var e;try{e=JSON.parse(Xc.get(t))||{}}catch{}return e},set:function(t,e,n,r,i){if(Be)try{var s="",o="",a=bFe(Be.location.hostname,r);if(n){var l=new Date;l.setTime(l.getTime()+24*n*60*60*1e3),s="; expires="+l.toUTCString()}i&&(o="; secure");var c=t+"="+encodeURIComponent(JSON.stringify(e))+s+"; SameSite=Lax; path=/"+a+o;return c.length>3686.4&&he.warn("cookieStore warning: large cookie, len="+c.length),Be.cookie=c,c}catch{return}},remove:function(t,e){try{Xc.set(t,"",-1,e)}catch{return}}},w4=null,zr={is_supported:function(){if(!gu(w4))return w4;var t=!0;if(rt(ie))t=!1;else try{var e="__mplssupport__";zr.set(e,"xyz"),zr.get(e)!=='"xyz"'&&(t=!1),zr.remove(e)}catch{t=!1}return t||he.error("localStorage unsupported; falling back to cookie store"),w4=t,t},error:function(t){he.error("localStorage error: "+t)},get:function(t){try{return ie==null?void 0:ie.localStorage.getItem(t)}catch(e){zr.error(e)}return null},parse:function(t){try{return JSON.parse(zr.get(t))||{}}catch{}return null},set:function(t,e){try{ie==null||ie.localStorage.setItem(t,JSON.stringify(e))}catch(n){zr.error(n)}},remove:function(t){try{ie==null||ie.localStorage.removeItem(t)}catch(e){zr.error(e)}}},SFe=["distinct_id",Mw,A1,Dw],BS=De(De({},zr),{},{parse:function(t){try{var e={};try{e=Xc.parse(t)||{}}catch{}var n=es(e,JSON.parse(zr.get(t)||"{}"));return zr.set(t,n),n}catch{}return null},set:function(t,e,n,r,i,s){try{zr.set(t,e,void 0,void 0,s);var o={};SFe.forEach(function(a){e[a]&&(o[a]=e[a])}),Object.keys(o).length&&Xc.set(t,o,n,r,i,s)}catch(a){zr.error(a)}},remove:function(t,e){try{ie==null||ie.localStorage.removeItem(t),Xc.remove(t,e)}catch(n){zr.error(n)}}}),HS={},EFe={is_supported:function(){return!0},error:function(t){he.error("memoryStorage error: "+t)},get:function(t){return HS[t]||null},parse:function(t){return HS[t]||null},set:function(t,e){HS[t]=e},remove:function(t){delete HS[t]}},Uf=null,Ei={is_supported:function(){if(!gu(Uf))return Uf;if(Uf=!0,rt(ie))Uf=!1;else try{var t="__support__";Ei.set(t,"xyz"),Ei.get(t)!=='"xyz"'&&(Uf=!1),Ei.remove(t)}catch{Uf=!1}return Uf},error:function(t){he.error("sessionStorage error: ",t)},get:function(t){try{return ie==null?void 0:ie.sessionStorage.getItem(t)}catch(e){Ei.error(e)}return null},parse:function(t){try{return JSON.parse(Ei.get(t))||null}catch{}return null},set:function(t,e){try{ie==null||ie.sessionStorage.setItem(t,JSON.stringify(e))}catch(n){Ei.error(n)}},remove:function(t){try{ie==null||ie.sessionStorage.removeItem(t)}catch(e){Ei.error(e)}}},wFe=["localhost","127.0.0.1"],O1=function(t){var e=Be==null?void 0:Be.createElement("a");return rt(e)?null:(e.href=t,e)},Fw=function(t,e){return!!function(n){try{new RegExp(n)}catch{return!1}return!0}(e)&&new RegExp(e).test(t)},CFe=function(t){var e,n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"&",i=[];return Sn(t,function(s,o){rt(s)||rt(o)||o==="undefined"||(e=encodeURIComponent(function(a){return a instanceof File}(s)?s.name:s.toString()),n=encodeURIComponent(o),i[i.length]=n+"="+e)}),i.join(r)},CH=function(t,e){for(var n,r=((t.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var s=r[i].split("=");if(s[0]===e){n=s;break}}if(!Xr(n)||n.length<2)return"";var o=n[1];try{o=decodeURIComponent(o)}catch{he.error("Skipping decoding for malformed query param: "+o)}return o.replace(/\+/g," ")},Uw=function(t,e){var n=t.match(new RegExp(e+"=([^&]*)"));return n?n[1]:null},zo="Mobile",jw="iOS",Ml="Android",wy="Tablet",cie=Ml+" "+wy,uie="iPad",die="Apple",fie=die+" Watch",Cy="Safari",Tg="BlackBerry",hie="Samsung",pie=hie+"Browser",mie=hie+" Internet",Pd="Chrome",TFe=Pd+" OS",gie=Pd+" "+jw,f8="Internet Explorer",vie=f8+" "+zo,h8="Opera",RFe=h8+" Mini",p8="Edge",yie="Microsoft "+p8,qm="Firefox",_ie=qm+" "+jw,Ty="Nintendo",Ry="PlayStation",Km="Xbox",bie=Ml+" "+zo,Sie=zo+" "+Cy,s1="Windows",C5=s1+" Phone",TH="Nokia",T5="Ouya",Eie="Generic",IFe=Eie+" "+zo.toLowerCase(),wie=Eie+" "+wy.toLowerCase(),R5="Konqueror",Yi="(\\d+(\\.\\d+)?)",C4=new RegExp("Version/"+Yi),kFe=new RegExp(Km,"i"),xFe=new RegExp(Ry+" \\w+","i"),PFe=new RegExp(Ty+" \\w+","i"),m8=new RegExp(Tg+"|PlayBook|BB10","i"),LFe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},AFe=function(t,e){return e&&Lt(e,die)||function(n){return Lt(n,Cy)&&!Lt(n,Pd)&&!Lt(n,Ml)}(t)},RH=function(t,e){return e=e||"",Lt(t," OPR/")&&Lt(t,"Mini")?RFe:Lt(t," OPR/")?h8:m8.test(t)?Tg:Lt(t,"IE"+zo)||Lt(t,"WPDesktop")?vie:Lt(t,pie)?mie:Lt(t,p8)||Lt(t,"Edg/")?yie:Lt(t,"FBIOS")?"Facebook "+zo:Lt(t,"UCWEB")||Lt(t,"UCBrowser")?"UC Browser":Lt(t,"CriOS")?gie:Lt(t,"CrMo")?Pd:Lt(t,Ml)&&Lt(t,Cy)?bie:Lt(t,Pd)?Pd:Lt(t,"FxiOS")?_ie:Lt(t.toLowerCase(),R5.toLowerCase())?R5:AFe(t,e)?Lt(t,zo)?Sie:Cy:Lt(t,qm)?qm:Lt(t,"MSIE")||Lt(t,"Trident/")?f8:Lt(t,"Gecko")?qm:""},OFe=(de(yi={},vie,[new RegExp("rv:"+Yi)]),de(yi,yie,[new RegExp(p8+"?\\/"+Yi)]),de(yi,Pd,[new RegExp("("+Pd+"|CrMo)\\/"+Yi)]),de(yi,gie,[new RegExp("CriOS\\/"+Yi)]),de(yi,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+Yi)]),de(yi,Cy,[C4]),de(yi,Sie,[C4]),de(yi,h8,[new RegExp("(Opera|OPR)\\/"+Yi)]),de(yi,qm,[new RegExp(qm+"\\/"+Yi)]),de(yi,_ie,[new RegExp("FxiOS\\/"+Yi)]),de(yi,R5,[new RegExp("Konqueror[:/]?"+Yi,"i")]),de(yi,Tg,[new RegExp(Tg+" "+Yi),C4]),de(yi,bie,[new RegExp("android\\s"+Yi,"i")]),de(yi,mie,[new RegExp(pie+"\\/"+Yi)]),de(yi,f8,[new RegExp("(rv:|MSIE )"+Yi)]),de(yi,"Mozilla",[new RegExp("rv:"+Yi)]),yi),IH=[[new RegExp(Km+"; "+Km+" (.*?)[);]","i"),function(t){return[Km,t&&t[1]||""]}],[new RegExp(Ty,"i"),[Ty,""]],[new RegExp(Ry,"i"),[Ry,""]],[m8,[Tg,""]],[new RegExp(s1,"i"),function(t,e){if(/Phone/.test(e)||/WPDesktop/.test(e))return[C5,""];if(new RegExp(zo).test(e)&&!/IEMobile\b/.test(e))return[s1+" "+zo,""];var n=/Windows NT ([0-9.]+)/i.exec(e);if(n&&n[1]){var r=n[1],i=LFe[r]||"";return/arm/i.test(e)&&(i="RT"),[s1,i]}return[s1,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(t){if(t&&t[3]){var e=[t[3],t[4],t[5]||"0"];return[jw,e.join(".")]}return[jw,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(t){var e="";return t&&t.length>=3&&(e=rt(t[2])?t[3]:t[2]),["watchOS",e]}],[new RegExp("("+Ml+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+Ml+")","i"),function(t){if(t&&t[2]){var e=[t[2],t[3],t[4]||"0"];return[Ml,e.join(".")]}return[Ml,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(t){var e=["Mac OS X",""];if(t&&t[1]){var n=[t[1],t[2],t[3]||"0"];e[1]=n.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[TFe,""]],[/Linux|debian/i,["Linux",""]]],kH=function(t){return PFe.test(t)?Ty:xFe.test(t)?Ry:kFe.test(t)?Km:new RegExp(T5,"i").test(t)?T5:new RegExp("("+C5+"|WPDesktop)","i").test(t)?C5:/iPad/.test(t)?uie:/iPod/.test(t)?"iPod Touch":/iPhone/.test(t)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(t)?fie:m8.test(t)?Tg:/(kobo)\s(ereader|touch)/i.test(t)?"Kobo":new RegExp(TH,"i").test(t)?TH:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(t)||/(kf[a-z]+)( bui|\)).+silk\//i.test(t)?"Kindle Fire":/(Android|ZTE)/i.test(t)?!new RegExp(zo).test(t)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(t)?/pixel[\daxl ]{1,6}/i.test(t)&&!/pixel c/i.test(t)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(t)||/lmy47v/i.test(t)&&!/QTAQZ3/i.test(t)?Ml:cie:Ml:new RegExp("(pda|"+zo+")","i").test(t)?IFe:new RegExp(wy,"i").test(t)&&!new RegExp(wy+" pc","i").test(t)?wie:""},VS="https?://(.*)",MFe=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],li={campaignParams:function(t){return Be?this._campaignParamsFromUrl(Be.URL,t):{}},_campaignParamsFromUrl:function(t,e){var n=MFe.concat(e||[]),r={};return Sn(n,function(i){var s=CH(t,i);s&&(r[i]=s)}),r},_searchEngine:function(t){return t?t.search(VS+"google.([^/?]*)")===0?"google":t.search(VS+"bing.com")===0?"bing":t.search(VS+"yahoo.com")===0?"yahoo":t.search(VS+"duckduckgo.com")===0?"duckduckgo":null:null},_searchInfoFromReferrer:function(t){var e=li._searchEngine(t),n=e!="yahoo"?"q":"p",r={};if(!gu(e)){r.$search_engine=e;var i=Be?CH(Be.referrer,n):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var t=Be==null?void 0:Be.referrer;return t?this._searchInfoFromReferrer(t):{}},browser:RH,browserVersion:function(t,e){var n=RH(t,e),r=OFe[n];if(rt(r))return null;for(var i=0;i<r.length;i++){var s=r[i],o=t.match(s);if(o)return parseFloat(o[o.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(t){for(var e=0;e<IH.length;e++){var n=Qi(IH[e],2),r=n[0],i=n[1],s=r.exec(t),o=s&&(Ho(i)?i(s,t):i);if(o)return o}return["",""]},device:kH,deviceType:function(t){var e=kH(t);return e===uie||e===cie||e==="Kobo"||e==="Kindle Fire"||e===wie?wy:e===Ty||e===Km||e===Ry||e===T5?"Console":e===fie?"Wearable":e?zo:"Desktop"},referrer:function(){return(Be==null?void 0:Be.referrer)||"$direct"},referringDomain:function(){var t;return Be!=null&&Be.referrer&&((t=O1(Be.referrer))===null||t===void 0?void 0:t.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:Ss==null?void 0:Ss.href}},initialPersonPropsFromInfo:function(t){var e,n=t.r,r=t.u,i={$initial_referrer:n,$initial_referring_domain:n==null?void 0:n=="$direct"?"$direct":(e=O1(n))===null||e===void 0?void 0:e.host};if(r){i.$initial_current_url=r;var s=O1(r);i.$initial_host=s==null?void 0:s.host,i.$initial_pathname=s==null?void 0:s.pathname,Sn(this._campaignParamsFromUrl(r),function(o,a){i["$initial_"+p5(a)]=o})}return n&&Sn(this._searchInfoFromReferrer(n),function(o,a){i["$initial_"+p5(a)]=o}),i},properties:function(){if(!ai)return{};var t=Qi(li.os(ai),2),e=t[0],n=t[1];return es(h5({$os:e,$os_version:n,$browser:li.browser(ai,navigator.vendor),$device:li.device(ai),$device_type:li.deviceType(ai)}),{$current_url:Ss==null?void 0:Ss.href,$host:Ss==null?void 0:Ss.host,$pathname:Ss==null?void 0:Ss.pathname,$raw_user_agent:ai.length>1e3?ai.substring(0,997)+"...":ai,$browser_version:li.browserVersion(ai,navigator.vendor),$browser_language:li.browserLanguage(),$screen_height:ie==null?void 0:ie.screen.height,$screen_width:ie==null?void 0:ie.screen.width,$viewport_height:ie==null?void 0:ie.innerHeight,$viewport_width:ie==null?void 0:ie.innerWidth,$lib:"web",$lib_version:Oo.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:sie()/1e3})},people_properties:function(){if(!ai)return{};var t=Qi(li.os(ai),2),e=t[0],n=t[1];return es(h5({$os:e,$os_version:n,$browser:li.browser(ai,navigator.vendor)}),{$browser_version:li.browserVersion(ai,navigator.vendor)})}},NFe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],T4=function(){function t(e){Xt(this,t),this.config=e,this.props={},this.campaign_params_saved=!1,this.name=function(n){var r="";return n.token&&(r=n.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),n.persistence_name?"ph_"+n.persistence_name:"ph_"+r+"_posthog"}(e),this.storage=this.buildStorage(e),this.load(),e.debug&&he.info("Persistence loaded",e.persistence,De({},this.props)),this.update_config(e,e),this.save()}return Jt(t,[{key:"buildStorage",value:function(e){NFe.indexOf(e.persistence.toLowerCase())===-1&&(he.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var n=e.persistence.toLowerCase();return n==="localstorage"&&zr.is_supported()?zr:n==="localstorage+cookie"&&BS.is_supported()?BS:n==="sessionstorage"&&Ei.is_supported()?Ei:n==="memory"?EFe:n==="cookie"?Xc:BS.is_supported()?BS:Xc}},{key:"properties",value:function(){var e={};return Sn(this.props,function(n,r){if(r===_m&&wi(n))for(var i=Object.keys(n),s=0;s<i.length;s++)e["$feature/".concat(i[s])]=n[i[s]];else a=r,l=!1,(gu(o=fFe)?l:oH&&o.indexOf===oH?o.indexOf(a)!=-1:(Sn(o,function(c){if(l||(l=c===a))return Ow}),l))||(e[r]=n);var o,a,l}),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=es({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,n,r){var i=this;if(wi(e)){rt(n)&&(n="None"),this.expire_days=rt(r)?this.default_expiry:r;var s=!1;if(Sn(e,function(o,a){i.props.hasOwnProperty(a)&&i.props[a]!==n||(i.props[a]=o,s=!0)}),s)return this.save(),!0}return!1}},{key:"register",value:function(e,n){var r=this;if(wi(e)){this.expire_days=rt(n)?this.default_expiry:n;var i=!1;if(Sn(e,function(s,o){e.hasOwnProperty(o)&&r.props[o]!==s&&(r.props[o]=s,i=!0)}),i)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(li.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(li.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(li.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[S5]||this.props[E5]||this.register_once(de({},_H,li.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return h5({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,n={};Sn([E5,S5],function(s){var o=e.props[s];o&&Sn(o,function(a,l){n["$initial_"+p5(l)]=a})});var r=this.props[_H];if(r){var i=li.initialPersonPropsFromInfo(r);es(n,i)}return n}},{key:"safe_merge",value:function(e){return Sn(this.props,function(n,r){r in e||(e[r]=n)}),e}},{key:"update_config",value:function(e,n){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==n.persistence){var r=this.buildStorage(e),i=this.props;this.clear(),this.storage=r,this.props=i,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,n){var r=this.props[i1]||{};r[e]=n,this.props[i1]=r,this.save()}},{key:"remove_event_timer",value:function(e){var n=(this.props[i1]||{})[e];return rt(n)||(delete this.props[i1][e],this.save()),n}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,n){this.props[e]=n,this.save()}}]),t}();function I5(t){return JSON.stringify(t,(e=[],function(n,r){if(wi(r)){for(;e.length>0&&e.at(-1)!==this;)e.pop();return e.includes(r)?"[Circular]":(e.push(r),r)}return r})).length;var e}var DFe=2,FFe=4;function k5(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:66060288e-1;if(t.size>=e&&t.data.length>1){var n=Math.floor(t.data.length/2),r=t.data.slice(0,n),i=t.data.slice(n);return[k5({size:I5(r),data:r,sessionId:t.sessionId,windowId:t.windowId}),k5({size:I5(i),data:i,sessionId:t.sessionId,windowId:t.windowId})].flatMap(function(s){return s})}return[t]}var gE=function(t){return t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t}(gE||{}),vc=function(t){return t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t}(vc||{});function g8(t){return t?AT(t).split(/\s+/):[]}function xH(t){var e=ie==null?void 0:ie.location.href;return!!(e&&t&&t.some(function(n){return e.match(n)}))}function $w(t){var e="";switch(Ey(t.className)){case"string":e=t.className;break;case"object":e=(t.className&&"baseVal"in t.className?t.className.baseVal:null)||t.getAttribute("class")||"";break;default:e=""}return g8(e)}function Cie(t){return Ms(t)?null:AT(t).split(/(\s+)/).filter(function(e){return Wm(e)}).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function Bw(t){var e="";return P5(t)&&!kie(t)&&t.childNodes&&t.childNodes.length&&Sn(t.childNodes,function(n){var r;Tie(n)&&n.textContent&&(e+=(r=Cie(n.textContent))!==null&&r!==void 0?r:"")}),AT(e)}function v8(t){return!!t&&t.nodeType===1}function Ld(t,e){return!!t&&!!t.tagName&&t.tagName.toLowerCase()===e.toLowerCase()}function Tie(t){return!!t&&t.nodeType===3}function Rie(t){return!!t&&t.nodeType===11}var x5=["a","button","form","input","select","textarea","label"];function Iie(t){var e=t.parentNode;return!(!e||!v8(e))&&e}function UFe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!ie||!t||Ld(t,"html")||!v8(t)||n!=null&&n.url_allowlist&&!xH(n.url_allowlist)||n!=null&&n.url_ignorelist&&xH(n.url_ignorelist))return!1;if(n!=null&&n.dom_event_allowlist){var s=n.dom_event_allowlist;if(s&&!s.some(function(m){return e.type===m}))return!1}for(var o=!1,a=[t],l=!0,c=t;c.parentNode&&!Ld(c,"body");)if(Rie(c.parentNode))a.push(c.parentNode.host),c=c.parentNode.host;else{if(!(l=Iie(c)))break;if(r||x5.indexOf(l.tagName.toLowerCase())>-1)o=!0;else{var u=ie.getComputedStyle(l);u&&u.getPropertyValue("cursor")==="pointer"&&(o=!0)}a.push(l),c=l}if(!function(m,v){var g=v==null?void 0:v.element_allowlist;if(rt(g))return!0;var S,b=Qo(m);try{var w=function(){var T=S.value;if(g.some(function(I){return T.tagName.toLowerCase()===I}))return{v:!0}};for(b.s();!(S=b.n()).done;){var k=w();if(Ey(k)==="object")return k.v}}catch(T){b.e(T)}finally{b.f()}return!1}(a,n)||!function(m,v){var g=v==null?void 0:v.css_selector_allowlist;if(rt(g))return!0;var S,b=Qo(m);try{var w=function(){var T=S.value;if(g.some(function(I){return T.matches(I)}))return{v:!0}};for(b.s();!(S=b.n()).done;){var k=w();if(Ey(k)==="object")return k.v}}catch(T){b.e(T)}finally{b.f()}return!1}(a,n))return!1;var f=ie.getComputedStyle(t);if(f&&f.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var p=t.tagName.toLowerCase();switch(p){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return o?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(x5.indexOf(p)>-1||t.getAttribute("contenteditable")==="true")}}function P5(t){for(var e=t;e.parentNode&&!Ld(e,"body");e=e.parentNode){var n=$w(e);if(Lt(n,"ph-sensitive")||Lt(n,"ph-no-capture"))return!1}if(Lt($w(t),"ph-include"))return!0;var r=t.type||"";if(Hi(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=t.name||t.id||"";return!(Hi(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function kie(t){return!!(Ld(t,"input")&&!["button","checkbox","submit","reset"].includes(t.type)||Ld(t,"select")||Ld(t,"textarea")||t.getAttribute("contenteditable")==="true")}var xie="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",jFe=new RegExp("^(?:".concat(xie,")$")),$Fe=new RegExp(xie),Pie="\\d{3}-?\\d{2}-?\\d{4}",BFe=new RegExp("^(".concat(Pie,")$")),HFe=new RegExp("(".concat(Pie,")"));function Wm(t){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!(Ms(t)||Hi(t)&&(t=AT(t),(e?jFe:$Fe).test((t||"").replace(/[- ]/g,""))||(e?BFe:HFe).test(t)))}function PH(t){var e=Bw(t);return Wm(e="".concat(e," ").concat(Lie(t)).trim())?e:""}function Lie(t){var e="";return t&&t.childNodes&&t.childNodes.length&&Sn(t.childNodes,function(n){var r;if(n&&((r=n.tagName)===null||r===void 0?void 0:r.toLowerCase())==="span")try{var i=Bw(n);e="".concat(e," ").concat(i).trim(),n.childNodes&&n.childNodes.length&&(e="".concat(e," ").concat(Lie(n)).trim())}catch(s){he.error(s)}}),e}function VFe(t){return function(e){var n=e.map(function(r){var i,s,o="";if(r.tag_name&&(o+=r.tag_name),r.attr_class){r.attr_class.sort();var a,l=Qo(r.attr_class);try{for(l.s();!(a=l.n()).done;){var c=a.value;o+=".".concat(c.replace(/"/g,""))}}catch(p){l.e(p)}finally{l.f()}}var u=De(De(De(De({},r.text?{text:r.text}:{}),{},{"nth-child":(i=r.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(s=r.nth_of_type)!==null&&s!==void 0?s:0},r.href?{href:r.href}:{}),r.attr_id?{attr_id:r.attr_id}:{}),r.attributes),f={};return mE(u).sort(function(p,m){var v=Qi(p,1)[0],g=Qi(m,1)[0];return v.localeCompare(g)}).forEach(function(p){var m=Qi(p,2),v=m[0],g=m[1];return f[LH(v.toString())]=LH(g.toString())}),o+=":",o+=mE(u).map(function(p){var m=Qi(p,2),v=m[0],g=m[1];return"".concat(v,'="').concat(g,'"')}).join("")});return n.join(";")}(function(e){return e.map(function(n){var r,i,s={text:(r=n.$el_text)===null||r===void 0?void 0:r.slice(0,400),tag_name:n.tag_name,href:(i=n.attr__href)===null||i===void 0?void 0:i.slice(0,2048),attr_class:GFe(n),attr_id:n.attr__id,nth_child:n.nth_child,nth_of_type:n.nth_of_type,attributes:{}};return mE(n).filter(function(o){return Qi(o,1)[0].indexOf("attr__")===0}).forEach(function(o){var a=Qi(o,2),l=a[0],c=a[1];return s.attributes[l]=c}),s})}(t))}function LH(t){return t.replace(/"|\\"/g,'\\"')}function GFe(t){var e=t.attr__class;return e?Xr(e)?e:g8(e):void 0}var L5="[SessionRecording]",A5="redacted",GS={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(t){return t},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},qFe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],KFe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],WFe=["/s/","/e/","/i/"];function AH(t,e,n,r){if(Ms(t))return t;var i=(e==null?void 0:e["content-length"])||function(s){return new Blob([s]).size}(t);return Hi(i)&&(i=parseInt(i)),i>n?L5+" ".concat(r," body too large to record (").concat(i," bytes)"):t}function OH(t,e){if(Ms(t))return t;var n=t;return Wm(n,!1)||(n=L5+" "+e+" body "+A5),Sn(KFe,function(r){var i,s;(i=n)!==null&&i!==void 0&&i.length&&((s=n)===null||s===void 0?void 0:s.indexOf(r))!==-1&&(n=L5+" "+e+" body "+A5+" as might contain: "+r)}),n}var Tc,zFe=function(t,e){var n,r,i,s={payloadSizeLimitBytes:GS.payloadSizeLimitBytes,performanceEntryTypeToObserve:Yc(GS.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(Yc(e.payloadHostDenyList||[]),Yc(GS.payloadHostDenyList))},o=t.session_recording.recordHeaders!==!1&&e.recordHeaders,a=t.session_recording.recordBody!==!1&&e.recordBody,l=t.capture_performance!==!1&&e.recordPerformance,c=(n=s,i=Math.min(1e6,(r=n.payloadSizeLimitBytes)!==null&&r!==void 0?r:1e6),function(p){return p!=null&&p.requestBody&&(p.requestBody=AH(p.requestBody,p.requestHeaders,i,"Request")),p!=null&&p.responseBody&&(p.responseBody=AH(p.responseBody,p.responseHeaders,i,"Response")),p}),u=function(p){return c(function(g){var S=O1(g.name);if(!(S&&S.pathname&&WFe.some(function(b){return S.pathname.indexOf(b)===0})))return g}((v=(m=p).requestHeaders,Ms(v)||Sn(Object.keys(v??{}),function(g){qFe.includes(g.toLowerCase())&&(v[g]=A5)}),m)));var m,v},f=Ho(t.session_recording.maskNetworkRequestFn);return f&&Ho(t.session_recording.maskCapturedNetworkRequestFn)&&he.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),f&&(t.session_recording.maskCapturedNetworkRequestFn=function(p){var m=t.session_recording.maskNetworkRequestFn({url:p.name});return De(De({},p),{},{name:m==null?void 0:m.url})}),s.maskRequestFn=Ho(t.session_recording.maskCapturedNetworkRequestFn)?function(p){var m,v,g,S=u(p);return S&&(m=(v=(g=t.session_recording).maskCapturedNetworkRequestFn)===null||v===void 0?void 0:v.call(g,S))!==null&&m!==void 0?m:void 0}:function(p){return function(m){if(!rt(m))return m.requestBody=OH(m.requestBody,"Request"),m.responseBody=OH(m.responseBody,"Response"),m}(u(p))},De(De(De({},GS),s),{},{recordHeaders:o,recordBody:a,recordPerformance:l,recordInitialRequests:l})},YFe=Jt(function t(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xt(this,t),de(this,"bucketSize",100),de(this,"refillRate",10),de(this,"mutationBuckets",{}),de(this,"loggedTracker",{}),de(this,"refillBuckets",function(){Object.keys(i.mutationBuckets).forEach(function(o){i.mutationBuckets[o]=i.mutationBuckets[o]+i.refillRate,i.mutationBuckets[o]>=i.bucketSize&&delete i.mutationBuckets[o]})}),de(this,"getNodeOrRelevantParent",function(o){var a=i.rrweb.mirror.getNode(o);if((a==null?void 0:a.nodeName)!=="svg"&&a instanceof Element){var l=a.closest("svg");if(l)return[i.rrweb.mirror.getId(l),l]}return[o,a]}),de(this,"numberOfChanges",function(o){var a,l,c,u,f,p,m,v;return((a=(l=o.removes)===null||l===void 0?void 0:l.length)!==null&&a!==void 0?a:0)+((c=(u=o.attributes)===null||u===void 0?void 0:u.length)!==null&&c!==void 0?c:0)+((f=(p=o.texts)===null||p===void 0?void 0:p.length)!==null&&f!==void 0?f:0)+((m=(v=o.adds)===null||v===void 0?void 0:v.length)!==null&&m!==void 0?m:0)}),de(this,"throttleMutations",function(o){if(o.type!==3||o.data.source!==0)return o;var a=o.data,l=i.numberOfChanges(a);a.attributes&&(a.attributes=a.attributes.filter(function(u){var f,p,m,v=Qi(i.getNodeOrRelevantParent(u.id),2),g=v[0],S=v[1];return i.mutationBuckets[g]===0?!1:(i.mutationBuckets[g]=(f=i.mutationBuckets[g])!==null&&f!==void 0?f:i.bucketSize,i.mutationBuckets[g]=Math.max(i.mutationBuckets[g]-1,0),i.mutationBuckets[g]===0&&(i.loggedTracker[g]||(i.loggedTracker[g]=!0,(p=(m=i.options).onBlockedNode)===null||p===void 0||p.call(m,g,S))),u)}));var c=i.numberOfChanges(a);return c!==0||l===c?o:void 0}),this.rrweb=e,this.options=s,this.refillRate=(n=this.options.refillRate)!==null&&n!==void 0?n:this.refillRate,this.bucketSize=(r=this.options.bucketSize)!==null&&r!==void 0?r:this.bucketSize,setInterval(function(){i.refillBuckets()},1e3)}),XFe=3e5,JFe=[vc.MouseMove,vc.MouseInteraction,vc.Scroll,vc.ViewportResize,vc.Input,vc.TouchMove,vc.MediaInteraction,vc.Drag],MH=function(t){return{rrwebMethod:t,enqueuedAt:Date.now(),attempt:1}},Io="[SessionRecording]",ZFe=function(){function t(e){var n=this;if(Xt(this,t),de(this,"queuedRRWebEvents",[]),de(this,"isIdle",!1),de(this,"_linkedFlagSeen",!1),de(this,"_lastActivityTimestamp",Date.now()),de(this,"_linkedFlag",null),de(this,"_forceAllowLocalhostNetworkCapture",!1),de(this,"_onBeforeUnload",function(){n._flushBuffer()}),de(this,"_onOffline",function(){n._tryAddCustomEvent("browser offline",{})}),de(this,"_onOnline",function(){n._tryAddCustomEvent("browser online",{})}),de(this,"_onVisibilityChange",function(){if(Be!=null&&Be.visibilityState){var o="window "+Be.visibilityState;n._tryAddCustomEvent(o,{})}}),de(this,"_samplingSessionListener",null),this.instance=e,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw he.error(Io+" started without valid sessionManager"),new Error(Io+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,s=r.windowId;this.sessionId=i,this.windowId=s,this.buffer=this.clearBuffer(),this._setupSampling()}return Jt(t,[{key:"rrwebRecord",get:function(){var e;return qn==null||(e=qn.rrweb)===null||e===void 0?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(Io+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return((e=this.instance.config.session_recording)===null||e===void 0?void 0:e.full_snapshot_interval_millis)||XFe}},{key:"isSampled",get:function(){var e=this.instance.get_property(A1);return ih(e)?e:null}},{key:"sessionDuration",get:function(){var e,n,r=(e=this.buffer)===null||e===void 0?void 0:e.data[((n=this.buffer)===null||n===void 0?void 0:n.data.length)-1],i=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return r?r.timestamp-i:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(g5),n=!this.instance.config.disable_session_recording;return ie&&e&&n}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(pH),n=this.instance.config.enable_recording_console_log;return n??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(gH);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,n,r=this.instance.get_property(mH),i={recordHeaders:(e=this.instance.config.session_recording)===null||e===void 0?void 0:e.recordHeaders,recordBody:(n=this.instance.config.session_recording)===null||n===void 0?void 0:n.recordBody},s=(i==null?void 0:i.recordHeaders)||(r==null?void 0:r.recordHeaders),o=(i==null?void 0:i.recordBody)||(r==null?void 0:r.recordBody),a=wi(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,l=!!(ih(a)?a:r!=null&&r.capturePerformance);return s||o||l?{recordHeaders:s,recordBody:o,recordPerformance:l}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(vH);return Mo(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(yH);return Mo(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?Ms(this._linkedFlag)||this._linkedFlagSeen?ih(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),ie==null||ie.addEventListener("beforeunload",this._onBeforeUnload),ie==null||ie.addEventListener("offline",this._onOffline),ie==null||ie.addEventListener("online",this._onOnline),ie==null||ie.addEventListener("visibilitychange",this._onVisibilityChange),he.info(Io+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,ie==null||ie.removeEventListener("beforeunload",this._onBeforeUnload),ie==null||ie.removeEventListener("offline",this._onOffline),ie==null||ie.removeEventListener("online",this._onOnline),ie==null||ie.removeEventListener("visibilitychange",this._onVisibilityChange),he.info(Io+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var n,r=this.sessionId!==e,i=this.sampleRate;if(Mo(i)){var s,o=this.isSampled,a=r||!ih(o);a?s=Math.random()<i:s=o,!s&&a&&he.warn(Io+" Sample rate (".concat(i,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:i}),(n=this.instance.persistence)===null||n===void 0||n.register(de({},A1,s))}else{var l;(l=this.instance.persistence)===null||l===void 0||l.register(de({},A1,null))}}},{key:"afterDecideResponse",value:function(e){var n,r,i,s=this;if(this._persistDecideResponse(e),this._linkedFlag=((n=e.sessionRecording)===null||n===void 0?void 0:n.linkedFlag)||null,(r=e.sessionRecording)!==null&&r!==void 0&&r.endpoint&&(this._endpoint=(i=e.sessionRecording)===null||i===void 0?void 0:i.endpoint),this._setupSampling(),!Ms(this._linkedFlag)&&!this._linkedFlagSeen){var o=Hi(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,a=Hi(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags(function(l,c){var u=wi(c)&&o in c,f=a?c[o]===a:u;if(f){var p={linkedFlag:o,linkedVariant:a},m="linked flag matched";he.info(Io+" "+m,p),s._tryAddCustomEvent(m,p)}s._linkedFlagSeen=f})}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;Mo(this.sampleRate)&&gu(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId(function(n){e.makeSamplingDecision(n)}))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var n=this.instance.persistence,r=function(){var i,s,o,a,l,c,u,f,p=(i=e.sessionRecording)===null||i===void 0?void 0:i.sampleRate,m=Ms(p)?null:parseFloat(p),v=(s=e.sessionRecording)===null||s===void 0?void 0:s.minimumDurationMilliseconds;n.register((de(f={},g5,!!e.sessionRecording),de(f,pH,(o=e.sessionRecording)===null||o===void 0?void 0:o.consoleLogRecordingEnabled),de(f,mH,De({capturePerformance:e.capturePerformance},(a=e.sessionRecording)===null||a===void 0?void 0:a.networkPayloadCapture)),de(f,gH,{enabled:(l=e.sessionRecording)===null||l===void 0?void 0:l.recordCanvas,fps:(c=e.sessionRecording)===null||c===void 0?void 0:c.canvasFps,quality:(u=e.sessionRecording)===null||u===void 0?void 0:u.canvasQuality}),de(f,vH,m),de(f,yH,rt(v)?null:v),f))};r(),this.sessionManager.onSessionId(r)}}},{key:"log",value:function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log";(n=this.instance.sessionRecording)===null||n===void 0||n.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:r,trace:[],payload:[JSON.stringify(e)]}},timestamp:sie()})}},{key:"_startCapture",value:function(){var e=this;rt(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(Oo.LIB_VERSION),function(n){if(n)return he.error(Io+" could not load recorder.js",n);e._onScriptLoaded()}))}},{key:"isInteractiveEvent",value:function(e){var n;return e.type===3&&JFe.indexOf((n=e.data)===null||n===void 0?void 0:n.source)!==-1}},{key:"_updateWindowAndSessionIds",value:function(e){var n=this.isInteractiveEvent(e);n||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var r=!1;if(n&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),r=!0)),!this.isIdle){var i=this.sessionManager.checkAndGetSessionAndWindowId(!n,e.timestamp),s=i.windowId,o=i.sessionId,a=this.sessionId!==o,l=this.windowId!==s;this.windowId=s,this.sessionId=o,(r||[DFe,FFe].indexOf(e.type)===-1&&(l||a||rt(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(n){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):he.warn(Io+" could not emit queued rrweb event.",n,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,n){var r=this;return this._tryRRWebMethod(MH(function(){return r.rrwebRecord.addCustomEvent(e,n)}))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(MH(function(){return e.rrwebRecord.takeFullSnapshot()}))}},{key:"_onScriptLoaded",value:function(){for(var e,n=this,r={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},i=this.instance.config.session_recording,s=0,o=Object.entries(i||{});s<o.length;s++){var a=Qi(o[s],2),l=a[0],c=a[1];l in r&&(l==="maskInputOptions"?r.maskInputOptions=De({password:!0},c):r[l]=c)}if(this.canvasRecording&&this.canvasRecording.enabled&&(r.recordCanvas=!0,r.sampling={canvas:this.canvasRecording.fps},r.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=(e=this.mutationRateLimiter)!==null&&e!==void 0?e:new YFe(this.rrwebRecord,{onBlockedNode:function(f,p){var m="Too many mutations on node '".concat(f,"'. Rate limiting. This could be due to SVG animations or something similar");he.info(m,{node:p}),n.log(Io+" "+m,"warn")}});var u=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(De({emit:function(f){n.onRRwebEmit(f)},plugins:u},r)),this.instance._addCaptureHook(function(f){try{if(f==="$pageview"){var p=ie?n._maskUrl(ie.location.href):"";if(!p)return;n._tryAddCustomEvent("$pageview",{href:p})}}catch(m){he.error("Could not add $pageview to rrweb session",m)}}),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:r,activePlugins:u.map(function(f){return f==null?void 0:f.name})}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else he.error(Io+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var n=this.fullSnapshotIntervalMillis;n&&(this._fullSnapshotTimer=setInterval(function(){e._tryTakeFullSnapshot()},n))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return qn.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(qn.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&Ho(qn.getRecordNetworkPlugin)&&(!wFe.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(qn.getRecordNetworkPlugin(zFe(this.instance.config,this.networkPayloadCapture))):he.info(Io+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&wi(e)){if(e.type===gE.Meta){var n=this._maskUrl(e.data.href);if(this._lastHref=n,!n)return;e.data.href=n}else this._pageViewFallBack();e.type===gE.FullSnapshot&&this._scheduleFullSnapshot();var r=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(r){var i=function(a){var l=a;if(l&&wi(l)&&l.type===6&&wi(l.data)&&l.data.plugin==="rrweb/console@1"){l.data.payload.payload.length>10&&(l.data.payload.payload=l.data.payload.payload.slice(0,10),l.data.payload.payload.push("...[truncated]"));for(var c=[],u=0;u<l.data.payload.payload.length;u++)l.data.payload.payload[u]&&l.data.payload.payload[u].length>2e3?c.push(l.data.payload.payload[u].slice(0,2e3)+"...[truncated]"):c.push(l.data.payload.payload[u]);return l.data.payload.payload=c,a}return a}(r),s=I5(i);if(this._updateWindowAndSessionIds(i),!this.isIdle||i.type===gE.Custom){var o={$snapshot_bytes:s,$snapshot_data:i,$session_id:this.sessionId,$window_id:this.windowId};this.status!=="disabled"?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&ie){var e=this._maskUrl(ie.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var n=Yc(this.queuedRRWebEvents);this.queuedRRWebEvents=[],n.forEach(function(r){Date.now()-r.enqueuedAt<=2e3&&e._tryRRWebMethod(r)})}}},{key:"_maskUrl",value:function(e){var n=this.instance.config.session_recording;if(n.maskNetworkRequestFn){var r,i={url:e};return(r=i=n.maskNetworkRequestFn(i))===null||r===void 0?void 0:r.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var n=this.minimumDuration,r=this.sessionDuration,i=Mo(r)&&r>=0,s=Mo(n)&&i&&r<n;return this.status==="buffering"||s?(this.flushBufferTimer=setTimeout(function(){e._flushBuffer()},2e3),this.buffer):(this.buffer.data.length>0&&k5(this.buffer).forEach(function(o){e._captureSnapshot({$snapshot_bytes:o.size,$snapshot_data:o.data,$session_id:o.sessionId,$window_id:o.windowId})}),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var n,r=this,i=2+(((n=this.buffer)===null||n===void 0?void 0:n.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+i>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout(function(){r._flushBuffer()},2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),t}(),QFe=function(){function t(e){Xt(this,t),this.instance=e,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return Jt(t,[{key:"call",value:function(){var e=this,n={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(bm),group_properties:this.instance.get_property(ad),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:n,compression:this.instance.config.disable_compression?void 0:Ua.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(r){return e.parseDecideResponse(r.json)}})}},{key:"parseDecideResponse",value:function(e){var n=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var r=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},r),r)he.error("Failed to fetch feature flags from PostHog.");else{if(!Be||!Be.body)return he.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(function(){n.parseDecideResponse(e)},500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var i,s=Qo(e.siteApps);try{var o=function(){var a=i.value,l=a.id,c=a.url,u=n.instance.requestRouter.endpointFor("api",c);qn["__$$ph_site_app_".concat(l)]=n.instance,n.instance.requestRouter.loadScript(u,function(f){if(f)return he.error("Error while initializing PostHog app with config id ".concat(l),f)})};for(s.s();!(i=s.n()).done;)o()}catch(a){s.e(a)}finally{s.f()}}else e.siteApps.length>0&&he.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),t}(),eUe=ie!=null&&ie.location?Uw(ie.location.hash,"__posthog")||Uw(location.hash,"state"):null,NH="_postHogToolbarParams";(function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"})(Tc||(Tc={}));var tUe=function(){function t(e){Xt(this,t),this.instance=e}return Jt(t,[{key:"setToolbarState",value:function(e){qn.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return(e=qn.ph_toolbar_state)!==null&&e!==void 0?e:Tc.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(!ie||!Be)return!1;r=(e=r)!==null&&e!==void 0?e:ie.location,s=(n=s)!==null&&n!==void 0?n:ie.history;try{if(!i){try{ie.localStorage.setItem("test","test"),ie.localStorage.removeItem("test")}catch{return!1}i=ie==null?void 0:ie.localStorage}var o,a=eUe||Uw(r.hash,"__posthog")||Uw(r.hash,"state"),l=a?cH(function(){return JSON.parse(atob(decodeURIComponent(a)))})||cH(function(){return JSON.parse(decodeURIComponent(a))}):null;return l&&l.action==="ph_authorize"?((o=l).source="url",o&&Object.keys(o).length>0&&(l.desiredHash?r.hash=l.desiredHash:s?s.replaceState(s.state,"",r.pathname+r.search):r.hash="")):((o=JSON.parse(i.getItem(NH)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token)&&(this.loadToolbar(o),!0)}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(qn.ph_load_toolbar||qn.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var n=this,r=!(Be==null||!Be.getElementById(w5));if(!ie||r)return!1;var i=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,s=De(De({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},i?{instrument:!1}:{});if(ie.localStorage.setItem(NH,JSON.stringify(De(De({},s),{},{source:void 0}))),this.getToolbarState()===Tc.LOADED)this._callLoadToolbar(s);else if(this.getToolbarState()===Tc.UNINITIALIZED){this.setToolbarState(Tc.LOADING);var o=3e5,a=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(a),function(l){if(l)return he.error("Failed to load toolbar",l),void n.setToolbarState(Tc.UNINITIALIZED);n.setToolbarState(Tc.LOADED),n._callLoadToolbar(s)}),Nc(ie,"turbolinks:load",function(){n.setToolbarState(Tc.UNINITIALIZED),n.loadToolbar(s)})}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return this.maybeLoadToolbar(e,n,r)}}]),t}(),nUe=function(){function t(e){Xt(this,t),de(this,"isPaused",!0),de(this,"queue",[]),de(this,"flushTimeoutMs",3e3),this.sendRequest=e}return Jt(t,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var n=this.queue.length>0?this.formatQueue():{},r=Object.values(n);[].concat(Yc(r.filter(function(i){return i.url.indexOf("/e")===0})),Yc(r.filter(function(i){return i.url.indexOf("/e")!==0}))).map(function(i){e.sendRequest(De(De({},i),{},{transport:"sendBeacon"}))})}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout(function(){if(e.clearFlushTimeout(),e.queue.length>0){var n=e.formatQueue(),r=function(s){var o=n[s],a=new Date().getTime();o.data&&Xr(o.data)&&Sn(o.data,function(l){l.offset=Math.abs(l.timestamp-a),delete l.timestamp}),e.sendRequest(o)};for(var i in n)r(i)}},this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return Sn(this.queue,function(n){var r,i=n,s=(i?i.batchKey:null)||i.url;rt(e[s])&&(e[s]=De(De({},i),{},{data:[]})),(r=e[s].data)===null||r===void 0||r.push(i.data)}),this.queue=[],e}}]),t}(),Yo=Uint8Array,Ps=Uint16Array,Rg=Uint32Array,y8=new Yo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_8=new Yo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),DH=new Yo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Aie=function(t,e){for(var n=new Ps(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new Rg(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},Oie=Aie(y8,2),rUe=Oie[0],O5=Oie[1];rUe[28]=258,O5[258]=28;for(var FH=Aie(_8,0)[1],Mie=new Ps(32768),Dn=0;Dn<32768;++Dn){var jf=(43690&Dn)>>>1|(21845&Dn)<<1;jf=(61680&(jf=(52428&jf)>>>2|(13107&jf)<<2))>>>4|(3855&jf)<<4,Mie[Dn]=((65280&jf)>>>8|(255&jf)<<8)>>>1}var M1=function(t,e,n){for(var r=t.length,i=0,s=new Ps(e);i<r;++i)++s[t[i]-1];var o,a=new Ps(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;for(o=new Ps(r),i=0;i<r;++i)o[i]=Mie[a[t[i]-1]++]>>>15-t[i];return o},Dh=new Yo(288);for(Dn=0;Dn<144;++Dn)Dh[Dn]=8;for(Dn=144;Dn<256;++Dn)Dh[Dn]=9;for(Dn=256;Dn<280;++Dn)Dh[Dn]=7;for(Dn=280;Dn<288;++Dn)Dh[Dn]=8;var Hw=new Yo(32);for(Dn=0;Dn<32;++Dn)Hw[Dn]=5;var iUe=M1(Dh,9),sUe=M1(Hw,5),Nie=function(t){return(t/8>>0)+(7&t&&1)},Die=function(t,e,n){(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof Ps?Ps:t instanceof Rg?Rg:Yo)(n-e);return r.set(t.subarray(e,n)),r},hc=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8},M0=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},R4=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,s=n.slice();if(!i)return[new Yo(0),0];if(i==1){var o=new Yo(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort(function(I,C){return I.f-C.f}),n.push({s:-1,f:25001});var a=n[0],l=n[1],c=0,u=1,f=2;for(n[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=n[n[c].f<n[f].f?c++:f++],l=n[c!=u&&n[c].f<n[f].f?c++:f++],n[u++]={s:-1,f:a.f+l.f,l:a,r:l};var p=s[0].s;for(r=1;r<i;++r)s[r].s>p&&(p=s[r].s);var m=new Ps(p+1),v=oUe(n[u-1],m,0);if(v>e){r=0;var g=0,S=v-e,b=1<<S;for(s.sort(function(I,C){return m[C.s]-m[I.s]||I.f-C.f});r<i;++r){var w=s[r].s;if(!(m[w]>e))break;g+=b-(1<<v-m[w]),m[w]=e}for(g>>>=S;g>0;){var k=s[r].s;m[k]<e?g-=1<<e-m[k]++-1:++r}for(;r>=0&&g;--r){var T=s[r].s;m[T]==e&&(--m[T],++g)}v=e}return[new Yo(m),v]},oUe=function t(e,n,r){return e.s==-1?Math.max(t(e.l,n,r+1),t(e.r,n,r+1)):n[e.s]=r},UH=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Ps(++e),r=0,i=t[0],s=1,o=function(l){n[r++]=l},a=1;a<=e;++a)if(t[a]==i&&a!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=t[a]}return[n.subarray(0,r),e]},N0=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},M5=function(t,e,n){var r=n.length,i=Nie(e+2);t[i]=255&r,t[i+1]=r>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<r;++s)t[i+s+4]=n[s];return 8*(i+4+r)},jH=function(t,e,n,r,i,s,o,a,l,c,u){hc(e,u++,n),++i[256];for(var f=R4(i,15),p=f[0],m=f[1],v=R4(s,15),g=v[0],S=v[1],b=UH(p),w=b[0],k=b[1],T=UH(g),I=T[0],C=T[1],x=new Ps(19),A=0;A<w.length;++A)x[31&w[A]]++;for(A=0;A<I.length;++A)x[31&I[A]]++;for(var N=R4(x,7),D=N[0],F=N[1],$=19;$>4&&!D[DH[$-1]];--$);var B,W,H,z,K=c+5<<3,V=N0(i,Dh)+N0(s,Hw)+o,q=N0(i,p)+N0(s,g)+o+14+3*$+N0(x,D)+(2*x[16]+3*x[17]+7*x[18]);if(K<=V&&K<=q)return M5(e,u,t.subarray(l,l+c));if(hc(e,u,1+(q<V)),u+=2,q<V){B=M1(p,m),W=p,H=M1(g,S),z=g;var Z=M1(D,F);for(hc(e,u,k-257),hc(e,u+5,C-1),hc(e,u+10,$-4),u+=14,A=0;A<$;++A)hc(e,u+3*A,D[DH[A]]);u+=3*$;for(var G=[w,I],Q=0;Q<2;++Q){var ge=G[Q];for(A=0;A<ge.length;++A){var _e=31&ge[A];hc(e,u,Z[_e]),u+=D[_e],_e>15&&(hc(e,u,ge[A]>>>5&127),u+=ge[A]>>>12)}}}else B=iUe,W=Dh,H=sUe,z=Hw;for(A=0;A<a;++A)if(r[A]>255){_e=r[A]>>>18&31,M0(e,u,B[_e+257]),u+=W[_e+257],_e>7&&(hc(e,u,r[A]>>>23&31),u+=y8[_e]);var Pe=31&r[A];M0(e,u,H[Pe]),u+=z[Pe],Pe>3&&(M0(e,u,r[A]>>>5&8191),u+=_8[Pe])}else M0(e,u,B[r[A]]),u+=W[r[A]];return M0(e,u,B[256]),u+W[256]},aUe=new Rg([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),lUe=function(){for(var t=new Rg(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),cUe=function(t,e,n,r,i){return function(s,o,a,l,c,u){var f=s.length,p=new Yo(l+f+5*(1+Math.floor(f/7e3))+c),m=p.subarray(l,p.length-c),v=0;if(!o||f<8)for(var g=0;g<=f;g+=65535){var S=g+65535;S<f?v=M5(m,v,s.subarray(g,S)):(m[g]=u,v=M5(m,v,s.subarray(g,f)))}else{for(var b=aUe[o-1],w=b>>>13,k=8191&b,T=(1<<a)-1,I=new Ps(32768),C=new Ps(T+1),x=Math.ceil(a/3),A=2*x,N=function(Ki){return(s[Ki]^s[Ki+1]<<x^s[Ki+2]<<A)&T},D=new Rg(25e3),F=new Ps(288),$=new Ps(32),B=0,W=0,H=(g=0,0),z=0,K=0;g<f;++g){var V=N(g),q=32767&g,Z=C[V];if(I[q]=Z,C[V]=q,z<=g){var G=f-g;if((B>7e3||H>24576)&&G>423){v=jH(s,m,0,D,F,$,W,H,K,g-K,v),H=B=W=0,K=g;for(var Q=0;Q<286;++Q)F[Q]=0;for(Q=0;Q<30;++Q)$[Q]=0}var ge=2,_e=0,Pe=k,Te=q-Z&32767;if(G>2&&V==N(g-Te))for(var Re=Math.min(w,G)-1,we=Math.min(32767,g),ve=Math.min(258,G);Te<=we&&--Pe&&q!=Z;){if(s[g+ge]==s[g+ge-Te]){for(var We=0;We<ve&&s[g+We]==s[g+We-Te];++We);if(We>ge){if(ge=We,_e=Te,We>Re)break;var pn=Math.min(Te,We-2),hr=0;for(Q=0;Q<pn;++Q){var Ft=g-Te+Q+32768&32767,ze=Ft-I[Ft]+32768&32767;ze>hr&&(hr=ze,Z=Ft)}}}Te+=(q=Z)-(Z=I[q])+32768&32767}if(_e){D[H++]=268435456|O5[ge]<<18|FH[_e];var Fr=31&O5[ge],Tr=31&FH[_e];W+=y8[Fr]+_8[Tr],++F[257+Fr],++$[Tr],z=g+ge,++B}else D[H++]=s[g],++F[s[g]]}}v=jH(s,m,u,D,F,$,W,H,K,g-K,v)}return Die(p,0,l+Nie(v)+c)}(t,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,r,!0)},I4=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function uUe(t,e){e===void 0&&(e={});var n=function(){var a=4294967295;return{p:function(l){for(var c=a,u=0;u<l.length;++u)c=lUe[255&c^l[u]]^c>>>8;a=c},d:function(){return 4294967295^a}}}(),r=t.length;n.p(t);var i,s=cUe(t,e,10+((i=e).filename&&i.filename.length+1||0),8),o=s.length;return function(a,l){var c=l.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=l.level<2?4:l.level==9?2:0,a[9]=3,l.mtime!=0&&I4(a,4,Math.floor(new Date(l.mtime||Date.now())/1e3)),c){a[3]=8;for(var u=0;u<=c.length;++u)a[u+10]=c.charCodeAt(u)}}(s,e),I4(s,o-8,n.d()),I4(s,o-4,r),s}var dUe=!!f5||!!d5,$H="text/plain",Vw=function(t,e){var n=Qi(t.split("?"),2),r=n[0],i=n[1],s=De({},e);i==null||i.split("&").forEach(function(a){var l=Qi(a.split("="),1)[0];delete s[l]});var o=CFe(s);return o=o?(i?i+"&":"")+o:i,"".concat(r,"?").concat(o)},fUe=function(t){return"data="+encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},k4=function(t){var e=t.data,n=t.compression;if(e){if(n===Ua.GZipJS){var r=uUe(function(s,o){var a=s.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(s);for(var l=new Yo(s.length+(s.length>>>1)),c=0,u=function(v){l[c++]=v},f=0;f<a;++f){if(c+5>l.length){var p=new Yo(c+8+(a-f<<1));p.set(l),l=p}var m=s.charCodeAt(f);m<128||o?u(m):m<2048?(u(192|m>>>6),u(128|63&m)):m>55295&&m<57344?(u(240|(m=65536+(1047552&m)|1023&s.charCodeAt(++f))>>>18),u(128|m>>>12&63),u(128|m>>>6&63),u(128|63&m)):(u(224|m>>>12),u(128|m>>>6&63),u(128|63&m))}return Die(l,0,c)}(JSON.stringify(e)),{mtime:0});return{contentType:$H,body:new Blob([r],{type:$H})}}if(n===Ua.Base64){var i=function(s){var o,a,l,c,u,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=0,m=0,v="",g=[];if(!s)return s;s=dFe(s);do o=(u=s.charCodeAt(p++)<<16|s.charCodeAt(p++)<<8|s.charCodeAt(p++))>>18&63,a=u>>12&63,l=u>>6&63,c=63&u,g[m++]=f.charAt(o)+f.charAt(a)+f.charAt(l)+f.charAt(c);while(p<s.length);switch(v=g.join(""),s.length%3){case 1:v=v.slice(0,-2)+"==";break;case 2:v=v.slice(0,-1)+"="}return v}(JSON.stringify(e));return{contentType:"application/x-www-form-urlencoded",body:fUe(i)}}return{contentType:"application/json",body:JSON.stringify(e)}}},N1=[];f5&&N1.push({transport:"XHR",method:function(t){var e,n=new f5;n.open(t.method||"GET",t.url,!0);var r=(e=k4(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body;Sn(t.headers,function(o,a){n.setRequestHeader(a,o)}),i&&n.setRequestHeader("Content-Type",i),t.timeout&&(n.timeout=t.timeout),n.withCredentials=!0,n.onreadystatechange=function(){if(n.readyState===4){var o,a={statusCode:n.status,text:n.responseText};if(n.status===200)try{a.json=JSON.parse(n.responseText)}catch{}(o=t.callback)===null||o===void 0||o.call(t,a)}},n.send(s)}}),d5&&N1.push({transport:"fetch",method:function(t){var e,n,r=(e=k4(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body,o=new Headers;Sn(t.headers,function(u,f){o.append(f,u)}),i&&o.append("Content-Type",i);var a=t.url,l=null;if(aH){var c=new aH;l={signal:c.signal,timeout:setTimeout(function(){return c.abort()},t.timeout)}}d5(a,{method:(t==null?void 0:t.method)||"GET",headers:o,keepalive:t.method==="POST",body:s,signal:(n=l)===null||n===void 0?void 0:n.signal}).then(function(u){return u.text().then(function(f){var p,m={statusCode:u.status,text:f};if(u.status===200)try{m.json=JSON.parse(f)}catch(v){he.error(v)}(p=t.callback)===null||p===void 0||p.call(t,m)})}).catch(function(u){var f;he.error(u),(f=t.callback)===null||f===void 0||f.call(t,{statusCode:0,text:u})}).finally(function(){return l?clearTimeout(l.timeout):null})}}),$a!=null&&$a.sendBeacon&&N1.push({transport:"sendBeacon",method:function(t){var e=Vw(t.url,{beacon:"1"});try{var n,r=(n=k4(t))!==null&&n!==void 0?n:{},i=r.contentType,s=r.body,o=typeof s=="string"?new Blob([s],{type:i}):s;$a.sendBeacon(e,o)}catch{}}});var hUe=["retriesPerformedSoFar"],sh,pUe=function(){function t(e){var n=this;Xt(this,t),de(this,"isPolling",!1),de(this,"pollIntervalMs",3e3),de(this,"queue",[]),this.instance=e,this.queue=[],this.areWeOnline=!0,!rt(ie)&&"onLine"in ie.navigator&&(this.areWeOnline=ie.navigator.onLine,ie.addEventListener("online",function(){n.areWeOnline=!0,n.flush()}),ie.addEventListener("offline",function(){n.areWeOnline=!1}))}return Jt(t,[{key:"retriableRequest",value:function(e){var n=this,r=e.retriesPerformedSoFar,i=oFe(e,hUe);Mo(r)&&r>0&&(i.url=Vw(i.url,{retry_count:r})),this.instance._send_request(De(De({},i),{},{callback:function(s){var o;s.statusCode!==200&&(s.statusCode<400||s.statusCode>=500)&&(r??0)<10?n.enqueue(De({retriesPerformedSoFar:r},i)):(o=i.callback)===null||o===void 0||o.call(i,s)}}))}},{key:"enqueue",value:function(e){var n=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=n+1;var r=function(o){var a=3e3*Math.pow(2,o),l=a/2,c=Math.min(18e5,a),u=(Math.random()-.5)*(c-l);return Math.ceil(c+u)}(n),i=Date.now()+r;this.queue.push({retryAt:i,requestOptions:e});var s="Enqueued failed request for retry in ".concat(r);navigator.onLine||(s+=" (Browser is offline)"),he.warn(s),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout(function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()},this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),n=[],r=this.queue.filter(function(a){return a.retryAt<e||(n.push(a),!1)});if(this.queue=n,r.length>0){var i,s=Qo(r);try{for(s.s();!(i=s.n()).done;){var o=i.value.requestOptions;this.retriableRequest(o)}}catch(a){s.e(a)}finally{s.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,n=Qo(this.queue);try{for(n.s();!(e=n.n()).done;){var r=e.value.requestOptions;try{this.instance._send_request(De(De({},r),{},{transport:"sendBeacon"}))}catch(i){he.error(i)}}}catch(i){n.e(i)}finally{n.f()}this.queue=[]}}]),t}(),qS=1800,mUe=function(){function t(e,n,r,i){var s;Xt(this,t),de(this,"_sessionIdChangedHandlers",[]),this.config=e,this.persistence=n,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||_d,this._windowIdGenerator=i||_d;var o=e.persistence_name||e.token,a=e.session_idle_timeout_seconds||qS;if(Mo(a)?a>qS?he.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&he.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(he.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=qS),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),qS),this._window_id_storage_key="ph_"+o+"_window_id",this._primary_window_exists_storage_key="ph_"+o+"_primary_window_exists",this._canUseSessionStorage()){var l=Ei.parse(this._window_id_storage_key),c=Ei.parse(this._primary_window_exists_storage_key);l&&!c?this._windowId=l:Ei.remove(this._window_id_storage_key),Ei.set(this._primary_window_exists_storage_key,!0)}if((s=this.config.bootstrap)!==null&&s!==void 0&&s.sessionID)try{var u=function(f){var p=f.replace(/-/g,"");if(p.length!==32)throw new Error("Not a valid UUID");if(p[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(p.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,new Date().getTime(),u)}catch(f){he.error("Invalid sessionID in bootstrap",f)}this._listenToReloadWindow()}return Jt(t,[{key:"onSessionId",value:function(e){var n=this;return rt(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){n._sessionIdChangedHandlers=n._sessionIdChangedHandlers.filter(function(r){return r!==e})}}},{key:"_canUseSessionStorage",value:function(){return this.config.persistence!=="memory"&&!this.persistence.disabled&&Ei.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&Ei.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?Ei.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,n,r){e===this._sessionId&&n===this._sessionActivityTimestamp&&r===this._sessionStartTimestamp||(this._sessionStartTimestamp=r,this._sessionActivityTimestamp=n,this._sessionId=e,this.persistence.register(de({},Mw,[n,e,r])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[Mw];return Xr(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;ie==null||ie.addEventListener("beforeunload",function(){e._canUseSessionStorage()&&Ei.remove(e._primary_window_exists_storage_key)})}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:null)||new Date().getTime(),r=Qi(this._getSessionId(),3),i=r[0],s=r[1],o=r[2],a=this._getWindowId(),l=o&&o>0&&Math.abs(n-o)>864e5,c=!1,u=!s,f=!e&&Math.abs(n-i)>this._sessionTimeoutMs;u||f||l?(s=this._sessionIdGenerator(),a=this._windowIdGenerator(),he.info("[SessionId] new session ID generated",{sessionId:s,windowId:a,changeReason:{noSessionId:u,activityTimeout:f,sessionPastMaximumLength:l}}),o=n,c=!0):a||(a=this._windowIdGenerator(),c=!0);var p=i===0||!e||l?n:i,m=o===0?new Date().getTime():o;return this._setWindowId(a),this._setSessionId(s,p,m),c&&this._sessionIdChangedHandlers.forEach(function(v){return v(s,a)}),{sessionId:s,windowId:a,sessionStartTimestamp:m}}}]),t}();(function(t){t.US="us",t.EU="eu",t.CUSTOM="custom"})(sh||(sh={}));var BH="i.posthog.com",gUe=function(){function t(e){Xt(this,t),de(this,"_regionCache",{}),this.instance=e}return Jt(t,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,n=(e=this.instance.config.ui_host)===null||e===void 0?void 0:e.replace(/\/$/,"");return n||(n=this.apiHost.replace(".".concat(BH),".posthog.com")),n==="https://app.posthog.com"?"https://us.posthog.com":n}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=sh.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=sh.EU:this._regionCache[this.apiHost]=sh.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(n&&(n=n[0]==="/"?n:"/".concat(n)),e==="ui")return this.uiHost+n;if(this.region===sh.CUSTOM)return this.apiHost+n;var r=BH+n;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(r);case"api":return"https://".concat(this.region,".").concat(r)}}},{key:"loadScript",value:function(e,n){if(this.instance.config.disable_external_dependency_loading)return he.warn("".concat(e," was requested but loading of external scripts is disabled.")),n("Loading of external scripts is disabled");var r=e[0]==="/"?this.endpointFor("assets",e):e,i=function(){if(!Be)return n("document not found");var s=Be.createElement("script");s.type="text/javascript",s.src=r,s.onload=function(l){return n(void 0,l)},s.onerror=function(l){return n(l)};var o,a=Be.querySelectorAll("body > script");a.length>0?(o=a[0].parentNode)===null||o===void 0||o.insertBefore(s,a[0]):Be.body.appendChild(s)};Be!=null&&Be.body?i():Be==null||Be.addEventListener("DOMContentLoaded",i)}}]),t}(),Fie="posthog-js";function Uie(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.organization,r=e.projectId,i=e.prefix,s=e.severityAllowList,o=s===void 0?["error"]:s;return function(a){var l,c,u,f,p;if(!(o==="*"||o.includes(a.level))||!t.__loaded)return a;a.tags||(a.tags={});var m=t.requestRouter.endpointFor("ui","/project/".concat(t.config.token,"/person/").concat(t.get_distinct_id()));a.tags["PostHog Person URL"]=m,t.sessionRecordingStarted()&&(a.tags["PostHog Recording URL"]=t.get_session_replay_url({withTimestamp:!0}));var v=((l=a.exception)===null||l===void 0?void 0:l.values)||[],g={$exception_message:((c=v[0])===null||c===void 0?void 0:c.value)||a.message,$exception_type:(u=v[0])===null||u===void 0?void 0:u.type,$exception_personURL:m,$exception_level:a.level,$sentry_event_id:a.event_id,$sentry_exception:a.exception,$sentry_exception_message:((f=v[0])===null||f===void 0?void 0:f.value)||a.message,$sentry_exception_type:(p=v[0])===null||p===void 0?void 0:p.type,$sentry_tags:a.tags,$level:a.level};return n&&r&&(g.$sentry_url=(i||"https://sentry.io/organizations/")+n+"/issues/?project="+r+"&query="+a.event_id),t.exceptions.sendExceptionEvent(g),a}}var vUe=Jt(function t(e,n,r,i,s){Xt(this,t),this.name=Fie,this.setupOnce=function(o){o(Uie(e,{organization:n,projectId:r,prefix:i,severityAllowList:s}))}});function yUe(t,e){var n=t.config.segment;if(!n)return e();(function(r,i){var s=r.config.segment;if(!s)return i();var o=function(l){var c=function(){return l.anonymousId()||_d()};r.config.get_device_id=c,l.id()&&(r.register({distinct_id:l.id(),$device_id:c()}),r.persistence.set_property(Cc,"identified")),i()},a=s.user();"then"in a&&Ho(a.then)?a.then(function(l){return o(l)}):o(a)})(t,function(){n.register(function(r){Promise&&Promise.resolve||he.warn("This browser does not have Promise support, and can not use the segment integration");var i=function(s,o){var a;if(!o)return s;s.event.userId||s.event.anonymousId===r.get_distinct_id()||(he.info("Segment integration does not have a userId set, resetting PostHog"),r.reset()),s.event.userId&&s.event.userId!==r.get_distinct_id()&&(he.info("Segment integration has a userId set, identifying with PostHog"),r.identify(s.event.userId));var l=r._calculate_event_properties(o,(a=s.event.properties)!==null&&a!==void 0?a:{},new Date);return s.event.properties=Object.assign({},l,s.event.properties),s};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(s){return i(s,s.event.event)},page:function(s){return i(s,"$pageview")},identify:function(s){return i(s,"$identify")},screen:function(s){return i(s,"$screen")}}}(t)).then(function(){e()})})}var HH,Gw,Ta,_Ue=function(){function t(e){Xt(this,t),this._instance=e}return Jt(t,[{key:"doPageView",value:function(e){var n,r=this._previousPageViewProperties(e);return this._currentPath=(n=ie==null?void 0:ie.location.pathname)!==null&&n!==void 0?n:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,r}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var n=this._currentPath,r=this._prevPageviewTimestamp,i=this._instance.scrollManager.getContext();if(!r)return{};var s={};if(i){var o=i.maxScrollHeight,a=i.lastScrollY,l=i.maxScrollY,c=i.maxContentHeight,u=i.lastContentY,f=i.maxContentY;rt(o)||rt(a)||rt(l)||rt(c)||rt(u)||rt(f)||(o=Math.ceil(o),a=Math.ceil(a),l=Math.ceil(l),c=Math.ceil(c),u=Math.ceil(u),f=Math.ceil(f),s={$prev_pageview_last_scroll:a,$prev_pageview_last_scroll_percentage:o<=1?1:KS(a/o,0,1),$prev_pageview_max_scroll:l,$prev_pageview_max_scroll_percentage:o<=1?1:KS(l/o,0,1),$prev_pageview_last_content:u,$prev_pageview_last_content_percentage:c<=1?1:KS(u/c,0,1),$prev_pageview_max_content:f,$prev_pageview_max_content_percentage:c<=1?1:KS(f/c,0,1)})}return n&&(s.$prev_pageview_pathname=n),r&&(s.$prev_pageview_duration=(e.getTime()-r.getTime())/1e3),s}}]),t}();function KS(t,e,n){return Math.max(e,Math.min(t,n))}(function(t){t.Popover="popover",t.API="api",t.Widget="widget"})(HH||(HH={})),function(t){t.Open="open",t.MultipleChoice="multiple_choice",t.SingleChoice="single_choice",t.Rating="rating",t.Link="link"}(Gw||(Gw={})),function(t){t.NextQuestion="next_question",t.End="end",t.ResponseBased="response_based",t.SpecificQuestion="specific_question"}(Ta||(Ta={}));var jie=function(){function t(){Xt(this,t),de(this,"events",{}),this.events={}}return Jt(t,[{key:"on",value:function(e,n){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(n),function(){r.events[e]=r.events[e].filter(function(i){return i!==n})}}},{key:"emit",value:function(e,n){var r,i=Qo(this.events[e]||[]);try{for(i.s();!(r=i.n()).done;)(0,r.value)(n)}catch(a){i.e(a)}finally{i.f()}var s,o=Qo(this.events["*"]||[]);try{for(o.s();!(s=o.n()).done;)(0,s.value)(e,n)}catch(a){o.e(a)}finally{o.f()}}}]),t}(),bUe=function(){function t(e){var n=this;Xt(this,t),de(this,"_debugEventEmitter",new jie),de(this,"checkStep",function(r,i){return n.checkStepEvent(r,i)&&n.checkStepUrl(r,i)&&n.checkStepElement(r,i)}),de(this,"checkStepEvent",function(r,i){return i==null||!i.event||(r==null?void 0:r.event)===(i==null?void 0:i.event)}),this.instance=e,this.actionEvents=new Set,this.actionRegistry=new Set}return Jt(t,[{key:"init",value:function(){var e,n=this;if(!rt((e=this.instance)===null||e===void 0?void 0:e._addCaptureHook)){var r;(r=this.instance)===null||r===void 0||r._addCaptureHook(function(i,s){n.on(i,s)})}}},{key:"register",value:function(e){var n,r,i=this;if(!rt((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)&&(e.forEach(function(a){var l,c;(l=i.actionRegistry)===null||l===void 0||l.add(a),(c=a.steps)===null||c===void 0||c.forEach(function(u){var f;(f=i.actionEvents)===null||f===void 0||f.add((u==null?void 0:u.event)||"")})}),(r=this.instance)!==null&&r!==void 0&&r.autocapture)){var s,o=new Set;e.forEach(function(a){var l;(l=a.steps)===null||l===void 0||l.forEach(function(c){c!=null&&c.selector&&o.add(c==null?void 0:c.selector)})}),(s=this.instance)===null||s===void 0||s.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,n){var r,i=this;n!=null&&e.length!=0&&(this.actionEvents.has(e)||this.actionEvents.has(n==null?void 0:n.event))&&this.actionRegistry&&((r=this.actionRegistry)===null||r===void 0?void 0:r.size)>0&&this.actionRegistry.forEach(function(s){i.checkAction(n,s)&&i._debugEventEmitter.emit("actionCaptured",s.name)})}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",function(n){return e(n)})}},{key:"checkAction",value:function(e,n){if((n==null?void 0:n.steps)==null)return!1;var r,i=Qo(n.steps);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(this.checkStep(e,s))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"onAction",value:function(e,n){return this._debugEventEmitter.on(e,n)}},{key:"checkStepUrl",value:function(e,n){if(n!=null&&n.url){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$current_url;if(!i||typeof i!="string"||!t.matchString(i,n==null?void 0:n.url,(n==null?void 0:n.url_matching)||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(e,n){if((n!=null&&n.href||n!=null&&n.tag_name||n!=null&&n.text)&&!this.getElementsList(e).some(function(s){return!(n!=null&&n.href&&!t.matchString(s.href||"",n==null?void 0:n.href,(n==null?void 0:n.href_matching)||"exact"))&&(n==null||!n.tag_name||s.tag_name===(n==null?void 0:n.tag_name))&&!(n!=null&&n.text&&!t.matchString(s.text||"",n==null?void 0:n.text,(n==null?void 0:n.text_matching)||"exact")&&!t.matchString(s.$el_text||"",n==null?void 0:n.text,(n==null?void 0:n.text_matching)||"exact"))}))return!1;if(n!=null&&n.selector){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$element_selectors;if(!i||!i.includes(n==null?void 0:n.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return(e==null?void 0:e.properties.$elements)==null?[]:e==null?void 0:e.properties.$elements}}],[{key:"matchString",value:function(e,n,r){switch(r){case"regex":return!!ie&&Fw(e,n);case"exact":return n===e;case"contains":var i=t.escapeStringRegexp(n).replace(/_/g,".").replace(/%/g,".*");return Fw(e,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),t}(),N5=function(){function t(e){Xt(this,t),this.instance=e,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return Jt(t,[{key:"register",value:function(e){var n;rt((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var n=this,r=e.filter(function(i){var s,o,a,l;return((s=i.conditions)===null||s===void 0?void 0:s.actions)&&((o=i.conditions)===null||o===void 0||(a=o.actions)===null||a===void 0||(l=a.values)===null||l===void 0?void 0:l.length)>0});r.length!==0&&(this.actionMatcher==null&&(this.actionMatcher=new bUe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook(function(i){n.onAction(i)})),r.forEach(function(i){var s,o,a,l,c,u,f,p,m,v;i.conditions&&(s=i.conditions)!==null&&s!==void 0&&s.actions&&(o=i.conditions)!==null&&o!==void 0&&(a=o.actions)!==null&&a!==void 0&&a.values&&((l=i.conditions)===null||l===void 0||(c=l.actions)===null||c===void 0||(u=c.values)===null||u===void 0?void 0:u.length)>0&&((f=n.actionMatcher)===null||f===void 0||f.register(i.conditions.actions.values),(p=i.conditions)===null||p===void 0||(m=p.actions)===null||m===void 0||(v=m.values)===null||v===void 0||v.forEach(function(g){if(g&&g.name){var S=n.actionToSurveys.get(g.name);S&&S.push(i.id),n.actionToSurveys.set(g.name,S||[i.id])}}))}))}},{key:"setupEventBasedSurveys",value:function(e){var n,r=this;e.filter(function(i){var s,o,a,l;return((s=i.conditions)===null||s===void 0?void 0:s.events)&&((o=i.conditions)===null||o===void 0||(a=o.events)===null||a===void 0||(l=a.values)===null||l===void 0?void 0:l.length)>0}).length!==0&&((n=this.instance)===null||n===void 0||n._addCaptureHook(function(i,s){r.onEvent(i,s)}),e.forEach(function(i){var s,o,a;(s=i.conditions)===null||s===void 0||(o=s.events)===null||o===void 0||(a=o.values)===null||a===void 0||a.forEach(function(l){if(l&&l.name){var c=r.eventToSurveys.get(l.name);c&&c.push(i.id),r.eventToSurveys.set(l.name,c||[i.id])}})}))}},{key:"onEvent",value:function(e,n){var r,i,s=((r=this.instance)===null||r===void 0||(i=r.persistence)===null||i===void 0?void 0:i.props[jS])||[];if(t.SURVEY_SHOWN_EVENT_NAME==e&&n&&s.length>0){var o,a=n==null||(o=n.properties)===null||o===void 0?void 0:o.$survey_id;if(a){var l=s.indexOf(a);l>=0&&(s.splice(l,1),this._updateActivatedSurveys(s))}}else this.eventToSurveys.has(e)&&this._updateActivatedSurveys(s.concat(this.eventToSurveys.get(e)||[]))}},{key:"onAction",value:function(e){var n,r,i=((n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0?void 0:r.props[jS])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(i.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var n,r;(n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0||r.register(de({},jS,Yc(new Set(e))))}},{key:"getSurveys",value:function(){var e,n,r=(e=this.instance)===null||e===void 0||(n=e.persistence)===null||n===void 0?void 0:n.props[jS];return r||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),t}();de(N5,"SURVEY_SHOWN_EVENT_NAME","survey shown");var D0="[Surveys]",SUe={icontains:function(t){return!!ie&&ie.location.href.toLowerCase().indexOf(t.toLowerCase())>-1},not_icontains:function(t){return!!ie&&ie.location.href.toLowerCase().indexOf(t.toLowerCase())===-1},regex:function(t){return!!ie&&Fw(ie.location.href,t)},not_regex:function(t){return!!ie&&!Fw(ie.location.href,t)},exact:function(t){return(ie==null?void 0:ie.location.href)===t},is_not:function(t){return(ie==null?void 0:ie.location.href)!==t}},EUe=function(){function t(e){Xt(this,t),this.instance=e,this._surveyEventReceiver=null}return Jt(t,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,n=qn==null?void 0:qn.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||n||(this._surveyEventReceiver==null&&(this._surveyEventReceiver=new N5(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",function(r){if(r)return he.error(D0,"Could not load surveys script",r);e._surveyManager=qn.extendPostHogWithSurveys(e.instance)}))}},{key:"getSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this.instance.config.disable_surveys)return e([]);this._surveyEventReceiver==null&&(this._surveyEventReceiver=new N5(this.instance));var i=this.instance.get_property(y5);if(i&&!r)return e(i);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(s){var o;if(s.statusCode!==200||!s.json)return e([]);var a,l=s.json.surveys||[],c=l.filter(function(u){var f,p,m,v,g,S,b,w,k,T,I,C;return((f=u.conditions)===null||f===void 0?void 0:f.events)&&((p=u.conditions)===null||p===void 0||(m=p.events)===null||m===void 0?void 0:m.values)&&((v=u.conditions)===null||v===void 0||(g=v.events)===null||g===void 0||(S=g.values)===null||S===void 0?void 0:S.length)>0||((b=u.conditions)===null||b===void 0?void 0:b.actions)&&((w=u.conditions)===null||w===void 0||(k=w.actions)===null||k===void 0?void 0:k.values)&&((T=u.conditions)===null||T===void 0||(I=T.actions)===null||I===void 0||(C=I.values)===null||C===void 0?void 0:C.length)>0});return c.length>0&&((a=n._surveyEventReceiver)===null||a===void 0||a.register(c)),(o=n.instance.persistence)===null||o===void 0||o.register(de({},y5,l)),e(l)}})}},{key:"getActiveMatchingSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.getSurveys(function(i){var s,o=i.filter(function(c){return!(!c.start_date||c.end_date)}).filter(function(c){var u,f,p,m;if(!c.conditions)return!0;var v=(u=c.conditions)===null||u===void 0||!u.url||SUe[(f=(p=c.conditions)===null||p===void 0?void 0:p.urlMatchType)!==null&&f!==void 0?f:"icontains"](c.conditions.url),g=(m=c.conditions)===null||m===void 0||!m.selector||(Be==null?void 0:Be.querySelector(c.conditions.selector));return v&&g}),a=(s=n._surveyEventReceiver)===null||s===void 0?void 0:s.getSurveys(),l=o.filter(function(c){var u,f,p,m,v,g,S,b,w,k;if(!c.linked_flag_key&&!c.targeting_flag_key&&!c.internal_targeting_flag_key)return!0;var T=!c.linked_flag_key||n.instance.featureFlags.isFeatureEnabled(c.linked_flag_key),I=!c.targeting_flag_key||n.instance.featureFlags.isFeatureEnabled(c.targeting_flag_key),C=((u=c.conditions)===null||u===void 0?void 0:u.events)&&((f=c.conditions)===null||f===void 0||(p=f.events)===null||p===void 0?void 0:p.values)&&((m=c.conditions)===null||m===void 0||(v=m.events)===null||v===void 0?void 0:v.values.length)>0,x=((g=c.conditions)===null||g===void 0?void 0:g.actions)&&((S=c.conditions)===null||S===void 0||(b=S.actions)===null||b===void 0?void 0:b.values)&&((w=c.conditions)===null||w===void 0||(k=w.actions)===null||k===void 0?void 0:k.values.length)>0,A=!C&&!x||(a==null?void 0:a.includes(c.id)),N=n._canActivateRepeatedly(c),D=!(c.internal_targeting_flag_key&&!N)||n.instance.featureFlags.isFeatureEnabled(c.internal_targeting_flag_key);return T&&I&&D&&A});return e(l)},r)}},{key:"getNextSurveyStep",value:function(e,n,r){var i,s=e.questions[n],o=n+1;if((i=s.branching)===null||i===void 0||!i.type)return n===e.questions.length-1?Ta.End:o;if(s.branching.type===Ta.End)return Ta.End;if(s.branching.type===Ta.SpecificQuestion){if(Number.isInteger(s.branching.index))return s.branching.index}else if(s.branching.type===Ta.ResponseBased){if(s.type===Gw.SingleChoice){var a,l,c=s.choices.indexOf("".concat(r));if((a=s.branching)!==null&&a!==void 0&&(l=a.responseValues)!==null&&l!==void 0&&l.hasOwnProperty(c)){var u=s.branching.responseValues[c];return Number.isInteger(u)?u:u===Ta.End?Ta.End:o}}else if(s.type===Gw.Rating){var f,p;if(typeof r!="number"||!Number.isInteger(r))throw new Error("The response type must be an integer");var m=function(g,S){if(S===3){if(g<1||g>3)throw new Error("The response must be in range 1-3");return g===1?"negative":g===2?"neutral":"positive"}if(S===5){if(g<1||g>5)throw new Error("The response must be in range 1-5");return g<=2?"negative":g===3?"neutral":"positive"}if(S===10){if(g<0||g>10)throw new Error("The response must be in range 0-10");return g<=6?"detractors":g<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(r,s.scale);if((f=s.branching)!==null&&f!==void 0&&(p=f.responseValues)!==null&&p!==void 0&&p.hasOwnProperty(m)){var v=s.branching.responseValues[m];return Number.isInteger(v)?v:v===Ta.End?Ta.End:o}}return o}return he.warn(D0,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return Ms(qn.__PosthogExtensions__.canActivateRepeatedly)&&he.warn(D0,"canActivateRepeatedly is not defined, must init before calling"),qn.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var n=this;Ms(this._surveyManager)?he.warn(D0,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(r){var i=r.filter(function(s){return s.id===e})[0];n._surveyManager.canRenderSurvey(i)})}},{key:"renderSurvey",value:function(e,n){var r=this;Ms(this._surveyManager)?he.warn(D0,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(i){var s=i.filter(function(o){return o.id===e})[0];r._surveyManager.renderSurvey(s,Be==null?void 0:Be.querySelector(n))})}}]),t}(),wUe=function(){function t(e){var n,r,i=this;Xt(this,t),de(this,"serverLimits",{}),de(this,"lastEventRateLimited",!1),de(this,"checkForLimiting",function(s){var o=s.text;if(o&&o.length)try{(JSON.parse(o).quota_limited||[]).forEach(function(a){he.info("[RateLimiter] ".concat(a||"events"," is quota limited.")),i.serverLimits[a]=new Date().getTime()+6e4})}catch(a){return void he.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(a==null?void 0:a.message,'"'),{text:o})}}),this.instance=e,this.captureEventsPerSecond=((n=e.config.rate_limiting)===null||n===void 0?void 0:n.events_per_second)||10,this.captureEventsBurstLimit=Math.max(((r=e.config.rate_limiting)===null||r===void 0?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return Jt(t,[{key:"clientRateLimitContext",value:function(){var e,n,r,i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=new Date().getTime(),o=(e=(n=this.instance.persistence)===null||n===void 0?void 0:n.get_property(b5))!==null&&e!==void 0?e:{tokens:this.captureEventsBurstLimit,last:s};o.tokens+=(s-o.last)/1e3*this.captureEventsPerSecond,o.last=s,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var a=o.tokens<1;return a||i||(o.tokens=Math.max(0,o.tokens-1)),!a||this.lastEventRateLimited||i||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=a,(r=this.instance.persistence)===null||r===void 0||r.set_property(b5,o),{isRateLimited:a,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var n=this.serverLimits[e||"events"]||!1;return n!==!1&&new Date().getTime()<n}}]),t}(),CUe=function(){return De({initialPathName:(Ss==null?void 0:Ss.pathname)||"",referringDomain:li.referringDomain()},li.campaignParams())},TUe=function(){function t(e,n,r){var i=this;Xt(this,t),de(this,"_onSessionIdCallback",function(s){var o=i._getStoredProps();if(!o||o.sessionId!==s){var a={sessionId:s,props:i._sessionSourceParamGenerator()};i._persistence.register(de({},_5,a))}}),this._sessionIdManager=e,this._persistence=n,this._sessionSourceParamGenerator=r||CUe,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return Jt(t,[{key:"_getStoredProps",value:function(){return this._persistence.props[_5]}},{key:"getSessionProps",value:function(){var e,n=(e=this._getStoredProps())===null||e===void 0?void 0:e.props;return n?{$client_session_initial_referring_host:n.referringDomain,$client_session_initial_pathname:n.initialPathName,$client_session_initial_utm_source:n.utm_source,$client_session_initial_utm_campaign:n.utm_campaign,$client_session_initial_utm_medium:n.utm_medium,$client_session_initial_utm_content:n.utm_content,$client_session_initial_utm_term:n.utm_term}:{}}}]),t}(),RUe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],VH=function(t,e){if(!t)return!1;var n=t.toLowerCase();return RUe.concat(e||[]).some(function(r){var i=r.toLowerCase();return n.indexOf(i)!==-1})},$ie=function(){function t(){Xt(this,t),this.clicks=[]}return Jt(t,[{key:"isRageClick",value:function(e,n,r){var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(n-i.y)<30&&r-i.timestamp<1e3){if(this.clicks.push({x:e,y:n,timestamp:r}),this.clicks.length===3)return!0}else this.clicks=[{x:e,y:n,timestamp:r}];return!1}}]),t}();function GH(t){var e;return t.id===w5||!((e=t.closest)===null||e===void 0||!e.call(t,"#"+w5))}var IUe=function(){function t(e){var n,r=this;Xt(this,t),de(this,"rageclicks",new $ie),de(this,"_enabledServerSide",!1),de(this,"_initialized",!1),de(this,"_flushInterval",null),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[m5]),ie==null||ie.addEventListener("beforeunload",function(){r.flush()})}return Jt(t,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return wi(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return rt(this.instance.config.capture_heatmaps)?rt(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;he.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval((e=this._flushInterval)!==null&&e!==void 0?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var n=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(de({},m5,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;ie&&Be&&(Nc(Be,"click",function(n){return e._onClick(n||(ie==null?void 0:ie.event))},!1,!0),Nc(Be,"mousemove",function(n){return e._onMouseMove(n||(ie==null?void 0:ie.event))},!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,n){var r=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),s=this.instance.scrollManager.scrollElement(),o=function(a,l,c){for(var u=a;u&&!Ld(u,"body");){if(u===c)return!1;if(Lt(l,ie==null?void 0:ie.getComputedStyle(u).position))return!0;u=Iie(u)}return!1}(e.target,["fixed","sticky"],s);return{x:e.clientX+(o?0:i),y:e.clientY+(o?0:r),target_fixed:o,type:n}}},{key:"_onClick",value:function(e){var n;if(!GH(e.target)){var r=this._getProperties(e,"click");(n=this.rageclicks)!==null&&n!==void 0&&n.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._capture(De(De({},r),{},{type:"rageclick"})),this._capture(r)}}},{key:"_onMouseMove",value:function(e){var n=this;GH(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout(function(){n._capture(n._getProperties(e,"mousemove"))},500))}},{key:"_capture",value:function(e){if(ie){var n=ie.location.href;this.buffer=this.buffer||{},this.buffer[n]||(this.buffer[n]=[]),this.buffer[n].push(e)}}},{key:"flush",value:function(){this.buffer&&!pE(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),t}(),kUe=function(){function t(e){var n=this;Xt(this,t),de(this,"_updateScrollData",function(){var r,i,s,o;n.context||(n.context={});var a=n.scrollElement(),l=n.scrollY(),c=a?Math.max(0,a.scrollHeight-a.clientHeight):0,u=l+((a==null?void 0:a.clientHeight)||0),f=(a==null?void 0:a.scrollHeight)||0;n.context.lastScrollY=Math.ceil(l),n.context.maxScrollY=Math.max(l,(r=n.context.maxScrollY)!==null&&r!==void 0?r:0),n.context.maxScrollHeight=Math.max(c,(i=n.context.maxScrollHeight)!==null&&i!==void 0?i:0),n.context.lastContentY=u,n.context.maxContentY=Math.max(u,(s=n.context.maxContentY)!==null&&s!==void 0?s:0),n.context.maxContentHeight=Math.max(f,(o=n.context.maxContentHeight)!==null&&o!==void 0?o:0)}),this.instance=e}return Jt(t,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){ie==null||ie.addEventListener("scroll",this._updateScrollData,!0),ie==null||ie.addEventListener("scrollend",this._updateScrollData,!0),ie==null||ie.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return ie==null?void 0:ie.document.documentElement;var e,n=Qo(Xr(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=ie==null?void 0:ie.document.querySelector(r);if(i)return i}}catch(s){n.e(s)}finally{n.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return ie&&(ie.scrollY||ie.pageYOffset||ie.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return ie&&(ie.scrollX||ie.pageXOffset||ie.document.documentElement.scrollLeft)||0}}]),t}(),x4="$copy_autocapture";function P4(t,e){return e.length>t?e.slice(0,t)+"...":e}var ld,xUe=function(){function t(e){Xt(this,t),de(this,"_initialized",!1),de(this,"_isDisabledServerSide",null),de(this,"rageclicks",new $ie),de(this,"_elementsChainAsString",!1),this.instance=e,this._elementSelectors=null}return Jt(t,[{key:"config",get:function(){var e,n,r=wi(this.instance.config.autocapture)?this.instance.config.autocapture:{};return r.url_allowlist=(e=r.url_allowlist)===null||e===void 0?void 0:e.map(function(i){return new RegExp(i)}),r.url_ignorelist=(n=r.url_ignorelist)===null||n===void 0?void 0:n.map(function(i){return new RegExp(i)}),r}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(ie&&Be){var n=function(i){i=i||(ie==null?void 0:ie.event);try{e._captureEvent(i)}catch(s){he.error("Failed to capture event",s)}},r=function(i){i=i||(ie==null?void 0:ie.event),e._captureEvent(i,x4)};Nc(Be,"submit",n,!1,!0),Nc(Be,"change",n,!1,!0),Nc(Be,"click",n,!1,!0),this.config.capture_copied_text&&(Nc(Be,"copy",r,!1,!0),Nc(Be,"cut",r,!1,!0))}}else he.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(de({},uH,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var n,r=[];return(n=this._elementSelectors)===null||n===void 0||n.forEach(function(i){var s=Be==null?void 0:Be.querySelectorAll(i);s==null||s.forEach(function(o){e===o&&r.push(i)})}),r}},{key:"isEnabled",get:function(){var e,n,r=(e=this.instance.persistence)===null||e===void 0?void 0:e.props[uH],i=this._isDisabledServerSide;if(gu(i)&&!ih(r)&&!this.instance.config.advanced_disable_decide)return!1;var s=(n=this._isDisabledServerSide)!==null&&n!==void 0?n:!!r;return!!this.instance.config.autocapture&&!s}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var n=e;do n=n.previousSibling;while(n&&!v8(n));return n}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!P5(e))return{};var n={};return Sn(e.attributes,function(r){if(r.name&&r.name.indexOf("data-ph-capture-attribute")===0){var i=r.name.replace("data-ph-capture-attribute-",""),s=r.value;i&&s&&Wm(s)&&(n[i]=s)}}),n}},{key:"_getPropertiesFromElement",value:function(e,n,r){var i,s=e.tagName.toLowerCase(),o={tag_name:s};x5.indexOf(s)>-1&&!r&&(s.toLowerCase()==="a"||s.toLowerCase()==="button"?o.$el_text=P4(1024,PH(e)):o.$el_text=P4(1024,Bw(e)));var a=$w(e);a.length>0&&(o.classes=a.filter(function(p){return p!==""}));var l=(i=this.config)===null||i===void 0?void 0:i.element_attribute_ignorelist;Sn(e.attributes,function(p){var m;if((!kie(e)||["name","id","class","aria-label"].indexOf(p.name)!==-1)&&(l==null||!l.includes(p.name))&&!n&&Wm(p.value)&&(m=p.name,!Hi(m)||m.substring(0,10)!=="_ngcontent"&&m.substring(0,7)!=="_nghost")){var v=p.value;p.name==="class"&&(v=g8(v).join(" ")),o["attr__"+p.name]=P4(1024,v)}});for(var c=1,u=1,f=e;f=this._previousElementSibling(f);)c++,f.tagName===e.tagName&&u++;return o.nth_child=c,o.nth_of_type=u,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return rt(e.target)?e.srcElement||null:(n=e.target)!==null&&n!==void 0&&n.shadowRoot?e.composedPath()[0]||null:e.target||null;var n}},{key:"_captureEvent",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"$autocapture";if(this.isEnabled){var i,s=this._getEventTarget(e);Tie(s)&&(s=s.parentNode||null),r==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(i=this.rageclicks)!==null&&i!==void 0&&i.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._captureEvent(e,"$rageclick");var o=r===x4;if(s&&UFe(s,e,this.config,o,o?["copy","cut"]:void 0)){for(var a,l,c=[s],u=s;u.parentNode&&!Ld(u,"body");)Rie(u.parentNode)?(c.push(u.parentNode.host),u=u.parentNode.host):(c.push(u.parentNode),u=u.parentNode);var f,p,m=[],v={},g=!1;if(Sn(c,function(N){var D=P5(N);N.tagName.toLowerCase()==="a"&&(f=N.getAttribute("href"),f=D&&Wm(f)&&f),Lt($w(N),"ph-no-capture")&&(g=!0),m.push(n._getPropertiesFromElement(N,n.instance.config.mask_all_element_attributes,n.instance.config.mask_all_text));var F=n._getAugmentPropertiesFromElement(N);es(v,F)}),this.instance.config.mask_all_text||(s.tagName.toLowerCase()==="a"||s.tagName.toLowerCase()==="button"?m[0].$el_text=PH(s):m[0].$el_text=Bw(s)),f){var S,b;m[0].attr__href=f;var w=(S=O1(f))===null||S===void 0?void 0:S.host,k=ie==null||(b=ie.location)===null||b===void 0?void 0:b.host;w&&k&&w!==k&&(p=f)}if(g)return!1;var T=es(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:VFe(m)}:{$elements:m},(a=m[0])!==null&&a!==void 0&&a.$el_text?{$el_text:(l=m[0])===null||l===void 0?void 0:l.$el_text}:{},p&&e.type==="click"?{$external_click_url:p}:{},v),I=this.getElementSelectors(s);if(I&&I.length>0&&(T.$element_selectors=I),r===x4){var C,x=Cie(ie==null||(C=ie.getSelection())===null||C===void 0?void 0:C.toString()),A=e.type||"clipboard";if(!x)return!1;T.$selected_content=x,T.$copy_type=A}return this.instance.capture(r,T),!0}}}},{key:"isBrowserSupported",value:function(){return Ho(Be==null?void 0:Be.querySelectorAll)}}]),t}(),PUe=function(){function t(e){var n=this;Xt(this,t),de(this,"_restoreXHRPatch",void 0),de(this,"_restoreFetchPatch",void 0),de(this,"_startCapturing",function(){rt(n._restoreXHRPatch)&&qn.postHogTracingHeadersPatchFns._patchXHR(n.instance.sessionManager),rt(n._restoreFetchPatch)&&qn.postHogTracingHeadersPatchFns._patchFetch(n.instance.sessionManager)}),this.instance=e}return Jt(t,[{key:"_loadScript",value:function(e){qn.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(Oo.LIB_VERSION),function(n){if(n)return he.error("[TRACING-HEADERS] failed to load script",n);e()})}},{key:"startIfEnabledOrStop",value:function(){var e,n;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):((e=this._restoreXHRPatch)===null||e===void 0||e.call(this),(n=this._restoreFetchPatch)===null||n===void 0||n.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),t}();(function(t){t[t.PENDING=-1]="PENDING",t[t.DENIED=0]="DENIED",t[t.GRANTED=1]="GRANTED"})(ld||(ld={}));var LUe=function(){function t(e){Xt(this,t),this.instance=e}return Jt(t,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?ld.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===ld.DENIED||this.consent===ld.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,n=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+n}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return e==="1"?ld.GRANTED:e==="0"?ld.DENIED:ld.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage=e==="localStorage"?zr:Xc;var n=e==="localStorage"?Xc:zr;n.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut(n.get(this.storageKey)==="1"),n.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!oie([$a==null?void 0:$a.doNotTrack,$a==null?void 0:$a.msDoNotTrack,qn.doNotTrack],function(e){return Lt([!0,1,"1","yes"],e)})}}]),t}(),WS="[Exception Autocapture]",AUe=function(){function t(e){var n,r=this;Xt(this,t),de(this,"originalOnUnhandledRejectionHandler",void 0),de(this,"startCapturing",function(){if(ie&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var i=ie.posthogErrorWrappingFunctions.wrapOnError,s=ie.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(i&&s)try{r.unwrapOnError=i(r.captureException.bind(r)),r.unwrapUnhandledRejection=s(r.captureException.bind(r))}catch(o){he.error(WS+" failed to start",o),r.stopCapturing()}else he.error(WS+" failed to load error wrapping functions - cannot start")}}),this.instance=e,this.remoteEnabled=!((n=this.instance.persistence)===null||n===void 0||!n.props[dH]),this.startIfEnabled()}return Jt(t,[{key:"isEnabled",get:function(){var e;return(e=this.remoteEnabled)!==null&&e!==void 0&&e}},{key:"isCapturing",get:function(){var e;return!(ie==null||(e=ie.onerror)===null||e===void 0||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(he.info(WS+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(Oo.LIB_VERSION),function(n){if(n)return he.error(WS+" failed to load script",n);e()})}},{key:"stopCapturing",value:function(){var e,n;(e=this.unwrapOnError)===null||e===void 0||e.call(this),(n=this.unwrapUnhandledRejection)===null||n===void 0||n.call(this)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this.remoteEnabled=!!n||!1,this.instance.persistence&&this.instance.persistence.register(de({},dH,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var n=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(n,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),t}(),qH=9e5,$f="[Web Vitals]",OUe=function(){function t(e){var n,r=this;Xt(this,t),de(this,"_enabledServerSide",!1),de(this,"_initialized",!1),de(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),de(this,"_flushToCapture",function(){clearTimeout(r._delayedFlushTimer),r.buffer.metrics.length!==0&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce(function(i,s){var o;return De(De({},i),{},(de(o={},"$web_vitals_".concat(s.name,"_event"),De({},s)),de(o,"$web_vitals_".concat(s.name,"_value"),s.value),o))},{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})}),de(this,"_addToBuffer",function(i){var s,o=(s=r.instance.sessionManager)===null||s===void 0?void 0:s.checkAndGetSessionAndWindowId(!0);if(rt(o))he.error($f+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=r._currentURL();rt(a)||(Ms(i==null?void 0:i.name)||Ms(i==null?void 0:i.value)?he.error($f+"Invalid metric received",i):r._maxAllowedValue&&i.value>=r._maxAllowedValue?he.error($f+"Ignoring metric with value >= "+r._maxAllowedValue,i):(r.buffer.url!==a&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),rt(r.buffer.url)&&(r.buffer.url=a),r.buffer.firstMetricTimestamp=rt(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push(De(De({},i),{},{$current_url:a,$session_id:o.sessionId,$window_id:o.windowId,timestamp:Date.now()})),r.buffer.metrics.length===4&&r._flushToCapture()))}}),de(this,"_startCapturing",function(){var i=qn.postHogWebVitalsCallbacks,s=i.onLCP,o=i.onCLS,a=i.onFCP,l=i.onINP;s&&o&&a&&l?(s(r._addToBuffer),o(r._addToBuffer),a(r._addToBuffer),l(r._addToBuffer),r._initialized=!0):he.error($f+"web vitals callbacks not loaded - not starting")}),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[hH]),this.startIfEnabled()}return Jt(t,[{key:"_maxAllowedValue",get:function(){var e=wi(this.instance.config.capture_performance)&&Mo(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:qH;return 0<e&&e<=6e4?qH:e}},{key:"isEnabled",get:function(){var e=wi(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return ih(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(he.info($f+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var n=wi(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(de({},hH,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"loadScript",value:function(e){ie.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(Oo.LIB_VERSION),function(n){n?he.error($f+" failed to load script",n):e()})}},{key:"_currentURL",value:function(){var e=ie?ie.location.href:void 0;return e||he.error($f+"Could not determine current URL"),e}}]),t}(),KH="/e/",MUe=function(){function t(e){var n;Xt(this,t),this.instance=e,this._endpointSuffix=((n=this.instance.persistence)===null||n===void 0?void 0:n.props[fH])||KH}return Jt(t,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this._endpointSuffix=wi(n)&&n.endpoint||KH,this.instance.persistence&&this.instance.persistence.register(de({},fH,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),t}(),D1={},WH=function(){},cm="posthog",Bie=!dUe&&(ai==null?void 0:ai.indexOf("MSIE"))===-1&&(ai==null?void 0:ai.indexOf("Mozilla"))===-1,zH=function(){var t,e,n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(e=Be==null?void 0:Be.location,n=e==null?void 0:e.hostname,!!Hi(n)&&n.split(".").slice(-2).join(".")!=="herokuapp.com"),persistence:"localStorage+cookie",persistence_name:"",loaded:WH,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:Ss&&Hi(Ss==null?void 0:Ss.search)&&Ss.search.indexOf("__posthog_debug=true")!==-1||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:(ie==null||(t=ie.location)===null||t===void 0?void 0:t.protocol)==="https:",ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(r){var i="Bad HTTP status: "+r.statusCode+" "+r.text;he.error(i)},get_device_id:function(r){return r},_onCapture:WH,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},YH=function(t){var e={};rt(t.process_person)||(e.person_profiles=t.process_person),rt(t.xhr_headers)||(e.request_headers=t.xhr_headers),rt(t.cookie_name)||(e.persistence_name=t.cookie_name),rt(t.disable_cookie)||(e.disable_persistence=t.disable_cookie);var n=es({},e,t);return Xr(t.property_blacklist)&&(rt(t.property_denylist)?n.property_denylist=t.property_blacklist:Xr(t.property_denylist)?n.property_denylist=[].concat(Yc(t.property_blacklist),Yc(t.property_denylist)):he.error("Invalid value for property_denylist config: "+t.property_denylist)),n},NUe=function(){function t(){Xt(this,t),de(this,"__forceAllowLocalhost",!1)}return Jt(t,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){he.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),t}(),Hie=function(){function t(){var e=this;Xt(this,t),de(this,"webPerformance",new NUe),de(this,"version",Oo.LIB_VERSION),de(this,"_internalEventEmitter",new jie),this.config=zH(),this.decideEndpointWasHit=!1,this.SentryIntegration=vUe,this.sentryIntegration=function(n){return function(r,i){var s=Uie(r,i);return{name:Fie,processEvent:function(o){return s(o)}}}(e,n)},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new hFe(this),this.toolbar=new tUe(this),this.scrollManager=new kUe(this),this.pageViewManager=new _Ue(this),this.surveys=new EUe(this),this.exceptions=new MUe(this),this.rateLimiter=new wUe(this),this.requestRouter=new gUe(this),this.consent=new LUe(this),this.people={set:function(n,r,i){var s=Hi(n)?de({},n,r):n;e.setPersonProperties(s),i==null||i({})},set_once:function(n,r,i){var s=Hi(n)?de({},n,r):n;e.setPersonProperties(void 0,s),i==null||i({})}},this.on("eventCaptured",function(n){return he.info("send",n)})}return Jt(t,[{key:"init",value:function(e,n,r){if(r&&r!==cm){var i,s=(i=D1[r])!==null&&i!==void 0?i:new t;return s._init(e,n,r),D1[r]=s,D1[cm][r]=s,s}return this._init(e,n,r)}},{key:"_init",value:function(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(rt(e)||iH(e))return he.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return he.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(es({},zH(),YH(s),{name:o,token:e})),this.config.on_xhr_error&&he.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=s.disable_compression?void 0:Ua.GZipJS,this.persistence=new T4(this.config),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new T4(De(De({},this.config),{},{persistence:"sessionStorage"}));var a=De({},this.persistence.props),l=De({},this.sessionPersistence.props);if(this._requestQueue=new nUe(function(w){return i._send_retriable_request(w)}),this._retryQueue=new pUe(this),this.__request_queue=[],this.sessionManager=new mUe(this.config,this.persistence),this.sessionPropsManager=new TUe(this.sessionManager,this.persistence),new PUe(this).startIfEnabledOrStop(),this.sessionRecording=new ZFe(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new xUe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new IUe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new OUe(this),this.exceptionObserver=new AUe(this),this.exceptionObserver.startIfEnabled(),Oo.DEBUG=Oo.DEBUG||this.config.debug,Oo.DEBUG&&he.info("Starting in debug mode",{this:this,config:s,thisC:De({},this.config),p:a,s:l}),this._sync_opt_out_with_persistence(),((n=s.bootstrap)===null||n===void 0?void 0:n.distinctID)!==void 0){var c,u,f=this.config.get_device_id(_d()),p=(c=s.bootstrap)!==null&&c!==void 0&&c.isIdentifiedID?f:s.bootstrap.distinctID;this.persistence.set_property(Cc,(u=s.bootstrap)!==null&&u!==void 0&&u.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:s.bootstrap.distinctID,$device_id:p})}if(this._hasBootstrappedFeatureFlags()){var m,v,g=Object.keys(((m=s.bootstrap)===null||m===void 0?void 0:m.featureFlags)||{}).filter(function(w){var k,T;return!((k=s.bootstrap)===null||k===void 0||(T=k.featureFlags)===null||T===void 0||!T[w])}).reduce(function(w,k){var T,I;return w[k]=((T=s.bootstrap)===null||T===void 0||(I=T.featureFlags)===null||I===void 0?void 0:I[k])||!1,w},{}),S=Object.keys(((v=s.bootstrap)===null||v===void 0?void 0:v.featureFlagPayloads)||{}).filter(function(w){return g[w]}).reduce(function(w,k){var T,I,C,x;return(T=s.bootstrap)!==null&&T!==void 0&&(I=T.featureFlagPayloads)!==null&&I!==void 0&&I[k]&&(w[k]=(C=s.bootstrap)===null||C===void 0||(x=C.featureFlagPayloads)===null||x===void 0?void 0:x[k]),w},{});this.featureFlags.receivedFeatureFlags({featureFlags:g,featureFlagPayloads:S})}if(!this.get_distinct_id()){var b=this.config.get_device_id(_d());this.register_once({distinct_id:b,$device_id:b},""),this.persistence.set_property(Cc,"anonymous")}return ie==null||(r=ie.addEventListener)===null||r===void 0||r.call(ie,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),s.segment?yUe(this,function(){return i._loaded()}):this._loaded(),Ho(this.config._onCapture)&&this.on("eventCaptured",function(w){return i.config._onCapture(w.event,w)}),this}},{key:"_afterDecideResponse",value:function(e){var n,r,i,s,o,a,l,c;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=Lt(e.supportedCompression,Ua.GZipJS)?Ua.GZipJS:Lt(e.supportedCompression,Ua.Base64)?Ua.Base64:void 0),(n=e.analytics)!==null&&n!==void 0&&n.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),(r=this.sessionRecording)===null||r===void 0||r.afterDecideResponse(e),(i=this.autocapture)===null||i===void 0||i.afterDecideResponse(e),(s=this.heatmaps)===null||s===void 0||s.afterDecideResponse(e),(o=this.surveys)===null||o===void 0||o.afterDecideResponse(e),(a=this.webVitalsAutocapture)===null||a===void 0||a.afterDecideResponse(e),(l=this.exceptions)===null||l===void 0||l.afterDecideResponse(e),(c=this.exceptionObserver)===null||c===void 0||c.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,n=this.config.advanced_disable_decide;n||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(r){he.critical("`loaded` function failed",r)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout(function(){e.consent.isOptedIn()&&e._captureInitialPageview()},1),n||(new QFe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&((e=this._requestQueue)===null||e===void 0||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||Gm(this.__request_queue,function(n){return e._send_retriable_request(n)}),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,n;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),(e=this._requestQueue)===null||e===void 0||e.unload(),(n=this._retryQueue)===null||n===void 0||n.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var n=this;this.__loaded&&(Bie?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=Vw(e.url,{ip:this.config.ip?1:0}),e.headers=De({},this.config.request_headers),e.compression=e.compression==="best-available"?this.compression:e.compression,function(r){var i,s,o,a=De({},r);a.timeout=a.timeout||6e4,a.url=Vw(a.url,{_:new Date().getTime().toString(),ver:Oo.LIB_VERSION,compression:a.compression});var l=(i=a.transport)!==null&&i!==void 0?i:"XHR",c=(s=(o=oie(N1,function(u){return u.transport===l}))===null||o===void 0?void 0:o.method)!==null&&s!==void 0?s:N1[0].method;if(!c)throw new Error("No available transport method");c(a)}(De(De({},e),{},{callback:function(r){var i,s,o;n.rateLimiter.checkForLimiting(r),r.statusCode>=400&&((s=(o=n.config).on_request_error)===null||s===void 0||s.call(o,r)),(i=e.callback)===null||i===void 0||i.call(e,r)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var n,r=this,i=[],s=[],o=[];Gm(e,function(l){l&&(n=l[0],Xr(n)?o.push(l):Ho(l)?l.call(r):Xr(l)&&n==="alias"?i.push(l):Xr(l)&&n.indexOf("capture")!==-1&&Ho(r[n])?o.push(l):s.push(l))});var a=function(l,c){Gm(l,function(u){if(Xr(u[0])){var f=c;Sn(u,function(p){f=f[p[0]].apply(f,p.slice(1))})}else this[u[0]].apply(this,u.slice(1))},c)};a(i,this),a(s,this),a(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,n;return((e=this.config.bootstrap)===null||e===void 0?void 0:e.featureFlags)&&Object.keys((n=this.config.bootstrap)===null||n===void 0?void 0:n.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,n,r){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!rt(e)&&Hi(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var s=r!=null&&r.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(s==null||!s.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,a=(r==null?void 0:r.timestamp)||o,l={uuid:_d(),event:e,properties:this._calculate_event_properties(e,n||{},a)};s&&(l.properties.$lib_rate_limit_remaining_tokens=s.remainingTokens),r!=null&&r.$set&&(l.$set=r==null?void 0:r.$set);var c=this._calculate_set_once_properties(r==null?void 0:r.$set_once);c&&(l.$set_once=c),(l=uFe(l,r!=null&&r._noTruncate?null:this.config.properties_string_max_length)).timestamp=a,rt(r==null?void 0:r.timestamp)||(l.properties.$event_time_override_provided=!0,l.properties.$event_time_override_system_time=o);var u=De(De({},l.properties.$set),l.$set);pE(u)||this.setPersonPropertiesForFlags(u),this._internalEventEmitter.emit("eventCaptured",l);var f={method:"POST",url:(i=r==null?void 0:r._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:l,compression:"best-available",batchKey:r==null?void 0:r._batchKey};return!this.config.request_batching||r&&(r==null||!r._batchKey)||r!=null&&r.send_instantly?this._send_retriable_request(f):this._requestQueue.enqueue(f),l}he.critical("This capture call is ignored due to client rate limiting.")}}else he.error("No event name provided to posthog.capture")}else he.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",function(n){return e(n.event,n)})}},{key:"_calculate_event_properties",value:function(e,n,r){if(r=r||new Date,!this.persistence||!this.sessionPersistence)return n;var i=this.persistence.remove_event_timer(e),s=De({},n);if(s.token=this.config.token,e==="$snapshot"){var o=De(De({},this.persistence.properties()),this.sessionPersistence.properties());return s.distinct_id=o.distinct_id,(!Hi(s.distinct_id)&&!Mo(s.distinct_id)||iH(s.distinct_id))&&he.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),s}var a=li.properties();if(this.sessionManager){var l=this.sessionManager.checkAndGetSessionAndWindowId(),c=l.sessionId,u=l.windowId;s.$session_id=c,s.$window_id=u}if(this.requestRouter.region===sh.CUSTOM&&(s.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&(e==="$pageview"||e==="$pageleave"||e==="$autocapture")){var f=this.sessionPropsManager.getSessionProps();s=es(s,f)}if(!this.config.disable_scroll_properties){var p={};e==="$pageview"?p=this.pageViewManager.doPageView(r):e==="$pageleave"&&(p=this.pageViewManager.doPageLeave(r)),s=es(s,p)}if(e==="$pageview"&&Be&&(s.title=Be.title),!rt(i)){var m=r.getTime()-i;s.$duration=parseFloat((m/1e3).toFixed(3))}ai&&this.config.opt_out_useragent_filter&&(s.$browser_type=this._is_bot()?"bot":"browser"),(s=es({},a,this.persistence.properties(),this.sessionPersistence.properties(),s)).$is_identified=this._isIdentified(),Xr(this.config.property_denylist)?Sn(this.config.property_denylist,function(g){delete s[g]}):he.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var v=this.config.sanitize_properties;return v&&(s=v(s,e)),s.$process_person_profile=this._hasPersonProcessing(),s}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var n=es({},this.persistence.get_initial_props(),e||{});return pE(n)?void 0:n}},{key:"register",value:function(e,n){var r;(r=this.persistence)===null||r===void 0||r.register(e,n)}},{key:"register_once",value:function(e,n,r){var i;(i=this.persistence)===null||i===void 0||i.register_once(e,n,r)}},{key:"register_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.register(e)}},{key:"unregister",value:function(e){var n;(n=this.persistence)===null||n===void 0||n.unregister(e)}},{key:"unregister_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.unregister(e)}},{key:"_register_single",value:function(e,n){this.register(de({},e,n))}},{key:"getFeatureFlag",value:function(e,n){return this.featureFlags.getFeatureFlag(e,n)}},{key:"getFeatureFlagPayload",value:function(e){var n=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(n)}catch{return n}}},{key:"isFeatureEnabled",value:function(e,n){return this.featureFlags.isFeatureEnabled(e,n)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,n)}},{key:"getEarlyAccessFeatures",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,n)}},{key:"on",value:function(e,n){return this._internalEventEmitter.on(e,n)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var n,r;return(n=(r=this.sessionManager)===null||r===void 0?void 0:r.onSessionId(e))!==null&&n!==void 0?n:function(){}}},{key:"getSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getSurveys(e,n)}},{key:"getActiveMatchingSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getActiveMatchingSurveys(e,n)}},{key:"renderSurvey",value:function(e,n){this.surveys.renderSurvey(e,n)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,n,r){return this.surveys.getNextSurveyStep(e,n,r)}},{key:"identify",value:function(e,n,r){if(!this.__loaded||!this.persistence)return he.uninitializedWarning("posthog.identify");if(Mo(e)&&(e=e.toString(),he.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))he.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var s=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:s},"")}e!==i&&e!==this.get_property(r1)&&(this.unregister(r1),this.register({distinct_id:e}));var o=(this.persistence.get_property(Cc)||"anonymous")==="anonymous";e!==i&&o?(this.persistence.set_property(Cc,"identified"),this.setPersonPropertiesForFlags(n||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:n||{},$set_once:r||{}}),this.featureFlags.setAnonymousDistinctId(i)):(n||r)&&this.setPersonProperties(n,r),e!==i&&(this.reloadFeatureFlags(),this.unregister(Nw))}}else he.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,n){(e||n)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:n||{}}))}},{key:"group",value:function(e,n,r){if(e&&n){if(this._requirePersonProcessing("posthog.group")){var i=this.getGroups();i[e]!==n&&this.resetGroupPropertiesForFlags(e),this.register({$groups:De(De({},i),{},de({},e,n))}),r&&(this.capture("$groupidentify",{$group_type:e,$group_key:n,$group_set:r}),this.setGroupPropertiesForFlags(de({},e,r))),i[e]===n||r||this.reloadFeatureFlags()}}else he.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,n)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,n)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var n,r,i,s;if(he.info("reset"),!this.__loaded)return he.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),(n=this.persistence)===null||n===void 0||n.clear(),(r=this.sessionPersistence)===null||r===void 0||r.clear(),(i=this.persistence)===null||i===void 0||i.set_property(Cc,"anonymous"),(s=this.sessionManager)===null||s===void 0||s.resetSessionId();var a=this.config.get_device_id(_d());this.register_once({distinct_id:a,$device_id:e?a:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,n;return(e=(n=this.sessionManager)===null||n===void 0?void 0:n.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var n=this.sessionManager.checkAndGetSessionAndWindowId(!0),r=n.sessionId,i=n.sessionStartTimestamp,s=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(r));if(e!=null&&e.withTimestamp&&i){var o,a=(o=e.timestampLookBack)!==null&&o!==void 0?o:10;if(!i)return s;var l=Math.max(Math.floor((new Date().getTime()-i)/1e3)-a,0);s+="?t=".concat(l)}return s}},{key:"alias",value:function(e,n){return e===this.get_property(aie)?(he.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(rt(n)&&(n=this.get_distinct_id()),e!==n?(this._register_single(r1,e),this.capture("$create_alias",{alias:e,distinct_id:n})):(he.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var n,r,i,s,o=De({},this.config);wi(e)&&(es(this.config,YH(e)),(n=this.persistence)===null||n===void 0||n.update_config(this.config,o),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new T4(De(De({},this.config),{},{persistence:"sessionStorage"})),zr.is_supported()&&zr.get("ph_debug")==="true"&&(this.config.debug=!0),this.config.debug&&(Oo.DEBUG=!0,he.info("set_config",{config:e,oldConfig:o,newConfig:De({},this.config)})),(r=this.sessionRecording)===null||r===void 0||r.startIfEnabledOrStop(),(i=this.autocapture)===null||i===void 0||i.startIfEnabled(),(s=this.heatmaps)===null||s===void 0||s.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var n,r=ih(e)&&e;if(r||e!=null&&e.sampling){var i,s,o=(i=this.sessionManager)===null||i===void 0?void 0:i.checkAndGetSessionAndWindowId();(s=this.persistence)===null||s===void 0||s.register(de({},A1,!0)),he.info("Session recording started with sampling override for session: ",o==null?void 0:o.sessionId)}(r||e!=null&&e.linked_flag)&&((n=this.sessionRecording)===null||n===void 0||n.overrideLinkedFlag(),he.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!((e=this.sessionRecording)===null||e===void 0||!e.started)}},{key:"captureException",value:function(e,n){var r=Ho(qn.parseErrorAsProperties)?qn.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):De({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},n);this.exceptions.sendExceptionEvent(r)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var n;return(n=this.persistence)===null||n===void 0?void 0:n.props[e]}},{key:"getSessionProperty",value:function(e){var n;return(n=this.sessionPersistence)===null||n===void 0?void 0:n.props[e]}},{key:"toString",value:function(){var e,n=(e=this.config.name)!==null&&e!==void 0?e:cm;return n!==cm&&(n=cm+"."+n),n}},{key:"_isIdentified",value:function(){var e,n;return((e=this.persistence)===null||e===void 0?void 0:e.get_property(Cc))==="identified"||((n=this.sessionPersistence)===null||n===void 0?void 0:n.get_property(Cc))==="identified"}},{key:"_hasPersonProcessing",value:function(){var e,n,r,i;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&pE(this.getGroups())&&((e=this.persistence)===null||e===void 0||(n=e.props)===null||n===void 0||!n[r1])&&((r=this.persistence)===null||r===void 0||(i=r.props)===null||i===void 0||!i[Dw]))}},{key:"_shouldCapturePageleave",value:function(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return this.config.person_profiles==="never"?(he.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(Dw,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,n,r,i,s=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,a=this.config.disable_persistence||s&&!!o;((e=this.persistence)===null||e===void 0?void 0:e.disabled)!==a&&((r=this.persistence)===null||r===void 0||r.set_disabled(a)),((n=this.sessionPersistence)===null||n===void 0?void 0:n.disabled)!==a&&((i=this.sessionPersistence)===null||i===void 0||i.set_disabled(a))}},{key:"opt_in_capturing",value:function(e){var n;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(rt(e==null?void 0:e.captureEventName)||e!=null&&e.captureEventName)&&this.capture((n=e==null?void 0:e.captureEventName)!==null&&n!==void 0?n:"$opt_in",e==null?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return $a?function(e,n){if(!e)return!1;var r=e.userAgent;if(r&&VH(r,n))return!0;try{var i=e==null?void 0:e.userAgentData;if(i!=null&&i.brands&&i.brands.some(function(s){return VH(s==null?void 0:s.brand,n)}))return!0}catch{}return!!e.webdriver}($a,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){Be&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:Be.title},{send_instantly:!0}))}},{key:"debug",value:function(e){e===!1?(ie==null||ie.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(ie==null||ie.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),t}();(function(t,e){for(var n=0;n<e.length;n++)t.prototype[e[n]]=cFe(t.prototype[e[n]])})(Hie,["identify"]);var XH,DUe=(XH=D1[cm]=new Hie,function(){function t(){t.done||(t.done=!0,Bie=!1,Sn(D1,function(e){e._dom_loaded()}))}Be!=null&&Be.addEventListener&&(Be.readyState==="complete"?t():Be.addEventListener("DOMContentLoaded",t,!1)),ie&&Nc(ie,"load",t,!0)}(),XH);class FUe extends NL{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...n){const r=super.emit(e,...n);if(!r){const i=this.eventBacklogs.get(e);i?i.push(n):this.eventBacklogs.set(e,[n])}return r}on(e,n){super.on(e,n);const r=this.eventBacklogs.get(e);if(r){for(const i of r)super.emit(e,...i);this.eventBacklogs.delete(e)}return this}addListener(e,n){return this.on(e,n)}once(e,n){super.once(e,n);const r=this.eventBacklogs.get(e);return r&&(super.emit(e,...r[0]),r.length===1?this.eventBacklogs.delete(e):r.shift()),this}}const UUe=""+new URL("cat-4r_NkDcK.ogg",import.meta.url).href,jUe=""+new URL("cat-Dd8bv_2W.mp3",import.meta.url).href,$Ue=""+new URL("clap-AxCMZLTd.ogg",import.meta.url).href,BUe=""+new URL("clap-Dxm5qGyl.mp3",import.meta.url).href,HUe=""+new URL("crickets-DUJdcuUa.ogg",import.meta.url).href,VUe=""+new URL("crickets-CcwrRdbq.mp3",import.meta.url).href,GUe=""+new URL("dog-CxIWtkNX.ogg",import.meta.url).href,qUe=""+new URL("dog-BoQdnF-w.mp3",import.meta.url).href,KUe=""+new URL("generic-BBbS3Wph.ogg",import.meta.url).href,WUe=""+new URL("generic-BFeSb6fL.mp3",import.meta.url).href,zUe=""+new URL("lightbulb-BIeJtAR_.ogg",import.meta.url).href,YUe=""+new URL("lightbulb-BrnY00qi.mp3",import.meta.url).href,XUe=""+new URL("party-D7rIOhAQ.ogg",import.meta.url).href,JUe=""+new URL("party-BZPeTgC3.mp3",import.meta.url).href,ZUe=""+new URL("deer-DPSlVch4.ogg",import.meta.url).href,QUe=""+new URL("deer-91r1Gyrx.mp3",import.meta.url).href,eje=""+new URL("rock-BVCJXNC-.ogg",import.meta.url).href,tje=""+new URL("rock-CHdnB31m.mp3",import.meta.url).href,nje=""+new URL("wave-FiiOzicp.ogg",import.meta.url).href,rje=""+new URL("wave-Bzf1LSMH.mp3",import.meta.url).href,b8="io.element.call.reaction",D5={name:"generic",emoji:"",sound:{mp3:WUe,ogg:KUe}},F5=5,Iy=[{emoji:"👍",name:"thumbsup",alias:["+1","yes","thumbs up"]},{emoji:"🎉",name:"party",alias:["hurray","success"],sound:{ogg:XUe,mp3:JUe}},{emoji:"👏",name:"clapping",alias:["celebrate","success"],sound:{ogg:$Ue,mp3:BUe}},{emoji:"🐶",name:"dog",alias:["doggo","pupper","woofer","bark"],sound:{ogg:GUe,mp3:qUe}},{emoji:"🐱",name:"cat",alias:["meow","kitty"],sound:{ogg:UUe,mp3:jUe}},{emoji:"💡",name:"lightbulb",alias:["bulb","light","idea","ping"],sound:{ogg:zUe,mp3:YUe}},{emoji:"🦗",name:"crickets",alias:["awkward","silence"],sound:{ogg:HUe,mp3:VUe}},{emoji:"👎",name:"thumbsdown",alias:["-1","no","thumbs no"]},{emoji:"😵‍💫",name:"dizzy",alias:["dazed","confused"]},{emoji:"👌",name:"ok",alias:["okay","cool"]},{emoji:"🥰",name:"heart",alias:["heart","love","smiling"]},{emoji:"😄",name:"laugh",alias:["giggle","joy","smiling"]},{emoji:"🦌",name:"deer",alias:["stag","doe","bleat"],sound:{ogg:ZUe,mp3:QUe}},{emoji:"🤘",name:"rock",alias:["cool","horns","guitar"],sound:{ogg:eje,mp3:tje}},{emoji:"👋",name:"wave",alias:["hand","waving"],sound:{ogg:nje,mp3:rje}}];var fi=(t=>(t.JoinCall="io.element.join",t.HangupCall="im.vector.hangup",t.Close="io.element.close",t.TileLayout="io.element.tile_layout",t.SpotlightLayout="io.element.spotlight_layout",t.DeviceMute="io.element.device_mute",t))(fi||{});const Ze=(()=>{try{const{widgetId:t,parentUrl:e}=Ri();if(t&&e){const n=new URL(e).origin;O.info("Widget API is available");const r=new hge(t,n);r.requestCapability(v1.AlwaysOnScreen);const i=new FUe;[ar.ThemeChange,"io.element.join","im.vector.hangup","io.element.tile_layout","io.element.spotlight_layout","io.element.device_mute"].forEach(b=>{r.on(`action:${b}`,w=>{w.preventDefault(),i.emit(b,w)})});const{roomId:s,userId:o,deviceId:a,baseUrl:l,e2eEnabled:c,allowIceFallback:u}=Ri();if(!s)throw new Error("Room ID must be supplied");if(!o)throw new Error("User ID must be supplied");if(!a)throw new Error("Device ID must be supplied");if(!l)throw new Error("Base URL must be supplied");const f=["org.matrix.rageshake_request",ee.CallEncryptionKeysPrefix,ee.Reaction,ee.RoomRedaction,b8],p=[o,`_${o}_${a}`,`${o}_${a}`].map(b=>({eventType:ee.GroupCallMemberPrefix,stateKey:b})),m=[{eventType:ee.RoomCreate},{eventType:ee.RoomMember},{eventType:ee.RoomEncryption},{eventType:ee.GroupCallMemberPrefix}],v=[ee.CallInvite,ee.CallCandidates,ee.CallAnswer,ee.CallHangup,ee.CallReject,ee.CallSelectAnswer,ee.CallNegotiate,ee.CallSDPStreamMetadataChanged,ee.CallSDPStreamMetadataChangedPrefix,ee.CallReplaces,ee.CallEncryptionKeysPrefix],g=Az(r,{sendEvent:f,receiveEvent:f,sendState:p,receiveState:m,sendToDevice:v,receiveToDevice:v,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0},s,{baseUrl:l,userId:o,deviceId:a,timelineSupport:!0,useE2eForGroupCall:c,fallbackICEServerAllowed:u},!1);return{api:r,lazyActions:i,client:(async()=>(await Zt.init(),await g.startClient({clientWellKnownPollPeriod:60*10}),g))()}}else return O.info("No widget API available"),null}catch(t){return O.warn("Continuing without the widget API",t),null}})();class ije{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,n,r,i){xt.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:n,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:i.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:i.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:i.statistics.counters.roomEventEncryptionKeysReceived>0?i.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/i.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:r})}}class sje{track(e){xt.instance.trackEvent({eventName:"CallStarted",callId:e})}}class oje{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){xt.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),xt.instance.setRegistrationType(NT.Registered)}}class aje{track(){xt.instance.trackEvent({eventName:"Login"}),xt.instance.setRegistrationType(NT.Registered)}}class lje{track(e,n){xt.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:n})}}class cje{track(e,n){xt.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:n})}}class uje{track(e){xt.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class dje{track(e,n,r){xt.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:n,stars:r})}}class fje{track(e){xt.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class hje{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const n=Date.now(),r=n-this.connectStart,i=this.websocketConnected-this.connectStart,s=n-this.websocketConnected;xt.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:r,websocketDuration:i,peerConnectionDuration:s}),e.log&&O.log(`Time to connect:
total: ${r}ms
peerConnection: ${i}ms
websocket: ${s}ms`)}}function sn(t){return typeof t=="function"}function Vie(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var L4=Vie(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function qw(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var S_=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=zd(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(sn(u))try{u()}catch(g){s=g instanceof L4?g.errors:[g]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var p=zd(f),m=p.next();!m.done;m=p.next()){var v=m.value;try{JH(v)}catch(g){s=s??[],g instanceof L4?s=Zo(Zo([],Jo(s)),Jo(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new L4(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)JH(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&qw(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&qw(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Gie=S_.EMPTY;function qie(t){return t instanceof S_||t&&"closed"in t&&sn(t.remove)&&sn(t.add)&&sn(t.unsubscribe)}function JH(t){sn(t)?t():t.unsubscribe()}var pje={Promise:void 0},mje={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Zo([t,e],Jo(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Kie(t){mje.setTimeout(function(){throw t})}function Kw(){}function vE(t){t()}var S8=function(t){ia(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,qie(n)&&n.add(r)):r.destination=yje,r}return e.create=function(n,r,i){return new ky(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(S_),gje=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){zS(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){zS(r)}else zS(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){zS(n)}},t}(),ky=function(t){ia(e,t);function e(n,r,i){var s=t.call(this)||this,o;return sn(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new gje(o),s}return e}(S8);function zS(t){Kie(t)}function vje(t){throw t}var yje={closed:!0,next:Kw,error:vje,complete:Kw},E8=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function df(t){return t}function _je(t){return t.length===0?df:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var rr=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=Sje(e)?e:new ky(e,n,r);return vE(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=ZH(n),new n(function(i,s){var o=new ky({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[E8]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return _je(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=ZH(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function ZH(t){var e;return(e=t??pje.Promise)!==null&&e!==void 0?e:Promise}function bje(t){return t&&sn(t.next)&&sn(t.error)&&sn(t.complete)}function Sje(t){return t&&t instanceof S8||bje(t)&&qie(t)}function Eje(t){return sn(t==null?void 0:t.lift)}function mi(t){return function(e){if(Eje(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Sr(t,e,n,r,i){return new wje(t,e,n,r,i)}var wje=function(t){ia(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(S8),Cje=Vie(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Yr=function(t){ia(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new QH(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Cje},e.prototype.next=function(n){var r=this;vE(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=zd(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;vE(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;vE(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Gie:(this.currentObservers=null,a.push(n),new S_(function(){r.currentObservers=null,qw(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new rr;return n.source=this,n},e.create=function(n,r){return new QH(n,r)},e}(rr),QH=function(t){ia(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:Gie},e}(Yr),Gi=function(t){ia(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Yr),w8={now:function(){return(w8.delegate||Date).now()},delegate:void 0},Tje=function(t){ia(e,t);function e(n,r,i){n===void 0&&(n=1/0),r===void 0&&(r=1/0),i===void 0&&(i=w8);var s=t.call(this)||this;return s._bufferSize=n,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,n),s._windowTime=Math.max(1,r),s}return e.prototype.next=function(n){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,l=r._windowTime;i||(s.push(n),!o&&s.push(a.now()+l)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),l=0;l<a.length&&!n.closed;l+=s?1:2)n.next(a[l]);return this._checkFinalizedStatuses(n),r},e.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,i=n._timestampProvider,s=n._buffer,o=n._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var l=i.now(),c=0,u=1;u<s.length&&s[u]<=l;u+=2)c=u;c&&s.splice(0,c+1)}},e}(Yr),Rje=function(t){ia(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(S_),eV={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,Zo([t,e],Jo(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},Ije=function(t){ia(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),eV.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&eV.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,qw(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Rje),tV=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=w8.now,t}(),kje=function(t){ia(e,t);function e(n,r){r===void 0&&(r=tV.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(tV),OT=new kje(Ije),xje=OT,Ww=new rr(function(t){return t.complete()});function Wie(t){return t&&sn(t.schedule)}function C8(t){return t[t.length-1]}function T8(t){return sn(C8(t))?t.pop():void 0}function E_(t){return Wie(C8(t))?t.pop():void 0}function Pje(t,e){return typeof C8(t)=="number"?t.pop():e}var R8=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function zie(t){return sn(t==null?void 0:t.then)}function Yie(t){return sn(t[E8])}function Xie(t){return Symbol.asyncIterator&&sn(t==null?void 0:t[Symbol.asyncIterator])}function Jie(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Lje(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Zie=Lje();function Qie(t){return sn(t==null?void 0:t[Zie])}function ese(t){return hO(this,arguments,function(){var n,r,i,s;return pT(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Wc(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,Wc(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Wc(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function tse(t){return sn(t==null?void 0:t.getReader)}function Zr(t){if(t instanceof rr)return t;if(t!=null){if(Yie(t))return Aje(t);if(R8(t))return Oje(t);if(zie(t))return Mje(t);if(Xie(t))return nse(t);if(Qie(t))return Nje(t);if(tse(t))return Dje(t)}throw Jie(t)}function Aje(t){return new rr(function(e){var n=t[E8]();if(sn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Oje(t){return new rr(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Mje(t){return new rr(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Kie)})}function Nje(t){return new rr(function(e){var n,r;try{for(var i=zd(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function nse(t){return new rr(function(e){Fje(t,e).catch(function(n){return e.error(n)})})}function Dje(t){return nse(ese(t))}function Fje(t,e){var n,r,i,s;return fO(this,void 0,void 0,function(){var o,a;return pT(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=pO(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Ad(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function rse(t,e){return e===void 0&&(e=0),mi(function(n,r){n.subscribe(Sr(r,function(i){return Ad(r,t,function(){return r.next(i)},e)},function(){return Ad(r,t,function(){return r.complete()},e)},function(i){return Ad(r,t,function(){return r.error(i)},e)}))})}function ise(t,e){return e===void 0&&(e=0),mi(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Uje(t,e){return Zr(t).pipe(ise(e),rse(e))}function jje(t,e){return Zr(t).pipe(ise(e),rse(e))}function $je(t,e){return new rr(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Bje(t,e){return new rr(function(n){var r;return Ad(n,e,function(){r=t[Zie](),Ad(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return sn(r==null?void 0:r.return)&&r.return()}})}function sse(t,e){if(!t)throw new Error("Iterable cannot be null");return new rr(function(n){Ad(n,e,function(){var r=t[Symbol.asyncIterator]();Ad(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Hje(t,e){return sse(ese(t),e)}function Vje(t,e){if(t!=null){if(Yie(t))return Uje(t,e);if(R8(t))return $je(t,e);if(zie(t))return jje(t,e);if(Xie(t))return sse(t,e);if(Qie(t))return Bje(t,e);if(tse(t))return Hje(t,e)}throw Jie(t)}function w_(t,e){return e?Vje(t,e):Zr(t)}function At(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=E_(t);return w_(t,n)}function Gje(t){return!!t&&(t instanceof rr||sn(t.lift)&&sn(t.subscribe))}function qje(t){return t instanceof Date&&!isNaN(t)}function Me(t,e){return mi(function(n,r){var i=0;n.subscribe(Sr(r,function(s){r.next(t.call(e,s,i++))}))})}var Kje=Array.isArray;function Wje(t,e){return Kje(e)?t.apply(void 0,Zo([],Jo(e))):t(e)}function I8(t){return Me(function(e){return Wje(t,e)})}var zje=Array.isArray,Yje=Object.getPrototypeOf,Xje=Object.prototype,Jje=Object.keys;function ose(t){if(t.length===1){var e=t[0];if(zje(e))return{args:e,keys:null};if(Zje(e)){var n=Jje(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function Zje(t){return t&&typeof t=="object"&&Yje(t)===Xje}function ase(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function Gn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=E_(t),r=T8(t),i=ose(t),s=i.args,o=i.keys;if(s.length===0)return w_([],n);var a=new rr(Qje(s,n,o?function(l){return ase(o,l)}:df));return r?a.pipe(I8(r)):a}function Qje(t,e,n){return n===void 0&&(n=df),function(r){nV(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){nV(e,function(){var f=w_(t[u],e),p=!1;f.subscribe(Sr(r,function(m){s[u]=m,p||(p=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function nV(t,e,n){t?Ad(n,t,e):e()}function e$e(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,f=!1,p=function(){f&&!l.length&&!c&&e.complete()},m=function(g){return c<r?v(g):l.push(g)},v=function(g){c++;var S=!1;Zr(n(g,u++)).subscribe(Sr(e,function(b){e.next(b)},function(){S=!0},void 0,function(){if(S)try{c--;for(var b=function(){var w=l.shift();o||v(w)};l.length&&c<r;)b();p()}catch(w){e.error(w)}}))};return t.subscribe(Sr(e,m,function(){f=!0,p()})),function(){}}function C_(t,e,n){return n===void 0&&(n=1/0),sn(e)?C_(function(r,i){return Me(function(s,o){return e(r,s,i,o)})(Zr(t(r,i)))},n):(typeof e=="number"&&(n=e),mi(function(r,i){return e$e(r,i,t,n)}))}function lse(t){return t===void 0&&(t=1/0),C_(df,t)}function t$e(){return lse(1)}function zw(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t$e()(w_(t,E_(t)))}function n$e(t){return new rr(function(e){Zr(t()).subscribe(e)})}function r$e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=T8(t),r=ose(t),i=r.args,s=r.keys,o=new rr(function(a){var l=i.length;if(!l){a.complete();return}for(var c=new Array(l),u=l,f=l,p=function(v){var g=!1;Zr(i[v]).subscribe(Sr(a,function(S){g||(g=!0,f--),c[v]=S},function(){return u--},void 0,function(){(!u||!g)&&(f||a.next(s?ase(s,c):c),a.complete())}))},m=0;m<l;m++)p(m)});return n?o.pipe(I8(n)):o}var i$e=["addListener","removeListener"],s$e=["addEventListener","removeEventListener"],o$e=["on","off"];function Nl(t,e,n,r){if(sn(n)&&(r=n,n=void 0),r)return Nl(t,e,n).pipe(I8(r));var i=Jo(c$e(t)?s$e.map(function(a){return function(l){return t[a](e,l,n)}}):a$e(t)?i$e.map(rV(t,e)):l$e(t)?o$e.map(rV(t,e)):[],2),s=i[0],o=i[1];if(!s&&R8(t))return C_(function(a){return Nl(a,e,n)})(Zr(t));if(!s)throw new TypeError("Invalid event target");return new rr(function(a){var l=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];return a.next(1<c.length?c:c[0])};return s(l),function(){return o(l)}})}function rV(t,e){return function(n){return function(r){return t[n](e,r)}}}function a$e(t){return sn(t.addListener)&&sn(t.removeListener)}function l$e(t){return sn(t.on)&&sn(t.off)}function c$e(t){return sn(t.addEventListener)&&sn(t.removeEventListener)}function bd(t,e,n){t===void 0&&(t=0),n===void 0&&(n=xje);var r=-1;return e!=null&&(Wie(e)?n=e:r=e),new rr(function(i){var s=qje(t)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function U5(t,e){return t===void 0&&(t=0),e===void 0&&(e=OT),t<0&&(t=0),bd(t,t,e)}function xy(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=E_(t),r=Pje(t,1/0),i=t;return i.length?i.length===1?Zr(i[0]):lse(r)(w_(i,n)):Ww}var u$e=Array.isArray;function d$e(t){return t.length===1&&u$e(t[0])?t[0]:t}function Ga(t,e){return mi(function(n,r){var i=0;n.subscribe(Sr(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function f$e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=d$e(t),t.length===1?Zr(t[0]):new rr(h$e(t))}function h$e(t){return function(e){for(var n=[],r=function(s){n.push(Zr(t[s]).subscribe(Sr(e,function(o){if(n){for(var a=0;a<n.length;a++)a!==s&&n[a].unsubscribe();n=null}e.next(o)})))},i=0;n&&!e.closed&&i<t.length;i++)r(i)}}function p$e(t){return mi(function(e,n){var r=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var c=i;i=null,n.next(c)}o&&n.complete()},l=function(){s=null,o&&n.complete()};e.subscribe(Sr(n,function(c){r=!0,i=c,s||Zr(t(c)).subscribe(s=Sr(n,a,l))},function(){o=!0,(!r||!s||s.closed)&&n.complete()}))})}function m$e(t,e,n,r,i){return function(s,o){var a=n,l=e,c=0;s.subscribe(Sr(o,function(u){var f=c++;l=a?t(l,u,f):(a=!0,u),o.next(l)},i))}}function j5(t){return t<=0?function(){return Ww}:mi(function(e,n){var r=0;e.subscribe(Sr(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function g$e(t){return Me(function(){return t})}function v$e(t,e){return C_(function(n,r){return Zr(t(n,r)).pipe(j5(1),g$e(n))})}function y$e(t,e){e===void 0&&(e=OT);var n=bd(t,e);return v$e(function(){return n})}function Ll(t,e){return e===void 0&&(e=df),t=t??_$e,mi(function(n,r){var i,s=!0;n.subscribe(Sr(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function _$e(t,e){return t===e}function b$e(t,e){return Ll(function(n,r){return n[t]===r[t]})}function cse(t){return mi(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function yc(t,e){return mi(m$e(t,e,arguments.length>=2,!0))}function S$e(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new Yr}:e,r=t.resetOnError,i=r===void 0?!0:r,s=t.resetOnComplete,o=s===void 0?!0:s,a=t.resetOnRefCountZero,l=a===void 0?!0:a;return function(c){var u,f,p,m=0,v=!1,g=!1,S=function(){f==null||f.unsubscribe(),f=void 0},b=function(){S(),u=p=void 0,v=g=!1},w=function(){var k=u;b(),k==null||k.unsubscribe()};return mi(function(k,T){m++,!g&&!v&&S();var I=p=p??n();T.add(function(){m--,m===0&&!g&&!v&&(f=A4(w,l))}),I.subscribe(T),!u&&m>0&&(u=new ky({next:function(C){return I.next(C)},error:function(C){g=!0,S(),f=A4(b,i,C),I.error(C)},complete:function(){v=!0,S(),f=A4(b,o),I.complete()}}),Zr(k).subscribe(u))})(c)}}function A4(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new ky({next:function(){i.unsubscribe(),t()}});return Zr(e.apply(void 0,Zo([],Jo(n)))).subscribe(i)}}function E$e(t,e,n){var r,i,s,o,a=!1;return t&&typeof t=="object"?(r=t.bufferSize,o=r===void 0?1/0:r,i=t.windowTime,e=i===void 0?1/0:i,s=t.refCount,a=s===void 0?!1:s,n=t.scheduler):o=t??1/0,S$e({connector:function(){return new Tje(o,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function w$e(t){return Ga(function(e,n){return t<=n})}function yn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=E_(t);return mi(function(r,i){(n?zw(t,r,n):zw(t,r)).subscribe(i)})}function jt(t,e){return mi(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Sr(r,function(l){i==null||i.unsubscribe();var c=0,u=s++;Zr(t(l,u)).subscribe(i=Sr(r,function(f){return r.next(e?e(l,f,u,c++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function C$e(){return jt(df)}function T$e(t,e){return mi(function(n,r){var i=e;return jt(function(s,o){return t(i,s,o)},function(s,o){return i=o,o})(n).subscribe(r),function(){i=null}})}function R$e(t){return mi(function(e,n){Zr(t).subscribe(Sr(n,function(){return n.complete()},Kw)),!n.closed&&e.subscribe(n)})}function I$e(t,e,n){var r=sn(t)||e||n?{next:t,error:e,complete:n}:t;return r?mi(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Sr(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):df}function $5(t,e){return mi(function(n,r){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,l=a===void 0?!1:a,c=!1,u=null,f=null,p=!1,m=function(){f==null||f.unsubscribe(),f=null,l&&(S(),p&&r.complete())},v=function(){f=null,p&&r.complete()},g=function(b){return f=Zr(t(b)).subscribe(Sr(r,m,v))},S=function(){if(c){c=!1;var b=u;u=null,r.next(b),!p&&g(b)}};n.subscribe(Sr(r,function(b){c=!0,u=b,!(f&&!f.closed)&&(o?S():g(b))},function(){p=!0,!(l&&c&&f&&!f.closed)&&r.complete()}))})}function k$e(t,e,n){e===void 0&&(e=OT);var r=bd(t,e);return $5(function(){return r},n)}function x$e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=T8(t);return mi(function(r,i){for(var s=t.length,o=new Array(s),a=t.map(function(){return!1}),l=!1,c=function(f){Zr(t[f]).subscribe(Sr(i,function(p){o[f]=p,!l&&!a[f]&&(a[f]=!0,(l=a.every(df))&&(a=null))},Kw))},u=0;u<s;u++)c(u);r.subscribe(Sr(i,function(f){if(l){var p=Zo([f],Jo(o));i.next(n?n.apply(void 0,Zo([],Jo(p))):p)}}))})}function P$e(t,e,n){if(!n)return _.useState(e)[0];const[r]=_.useState(()=>new Gi(n)),[i]=_.useState(()=>e(r)),s=_.useRef(!0);return t(()=>{if(s.current){s.current=!1;return}r.next(n)},n),i}function Fh(t,e){return P$e(_.useEffect,t,e)}var L$e=()=>new Yr,A$e=t=>t+1|0,O$e=()=>{const t=_.useState(0)[1];return _.useRef(()=>t(A$e)).current},use=typeof window>"u"?_.useEffect:_.useLayoutEffect,iV=t=>{var e;return(e=t[1])!=null&&e.next?t[1]:{next:t[1],error:t[2],complete:t[3]}};function M$e(t,e){const n=_.useRef(e),r=_.useRef(),i=_.useRef();return use(()=>{n.current=e,r.current=iV(e)}),t(()=>{const s=n.current[0];r.current||(r.current=iV(n.current));const o=s.subscribe({next:a=>{var l,c;s===n.current[0]&&((c=(l=r.current).next)==null||c.call(l,a))},error:a=>{s===n.current[0]&&(r.current.error?r.current.error(a):console.error(a))},complete:()=>{var a,l;s===n.current[0]&&((l=(a=r.current).complete)==null||l.call(a))}});return i.current=o,()=>{o.unsubscribe()}},[e[0]]),i}function N$e(t,e,n,r){return M$e(_.useEffect,[t,e,n,r])}function D$e(t,e,n){if(Gje(e)){const r=e,[i,s]=_.useState(()=>r instanceof Gi||r.value!==void 0?r.value:n);return t(r,s),_.useDebugValue(i),i}else{const r=e,[i,s]=_.useState(n),[o]=_.useState(L$e),[a]=_.useState(()=>r(o,i)),l=_.useRef(c=>o.next(c)).current;return t(a,s),_.useDebugValue(i),[i,l]}}function Py(t,e){return D$e(N$e,t,e)}function Je(t){const e=O$e(),n=_.useRef(t),r=_.useRef(),i=_.useRef(!1),s=_.useRef(!1),[o,a]=_.useState(()=>{let l;return t.subscribe({next:c=>{s.current=!0,l=c},error:c=>{r.current=c}}).unsubscribe(),l});if(use(()=>{n.current=t}),_.useEffect(()=>{r.current=null;const l=n.current;let c=o;const u=l.subscribe({next:f=>{l===n.current&&(i.current?a(()=>f):c=f)},error:f=>{l===n.current&&(r.current=f,e())}});return i.current||c!==o&&a(()=>c),i.current=!0,()=>{u.unsubscribe()}},[t]),r.current)throw r.current;if(s.current)return _.useDebugValue(o),o;throw new Error("Observable did not synchronously emit a value.")}function F$e(t){const[e]=_.useState(()=>new Gi(t)),[n]=_.useState(()=>({get current(){return e.value},set current(r){e.next(r)}}));return[n,e]}class Qr{constructor(e,n){this.defaultValue=n,this.setValue=s=>{this._value$.next(s),localStorage.setItem(this.key,JSON.stringify(s))},this.getValue=()=>this._value$.getValue(),this.key=`matrix-setting-${e}`;const r=localStorage.getItem(this.key);let i=n;if(r!==null)try{i=JSON.parse(r)}catch(s){O.warn(`Invalid value stored for setting ${e}: ${r}.`,s)}this._value$=new Gi(i),this.value$=this._value$}}function bn(t){return[Je(t.value$),t.setValue]}const dse=new Qr("opt-in-analytics",null),MT=()=>{const t=bn(dse);return xt.instance.isEnabled()?t:[!1,null]},k8=new Qr("developer-settings-tab",!1),fse=new Qr("duplicate-tiles",0),hse=new Qr("show-non-member-tiles",!1),x8=new Qr("debug-tile-layout",!1),Ly=new Qr("show-connection-stats",!1),U$e=new Qr("audio-input",void 0),pse=new Qr("audio-output",void 0),j$e=new Qr("video-input",void 0),mse=new Qr("background-blur",!1),gse=new Qr("hand-raised-show-timer",!1),vse=new Qr("reactions-show",!0),P8=new Qr("reactions-play-sound",!0),yse=new Qr("sound-effect-volume",.5),_se=new Qr("new-membership-manager",!0),L8=new Qr("experimental-to-device-transport",!0),bse=new Qr("mute-all-audio",!1),sV=new Qr("always-show-self",!0),Sse=new Qr("always-show-iphone-earpiece",!1);var NT=(t=>(t[t.Guest=0]="Guest",t[t.Registered=1]="Registered",t))(NT||{});const Cl=class Cl{constructor(e){this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.optInListener=null,this.sanitizeProperties=(i,s)=>(this.anonymity==1&&(i.$referrer=null,i.$referring_domain=null,i.$initial_referrer=null,i.$initial_referring_domain=null,i.$device_id=null),i.$current_url=i.$current_url.split("/").slice(0,3).join(""),i),this.eventCallEnded=new ije,this.eventSignup=new oje,this.eventCallStarted=new sje,this.eventLogin=new aje,this.eventMuteMicrophone=new lje,this.eventMuteCamera=new cje,this.eventUndecryptableToDevice=new uje,this.eventQualitySurvey=new dje,this.eventCallDisconnected=new fje,this.eventCallConnectDuration=new hje;let n,r;n=Ri().posthogApiKey??void 0,r=Ri().posthogApiHost??void 0,n&&r?(this.posthog.init(n,{api_host:r,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0):(O.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1)}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new Cl(DUe)),this.internalInstance}static resetInstance(){this.internalInstance=null}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){var n,r;return{appVersion:"dev",matrixBackend:Ze?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:Ze||(r=(n=window.matrixclient)==null?void 0:n.getCrypto())==null?void 0:r.getVersion()}}capture(e,n,r){this.enabled&&this.posthog.capture(e,{...n},r)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(e==0||e==1)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map(e=>e.toString(16)).join("")}async identifyUser(e){if(this.anonymity==2&&this.enabled){let n=await this.getAnalyticsId();try{if(!n&&!Ze){const r=e();await this.setAccountAnalyticsId(r),n=await this.hashedEcAnalyticsId(r)}}catch(r){O.log("Unable to identify user for tracking"+(r==null?void 0:r.toString()))}n?this.posthog.identify(n):O.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const e=window.matrixclient;let n;if(Ze)n=Ri().posthogUserId;else{const r=await e.getAccountDataFromServer(Cl.ANALYTICS_EVENT_TYPE);n=(r==null?void 0:r.id)??null}return n?await this.hashedEcAnalyticsId(n):null}async hashedEcAnalyticsId(e){const n=window.matrixclient,r="ec"+e+n.getUserId(),i=await crypto.subtle.digest("sha-256",new TextEncoder().encode(r)),s=new Int32Array(i);return Array.from(s).map(o=>Math.abs(o).toString(16).padStart(2,"0")).join("")}async setAccountAnalyticsId(e){if(!Ze){const n=window.matrixclient,r=await n.getAccountDataFromServer(Cl.ANALYTICS_EVENT_TYPE);await n.setAccountData(Cl.ANALYTICS_EVENT_TYPE,Object.assign({id:e},r))}}getAnonymity(){return this.anonymity}logout(){var e;this.enabled&&this.posthog.reset(),(e=this.optInListener)==null||e.unsubscribe(),this.optInListener=null,this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch(()=>O.log("Could not identify user on login status change"))}updateSuperProperties(){this.platformSuperProperties=Cl.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:this.registrationType==0?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(this.anonymity===2&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(Cl.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),this.anonymity!==0&&this.updateSuperProperties())}trackEvent({eventName:e,...n},r){const i=()=>{this.anonymity==0||this.anonymity==1||this.capture(e,n,r)};this.identificationPromise?this.identificationPromise.then(i,s=>{O.error("Failed to identify user for tracking",s)}):i()}startListeningToSettingsChanges(){this.optInListener??(this.optInListener=dse.value$.subscribe(e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch(()=>O.log("Could not identify user"))}))}setRegistrationType(e){this.registrationType=e,!(this.anonymity==0||this.anonymity==1)&&this.updateSuperProperties()}};Cl.ANALYTICS_EVENT_TYPE="im.vector.analytics",Cl.internalInstance=null;let xt=Cl;const $$e=2*60*1e3;class B$e{async forceFlush(){}onStart(e){try{switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipStart(e);return;case"matrix.groupCallMembership.summaryReport":this.onSummaryReportStart(e);return}}catch(n){O.debug(n)}}onEnd(e){switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipEnd(e);return}}get prevCall(){const e=localStorage.getItem("matrix-prev-call");if(e===null)return null;try{return JSON.parse(e)}catch(n){return O.warn("Invalid prev call data",e,"error:",n),null}}set prevCall(e){localStorage.setItem("matrix-prev-call",JSON.stringify(e))}onGroupCallMembershipStart(e){const n=this.prevCall,r=e.attributes["matrix.confId"];if(n!==null&&r===n.callId){const i=UB(e.startTime)-n.hangupTs;i<=$$e&&xt.instance.trackEvent({eventName:"Rejoin",callId:n.callId,rejoinDuration:i})}}onGroupCallMembershipEnd(e){this.prevCall={callId:e.attributes["matrix.confId"],hangupTs:UB(e.endTime)}}onSummaryReportStart(e){const n=e.events.find(r=>r.name==="matrix.stats.summary");if(n!==void 0){const r=n.attributes;if(r){const i=`${r["matrix.stats.summary.percentageReceivedMedia"]}`,s=`${r["matrix.stats.summary.percentageReceivedVideoMedia"]}`,o=`${r["matrix.stats.summary.percentageReceivedAudioMedia"]}`,a=`${r["matrix.stats.summary.maxJitter"]}`,l=`${r["matrix.stats.summary.maxPacketLoss"]}`,c=`${r["matrix.stats.summary.peerConnections"]}`,u=`${r["matrix.stats.summary.percentageConcealedAudio"]}`,f=`${r["matrix.stats.summary.opponentUsersInCall"]}`,p=`${r["matrix.stats.summary.opponentDevicesInCall"]}`,m=`${r["matrix.stats.summary.diffDevicesToPeerConnections"]}`,v=`${r["matrix.stats.summary.ratioPeerConnectionToDevices"]}`;xt.instance.trackEvent({eventName:"MediaReceived",callId:e.attributes["matrix.confId"],mediaReceived:i,audioReceived:o,videoReceived:s,maxJitter:a,maxPacketLoss:l,peerConnections:c,percentageConcealedAudio:u,opponentUsersInCall:f,opponentDevicesInCall:p,diffDevicesToPeerConnections:m,ratioPeerConnectionToDevices:v},{send_instantly:!0})}}}async shutdown(){return Promise.resolve()}}const oV=t=>Object.entries(t).map(([e,n])=>({key:e,type:typeof n,value:n}));class H$e{constructor(){this.spans=[]}async forceFlush(){}onStart(e){this.spans.push(e)}onEnd(){}dump(){const e=Date.now()*1e3,n=new Map;for(const s of this.spans){const o=s.spanContext().traceId;let a=n.get(o);a===void 0&&(a=[],n.set(o,a)),a.push(s)}const r="p1",i={[r]:{serviceName:"element-call",tags:[]},warnings:null};return JSON.stringify({total:0,limit:0,offset:0,errors:null,data:[...n.entries()].map(([s,o])=>({traceID:s,warnings:null,processes:i,spans:o.map(a=>{const l=a.spanContext(),c=m4(a.startTime),u=a.duration[0]===-1?e-c:m4(a.duration);return{traceID:s,spanID:l.spanId,operationName:a.name,processID:r,warnings:null,startTime:c,duration:u,references:a.parentSpanId===void 0?[]:[{refType:"CHILD_OF",traceID:s,spanID:a.parentSpanId}],tags:oV(a.attributes),logs:a.events.map(f=>({timestamp:m4(f.time),fields:[...oV(f.attributes??{}),{key:"event",type:"string",value:f.name}]}))}})}))})}async shutdown(){}}const V$e="element-call";let Bf;class DT{static globalInit(){(!Bf||Bf.isOtlpEnabled!==!1)&&(O.info("(Re)starting OpenTelemetry debug reporting"),Bf==null||Bf.dispose(),Bf=new DT(void 0,Ese()))}static get instance(){return Bf}constructor(e,n){const r={resource:new c5({[sFe.SERVICE_NAME]:V$e})};this._provider=new PNe(r),e?(O.info("Enabling OTLP collector with URL "+e),this.otlpExporter=new TNe({url:e}),this._provider.addSpanProcessor(new _7e(this.otlpExporter))):O.info("OTLP collector disabled"),n&&(this.rageshakeProcessor=new H$e,this._provider.addSpanProcessor(this.rageshakeProcessor)),this._provider.addSpanProcessor(new B$e),f4.trace.setGlobalTracerProvider(this._provider),this._tracer=f4.trace.getTracer("my-element-call-otl-tracer")}dispose(){var e;f4.trace.disable(),(e=this._provider)==null||e.shutdown().catch(n=>{O.error("Failed to shutdown OpenTelemetry",n)})}get isOtlpEnabled(){return!!this.otlpExporter}get tracer(){return this._tracer}get provider(){return this._provider}}const aV=async t=>{const{gzip:e}=await X1(async()=>{const{gzip:r}=await import("./pako.esm-BMdhWMX1.js");return{gzip:r}},[],import.meta.url),n=new TextEncoder().encode(t);return new Blob([e(n)])};async function G$e(t,e){e.append("crypto_version",t.getVersion());const n=await t.getOwnDeviceKeys(),r=[`curve25519:${n.curve25519}`,`ed25519:${n.ed25519}`];e.append("device_keys",r.join(", "));const i=await t.getCrossSigningStatus();e.append("cross_signing_ready",String(await t.isCrossSigningReady())),e.append("cross_signing_key",await t.getCrossSigningKeyId()??"n/a"),e.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),e.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),e.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),e.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function q$e(t,e,n){const r=t.secretStorage;n.append("secret_storage_ready",String(await e.isSecretStorageReady())),n.append("secret_storage_key_in_account",String(await r.hasKey())),n.append("session_backup_key_in_secret_storage",String(!!await t.isKeyBackupKeyStored()));const i=await e.getSessionBackupPrivateKey();n.append("session_backup_key_cached",String(!!i)),n.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function Ese(){return Ri().rageshakeSubmitUrl??void 0}function FT(t=Ese){const{client:e}=tp(),[{sending:n,sent:r,error:i},s]=_.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:_.useCallback(async a=>{const l=t();if(!l)throw new Error("No rageshake URL is configured");if(!n)try{s({sending:!0,sent:!1,error:void 0});let c="UNKNOWN";window.navigator&&window.navigator.userAgent&&(c=window.navigator.userAgent);let u="UNKNOWN";try{u=String(window.matchMedia("(pointer: coarse)").matches)}catch(v){O.warn("Could not get coarse pointer for rageshake submit.",v)}let f=a.rageshakeRequestId?`Rageshake ${a.rageshakeRequestId}`:"";a.description&&(f+=`: ${a.description}`);const p=new FormData;if(p.append("text",f??"User did not supply any additional text."),p.append("app","matrix-video-chat"),p.append("version","dev"),p.append("user_agent",c),p.append("installed_pwa","false"),p.append("touch_input",u),p.append("call_backend","livekit"),p.append("hostname",window.location.hostname),e){const v=e.getUserId(),g=e.getUser(v);p.append("display_name",(g==null?void 0:g.displayName)??""),p.append("user_id",e.credentials.userId??""),p.append("device_id",e.deviceId??""),a.roomId&&p.append("room_id",a.roomId);const S=e.getCrypto();S&&(await G$e(S,p),await q$e(e,S,p))}if(a.label&&p.append("label",a.label),navigator.storage&&navigator.storage.persisted)try{p.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(v){O.warn("coulr not get navigator peristed storage",v)}else if(document.hasStorageAccess)try{p.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(v){O.warn("could not get storage access",v)}if(navigator.storage&&navigator.storage.estimate)try{const v=await navigator.storage.estimate();p.append("storageManager_quota",String(v.quota)),p.append("storageManager_usage",String(v.usage)),v.usageDetails&&Object.keys(v.usageDetails).forEach(g=>{p.append(`storageManager_usage_${g}`,String(v.usageDetails[g]))})}catch(v){O.warn("could not obatain storage estimate",v)}if(a.sendLogs){const v=await h8e();for(const g of v)p.append("compressed-log",await aV(g.lines),g.id);p.append("file",await aV(DT.instance.rageshakeProcessor.dump()),"traces.json.gz")}a.rageshakeRequestId&&p.append("group_call_rageshake_request_id",a.rageshakeRequestId);const m=await fetch(l,{method:"POST",body:p});if(m.status!==200)throw new Error(`Failed to submit feedback: receive HTTP ${m.status} ${m.statusText}`);s({sending:!1,sent:!0,error:void 0})}catch(c){s({sending:!1,sent:!1,error:c}),O.error(c)}},[e,n,t]),sending:n,sent:r,error:i,available:!!t()}}function K$e(){const{client:t}=tp();return _.useCallback((n,r)=>{t.sendEvent(n,"org.matrix.rageshake_request",{request_id:r}).catch(i=>{O.error("Failed to send org.matrix.rageshake_request event",i)})},[t])}function W$e(t){const[e,n]=_.useState(!1),r=_.useCallback(()=>n(!1),[n]),{client:i}=tp(),[s,o]=_.useState();return _.useEffect(()=>{if(!i)return;const a=l=>{l.getType()==="org.matrix.rageshake_request"&&t===l.getRoomId()&&i.getUserId()!==l.getSender()&&(o(l.getContent().request_id),n(!0))};return i.on(Ae.Event,a),()=>{i.removeListener(Ae.Event,a)}},[n,t,i]),{rageshakeRequestId:s??"",roomId:t,open:e,onDismiss:r}}const z$e=({description:t})=>{var l;const{submitRageshake:e,sending:n,sent:r,error:i}=FT(),{t:s}=et(),o=_.useCallback(()=>{e({description:t,sendLogs:!0}).catch(c=>{O.error("Failed to send rageshake",c)})},[e,t]);if(!((l=Zt.get().rageshake)!=null&&l.submit_url))return null;let a=null;if(n)a=E.jsx("span",{children:s("rageshake_sending")});else if(r)a=E.jsx("div",{children:s("rageshake_sent")});else{let c=s("rageshake_send_logs");i&&(c=s("rageshake_button_error_caption")),a=E.jsx(Dt,{onClick:o,className:OB.wideButton,disabled:n,children:c})}return E.jsx("div",{className:OB.rageshakeControl,children:a})},Y$e="_error_19mk1_1",X$e="_icon_19mk1_9",YS={error:Y$e,icon:X$e},J$e="_endCall_bwclo_8",Z$e={endCall:J$e},wse=({muted:t,...e})=>{const{t:n}=et(),r=t?Pne:JO,i=n(t?"unmute_microphone_button_label":"mute_microphone_button_label");return E.jsx(Vi,{label:i,children:E.jsx(Dt,{iconOnly:!0,Icon:r,kind:t?"primary":"secondary",...e})})},Cse=({muted:t,...e})=>{const{t:n}=et(),r=t?$5e:Jne,i=n(t?"start_video_button_label":"stop_video_button_label");return E.jsx(Vi,{label:i,children:E.jsx(Dt,{iconOnly:!0,Icon:r,kind:t?"primary":"secondary",...e})})},Tse=t=>{const{t:e}=et();return E.jsx(Vi,{label:e("switch_camera"),children:E.jsx(Dt,{iconOnly:!0,Icon:F5e,kind:"secondary",...t})})},Q$e=({enabled:t,...e})=>{const{t:n}=et(),r=n(t?"stop_screenshare_button_label":"screenshare_button_label");return E.jsx(Vi,{label:r,children:E.jsx(Dt,{iconOnly:!0,Icon:M5e,kind:t?"primary":"secondary",...e})})},Rse=({className:t,...e})=>{const{t:n}=et();return E.jsx(Vi,{label:n("hangup_button_label"),children:E.jsx(Dt,{className:Ne(t,Z$e.endCall),iconOnly:!0,Icon:Sne,destructive:!0,...e})})},Ise=t=>{const{t:e}=et();return E.jsx(Vi,{label:e("common.settings"),children:E.jsx(Dt,{iconOnly:!0,Icon:O5e,kind:"secondary",...t})})},eBe="_external_jhjdf_8",tBe={external:eBe};function kse(t,e){const n=PX(t),r=$X(t,{state:e});return[n,r]}const Bl=_.forwardRef(function({to:e,state:n,...r},i){const[s,o]=kse(e,n);return E.jsx(fxe,{ref:i,...r,href:s,onClick:o})}),vh=_.forwardRef(function({className:e,children:n,...r},i){return E.jsx("a",{ref:i,className:Ne(e,tBe.external),target:"_blank",rel:"noreferrer noopener",...r,children:n})}),A8=_.forwardRef(function({to:e,state:n,...r},i){const[s,o]=kse(e,n);return E.jsx(Dt,{as:"a",ref:i,...r,href:s,onClick:o})});function xse(t){const[e,n]=_.useState(t.memberships),r=_.useCallback(()=>{O.info(`Memberships changed for call in room ${t.room.roomId} (${t.memberships.length} members)`),n(t.memberships)},[t]);return _.useEffect(()=>(t.on(Ar.MembershipsChanged,r),()=>{t.off(Ar.MembershipsChanged,r)}),[t,r]),e}const Pse=_.createContext(void 0),O8=()=>{const t=_.useContext(Pse);if(!t)throw new Error("useReactions must be used within a ReactionsProvider");return t},nBe=({children:t,rtcSession:e,vm:n})=>{const r=xse(e),i=fv(),s=(i==null?void 0:i.state)==="valid"&&i.supportedFeatures.reactions,o=e.room,a=o.client.getUserId(),l=o.client.getDeviceId(),c=`${a}:${l}`,u=_.useMemo(()=>{var b;return(b=r.find(w=>w.sender===a&&w.deviceId===l))==null?void 0:b.eventId},[r,a,l]),f=Je(n.reactions$),p=_.useMemo(()=>c!==void 0?f[c]:void 0,[c,f]),m=Je(n.handsRaised$),v=_.useMemo(()=>c!==void 0?m[c]:void 0,[c,m]),g=_.useCallback(async()=>{if(!c)return;const b=v==null?void 0:v.reactionEventId;if(b)try{await o.client.redactEvent(e.room.roomId,b),O.debug("Redacted raise hand event")}catch(w){throw O.error("Failed to redact reaction event",b,w),w}else try{if(!u)throw new Error("Cannot find own membership event");const w=await o.client.sendEvent(e.room.roomId,ee.Reaction,{"m.relates_to":{rel_type:Tn.Annotation,event_id:u,key:"🖐️"}});O.debug("Sent raise hand event",w.event_id)}catch(w){O.error("Failed to send raised hand",w)}},[u,c,v,e,o]),S=_.useCallback(async b=>{if(!(!c||p)){if(!u)throw new Error("Cannot find own membership event");await o.client.sendEvent(e.room.roomId,b8,{"m.relates_to":{rel_type:Tn.Reference,event_id:u},emoji:b.emoji,name:b.name})}},[u,p,o,c,e]);return E.jsx(Pse.Provider,{value:{supportsReactions:s,toggleRaisedHand:g,sendReaction:S},children:t})},rBe="_raisedButton_unw54_1",iBe="_reactionPopupMenu_unw54_5",sBe="_reactionPopupMenuRoot_unw54_21",oBe="_reactionPopupMenuModal_unw54_21",aBe="_reactionsMenuSection_unw54_47",lBe="_reactionsMenu_unw54_47",cBe="_reactionButton_unw54_81",uBe="_verticalSeperator_unw54_91",dBe="_alert_unw54_99",Ia={raisedButton:rBe,reactionPopupMenu:iBe,reactionPopupMenuRoot:sBe,reactionPopupMenuModal:oBe,reactionsMenuSection:aBe,reactionsMenu:lBe,reactionButton:cBe,verticalSeperator:uBe,alert:dBe};var Lse=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(hBe);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(B5,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(B5,{...r,ref:e,children:n})});Lse.displayName="Slot";var B5=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=mBe(n),s=pBe(r,n.props);return n.type!==_.Fragment&&(s.ref=e?Ql(e,i):i),_.cloneElement(n,s)}return _.Children.count(n)>1?_.Children.only(null):null});B5.displayName="SlotClone";var fBe=({children:t})=>E.jsx(E.Fragment,{children:t});function hBe(t){return _.isValidElement(t)&&t.type===fBe}function pBe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function mBe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var gBe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],vBe=gBe.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Lse:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{}),yBe="VisuallyHidden",H5=_.forwardRef((t,e)=>E.jsx(vBe.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));H5.displayName=yBe;const _Be="_modal_lmgdq_8",bBe="_dialog_lmgdq_14",SBe="_content_lmgdq_21",EBe="_drawer_lmgdq_32",wBe="_close_lmgdq_59",CBe="_header_lmgdq_84",TBe="_body_lmgdq_114",RBe="_tabbed_lmgdq_129",IBe="_handle_lmgdq_133",ys={modal:_Be,dialog:bBe,content:SBe,drawer:EBe,close:wBe,header:CBe,body:TBe,tabbed:RBe,handle:IBe},kBe="_bg_197ap_8",xBe="_animate_197ap_23",PBe="_overlay_197ap_40",xl={bg:kBe,animate:xBe,overlay:PBe},ep=({title:t,hideHeader:e,children:n,className:r,classNameDrawer:i,classNameModal:s,open:o,onDismiss:a,tabbed:l,...c})=>{const{t:u}=et(),f=ET("(hover: none) or (pointer: coarse)"),p=_.useCallback(m=>{m||a==null||a()},[a]);if(f)return E.jsx(Rs.Root,{open:o,onOpenChange:p,dismissible:a!==void 0,children:E.jsxs(Rs.Portal,{children:[E.jsx(Rs.Overlay,{className:Ne(xl.bg)}),E.jsx(Rs.Content,{className:Ne(r,i,xl.overlay,ys.modal,ys.drawer,{[ys.tabbed]:l}),role:"dialog","aria-describedby":void 0,...c,children:E.jsxs("div",{className:ys.content,children:[E.jsxs("div",{className:ys.header,children:[E.jsx("div",{className:ys.handle}),E.jsx(H5,{asChild:!0,children:E.jsx(Rs.Title,{children:t})})]}),E.jsx("div",{className:ys.body,children:n})]})})]})});{const m=E.jsx(MO,{asChild:!0,children:E.jsx(cf,{as:"h2",weight:"semibold",size:"md",children:t})}),v=E.jsxs("div",{className:ys.header,children:[m,a!==void 0&&E.jsx(Ste,{className:ys.close,"data-testid":"modal_close","aria-label":u("action.close"),children:E.jsx(aT,{width:20,height:20})})]});return E.jsx(PO,{open:o,onOpenChange:p,children:E.jsxs(LO,{children:[E.jsx(AO,{className:Ne(xl.bg,xl.animate)}),E.jsx(OO,{asChild:!0,"aria-describedby":void 0,role:"dialog",...c,children:E.jsx(Ote,{className:Ne(r,s,xl.overlay,xl.animate,ys.modal,ys.dialog,{[ys.tabbed]:l}),children:E.jsxs("div",{className:ys.content,children:[e?null:v,e?E.jsx(H5,{asChild:!0,children:m}):null,E.jsx("div",{className:ys.body,children:n})]})})})]})})}},LBe=({raised:t,open:e,...n})=>{const{t:r}=et();return E.jsx(Vi,{label:r("common.reactions"),children:E.jsx(Dt,{className:Ne(t&&Ia.raisedButton),"aria-expanded":e,"aria-haspopup":!0,kind:t||e?"primary":"secondary",iconOnly:!0,Icon:t?Une:A5e,...n})})};function ABe({sendReaction:t,toggleRaisedHand:e,isHandRaised:n,canReact:r,errorText:i}){const{t:s}=et(),[o,a]=_.useState(!1),l=_.useMemo(()=>o?Iy:Iy.slice(0,5),[o]),c=s(n?"action.lower_hand":"action.raise_hand");return E.jsxs(E.Fragment,{children:[i&&E.jsx(LRe,{className:Ia.alert,type:"critical",title:s("error.generic"),children:i}),E.jsxs("div",{className:Ia.reactionPopupMenu,children:[E.jsx("section",{className:Ia.handRaiseSection,children:E.jsx(Vi,{label:c,caption:"H",children:E.jsx(Dt,{kind:n?"primary":"secondary","aria-keyshortcuts":"H","aria-pressed":n,"aria-label":c,onClick:()=>e(),iconOnly:!0,Icon:Une})})}),E.jsx("div",{className:Ia.verticalSeperator}),E.jsx("section",{className:Ia.reactionsMenuSection,children:E.jsx("menu",{className:Ne(o&&Ia.reactionsMenuExpanded,Ia.reactionsMenu),children:l.map((u,f)=>E.jsx("li",{children:E.jsx(Vi,{label:u.name,caption:f<F5?(f+1).toString():void 0,children:E.jsx(Dt,{kind:"secondary",className:Ia.reactionButton,disabled:!r,onClick:()=>t(u),"aria-keyshortcuts":f<F5?(f+1).toString():void 0,children:u.emoji})})},u.name))})}),E.jsx("section",{style:{marginLeft:"var(--cpd-separator-spacing)"},children:E.jsx(Vi,{label:s(o?"action.show_less":"action.show_more"),children:E.jsx(Dt,{iconOnly:!0,"aria-label":s(o?"action.show_less":"action.show_more"),Icon:o?S5e:KPe,kind:"tertiary",onClick:()=>a(!o)})})})]})]})}function OBe({identifier:t,vm:e,...n}){const{t:r}=et(),{toggleRaisedHand:i,sendReaction:s}=O8(),[o,a]=_.useState(!1),[l,c]=_.useState(!1),[u,f]=_.useState(),p=Py(e.handsRaised$.pipe(Me(S=>!!S[t]))),m=Py(e.reactions$.pipe(Me(S=>!S[t])));_.useEffect(()=>{f(void 0)},[l]);const v=_.useCallback(async S=>{try{a(!0),await s(S),f(void 0),c(!1)}catch(b){f(b instanceof Error?b.message:"Unknown error"),O.error("Failed to send reaction",b)}finally{a(!1)}},[s]),g=_.useCallback(()=>{(async()=>{try{a(!0),await i(),c(!1)}catch(b){f(b instanceof Error?b.message:"Unknown error"),O.error("Failed to raise/lower hand",b)}finally{a(!1)}})()},[i]);return E.jsxs(E.Fragment,{children:[E.jsx(LBe,{disabled:o,onClick:()=>c(S=>!S),raised:!!p,open:l,...n}),E.jsx(ep,{open:l,title:r("action.pick_reaction"),hideHeader:!0,classNameModal:Ia.reactionPopupMenuModal,className:Ia.reactionPopupMenuRoot,onDismiss:()=>c(!1),children:E.jsx(ABe,{errorText:u,isHandRaised:!!p,canReact:!o&&!!m,sendReaction:S=>void v(S),toggleRaisedHand:g})})]})}const Ay=({Icon:t,title:e,rageshake:n,fatal:r,children:i,widget:s})=>{const{t:o}=et(),{confineToRoom:a}=sa(),l=_.useCallback(()=>{window.location.href="/"},[]),c=({widget:f})=>{const p=()=>{f.api.transport.send(fi.Close,{}).catch(m=>{O.error("Failed to send close action",m)}).finally(()=>{f.api.transport.stop()})};return E.jsx(Dt,{kind:"primary",onClick:p,children:o("action.close")})},u=()=>r||location.pathname==="/"?E.jsx(Dt,{kind:"tertiary",className:YS.homeLink,onClick:l,children:o("return_home_button")}):E.jsx(A8,{kind:"tertiary",className:YS.homeLink,to:"/",children:o("return_home_button")});return E.jsxs("div",{className:YS.error,children:[E.jsx($Pe,{className:YS.icon,children:E.jsx(t,{})}),E.jsx(cf,{as:"h1",weight:"semibold",size:"md",children:e}),i,n&&E.jsx(z$e,{description:`***Error View***: ${e}`}),s?E.jsx(c,{widget:s}):!a&&E.jsx(u,{})]})};class Ase extends Error{constructor(e,n){super(e),this.richMessage=n}}const MBe=()=>{const{t}=et();return E.jsx(Ay,{widget:Ze,Icon:Dne,title:t("error.open_elsewhere"),children:E.jsx("p",{children:t("error.open_elsewhere_description",{brand:"Element Call"})})})};class NBe extends Ase{constructor(){super("App opened in another tab",E.jsx(MBe,{}))}}const zm=({className:t,children:e})=>{const{hideHeader:n}=sa();return E.jsxs("div",{className:Ne(i4.page,t),children:[!n&&E.jsxs(uf,{children:[E.jsx(Jh,{children:E.jsx(Oh,{})}),E.jsx(Zh,{})]}),E.jsx("div",{className:i4.container,children:E.jsx("div",{className:i4.content,children:e})})]})},Oy=({error:t,widget:e})=>{const{t:n}=et();return _.useEffect(()=>{O.error(t),nT(t)},[t]),E.jsx(zm,{children:t instanceof Ase?t.richMessage:E.jsx(Ay,{widget:e,Icon:oT,title:n("error.generic"),rageshake:!0,fatal:!0,children:E.jsx("p",{children:n("error.generic_description")})})})},UT=()=>{const{t}=et();return E.jsx(zm,{children:E.jsx("h1",{children:t("common.loading")})})},M8=_.createContext(void 0);M8.Provider;const fv=()=>_.useContext(M8);function tp(){var r;let t,e;const n=fv();return(n==null?void 0:n.state)==="valid"&&(t=(r=n.authenticated)==null?void 0:r.client,e=n.setClient),{client:t,setClient:e}}function N8(){var l,c,u;const t=fv();let e,n,r=!1,i=!0,s,o=!1,a;return(t==null?void 0:t.state)==="valid"?(e=(l=t.authenticated)==null?void 0:l.client,n=t.setClient,r=((c=t.authenticated)==null?void 0:c.isPasswordlessUser)??!1,i=!1,o=e!==void 0,a=(u=t.authenticated)==null?void 0:u.logout):(t==null?void 0:t.state)==="error"&&(s=t.error,i=!1),{client:e,setClient:n,passwordlessUser:r,loading:i,authenticated:o,logout:a,error:s}}const XS="BroadcastChannel"in window?new BroadcastChannel("load"):null,DBe=({children:t})=>{const e=Yl(),[n,r]=_.useState(void 0),i=_.useRef(!1);_.useEffect(()=>{i.current||(i.current=!0,FBe().then(w=>{r(w),xt.instance.isEnabled()&&xt.instance.startListeningToSettingsChanges()}).catch(w=>O.error(w)).finally(()=>i.current=!1))},[]);const s=_.useCallback(async w=>{const k=Mse();!(n!=null&&n.client)||!k||(await n.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:k.user_id},user:k.user_id,password:k.tempPassword},w),lV({...k,passwordlessUser:!1}),r({...n,passwordlessUser:!1}))},[n]),o=_.useCallback((w,k)=>{const T=n==null?void 0:n.client;T&&T!==w&&T.stopClient(),lV(k),r({widgetApi:null,client:w,passwordlessUser:k.passwordlessUser}),xt.instance.isEnabled()&&xt.instance.startListeningToSettingsChanges()},[n==null?void 0:n.client]),a=_.useCallback(async()=>{const w=n==null?void 0:n.client;w&&(await w.logout(!0),await w.clearStores(),Ose(),r(null),await e("/"),xt.instance.logout(),xt.instance.setRegistrationType(NT.Guest))},[e,n==null?void 0:n.client]);_.useEffect(()=>{Ze||XS==null||XS.postMessage({})},[]);const[l,c]=_.useState(void 0);x1(XS,"message",_.useCallback(()=>{n==null||n.client.stopClient(),c(new NBe)},[n==null?void 0:n.client,c]));const[u,f]=_.useState(!1),[p,m]=_.useState(!1),[v,g]=_.useState(!1),S=_.useMemo(()=>l?{state:"error",error:l}:n===void 0?void 0:{state:"valid",authenticated:n===null?void 0:{client:n.client,isPasswordlessUser:n.passwordlessUser,changePassword:s,logout:a},setClient:o,disconnected:u,supportedFeatures:{reactions:p,thumbnails:v}},[l,s,n,a,o,u,p,v]),b=_.useCallback((w,k,T)=>{f(UBe(w,T))},[]);return _.useEffect(()=>{if(n){if(window.matrixclient=n.client,window.passwordlessUser=n.passwordlessUser,xt.hasInstance()&&xt.instance.onLoginStatusChanged(),n.client&&n.client.on(Ae.Sync,b),n.widgetApi){g(!1);const w=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.reaction"),k=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.room.redaction"),T=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.reaction"),I=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.room.redaction");!w||!T||!k||!I?(O.warn("Widget does not support reactions"),m(!1)):m(!0)}else m(!0),g(!0);return()=>{n.client&&n.client.removeListener(Ae.Sync,b)}}},[n,b]),l?E.jsx(Oy,{widget:Ze,error:l}):E.jsx(M8.Provider,{value:S,children:t})};async function FBe(){if(Ze){O.log("Using a matryoshka client");const t=await Ze.client;return{widgetApi:Ze.api,client:t,passwordlessUser:!1}}else{const{initSPA:t}=await X1(async()=>{const{initSPA:e}=await import("./spa-xNlFW49y.js");return{initSPA:e}},[],import.meta.url);return t(Mse,Ose)}}const Ose=()=>localStorage.removeItem("matrix-auth-store"),lV=t=>localStorage.setItem("matrix-auth-store",JSON.stringify(t)),Mse=()=>{const t=localStorage.getItem("matrix-auth-store");if(t)return JSON.parse(t)},UBe=(t,e)=>{var n;return t==="ERROR"&&((n=e==null?void 0:e.error)==null?void 0:n.name)==="ConnectionError"};function T_(t){const[{success:e,loading:n,displayName:r,avatarUrl:i,error:s},o]=_.useState(()=>{let l;return t&&(l=t.getUser(t.getUserId())??void 0),{success:!1,loading:!1,displayName:l==null?void 0:l.rawDisplayName,avatarUrl:l==null?void 0:l.avatarUrl,error:void 0}});_.useEffect(()=>{const l=(u,{displayName:f,avatarUrl:p})=>{o({success:!1,loading:!1,displayName:f,avatarUrl:p,error:void 0})};let c;if(t){const u=t.getUserId();c=t.getUser(u),c==null||c.on(Si.DisplayName,l),c==null||c.on(Si.AvatarUrl,l)}return()=>{c&&(c.removeListener(Si.DisplayName,l),c.removeListener(Si.AvatarUrl,l))}},[t]);const a=_.useCallback(async({displayName:l,avatar:c,removeAvatar:u})=>{if(t){o(f=>({...f,loading:!0,error:void 0,success:!1}));try{await t.setDisplayName(l);let f;u?await t.setAvatarUrl(""):c&&({content_uri:f}=await t.uploadContent(c),await t.setAvatarUrl(f)),o(p=>({...p,displayName:l,avatarUrl:u?void 0:f??p.avatarUrl,loading:!1,success:!0}))}catch(f){o(p=>({...p,loading:!1,error:f instanceof Error?f:Error(f),success:!1}))}}else O.error("Client not initialized before calling saveProfile")},[t]);return{loading:n,error:s,displayName:r,avatarUrl:i,saveProfile:a,success:e}}const jBe="_settingsModal_1dkeq_8",$Be="_volumeSlider_1dkeq_20",cV={settingsModal:jBe,volumeSlider:$Be},BBe="_tabContainer_1nnp9_8",HBe="_tabList_1nnp9_14",uV={tabContainer:BBe,tabList:HBe};function VBe({label:t,tab:e,onTabChange:n,tabs:r}){const i=_.useId();return E.jsxs("div",{className:uV.tabContainer,children:[E.jsx(BPe,{role:"tablist","aria-label":t,className:uV.tabList,children:r.map(({key:s,name:o})=>E.jsx(qPe,{"aria-controls":`${i}[${s}]`,onClick:()=>n(s),active:s===e,children:o}))}),r.map(({key:s,content:o})=>E.jsx("div",{id:`${i}[${s}]`,style:{display:s===e?void 0:"none"},children:o}))]})}const GBe="_fieldRow_iwncy_8",qBe="_field_iwncy_8",KBe="_rightAlign_iwncy_21",WBe="_inputField_iwncy_33",zBe="_disabled_iwncy_52",YBe="_prefix_iwncy_110",XBe="_checkboxField_iwncy_131",JBe="_checkbox_iwncy_131",ZBe="_description_iwncy_168",QBe="_errorMessage_iwncy_197",eHe="_noLabel_iwncy_210",Lo={fieldRow:GBe,field:qBe,rightAlign:KBe,inputField:WBe,disabled:zBe,prefix:YBe,checkboxField:XBe,checkbox:JBe,description:ZBe,errorMessage:QBe,noLabel:eHe},tHe=(t,e)=>_.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"m20 6-11 11-5-5"})),nHe=_.forwardRef(tHe);class Nse extends Error{constructor(e,n){super(n(e,{lng:"en"})),this.translatedMessage=n(e)}}class rHe extends Nse{}const dV=(t,e)=>new rHe(t,e);function St({children:t,rightAlign:e,className:n}){return E.jsx("div",{className:Ne(Lo.fieldRow,{[Lo.rightAlign]:e},n),children:t})}function iHe({children:t,className:e}){return E.jsx("div",{className:Ne(Lo.field,e),children:t})}const fn=_.forwardRef(({id:t,label:e,className:n,type:r,checked:i,prefix:s,suffix:o,description:a,disabled:l,min:c,...u},f)=>{const p=_.useId();return E.jsxs(iHe,{className:Ne(r==="checkbox"?Lo.checkboxField:Lo.inputField,{[Lo.prefix]:!!s,[Lo.disabled]:l},n),children:[s&&E.jsx("span",{children:s}),r==="textarea"?E.jsx("textarea",{id:t,ref:f,disabled:l,"aria-describedby":p,...u}):E.jsx("input",{id:t,ref:f,type:r,checked:i,disabled:l,"aria-describedby":p,min:c,...u}),E.jsxs("label",{htmlFor:t,children:[r==="checkbox"&&E.jsx("div",{className:Lo.checkbox,children:E.jsx(nHe,{})}),e]}),o&&E.jsx("span",{children:o}),a&&E.jsx("p",{id:p,className:e?Lo.description:Ne(Lo.description,Lo.noLabel),children:a})]})});fn.displayName="InputField";const ff=({error:t})=>E.jsx("p",{className:Lo.errorMessage,children:t instanceof Nse?t.translatedMessage:t.message}),sHe="_avatarInputField_1ep5q_8",oHe="_avatar_1ep5q_8",aHe="_fileInput_1ep5q_17",lHe="_edit_1ep5q_21",JS={avatarInputField:sHe,avatar:oHe,fileInput:aHe,edit:lHe},Dse=({id:t,label:e,className:n,avatarUrl:r,userId:i,displayName:s,onRemoveAvatar:o,...a})=>{const{t:l}=et(),[c,u]=_.useState(!1),[f,p]=_.useState(void 0),[m,v]=_.useState(!1),g=_.useRef(null);_.useEffect(()=>{const w=g.current,k=T=>{const I=T;I.target.files&&I.target.files.length>0?(p(URL.createObjectURL(I.target.files[0])),u(!1)):p(void 0)};return w.addEventListener("change",k),()=>{w==null||w.removeEventListener("change",k)}});const S=_.useCallback(()=>{g.current.click()},[g]),b=_.useCallback(()=>{u(!0),o()},[o]);return E.jsxs("div",{className:Ne(JS.avatarInputField,n),children:[E.jsx(lv,{id:i,className:JS.avatar,name:s,size:av.XL,src:c?void 0:f||r}),E.jsx("input",{id:t,accept:"image/*",ref:g,type:"file",className:JS.fileInput,role:"button","aria-label":e,...a}),E.jsx("div",{className:JS.edit,children:(r||f)&&!c?E.jsxs($O,{title:l("action.edit"),showTitle:!1,open:m,onOpenChange:v,trigger:E.jsx(Dt,{iconOnly:!0,Icon:yB,kind:"tertiary",size:"sm","aria-label":l("action.edit")}),children:[E.jsx(Eg,{Icon:N5e,label:l("action.upload_file"),onSelect:S}),E.jsx(Eg,{Icon:w5e,label:l("action.remove"),kind:"critical",onSelect:b})]}):E.jsx(Dt,{type:"button",iconOnly:!0,Icon:yB,kind:"tertiary",size:"sm","aria-label":l("action.edit"),onClick:S})})]})};Dse.displayName="AvatarInputField";const cHe="_content_gj715_8",uHe="_avatarFieldRow_gj715_15",fV={content:cHe,avatarFieldRow:uHe},dHe=({client:t})=>{const{t:e}=et(),{error:n,displayName:r,avatarUrl:i,saveProfile:s}=T_(t),o=_.useMemo(()=>t.getUserId(),[t]),a=_.useRef(null),l=_.useRef(!1),c=_.useCallback(()=>{l.current=!0},[]),u=_.useRef(!1),f=_.useCallback(()=>{u.current=!0,l.current=!0},[]);return _.useEffect(()=>{const p=a.current;return()=>{if(l.current){const m=new FormData(p),v=m.get("displayName"),g=m.get("avatar"),S=typeof g=="string"?g.length:(g==null?void 0:g.size)??0,b=typeof v=="string"?v:(v==null?void 0:v.name)??null;if(!b)return;s({displayName:b,avatar:g&&S>0?g:void 0,removeAvatar:u.current&&(!g||S===0)}).catch(w=>{O.error("Failed to save profile",w)})}}},[s]),E.jsxs("form",{onChange:c,ref:a,className:fV.content,children:[E.jsx(St,{className:fV.avatarFieldRow,children:o&&r&&E.jsx(Dse,{id:"avatar",name:"avatar",label:e("common.avatar"),avatarUrl:i,userId:o,displayName:r,onRemoveAvatar:f})}),E.jsx(St,{children:E.jsx(fn,{id:"userId",name:"userId",label:e("common.username"),type:"text",disabled:!0,value:t.getUserId()})}),E.jsx(St,{children:E.jsx(fn,{id:"displayName",name:"displayName",label:e("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:e("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),n&&E.jsx(St,{children:E.jsx(ff,{error:n})})]})},fHe="_feedback_19yh9_8",Fse={feedback:fHe},Use=()=>E.jsxs(Os,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",E.jsx(vh,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",E.jsx(vh,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),hHe=({roomId:t})=>{const{t:e}=et(),{submitRageshake:n,sending:r,sent:i,error:s,available:o}=FT(),a=K$e(),l=_.useCallback(f=>{f.preventDefault();const p=new FormData(f.target),m=p.get("description"),v=typeof m=="string"?m:"",g=!!p.get("sendLogs"),S=lo(16);n({description:v,sendLogs:g,rageshakeRequestId:S,roomId:t}).catch(b=>{O.error("Failed to send feedback rageshake",b)}),t&&g&&a(t,S)},[n,t,a]);MT();const c=null,u=o?E.jsxs(E.Fragment,{children:[E.jsx("h4",{children:e("settings.feedback_tab_h4")}),E.jsx(ln,{children:e("settings.feedback_tab_body")}),E.jsxs("form",{onSubmit:l,children:[E.jsx(St,{children:E.jsx(fn,{className:Fse.feedback,id:"description",name:"description",label:e("settings.feedback_tab_description_label"),placeholder:e("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&E.jsxs(St,{children:[E.jsx(fn,{id:"sendLogs",name:"sendLogs",label:e("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),E.jsx(Dt,{type:"submit",disabled:r,children:e(r?"submitting":"action.submit")})]}),E.jsxs(St,{children:[s&&E.jsx(ff,{error:s}),i&&E.jsx(ln,{children:e("settings.feedback_tab_thank_you")})]})]})]}):null;return E.jsxs("div",{children:[c,u]})};var yE={exports:{}},pHe=yE.exports,hV;function mHe(){return hV||(hV=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(pHe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&r?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function f(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return c(g)||f.apply(this,arguments)}function m(g,S){var b=this,w,k,T,I="loglevel";typeof g=="string"?I+=":"+g:typeof g=="symbol"&&(I=void 0);function C(F){var $=(i[F]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function x(){var F;if(!(typeof window===n||!I)){try{F=window.localStorage[I]}catch{}if(typeof F===n)try{var $=window.document.cookie,B=encodeURIComponent(I),W=$.indexOf(B+"=");W!==-1&&(F=/^([^;]+)/.exec($.slice(W+B.length+1))[1])}catch{}return b.levels[F]===void 0&&(F=void 0),F}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(F){var $=F;if(typeof $=="string"&&b.levels[$.toUpperCase()]!==void 0&&($=b.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=b.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+F)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return T??k??w},b.setLevel=function(F,$){return T=N(F),$!==!1&&C(T),u.call(b)},b.setDefaultLevel=function(F){k=N(F),x()||b.setLevel(F,!1)},b.resetLevel=function(){T=null,A(),u.call(b)},b.enableAll=function(F){b.setLevel(b.levels.TRACE,F)},b.disableAll=function(F){b.setLevel(b.levels.SILENT,F)},b.rebuild=function(){if(o!==b&&(w=N(o.getLevel())),u.call(b),o===b)for(var F in s)s[F].rebuild()},w=N(o?o.getLevel():"WARN");var D=x();D!=null&&(T=N(D)),u.call(b)}o=new m,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var b=s[S];return b||(b=s[S]=new m(S,o.methodFactory)),b};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(yE)),yE.exports}var gHe=mHe();const vHe=Xa(gHe);var yHe=(t,e,n)=>new Promise((r,i)=>{var s=l=>{try{a(n.next(l))}catch(c){i(c)}},o=l=>{try{a(n.throw(l))}catch(c){i(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((n=n.apply(t,e)).next())});function _He(t){return typeof t>"u"?!1:bHe(t)||SHe(t)}function bHe(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function SHe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function EHe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function wHe(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(EHe(t))return`${t.participant.identity}_${t.source}_placeholder`;if(_He(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}var CHe=[ae.ConnectionStateChanged,ae.RoomMetadataChanged,ae.ActiveSpeakersChanged,ae.ConnectionQualityChanged,ae.ParticipantConnected,ae.ParticipantDisconnected,ae.ParticipantPermissionsChanged,ae.ParticipantMetadataChanged,ae.ParticipantNameChanged,ae.ParticipantAttributesChanged,ae.TrackMuted,ae.TrackUnmuted,ae.TrackPublished,ae.TrackUnpublished,ae.TrackStreamStateChanged,ae.TrackSubscriptionFailed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionStatusChanged],THe=[...CHe,ae.LocalTrackPublished,ae.LocalTrackUnpublished];se.TrackPublished,se.TrackUnpublished,se.TrackMuted,se.TrackUnmuted,se.TrackStreamStateChanged,se.TrackSubscribed,se.TrackUnsubscribed,se.TrackSubscriptionPermissionChanged,se.TrackSubscriptionFailed,se.LocalTrackPublished,se.LocalTrackUnpublished;var RHe=[se.ConnectionQualityChanged,se.IsSpeakingChanged,se.ParticipantMetadataChanged,se.ParticipantPermissionsChanged,se.TrackMuted,se.TrackUnmuted,se.TrackPublished,se.TrackUnpublished,se.TrackStreamStateChanged,se.TrackSubscriptionFailed,se.TrackSubscriptionPermissionChanged,se.TrackSubscriptionStatusChanged];[...RHe,se.LocalTrackPublished,se.LocalTrackUnpublished];var IHe=vHe.getLogger("lk-components-js");IHe.setDefaultLevel("WARN");function kHe(t,...e){return new rr(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(yn(t))}function xHe(t,e){return new rr(r=>{const i=(...o)=>{r.next(o)};return t.on(e,i),()=>{t.off(e,i)}})}function PHe(t,e,n=!0){var r;const i=()=>yHe(this,null,function*(){try{const a=yield iu.getLocalDevices(t,n);s.next(a)}catch(a){e==null||e(a)}}),s=new Yr,o=s.pipe(cse(()=>{var a;(a=navigator==null?void 0:navigator.mediaDevices)==null||a.removeEventListener("devicechange",i)}));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(r=navigator==null?void 0:navigator.mediaDevices)==null||r.addEventListener("devicechange",i)}return zw(iu.getLocalDevices(t,n).catch(a=>(e==null||e(a),[])),o)}function D8(t,...e){return new rr(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(yn(t))}function F8(t){return D8(t,se.TrackMuted,se.TrackUnmuted,se.ParticipantPermissionsChanged,se.TrackPublished,se.TrackUnpublished,se.LocalTrackPublished,se.LocalTrackUnpublished,se.MediaDevicesError,se.TrackSubscriptionStatusChanged).pipe(Me(n=>{const{isMicrophoneEnabled:r,isCameraEnabled:i,isScreenShareEnabled:s}=n,o=n.getTrackPublication(ue.Source.Microphone),a=n.getTrackPublication(ue.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:r,isScreenShareEnabled:s,cameraTrack:a,microphoneTrack:o,participant:n}}))}function LHe(t,e={}){var n;let r;const i=new rr(l=>(r=l,()=>a.unsubscribe())).pipe(yn(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:THe,o=Array.from(new Set([ae.ParticipantConnected,ae.ParticipantDisconnected,ae.ConnectionStateChanged,...s])),a=kHe(t,...o).subscribe(l=>r==null?void 0:r.next(Array.from(l.remoteParticipants.values())));return t.remoteParticipants.size>0&&(r==null||r.next(Array.from(t.remoteParticipants.values()))),i}new TextEncoder;new TextDecoder;const um=new Yr,jse=new Gi([]),$se=new Gi(void 0),V5=new Yr;window.controls={canEnterPip(){return um.observed},enablePip(){if(!um.observed)throw new Error("No call is running");um.next(!0)},disablePip(){if(!um.observed)throw new Error("No call is running");um.next(!1)},setAvailableAudioDevices(t){jse.next(t)},setAudioDevice(t){$se.next(t)},setAudioEnabled(t){if(!V5.observed)throw new Error("Output controls are disabled. No setAudioEnabled$ observer");V5.next(t)},setOutputEnabled(t){this.setAudioEnabled(t)},setAvailableOutputDevices(t){this.setAvailableAudioDevices(t)},setOutputDevice(t){this.setAudioDevice(t)}};const G5="earpiece-id",Bse=Sse.value$.pipe(Me(t=>t||navigator.userAgent.includes("iPhone")));function Hse(t,e){return _.useMemo(()=>{if(t.size)return e!==void 0&&t.has(e)||t.size===1&&t.has("")?e:t.keys().next().value},[t,e])}function q5(t,e,n){const r=_.useRef(!1),i=n||r.current;r.current||(r.current=n);const s=_.useMemo(()=>PHe(t,()=>O.error("Error creating MediaDeviceObserver"),i).pipe(yn([])),[t,i]),o=Je(_.useMemo(()=>s.pipe(Me(f=>{var m;let p=new Map(f.map((v,g)=>[v.deviceId,v.label?{type:"name",name:v.label}:{type:"number",number:g+1}]));return t==="audiooutput"&&!p.has("")&&!p.has("default")&&p.size&&(p=new Map([["",{type:"default",name:((m=f[0])==null?void 0:m.label)||null}],...p])),p})),[s,t])),[a,l]=bn(e),c=Hse(o,a),u=Je(_.useMemo(()=>s.pipe(Me(f=>{var p;return(p=f.find(m=>m.deviceId===c))==null?void 0:p.groupId})),[s,c]));return _.useMemo(()=>({available:o,selectedId:c,useAsEarpiece:!1,selectedGroupId:u,select:l}),[o,c,u,l])}const O4={available:new Map,selectedId:void 0,selectedGroupId:void 0,select:()=>{},useAsEarpiece:!1},AHe={audioInput:O4,audioOutput:O4,videoInput:O4,startUsingDeviceNames:()=>{},stopUsingDeviceNames:()=>{}},Vse=_.createContext(AHe);function OHe(){const[t,e]=_.useState(0),n=t>0,r=q5("audioinput",U$e,n),i=q5("videoinput",j$e,n),s=_.useCallback(()=>e(a=>a+1),[e]),o=_.useCallback(()=>e(a=>a-1),[e]);return{audioInput:r,videoInput:i,startUsingDeviceNames:s,stopUsingDeviceNames:o,usingNames:n}}const MHe=({children:t})=>{const{audioInput:e,videoInput:n,startUsingDeviceNames:r,stopUsingDeviceNames:i,usingNames:s}=OHe(),{controlledAudioDevices:o}=sa(),a=q5("audiooutput",pse,s),l=NHe(),c=_.useMemo(()=>({audioInput:e,audioOutput:o?l:a,videoInput:n,startUsingDeviceNames:r,stopUsingDeviceNames:i}),[e,o,l,a,n,r,i]);return E.jsx(Vse.Provider,{value:c,children:t})};function NHe(){const{available:t}=Je(Fh(()=>{const o=jse.pipe(Me(a=>{const l=a.find(u=>u.forEarpiece),c=a.map(({id:u,name:f,isEarpiece:p,isSpeaker:m})=>{let v={type:"name",name:f};return p&&(v={type:"earpiece"}),m&&(v={type:"default",name:f}),[u,v]});return{devicesMap:new Map(c),deviceForEarpiece:l}}));return Gn([o,Bse],({devicesMap:a,deviceForEarpiece:l},c)=>{let u=a;return c&&l&&(u=new Map([...a.entries(),[G5,{type:"earpiece"}]])),{available:u,deviceForEarpiece:l}})})),[e,n]=bn(pse);_.useEffect(()=>{const o=$se.subscribe(a=>{a&&n(a)});return()=>o.unsubscribe()},[n]);const r=Hse(t,e),[i,s]=_.useState(!1);return _.useEffect(()=>{var o,a,l,c;r&&((a=(o=window.controls).onAudioDeviceSelect)==null||a.call(o,r),(c=(l=window.controls).onOutputDeviceSelect)==null||c.call(l,r)),s(r===G5)},[r]),_.useMemo(()=>({available:t,selectedId:r,selectedGroupId:void 0,select:n,useAsEarpiece:i}),[t,r,n,i])}const hf=()=>_.useContext(Vse),DHe=(t,e=!0)=>_.useEffect(()=>{if(e)return t.startUsingDeviceNames(),t.stopUsingDeviceNames},[t,e]),Gse=()=>{const{audioOutput:t}=hf(),e=_.useMemo(()=>t.useAsEarpiece?1:0,[t.useAsEarpiece]),n=_.useMemo(()=>t.useAsEarpiece?.1:1,[t.useAsEarpiece]);return{pan:e,volume:n}},FHe=()=>{const{t}=et(),[e,n]=bn(gse),[r,i]=bn(vse),[s,o]=bn(P8),a=(u,f)=>{f(u.target.checked)},[l,c]=bn(k8);return E.jsxs("div",{children:[E.jsx(ln,{children:t("settings.preferences_tab.introduction")}),E.jsx(St,{children:E.jsx(fn,{id:"showHandRaisedTimer",label:t("settings.preferences_tab.show_hand_raised_timer_label"),description:t("settings.preferences_tab.show_hand_raised_timer_description"),type:"checkbox",checked:e,onChange:u=>a(u,n)})}),E.jsx(St,{children:E.jsx(fn,{id:"showReactions",label:t("settings.preferences_tab.reactions_show_label"),description:t("settings.preferences_tab.reactions_show_description"),type:"checkbox",checked:r,onChange:u=>a(u,i)})}),E.jsx(St,{children:E.jsx(fn,{id:"playReactionSound",label:t("settings.preferences_tab.reactions_play_sound_label"),description:t("settings.preferences_tab.reactions_play_sound_description"),type:"checkbox",checked:s,onChange:u=>a(u,o)})}),E.jsx(St,{children:E.jsx(fn,{id:"developerSettingsTab",type:"checkbox",checked:l,label:t("settings.preferences_tab.developer_mode_label"),description:t("settings.preferences_tab.developer_mode_label_description"),onChange:u=>c(u.target.checked)})})]})};function qse(t,[e,n]){return Math.min(n,Math.max(e,t))}function UHe(t){const e=_.useRef({value:t,previous:t});return _.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var Yw=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find($He);if(s){const o=s.props.children,a=i.map(l=>l===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:l);return E.jsx(K5,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return E.jsx(K5,{...r,ref:e,children:n})});Yw.displayName="Slot";var K5=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=HHe(n),s=BHe(r,n.props);return n.type!==_.Fragment&&(s.ref=e?Ql(e,i):i),_.cloneElement(n,s)}return _.Children.count(n)>1?_.Children.only(null):null});K5.displayName="SlotClone";var jHe=({children:t})=>E.jsx(E.Fragment,{children:t});function $He(t){return _.isValidElement(t)&&t.type===jHe}function BHe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function HHe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var VHe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],jT=VHe.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Yw:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),E.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function GHe(t){const e=t+"CollectionProvider",[n,r]=Zl(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:v,children:g}=m,S=Se.useRef(null),b=Se.useRef(new Map).current;return E.jsx(i,{scope:v,itemMap:b,collectionRef:S,children:g})};o.displayName=e;const a=t+"CollectionSlot",l=Se.forwardRef((m,v)=>{const{scope:g,children:S}=m,b=s(a,g),w=hn(v,b.collectionRef);return E.jsx(Yw,{ref:w,children:S})});l.displayName=a;const c=t+"CollectionItemSlot",u="data-radix-collection-item",f=Se.forwardRef((m,v)=>{const{scope:g,children:S,...b}=m,w=Se.useRef(null),k=hn(v,w),T=s(c,g);return Se.useEffect(()=>(T.itemMap.set(w,{ref:w,...b}),()=>void T.itemMap.delete(w))),E.jsx(Yw,{[u]:"",ref:k,children:S})});f.displayName=c;function p(m){const v=s(t+"CollectionConsumer",m);return Se.useCallback(()=>{const S=v.collectionRef.current;if(!S)return[];const b=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((T,I)=>b.indexOf(T.ref.current)-b.indexOf(I.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:l,ItemSlot:f},p,r]}var Kse=["PageUp","PageDown"],Wse=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],zse={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},hv="Slider",[W5,qHe,KHe]=GHe(hv),[Yse,Vnt]=Zl(hv,[KHe]),[WHe,$T]=Yse(hv),Xse=_.forwardRef((t,e)=>{const{name:n,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:f=()=>{},onValueCommit:p=()=>{},inverted:m=!1,form:v,...g}=t,S=_.useRef(new Set),b=_.useRef(0),k=o==="horizontal"?zHe:YHe,[T=[],I]=fT({prop:u,defaultProp:c,onChange:F=>{var B;(B=[...S.current][b.current])==null||B.focus(),f(F)}}),C=_.useRef(T);function x(F){const $=eVe(T,F);D(F,$)}function A(F){D(F,b.current)}function N(){const F=C.current[b.current];T[b.current]!==F&&p(T)}function D(F,$,{commit:B}={commit:!1}){const W=iVe(s),H=sVe(Math.round((F-r)/s)*s+r,W),z=qse(H,[r,i]);I((K=[])=>{const V=ZHe(K,z,$);if(rVe(V,l*s)){b.current=V.indexOf(z);const q=String(V)!==String(K);return q&&B&&p(V),q?V:K}else return K})}return E.jsx(WHe,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:b,thumbs:S.current,values:T,orientation:o,form:v,children:E.jsx(W5.Provider,{scope:t.__scopeSlider,children:E.jsx(W5.Slot,{scope:t.__scopeSlider,children:E.jsx(k,{"aria-disabled":a,"data-disabled":a?"":void 0,...g,ref:e,onPointerDown:Qe(g.onPointerDown,()=>{a||(C.current=T)}),min:r,max:i,inverted:m,onSlideStart:a?void 0:x,onSlideMove:a?void 0:A,onSlideEnd:a?void 0:N,onHomeKeyDown:()=>!a&&D(r,0,{commit:!0}),onEndKeyDown:()=>!a&&D(i,T.length-1,{commit:!0}),onStepKeyDown:({event:F,direction:$})=>{if(!a){const H=Kse.includes(F.key)||F.shiftKey&&Wse.includes(F.key)?10:1,z=b.current,K=T[z],V=s*H*$;D(K+V,z,{commit:!0})}}})})})})});Xse.displayName=hv;var[Jse,Zse]=Yse(hv,{startEdge:"left",endEdge:"right",size:"width",direction:1}),zHe=_.forwardRef((t,e)=>{const{min:n,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=t,[f,p]=_.useState(null),m=hn(e,k=>p(k)),v=_.useRef(void 0),g=lO(i),S=g==="ltr",b=S&&!s||!S&&s;function w(k){const T=v.current||f.getBoundingClientRect(),I=[0,T.width],x=U8(I,b?[n,r]:[r,n]);return v.current=T,x(k-T.left)}return E.jsx(Jse,{scope:t.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:E.jsx(Qse,{dir:g,"data-orientation":"horizontal",...u,ref:m,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:k=>{const T=w(k.clientX);o==null||o(T)},onSlideMove:k=>{const T=w(k.clientX);a==null||a(T)},onSlideEnd:()=>{v.current=void 0,l==null||l()},onStepKeyDown:k=>{const I=zse[b?"from-left":"from-right"].includes(k.key);c==null||c({event:k,direction:I?-1:1})}})})}),YHe=_.forwardRef((t,e)=>{const{min:n,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=t,u=_.useRef(null),f=hn(e,u),p=_.useRef(void 0),m=!i;function v(g){const S=p.current||u.current.getBoundingClientRect(),b=[0,S.height],k=U8(b,m?[r,n]:[n,r]);return p.current=S,k(g-S.top)}return E.jsx(Jse,{scope:t.__scopeSlider,startEdge:m?"bottom":"top",endEdge:m?"top":"bottom",size:"height",direction:m?1:-1,children:E.jsx(Qse,{"data-orientation":"vertical",...c,ref:f,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:g=>{const S=v(g.clientY);s==null||s(S)},onSlideMove:g=>{const S=v(g.clientY);o==null||o(S)},onSlideEnd:()=>{p.current=void 0,a==null||a()},onStepKeyDown:g=>{const b=zse[m?"from-bottom":"from-top"].includes(g.key);l==null||l({event:g,direction:b?-1:1})}})})}),Qse=_.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=t,u=$T(hv,n);return E.jsx(jT.span,{...c,ref:e,onKeyDown:Qe(t.onKeyDown,f=>{f.key==="Home"?(o(f),f.preventDefault()):f.key==="End"?(a(f),f.preventDefault()):Kse.concat(Wse).includes(f.key)&&(l(f),f.preventDefault())}),onPointerDown:Qe(t.onPointerDown,f=>{const p=f.target;p.setPointerCapture(f.pointerId),f.preventDefault(),u.thumbs.has(p)?p.focus():r(f)}),onPointerMove:Qe(t.onPointerMove,f=>{f.target.hasPointerCapture(f.pointerId)&&i(f)}),onPointerUp:Qe(t.onPointerUp,f=>{const p=f.target;p.hasPointerCapture(f.pointerId)&&(p.releasePointerCapture(f.pointerId),s(f))})})}),eoe="SliderTrack",toe=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=$T(eoe,n);return E.jsx(jT.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});toe.displayName=eoe;var z5="SliderRange",noe=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=$T(z5,n),s=Zse(z5,n),o=_.useRef(null),a=hn(e,o),l=i.values.length,c=i.values.map(p=>ioe(p,i.min,i.max)),u=l>1?Math.min(...c):0,f=100-Math.max(...c);return E.jsx(jT.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...t.style,[s.startEdge]:u+"%",[s.endEdge]:f+"%"}})});noe.displayName=z5;var Y5="SliderThumb",roe=_.forwardRef((t,e)=>{const n=qHe(t.__scopeSlider),[r,i]=_.useState(null),s=hn(e,a=>i(a)),o=_.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return E.jsx(XHe,{...t,ref:s,index:o})}),XHe=_.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:i,...s}=t,o=$T(Y5,n),a=Zse(Y5,n),[l,c]=_.useState(null),u=hn(e,w=>c(w)),f=l?o.form||!!l.closest("form"):!0,p=lQ(l),m=o.values[r],v=m===void 0?0:ioe(m,o.min,o.max),g=QHe(r,o.values.length),S=p==null?void 0:p[a.size],b=S?tVe(S,v,a.direction):0;return _.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),E.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${b}px)`},children:[E.jsx(W5.ItemSlot,{scope:t.__scopeSlider,children:E.jsx(jT.span,{role:"slider","aria-label":t["aria-label"]||g,"aria-valuemin":o.min,"aria-valuenow":m,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:m===void 0?{display:"none"}:t.style,onFocus:Qe(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),f&&E.jsx(JHe,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:m},r)]})});roe.displayName=Y5;var JHe=t=>{const{value:e,...n}=t,r=_.useRef(null),i=UHe(e);return _.useEffect(()=>{const s=r.current,o=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(o,"value").set;if(i!==e&&l){const c=new Event("input",{bubbles:!0});l.call(s,e),s.dispatchEvent(c)}},[i,e]),E.jsx("input",{style:{display:"none"},...n,ref:r,defaultValue:e})};function ZHe(t=[],e,n){const r=[...t];return r[n]=e,r.sort((i,s)=>i-s)}function ioe(t,e,n){const s=100/(n-e)*(t-e);return qse(s,[0,100])}function QHe(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function eVe(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),r=Math.min(...n);return n.indexOf(r)}function tVe(t,e,n){const r=t/2,s=U8([0,50],[0,r]);return(r-s(e)*n)*n}function nVe(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function rVe(t,e){if(e>0){const n=nVe(t);return Math.min(...n)>=e}return!0}function U8(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function iVe(t){return(String(t).split(".")[1]||"").length}function sVe(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var oVe=Xse,aVe=toe,lVe=noe,cVe=roe;const uVe="_slider_15go1_8",dVe="_track_15go1_14",fVe="_highlight_15go1_31",hVe="_handle_15go1_43",ZS={slider:uVe,track:dVe,highlight:fVe,handle:hVe},soe=({className:t,label:e,value:n,onValueChange:r,onValueCommit:i,min:s,max:o,step:a,disabled:l})=>{const c=_.useCallback(([f])=>r(f),[r]),u=_.useCallback(([f])=>i==null?void 0:i(f),[i]);return E.jsxs(oVe,{className:Ne(t,ZS.slider),value:[n],onValueChange:c,onValueCommit:u,min:s,max:o,step:a,disabled:l,children:[E.jsx(aVe,{className:ZS.track,children:E.jsx(lVe,{className:ZS.highlight})}),E.jsx(Vi,{placement:"top",label:Math.round(n*100).toString()+"%",children:E.jsx(cVe,{className:ZS.handle,"aria-label":e})})]})},pVe="_selection_1akwb_1",mVe="_title_1akwb_5",gVe="_separator_1akwb_10",vVe="_options_1akwb_14",yVe="_secondary_1akwb_20",F0={selection:pVe,title:mVe,separator:gVe,options:vVe,secondary:yVe},M4=({device:t,title:e,numberedLabel:n})=>{const{t:r}=et(),i=_.useId(),s=_.useCallback(o=>{t.select(o.target.value)},[t]);return t.available.size<=1?null:E.jsxs("div",{className:F0.selection,children:[E.jsx(cf,{type:"body",weight:"semibold",size:"sm",as:"h4",className:F0.title,children:e}),E.jsx(zO,{className:F0.separator}),E.jsx("div",{className:F0.options,children:[...t.available].map(([o,a])=>{let l;switch(a.type){case"name":l=a.name;break;case"number":l=n(a.number);break;case"default":l=a.name===null?r("settings.devices.default"):E.jsxs(Os,{i18nKey:"settings.devices.default_named",name:a.name,children:["Default"," ",E.jsxs("span",{className:F0.secondary,children:["(",{name:a.name},")"]})]});break;case"earpiece":l=r("settings.devices.earpiece");break}let c=!1;return t.useAsEarpiece?c=o===G5:c=o===t.selectedId,E.jsx(CPe,{name:i,control:E.jsx(DPe,{checked:c,onChange:s,value:o}),children:E.jsx(pPe,{children:l})},o)})})]})};var Uh=typeof self<"u"?self:{};function Hf(){throw Error("Invalid UTF8")}function pV(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}let QS,N4;const _Ve=typeof TextDecoder<"u";let bVe;const SVe=typeof TextEncoder<"u";function ooe(t){if(SVe)t=(bVe||(bVe=new TextEncoder)).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let i=0;i<t.length;i++){var e=t.charCodeAt(i);if(e<128)r[n++]=e;else{if(e<2048)r[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&i<t.length){const s=t.charCodeAt(++i);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}i--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var j8,Xw;e:{for(var mV=["CLOSURE_FLAGS"],D4=Uh,F4=0;F4<mV.length;F4++)if((D4=D4[mV[F4]])==null){Xw=null;break e}Xw=D4}var My,gV=Xw&&Xw[610401301];j8=gV!=null&&gV;const vV=Uh.navigator;function X5(t){return!!j8&&!!My&&My.brands.some(({brand:e})=>e&&e.indexOf(t)!=-1)}function No(t){var e;return(e=Uh.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(t)!=-1}function dd(){return!!j8&&!!My&&My.brands.length>0}function U4(){return dd()?X5("Chromium"):(No("Chrome")||No("CriOS"))&&!(!dd()&&No("Edge"))||No("Silk")}function $8(t){return $8[" "](t),t}My=vV&&vV.userAgentData||null,$8[" "]=function(){};var EVe=!dd()&&(No("Trident")||No("MSIE"));!No("Android")||U4(),U4(),No("Safari")&&(U4()||!dd()&&No("Coast")||!dd()&&No("Opera")||!dd()&&No("Edge")||(dd()?X5("Microsoft Edge"):No("Edg/"))||dd()&&X5("Opera"));var aoe={},o1=null;function wVe(t){const e=t.length;let n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);const r=new Uint8Array(n);let i=0;return function(s,o){function a(c){for(;l<s.length;){const u=s.charAt(l++),f=o1[u];if(f!=null)return f;if(!/^[\s\xa0]*$/.test(u))throw Error("Unknown base64 encoding at char: "+u)}return c}loe();let l=0;for(;;){const c=a(-1),u=a(0),f=a(64),p=a(64);if(p===64&&c===-1)break;o(c<<2|u>>4),f!=64&&(o(u<<4&240|f>>2),p!=64&&o(f<<6&192|p))}}(t,function(s){r[i++]=s}),i!==n?r.subarray(0,i):r}function loe(){if(!o1){o1={};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"];for(let n=0;n<5;n++){const r=t.concat(e[n].split(""));aoe[n]=r;for(let i=0;i<r.length;i++){const s=r[i];o1[s]===void 0&&(o1[s]=i)}}}}var coe=typeof Uint8Array<"u",uoe=!EVe&&typeof btoa=="function";function yV(t){if(!uoe){var e;e===void 0&&(e=0),loe(),e=aoe[e];var n=Array(Math.floor(t.length/3)),r=e[64]||"";let l=0,c=0;for(;l<t.length-2;l+=3){var i=t[l],s=t[l+1],o=t[l+2],a=e[i>>2];i=e[(3&i)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[c++]=a+i+s+o}switch(a=0,o=r,t.length-l){case 2:o=e[(15&(a=t[l+1]))<<2]||r;case 1:t=t[l],n[c]=e[t>>2]+e[(3&t)<<4|a>>4]+o+r}return n.join("")}for(e="",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const _V=/[-_.]/g,CVe={"-":"+",_:"/",".":"="};function TVe(t){return CVe[t]||""}function doe(t){if(!uoe)return wVe(t);_V.test(t)&&(t=t.replace(_V,TVe)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function R_(t){return coe&&t!=null&&t instanceof Uint8Array}var Ig={};function jh(){return RVe||(RVe=new Jc(null,Ig))}function B8(t){foe(Ig);var e=t.g;return(e=e==null||R_(e)?e:typeof e=="string"?doe(e):null)==null?e:t.g=e}var Jc=class{h(){return new Uint8Array(B8(this)||0)}constructor(t,e){if(foe(e),this.g=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}};let RVe,IVe;function foe(t){if(t!==Ig)throw Error("illegal external caller")}function hoe(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}function J5(t){return hoe(t=Error(t),"warning"),t}var BT=typeof Symbol=="function"&&typeof Symbol()=="symbol",kVe=new Set;function I_(t,e,n=!1,r=!1){return t=typeof Symbol=="function"&&typeof Symbol()=="symbol"?r&&Symbol.for&&t?Symbol.for(t):t!=null?Symbol(t):Symbol():e,n&&kVe.add(t),t}var xVe=I_("jas",void 0,!0,!0),bV=I_(void 0,"0di"),j4=I_(void 0,"2ex"),U0=I_(void 0,"1oa",!0),kg=I_(void 0,Symbol(),!0);const Xe=BT?xVe:"Ga",poe={Ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},moe=Object.defineProperties;function HT(t,e){BT||Xe in t||moe(t,poe),t[Xe]|=e}function Or(t,e){BT||Xe in t||moe(t,poe),t[Xe]=e}function pv(t){return HT(t,34),t}function PVe(t,e){Or(e,-30975&(0|t))}function Z5(t,e){Or(e,-30941&(34|t))}function H8(){return typeof BigInt=="function"}function Ns(t){return Array.prototype.slice.call(t)}var V8,k_={},goe={};function SV(t){return!(!t||typeof t!="object"||t.Ia!==goe)}function G8(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}function q8(t,e){if(t!=null){if(typeof t=="string")t=t?new Jc(t,Ig):jh();else if(t.constructor!==Jc)if(R_(t))t=t.length?new Jc(new Uint8Array(t),Ig):jh();else{if(!e)throw Error();t=void 0}}return t}function Jw(t){return!(!Array.isArray(t)||t.length)&&!!(1&(0|t[Xe]))}const EV=[];function pf(t){if(2&t)throw Error()}Or(EV,55),V8=Object.freeze(EV);let wV=class voe{constructor(e,n,r){this.l=0,this.g=e,this.h=n,this.m=r}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new voe(this.g,this.h,this.m)}};function K8(t){return kg?t[kg]:void 0}var LVe=Object.freeze({});function VT(t){return t.Qa=!0,t}var AVe=VT(t=>typeof t=="number"),CV=VT(t=>typeof t=="string"),OVe=VT(t=>typeof t=="boolean"),GT=typeof Uh.BigInt=="function"&&typeof Uh.BigInt(0)=="bigint",Q5=VT(t=>GT?t>=NVe&&t<=FVe:t[0]==="-"?TV(t,MVe):TV(t,DVe));const MVe=Number.MIN_SAFE_INTEGER.toString(),NVe=GT?BigInt(Number.MIN_SAFE_INTEGER):void 0,DVe=Number.MAX_SAFE_INTEGER.toString(),FVe=GT?BigInt(Number.MAX_SAFE_INTEGER):void 0;function TV(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(r>i)return!1;if(r<i)return!0}}const UVe=typeof Uint8Array.prototype.slice=="function";let yoe,_n=0,cr=0;function RV(t){const e=t>>>0;_n=e,cr=(t-e)/4294967296>>>0}function xg(t){if(t<0){RV(-t);const[e,n]=X8(_n,cr);_n=e>>>0,cr=n>>>0}else RV(t)}function W8(t){const e=yoe||(yoe=new DataView(new ArrayBuffer(8)));e.setFloat32(0,+t,!0),cr=0,_n=e.getUint32(0,!0)}function z8(t,e){const n=4294967296*e+(t>>>0);return Number.isSafeInteger(n)?n:Ny(t,e)}function Y8(t,e){const n=2147483648&e;return n&&(e=~e>>>0,(t=1+~t>>>0)==0&&(e=e+1>>>0)),typeof(t=z8(t,e))=="number"?n?-t:t:n?"-"+t:t}function Ny(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else H8()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+IV(n)+IV(t));return n}function IV(t){return t=String(t),"0000000".slice(t.length)+t}function qT(t){if(t.length<16)xg(Number(t));else if(H8())t=BigInt(t),_n=Number(t&BigInt(4294967295))>>>0,cr=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(t[0]==="-");cr=_n=0;const n=t.length;for(let r=e,i=(n-e)%6+e;i<=n;r=i,i+=6){const s=Number(t.slice(r,i));cr*=1e6,_n=1e6*_n+s,_n>=4294967296&&(cr+=Math.trunc(_n/4294967296),cr>>>=0,_n>>>=0)}if(e){const[r,i]=X8(_n,cr);_n=r,cr=i}}}function X8(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}const J8=typeof BigInt=="function"?BigInt.asIntN:void 0,jVe=typeof BigInt=="function"?BigInt.asUintN:void 0,Ym=Number.isSafeInteger,KT=Number.isFinite,Zw=Math.trunc;function mf(t){return t==null||typeof t=="number"?t:t==="NaN"||t==="Infinity"||t==="-Infinity"?Number(t):void 0}function _oe(t){return t==null||typeof t=="boolean"?t:typeof t=="number"?!!t:void 0}const $Ve=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function WT(t){switch(typeof t){case"bigint":return!0;case"number":return KT(t);case"string":return $Ve.test(t);default:return!1}}function mv(t){if(t==null)return t;if(typeof t=="string"&&t)t=+t;else if(typeof t!="number")return;return KT(t)?0|t:void 0}function boe(t){if(t==null)return t;if(typeof t=="string"&&t)t=+t;else if(typeof t!="number")return;return KT(t)?t>>>0:void 0}function kV(t){if(t[0]==="-")return!1;const e=t.length;return e<20||e===20&&Number(t.substring(0,6))<184467}function Z8(t){return t=Zw(t),Ym(t)||(xg(t),t=Y8(_n,cr)),t}function Q8(t){var e=Zw(Number(t));if(Ym(e))return String(e);if((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),e=t.length,!(t[0]==="-"?e<20||e===20&&Number(t.substring(0,7))>-922337:e<19||e===19&&Number(t.substring(0,6))<922337))if(qT(t),t=_n,2147483648&(e=cr))if(H8())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=X8(t,e);t="-"+Ny(n,r)}else t=Ny(t,e);return t}function Qw(t){return t==null?t:typeof t=="bigint"?(Q5(t)?t=Number(t):(t=J8(64,t),t=Q5(t)?Number(t):String(t)),t):WT(t)?typeof t=="number"?Z8(t):Q8(t):void 0}function BVe(t){if(t==null)return t;var e=typeof t;if(e==="bigint")return String(jVe(64,t));if(WT(t)){if(e==="string")return e=Zw(Number(t)),Ym(e)&&e>=0?t=String(e):((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),kV(t)||(qT(t),t=Ny(_n,cr))),t;if(e==="number")return(t=Zw(t))>=0&&Ym(t)?t:function(n){if(n<0){xg(n);var r=Ny(_n,cr);return n=Number(r),Ym(n)?n:r}return kV(r=String(n))?r:(xg(n),z8(_n,cr))}(t)}}function Soe(t){if(typeof t!="string")throw Error();return t}function gv(t){if(t!=null&&typeof t!="string")throw Error();return t}function Pg(t){return t==null||typeof t=="string"?t:void 0}function eM(t,e,n,r){if(t!=null&&typeof t=="object"&&t.W===k_)return t;if(!Array.isArray(t))return n?2&r?((t=e[bV])||(pv((t=new e).u),t=e[bV]=t),e=t):e=new e:e=void 0,e;let i=n=0|t[Xe];return i===0&&(i|=32&r),i|=2&r,i!==n&&Or(t,i),new e(t)}function HVe(t,e,n){if(e)e:{if(!WT(e=t))throw J5("int64");switch(typeof e){case"string":e=Q8(e);break e;case"bigint":if(t=e=J8(64,e),CV(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(AVe(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=GT?BigInt(e):OVe(e)?e?"1":"0":CV(e)?e.trim()||"0":String(e);break e;default:e=Z8(e)}}else e=Qw(t);return typeof(n=(t=e)==null?n?0:void 0:t)=="string"&&Ym(e=+n)?e:n}const VVe={};let GVe=function(){try{return $8(new class extends Map{constructor(){super()}}),!1}catch{return!0}}(),$4=class{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,n){return this.g.set(e,n),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,n){return this.g.forEach(e,n)}[Symbol.iterator](){return this.entries()}};const qVe=GVe?(Object.setPrototypeOf($4.prototype,Map.prototype),Object.defineProperties($4.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),$4):class extends Map{constructor(){super()}};function xV(t){return t}function B4(t){if(2&t.L)throw Error("Cannot mutate an immutable Map")}var ea=class extends qVe{constructor(t,e,n=xV,r=xV){super();let i=0|t[Xe];i|=64,Or(t,i),this.L=i,this.S=e,this.R=n,this.Y=this.S?KVe:r;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let l=o[1];e?l===void 0&&(l=null):l=r(o[1],!1,!0,void 0,void 0,i),super.set(a,l)}}na(t=PV){if(this.size!==0)return this.X(t)}X(t=PV){const e=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=t(r[0]),r[1]=t(r[1]),e.push(r);return e}clear(){B4(this),super.clear()}delete(t){return B4(this),super.delete(this.R(t,!0,!1))}entries(){var t=this.ma();return new wV(t,WVe,this)}keys(){return this.Ha()}values(){var t=this.ma();return new wV(t,ea.prototype.get,this)}forEach(t,e){super.forEach((n,r)=>{t.call(e,this.get(r),r,this)})}set(t,e){return B4(this),(t=this.R(t,!0,!1))==null?this:e==null?(super.delete(t),this):super.set(t,this.Y(e,!0,!0,this.S,!1,this.L))}Na(t){const e=this.R(t[0],!1,!0);t=t[1],t=this.S?t===void 0?null:t:this.Y(t,!1,!0,void 0,!1,this.L),super.set(e,t)}has(t){return super.has(this.R(t,!1,!1))}get(t){t=this.R(t,!1,!1);const e=super.get(t);if(e!==void 0){var n=this.S;return n?((n=this.Y(e,!1,!0,n,this.ra,this.L))!==e&&super.set(t,n),n):e}}ma(){return Array.from(super.keys())}Ha(){return super.keys()}[Symbol.iterator](){return this.entries()}};function KVe(t,e,n,r,i,s){return t=eM(t,r,n,s),i&&(t=YT(t)),t}function PV(t){return t}function WVe(t){return[t,this.get(t)]}let zVe,Eoe,YVe;function LV(){return zVe||(zVe=new ea(pv([]),void 0,void 0,void 0,VVe))}function tM(t,e,n,r,i){if(t!=null){if(Array.isArray(t))t=Jw(t)?void 0:i&&2&(0|t[Xe])?t:nM(t,e,n,r!==void 0,i);else if(G8(t)){const s={};for(let o in t)s[o]=tM(t[o],e,n,r,i);t=s}else t=e(t,r);return t}}function nM(t,e,n,r,i){const s=r||n?0|t[Xe]:0,o=r?!!(32&s):void 0;r=Ns(t);for(let a=0;a<r.length;a++)r[a]=tM(r[a],e,n,o,i);return n&&((t=K8(t))&&(r[kg]=Ns(t)),n(s,r)),r}function XVe(t){return tM(t,woe,void 0,void 0,!1)}function woe(t){return t.W===k_?t.toJSON():t instanceof ea?t.na(XVe):function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return Q5(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(Jw(e))return}else{if(R_(e))return yV(e);if(e instanceof Jc){const n=e.g;return n==null?"":typeof n=="string"?n:e.g=yV(n)}if(e instanceof ea)return e.na()}}return e}(t)}function Coe(t){return nM(t,woe,void 0,void 0,!1)}function Od(t,e,n){return t=Toe(t,e[0],e[1],n?1:2),e!==Eoe&&n&&HT(t,16384),t}function Toe(t,e,n,r){if(t==null){var i=96;n?(t=[n],i|=512):t=[],e&&(i=-33521665&i|(1023&e)<<15)}else{if(!Array.isArray(t))throw Error("narr");if(2048&(i=0|t[Xe]))throw Error("farr");if(64&i)return t;if(r===1||r===2||(i|=64),n&&(i|=512,n!==t[0]))throw Error("mid");e:{if(r=(n=t).length){const s=r-1;if(G8(n[s])){if((e=s-(512&(i|=256)?0:-1))>=1024)throw Error("pvtlmt");i=-33521665&i|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,r-(512&i?0:-1)))>1024)throw Error("spvt");i=-33521665&i|(1023&e)<<15}}}return Or(t,i),t}function eL(t,e,n=Z5){if(t!=null){if(coe&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=0|t[Xe];return 2&r?t:(e&&(e=r===0||!!(32&r)&&!(64&r||!(16&r))),e?(Or(t,-12293&(34|r)),t):nM(t,eL,4&r?Z5:n,!0,!0))}return t.W===k_?t=2&(r=0|(n=t.u)[Xe])?t:new t.constructor(zT(n,r,!0)):t instanceof ea&&!(2&t.L)&&(n=pv(t.X(eL)),t=new ea(n,t.S,t.R,t.Y)),t}}function zT(t,e,n){const r=n||2&e?Z5:PVe,i=!!(32&e);return t=function(s,o,a){const l=Ns(s);var c=l.length;const u=256&o?l[c-1]:void 0;for(c+=u?-1:0,o=512&o?1:0;o<c;o++)l[o]=a(l[o]);if(u){o=l[o]={};for(const f in u)o[f]=a(u[f])}return(s=K8(s))&&(l[kg]=Ns(s)),l}(t,e,s=>eL(s,i,r)),HT(t,32|(n?2:0)),t}function YT(t){const e=t.u,n=0|e[Xe];return 2&n?new t.constructor(zT(e,n,!1)):t}function Lg(t,e){return vu(t=t.u,0|t[Xe],e)}function vu(t,e,n,r){if(n===-1)return null;var i=n+(512&e?0:-1);const s=t.length-1;return i>=s&&256&e?t[s][n]:r&&256&e&&(e=t[s][n])!=null?(t[i]!=null&&j4!=null&&((i=(t=IVe??(IVe={}))[j4]||0)>=4||(t[j4]=i+1,hoe(t=Error(),"incident"),function(o){Uh.setTimeout(()=>{throw o},0)}(t))),e):i<=s?t[i]:void 0}function kn(t,e,n){const r=t.u;let i=0|r[Xe];return pf(i),nr(r,i,e,n),t}function nr(t,e,n,r){const i=512&e?0:-1,s=n+i;var o=t.length-1;return s>=o&&256&e?(t[o][n]=r,e):s<=o?(t[s]=r,256&e&&n in(t=t[o])&&delete t[n],e):(r!==void 0&&(n>=(o=e>>15&1023||536870912)?r!=null&&(t[o+i]={[n]:r},Or(t,e|=256)):t[s]=r),e)}function _E(t,e){let n=0|(t=t.u)[Xe];const r=vu(t,n,e),i=mf(r);return i!=null&&i!==r&&nr(t,n,e,i),i}function Roe(t){let e=0|(t=t.u)[Xe];const n=vu(t,e,1),r=q8(n,!0);return r!=null&&r!==n&&nr(t,e,1,r),r}function oh(){return LVe===void 0?2:4}function ah(t,e,n,r,i){const s=t.u,o=2&(t=0|s[Xe])?1:r;i=!!i;let a=0|(r=rM(s,t,e))[Xe];if(!(4&a)){4&a&&(r=Ns(r),a=Zc(a,t),t=nr(s,t,e,r));let l=0,c=0;for(;l<r.length;l++){const u=n(r[l]);u!=null&&(r[c++]=u)}c<l&&(r.length=c),a=iM(a,t),n=-4097&(20|a),a=n&=-8193,Or(r,a),2&a&&Object.freeze(r)}return o===1||o===4&&32&a?$c(a)||(i=a,a|=2,a!==i&&Or(r,a),Object.freeze(r)):(o===2&&$c(a)&&(r=Ns(r),a=Zc(a,t),a=Md(a,t,i),Or(r,a),t=nr(s,t,e,r)),$c(a)||(e=a,a=Md(a,t,i),a!==e&&Or(r,a))),r}function rM(t,e,n,r){return t=vu(t,e,n,r),Array.isArray(t)?t:V8}function iM(t,e){return t===0&&(t=Zc(t,e)),1|t}function $c(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function Ioe(t){t=Ns(t);for(let e=0;e<t.length;e++){const n=t[e]=Ns(t[e]);Array.isArray(n[1])&&(n[1]=pv(n[1]))}return t}function tL(t,e,n,r){let i=0|(t=t.u)[Xe];pf(i),nr(t,i,e,(r==="0"?Number(n)===0:n===r)?void 0:n)}function vv(t,e,n,r,i){pf(e);var s=!(!(64&e)&&16384&e);const o=(i=rM(t,e,n,i))!==V8;if(s||!o){let a=s=o?0|i[Xe]:0;(!o||2&a||$c(a)||4&a&&!(32&a))&&(i=Ns(i),a=Zc(a,e),e=nr(t,e,n,i)),a=-13&iM(a,e),a=Md(r?-17&a:16|a,e,!0),a!==s&&Or(i,a)}return i}function H4(t,e){var n=gae;return oM(sM(t=t.u),t,0|t[Xe],n)===e?e:-1}function sM(t){if(BT)return t[U0]??(t[U0]=new Map);if(U0 in t)return t[U0];const e=new Map;return Object.defineProperty(t,U0,{value:e}),e}function koe(t,e,n,r){const i=sM(t),s=oM(i,t,e,n);return s!==r&&(s&&(e=nr(t,e,s)),i.set(n,r)),e}function oM(t,e,n,r){let i=t.get(r);if(i!=null)return i;i=0;for(let s=0;s<r.length;s++){const o=r[s];vu(e,n,o)!=null&&(i!==0&&(n=nr(e,n,i)),i=o)}return t.set(r,i),i}function aM(t,e,n,r){let i,s=0|t[Xe];if((r=vu(t,s,n,r))!=null&&r.W===k_)return(e=YT(r))!==r&&nr(t,s,n,e),e.u;if(Array.isArray(r)){const o=0|r[Xe];i=2&o?Od(zT(r,o,!1),e,!0):64&o?r:Od(i,e,!0)}else i=Od(void 0,e,!0);return i!==r&&nr(t,s,n,i),i}function xoe(t,e,n,r){let i=0|(t=t.u)[Xe];return(e=eM(r=vu(t,i,n,r),e,!1,i))!==r&&e!=null&&nr(t,i,n,e),e}function Vt(t,e,n,r=!1){if((e=xoe(t,e,n,r))==null)return e;if(!(2&(r=0|(t=t.u)[Xe]))){const i=YT(e);i!==e&&nr(t,r,n,e=i)}return e}function Poe(t,e,n,r,i,s,o){t=t.u;var a=!!(2&e);const l=a?1:i;s=!!s,o&&(o=!a);var c=0|(i=rM(t,e,r))[Xe];if(!(a=!!(4&c))){var u=i,f=e;const p=!!(2&(c=iM(c,e)));p&&(f|=2);let m=!p,v=!0,g=0,S=0;for(;g<u.length;g++){const b=eM(u[g],n,!1,f);if(b instanceof n){if(!p){const w=!!(2&(0|b.u[Xe]));m&&(m=!w),v&&(v=w)}u[S++]=b}}S<g&&(u.length=S),c|=4,c=v?16|c:-17&c,Or(u,c=m?8|c:-9&c),p&&Object.freeze(u)}if(o&&!(8&c||!i.length&&(l===1||l===4&&32&c))){for($c(c)&&(i=Ns(i),c=Zc(c,e),e=nr(t,e,r,i)),n=i,o=c,u=0;u<n.length;u++)(c=n[u])!==(f=YT(c))&&(n[u]=f);o|=8,Or(n,o=n.length?-17&o:16|o),c=o}return l===1||l===4&&32&c?$c(c)||(e=c,(c|=!i.length||16&c&&(!a||32&c)?2:2048)!==e&&Or(i,c),Object.freeze(i)):(l===2&&$c(c)&&(Or(i=Ns(i),c=Md(c=Zc(c,e),e,s)),e=nr(t,e,r,i)),$c(c)||(r=c,(c=Md(c,e,s))!==r&&Or(i,c))),i}function fu(t,e,n){const r=0|t.u[Xe];return Poe(t,r,e,n,oh(),!1,!(2&r))}function nt(t,e,n,r){return r==null&&(r=void 0),kn(t,n,r)}function F1(t,e,n,r){r==null&&(r=void 0);e:{let i=0|(t=t.u)[Xe];if(pf(i),r==null){const s=sM(t);if(oM(s,t,i,n)!==e)break e;s.set(n,0)}else i=koe(t,i,n,e);nr(t,i,e,r)}}function Zc(t,e){return-2049&(t=32|(2&e?2|t:-3&t))}function Md(t,e,n){return 32&e&&n||(t&=-33),t}function eC(t,e,n,r){const i=0|t.u[Xe];pf(i),t=Poe(t,i,n,e,2,!0),r=r??new n,t.push(r),t[Xe]=2&(0|r.u[Xe])?-9&t[Xe]:-17&t[Xe]}function Vo(t,e){return mv(Lg(t,e))}function ta(t,e){return Pg(Lg(t,e))}function vr(t,e){return _E(t,e)??0}function Dy(t,e,n){if(n!=null&&typeof n!="boolean")throw t=typeof n,Error(`Expected boolean but got ${t!="object"?t:n?Array.isArray(n)?"array":t:"null"}: ${n}`);kn(t,e,n)}function Hl(t,e,n){if(n!=null){if(typeof n!="number"||!KT(n))throw J5("int32");n|=0}kn(t,e,n)}function Ke(t,e,n){if(n!=null&&typeof n!="number")throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);kn(t,e,n)}function tC(t,e,n){{const o=t.u;let a=0|o[Xe];if(pf(a),n==null)nr(o,a,e);else{var r=t=0|n[Xe],i=$c(t),s=i||Object.isFrozen(n);for(i||(t=0),s||(n=Ns(n),r=0,t=Md(t=Zc(t,a),a,!0),s=!1),t|=21,i=0;i<n.length;i++){const l=n[i],c=Soe(l);Object.is(l,c)||(s&&(n=Ns(n),r=0,t=Md(t=Zc(t,a),a,!0),s=!1),n[i]=c)}t!==r&&(s&&(n=Ns(n),t=Md(t=Zc(t,a),a,!0)),Or(n,t)),nr(o,a,e,n)}}}function XT(t,e,n){pf(0|t.u[Xe]),ah(t,e,Pg,2,!0).push(Soe(n))}function Loe(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function lM(){return Error("Failed to read varint, encoding is invalid.")}function Aoe(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function cM(t){if(typeof t=="string")return{buffer:doe(t),N:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),N:!1};if(t.constructor===Uint8Array)return{buffer:t,N:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),N:!1};if(t.constructor===Jc)return{buffer:B8(t)||new Uint8Array(0),N:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),N:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function uM(t,e){let n,r=0,i=0,s=0;const o=t.h;let a=t.g;do n=o[a++],r|=(127&n)<<s,s+=7;while(s<32&&128&n);for(s>32&&(i|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=o[a++],i|=(127&n)<<s;if(yh(t,a),n<128)return e(r>>>0,i>>>0);throw lM()}function dM(t){let e=0,n=t.g;const r=n+10,i=t.h;for(;n<r;){const s=i[n++];if(e|=s,(128&s)==0)return yh(t,n),!!(127&e)}throw lM()}function Xd(t){const e=t.h;let n=t.g,r=e[n++],i=127&r;if(128&r&&(r=e[n++],i|=(127&r)<<7,128&r&&(r=e[n++],i|=(127&r)<<14,128&r&&(r=e[n++],i|=(127&r)<<21,128&r&&(r=e[n++],i|=r<<28,128&r&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw lM();return yh(t,n),i}function hu(t){return Xd(t)>>>0}function nL(t){var e=t.h;const n=t.g,r=e[n],i=e[n+1],s=e[n+2];return e=e[n+3],yh(t,t.g+4),(r<<0|i<<8|s<<16|e<<24)>>>0}function rL(t){var e=nL(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,n==255?e?NaN:t*(1/0):n==0?1401298464324817e-60*t*e:t*Math.pow(2,n-150)*(e+8388608)}function JVe(t){return Xd(t)}function V4(t,e,{ba:n=!1}={}){t.ba=n,e&&(e=cM(e),t.h=e.buffer,t.m=e.N,t.j=0,t.l=t.h.length,t.g=t.j)}function yh(t,e){if(t.g=e,e>t.l)throw Aoe(t.l,e)}function Ooe(t,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,r=n+e;if(r>t.l)throw Aoe(e,t.l-n);return t.g=r,n}function Moe(t,e){if(e==0)return jh();var n=Ooe(t,e);return t.ba&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?new Uint8Array(0):UVe?t.slice(n,e):new Uint8Array(t.subarray(n,e))),n.length==0?jh():new Jc(n,Ig)}ea.prototype.toJSON=void 0,ea.prototype.Ia=goe;var AV=[];function Noe(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=hu(t.g);if(e=n>>>3,!((n&=7)>=0&&n<=5))throw Loe(n,t.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function bE(t){switch(t.h){case 0:t.h!=0?bE(t):dM(t.g);break;case 1:yh(t=t.g,t.g+8);break;case 2:if(t.h!=2)bE(t);else{var e=hu(t.g);yh(t=t.g,t.g+e)}break;case 5:yh(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!Noe(t))throw Error("Unmatched start-group tag: stream EOF");if(t.h==4){if(t.m!=e)throw Error("Unmatched end-group tag");break}bE(t)}break;default:throw Loe(t.h,t.l)}}function x_(t,e,n){const r=t.g.l,i=hu(t.g),s=t.g.g+i;let o=s-r;if(o<=0&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=r,e}function fM(t){var e=hu(t.g),n=Ooe(t=t.g,e);if(t=t.h,_Ve){var r,i=t;(r=N4)||(r=N4=new TextDecoder("utf-8",{fatal:!0})),e=n+e,i=n===0&&e===i.length?i:i.subarray(n,e);try{var s=r.decode(i)}catch(a){if(QS===void 0){try{r.decode(new Uint8Array([128]))}catch{}try{r.decode(new Uint8Array([97])),QS=!0}catch{QS=!1}}throw!QS&&(N4=void 0),a}}else{e=(s=n)+e,n=[];let a,l=null;for(;s<e;){var o=t[s++];o<128?n.push(o):o<224?s>=e?Hf():(a=t[s++],o<194||(192&a)!=128?(s--,Hf()):n.push((31&o)<<6|63&a)):o<240?s>=e-1?Hf():(a=t[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(r=t[s++]))!=128?(s--,Hf()):n.push((15&o)<<12|(63&a)<<6|63&r)):o<=244?s>=e-2?Hf():(a=t[s++],(192&a)!=128||a-144+(o<<28)>>30!=0||(192&(r=t[s++]))!=128||(192&(i=t[s++]))!=128?(s--,Hf()):(o=(7&o)<<18|(63&a)<<12|(63&r)<<6|63&i,o-=65536,n.push(55296+(o>>10&1023),56320+(1023&o)))):Hf(),n.length>=8192&&(l=pV(l,n),n.length=0)}s=pV(l,n)}return s}function Doe(t){const e=hu(t.g);return Moe(t.g,e)}function JT(t,e,n){var r=hu(t.g);for(r=t.g.g+r;t.g.g<r;)n.push(e(t.g))}var e2=[];function ZVe(t){return t}let Xm;function Za(t,e,n){e.g?e.m(t,e.g,e.h,n):e.m(t,e.h,n)}var Ve=class{constructor(t,e){this.u=Toe(t,e)}toJSON(){const t=!Xm;try{return t&&(Xm=Coe),Foe(this)}finally{t&&(Xm=void 0)}}l(){var t=MGe;return t.g?t.l(this,t.g,t.h,!0):t.l(this,t.h,t.defaultValue,!0)}clone(){const t=this.u;return new this.constructor(zT(t,0|t[Xe],!1))}N(){return!!(2&(0|this.u[Xe]))}};function Foe(t){var e=t.u;{e=(t=Xm(e))!==e;let c=t.length;if(c){var n=t[c-1],r=G8(n);r?c--:n=void 0;var i=t;if(r){e:{var s,o=n,a=!1;if(o)for(let u in o)isNaN(+u)?(s??(s={}))[u]=o[u]:(r=o[u],Array.isArray(r)&&(Jw(r)||SV(r)&&r.size===0)&&(r=null),r==null&&(a=!0),r!=null&&((s??(s={}))[u]=r));if(a||(s=o),s)for(let u in s){a=s;break e}a=null}o=a==null?n!=null:a!==n}for(;c>0&&((s=i[c-1])==null||Jw(s)||SV(s)&&s.size===0);c--)var l=!0;(i!==t||o||l)&&(e?(l||o||a)&&(i.length=c):i=Array.prototype.slice.call(i,0,c),a&&i.push(a)),l=i}else l=t}return l}function OV(t){return t?/^\d+$/.test(t)?(qT(t),new iL(_n,cr)):null:QVe||(QVe=new iL(0,0))}Ve.prototype.W=k_,Ve.prototype.toString=function(){try{return Xm=ZVe,Foe(this).toString()}finally{Xm=void 0}};var iL=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let QVe;function MV(t){return t?/^-?\d+$/.test(t)?(qT(t),new sL(_n,cr)):null:eGe||(eGe=new sL(0,0))}var sL=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let eGe;function Jm(t,e,n){for(;n>0||e>127;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function yv(t,e){for(;e>127;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function ZT(t,e){if(e>=0)yv(t,e);else{for(let n=0;n<9;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function Fy(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function Ag(t,e){e.length!==0&&(t.l.push(e),t.h+=e.length)}function mo(t,e,n){yv(t.g,8*e+n)}function hM(t,e){return mo(t,e,2),e=t.g.end(),Ag(t,e),e.push(t.h),e}function pM(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function QT(t,e,n){mo(t,e,2),yv(t.g,n.length),Ag(t,t.g.end()),Ag(t,n)}function nC(t,e,n,r){n!=null&&(e=hM(t,e),r(n,t),pM(t,e))}function Qa(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var mM=Qa(),Uoe=Qa(),gM=Qa(),vM=Qa(),joe=Qa(),$oe=Qa(),yM=Qa(),Boe=Qa(),Hoe=Qa(),_v=class{constructor(e,n,r){this.g=e,this.h=n,e=mM,this.l=!!e&&r===e||!1}};function e3(t,e){return new _v(t,e,mM)}function Voe(t,e,n,r,i){nC(t,n,Woe(e,r),i)}const tGe=e3(function(t,e,n,r,i){return t.h===2&&(x_(t,aM(e,r,n),i),!0)},Voe),nGe=e3(function(t,e,n,r,i){return t.h===2&&(x_(t,aM(e,r,n,!0),i),!0)},Voe);var t3=Symbol(),_M=Symbol(),NV=Symbol(),DV=Symbol();let Goe,qoe;function np(t,e,n,r){var i=r[t];if(i)return i;(i={}).Pa=r,i.V=function(f){switch(typeof f){case"boolean":return Eoe||(Eoe=[0,void 0,!0]);case"number":return f>0?void 0:f===0?YVe||(YVe=[0,void 0]):[-f,void 0];case"string":return[0,f];case"object":return f}}(r[0]);var s=r[1];let o=1;s&&s.constructor===Object&&(i.ga=s,typeof(s=r[++o])=="function"&&(i.la=!0,Goe??(Goe=s),qoe??(qoe=r[o+1]),s=r[o+=2]));const a={};for(;s&&Array.isArray(s)&&s.length&&typeof s[0]=="number"&&s[0]>0;){for(var l=0;l<s.length;l++)a[s[l]]=s;s=r[++o]}for(l=1;s!==void 0;){let f;typeof s=="number"&&(l+=s,s=r[++o]);var c=void 0;if(s instanceof _v?f=s:(f=tGe,o--),f==null?void 0:f.l){s=r[++o],c=r;var u=o;typeof s=="function"&&(s=s(),c[u]=s),c=s}for(u=l+1,typeof(s=r[++o])=="number"&&s<0&&(u-=s,s=r[++o]);l<u;l++){const p=a[l];c?n(i,l,f,c,p):e(i,l,f,p)}}return r[t]=i}function Koe(t){return Array.isArray(t)?t[0]instanceof _v?t:[nGe,t]:[t,void 0]}function Woe(t,e){return t instanceof Ve?t.u:Array.isArray(t)?Od(t,e,!1):void 0}function bM(t,e,n,r){const i=n.g;t[e]=r?(s,o,a)=>i(s,o,a,r):i}function SM(t,e,n,r,i){const s=n.g;let o,a;t[e]=(l,c,u)=>s(l,c,u,a||(a=np(_M,bM,SM,r).V),o||(o=EM(r)),i)}function EM(t){let e=t[NV];if(e!=null)return e;const n=np(_M,bM,SM,t);return e=n.la?(r,i)=>Goe(r,i,n):(r,i)=>{const s=0|r[Xe];for(;Noe(i)&&i.h!=4;){var o=i.m,a=n[o];if(a==null){var l=n.ga;l&&(l=l[o])&&(l=rGe(l))!=null&&(a=n[o]=l)}a!=null&&a(i,r,o)||(o=(a=i).l,bE(a),a.fa?a=void 0:(l=a.g.g-o,a.g.g=o,a=Moe(a.g,l)),o=r,a&&((l=o[kg])?l.push(a):o[kg]=[a]))}return 16384&s&&pv(r),!0},t[NV]=e}function rGe(t){const e=(t=Koe(t))[0].g;if(t=t[1]){const n=EM(t),r=np(_M,bM,SM,t).V;return(i,s,o)=>e(i,s,o,r,n)}return e}function n3(t,e,n){t[e]=n.h}function r3(t,e,n,r){let i,s;const o=n.h;t[e]=(a,l,c)=>o(a,l,c,s||(s=np(t3,n3,r3,r).V),i||(i=zoe(r)))}function zoe(t){let e=t[DV];if(!e){const n=np(t3,n3,r3,t);e=(r,i)=>Yoe(r,i,n),t[DV]=e}return e}function Yoe(t,e,n){for(var r=0|t[Xe],i=512&r?0:-1,s=t.length,o=512&r?1:0,a=s+(256&r?-1:0);o<a;o++){const l=t[o];if(l==null)continue;const c=o-i,u=FV(n,c);u&&u(e,l,c)}if(256&r){r=t[s-1];for(const l in r)i=+l,Number.isNaN(i)||(s=r[i])!=null&&(a=FV(n,i))&&a(e,s,i)}if(t=K8(t))for(Ag(e,e.g.end()),n=0;n<t.length;n++)Ag(e,B8(t[n])||new Uint8Array(0))}function FV(t,e){var n=t[e];if(n)return n;if((n=t.ga)&&(n=n[e])){var r=(n=Koe(n))[0].h;if(n=n[1]){const i=zoe(n),s=np(t3,n3,r3,n).V;n=t.la?qoe(s,i):(o,a,l)=>r(o,a,l,s,i)}else n=r;return t[e]=n}}function bv(t,e){if(Array.isArray(e)){var n=0|e[Xe];if(4&n)return e;for(var r=0,i=0;r<e.length;r++){const s=t(e[r]);s!=null&&(e[i++]=s)}return i<r&&(e.length=i),Or(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}function ls(t,e,n){return new _v(t,e,n)}function Sv(t,e,n){return new _v(t,e,n)}function cs(t,e,n){nr(t,0|t[Xe],e,n)}var iGe=e3(function(t,e,n,r,i){return t.h===2&&(t=x_(t,Od([void 0,void 0],r,!0),i),pf(r=0|e[Xe]),(i=vu(e,r,n))instanceof ea?(2&i.L)!=0?((i=i.X()).push(t),nr(e,r,n,i)):i.Na(t):Array.isArray(i)?(2&(0|i[Xe])&&nr(e,r,n,i=Ioe(i)),i.push(t)):nr(e,r,n,[t]),!0)},function(t,e,n,r,i){if(e instanceof ea)e.forEach((s,o)=>{nC(t,n,Od([o,s],r,!1),i)});else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&nC(t,n,Od(o,r,!1),i)}});function Xoe(t,e,n){if(e=function(r){if(r==null)return r;const i=typeof r;if(i==="bigint")return String(J8(64,r));if(WT(r)){if(i==="string")return Q8(r);if(i==="number")return Z8(r)}}(e),e!=null&&(typeof e=="string"&&MV(e),e!=null))switch(mo(t,n,0),typeof e){case"number":t=t.g,xg(e),Jm(t,_n,cr);break;case"bigint":n=BigInt.asUintN(64,e),n=new sL(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),Jm(t.g,n.h,n.g);break;default:n=MV(e),Jm(t.g,n.h,n.g)}}function Joe(t,e,n){(e=mv(e))!=null&&e!=null&&(mo(t,n,0),ZT(t.g,e))}function Zoe(t,e,n){(e=_oe(e))!=null&&(mo(t,n,0),t.g.g.push(e?1:0))}function Qoe(t,e,n){(e=Pg(e))!=null&&QT(t,n,ooe(e))}function eae(t,e,n,r,i){nC(t,n,Woe(e,r),i)}function tae(t,e,n){(e=e==null||typeof e=="string"||R_(e)||e instanceof Jc?e:void 0)!=null&&QT(t,n,cM(e).buffer)}function nae(t,e,n){return(t.h===5||t.h===2)&&(e=vv(e,0|e[Xe],n,!1,!1),t.h==2?JT(t,rL,e):e.push(rL(t.g)),!0)}var kc=ls(function(t,e,n){if(t.h!==1)return!1;var r=t.g;t=nL(r);const i=nL(r);r=2*(i>>31)+1;const s=i>>>20&2047;return t=4294967296*(1048575&i)+t,cs(e,n,s==2047?t?NaN:r*(1/0):s==0?5e-324*r*t:r*Math.pow(2,s-1075)*(t+4503599627370496)),!0},function(t,e,n){(e=mf(e))!=null&&(mo(t,n,1),t=t.g,(n=yoe||(yoe=new DataView(new ArrayBuffer(8)))).setFloat64(0,+e,!0),_n=n.getUint32(0,!0),cr=n.getUint32(4,!0),Fy(t,_n),Fy(t,cr))},Qa()),Mr=ls(function(t,e,n){return t.h===5&&(cs(e,n,rL(t.g)),!0)},function(t,e,n){(e=mf(e))!=null&&(mo(t,n,5),t=t.g,W8(e),Fy(t,_n))},yM),sGe=Sv(nae,function(t,e,n){if((e=bv(mf,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&(mo(r,i,5),r=r.g,W8(s),Fy(r,_n))}},yM),wM=Sv(nae,function(t,e,n){if((e=bv(mf,e))!=null&&e.length){mo(t,n,2),yv(t.g,4*e.length);for(let r=0;r<e.length;r++)n=t.g,W8(e[r]),Fy(n,_n)}},yM),Jd=ls(function(t,e,n){return t.h===0&&(cs(e,n,uM(t.g,Y8)),!0)},Xoe,$oe),G4=ls(function(t,e,n){return t.h===0&&(cs(e,n,(t=uM(t.g,Y8))===0?void 0:t),!0)},Xoe,$oe),oGe=ls(function(t,e,n){return t.h===0&&(cs(e,n,uM(t.g,z8)),!0)},function(t,e,n){if((e=BVe(e))!=null&&(typeof e=="string"&&OV(e),e!=null))switch(mo(t,n,0),typeof e){case"number":t=t.g,xg(e),Jm(t,_n,cr);break;case"bigint":n=BigInt.asUintN(64,e),n=new iL(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),Jm(t.g,n.h,n.g);break;default:n=OV(e),Jm(t.g,n.h,n.g)}},Qa()),fr=ls(function(t,e,n){return t.h===0&&(cs(e,n,Xd(t.g)),!0)},Joe,vM),i3=Sv(function(t,e,n){return(t.h===0||t.h===2)&&(e=vv(e,0|e[Xe],n,!1,!1),t.h==2?JT(t,Xd,e):e.push(Xd(t.g)),!0)},function(t,e,n){if((e=bv(mv,e))!=null&&e.length){n=hM(t,n);for(let r=0;r<e.length;r++)ZT(t.g,e[r]);pM(t,n)}},vM),Sm=ls(function(t,e,n){return t.h===0&&(cs(e,n,(t=Xd(t.g))===0?void 0:t),!0)},Joe,vM),Kn=ls(function(t,e,n){return t.h===0&&(cs(e,n,dM(t.g)),!0)},Zoe,Uoe),Zm=ls(function(t,e,n){return t.h===0&&(cs(e,n,(t=dM(t.g))===!1?void 0:t),!0)},Zoe,Uoe),Ui=Sv(function(t,e,n){return t.h===2&&(t=fM(t),vv(e,0|e[Xe],n,!1).push(t),!0)},function(t,e,n){if((e=bv(Pg,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&QT(r,i,ooe(s))}},gM),fd=ls(function(t,e,n){return t.h===2&&(cs(e,n,(t=fM(t))===""?void 0:t),!0)},Qoe,gM),rn=ls(function(t,e,n){return t.h===2&&(cs(e,n,fM(t)),!0)},Qoe,gM),Wr=function(t,e,n=mM){return new _v(t,e,n)}(function(t,e,n,r,i){return t.h===2&&(r=Od(void 0,r,!0),vv(e,0|e[Xe],n,!0).push(r),x_(t,r,i),!0)},function(t,e,n,r,i){if(Array.isArray(e))for(let s=0;s<e.length;s++)eae(t,e[s],n,r,i)}),an=e3(function(t,e,n,r,i,s){return t.h===2&&(koe(e,0|e[Xe],s,n),x_(t,e=aM(e,r,n),i),!0)},eae),rae=ls(function(t,e,n){return t.h===2&&(cs(e,n,Doe(t)),!0)},tae,Boe),aGe=Sv(function(t,e,n){return(t.h===0||t.h===2)&&(e=vv(e,0|e[Xe],n,!1,!1),t.h==2?JT(t,hu,e):e.push(hu(t.g)),!0)},function(t,e,n){if((e=bv(boe,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&(mo(r,i,0),yv(r.g,s))}},joe),lGe=ls(function(t,e,n){return t.h===0&&(cs(e,n,(t=hu(t.g))===0?void 0:t),!0)},function(t,e,n){(e=boe(e))!=null&&e!=null&&(mo(t,n,0),yv(t.g,e))},joe),na=ls(function(t,e,n){return t.h===0&&(cs(e,n,Xd(t.g)),!0)},function(t,e,n){(e=mv(e))!=null&&(e=parseInt(e,10),mo(t,n,0),ZT(t.g,e))},Hoe);class cGe{constructor(e,n){this.h=e,this.g=n,this.l=Vt,this.m=nt,this.defaultValue=void 0}}function el(t,e){return new cGe(t,e)}function gf(t,e){return(n,r)=>{if(e2.length){const s=e2.pop();s.o(r),V4(s.g,n,r),n=s}else n=new class{constructor(s,o){if(AV.length){const a=AV.pop();V4(a,s,o),s=a}else s=new class{constructor(a,l){this.h=null,this.m=!1,this.g=this.l=this.j=0,V4(this,a,l)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ba=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({fa:s=!1}={}){this.fa=s}}(n,r);try{const s=new t,o=s.u;EM(e)(o,n);var i=s}finally{n.g.clear(),n.m=-1,n.h=-1,e2.length<100&&e2.push(n)}return i}}function s3(t){return function(){const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};Yoe(this.u,e,np(t3,n3,r3,t)),Ag(e,e.g.end());const n=new Uint8Array(e.h),r=e.l,i=r.length;let s=0;for(let o=0;o<i;o++){const a=r[o];n.set(a,s),s+=a.length}return e.l=[n],n}}var UV=class extends Ve{constructor(t){super(t)}},jV=[0,fd,ls(function(t,e,n){return t.h===2&&(cs(e,n,(t=Doe(t))===jh()?void 0:t),!0)},function(t,e,n){if(e!=null){if(e instanceof Ve){const r=e.Ra;return void(r&&(e=r(e),e!=null&&QT(t,n,cM(e).buffer)))}if(Array.isArray(e))return}tae(t,e,n)},Boe)];let q4,$V=globalThis.trustedTypes;function BV(t){q4===void 0&&(q4=function(){let n=null;if(!$V)return n;try{const r=i=>i;n=$V.createPolicy("goog#html",{createHTML:r,createScript:r,createScriptURL:r})}catch{}return n}());var e=q4;return new class{constructor(n){this.g=n}toString(){return this.g+""}}(e?e.createScriptURL(t):t)}function uGe(t,...e){if(e.length===0)return BV(t[0]);let n=t[0];for(let r=0;r<e.length;r++)n+=encodeURIComponent(e[r])+t[r+1];return BV(n)}var iae=[0,fr,na,Kn,-1,i3,na,-1],dGe=class extends Ve{constructor(t){super(t)}},sae=[0,Kn,rn,Kn,na,-1,Sv(function(t,e,n){return(t.h===0||t.h===2)&&(e=vv(e,0|e[Xe],n,!1,!1),t.h==2?JT(t,JVe,e):e.push(Xd(t.g)),!0)},function(t,e,n){if((e=bv(mv,e))!=null&&e.length){n=hM(t,n);for(let r=0;r<e.length;r++)ZT(t.g,e[r]);pM(t,n)}},Hoe),rn,-1,[0,Kn,-1],na,Kn,-1],oae=[0,rn,-2],HV=class extends Ve{constructor(e){super(e)}},aae=[0],lae=[0,fr,Kn,1,Kn,-3],ho=class extends Ve{constructor(e){super(e,2)}},Nr={};Nr[336783863]=[0,rn,Kn,-1,fr,[0,[1,2,3,4,5,6,7,8],an,aae,an,sae,an,oae,an,lae,an,iae,an,[0,rn,-2],an,[0,rn,na],an,[0,na,rn]],[0,rn],Kn,[0,[1,3],[2,4],an,[0,i3],-1,an,[0,Ui],-1,Wr,[0,rn,-1]],rn];var VV=[0,G4,-1,Zm,-3,G4,i3,fd,Sm,G4,-1,Zm,Sm,Zm,-2,fd];function go(t,e){tL(t,2,gv(e),"")}function xn(t,e){XT(t,3,e)}function Mt(t,e){XT(t,4,e)}var ss=class extends Ve{constructor(t){super(t,500)}o(t){return nt(this,0,7,t)}},U1=[-1,{}],GV=[0,rn,1,U1],qV=[0,rn,Ui,U1];function vo(t,e){eC(t,1,ss,e)}function Fn(t,e){XT(t,10,e)}function Wt(t,e){XT(t,15,e)}var $s=class extends Ve{constructor(t){super(t,500)}o(t){return nt(this,0,1001,t)}},cae=[-500,Wr,[-500,fd,-1,Ui,-3,[-2,Nr,Kn],Wr,jV,Sm,-1,GV,qV,Wr,[0,fd,Zm],fd,VV,Sm,Ui,987,Ui],4,Wr,[-500,rn,-1,[-1,{}],998,rn],Wr,[-500,rn,Ui,-1,[-2,{},Kn],997,Ui,-1],Sm,Wr,[-500,rn,Ui,U1,998,Ui],Ui,Sm,GV,qV,Wr,[0,fd,-1,U1],Ui,-2,VV,fd,-1,Zm,[0,Zm,lGe],978,U1,Wr,jV];$s.prototype.g=s3(cae);var fGe=gf($s,cae),hGe=class extends Ve{constructor(t){super(t)}},uae=class extends Ve{constructor(e){super(e)}g(){return fu(this,hGe,1)}},dae=[0,Wr,[0,fr,Mr,rn,-1]],o3=gf(uae,dae),pGe=class extends Ve{constructor(t){super(t)}},mGe=class extends Ve{constructor(e){super(e)}},K4=class extends Ve{constructor(t){super(t)}h(){return Vt(this,pGe,2)}g(){return fu(this,mGe,5)}},fae=gf(class extends Ve{constructor(t){super(t)}},[0,Ui,i3,wM,[0,na,[0,fr,-3],[0,Mr,-3],[0,fr,-1,[0,Wr,[0,fr,-2]]],Wr,[0,Mr,-1,rn,Mr]],rn,-1,Jd,Wr,[0,fr,Mr],Ui,Jd]),hae=class extends Ve{constructor(t){super(t)}},Qm=gf(class extends Ve{constructor(t){super(t)}},[0,Wr,[0,Mr,-4]]),pae=class extends Ve{constructor(t){super(t)}},P_=gf(class extends Ve{constructor(t){super(t)}},[0,Wr,[0,Mr,-4]]),gGe=class extends Ve{constructor(t){super(t)}},vGe=[0,fr,-1,wM,na],mae=class extends Ve{constructor(t){super(t)}};mae.prototype.g=s3([0,Mr,-4,Jd]);var yGe=class extends Ve{constructor(t){super(t)}},_Ge=gf(class extends Ve{constructor(t){super(t)}},[0,Wr,[0,1,fr,rn,dae],Jd]),KV=class extends Ve{constructor(e){super(e)}},bGe=class extends Ve{constructor(t){super(t)}oa(){const t=Roe(this);return t??jh()}},SGe=class extends Ve{constructor(t){super(t)}},gae=[1,2],EGe=gf(class extends Ve{constructor(t){super(t)}},[0,Wr,[0,gae,an,[0,wM],an,[0,rae],fr,rn],Jd]),CM=class extends Ve{constructor(t){super(t)}},vae=[0,rn,fr,Mr,Ui,-1],WV=class extends Ve{constructor(t){super(t)}},wGe=[0,Kn,-1],zV=class extends Ve{constructor(e){super(e)}},SE=[1,2,3,4,5],rC=class extends Ve{constructor(t){super(t)}g(){return Roe(this)!=null}h(){return ta(this,2)!=null}},zn=class extends Ve{constructor(t){super(t)}g(){return _oe(Lg(this,2))??!1}},yae=[0,rae,rn,[0,fr,Jd,-1],[0,oGe,Jd]],Er=[0,yae,Kn,[0,SE,an,lae,an,sae,an,iae,an,aae,an,oae],na],a3=class extends Ve{constructor(e){super(e)}},TM=[0,Er,Mr,-1,fr],CGe=el(502141897,a3);Nr[502141897]=TM;var TGe=gf(class extends Ve{constructor(t){super(t)}},[0,[0,na,-1,sGe,aGe],vGe]),_ae=class extends Ve{constructor(t){super(t)}},bae=class extends Ve{constructor(t){super(t)}},RM=[0,Er,Mr,[0,Er],Kn],Sae=[0,Er,TM,RM,Mr,[0,[0,yae]]],RGe=el(508968150,bae);Nr[508968150]=Sae,Nr[508968149]=RM;var Eae=class extends Ve{constructor(t){super(t)}},IGe=el(513916220,Eae);Nr[513916220]=[0,Er,Sae,fr];var zp=class extends Ve{constructor(t){super(t)}h(){return Vt(this,CM,2)}g(){kn(this,2)}},wae=[0,Er,vae];Nr[478825465]=wae;var kGe=class extends Ve{constructor(t){super(t)}},Cae=class extends Ve{constructor(t){super(t)}},IM=class extends Ve{constructor(t){super(t)}},kM=class extends Ve{constructor(t){super(t)}},Tae=class extends Ve{constructor(t){super(t)}},YV=[0,Er,[0,Er],wae,-1],Rae=[0,Er,Mr,fr],xM=[0,Er,Mr],Iae=[0,Er,Rae,xM,Mr],xGe=el(479097054,Tae);Nr[479097054]=[0,Er,Iae,YV],Nr[463370452]=YV,Nr[464864288]=Rae;var PGe=el(462713202,kM);Nr[462713202]=Iae,Nr[474472470]=xM;var LGe=class extends Ve{constructor(t){super(t)}},kae=class extends Ve{constructor(t){super(t)}},xae=class extends Ve{constructor(t){super(t)}},Pae=class extends Ve{constructor(t){super(t)}},PM=[0,Er,Mr,-1,fr],oL=[0,Er,Mr,Kn];Pae.prototype.g=s3([0,Er,xM,[0,Er],TM,RM,PM,oL]);var Lae=class extends Ve{constructor(t){super(t)}},AGe=el(456383383,Lae);Nr[456383383]=[0,Er,vae];var Aae=class extends Ve{constructor(t){super(t)}},OGe=el(476348187,Aae);Nr[476348187]=[0,Er,wGe];var Oae=class extends Ve{constructor(t){super(t)}},XV=class extends Ve{constructor(t){super(t)}},Mae=[0,na,-1],MGe=el(458105876,class extends Ve{constructor(t){super(t)}g(){var t=this.u;const e=0|t[Xe],n=2&e;return t=function(r,i,s){var o=XV;const a=2&i;let l=!1;if(s==null){if(a)return LV();s=[]}else if(s.constructor===ea){if((2&s.L)==0||a)return s;s=s.X()}else Array.isArray(s)?l=!!(2&(0|s[Xe])):s=[];if(a){if(!s.length)return LV();l||(l=!0,pv(s))}else l&&(l=!1,s=Ioe(s));return l||(64&(0|s[Xe])?s[Xe]&=-33:32&i&&HT(s,32)),nr(r,i,2,o=new ea(s,o,HVe,void 0)),o}(t,e,vu(t,e,2)),!n&&XV&&(t.ra=!0),t}});Nr[458105876]=[0,Mae,iGe,[!0,Jd,[0,rn,-1,Ui]]];var LM=class extends Ve{constructor(t){super(t)}},Nae=el(458105758,LM);Nr[458105758]=[0,Er,rn,Mae];var Dae=class extends Ve{constructor(t){super(t)}},NGe=el(443442058,Dae);Nr[443442058]=[0,Er,rn,fr,Mr,Ui,-1,Kn,Mr],Nr[514774813]=PM;var Fae=class extends Ve{constructor(t){super(t)}},DGe=el(516587230,Fae);function aL(t,e){return e=e?e.clone():new CM,t.displayNamesLocale!==void 0?kn(e,1,gv(t.displayNamesLocale)):t.displayNamesLocale===void 0&&kn(e,1),t.maxResults!==void 0?Hl(e,2,t.maxResults):"maxResults"in t&&kn(e,2),t.scoreThreshold!==void 0?Ke(e,3,t.scoreThreshold):"scoreThreshold"in t&&kn(e,3),t.categoryAllowlist!==void 0?tC(e,4,t.categoryAllowlist):"categoryAllowlist"in t&&kn(e,4),t.categoryDenylist!==void 0?tC(e,5,t.categoryDenylist):"categoryDenylist"in t&&kn(e,5),e}function AM(t,e=-1,n=""){return{categories:t.map(r=>({index:Vo(r,1)??0??-1,score:vr(r,2)??0,categoryName:ta(r,3)??""??"",displayName:ta(r,4)??""??""})),headIndex:e,headName:n}}function Uae(t){var o,a;var e=ah(t,3,mf,oh()),n=ah(t,2,mv,oh()),r=ah(t,1,Pg,oh()),i=ah(t,9,Pg,oh());const s={categories:[],keypoints:[]};for(let l=0;l<e.length;l++)s.categories.push({score:e[l],index:n[l]??-1,categoryName:r[l]??"",displayName:i[l]??""});if((e=(o=Vt(t,K4,4))==null?void 0:o.h())&&(s.boundingBox={originX:Vo(e,1)??0,originY:Vo(e,2)??0,width:Vo(e,3)??0,height:Vo(e,4)??0,angle:0}),(a=Vt(t,K4,4))==null?void 0:a.g().length)for(const l of Vt(t,K4,4).g())s.keypoints.push({x:_E(l,1)??0,y:_E(l,2)??0,score:_E(l,4)??0,label:ta(l,3)??""});return s}function l3(t){const e=[];for(const n of fu(t,pae,1))e.push({x:vr(n,1)??0,y:vr(n,2)??0,z:vr(n,3)??0,visibility:vr(n,4)??0});return e}function j1(t){const e=[];for(const n of fu(t,hae,1))e.push({x:vr(n,1)??0,y:vr(n,2)??0,z:vr(n,3)??0,visibility:vr(n,4)??0});return e}function JV(t){return Array.from(t,e=>e>127?e-256:e)}function ZV(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,r=0,i=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],r+=t[s]*t[s],i+=e[s]*e[s];if(r<=0||i<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(r*i)}let t2;Nr[516587230]=[0,Er,PM,oL,Mr],Nr[518928384]=oL;const FGe=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function jae(){if(t2===void 0)try{await WebAssembly.instantiate(FGe),t2=!0}catch{t2=!1}return t2}async function j0(t,e=uGe``){const n=await jae()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Jf=class{};function $ae(){var t=navigator;return typeof OffscreenCanvas<"u"&&(!function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")}(t)||!!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}async function QV(t){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise((n,r)=>{e.addEventListener("load",()=>{n()},!1),e.addEventListener("error",i=>{r(i)},!1),document.body.appendChild(e)})}importScripts(t.toString())}function Bae(t){return t.videoWidth!==void 0?[t.videoWidth,t.videoHeight]:t.naturalWidth!==void 0?[t.naturalWidth,t.naturalHeight]:t.displayWidth!==void 0?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function Ye(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function eG(t,e,n){if(!t.i.canvas)throw Error("No OpenGL canvas configured.");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext("webgl2")||t.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=Bae(e);return!t.l||r===t.i.canvas.width&&i===t.i.canvas.height||(t.i.canvas.width=r,t.i.canvas.height=i),[r,i]}function tG(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const r=new Uint32Array(e.length);for(let i=0;i<e.length;i++)r[i]=t.i.stringToNewUTF8(e[i]);e=t.i._malloc(4*r.length),t.i.HEAPU32.set(r,e>>2),n(e);for(const i of r)t.i._free(i);t.i._free(e)}function fl(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function Wu(t,e,n){let r=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(i,s,o)=>{s?(n(r,o),r=[]):r.push(i)}}Jf.forVisionTasks=function(t){return j0("vision",t)},Jf.forTextTasks=function(t){return j0("text",t)},Jf.forGenAiExperimentalTasks=function(t){return j0("genai_experimental",t)},Jf.forGenAiTasks=function(t){return j0("genai",t)},Jf.forAudioTasks=function(t){return j0("audio",t)},Jf.isSimdSupported=function(){return jae()};async function UGe(t,e,n,r){return t=await(async(i,s,o,a,l)=>{if(s&&await QV(s),!self.ModuleFactory||o&&(await QV(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&l&&((s=self.Module).locateFile=l.locateFile,l.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=l.mainScriptUrlOrBlob)),l=await self.ModuleFactory(self.Module||l),self.ModuleFactory=self.Module=void 0,new i(l,a)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:i=>i.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&i.endsWith(".data")?n.assetBinaryPath.toString():i}),await t.o(r),t}function W4(t,e){const n=Vt(t.baseOptions,rC,1)||new rC;typeof e=="string"?(kn(n,2,gv(e)),kn(n,1)):e instanceof Uint8Array&&(kn(n,1,q8(e,!1)),kn(n,2)),nt(t.baseOptions,0,1,n)}function nG(t){try{const e=t.G.length;if(e===1)throw Error(t.G[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.G.map(n=>n.message).join(", "))}finally{t.G=[]}}function je(t,e){t.B=Math.max(t.B,e)}function c3(t,e){t.A=new ss,go(t.A,"PassThroughCalculator"),xn(t.A,"free_memory"),Mt(t.A,"free_memory_unused_out"),Fn(e,"free_memory"),vo(e,t.A)}function Og(t,e){xn(t.A,e),Mt(t.A,e+"_unused_out")}function u3(t){t.g.addBoolToStream(!0,"free_memory",t.B)}var EE=class{constructor(t){this.g=t,this.G=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){var n,r,i,s,o,a;if(e){const l=t.baseOptions||{};if((n=t.baseOptions)!=null&&n.modelAssetBuffer&&((r=t.baseOptions)!=null&&r.modelAssetPath))throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!((i=Vt(this.baseOptions,rC,1))!=null&&i.g()||(s=Vt(this.baseOptions,rC,1))!=null&&s.h()||(o=t.baseOptions)!=null&&o.modelAssetBuffer||(a=t.baseOptions)!=null&&a.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(c,u){let f=Vt(c.baseOptions,zV,3);if(!f){var p=f=new zV,m=new HV;F1(p,4,SE,m)}"delegate"in u&&(u.delegate==="GPU"?(u=f,p=new dGe,F1(u,2,SE,p)):(u=f,p=new HV,F1(u,4,SE,p))),nt(c.baseOptions,0,3,f)}(this,l),l.modelAssetPath)return fetch(l.modelAssetPath.toString()).then(c=>{if(c.ok)return c.arrayBuffer();throw Error(`Failed to fetch model: ${l.modelAssetPath} (${c.status})`)}).then(c=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(c),!0,!1,!1),W4(this,"/model.dat"),this.m(),this.I()});if(l.modelAssetBuffer instanceof Uint8Array)W4(this,l.modelAssetBuffer);else if(l.modelAssetBuffer)return async function(c){const u=[];for(var f=0;;){const{done:p,value:m}=await c.read();if(p)break;u.push(m),f+=m.length}if(u.length===0)return new Uint8Array(0);if(u.length===1)return u[0];c=new Uint8Array(f),f=0;for(const p of u)c.set(p,f),f+=p.length;return c}(l.modelAssetBuffer).then(c=>{W4(this,c),this.m(),this.I()})}return this.m(),this.I(),Promise.resolve()}I(){}da(){let t;if(this.g.da(e=>{t=fGe(e)}),!t)throw Error("Failed to retrieve CalculatorGraphConfig");return t}setGraph(t,e){this.g.attachErrorListener((n,r)=>{this.G.push(Error(r))}),this.g.La(),this.g.setGraph(t,e),this.A=void 0,nG(this)}finishProcessing(){this.g.finishProcessing(),nG(this)}close(){this.A=void 0,this.g.closeGraph()}};function Qc(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}EE.prototype.close=EE.prototype.close,function(t,e){t=t.split(".");var n,r=Uh;for((t[0]in r)||r.execScript===void 0||r.execScript("var "+t[0]);t.length&&(n=t.shift());)t.length||e===void 0?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e}("TaskRunner",EE);class jGe{constructor(e,n,r,i){this.g=e,this.h=n,this.m=r,this.l=i}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function rG(t,e,n){const r=t.g;if(n=Qc(r.createShader(n),"Failed to create WebGL shader"),r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(t.h,n),n}function iG(t,e){const n=t.g,r=Qc(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(r);const i=Qc(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(t.O),n.vertexAttribPointer(t.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=Qc(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.I),n.vertexAttribPointer(t.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new jGe(n,r,i,s)}function OM(t,e){if(t.g){if(e!==t.g)throw Error("Cannot change GL context once initialized")}else t.g=e}function MM(t,e,n,r){return OM(t,e),t.h||(t.m(),t.C()),n?(t.s||(t.s=iG(t,!0)),n=t.s):(t.v||(t.v=iG(t,!1)),n=t.v),e.useProgram(t.h),n.bind(),t.l(),t=r(),n.g.bindVertexArray(null),t}function d3(t,e,n){return OM(t,e),t=Qc(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function f3(t,e,n){OM(t,e),t.A||(t.A=Qc(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,t.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function NM(t){var e;(e=t.g)==null||e.bindFramebuffer(t.g.FRAMEBUFFER,null)}var DM=class{G(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const t=this.g;if(this.h=Qc(t.createProgram(),"Failed to create WebGL program"),this.aa=rG(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,t.VERTEX_SHADER),this.Z=rG(this,this.G(),t.FRAGMENT_SHADER),t.linkProgram(this.h),!t.getProgramParameter(this.h,t.LINK_STATUS))throw Error(`Error during program linking: ${t.getProgramInfoLog(this.h)}`);this.O=t.getAttribLocation(this.h,"aVertex"),this.I=t.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const t=this.g;t.deleteProgram(this.h),t.deleteShader(this.aa),t.deleteShader(this.Z)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function Dc(t,e){switch(e){case 0:return t.g.find(n=>n instanceof Uint8Array);case 1:return t.g.find(n=>n instanceof Float32Array);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function lL(t){var e=Dc(t,1);if(!e){if(e=Dc(t,0))e=new Float32Array(e).map(r=>r/255);else{e=new Float32Array(t.width*t.height);const r=Mg(t);var n=FM(t);if(f3(n,r,Hae(t)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(t.width*t.height*4),r.readPixels(0,0,t.width,t.height,r.RGBA,r.FLOAT,n);for(let i=0,s=0;i<e.length;++i,s+=4)e[i]=n[s]}else r.readPixels(0,0,t.width,t.height,r.RED,r.FLOAT,e)}t.g.push(e)}return e}function Hae(t){let e=Dc(t,2);if(!e){const n=Mg(t);e=Gae(t);const r=lL(t),i=Vae(t);n.texImage2D(n.TEXTURE_2D,0,i,t.width,t.height,0,n.RED,n.FLOAT,r),cL(t)}return e}function Mg(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=Qc(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function Vae(t){if(t=Mg(t),!n2)if(t.getExtension("EXT_color_buffer_float")&&t.getExtension("OES_texture_float_linear")&&t.getExtension("EXT_float_blend"))n2=t.R32F;else{if(!t.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");n2=t.R16F}return n2}function FM(t){return t.l||(t.l=new DM),t.l}function Gae(t){const e=Mg(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Dc(t,2);return n||(n=d3(FM(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function cL(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var n2,ii=class{constructor(t,e,n,r,i,s,o){this.g=t,this.m=e,this.j=n,this.canvas=r,this.l=i,this.width=s,this.height=o,this.j&&--sG===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Fa(){return!!Dc(this,0)}ja(){return!!Dc(this,1)}P(){return!!Dc(this,2)}ia(){return(e=Dc(t=this,0))||(e=lL(t),e=new Uint8Array(e.map(n=>255*n)),t.g.push(e)),e;var t,e}ha(){return lL(this)}M(){return Hae(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const r=Mg(this),i=FM(this);r.activeTexture(r.TEXTURE1),n=d3(i,r,this.m?r.LINEAR:r.NEAREST),r.bindTexture(r.TEXTURE_2D,n);const s=Vae(this);r.texImage2D(r.TEXTURE_2D,0,s,this.width,this.height,0,r.RED,r.FLOAT,null),r.bindTexture(r.TEXTURE_2D,null),f3(i,r,n),MM(i,r,!1,()=>{Gae(this),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),cL(this)}),NM(i),cL(this)}}t.push(n)}return new ii(t,this.m,this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Mg(this).deleteTexture(Dc(this,2)),sG=-1}};ii.prototype.close=ii.prototype.close,ii.prototype.clone=ii.prototype.clone,ii.prototype.getAsWebGLTexture=ii.prototype.M,ii.prototype.getAsFloat32Array=ii.prototype.ha,ii.prototype.getAsUint8Array=ii.prototype.ia,ii.prototype.hasWebGLTexture=ii.prototype.P,ii.prototype.hasFloat32Array=ii.prototype.ja,ii.prototype.hasUint8Array=ii.prototype.Fa;var sG=250;function Pl(t,e){switch(e){case 0:return t.g.find(n=>n instanceof ImageData);case 1:return t.g.find(n=>typeof ImageBitmap<"u"&&n instanceof ImageBitmap);case 2:return t.g.find(n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture);default:throw Error(`Type is not supported: ${e}`)}}function qae(t){var e=Pl(t,0);if(!e){e=Ng(t);const n=h3(t),r=new Uint8Array(t.width*t.height*4);f3(n,e,wE(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,r),NM(n),e=new ImageData(new Uint8ClampedArray(r.buffer),t.width,t.height),t.g.push(e)}return e}function wE(t){let e=Pl(t,2);if(!e){const n=Ng(t);e=CE(t);const r=Pl(t,1)||qae(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),a1(t)}return e}function Ng(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=Qc(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function h3(t){return t.l||(t.l=new DM),t.l}function CE(t){const e=Ng(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Pl(t,2);return n||(n=d3(h3(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function a1(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function oG(t){const e=Ng(t);return MM(h3(t),e,!0,()=>function(n,r){const i=n.canvas;if(i.width===n.width&&i.height===n.height)return r();const s=i.width,o=i.height;return i.width=n.width,i.height=n.height,n=r(),i.width=s,i.height=o,n}(t,()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return t.canvas.transferToImageBitmap()}))}var si=class{constructor(t,e,n,r,i,s,o){this.g=t,this.j=e,this.m=n,this.canvas=r,this.l=i,this.width=s,this.height=o,(this.j||this.m)&&--aG===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ea(){return!!Pl(this,0)}ka(){return!!Pl(this,1)}P(){return!!Pl(this,2)}Ca(){return qae(this)}Ba(){var t=Pl(this,1);return t||(wE(this),CE(this),t=oG(this),a1(this),this.g.push(t),this.j=!0),t}M(){return wE(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const r=Ng(this),i=h3(this);r.activeTexture(r.TEXTURE1),n=d3(i,r),r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,null),f3(i,r,n),MM(i,r,!1,()=>{CE(this),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),a1(this)}),NM(i),a1(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);wE(this),CE(this),n=oG(this),a1(this)}t.push(n)}return new si(t,this.ka(),this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&Pl(this,1).close(),this.m&&Ng(this).deleteTexture(Pl(this,2)),aG=-1}};si.prototype.close=si.prototype.close,si.prototype.clone=si.prototype.clone,si.prototype.getAsWebGLTexture=si.prototype.M,si.prototype.getAsImageBitmap=si.prototype.Ba,si.prototype.getAsImageData=si.prototype.Ca,si.prototype.hasWebGLTexture=si.prototype.P,si.prototype.hasImageBitmap=si.prototype.ka,si.prototype.hasImageData=si.prototype.Ea;var aG=250;function tl(...t){return t.map(([e,n])=>({start:e,end:n}))}const $Ge=function(t){return class extends t{La(){this.i._registerModelResourcesGraphService()}}}((lG=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:$ae()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph(new TextEncoder().encode(t),!1)}setGraph(t,e){const n=t.length,r=this.i._malloc(n);this.i.HEAPU8.set(t,r),e?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(t,e,n,r,i){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),Ye(this,r||"input_audio",s=>{Ye(this,i=i||"audio_header",o=>{this.i._configureAudio(s,o,t,e??0,n)})})}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}da(t){fl(this,"__graph_config__",e=>{t(e)}),Ye(this,"__graph_config__",e=>{this.i._getGraphConfig(e,void 0)}),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,i){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),Ye(this,r,o=>{this.i._addAudioToInputStream(this.g,e,n,o,i)})}addGpuBufferToStream(t,e,n){Ye(this,e,r=>{const[i,s]=eG(this,t,r);this.i._addBoundTextureToStream(r,i,s,n)})}addBoolToStream(t,e,n){Ye(this,e,r=>{this.i._addBoolToInputStream(t,r,n)})}addDoubleToStream(t,e,n){Ye(this,e,r=>{this.i._addDoubleToInputStream(t,r,n)})}addFloatToStream(t,e,n){Ye(this,e,r=>{this.i._addFloatToInputStream(t,r,n)})}addIntToStream(t,e,n){Ye(this,e,r=>{this.i._addIntToInputStream(t,r,n)})}addUintToStream(t,e,n){Ye(this,e,r=>{this.i._addUintToInputStream(t,r,n)})}addStringToStream(t,e,n){Ye(this,e,r=>{Ye(this,t,i=>{this.i._addStringToInputStream(i,r,n)})})}addStringRecordToStream(t,e,n){Ye(this,e,r=>{tG(this,Object.keys(t),i=>{tG(this,Object.values(t),s=>{this.i._addFlatHashMapToInputStream(i,s,Object.keys(t).length,r,n)})})})}addProtoToStream(t,e,n,r){Ye(this,n,i=>{Ye(this,e,s=>{const o=this.i._malloc(t.length);this.i.HEAPU8.set(t,o),this.i._addProtoToInputStream(o,t.length,s,i,r),this.i._free(o)})})}addEmptyPacketToStream(t,e){Ye(this,t,n=>{this.i._addEmptyPacketToInputStream(n,e)})}addBoolVectorToStream(t,e,n){Ye(this,e,r=>{const i=this.i._allocateBoolVector(t.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const s of t)this.i._addBoolVectorEntry(i,s);this.i._addBoolVectorToInputStream(i,r,n)})}addDoubleVectorToStream(t,e,n){Ye(this,e,r=>{const i=this.i._allocateDoubleVector(t.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const s of t)this.i._addDoubleVectorEntry(i,s);this.i._addDoubleVectorToInputStream(i,r,n)})}addFloatVectorToStream(t,e,n){Ye(this,e,r=>{const i=this.i._allocateFloatVector(t.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const s of t)this.i._addFloatVectorEntry(i,s);this.i._addFloatVectorToInputStream(i,r,n)})}addIntVectorToStream(t,e,n){Ye(this,e,r=>{const i=this.i._allocateIntVector(t.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const s of t)this.i._addIntVectorEntry(i,s);this.i._addIntVectorToInputStream(i,r,n)})}addUintVectorToStream(t,e,n){Ye(this,e,r=>{const i=this.i._allocateUintVector(t.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of t)this.i._addUintVectorEntry(i,s);this.i._addUintVectorToInputStream(i,r,n)})}addStringVectorToStream(t,e,n){Ye(this,e,r=>{const i=this.i._allocateStringVector(t.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const s of t)Ye(this,s,o=>{this.i._addStringVectorEntry(i,o)});this.i._addStringVectorToInputStream(i,r,n)})}addBoolToInputSidePacket(t,e){Ye(this,e,n=>{this.i._addBoolToInputSidePacket(t,n)})}addDoubleToInputSidePacket(t,e){Ye(this,e,n=>{this.i._addDoubleToInputSidePacket(t,n)})}addFloatToInputSidePacket(t,e){Ye(this,e,n=>{this.i._addFloatToInputSidePacket(t,n)})}addIntToInputSidePacket(t,e){Ye(this,e,n=>{this.i._addIntToInputSidePacket(t,n)})}addUintToInputSidePacket(t,e){Ye(this,e,n=>{this.i._addUintToInputSidePacket(t,n)})}addStringToInputSidePacket(t,e){Ye(this,e,n=>{Ye(this,t,r=>{this.i._addStringToInputSidePacket(r,n)})})}addProtoToInputSidePacket(t,e,n){Ye(this,n,r=>{Ye(this,e,i=>{const s=this.i._malloc(t.length);this.i.HEAPU8.set(t,s),this.i._addProtoToInputSidePacket(s,t.length,i,r),this.i._free(s)})})}addBoolVectorToInputSidePacket(t,e){Ye(this,e,n=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const i of t)this.i._addBoolVectorEntry(r,i);this.i._addBoolVectorToInputSidePacket(r,n)})}addDoubleVectorToInputSidePacket(t,e){Ye(this,e,n=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const i of t)this.i._addDoubleVectorEntry(r,i);this.i._addDoubleVectorToInputSidePacket(r,n)})}addFloatVectorToInputSidePacket(t,e){Ye(this,e,n=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const i of t)this.i._addFloatVectorEntry(r,i);this.i._addFloatVectorToInputSidePacket(r,n)})}addIntVectorToInputSidePacket(t,e){Ye(this,e,n=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const i of t)this.i._addIntVectorEntry(r,i);this.i._addIntVectorToInputSidePacket(r,n)})}addUintVectorToInputSidePacket(t,e){Ye(this,e,n=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const i of t)this.i._addUintVectorEntry(r,i);this.i._addUintVectorToInputSidePacket(r,n)})}addStringVectorToInputSidePacket(t,e){Ye(this,e,n=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const i of t)Ye(this,i,s=>{this.i._addStringVectorEntry(r,s)});this.i._addStringVectorToInputSidePacket(r,n)})}attachBoolListener(t,e){fl(this,t,e),Ye(this,t,n=>{this.i._attachBoolListener(n)})}attachBoolVectorListener(t,e){Wu(this,t,e),Ye(this,t,n=>{this.i._attachBoolVectorListener(n)})}attachIntListener(t,e){fl(this,t,e),Ye(this,t,n=>{this.i._attachIntListener(n)})}attachIntVectorListener(t,e){Wu(this,t,e),Ye(this,t,n=>{this.i._attachIntVectorListener(n)})}attachUintListener(t,e){fl(this,t,e),Ye(this,t,n=>{this.i._attachUintListener(n)})}attachUintVectorListener(t,e){Wu(this,t,e),Ye(this,t,n=>{this.i._attachUintVectorListener(n)})}attachDoubleListener(t,e){fl(this,t,e),Ye(this,t,n=>{this.i._attachDoubleListener(n)})}attachDoubleVectorListener(t,e){Wu(this,t,e),Ye(this,t,n=>{this.i._attachDoubleVectorListener(n)})}attachFloatListener(t,e){fl(this,t,e),Ye(this,t,n=>{this.i._attachFloatListener(n)})}attachFloatVectorListener(t,e){Wu(this,t,e),Ye(this,t,n=>{this.i._attachFloatVectorListener(n)})}attachStringListener(t,e){fl(this,t,e),Ye(this,t,n=>{this.i._attachStringListener(n)})}attachStringVectorListener(t,e){Wu(this,t,e),Ye(this,t,n=>{this.i._attachStringVectorListener(n)})}attachProtoListener(t,e,n){fl(this,t,e),Ye(this,t,r=>{this.i._attachProtoListener(r,n||!1)})}attachProtoVectorListener(t,e,n){Wu(this,t,e),Ye(this,t,r=>{this.i._attachProtoVectorListener(r,n||!1)})}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),fl(this,t,(r,i)=>{r=new Float32Array(r.buffer,r.byteOffset,r.length/4),e(r,i)}),Ye(this,t,r=>{this.i._attachAudioListener(r,n||!1)})}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends lG{get ea(){return this.i}qa(t,e,n){Ye(this,e,r=>{const[i,s]=eG(this,t,r);this.ea._addBoundTextureAsImageToStream(r,i,s,n)})}U(t,e){fl(this,t,e),Ye(this,t,n=>{this.ea._attachImageListener(n)})}ca(t,e){Wu(this,t,e),Ye(this,t,n=>{this.ea._attachImageVectorListener(n)})}}));var lG,oa=class extends $Ge{};async function Pt(t,e,n){return async function(r,i,s,o){return UGe(r,i,s,o)}(t,n.canvas??($ae()?void 0:document.createElement("canvas")),e,n)}function Kae(t,e,n,r){if(t.T){const s=new mae;if(n!=null&&n.regionOfInterest){if(!t.pa)throw Error("This task doesn't support region-of-interest.");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(i.left<0||i.top<0||i.right>1||i.bottom>1)throw Error("Expected RectF values to be in [0,1].");Ke(s,1,(i.left+i.right)/2),Ke(s,2,(i.top+i.bottom)/2),Ke(s,4,i.right-i.left),Ke(s,3,i.bottom-i.top)}else Ke(s,1,.5),Ke(s,2,.5),Ke(s,4,1),Ke(s,3,1);if(n!=null&&n.rotationDegrees){if((n==null?void 0:n.rotationDegrees)%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(Ke(s,5,-Math.PI*n.rotationDegrees/180),(n==null?void 0:n.rotationDegrees)%180!=0){const[o,a]=Bae(e);n=vr(s,3)*a/o,i=vr(s,4)*o/a,Ke(s,4,n),Ke(s,3,i)}}t.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",t.T,r)}t.g.qa(e,t.aa,r??performance.now()),t.finishProcessing()}function aa(t,e,n){var r;if((r=t.baseOptions)!=null&&r.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");Kae(t,e,n,t.B+1)}function ec(t,e,n,r){var i;if(!((i=t.baseOptions)!=null&&i.g()))throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");Kae(t,e,n,r)}function Dg(t,e,n,r){var i=e.data;const s=e.width,o=s*(e=e.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==o)throw Error("Unsupported channel count: "+i.length/o);return t=new ii([i],n,!1,t.g.i.canvas,t.O,s,e),r?t.clone():t}var Us=class extends EE{constructor(t,e,n,r){super(t),this.g=t,this.aa=e,this.T=n,this.pa=r,this.O=new DM}l(t,e=!0){if("runningMode"in t&&Dy(this.baseOptions,2,!!t.runningMode&&t.runningMode!=="IMAGE"),t.canvas!==void 0&&this.g.i.canvas!==t.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(t,e)}close(){this.O.close(),super.close()}};Us.prototype.close=Us.prototype.close;var ko=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect_in",!1),this.j={detections:[]},nt(t=this.h=new a3,0,1,e=new zn),Ke(this.h,2,.5),Ke(this.h,3,.3)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return"minDetectionConfidence"in t&&Ke(this.h,2,t.minDetectionConfidence??.5),"minSuppressionThreshold"in t&&Ke(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}D(t,e){return this.j={detections:[]},aa(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},ec(this,t,n,e),this.j}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect_in"),Wt(t,"detections");const e=new ho;Za(e,CGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect_in"),Mt(n,"DETECTIONS:detections"),n.o(e),vo(t,n),this.g.attachProtoVectorListener("detections",(r,i)=>{for(const s of r)r=fae(s),this.j.detections.push(Uae(r));je(this,i)}),this.g.attachEmptyPacketListener("detections",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};ko.prototype.detectForVideo=ko.prototype.F,ko.prototype.detect=ko.prototype.D,ko.prototype.setOptions=ko.prototype.o,ko.createFromModelPath=async function(t,e){return Pt(ko,t,{baseOptions:{modelAssetPath:e}})},ko.createFromModelBuffer=function(t,e){return Pt(ko,t,{baseOptions:{modelAssetBuffer:e}})},ko.createFromOptions=function(t,e){return Pt(ko,t,e)};var UM=tl([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),jM=tl([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),$M=tl([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),Wae=tl([474,475],[475,476],[476,477],[477,474]),BM=tl([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),HM=tl([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),zae=tl([469,470],[470,471],[471,472],[472,469]),VM=tl([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),Yae=[...UM,...jM,...$M,...BM,...HM,...VM],Xae=tl([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function cG(t){t.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var or=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,nt(t=this.h=new bae,0,1,e=new zn),this.v=new _ae,nt(this.h,0,3,this.v),this.s=new a3,nt(this.h,0,2,this.s),Hl(this.s,4,1),Ke(this.s,2,.5),Ke(this.v,2,.5),Ke(this.h,4,.5)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return"numFaces"in t&&Hl(this.s,4,t.numFaces??1),"minFaceDetectionConfidence"in t&&Ke(this.s,2,t.minFaceDetectionConfidence??.5),"minTrackingConfidence"in t&&Ke(this.h,4,t.minTrackingConfidence??.5),"minFacePresenceConfidence"in t&&Ke(this.v,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}D(t,e){return cG(this),aa(this,t,e),this.j}F(t,e,n){return cG(this),ec(this,t,n,e),this.j}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect"),Wt(t,"face_landmarks");const e=new ho;Za(e,RGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"NORM_LANDMARKS:face_landmarks"),n.o(e),vo(t,n),this.g.attachProtoVectorListener("face_landmarks",(r,i)=>{for(const s of r)r=P_(s),this.j.faceLandmarks.push(l3(r));je(this,i)}),this.g.attachEmptyPacketListener("face_landmarks",r=>{je(this,r)}),this.outputFaceBlendshapes&&(Wt(t,"blendshapes"),Mt(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",(r,i)=>{if(this.outputFaceBlendshapes)for(const s of r)r=o3(s),this.j.faceBlendshapes.push(AM(r.g()??[]));je(this,i)}),this.g.attachEmptyPacketListener("blendshapes",r=>{je(this,r)})),this.outputFacialTransformationMatrixes&&(Wt(t,"face_geometry"),Mt(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",(r,i)=>{if(this.outputFacialTransformationMatrixes)for(const s of r)(r=Vt(TGe(s),gGe,2))&&this.j.facialTransformationMatrixes.push({rows:Vo(r,1)??0??0,columns:Vo(r,2)??0??0,data:ah(r,3,mf,oh()).slice()??[]});je(this,i)}),this.g.attachEmptyPacketListener("face_geometry",r=>{je(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};or.prototype.detectForVideo=or.prototype.F,or.prototype.detect=or.prototype.D,or.prototype.setOptions=or.prototype.o,or.createFromModelPath=function(t,e){return Pt(or,t,{baseOptions:{modelAssetPath:e}})},or.createFromModelBuffer=function(t,e){return Pt(or,t,{baseOptions:{modelAssetBuffer:e}})},or.createFromOptions=function(t,e){return Pt(or,t,e)},or.FACE_LANDMARKS_LIPS=UM,or.FACE_LANDMARKS_LEFT_EYE=jM,or.FACE_LANDMARKS_LEFT_EYEBROW=$M,or.FACE_LANDMARKS_LEFT_IRIS=Wae,or.FACE_LANDMARKS_RIGHT_EYE=BM,or.FACE_LANDMARKS_RIGHT_EYEBROW=HM,or.FACE_LANDMARKS_RIGHT_IRIS=zae,or.FACE_LANDMARKS_FACE_OVAL=VM,or.FACE_LANDMARKS_CONTOURS=Yae,or.FACE_LANDMARKS_TESSELATION=Xae;var hl=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!0),nt(t=this.j=new Eae,0,1,e=new zn)}get baseOptions(){return Vt(this.j,zn,1)}set baseOptions(t){nt(this.j,0,1,t)}o(t){return super.l(t)}Oa(t,e,n){const r=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:n,aa(this,t,r??{}),!this.h)return this.s}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect"),Wt(t,"stylized_image");const e=new ho;Za(e,IGe,this.j);const n=new ss;go(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"STYLIZED_IMAGE:stylized_image"),n.o(e),vo(t,n),this.g.U("stylized_image",(r,i)=>{var s=!this.h,o=r.data,a=r.width;const l=a*(r=r.height);if(o instanceof Uint8Array)if(o.length===3*l){const c=new Uint8ClampedArray(4*l);for(let u=0;u<l;++u)c[4*u]=o[3*u],c[4*u+1]=o[3*u+1],c[4*u+2]=o[3*u+2],c[4*u+3]=255;o=new ImageData(c,a,r)}else{if(o.length!==4*l)throw Error("Unsupported channel count: "+o.length/l);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,r)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new si([o],!1,!1,this.g.i.canvas,this.O,a,r),this.s=s=s?a.clone():a,this.h&&this.h(s),je(this,i)}),this.g.attachEmptyPacketListener("stylized_image",r=>{this.s=null,this.h&&this.h(null),je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};hl.prototype.stylize=hl.prototype.Oa,hl.prototype.setOptions=hl.prototype.o,hl.createFromModelPath=function(t,e){return Pt(hl,t,{baseOptions:{modelAssetPath:e}})},hl.createFromModelBuffer=function(t,e){return Pt(hl,t,{baseOptions:{modelAssetBuffer:e}})},hl.createFromOptions=function(t,e){return Pt(hl,t,e)};var GM=tl([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function uG(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function dG(t){return t.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function fG(t,e=!0){const n=[];for(const i of t){var r=o3(i);t=[];for(const s of r.g())r=e&&Vo(s,1)!=null?Vo(s,1)??0:-1,t.push({score:vr(s,2)??0,index:r,categoryName:ta(s,3)??""??"",displayName:ta(s,4)??""??""});n.push(t)}return n}var Xs=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],nt(t=this.j=new Tae,0,1,e=new zn),this.s=new kM,nt(this.j,0,2,this.s),this.C=new IM,nt(this.s,0,3,this.C),this.v=new Cae,nt(this.s,0,2,this.v),this.h=new kGe,nt(this.j,0,3,this.h),Ke(this.v,2,.5),Ke(this.s,4,.5),Ke(this.C,2,.5)}get baseOptions(){return Vt(this.j,zn,1)}set baseOptions(t){nt(this.j,0,1,t)}o(t){var i,s,o,a;if(Hl(this.v,3,t.numHands??1),"minHandDetectionConfidence"in t&&Ke(this.v,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&Ke(this.s,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&Ke(this.C,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new zp,n=e,r=aL(t.cannedGesturesClassifierOptions,(i=Vt(this.h,zp,3))==null?void 0:i.h());nt(n,0,2,r),nt(this.h,0,3,e)}else t.cannedGesturesClassifierOptions===void 0&&((s=Vt(this.h,zp,3))==null||s.g());return t.customGesturesClassifierOptions?(nt(n=e=new zp,0,2,r=aL(t.customGesturesClassifierOptions,(o=Vt(this.h,zp,4))==null?void 0:o.h())),nt(this.h,0,4,e)):t.customGesturesClassifierOptions===void 0&&((a=Vt(this.h,zp,4))==null||a.g()),this.l(t)}Ja(t,e){return uG(this),aa(this,t,e),dG(this)}Ka(t,e,n){return uG(this),ec(this,t,n,e),dG(this)}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect"),Wt(t,"hand_gestures"),Wt(t,"hand_landmarks"),Wt(t,"world_hand_landmarks"),Wt(t,"handedness");const e=new ho;Za(e,xGe,this.j);const n=new ss;go(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"HAND_GESTURES:hand_gestures"),Mt(n,"LANDMARKS:hand_landmarks"),Mt(n,"WORLD_LANDMARKS:world_hand_landmarks"),Mt(n,"HANDEDNESS:handedness"),n.o(e),vo(t,n),this.g.attachProtoVectorListener("hand_landmarks",(r,i)=>{for(const s of r){r=P_(s);const o=[];for(const a of fu(r,pae,1))o.push({x:vr(a,1)??0,y:vr(a,2)??0,z:vr(a,3)??0,visibility:vr(a,4)??0});this.landmarks.push(o)}je(this,i)}),this.g.attachEmptyPacketListener("hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("world_hand_landmarks",(r,i)=>{for(const s of r){r=Qm(s);const o=[];for(const a of fu(r,hae,1))o.push({x:vr(a,1)??0,y:vr(a,2)??0,z:vr(a,3)??0,visibility:vr(a,4)??0});this.worldLandmarks.push(o)}je(this,i)}),this.g.attachEmptyPacketListener("world_hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("hand_gestures",(r,i)=>{this.gestures.push(...fG(r,!1)),je(this,i)}),this.g.attachEmptyPacketListener("hand_gestures",r=>{je(this,r)}),this.g.attachProtoVectorListener("handedness",(r,i)=>{this.handedness.push(...fG(r)),je(this,i)}),this.g.attachEmptyPacketListener("handedness",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function hG(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}Xs.prototype.recognizeForVideo=Xs.prototype.Ka,Xs.prototype.recognize=Xs.prototype.Ja,Xs.prototype.setOptions=Xs.prototype.o,Xs.createFromModelPath=function(t,e){return Pt(Xs,t,{baseOptions:{modelAssetPath:e}})},Xs.createFromModelBuffer=function(t,e){return Pt(Xs,t,{baseOptions:{modelAssetBuffer:e}})},Xs.createFromOptions=function(t,e){return Pt(Xs,t,e)},Xs.HAND_CONNECTIONS=GM;var Js=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],nt(t=this.h=new kM,0,1,e=new zn),this.s=new IM,nt(this.h,0,3,this.s),this.j=new Cae,nt(this.h,0,2,this.j),Hl(this.j,3,1),Ke(this.j,2,.5),Ke(this.s,2,.5),Ke(this.h,4,.5)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return"numHands"in t&&Hl(this.j,3,t.numHands??1),"minHandDetectionConfidence"in t&&Ke(this.j,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&Ke(this.h,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&Ke(this.s,2,t.minHandPresenceConfidence??.5),this.l(t)}D(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],aa(this,t,e),hG(this)}F(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ec(this,t,n,e),hG(this)}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect"),Wt(t,"hand_landmarks"),Wt(t,"world_hand_landmarks"),Wt(t,"handedness");const e=new ho;Za(e,PGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"LANDMARKS:hand_landmarks"),Mt(n,"WORLD_LANDMARKS:world_hand_landmarks"),Mt(n,"HANDEDNESS:handedness"),n.o(e),vo(t,n),this.g.attachProtoVectorListener("hand_landmarks",(r,i)=>{for(const s of r)r=P_(s),this.landmarks.push(l3(r));je(this,i)}),this.g.attachEmptyPacketListener("hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("world_hand_landmarks",(r,i)=>{for(const s of r)r=Qm(s),this.worldLandmarks.push(j1(r));je(this,i)}),this.g.attachEmptyPacketListener("world_hand_landmarks",r=>{je(this,r)}),this.g.attachProtoVectorListener("handedness",(r,i)=>{var s=this.handedness,o=s.push;const a=[];for(const l of r){r=o3(l);const c=[];for(const u of r.g())c.push({score:vr(u,2)??0,index:Vo(u,1)??0??-1,categoryName:ta(u,3)??""??"",displayName:ta(u,4)??""??""});a.push(c)}o.call(s,...a),je(this,i)}),this.g.attachEmptyPacketListener("handedness",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Js.prototype.detectForVideo=Js.prototype.F,Js.prototype.detect=Js.prototype.D,Js.prototype.setOptions=Js.prototype.o,Js.createFromModelPath=function(t,e){return Pt(Js,t,{baseOptions:{modelAssetPath:e}})},Js.createFromModelBuffer=function(t,e){return Pt(Js,t,{baseOptions:{modelAssetBuffer:e}})},Js.createFromOptions=function(t,e){return Pt(Js,t,e)},Js.HAND_CONNECTIONS=GM;var Jae=tl([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function pG(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function mG(t){try{if(!t.C)return t.h;t.C(t.h)}finally{u3(t)}}function r2(t,e){t=P_(t),e.push(l3(t))}var Hn=class extends Us{constructor(t,e){super(new oa(t,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,nt(t=this.j=new Pae,0,1,e=new zn),this.J=new IM,nt(this.j,0,2,this.J),this.Z=new LGe,nt(this.j,0,3,this.Z),this.s=new a3,nt(this.j,0,4,this.s),this.H=new _ae,nt(this.j,0,5,this.H),this.v=new kae,nt(this.j,0,6,this.v),this.K=new xae,nt(this.j,0,7,this.K),Ke(this.s,2,.5),Ke(this.s,3,.3),Ke(this.H,2,.5),Ke(this.v,2,.5),Ke(this.v,3,.3),Ke(this.K,2,.5),Ke(this.J,2,.5)}get baseOptions(){return Vt(this.j,zn,1)}set baseOptions(t){nt(this.j,0,1,t)}o(t){return"minFaceDetectionConfidence"in t&&Ke(this.s,2,t.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in t&&Ke(this.s,3,t.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in t&&Ke(this.H,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"minPoseDetectionConfidence"in t&&Ke(this.v,2,t.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in t&&Ke(this.v,3,t.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in t&&Ke(this.K,2,t.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in t&&Ke(this.J,2,t.minHandLandmarksConfidence??.5),this.l(t)}D(t,e,n){const r=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:n,pG(this),aa(this,t,r),mG(this)}F(t,e,n,r){const i=typeof n!="function"?n:{};return this.C=typeof n=="function"?n:r,pG(this),ec(this,t,i,e),mG(this)}m(){var t=new $s;Fn(t,"input_frames_image"),Wt(t,"pose_landmarks"),Wt(t,"pose_world_landmarks"),Wt(t,"face_landmarks"),Wt(t,"left_hand_landmarks"),Wt(t,"left_hand_world_landmarks"),Wt(t,"right_hand_landmarks"),Wt(t,"right_hand_world_landmarks");const e=new ho,n=new UV;tL(n,1,gv("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),function(i,s){if(s!=null)if(Array.isArray(s))kn(i,2,Coe(s));else{if(!(typeof s=="string"||s instanceof Jc||R_(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");tL(i,2,q8(s,!1),jh())}}(n,this.j.g());const r=new ss;go(r,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),eC(r,8,UV,n),xn(r,"IMAGE:input_frames_image"),Mt(r,"POSE_LANDMARKS:pose_landmarks"),Mt(r,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),Mt(r,"FACE_LANDMARKS:face_landmarks"),Mt(r,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),Mt(r,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),Mt(r,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),Mt(r,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),r.o(e),vo(t,r),c3(this,t),this.g.attachProtoListener("pose_landmarks",(i,s)=>{r2(i,this.h.poseLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("pose_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("pose_world_landmarks",(i,s)=>{var o=this.h.poseWorldLandmarks;i=Qm(i),o.push(j1(i)),je(this,s)}),this.g.attachEmptyPacketListener("pose_world_landmarks",i=>{je(this,i)}),this.outputPoseSegmentationMasks&&(Mt(r,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),Og(this,"pose_segmentation_mask"),this.g.U("pose_segmentation_mask",(i,s)=>{this.h.poseSegmentationMasks=[Dg(this,i,!0,!this.C)],je(this,s)}),this.g.attachEmptyPacketListener("pose_segmentation_mask",i=>{this.h.poseSegmentationMasks=[],je(this,i)})),this.g.attachProtoListener("face_landmarks",(i,s)=>{r2(i,this.h.faceLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("face_landmarks",i=>{je(this,i)}),this.outputFaceBlendshapes&&(Wt(t,"extra_blendshapes"),Mt(r,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",(i,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(i=o3(i),o.push(AM(i.g()??[]))),je(this,s)}),this.g.attachEmptyPacketListener("extra_blendshapes",i=>{je(this,i)})),this.g.attachProtoListener("left_hand_landmarks",(i,s)=>{r2(i,this.h.leftHandLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("left_hand_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("left_hand_world_landmarks",(i,s)=>{var o=this.h.leftHandWorldLandmarks;i=Qm(i),o.push(j1(i)),je(this,s)}),this.g.attachEmptyPacketListener("left_hand_world_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("right_hand_landmarks",(i,s)=>{r2(i,this.h.rightHandLandmarks),je(this,s)}),this.g.attachEmptyPacketListener("right_hand_landmarks",i=>{je(this,i)}),this.g.attachProtoListener("right_hand_world_landmarks",(i,s)=>{var o=this.h.rightHandWorldLandmarks;i=Qm(i),o.push(j1(i)),je(this,s)}),this.g.attachEmptyPacketListener("right_hand_world_landmarks",i=>{je(this,i)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Hn.prototype.detectForVideo=Hn.prototype.F,Hn.prototype.detect=Hn.prototype.D,Hn.prototype.setOptions=Hn.prototype.o,Hn.createFromModelPath=function(t,e){return Pt(Hn,t,{baseOptions:{modelAssetPath:e}})},Hn.createFromModelBuffer=function(t,e){return Pt(Hn,t,{baseOptions:{modelAssetBuffer:e}})},Hn.createFromOptions=function(t,e){return Pt(Hn,t,e)},Hn.HAND_CONNECTIONS=GM,Hn.POSE_CONNECTIONS=Jae,Hn.FACE_LANDMARKS_LIPS=UM,Hn.FACE_LANDMARKS_LEFT_EYE=jM,Hn.FACE_LANDMARKS_LEFT_EYEBROW=$M,Hn.FACE_LANDMARKS_LEFT_IRIS=Wae,Hn.FACE_LANDMARKS_RIGHT_EYE=BM,Hn.FACE_LANDMARKS_RIGHT_EYEBROW=HM,Hn.FACE_LANDMARKS_RIGHT_IRIS=zae,Hn.FACE_LANDMARKS_FACE_OVAL=VM,Hn.FACE_LANDMARKS_CONTOURS=Yae,Hn.FACE_LANDMARKS_TESSELATION=Xae;var xo=class extends Us{constructor(t,e){super(new oa(t,e),"input_image","norm_rect",!0),this.j={classifications:[]},nt(t=this.h=new Lae,0,1,e=new zn)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return nt(this.h,0,2,aL(t,Vt(this.h,CM,2))),this.l(t)}sa(t,e){return this.j={classifications:[]},aa(this,t,e),this.j}ta(t,e,n){return this.j={classifications:[]},ec(this,t,n,e),this.j}m(){var t=new $s;Fn(t,"input_image"),Fn(t,"norm_rect"),Wt(t,"classifications");const e=new ho;Za(e,AGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),xn(n,"IMAGE:input_image"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"CLASSIFICATIONS:classifications"),n.o(e),vo(t,n),this.g.attachProtoListener("classifications",(r,i)=>{this.j=function(s){const o={classifications:fu(s,yGe,1).map(a=>{var l;return AM(((l=Vt(a,uae,4))==null?void 0:l.g())??[],Vo(a,2)??0,ta(a,3)??"")})};return Qw(Lg(s,2))!=null&&(o.timestampMs=Qw(Lg(s,2))??0),o}(_Ge(r)),je(this,i)}),this.g.attachEmptyPacketListener("classifications",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};xo.prototype.classifyForVideo=xo.prototype.ta,xo.prototype.classify=xo.prototype.sa,xo.prototype.setOptions=xo.prototype.o,xo.createFromModelPath=function(t,e){return Pt(xo,t,{baseOptions:{modelAssetPath:e}})},xo.createFromModelBuffer=function(t,e){return Pt(xo,t,{baseOptions:{modelAssetBuffer:e}})},xo.createFromOptions=function(t,e){return Pt(xo,t,e)};var Zs=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!0),this.h=new Aae,this.embeddings={embeddings:[]},nt(t=this.h,0,1,e=new zn)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){var e=this.h,n=Vt(this.h,WV,2);return n=n?n.clone():new WV,t.l2Normalize!==void 0?Dy(n,1,t.l2Normalize):"l2Normalize"in t&&kn(n,1),t.quantize!==void 0?Dy(n,2,t.quantize):"quantize"in t&&kn(n,2),nt(e,0,2,n),this.l(t)}za(t,e){return aa(this,t,e),this.embeddings}Aa(t,e,n){return ec(this,t,n,e),this.embeddings}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect"),Wt(t,"embeddings_out");const e=new ho;Za(e,OGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"EMBEDDINGS:embeddings_out"),n.o(e),vo(t,n),this.g.attachProtoListener("embeddings_out",(r,i)=>{r=EGe(r),this.embeddings=function(s){return{embeddings:fu(s,SGe,1).map(o=>{var l,c;const a={headIndex:Vo(o,3)??0??-1,headName:ta(o,4)??""??""};if(xoe(o,KV,H4(o,1))!==void 0)o=ah(o=Vt(o,KV,H4(o,1)),1,mf,oh()),a.floatEmbedding=o.slice();else{const u=new Uint8Array(0);a.quantizedEmbedding=((c=(l=Vt(o,bGe,H4(o,2)))==null?void 0:l.oa())==null?void 0:c.h())??u}return a}),timestampMs:Qw(Lg(s,2))??0}}(r),je(this,i)}),this.g.attachEmptyPacketListener("embeddings_out",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Zs.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=ZV(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");t=ZV(JV(t.quantizedEmbedding),JV(e.quantizedEmbedding))}return t},Zs.prototype.embedForVideo=Zs.prototype.Aa,Zs.prototype.embed=Zs.prototype.za,Zs.prototype.setOptions=Zs.prototype.o,Zs.createFromModelPath=function(t,e){return Pt(Zs,t,{baseOptions:{modelAssetPath:e}})},Zs.createFromModelBuffer=function(t,e){return Pt(Zs,t,{baseOptions:{modelAssetBuffer:e}})},Zs.createFromOptions=function(t,e){return Pt(Zs,t,e)};var uL=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){var t,e;(t=this.confidenceMasks)==null||t.forEach(n=>{n.close()}),(e=this.categoryMask)==null||e.close()}};function gG(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function vG(t){try{const e=new uL(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{u3(t)}}uL.prototype.close=uL.prototype.close;var Di=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new LM,this.v=new Oae,nt(this.h,0,3,this.v),nt(t=this.h,0,1,e=new zn)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?kn(this.h,2,gv(t.displayNamesLocale)):"displayNamesLocale"in t&&kn(this.h,2),"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}I(){(function(t){var n,r;const e=fu(t.da(),ss,1).filter(i=>(ta(i,1)??"").includes("mediapipe.tasks.TensorsToSegmentationCalculator"));if(t.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(((r=(n=Vt(e[0],ho,7))==null?void 0:n.l())==null?void 0:r.g())??new Map).forEach((i,s)=>{t.s[Number(s)]=ta(i,1)??""})})(this)}segment(t,e,n){const r=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:n,gG(this),aa(this,t,r),vG(this)}Ma(t,e,n,r){const i=typeof n!="function"?n:{};return this.j=typeof n=="function"?n:r,gG(this),ec(this,t,i,e),vG(this)}Da(){return this.s}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect");const e=new ho;Za(e,Nae,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),n.o(e),vo(t,n),c3(this,t),this.outputConfidenceMasks&&(Wt(t,"confidence_masks"),Mt(n,"CONFIDENCE_MASKS:confidence_masks"),Og(this,"confidence_masks"),this.g.ca("confidence_masks",(r,i)=>{this.confidenceMasks=r.map(s=>Dg(this,s,!0,!this.j)),je(this,i)}),this.g.attachEmptyPacketListener("confidence_masks",r=>{this.confidenceMasks=[],je(this,r)})),this.outputCategoryMask&&(Wt(t,"category_mask"),Mt(n,"CATEGORY_MASK:category_mask"),Og(this,"category_mask"),this.g.U("category_mask",(r,i)=>{this.categoryMask=Dg(this,r,!1,!this.j),je(this,i)}),this.g.attachEmptyPacketListener("category_mask",r=>{this.categoryMask=void 0,je(this,r)})),Wt(t,"quality_scores"),Mt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(r,i)=>{this.qualityScores=r,je(this,i)}),this.g.attachEmptyPacketListener("quality_scores",r=>{this.categoryMask=void 0,je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Di.prototype.getLabels=Di.prototype.Da,Di.prototype.segmentForVideo=Di.prototype.Ma,Di.prototype.segment=Di.prototype.segment,Di.prototype.setOptions=Di.prototype.o,Di.createFromModelPath=function(t,e){return Pt(Di,t,{baseOptions:{modelAssetPath:e}})},Di.createFromModelBuffer=function(t,e){return Pt(Di,t,{baseOptions:{modelAssetBuffer:e}})},Di.createFromOptions=function(t,e){return Pt(Di,t,e)};var dL=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){var t,e;(t=this.confidenceMasks)==null||t.forEach(n=>{n.close()}),(e=this.categoryMask)==null||e.close()}};dL.prototype.close=dL.prototype.close;var BGe=class extends Ve{constructor(t){super(t)}},Yp=[0,fr,-2],iC=[0,kc,-3,Kn,kc,-1],yG=[0,iC],_G=[0,iC,fr,-1],z4=class extends Ve{constructor(t){super(t)}},bG=[0,kc,-1,Kn],HGe=class extends Ve{constructor(t){super(t)}},SG=class extends Ve{constructor(t){super(t)}},fL=[1,2,3,4,5,6,7,8,9,10,14,15],Zae=class extends Ve{constructor(t){super(t)}};Zae.prototype.g=s3([0,Wr,[0,fL,an,iC,an,[0,iC,Yp],an,yG,an,[0,yG,Yp],an,bG,an,[0,kc,-3,Kn,na],an,[0,kc,-3,Kn],an,[0,rn,kc,-2,Kn,fr,Kn,-1,2,kc,Yp],an,_G,an,[0,_G,Yp],kc,Yp,rn,an,[0,kc,-3,Kn,Yp,-1],an,[0,Wr,bG]],rn,[0,rn,fr,-1,Kn]]);var pl=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new LM,this.s=new Oae,nt(this.h,0,3,this.s),nt(t=this.h,0,1,e=new zn)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}segment(t,e,n,r){const i=typeof n!="function"?n:{};this.j=typeof n=="function"?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,r=new Zae;const s=new SG;var o=new BGe;if(Hl(o,1,255),nt(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new z4;Dy(a,3,!0),Ke(a,1,e.keypoint.x),Ke(a,2,e.keypoint.y),F1(s,5,fL,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new HGe,e.scribble))Dy(e=new z4,3,!0),Ke(e,1,a.x),Ke(e,2,a.y),eC(o,1,z4,e);F1(s,15,fL,o)}eC(r,1,SG,s),this.g.addProtoToStream(r.g(),"drishti.RenderData","roi_in",n),aa(this,t,i);e:{try{const c=new dL(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var l=c;break e}this.j(c)}finally{u3(this)}l=void 0}return l}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"roi_in"),Fn(t,"norm_rect_in");const e=new ho;Za(e,Nae,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),xn(n,"IMAGE:image_in"),xn(n,"ROI:roi_in"),xn(n,"NORM_RECT:norm_rect_in"),n.o(e),vo(t,n),c3(this,t),this.outputConfidenceMasks&&(Wt(t,"confidence_masks"),Mt(n,"CONFIDENCE_MASKS:confidence_masks"),Og(this,"confidence_masks"),this.g.ca("confidence_masks",(r,i)=>{this.confidenceMasks=r.map(s=>Dg(this,s,!0,!this.j)),je(this,i)}),this.g.attachEmptyPacketListener("confidence_masks",r=>{this.confidenceMasks=[],je(this,r)})),this.outputCategoryMask&&(Wt(t,"category_mask"),Mt(n,"CATEGORY_MASK:category_mask"),Og(this,"category_mask"),this.g.U("category_mask",(r,i)=>{this.categoryMask=Dg(this,r,!1,!this.j),je(this,i)}),this.g.attachEmptyPacketListener("category_mask",r=>{this.categoryMask=void 0,je(this,r)})),Wt(t,"quality_scores"),Mt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",(r,i)=>{this.qualityScores=r,je(this,i)}),this.g.attachEmptyPacketListener("quality_scores",r=>{this.categoryMask=void 0,je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};pl.prototype.segment=pl.prototype.segment,pl.prototype.setOptions=pl.prototype.o,pl.createFromModelPath=function(t,e){return Pt(pl,t,{baseOptions:{modelAssetPath:e}})},pl.createFromModelBuffer=function(t,e){return Pt(pl,t,{baseOptions:{modelAssetBuffer:e}})},pl.createFromOptions=function(t,e){return Pt(pl,t,e)};var Po=class extends Us{constructor(t,e){super(new oa(t,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},nt(t=this.h=new Dae,0,1,e=new zn)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?kn(this.h,2,gv(t.displayNamesLocale)):"displayNamesLocale"in t&&kn(this.h,2),t.maxResults!==void 0?Hl(this.h,3,t.maxResults):"maxResults"in t&&kn(this.h,3),t.scoreThreshold!==void 0?Ke(this.h,4,t.scoreThreshold):"scoreThreshold"in t&&kn(this.h,4),t.categoryAllowlist!==void 0?tC(this.h,5,t.categoryAllowlist):"categoryAllowlist"in t&&kn(this.h,5),t.categoryDenylist!==void 0?tC(this.h,6,t.categoryDenylist):"categoryDenylist"in t&&kn(this.h,6),this.l(t)}D(t,e){return this.j={detections:[]},aa(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},ec(this,t,n,e),this.j}m(){var t=new $s;Fn(t,"input_frame_gpu"),Fn(t,"norm_rect"),Wt(t,"detections");const e=new ho;Za(e,NGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),xn(n,"IMAGE:input_frame_gpu"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"DETECTIONS:detections"),n.o(e),vo(t,n),this.g.attachProtoVectorListener("detections",(r,i)=>{for(const s of r)r=fae(s),this.j.detections.push(Uae(r));je(this,i)}),this.g.attachEmptyPacketListener("detections",r=>{je(this,r)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Po.prototype.detectForVideo=Po.prototype.F,Po.prototype.detect=Po.prototype.D,Po.prototype.setOptions=Po.prototype.o,Po.createFromModelPath=async function(t,e){return Pt(Po,t,{baseOptions:{modelAssetPath:e}})},Po.createFromModelBuffer=function(t,e){return Pt(Po,t,{baseOptions:{modelAssetBuffer:e}})},Po.createFromOptions=function(t,e){return Pt(Po,t,e)};var hL=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){var t;(t=this.segmentationMasks)==null||t.forEach(e=>{e.close()})}};function EG(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function wG(t){try{const e=new hL(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.s)return e;t.s(e)}finally{u3(t)}}hL.prototype.close=hL.prototype.close;var Qs=class extends Us{constructor(t,e){super(new oa(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,nt(t=this.h=new Fae,0,1,e=new zn),this.v=new xae,nt(this.h,0,3,this.v),this.j=new kae,nt(this.h,0,2,this.j),Hl(this.j,4,1),Ke(this.j,2,.5),Ke(this.v,2,.5),Ke(this.h,4,.5)}get baseOptions(){return Vt(this.h,zn,1)}set baseOptions(t){nt(this.h,0,1,t)}o(t){return"numPoses"in t&&Hl(this.j,4,t.numPoses??1),"minPoseDetectionConfidence"in t&&Ke(this.j,2,t.minPoseDetectionConfidence??.5),"minTrackingConfidence"in t&&Ke(this.h,4,t.minTrackingConfidence??.5),"minPosePresenceConfidence"in t&&Ke(this.v,2,t.minPosePresenceConfidence??.5),"outputSegmentationMasks"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}D(t,e,n){const r=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:n,EG(this),aa(this,t,r),wG(this)}F(t,e,n,r){const i=typeof n!="function"?n:{};return this.s=typeof n=="function"?n:r,EG(this),ec(this,t,i,e),wG(this)}m(){var t=new $s;Fn(t,"image_in"),Fn(t,"norm_rect"),Wt(t,"normalized_landmarks"),Wt(t,"world_landmarks"),Wt(t,"segmentation_masks");const e=new ho;Za(e,DGe,this.h);const n=new ss;go(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),xn(n,"IMAGE:image_in"),xn(n,"NORM_RECT:norm_rect"),Mt(n,"NORM_LANDMARKS:normalized_landmarks"),Mt(n,"WORLD_LANDMARKS:world_landmarks"),n.o(e),vo(t,n),c3(this,t),this.g.attachProtoVectorListener("normalized_landmarks",(r,i)=>{this.landmarks=[];for(const s of r)r=P_(s),this.landmarks.push(l3(r));je(this,i)}),this.g.attachEmptyPacketListener("normalized_landmarks",r=>{this.landmarks=[],je(this,r)}),this.g.attachProtoVectorListener("world_landmarks",(r,i)=>{this.worldLandmarks=[];for(const s of r)r=Qm(s),this.worldLandmarks.push(j1(r));je(this,i)}),this.g.attachEmptyPacketListener("world_landmarks",r=>{this.worldLandmarks=[],je(this,r)}),this.outputSegmentationMasks&&(Mt(n,"SEGMENTATION_MASK:segmentation_masks"),Og(this,"segmentation_masks"),this.g.ca("segmentation_masks",(r,i)=>{this.segmentationMasks=r.map(s=>Dg(this,s,!0,!this.s)),je(this,i)}),this.g.attachEmptyPacketListener("segmentation_masks",r=>{this.segmentationMasks=[],je(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Qs.prototype.detectForVideo=Qs.prototype.F,Qs.prototype.detect=Qs.prototype.D,Qs.prototype.setOptions=Qs.prototype.o,Qs.createFromModelPath=function(t,e){return Pt(Qs,t,{baseOptions:{modelAssetPath:e}})},Qs.createFromModelBuffer=function(t,e){return Pt(Qs,t,{baseOptions:{modelAssetBuffer:e}})},Qs.createFromOptions=function(t,e){return Pt(Qs,t,e)},Qs.POSE_CONNECTIONS=Jae;async function CG(t){return new Promise(e=>setTimeout(e,t))}async function VGe(t){await CG(10);const n=Date.now();for(;Date.now()-n<500;){const{width:r,height:i}=t.getSettings();if(r&&i)return{width:r,height:i};await CG(50)}return{width:void 0,height:void 0}}var Qae=class ele{constructor(e,n,r={}){this.useStreamFallback=!1,this.processingEnabled=!1;var i;this.name=n,this.transformer=e,this.maxFps=(i=r.maxFps)!=null?i:30}static get isSupported(){const e=typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u",n=typeof HTMLCanvasElement<"u"&&typeof VideoFrame<"u"&&"captureStream"in HTMLCanvasElement.prototype;return e||n}static get hasModernApiSupport(){return typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u"}async setup(e){this.source=e.track;const{width:n,height:r}=await VGe(this.source);if(this.sourceDummy=e.element,!(this.sourceDummy instanceof HTMLVideoElement))throw TypeError("Currently only video transformers are supported");if(this.sourceDummy instanceof HTMLVideoElement&&(this.sourceDummy.height=r??300,this.sourceDummy.width=n??300),this.useStreamFallback=!ele.hasModernApiSupport,this.useStreamFallback){const i=document.querySelector('canvas[data-livekit-processor="'+this.name+'"]');i?(this.displayCanvas=i,this.displayCanvas.width=n??300,this.displayCanvas.height=r??300):(this.displayCanvas=document.createElement("canvas"),this.displayCanvas.width=n??300,this.displayCanvas.height=r??300,this.displayCanvas.style.display="none",this.displayCanvas.dataset.livekitProcessor=this.name,document.body.appendChild(this.displayCanvas)),this.renderContext=this.displayCanvas.getContext("2d"),this.capturedStream=this.displayCanvas.captureStream(),this.canvas=new OffscreenCanvas(n??300,r??300)}else this.processor=new MediaStreamTrackProcessor({track:this.source}),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video",signalTarget:this.source}),this.canvas=new OffscreenCanvas(n??300,r??300)}async init(e){if(await this.setup(e),!this.canvas)throw new TypeError("Expected canvas to be defined after setup");await this.transformer.init({outputCanvas:this.canvas,inputElement:this.sourceDummy}),this.useStreamFallback?this.initFallbackPath():this.initStreamProcessorPath()}initStreamProcessorPath(){if(!this.processor||!this.trackGenerator)throw new TypeError("Expected processor and trackGenerator to be defined for stream processor path");this.processor.readable.pipeThrough(this.transformer.transformer).pipeTo(this.trackGenerator.writable).catch(r=>console.error("error when trying to pipe",r)).finally(()=>this.destroy()),this.processedTrack=this.trackGenerator}initFallbackPath(){if(!this.capturedStream||!this.source||!this.canvas||!this.renderContext)throw new TypeError("Missing required components for fallback implementation");this.processedTrack=this.capturedStream.getVideoTracks()[0],this.processingEnabled=!0,this.frameCallback=e=>{if(!this.processingEnabled||!e){e.close();return}const n={enqueue:r=>{this.renderContext&&this.displayCanvas&&(this.renderContext.drawImage(r,0,0,this.displayCanvas.width,this.displayCanvas.height),r.close())}};try{this.transformer.transform(e,n)}catch(r){console.error("Error in transform:",r),e.close()}},this.startRenderLoop()}startRenderLoop(){if(!this.sourceDummy||!(this.sourceDummy instanceof HTMLVideoElement))return;let e=-1,n=0;const r=this.sourceDummy,i=1e3/this.maxFps;let s=this.maxFps,o=[],a=0,l=0,c=0;const u=()=>{if(!this.processingEnabled||!this.sourceDummy||!(this.sourceDummy instanceof HTMLVideoElement))return;if(this.sourceDummy.paused){console.warn("Video is paused, trying to play"),this.sourceDummy.play();return}const f=r.currentTime,p=performance.now(),m=p-n,v=f!==e;if(v){if(a>0){const S=p-a;o.push(S),o.length>10&&o.shift(),o.length>2&&(s=1e3/(o.reduce((k,T)=>k+T,0)/o.length),(typeof window<"u"&&window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&p-c>5e3&&(console.debug(`[${this.name}] Estimated video FPS: ${s.toFixed(1)}, Processing at: ${(l/5).toFixed(1)} FPS`),l=0,c=p))}a=p}const g=m>=i;if(v&&g){e=f,n=p,l++;try{if(r.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA){const S=new VideoFrame(r);this.frameCallback?this.frameCallback(S):S.close()}}catch(S){console.error("Error in render loop:",S)}}this.animationFrameId=requestAnimationFrame(u)};this.animationFrameId=requestAnimationFrame(u)}async restart(e){await this.destroy(),await this.init(e)}async restartTransformer(...e){await this.transformer.restart(e[0])}async updateTransformerOptions(...e){await this.transformer.update(e[0])}async destroy(){var e,n,r,i;this.useStreamFallback?(this.processingEnabled=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0),this.displayCanvas&&this.displayCanvas.parentNode&&this.displayCanvas.parentNode.removeChild(this.displayCanvas),(e=this.capturedStream)==null||e.getTracks().forEach(s=>s.stop())):(await((r=(n=this.processor)==null?void 0:n.writableControl)==null?void 0:r.close()),(i=this.trackGenerator)==null||i.stop()),await this.transformer.destroy()}},GGe={"@mediapipe/tasks-vision":"0.10.14"};function Vf(t,e){const n=t.TEXTURE0+e;t.activeTexture(n);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,r),r}function Zd(t,e,n){const r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw console.error("Shader compile failed:",t.getShaderInfoLog(r)),t.deleteShader(r),new Error("Shader compile failed");return r}function p3(t,e,n){const r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw console.error("Program link failed:",t.getProgramInfoLog(r)),new Error("Program link failed");return r}function $0(t,e,n,r){const i=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,null),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer not complete");return t.bindFramebuffer(t.FRAMEBUFFER,null),i}function qGe(t){const e=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),t.STATIC_DRAW),e}async function KGe(t,e,n){const r=t.width/t.height,i=e/n;let s=0,o=0,a=t.width,l=t.height;return r>i?(a=Math.round(t.height*i),s=Math.round((t.width-a)/2)):r<i&&(l=Math.round(t.width/i),o=Math.round((t.height-l)/2)),createImageBitmap(t,s,o,a,l,{resizeWidth:e,resizeHeight:n,resizeQuality:"medium"})}var _h=new ImageData(2,2);_h.data[0]=0;_h.data[1]=0;_h.data[2]=0;_h.data[3]=0;var qM=t=>t,KM=(t=!0)=>`#version 300 es
  in vec2 position;
  out vec2 texCoords;

  void main() {
    texCoords = (position + 1.0) / 2.0;
    texCoords.y = ${t?"1.0 - texCoords.y":"texCoords.y"};
    gl_Position = vec4(position, 0, 1.0);
  }
`,WGe=qM`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D u_texture;
  uniform vec2 u_texelSize;
  uniform vec2 u_direction;
  uniform float u_radius;
  out vec4 fragColor;

  void main() {
    float sigma = u_radius;
    float twoSigmaSq = 2.0 * sigma * sigma;
    float totalWeight = 0.0;
    vec3 result = vec3(0.0);
    const int MAX_SAMPLES = 16;
    int radius = int(min(float(MAX_SAMPLES), ceil(u_radius)));

    for (int i = -MAX_SAMPLES; i <= MAX_SAMPLES; ++i) {
      float offset = float(i);
      if (abs(offset) > float(radius)) continue;
      float weight = exp(-(offset * offset) / twoSigmaSq);
      vec2 sampleCoord = texCoords + u_direction * u_texelSize * offset;
      result += texture(u_texture, sampleCoord).rgb * weight;
      totalWeight += weight;
    }

    fragColor = vec4(result / totalWeight, 1.0);
  }
`;function zGe(t){const e=Zd(t,t.VERTEX_SHADER,KM()),n=Zd(t,t.FRAGMENT_SHADER,WGe),r=p3(t,e,n),i={position:t.getAttribLocation(r,"position"),texture:t.getUniformLocation(r,"u_texture"),texelSize:t.getUniformLocation(r,"u_texelSize"),direction:t.getUniformLocation(r,"u_direction"),radius:t.getUniformLocation(r,"u_radius")};return{program:r,shader:n,vertexShader:e,uniforms:i}}function TG(t,e,n,r,i,s,o,a,l,c){t.useProgram(s),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(o.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.position);const u=1/n,f=1/r;return t.bindFramebuffer(t.FRAMEBUFFER,l[0]),t.viewport(0,0,n,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(o.texture,0),t.uniform2f(o.texelSize,u,f),t.uniform2f(o.direction,1,0),t.uniform1f(o.radius,i),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,l[1]),t.viewport(0,0,n,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,c[0]),t.uniform1i(o.texture,0),t.uniform2f(o.direction,0,1),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null),c[1]}var YGe=qM`#version 300 es
precision mediump float;

in vec2 texCoords;

uniform sampler2D u_texture;
uniform vec2 u_texelSize;    // 1.0 / texture size
uniform vec2 u_direction;    // (1.0, 0.0) for horizontal, (0.0, 1.0) for vertical
uniform float u_radius;      // blur radius in texels

out vec4 fragColor;

void main() {
    vec3 sum = vec3(0.0);
    float count = 0.0;

    // Limit radius to avoid excessive loop cost
    const int MAX_RADIUS = 16;
    int radius = int(min(float(MAX_RADIUS), u_radius));

    for (int i = -MAX_RADIUS; i <= MAX_RADIUS; ++i) {
        if (abs(i) > radius) continue;

        vec2 offset = u_direction * u_texelSize * float(i);
        sum += texture(u_texture, texCoords + offset).rgb;
        count += 1.0;
  }

  fragColor = vec4(sum / count, 1.0);
}
`;function XGe(t){const e=Zd(t,t.VERTEX_SHADER,KM()),n=Zd(t,t.FRAGMENT_SHADER,YGe),r=p3(t,e,n),i={position:t.getAttribLocation(r,"position"),texture:t.getUniformLocation(r,"u_texture"),texelSize:t.getUniformLocation(r,"u_texelSize"),direction:t.getUniformLocation(r,"u_direction"),radius:t.getUniformLocation(r,"u_radius")};return{program:r,vertexShader:e,fragmentShader:n,uniforms:i}}var JGe=qM`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D background;
  uniform sampler2D frame;
  uniform sampler2D mask;
  out vec4 fragColor;
  
  void main() {
      
    vec4 frameTex = texture(frame, texCoords);
    vec4 bgTex = texture(background, texCoords);

    float maskVal = texture(mask, texCoords).r;

    // Compute screen-space gradient to detect edge sharpness
    float grad = length(vec2(dFdx(maskVal), dFdy(maskVal)));

    float edgeSoftness = 2.0; // higher = softer
    
    // Create a smooth edge around binary transition
    float smoothAlpha = smoothstep(0.5 - grad * edgeSoftness, 0.5 + grad * edgeSoftness, maskVal);

    // Optional: preserve frame alpha, or override as fully opaque
    vec4 blended = mix(bgTex, vec4(frameTex.rgb, 1.0), 1.0 - smoothAlpha);
    
    fragColor = blended;
  
  }
`;function ZGe(t){const e=Zd(t,t.VERTEX_SHADER,KM()),n=Zd(t,t.FRAGMENT_SHADER,JGe),r=p3(t,e,n),i={position:t.getAttribLocation(r,"position")},s={mask:t.getUniformLocation(r,"mask"),frame:t.getUniformLocation(r,"frame"),background:t.getUniformLocation(r,"background"),stepWidth:t.getUniformLocation(r,"u_stepWidth")};return{program:r,vertexShader:e,fragmentShader:n,attribLocations:i,uniformLocations:s}}function QGe(t,e,n){const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const s=`
      attribute vec2 position;
      varying vec2 v_uv;
      void main() {
        v_uv = (position + 1.0) * 0.5;
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `,o=`
      precision mediump float;
      varying vec2 v_uv;
      uniform sampler2D u_texture;
      void main() {
        gl_FragColor = texture2D(u_texture, v_uv);
      }
    `,a=Zd(t,t.VERTEX_SHADER,s),l=Zd(t,t.FRAGMENT_SHADER,o),c=p3(t,a,l),u={texture:t.getUniformLocation(c,"u_texture"),position:t.getAttribLocation(c,"position")};return{framebuffer:i,texture:r,program:c,uniforms:u}}function eqe(t,e,n,r,i,s){return t.useProgram(n.program),t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer),t.viewport(0,0,i,s),t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n.uniforms.position),t.vertexAttribPointer(n.uniforms.position,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(n.uniforms.texture,0),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null),n.texture}var RG=t=>{const e=t.getContext("webgl2",{antialias:!0,premultipliedAlpha:!0});let n=null,r=8;const i=4;if(!e){console.error("Failed to create WebGL context");return}e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);const s=ZGe(e),o=s.program,a=s.attribLocations.position,{mask:l,frame:c,background:u}=s.uniformLocations,f=zGe(e),p=f.program,m=f.uniforms,v=XGe(e),g=v.program,S=v.uniforms,b=Vf(e,0),w=Vf(e,1),k=qGe(e);if(!k)throw new Error("Failed to create vertex buffer");let T=[],I=[],C=[],x=0,A=1;T.push(Vf(e,3)),T.push(Vf(e,4));const N=Math.floor(t.width/i),D=Math.floor(t.height/i),F=QGe(e,N,D);I.push($0(e,T[0],N,D)),I.push($0(e,T[1],N,D));const $=Vf(e,5),B=$0(e,$,t.width,t.height);C.push(Vf(e,6)),C.push(Vf(e,7));const W=[$0(e,C[0],t.width,t.height),$0(e,C[1],t.width,t.height)];e.useProgram(o),e.uniform1i(u,0),e.uniform1i(c,1),e.uniform1i(l,2);let H=_h;function z(G){if(G.codedWidth===0||C.length===0)return;const Q=G.displayWidth,ge=G.displayHeight;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,w),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,G);let _e=b;if(n){const Pe=eqe(e,w,F,k,N,D);_e=TG(e,Pe,N,D,n,p,m,k,I,T)}else e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,b),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,H),_e=b;e.viewport(0,0,Q,ge),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(o),e.bindBuffer(e.ARRAY_BUFFER,k),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,_e),e.uniform1i(u,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,w),e.uniform1i(c,1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,C[x]),e.uniform1i(l,2),e.drawArrays(e.TRIANGLES,0,6)}async function K(G){if(H=_h,G)try{H=await KGe(G,t.width,t.height)}catch(Q){console.error("Error processing background image, falling back to black background:",Q)}e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,b),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,H)}function V(G){n=G?Math.max(1,Math.floor(G/i)):null,K(null)}function q(G){const Q=[B,W[A]],ge=[$,C[A]];TG(e,G,t.width,t.height,r,g,S,k,Q,ge),x=A,A=1-A}function Z(){e.deleteProgram(o),e.deleteProgram(p),e.deleteProgram(g),e.deleteTexture(b),e.deleteTexture(w),e.deleteTexture($),e.deleteFramebuffer(B);for(const G of T)e.deleteTexture(G);for(const G of I)e.deleteFramebuffer(G);for(const G of C)e.deleteTexture(G);for(const G of W)e.deleteFramebuffer(G);e.deleteBuffer(k),F&&(e.deleteTexture(F.texture),e.deleteFramebuffer(F.framebuffer),e.deleteProgram(F.program)),H&&(H instanceof ImageBitmap&&H.close(),H=_h),T=[],I=[],C=[]}return{renderFrame:z,updateMask:q,setBackgroundImage:K,setBlurRadius:V,cleanup:Z}},tle=class{constructor(){this.isDisabled=!1}async init({outputCanvas:t,inputElement:e}){if(!(e instanceof HTMLVideoElement))throw TypeError("Video transformer needs a HTMLVideoElement as input");this.transformer=new TransformStream({transform:(n,r)=>this.transform(n,r)}),this.canvas=t||null,t&&(this.gl=RG(this.canvas||new OffscreenCanvas(e.videoWidth,e.videoHeight))),this.inputVideo=e,this.isDisabled=!1}async restart({outputCanvas:t,inputElement:e}){var n;this.canvas=t||null,(n=this.gl)==null||n.cleanup(),this.gl=RG(this.canvas||new OffscreenCanvas(e.videoWidth,e.videoHeight)),this.inputVideo=e,this.isDisabled=!1}async destroy(){var t;this.isDisabled=!0,this.canvas=void 0,(t=this.gl)==null||t.cleanup(),this.gl=void 0}},nle=class extends tle{constructor(t){super(),this.backgroundImage=null,this.segmentationTimeMs=0,this.options=t,this.update(t)}static get isSupported(){return typeof OffscreenCanvas<"u"&&typeof VideoFrame<"u"&&typeof createImageBitmap<"u"&&!!document.createElement("canvas").getContext("webgl2")}async init({outputCanvas:t,inputElement:e}){var n,r,i,s,o,a;await super.init({outputCanvas:t,inputElement:e});const l=await Jf.forVisionTasks((r=(n=this.options.assetPaths)==null?void 0:n.tasksVisionFileSet)!=null?r:`https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@${GGe["@mediapipe/tasks-vision"]}/wasm`);this.imageSegmenter=await Di.createFromOptions(l,{baseOptions:{modelAssetPath:(s=(i=this.options.assetPaths)==null?void 0:i.modelAssetPath)!=null?s:"https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_segmenter/float16/latest/selfie_segmenter.tflite",delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),(o=this.options)!=null&&o.imagePath&&!this.backgroundImage&&await this.loadBackground(this.options.imagePath).catch(c=>console.error("Error while loading processor background image: ",c)),this.options.blurRadius&&((a=this.gl)==null||a.setBlurRadius(this.options.blurRadius))}async destroy(){var t;await super.destroy(),await((t=this.imageSegmenter)==null?void 0:t.close()),this.backgroundImage=null}async loadBackground(t){var e;const n=new Image;await new Promise((i,s)=>{n.crossOrigin="Anonymous",n.onload=()=>i(n),n.onerror=o=>s(o),n.src=t});const r=await createImageBitmap(n);(e=this.gl)==null||e.setBackgroundImage(r)}async transform(t,e){var n,r;try{if(!(t instanceof VideoFrame)||t.codedWidth===0||t.codedHeight===0){console.debug("empty frame detected, ignoring");return}if(this.isDisabled){e.enqueue(t);return}const i=Date.now();if(!this.canvas)throw TypeError("Canvas needs to be initialized first");this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight;const s=new Promise((a,l)=>{var c;try{let u=performance.now();(c=this.imageSegmenter)==null||c.segmentForVideo(t,u,f=>{this.segmentationTimeMs=performance.now()-u,this.segmentationResults=f,this.updateMask(f.categoryMask),f.close(),a()})}catch(u){l(u)}}),o=performance.now();if(this.drawFrame(t),this.canvas&&this.canvas.width>0&&this.canvas.height>0){const a=new VideoFrame(this.canvas,{timestamp:t.timestamp||i});e.enqueue(a);const l=performance.now()-o,c={processingTimeMs:this.segmentationTimeMs+l,segmentationTimeMs:this.segmentationTimeMs,filterTimeMs:l};(r=(n=this.options).onFrameProcessed)==null||r.call(n,c)}else e.enqueue(t);await s}catch(i){console.error("Error while processing frame: ",i)}finally{t.close()}}async update(t){var e;this.options={...this.options,...t},t.blurRadius?(e=this.gl)==null||e.setBlurRadius(t.blurRadius):t.imagePath&&await this.loadBackground(t.imagePath)}async drawFrame(t){var e;this.gl&&((e=this.gl)==null||e.renderFrame(t))}async updateMask(t){var e;t&&((e=this.gl)==null||e.updateMask(t.getAsWebGLTexture()))}},tqe=()=>nle.isSupported&&Qae.isSupported;const nqe=""+new URL("selfie_segmenter-DF05sdL4.tflite",import.meta.url).href,rqe={wasmLoaderPath:new URL(""+new URL("vision_wasm_internal-CEyeacG0.js",import.meta.url).href,import.meta.url).href,wasmBinaryPath:new URL(""+new URL("vision_wasm_internal-TmjHuG4I.wasm",import.meta.url).href,import.meta.url).href};class iqe extends nle{async init({outputCanvas:e,inputElement:n}){var r;await tle.prototype.init.call(this,{outputCanvas:e,inputElement:n}),this.imageSegmenter=await Di.createFromOptions(rqe,{baseOptions:{modelAssetPath:nqe,delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),this.options.blurRadius&&((r=this.gl)==null||r.setBlurRadius(this.options.blurRadius))}}const rle=_.createContext(void 0);function m3(){const t=_.useContext(rle);if(t===void 0)throw new Error("useTrackProcessor must be used within a ProcessorProvider");return t}const ile=t=>{const{processor:e}=m3();_.useEffect(()=>{t&&(e&&!t.getProcessor()&&t.setProcessor(e),!e&&t.getProcessor()&&t.stopProcessor())},[e,t])},sqe=({children:t})=>{const[e]=bn(mse),n=_.useMemo(()=>tqe(),[]),r=_.useMemo(()=>new Qae(new iqe({blurRadius:15}),"background-blur"),[]),i=_.useMemo(()=>({supported:n,processor:n&&e?r:void 0}),[n,e,r]);return E.jsx(rle.Provider,{value:i,children:t})},oqe={},aqe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PACKAGE:"embedded"},lqe=({client:t,livekitRoom:e})=>{var I;const{t:n}=et(),[r,i]=bn(fse),[s,o]=bn(x8),[a,l]=bn(hse),[c,u]=bn(Ly),[f,p]=bn(_se),[m,v]=bn(Sse),[g,S]=bn(L8),[b,w]=bn(bse),k=sa(),T=_.useMemo(()=>{var C;if((C=e==null?void 0:e.engine.client.ws)!=null&&C.url){const x=new URL(e.engine.client.ws.url);return x.search="",x}return null},[e]);return E.jsxs(E.Fragment,{children:[E.jsx("p",{children:n("developer_mode.hostname",{hostname:window.location.hostname||"unknown"})}),E.jsx("p",{children:n("version",{productName:"Element Call",version:"dev"})}),E.jsx("p",{children:n("developer_mode.crypto_version",{version:((I=t.getCrypto())==null?void 0:I.getVersion())||"unknown"})}),E.jsx("p",{children:n("developer_mode.matrix_id",{id:t.getUserId()||"unknown"})}),E.jsx("p",{children:n("developer_mode.device_id",{id:t.getDeviceId()||"unknown"})}),E.jsx(St,{children:E.jsx(fn,{id:"duplicateTiles",type:"number",label:n("developer_mode.duplicate_tiles_label"),value:r.toString(),min:0,onChange:_.useCallback(C=>{const x=C.target.valueAsNumber;x<0||i(Number.isNaN(x)?0:x)},[i])})}),E.jsx(St,{children:E.jsx(fn,{id:"debugTileLayout",type:"checkbox",checked:s,label:n("developer_mode.debug_tile_layout_label"),onChange:C=>o(C.target.checked)})}),E.jsx(St,{children:E.jsx(fn,{id:"showNonMemberTiles",type:"checkbox",label:n("developer_mode.show_non_member_tiles"),checked:!!a,onChange:_.useCallback(C=>{l(C.target.checked)},[l])})}),E.jsx(St,{children:E.jsx(fn,{id:"showConnectionStats",type:"checkbox",label:n("developer_mode.show_connection_stats"),checked:!!c,onChange:_.useCallback(C=>{u(C.target.checked)},[u])})}),E.jsx(St,{children:E.jsx(fn,{id:"useNewMembershipManager",type:"checkbox",label:n("developer_mode.use_new_membership_manager"),checked:!!f,onChange:_.useCallback(C=>{p(C.target.checked)},[p])})}),E.jsx(St,{children:E.jsx(fn,{id:"useToDeviceKeyTransport",type:"checkbox",label:n("developer_mode.use_to_device_key_transport"),checked:!!g,onChange:_.useCallback(C=>{S(C.target.checked)},[S])})}),E.jsx(St,{children:E.jsx(fn,{id:"muteAllAudio",type:"checkbox",label:n("developer_mode.mute_all_audio"),checked:b,onChange:_.useCallback(C=>{w(C.target.checked)},[w])})})," ",E.jsxs(St,{children:[E.jsx(fn,{id:"alwaysShowIphoneEarpiece",type:"checkbox",label:n("developer_mode.always_show_iphone_earpiece"),checked:m,onChange:_.useCallback(C=>{v(C.target.checked)},[v])})," "]}),e?E.jsxs(E.Fragment,{children:[E.jsx("p",{children:n("developer_mode.livekit_sfu",{url:(T==null?void 0:T.href)||"unknown"})}),E.jsx("p",{children:n("developer_mode.livekit_server_info")}),E.jsxs("pre",{className:oqe.pre,children:[e.serverInfo?JSON.stringify(e.serverInfo,null,2):"undefined",e.metadata]})]}):null,E.jsx("p",{children:n("developer_mode.environment_variables")}),E.jsx("pre",{children:JSON.stringify(aqe,null,2)}),E.jsx("p",{children:n("developer_mode.url_params")}),E.jsx("pre",{children:JSON.stringify(k,null,2)})]})},WM="audio",zM=({open:t,onDismiss:e,tab:n,onTabChange:r,client:i,roomId:s,livekitRoom:o})=>{const{t:a}=et(),l=()=>{const{supported:N}=m3(),[D,F]=bn(mse);return E.jsxs(E.Fragment,{children:[E.jsx("h4",{children:a("settings.background_blur_header")}),E.jsx(St,{children:E.jsx(fn,{id:"activateBackgroundBlur",label:a("settings.background_blur_label"),description:N?"":a("settings.blur_not_supported_by_browser"),type:"checkbox",checked:!!D,onChange:$=>F($.target.checked),disabled:!N})})]})},c=hf();DHe(c,t);const[u,f]=bn(yse),[p,m]=_.useState(u),[v]=bn(k8),{available:g}=FT(),{controlledAudioDevices:S}=sa(),b=Je(Bse),w={key:"audio",name:a("common.audio"),content:E.jsx(E.Fragment,{children:E.jsxs(hB,{children:[!S&&E.jsx(M4,{device:c.audioInput,title:a("settings.devices.microphone"),numberedLabel:N=>a("settings.devices.microphone_numbered",{n:N})}),b&&E.jsx(Dt,{onClick:N=>{var D,F,$,B;N.preventDefault(),(F=(D=window.controls).showNativeAudioDevicePicker)==null||F.call(D),(B=($=window.controls).showNativeOutputDevicePicker)==null||B.call($)},children:a("settings.devices.change_device_button")}),E.jsx(M4,{device:c.audioOutput,title:a("settings.devices.speaker"),numberedLabel:N=>a("settings.devices.speaker_numbered",{n:N})}),E.jsxs("div",{className:cV.volumeSlider,children:[E.jsx("label",{children:a("settings.audio_tab.effect_volume_label")}),E.jsx("p",{children:a("settings.audio_tab.effect_volume_description")}),E.jsx(soe,{label:a("video_tile.volume"),value:p,onValueChange:m,onValueCommit:f,min:0,max:1,step:.01})]})]})})},k={key:"video",name:a("common.video"),content:E.jsxs(E.Fragment,{children:[E.jsx(hB,{children:E.jsx(M4,{device:c.videoInput,title:a("settings.devices.camera"),numberedLabel:N=>a("settings.devices.camera_numbered",{n:N})})}),E.jsx(zO,{}),E.jsx(l,{})]})},T={key:"preferences",name:a("common.preferences"),content:E.jsx(FHe,{})},I={key:"profile",name:a("common.profile"),content:E.jsx(dHe,{client:i})},C={key:"feedback",name:a("settings.feedback_tab_title"),content:E.jsx(hHe,{roomId:s})},x={key:"developer",name:a("settings.developer_tab_title"),content:E.jsx(lqe,{client:i,livekitRoom:o})},A=[w,k];return Ze===null&&A.push(I),A.push(T),g&&A.push(C),v&&A.push(x),E.jsx(ep,{title:a("common.settings"),className:cV.settingsModal,open:t,onDismiss:e,tabbed:!0,children:E.jsx(VBe,{label:a("common.settings"),tab:n,onTabChange:r,tabs:A})})},cqe=(t,e)=>_.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),_.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),IG=_.forwardRef(cqe),uqe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),dqe=_.forwardRef(uqe),fqe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),hqe=_.forwardRef(fqe),pqe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),mqe=_.forwardRef(pqe),gqe="_userButton_t5z8t_15",vqe={userButton:gqe},yqe=({preventNavigation:t,isAuthenticated:e,isPasswordlessUser:n,userId:r,displayName:i,avatarUrl:s,onAction:o})=>{const{t:a}=et(),l=qi(),c=_.useMemo(()=>{const p=[];return e&&(p.push({key:"user",icon:IG,label:i,dataTestid:"usermenu_user"}),p.push({key:"settings",icon:dqe,label:a("common.settings")}),n&&!t&&p.push({key:"login",label:a("action.sign_in"),icon:hqe,dataTestid:"usermenu_login"}),!n&&!t&&p.push({key:"logout",label:a("action.sign_out"),icon:mqe,dataTestid:"usermenu_logout"})),p},[e,n,i,t,a]),[u,f]=_.useState(!1);return e?E.jsx($O,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:u,onOpenChange:f,trigger:E.jsx("button",{"aria-label":a("common.profile"),className:vqe.userButton,"data-testid":"usermenu_open",children:e&&(!n||s)?E.jsx(lv,{id:r,name:i,size:av.SM,src:s}):E.jsx(IG,{})}),children:c.map(({key:p,icon:m,label:v,dataTestid:g})=>E.jsx(Eg,{Icon:m,label:v,"data-testid":g,onSelect:()=>o(p)},p))}):E.jsx(A8,{to:{pathname:"/login"},state:{from:l},children:a("log_in")})},YM=({preventNavigation:t=!1})=>{const e=qi(),n=Yl(),{client:r,logout:i,authenticated:s,passwordlessUser:o}=N8(),{displayName:a,avatarUrl:l}=T_(r),[c,u]=_.useState(!1),f=_.useCallback(()=>u(!1),[u]),[p,m]=_.useState(WM),v=_.useCallback(S=>{var b;switch(S){case"user":m("profile"),u(!0);break;case"settings":m("audio"),u(!0);break;case"logout":i==null||i();break;case"login":(b=n("/login",{state:{from:e}}))==null||b.catch(w=>O.error("Failed to navigate to login",w));break}},[n,e,i,u]),g=(r==null?void 0:r.getUserIdLocalpart())??"";return E.jsxs(E.Fragment,{children:[E.jsx(yqe,{preventNavigation:t,isAuthenticated:s,isPasswordlessUser:o,avatarUrl:l,onAction:v,userId:(r==null?void 0:r.getUserId())??"",displayName:a||(g?g.replace("@",""):"")}),r&&E.jsx(zM,{client:r,open:c,onDismiss:f,tab:p,onTabChange:m})]})};function _qe(t){return new Worker(""+new URL("IndexedDBWorker-whz4J8_U.js",import.meta.url).href,{name:t==null?void 0:t.name})}const TE=new NL,bqe=t=>{const[e,n]=_.useState(()=>localStorage.getItem(t));return _.useEffect(()=>(TE.on(t,n),()=>{TE.off(t,n)}),[t,n]),[e,_.useCallback(r=>{n(r),localStorage.setItem(t,r),TE.emit(t,r)},[t,n])]},Sqe=(t,e)=>{localStorage.getItem(t)!==e&&(localStorage.setItem(t,e),TE.emit(t,e))};function sle(t,e){Sqe(XM(t),e)}const XM=t=>`room-shared-key-${t}`,Eqe=t=>{const e=XM(t),[n]=bqe(e);return n};function wqe(t){ole(Ri());const e=XM(t);return localStorage.getItem(e)}function ole(t){!t.password||!t.roomId||sle(t.roomId,t.password)}const Cqe=()=>{const t=sa();return _.useEffect(()=>ole(t),[t]),t.roomId&&t.password?[t.roomId,t.password]:[void 0,void 0]};function L_(t){const{client:e}=tp(),[n,r]=Cqe(),i=Eqe(t),s=e==null?void 0:e.getRoom(t);return _.useMemo(()=>s?i?{kind:zt.SHARED_KEY,secret:i}:n===t?{kind:zt.SHARED_KEY,secret:r}:s.hasEncryptionStateEvent()?{kind:zt.PER_PARTICIPANT}:{kind:zt.NONE}:{kind:zt.NONE},[r,s,t,i,n])}const kG=!1,Tqe="element-call-sync";async function Rqe(t){let e=!!await t.store.getSavedSyncToken();return new Promise((n,r)=>{const i=(s,o,a)=>{s==="PREPARED"?e?e=!1:(t.removeListener(Ae.Sync,i),n()):s==="ERROR"&&(t.removeListener(Ae.Sync,i),r(a==null?void 0:a.error))};t.on(Ae.Sync,i)})}async function ale(t,e){var a;let n;try{n=window.indexedDB}catch(l){O.warn("Could not get indexDB from window.",l)}const r={fallbackICEServerAllowed:kG,isVoipWithNoMediaAllowed:(a=Zt.get().features)==null?void 0:a.feature_group_calls_without_video_and_audio};n&&localStorage?r.store=new Rz({indexedDB:window.indexedDB,localStorage,dbName:Tqe,workerFactory:()=>new _qe}):localStorage&&(r.store=new iy({localStorage}));const{e2eEnabled:i}=Ri();i||O.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=FC({...r,...t,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:i,fallbackICEServerAllowed:kG});e||await s.clearStores();try{await s.store.startup()}catch(l){O.error("Error starting matrix client indexDB store. Falling back to memory store.",l),s.store=new iy({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(l){O.warn(l,"Make sure to clear client stores before initializing the rust crypto.")}const o=Rqe(s);return await s.startClient({clientWellKnownPollPeriod:60*10}),await o,s}function A_(t){return t.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function Iqe(t,e){return`#${A_(t)}:${e.getDomain()}`}function lle(t){const e=t.split(":",2);if(e.length===2&&e[0][0]==="#"){if(e[1]===Zt.defaultServerName())return e[0];throw new Error("Unsupported remote room alias")}return t}async function cle(t,e,n){O.log("Creating room for group call");const r=t.createRoom({visibility:HW.Private,preset:LC.PublicChat,name:e,room_alias_name:n?void 0:A_(e),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[t.getUserId()]:100}}}),i=await new Promise((o,a)=>{r.catch(u=>{a(u),c()});const l=u=>{r.then(f=>{u.roomId===f.room_id&&(o(u.roomId),c())},f=>{O.error("Failed to wait for the room to arrive",f)})},c=()=>{t.off(Ae.Room,l)};t.on(Ae.Room,l)});let s;return n==zt.SHARED_KEY&&(s=UW(16),sle(i,s)),{roomId:i,alias:n?void 0:Iqe(e,t),password:s}}function ule(t,e,n,r){return`${window.location.protocol}//${window.location.host}${g3(t,e,n)}`}function g3(t,e,n,r){return`/room/#${n?"/"+A_(n):""}?${i8e(t,e).toString()}`}async function kqe(t){let e=0;for(;;)try{return await t()}catch(n){e++;const r=KL(n,e,!0);if(r<0)throw n;await tu(r)}}const JM=t=>{const[e,n]=_.useState(void 0),[r,i]=_.useState(void 0),s=_.useRef(void 0);s.current||(s.current=FC({baseUrl:Zt.defaultHomeserverUrl()})),_.useEffect(()=>{Ze||s.current.registerRequest({}).catch(a=>{var l,c,u,f,p,m,v;n((p=(f=(u=(c=(l=a.data)==null?void 0:l.params["m.login.terms"])==null?void 0:c.policies)==null?void 0:u.privacy_policy)==null?void 0:f.en)==null?void 0:p.url),i((v=(m=a.data)==null?void 0:m.params["m.login.recaptcha"])==null?void 0:v.public_key)})},[]);const o=_.useCallback(async(a,l,c,u,f)=>{const p=new dA({matrixClient:s.current,doRequest:async k=>s.current.registerRequest({username:a,password:l,auth:k||void 0}),stateUpdated:(k,T)=>{if(T.error)throw new Error(T.error);k==="m.login.terms"?p.submitAuthDict({type:"m.login.terms"}).catch(I=>{O.error(I)}):k==="m.login.recaptcha"&&p.submitAuthDict({type:"m.login.recaptcha",response:u}).catch(I=>{O.error(I)})},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:m,access_token:v,device_id:g}=await p.attemptAuth();await(t==null?void 0:t.logout(!0));const S=await ale({baseUrl:Zt.defaultHomeserverUrl(),accessToken:v,userId:m,deviceId:g},!1);await S.setDisplayName(c);const b={user_id:m,device_id:g,access_token:v,passwordlessUser:f};f&&(b.tempPassword=l);const w=S.getUser(S.getUserId());return w.setRawDisplayName(c),w.setDisplayName(c),[S,b]},[t]);return{privacyPolicyUrl:e,recaptchaKey:r,register:o}},xqe="_buttons_1arp2_8",Pqe={buttons:xqe},dle=({onJoin:t,open:e,onDismiss:n})=>{const{t:r}=et();return E.jsxs(ep,{title:r("join_existing_call_modal.title"),open:e,onDismiss:n,children:[E.jsx("p",{children:r("join_existing_call_modal.text")}),E.jsxs(St,{rightAlign:!0,className:Pqe.buttons,children:[E.jsx(Dt,{onClick:n,children:r("action.no")}),E.jsx(Dt,{onClick:t,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},xG="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function ZM(t){const{t:e}=et(),[n]=_.useState(()=>lo(16)),r=_.useRef(void 0);_.useEffect(()=>{var a;if(!t)return;const o=()=>{document.getElementById(n)&&window.grecaptcha.render(n,{sitekey:t,size:"invisible",callback:l=>{var c;return(c=r.current)==null?void 0:c.resolve(l)},"error-callback":()=>{var l;return(l=r.current)==null?void 0:l.reject(new Error)}})};if(typeof((a=window.grecaptcha)==null?void 0:a.render)=="function")o();else if(window.mxOnRecaptchaLoaded=o,!document.querySelector(`script[src="${xG}"]`)){const l=document.createElement("script");l.src=xG,l.async=!0,document.body.appendChild(l)}},[n,t]);const i=_.useCallback(async()=>t?window.grecaptcha?new Promise((o,a)=>{var u,f;const l=new MutationObserver(p=>{var m,v;for(const g of p)if(((v=(m=g.target)==null?void 0:m.style)==null?void 0:v.visibility)!=="visible"){a(dV("recaptcha_dismissed",e)),l.disconnect();return}});r.current={resolve:p=>{o(p),l.disconnect()},reject:p=>{a(p),l.disconnect()}},window.grecaptcha.execute().then(()=>{},p=>{O.error("Recaptcha execution failed",p)});const c=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');(u=c==null?void 0:c.parentNode)!=null&&u.parentNode&&l.observe((f=c==null?void 0:c.parentNode)==null?void 0:f.parentNode,{attributes:!0})}):(O.log("Recaptcha not loaded"),Promise.reject(dV("recaptcha_not_loaded",e))):Promise.resolve(""),[t,e]),s=_.useCallback(()=>{var o;(o=window.grecaptcha)==null||o.reset()},[]);return{execute:i,reset:s,recaptchaId:n}}const Lqe="_form_jcuzc_8",Aqe={form:Lqe},v3=_.forwardRef(({children:t,className:e,onSubmit:n},r)=>E.jsx("form",{onSubmit:n,className:Ne(Aqe.form,e),ref:r,children:t}));v3.displayName="Form";const Oqe="_footer_106jg_8",Mqe="_mobileLoginLink_106jg_19",Nqe="_form_106jg_24",Dqe="_notice_106jg_40",B0={footer:Oqe,mobileLoginLink:Mqe,form:Nqe,notice:Dqe},Fqe="_container_dwllg_8",Uqe="_main_dwllg_15",jqe="_logo_dwllg_23",eg={container:Fqe,main:Uqe,logo:jqe},PG=t=>{t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296};class $qe{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:n,separator:r,dictionaries:i,style:s,seed:o}=e;this.dictionaries=i,this.separator=r,this.length=n,this.style=s,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.
Length provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((n,r)=>{let i;e?(i=(o=>{if(typeof o=="string"){const a=o.split("").map(c=>c.charCodeAt(0)).reduce((c,u)=>c+u,1),l=Math.floor(Number(a));return PG(l)}return PG(o)})(e),e=4294967296*i):i=Math.random();let s=r[Math.floor(i*r.length)]||"";if(this.style==="lowerCase")s=s.toLowerCase();else if(this.style==="capital"){const[o,...a]=s.split("");s=o.toUpperCase()+a.join("")}else this.style==="upperCase"&&(s=s.toUpperCase());return n?`${n}${this.separator}${s}`:`${s}`},"")}}const LG={separator:"_",dictionaries:[]},Bqe=t=>{const e=[...t&&t.dictionaries||LG.dictionaries],n={...LG,...t,length:t&&t.length||e.length,dictionaries:e};if(!t||!t.dictionaries||!t.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new $qe(n).generate()};var Hqe=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],Vqe=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],Gqe=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const qqe=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function fle(){return Bqe({dictionaries:[Gqe,Hqe,Vqe,qqe],style:"lowerCase",length:3,separator:"-"})}const Kqe=()=>{const{setClient:t}=tp(),[e,n]=_.useState(!1),[r,i]=_.useState(),[s]=MT(),{recaptchaKey:o,register:a}=JM(),{execute:l,reset:c,recaptchaId:u}=ZM(o),[f,p]=_.useState(!1),m=_.useCallback(()=>p(!1),[p]),[v,g]=_.useState(),S=Yl(),{t:b}=et(),w=_.useCallback(k=>{k.preventDefault();const T=new FormData(k.target),I=lle(T.get("callName")),C=T.get("displayName");async function x(){i(void 0),n(!0);const A=await l(),N=fle(),[D,F]=await a(N,lo(16),C,A,!0);let $;try{$=await cle(D,I,zt.SHARED_KEY)}catch(B){if(!t)throw B;if(B.errcode==="M_ROOM_IN_USE"){g(()=>{var H;t(D,F);const W=A_(I);(H=S(`/${W}`))==null||H.catch(z=>{O.error("Failed to navigate to alias localpart",z)})}),n(!1),p(!0);return}else throw B}if(!t)throw new Error("setClient is undefined");if(!$.password)throw new Error("Failed to create room with shared secret");t(D,F),await S(g3($.roomId,{kind:zt.SHARED_KEY,secret:$.password},I))}x().catch(A=>{O.error(A),n(!1),i(A),c()})},[a,c,l,S,p,t]);return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:eg.container,children:[E.jsxs(uf,{children:[E.jsx(Jh,{children:E.jsx(Oh,{})}),E.jsx(Zh,{hideMobile:!0,children:E.jsx(YM,{})})]}),E.jsxs("main",{className:eg.main,children:[E.jsx(Oh,{className:eg.logo}),E.jsx(cf,{size:"lg",weight:"semibold",children:b("start_new_call")}),E.jsxs(v3,{className:B0.form,onSubmit:w,children:[E.jsx(St,{children:E.jsx(fn,{id:"callName",name:"callName",label:b("call_name"),placeholder:b("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),E.jsx(St,{children:E.jsx(fn,{id:"displayName",name:"displayName",label:b("common.display_name"),placeholder:b("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),s===null&&E.jsx(ln,{size:"sm",className:B0.notice,children:E.jsx(Use,{})}),E.jsx(ln,{size:"sm",className:B0.notice,children:E.jsxs(Os,{i18nKey:"unauthenticated_view_ssla_caption",children:['By clicking "Go", you agree to our'," ",E.jsx(vh,{href:Zt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),r&&E.jsx(St,{children:E.jsx(ff,{error:r})}),E.jsx(Dt,{type:"submit",size:"lg",disabled:e,"data-testid":"home_go",children:b(e?"common.loading":"action.go")}),E.jsx("div",{id:u})]})]}),E.jsxs("footer",{className:B0.footer,children:[E.jsx(ln,{className:B0.mobileLoginLink,children:E.jsx(Bl,{to:"/login","data-testid":"home_login",children:b("unauthenticated_view_login_button")})}),E.jsx(ln,{children:E.jsxs(Os,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",E.jsx(Bl,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),v&&E.jsx(dle,{onJoin:v,open:f,onDismiss:m})]})},Xp={};function AG(t,e){if(Xp[e.roomId])return Xp[e.roomId];if(!e||!e.timeline){const i=Number.MAX_SAFE_INTEGER;return Xp[e.roomId]=i,i}const n=t.getUserId();if(e.getMyMembership()!==qe.Join){const i=e.currentState.getStateEvents("m.room.member",n);if(i&&!Array.isArray(i)){const s=i.getTs();return Xp[e.roomId]=s,s}}for(let i=e.timeline.length-1;i>=0;--i){const o=e.timeline[i].getTs();if(o)return Xp[e.roomId]=o,o}const r=Number.MAX_SAFE_INTEGER;return Xp[e.roomId]=r,r}function Wqe(t,e){return e.sort((n,r)=>AG(t,r)-AG(t,n))}const zqe=t=>{var e,n;if(!t.hasEncryptionStateEvent()&&!wqe(t.roomId))return!1;switch(t.getJoinRule()){case Td.Public:return!0;case Td.Knock:switch(t.getMyMembership()){case qe.Join:case qe.Knock:return!0;case qe.Invite:return((n=(e=t.getLiveTimeline().getState(Le.FORWARDS))==null?void 0:e.getStateEvents(ee.RoomMember,t.myUserId))==null?void 0:n.getPrevContent().membership)===Td.Knock;default:return!1}default:return t.getMyMembership()===qe.Join}},Yqe=t=>{var e,n;switch(t.getMyMembership()){case qe.Join:return!!((n=(e=t.getLiveTimeline().getState(Le.FORWARDS))==null?void 0:e.events)!=null&&n.get(ee.GroupCallMemberPrefix));case qe.Knock:return!0;default:return!1}};function Xqe(t){const[e,n]=_.useState([]);return _.useEffect(()=>{function r(){const i=t.getRooms().filter(Yqe).filter(zqe),o=Wqe(t,i).map(a=>{const l=t.matrixRTC.getRoomSession(a);return{roomAlias:a.getCanonicalAlias()??void 0,roomName:a.name,avatarUrl:a.getMxcAvatarUrl(),room:a,session:l,participants:l.memberships.filter(c=>c.sender).map(c=>a.getMember(c.sender)).filter(c=>c)}});n(o)}return r(),t.matrixRTC.on(qE.SessionStarted,r),t.on(xe.MyMembership,r),()=>{t.matrixRTC.off(qE.SessionStarted,r),t.off(xe.MyMembership,r)}},[t]),e}const Jqe="_form_1vjc2_8",Zqe="_fieldRow_1vjc2_16",Qqe="_button_1vjc2_24",eKe="_notice_1vjc2_32",H0={form:Jqe,fieldRow:Zqe,button:Qqe,notice:eKe},tKe="_callTileSpacer_l4ywf_8",nKe="_callTile_l4ywf_8",rKe="_callTileLink_l4ywf_28",iKe="_callInfo_l4ywf_40",sKe="_callName_l4ywf_53",oKe="_callList_l4ywf_63",aKe="_disabled_l4ywf_74",xc={callTileSpacer:tKe,callTile:nKe,callTileLink:rKe,callInfo:iKe,callName:sKe,callList:oKe,disabled:aKe},lKe=({rooms:t,client:e})=>E.jsx(E.Fragment,{children:E.jsxs("div",{className:xc.callList,children:[t.map(({room:n,roomName:r,avatarUrl:i,participants:s})=>E.jsx(cKe,{client:e,name:r,avatarUrl:i,room:n,participants:s},n.roomId)),t.length>3&&E.jsxs(E.Fragment,{children:[E.jsx("div",{className:xc.callTileSpacer}),E.jsx("div",{className:xc.callTileSpacer})]})]})}),cKe=({name:t,avatarUrl:e,room:n,client:r})=>{const{t:i}=et(),s=L_(n.roomId),[o,a]=_.useState(!1),l=_.useCallback(u=>{u.stopPropagation(),u.preventDefault(),a(!0),r.leave(n.roomId).catch(()=>a(!1))},[n,r]),c=E.jsxs(E.Fragment,{children:[E.jsx(lv,{id:n.roomId,name:t,size:av.LG,src:e}),E.jsx("div",{className:xc.callInfo,children:E.jsx(ln,{weight:"semibold",className:xc.callName,children:t})}),E.jsx(ZZ,{onClick:l,disabled:o,"aria-label":i("action.remove"),children:E.jsx(aT,{})})]});return E.jsx("div",{className:xc.callTile,children:o?E.jsx("span",{className:Ne(xc.callTileLink,xc.disabled),children:c}):E.jsx(WC,{to:g3(n.roomId,s,n.name),className:xc.callTileLink,children:c})})},uKe=({client:t})=>{const[e,n]=_.useState(!1),[r,i]=_.useState(),[s]=MT(),o=Yl(),{t:a}=et(),[l,c]=_.useState(!1),u=_.useCallback(()=>c(!1),[c]),f=_.useCallback(S=>{S.preventDefault();const w=new FormData(S.target).get("callName"),k=typeof w=="string"?lle(w):"";async function T(){i(void 0),n(!0);const I=await cle(t,k,zt.SHARED_KEY);if(!I.password)throw new Error("Failed to create room with shared secret");await o(g3(I.roomId,{kind:zt.SHARED_KEY,secret:I.password},k))}T().catch(I=>{I.errcode==="M_ROOM_IN_USE"?(v(A_(k)),n(!1),i(void 0),c(!0)):(O.error(I),n(!1),i(I))})},[t,o,c]),p=Xqe(t),[m,v]=_.useState(),g=_.useCallback(()=>{var S;(S=o(`/${m}`))==null||S.catch(b=>{O.error("Failed to navigate to existing alias",b)})},[o,m]);return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:eg.container,children:[E.jsxs(uf,{children:[E.jsx(Jh,{children:E.jsx(Oh,{})}),E.jsx(Zh,{children:E.jsx(YM,{})})]}),E.jsxs("main",{className:eg.main,children:[E.jsx(Oh,{className:eg.logo}),E.jsx(cf,{size:"lg",weight:"semibold",children:a("start_new_call")}),E.jsxs(v3,{className:H0.form,onSubmit:f,children:[E.jsxs(St,{className:H0.fieldRow,children:[E.jsx(fn,{id:"callName",name:"callName",label:a("call_name"),placeholder:a("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),E.jsx(Dt,{type:"submit",size:"lg",className:H0.button,disabled:e,"data-testid":"home_go",children:a(e?"common.loading":"action.go")})]}),s===null&&E.jsx(ln,{size:"sm",className:H0.notice,children:E.jsx(Use,{})}),r&&E.jsx(St,{className:H0.fieldRow,children:E.jsx(ff,{error:r})})]}),p.length>0&&E.jsx(lKe,{rooms:p,client:t})]})]}),E.jsx(dle,{onJoin:g,open:l,onDismiss:u})]})};function O_(t){_.useEffect(()=>{const e="Element Call";document.title=t?`${e} | ${t}`:e},[t])}const hle=()=>{const{t}=et();O_(t("common.home"));const e=fv();return e?e.state==="error"?E.jsx(Oy,{widget:Ze,error:e.error}):e.authenticated?E.jsx(uKe,{client:e.authenticated.client}):E.jsx(Kqe,{}):E.jsx(UT,{})},dKe=(t,e)=>_.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),_.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),_.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),_.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),_.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),_.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),_.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),ple=_.forwardRef(dKe),fKe="_logo_1gx2r_8",hKe="_container_1gx2r_14",pKe="_content_1gx2r_22",mKe="_formContainer_1gx2r_30",gKe="_authLinks_1gx2r_62",Al={logo:fKe,container:hKe,content:pKe,formContainer:mKe,authLinks:gKe};function vKe(t){return _.useCallback(async(e,n,r)=>{const i=FC({baseUrl:e}),s=new dA({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:n},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:o,access_token:a,device_id:l}=await s.attemptAuth(),c={user_id:o,access_token:a,device_id:l,passwordlessUser:!1};return await(t==null?void 0:t.logout(!0)),[await ale({baseUrl:e,accessToken:a,userId:o,deviceId:l},!1),c]},[t])}const yKe=()=>{var g,S;const{t}=et();O_(t("login_title"));const{client:e,setClient:n}=tp(),r=vKe(e),i=Zt.defaultHomeserverUrl(),s=_.useRef(null),o=_.useRef(null),a=Yl(),l=qi(),[c,u]=_.useState(!1),[f,p]=_.useState(),m=_.useCallback(b=>{if(b.preventDefault(),u(!0),!i||!s.current||!o.current){p(Error("Login parameters are undefined")),u(!1);return}r(i,s.current.value,o.current.value).then(async([w,k])=>{if(!n)return;n(w,k);const T=l.state;T&&T.from?await a(T.from):await a("/"),xt.instance.eventLogin.track()}).catch(w=>{p(w),u(!1)})},[r,l,a,i,n]);let v=(g=Zt.defaultServerName())==null?void 0:g.slice(0,25);return v=(v==null?void 0:v.length)!==((S=Zt.defaultServerName())==null?void 0:S.length)?v+"...":v,E.jsx(E.Fragment,{children:E.jsx("div",{className:Al.container,children:E.jsxs("div",{className:Al.content,children:[E.jsxs("div",{className:Al.formContainer,children:[E.jsx(ple,{width:"auto",height:"auto",className:Al.logo}),E.jsx("h2",{children:t("log_in")}),E.jsx("h4",{children:t("login_subheading")}),E.jsxs("form",{onSubmit:m,children:[E.jsx(St,{children:E.jsx(fn,{type:"text",ref:s,placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${v}`,"data-testid":"login_username"})}),E.jsx(St,{children:E.jsx(fn,{type:"password",ref:o,placeholder:t("common.password"),label:t("common.password"),"data-testid":"login_password"})}),f&&E.jsx(St,{children:E.jsx(ff,{error:f})}),E.jsx(St,{children:E.jsx(Dt,{type:"submit",disabled:c,"data-testid":"login_login",children:t(c?"logging_in":"login_title")})})]})]}),E.jsxs("div",{className:Al.authLinks,children:[E.jsx("p",{children:t("login_auth_links_prompt")}),E.jsx("p",{children:E.jsxs(Os,{i18nKey:"login_auth_links",children:[E.jsx(Bl,{to:"/register",children:"Create an account"})," Or ",E.jsx(Bl,{to:"/",children:"Access as a guest"})]})})]})]})})})},_Ke=()=>{const{t}=et();O_(t("action.register"));const{loading:e,authenticated:n,passwordlessUser:r,client:i,setClient:s}=N8(),o=_.useRef(null),a=Yl(),l=qi(),[c,u]=_.useState(!1),[f,p]=_.useState(),[m,v]=_.useState(""),[g,S]=_.useState(""),{recaptchaKey:b,register:w}=JM(i),{execute:k,reset:T,recaptchaId:I}=ZM(b),C=_.useCallback(x=>{x.preventDefault();const A=new FormData(x.target),N=A.get("userName"),D=A.get("password"),F=A.get("passwordConfirmation");if(D!==F)return;(async()=>{u(!0);const B=await k(),[W,H]=await w(N,D,N,B,r);if(i&&(i!=null&&i.groupCallEventHandler)&&r)for(const z of i.groupCallEventHandler.groupCalls.values()){const K=z.room.roomId;try{await W.joinRoom(K)}catch(V){V.errcode==="M_LIMIT_EXCEEDED"?(await tu(V.data.retry_after_ms),await W.joinRoom(K)):(nT(V),O.error(`Couldn't join room ${K}`,V))}}s==null||s(W,H),xt.instance.eventSignup.cacheSignupEnd(new Date)})().then(async()=>{var B,W;(B=l.state)!=null&&B.from?await a((W=l.state)==null?void 0:W.from):await a("/")}).catch(B=>{p(B),u(!1),T()})},[w,l,a,r,T,k,i,s]);return _.useEffect(()=>{var x,A;m&&g&&m!==g?(x=o.current)==null||x.setCustomValidity(t("register.passwords_must_match")):(A=o.current)==null||A.setCustomValidity("")},[m,g,t]),_.useEffect(()=>{var x;!e&&n&&!r&&!c&&((x=a("/"))==null||x.catch(A=>{O.error("Failed to navigate to /",A)}))},[e,a,n,r,c]),e?E.jsx(UT,{}):(xt.instance.eventSignup.cacheSignupStart(new Date),E.jsx(E.Fragment,{children:E.jsx("div",{className:Al.container,children:E.jsxs("div",{className:Al.content,children:[E.jsxs("div",{className:Al.formContainer,children:[E.jsx(ple,{width:"auto",height:"auto",className:Al.logo}),E.jsx("h2",{children:t("register_heading")}),E.jsxs("form",{onSubmit:C,children:[E.jsx(St,{children:E.jsx(fn,{type:"text",name:"userName",placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${Zt.defaultServerName()}`,"data-testid":"register_username"})}),E.jsx(St,{children:E.jsx(fn,{required:!0,name:"password",type:"password",onChange:x=>v(x.target.value),value:m,placeholder:t("common.password"),label:t("common.password"),"data-testid":"register_password"})}),E.jsx(St,{children:E.jsx(fn,{required:!0,type:"password",name:"passwordConfirmation",onChange:x=>S(x.target.value),value:g,placeholder:t("register_confirm_password_label"),label:t("register_confirm_password_label"),ref:o,"data-testid":"register_confirm_password"})}),E.jsx(ln,{size:"sm",children:E.jsxs(Os,{i18nKey:"recaptcha_ssla_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",E.jsx(vh,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",E.jsx(vh,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",E.jsx("br",{}),'By clicking "Register", you agree to our'," ",E.jsx(vh,{href:Zt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),f&&E.jsx(St,{children:E.jsx(ff,{error:f})}),E.jsx(St,{children:E.jsx(Dt,{type:"submit",disabled:c,"data-testid":"register_register",children:t(c?"register.registering":"action.register")})}),E.jsx("div",{id:I})]})]}),E.jsx("div",{className:Al.authLinks,children:E.jsxs(Os,{i18nKey:"register_auth_links",children:[E.jsx("p",{children:"Already have an account?"}),E.jsxs("p",{children:[E.jsx(Bl,{to:"/login",children:"Log in"})," Or ",E.jsx(Bl,{to:"/",children:"Access as a guest"})]})]})})]})})}))},bKe="_form_1wfyo_8",SKe="_headline_1wfyo_18",EKe="_container_1wfyo_37",wKe="_main_1wfyo_45",CKe="_footer_1wfyo_62",V0={form:bKe,headline:SKe,container:EKe,main:wKe,footer:CKe};function mle(){const{setClient:t}=tp(),{privacyPolicyUrl:e,recaptchaKey:n,register:r}=JM(),{execute:i,reset:s,recaptchaId:o}=ZM(n),a=_.useCallback(async l=>{if(!t)throw new Error("No client context");if(Ze)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const c=await i(),u=fle(),[f,p]=await r(u,lo(16),l,c,!0);t(f,p)}catch(c){throw s(),c}},[i,s,r,t]);return{privacyPolicyUrl:e,registerPasswordlessUser:a,recaptchaId:o}}const TKe=()=>{const[t,e]=_.useState(!1),[n,r]=_.useState(),{registerPasswordlessUser:i,recaptchaId:s}=mle(),o=_.useCallback(c=>{c.preventDefault(),e(!0);const f=new FormData(c.target).get("displayName");i(typeof f=="string"?f:"").catch(m=>{O.error("Failed to register passwordless user",c),e(!1),r(m)})},[i]),{t:a}=et(),l=qi();return E.jsxs(E.Fragment,{children:[E.jsxs(uf,{children:[E.jsx(Jh,{children:E.jsx(Oh,{})}),E.jsx(Zh,{children:E.jsx(YM,{preventNavigation:!0})})]}),E.jsxs("div",{className:V0.container,children:[E.jsxs("main",{className:V0.main,children:[E.jsx(cf,{size:"xl",weight:"semibold",className:V0.headline,children:a("lobby.join_as_guest")}),E.jsxs(v3,{className:V0.form,onSubmit:o,children:[E.jsx(St,{children:E.jsx(fn,{id:"displayName",name:"displayName",label:a("common.display_name"),placeholder:a("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),E.jsx(ln,{size:"sm",children:E.jsxs(Os,{i18nKey:"room_auth_view_ssla_caption",children:['By clicking "Join call now", you agree to our'," ",E.jsx(vh,{href:Zt.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),n&&E.jsx(St,{children:E.jsx(ff,{error:n})}),E.jsx(Dt,{type:"submit",size:"lg",disabled:t,"data-testid":"joincall_joincall",children:a(t?"common.loading":"room_auth_view_continue_button")}),E.jsx("div",{id:s})]})]}),E.jsx(ln,{className:V0.footer,children:E.jsxs(Os,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",E.jsx(Bl,{to:"/register",state:{from:l},children:"Create an account"})]})})]})]})};var l1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gle(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vle={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(l1,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(g,S){var b=g[S];if(typeof b.bind=="function")return b.bind(g);try{return Function.prototype.bind.call(b,g)}catch{return function(){return Function.prototype.apply.apply(b,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&r?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),S=0;S<i.length;S++){var b=i[S];this[b]=S<g?e:this.methodFactory(b,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function f(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function p(g,S,b){return c(g)||f.apply(this,arguments)}function m(g,S){var b=this,w,k,T,I="loglevel";typeof g=="string"?I+=":"+g:typeof g=="symbol"&&(I=void 0);function C(F){var $=(i[F]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=$;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+$+";"}catch{}}}function x(){var F;if(!(typeof window===n||!I)){try{F=window.localStorage[I]}catch{}if(typeof F===n)try{var $=window.document.cookie,B=encodeURIComponent(I),W=$.indexOf(B+"=");W!==-1&&(F=/^([^;]+)/.exec($.slice(W+B.length+1))[1])}catch{}return b.levels[F]===void 0&&(F=void 0),F}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function N(F){var $=F;if(typeof $=="string"&&b.levels[$.toUpperCase()]!==void 0&&($=b.levels[$.toUpperCase()]),typeof $=="number"&&$>=0&&$<=b.levels.SILENT)return $;throw new TypeError("log.setLevel() called with invalid level: "+F)}b.name=g,b.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},b.methodFactory=S||p,b.getLevel=function(){return T??k??w},b.setLevel=function(F,$){return T=N(F),$!==!1&&C(T),u.call(b)},b.setDefaultLevel=function(F){k=N(F),x()||b.setLevel(F,!1)},b.resetLevel=function(){T=null,A(),u.call(b)},b.enableAll=function(F){b.setLevel(b.levels.TRACE,F)},b.disableAll=function(F){b.setLevel(b.levels.SILENT,F)},b.rebuild=function(){if(o!==b&&(w=N(o.getLevel())),u.call(b),o===b)for(var F in s)s[F].rebuild()},w=N(o?o.getLevel():"WARN");var D=x();D!=null&&(T=N(D)),u.call(b)}o=new m,o.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[g];return S||(S=s[g]=new m(g,o.methodFactory)),S};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})})(vle);var RKe=vle.exports;const IKe=gle(RKe);var pL=function(t,e){return pL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},pL(t,e)};function yu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");pL(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function kKe(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function yle(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Fg(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function sC(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function oC(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function tg(t){return this instanceof tg?(this.v=t,this):new tg(t)}function xKe(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(m){return function(v){return Promise.resolve(v).then(m,f)}}function a(m,v){r[m]&&(i[m]=function(g){return new Promise(function(S,b){s.push([m,g,S,b])>1||l(m,g)})},v&&(i[m]=v(i[m])))}function l(m,v){try{c(r[m](v))}catch(g){p(s[0][3],g)}}function c(m){m.value instanceof tg?Promise.resolve(m.value.v).then(u,f):p(s[0][2],m)}function u(m){l("next",m)}function f(m){l("throw",m)}function p(m,v){m(v),s.shift(),s.length&&l(s[0][0],s[0][1])}}function PKe(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Fg=="function"?Fg(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function Jr(t){return typeof t=="function"}function QM(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Y4=QM(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function aC(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var M_=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Fg(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Jr(u))try{u()}catch(g){s=g instanceof Y4?g.errors:[g]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var p=Fg(f),m=p.next();!m.done;m=p.next()){var v=m.value;try{OG(v)}catch(g){s=s??[],g instanceof Y4?s=oC(oC([],sC(s)),sC(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(s)throw new Y4(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)OG(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&aC(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&aC(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),_le=M_.EMPTY;function ble(t){return t instanceof M_||t&&"closed"in t&&Jr(t.remove)&&Jr(t.add)&&Jr(t.unsubscribe)}function OG(t){Jr(t)?t():t.unsubscribe()}var LKe={Promise:void 0},AKe={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,oC([t,e],sC(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Sle(t){AKe.setTimeout(function(){throw t})}function MG(){}function RE(t){t()}var e9=function(t){yu(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,ble(n)&&n.add(r)):r.destination=NKe,r}return e.create=function(n,r,i){return new mL(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(M_),OKe=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){i2(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){i2(r)}else i2(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){i2(n)}},t}(),mL=function(t){yu(e,t);function e(n,r,i){var s=t.call(this)||this,o;return Jr(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new OKe(o),s}return e}(e9);function i2(t){Sle(t)}function MKe(t){throw t}var NKe={closed:!0,next:MG,error:MKe,complete:MG},t9=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ele(t){return t}function DKe(t){return t.length===0?Ele:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var po=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=UKe(e)?e:new mL(e,n,r);return RE(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=NG(n),new n(function(i,s){var o=new mL({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[t9]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return DKe(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=NG(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function NG(t){var e;return(e=t??LKe.Promise)!==null&&e!==void 0?e:Promise}function FKe(t){return t&&Jr(t.next)&&Jr(t.error)&&Jr(t.complete)}function UKe(t){return t&&t instanceof e9||FKe(t)&&ble(t)}function jKe(t){return Jr(t==null?void 0:t.lift)}function N_(t){return function(e){if(jKe(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function lC(t,e,n,r,i){return new $Ke(t,e,n,r,i)}var $Ke=function(t){yu(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(e9),BKe=QM(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),wle=function(t){yu(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new DG(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new BKe},e.prototype.next=function(n){var r=this;RE(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Fg(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;RE(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;RE(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?_le:(this.currentObservers=null,a.push(n),new M_(function(){r.currentObservers=null,aC(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new po;return n.source=this,n},e.create=function(n,r){return new DG(n,r)},e}(po),DG=function(t){yu(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:_le},e}(wle);(function(t){yu(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(wle);var HKe={now:function(){return Date.now()}},VKe=function(t){yu(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(M_),FG={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,oC([t,e],sC(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},GKe=function(t){yu(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),FG.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&FG.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,aC(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(VKe),UG=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=HKe.now,t}(),qKe=function(t){yu(e,t);function e(n,r){r===void 0&&(r=UG.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(UG);new qKe(GKe);function KKe(t){return t&&Jr(t.schedule)}function WKe(t){return t[t.length-1]}function Cle(t){return KKe(WKe(t))?t.pop():void 0}var Tle=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function Rle(t){return Jr(t==null?void 0:t.then)}function Ile(t){return Jr(t[t9])}function kle(t){return Symbol.asyncIterator&&Jr(t==null?void 0:t[Symbol.asyncIterator])}function xle(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function zKe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ple=zKe();function Lle(t){return Jr(t==null?void 0:t[Ple])}function Ale(t){return xKe(this,arguments,function(){var e,n,r,i;return yle(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,tg(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,tg(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,tg(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Ole(t){return Jr(t==null?void 0:t.getReader)}function D_(t){if(t instanceof po)return t;if(t!=null){if(Ile(t))return YKe(t);if(Tle(t))return XKe(t);if(Rle(t))return JKe(t);if(kle(t))return Mle(t);if(Lle(t))return ZKe(t);if(Ole(t))return QKe(t)}throw xle(t)}function YKe(t){return new po(function(e){var n=t[t9]();if(Jr(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function XKe(t){return new po(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function JKe(t){return new po(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Sle)})}function ZKe(t){return new po(function(e){var n,r;try{for(var i=Fg(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Mle(t){return new po(function(e){eWe(t,e).catch(function(n){return e.error(n)})})}function QKe(t){return Mle(Ale(t))}function eWe(t,e){var n,r,i,s;return kKe(this,void 0,void 0,function(){var o,a;return yle(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=PKe(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function bh(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function Nle(t,e){return e===void 0&&(e=0),N_(function(n,r){n.subscribe(lC(r,function(i){return bh(r,t,function(){return r.next(i)},e)},function(){return bh(r,t,function(){return r.complete()},e)},function(i){return bh(r,t,function(){return r.error(i)},e)}))})}function Dle(t,e){return e===void 0&&(e=0),N_(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function tWe(t,e){return D_(t).pipe(Dle(e),Nle(e))}function nWe(t,e){return D_(t).pipe(Dle(e),Nle(e))}function rWe(t,e){return new po(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function iWe(t,e){return new po(function(n){var r;return bh(n,e,function(){r=t[Ple](),bh(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Jr(r==null?void 0:r.return)&&r.return()}})}function Fle(t,e){if(!t)throw new Error("Iterable cannot be null");return new po(function(n){bh(n,e,function(){var r=t[Symbol.asyncIterator]();bh(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function sWe(t,e){return Fle(Ale(t),e)}function oWe(t,e){if(t!=null){if(Ile(t))return tWe(t,e);if(Tle(t))return rWe(t,e);if(Rle(t))return nWe(t,e);if(kle(t))return Fle(t,e);if(Lle(t))return iWe(t,e);if(Ole(t))return sWe(t,e)}throw xle(t)}function aWe(t,e){return e?oWe(t,e):D_(t)}QM(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function y3(t,e){return N_(function(n,r){var i=0;n.subscribe(lC(r,function(s){r.next(t.call(e,s,i++))}))})}function lWe(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,f=!1,p=function(){f&&!l.length&&!c&&e.complete()},m=function(g){return c<r?v(g):l.push(g)},v=function(g){c++;var S=!1;D_(n(g,u++)).subscribe(lC(e,function(b){e.next(b)},function(){S=!0},void 0,function(){if(S)try{c--;for(var b=function(){var w=l.shift();o||v(w)};l.length&&c<r;)b();p()}catch(w){e.error(w)}}))};return t.subscribe(lC(e,m,function(){f=!0,p()})),function(){}}function Ule(t,e,n){return n===void 0&&(n=1/0),Jr(e)?Ule(function(r,i){return y3(function(s,o){return e(r,s,i,o)})(D_(t(r,i)))},n):(typeof e=="number"&&(n=e),N_(function(r,i){return lWe(r,i,t,n)}))}function cWe(t){return Ule(Ele,t)}function uWe(){return cWe(1)}function jG(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return uWe()(aWe(t,Cle(t)))}function _3(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Cle(t);return N_(function(r,i){(n?jG(t,r,n):jG(t,r)).subscribe(i)})}var dWe="lk";function jle(t){return typeof t>"u"?!1:fWe(t)||hWe(t)}function fWe(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function hWe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}var pWe=[ae.ConnectionStateChanged,ae.RoomMetadataChanged,ae.ActiveSpeakersChanged,ae.ConnectionQualityChanged,ae.ParticipantConnected,ae.ParticipantDisconnected,ae.ParticipantPermissionsChanged,ae.ParticipantMetadataChanged,ae.ParticipantNameChanged,ae.ParticipantAttributesChanged,ae.TrackMuted,ae.TrackUnmuted,ae.TrackPublished,ae.TrackUnpublished,ae.TrackStreamStateChanged,ae.TrackSubscriptionFailed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionStatusChanged],mWe=[...pWe,ae.LocalTrackPublished,ae.LocalTrackUnpublished];se.TrackPublished,se.TrackUnpublished,se.TrackMuted,se.TrackUnmuted,se.TrackStreamStateChanged,se.TrackSubscribed,se.TrackUnsubscribed,se.TrackSubscriptionPermissionChanged,se.TrackSubscriptionFailed,se.LocalTrackPublished,se.LocalTrackUnpublished;var gWe=[se.ConnectionQualityChanged,se.IsSpeakingChanged,se.ParticipantMetadataChanged,se.ParticipantPermissionsChanged,se.TrackMuted,se.TrackUnmuted,se.TrackPublished,se.TrackUnpublished,se.TrackStreamStateChanged,se.TrackSubscriptionFailed,se.TrackSubscriptionPermissionChanged,se.TrackSubscriptionStatusChanged];[...gWe,se.LocalTrackPublished,se.LocalTrackUnpublished];var Qd=IKe.getLogger("lk-components-js");Qd.setDefaultLevel("WARN");function $le(t){return typeof t=="object"}function Ble(t){return Array.isArray(t)&&t.filter($le).length>0}function vWe(t){return`${dWe}-${t}`}function yWe(t){const e=gL(t),n=Hle(t.participant).pipe(y3(()=>gL(t)),_3(e));return{className:vWe(t.source===ue.Source.Camera||t.source===ue.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function gL(t){if(jle(t))return t.publication;{const{source:e,name:n,participant:r}=t;if(e&&n)return r.getTrackPublications().find(i=>i.source===e&&i.trackName===n);if(n)return r.getTrackPublicationByName(n);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function _We(t,...e){return new po(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(_3(t))}function bWe(t,...e){return new po(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(_3(t))}function Hle(t){return bWe(t,se.TrackMuted,se.TrackUnmuted,se.ParticipantPermissionsChanged,se.TrackPublished,se.TrackUnpublished,se.LocalTrackPublished,se.LocalTrackUnpublished,se.MediaDevicesError,se.TrackSubscriptionStatusChanged).pipe(y3(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:r,isScreenShareEnabled:i}=e,s=e.getTrackPublication(ue.Source.Microphone),o=e.getTrackPublication(ue.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:n,isScreenShareEnabled:i,cameraTrack:o,microphoneTrack:s,participant:e}}))}new TextEncoder;new TextDecoder;function $G(t,e,n=!0){const r=[t.localParticipant,...Array.from(t.remoteParticipants.values())],i=[];return r.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(l=>l.source===o&&(!n||l.track)).map(l=>({participant:s,publication:l,source:l.source}));i.push(...a)})}),{trackReferences:i,participants:r}}function SWe(t,e,n){var r,i;const s=(r=n.additionalRoomEvents)!=null?r:mWe,o=(i=n.onlySubscribed)!=null?i:!0,a=Array.from(new Set([ae.ParticipantConnected,ae.ParticipantDisconnected,ae.ConnectionStateChanged,ae.LocalTrackPublished,ae.LocalTrackUnpublished,ae.TrackPublished,ae.TrackUnpublished,ae.TrackSubscriptionStatusChanged,...s]).values());return _We(t,...a).pipe(y3(l=>{const c=$G(l,e,o);return Qd.debug(`TrackReference[] was updated. (length ${c.trackReferences.length})`,c),c}),_3($G(t,e,o)))}_.createContext(void 0);const EWe=_.createContext(void 0);function wWe(){return _.useContext(EWe)}function Vle(t){const e=wWe(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}_.createContext(void 0);const Gle=_.createContext(void 0);function CWe(){return _.useContext(Gle)}function qle(t){const e=CWe(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}_.createContext(void 0);function Kle(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=Kle(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function TWe(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=Kle(t))&&(r&&(r+=" "),r+=e);return r}function RWe(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(r){console.error(r)}}}function IWe(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];for(const i in r){const s=e[i],o=r[i];typeof s=="function"&&typeof o=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=RWe(s,o):(i==="className"||i==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[i]=TWe(s,o):e[i]=o!==void 0?o:s}}return e}function kWe(t){return t!==void 0}function xWe(...t){return IWe(...t.filter(kWe))}function PWe(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}function LWe(t={}){const e=qle(t.room),[n,r]=_.useState(e.localParticipant),[i,s]=_.useState(n.isMicrophoneEnabled),[o,a]=_.useState(n.isMicrophoneEnabled),[l,c]=_.useState(n.lastMicrophoneError),[u,f]=_.useState(n.lastCameraError),[p,m]=_.useState(n.isMicrophoneEnabled),[v,g]=_.useState(void 0),[S,b]=_.useState(void 0),w=k=>{a(k.isCameraEnabled),s(k.isMicrophoneEnabled),m(k.isScreenShareEnabled),b(k.cameraTrack),g(k.microphoneTrack),c(k.participant.lastMicrophoneError),f(k.participant.lastCameraError),r(k.participant)};return _.useEffect(()=>{const k=Hle(e.localParticipant).subscribe(w);return()=>k.unsubscribe()},[e]),{isMicrophoneEnabled:i,isScreenShareEnabled:p,isCameraEnabled:o,microphoneTrack:v,cameraTrack:S,lastMicrophoneError:l,lastCameraError:u,localParticipant:n}}function AWe(t=[ue.Source.Camera,ue.Source.Microphone,ue.Source.ScreenShare,ue.Source.ScreenShareAudio,ue.Source.Unknown],e={}){const n=qle(e.room),[r,i]=_.useState([]),[s,o]=_.useState([]),a=_.useMemo(()=>t.map(l=>$le(l)?l.source:l),[JSON.stringify(t)]);return _.useEffect(()=>{const l=SWe(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:c,participants:u})=>{Qd.debug("setting track bundles",c,u),i(c),o(u)});return()=>l.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),_.useMemo(()=>{if(Ble(t)){const l=MWe(t,s),c=Array.from(r);return s.forEach(u=>{l.has(u.identity)&&(l.get(u.identity)??[]).forEach(f=>{if(r.find(({participant:m,publication:v})=>u.identity===m.identity&&v.source===f))return;Qd.debug(`Add ${f} placeholder for participant ${u.identity}.`);const p={participant:u,source:f};c.push(p)})}),c}else return r},[r,s,t])}function OWe(t,e){const n=new Set(t);for(const r of e)n.delete(r);return n}function MWe(t,e){const n=new Map;if(Ble(t)){const r=t.filter(i=>i.withPlaceholder).map(i=>i.source);e.forEach(i=>{const s=i.getTrackPublications().map(a=>{var l;return(l=a.track)==null?void 0:l.source}).filter(a=>a!==void 0),o=Array.from(OWe(new Set(r),new Set(s)));o.length>0&&n.set(i.identity,o)})}return n}function Wle(t,e={}){const[n,r]=_.useState(gL(t)),[i,s]=_.useState(n==null?void 0:n.isMuted),[o,a]=_.useState(n==null?void 0:n.isSubscribed),[l,c]=_.useState(n==null?void 0:n.track),[u,f]=_.useState("landscape"),p=_.useRef(),{className:m,trackObserver:v}=_.useMemo(()=>yWe(t),[t.participant.sid??t.participant.identity,t.source,jle(t)&&t.publication.trackSid]);return _.useEffect(()=>{const g=v.subscribe(S=>{Qd.debug("update track",S),r(S),s(S==null?void 0:S.isMuted),a(S==null?void 0:S.isSubscribed),c(S==null?void 0:S.track)});return()=>g==null?void 0:g.unsubscribe()},[v]),_.useEffect(()=>{var g,S;return l&&(p.current&&l.detach(p.current),(g=e.element)!=null&&g.current&&!(t.participant.isLocal&&(l==null?void 0:l.kind)==="audio")&&l.attach(e.element.current)),p.current=(S=e.element)==null?void 0:S.current,()=>{p.current&&(l==null||l.detach(p.current))}},[l,e.element]),_.useEffect(()=>{var g,S;if(typeof((g=n==null?void 0:n.dimensions)==null?void 0:g.width)=="number"&&typeof((S=n==null?void 0:n.dimensions)==null?void 0:S.height)=="number"){const b=n.dimensions.width>n.dimensions.height?"landscape":"portrait";f(b)}},[n]),{publication:n,isMuted:i,isSubscribed:o,track:l,elementProps:xWe(e.props,{className:m,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var NWe="Expected a function",BG=NaN,DWe="[object Symbol]",FWe=/^\s+|\s+$/g,UWe=/^[-+]0x[0-9a-f]+$/i,jWe=/^0b[01]+$/i,$We=/^0o[0-7]+$/i,BWe=parseInt,HWe=typeof l1=="object"&&l1&&l1.Object===Object&&l1,VWe=typeof self=="object"&&self&&self.Object===Object&&self,GWe=HWe||VWe||Function("return this")(),qWe=Object.prototype,KWe=qWe.toString,WWe=Math.max,zWe=Math.min,X4=function(){return GWe.Date.now()};function YWe(t,e,n){var r,i,s,o,a,l,c=0,u=!1,f=!1,p=!0;if(typeof t!="function")throw new TypeError(NWe);e=HG(e)||0,vL(n)&&(u=!!n.leading,f="maxWait"in n,s=f?WWe(HG(n.maxWait)||0,e):s,p="trailing"in n?!!n.trailing:p);function m(C){var x=r,A=i;return r=i=void 0,c=C,o=t.apply(A,x),o}function v(C){return c=C,a=setTimeout(b,e),u?m(C):o}function g(C){var x=C-l,A=C-c,N=e-x;return f?zWe(N,s-A):N}function S(C){var x=C-l,A=C-c;return l===void 0||x>=e||x<0||f&&A>=s}function b(){var C=X4();if(S(C))return w(C);a=setTimeout(b,g(C))}function w(C){return a=void 0,p&&r?m(C):(r=i=void 0,o)}function k(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function T(){return a===void 0?o:w(X4())}function I(){var C=X4(),x=S(C);if(r=arguments,i=this,l=C,x){if(a===void 0)return v(l);if(f)return a=setTimeout(b,e),m(l)}return a===void 0&&(a=setTimeout(b,e)),o}return I.cancel=k,I.flush=T,I}function vL(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function XWe(t){return!!t&&typeof t=="object"}function JWe(t){return typeof t=="symbol"||XWe(t)&&KWe.call(t)==DWe}function HG(t){if(typeof t=="number")return t;if(JWe(t))return BG;if(vL(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=vL(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(FWe,"");var n=jWe.test(t);return n||$We.test(t)?BWe(t.slice(2),n?2:8):UWe.test(t)?BG:+t}var ZWe=YWe;const VG=gle(ZWe);function QWe(t){const e=_.useRef(t);e.current=t,_.useEffect(()=>()=>{e.current()},[])}function eze(t,e=500,n){const r=_.useRef();QWe(()=>{r.current&&r.current.cancel()});const i=_.useMemo(()=>{const s=VG(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!r.current,o.flush=()=>s.flush(),o},[t,e,n]);return _.useEffect(()=>{r.current=VG(t,e,n)},[t,e,n]),i}function tze(t,e,n){const r=(c,u)=>c===u,i=t instanceof Function?t():t,[s,o]=_.useState(i),a=_.useRef(i),l=eze(o,e,n);return r(a.current,i)||(l(i),a.current=i),[s,l]}function nze({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:s}={}){var o;const[a,l]=_.useState(null),[c,u]=_.useState(()=>({isIntersecting:i,entry:void 0})),f=_.useRef();f.current=s;const p=((o=c.entry)==null?void 0:o.isIntersecting)&&r;_.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||p)return;const g=new IntersectionObserver(S=>{const b=Array.isArray(g.thresholds)?g.thresholds:[g.thresholds];S.forEach(w=>{const k=w.isIntersecting&&b.some(T=>w.intersectionRatio>=T);u({isIntersecting:k,entry:w}),f.current&&f.current(k,w)})},{threshold:t,root:e,rootMargin:n});return g.observe(a),()=>{g.disconnect()}},[a,JSON.stringify(t),e,n,p,r]);const m=_.useRef(null);_.useEffect(()=>{var g;!a&&(g=c.entry)!=null&&g.target&&!r&&!p&&m.current!==c.entry.target&&(m.current=c.entry.target,u({isIntersecting:i,entry:void 0}))},[a,c.entry,r,p,i]);const v=[l,!!c.isIntersecting,c.entry];return v.ref=v[0],v.isIntersecting=v[1],v.entry=v[2],v}const rze=_.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:r,manageSubscription:i,...s},o){const a=Vle(r),l=_.useRef(null);_.useImperativeHandle(o,()=>l.current);const c=nze({root:l.current}),[u]=tze(c,3e3);_.useEffect(()=>{i&&a.publication instanceof ow&&(u==null?void 0:u.isIntersecting)===!1&&(c==null?void 0:c.isIntersecting)===!1&&a.publication.setSubscribed(!1)},[u,a,i]),_.useEffect(()=>{i&&a.publication instanceof ow&&(c==null?void 0:c.isIntersecting)===!0&&a.publication.setSubscribed(!0)},[c,a,i]);const{elementProps:f,publication:p,isSubscribed:m}=Wle(a,{element:l,props:s});_.useEffect(()=>{n==null||n(!!m)},[m,n]);const v=g=>{e==null||e(g),t==null||t({participant:a==null?void 0:a.participant,track:p})};return _.createElement("video",{ref:l,...f,muted:!0,onClick:v})}),ize=_.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...r},i){const s=Vle(t),o=_.useRef(null);_.useImperativeHandle(i,()=>o.current);const{elementProps:a,isSubscribed:l,track:c,publication:u}=Wle(s,{element:o,props:r});return _.useEffect(()=>{e==null||e(!!l)},[l,e]),_.useEffect(()=>{c===void 0||n===void 0||(c instanceof SX?c.setVolume(n):Qd.warn("Volume can only be set on remote audio tracks."))},[n,c]),_.useEffect(()=>{u===void 0||r.muted===void 0||(u instanceof ow?u.setEnabled(!r.muted):Qd.warn("Can only call setEnabled on remote track publications."))},[r.muted,u,c]),_.createElement("audio",{ref:o,...a})});function sze(t,e){const[n,r]=_.useState(),i=_.useMemo(()=>new ts,[]);return _.useEffect(()=>{let s=!1,o=[];return i.lock().then(async a=>{try{(t.audio||t.video)&&(o=await n_(t),s?o.forEach(l=>l.stop()):r(o))}catch(l){e&&l instanceof Error?e(l):Qd.error(l)}finally{a()}}),()=>{s=!0,o.forEach(a=>{a.stop()})}},[JSON.stringify(t,PWe),e,i]),n}const oze="_inRoom_1a6xo_8",aze="_header_1a6xo_17",lze="_filler_1a6xo_29",cze="_footer_1a6xo_34",uze="_hidden_1a6xo_53",dze="_overlay_1a6xo_57",fze="_logo_1a6xo_75",hze="_buttons_1a6xo_84",pze="_layout_1a6xo_91",mze="_raiseHand_1a6xo_111",gze="_invite_1a6xo_117",vze="_switchCamera_1a6xo_118",yze="_shareScreen_1a6xo_119",_ze="_fixedGrid_1a6xo_148",bze="_scrollingGrid_1a6xo_154",Sze="_tile_1a6xo_173",Eze="_maximised_1a6xo_178",Zn={inRoom:oze,header:aze,filler:lze,footer:cze,hidden:uze,overlay:dze,logo:fze,buttons:hze,layout:pze,raiseHand:mze,invite:gze,switchCamera:vze,shareScreen:yze,fixedGrid:_ze,scrollingGrid:bze,tile:Sze,maximised:Eze},wze="_content_1cy0f_8",Cze="_wait_1cy0f_19",Tze="_join_1cy0f_32",G0={content:wze,wait:Cze,join:Tze};function GG(t,e){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function $1({debounce:t,scroll:e,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=_.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=_.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=t?typeof t=="number"?t:t.scroll:null,c=t?typeof t=="number"?t:t.resize:null,u=_.useRef(!1);_.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[f,p,m]=_.useMemo(()=>{const b=()=>{if(!a.current.element)return;const{left:w,top:k,width:T,height:I,bottom:C,right:x,x:A,y:N}=a.current.element.getBoundingClientRect(),D={left:w,top:k,width:T,height:I,bottom:C,right:x,x:A,y:N};a.current.element instanceof HTMLElement&&r&&(D.height=a.current.element.offsetHeight,D.width=a.current.element.offsetWidth),Object.freeze(D),u.current&&!xze(a.current.lastBounds,D)&&o(a.current.lastBounds=D)};return[b,c?GG(b,c):b,l?GG(b,l):b]},[o,r,l,c]);function v(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",m,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function g(){a.current.element&&(a.current.resizeObserver=new i(m),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(b=>b.addEventListener("scroll",m,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{m()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const S=b=>{!b||b===a.current.element||(v(),a.current.element=b,a.current.scrollContainers=zle(b),g())};return Ize(m,!!e),Rze(p),_.useEffect(()=>{v(),g()},[e,m,p]),_.useEffect(()=>v,[]),[S,s,f]}function Rze(t){_.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function Ize(t,e){_.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function zle(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(t);return[n,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...zle(t.parentElement)]}const kze=["x","y","top","bottom","left","right","width","height"],xze=(t,e)=>kze.every(n=>t[n]===e[n]),Pze="_loading_14w06_8",Lze={loading:Pze},Aze=({size:t,loading:e,...n})=>E.jsxs("div",{children:[e&&E.jsx("div",{className:Lze.loading,children:E.jsx(kPe,{size:t/3})}),E.jsx(lv,{size:t,...n})]}),Oze="_preview_1jjvr_8",Mze="_mirror_1jjvr_24",Nze="_cameraStarting_1jjvr_28",Dze="_avatarContainer_1jjvr_39",Fze="_buttonBar_1jjvr_51",q0={preview:Oze,mirror:Mze,cameraStarting:Nze,avatarContainer:Dze,buttonBar:Fze},Uze=({matrixInfo:t,muteStates:e,videoTrack:n,children:r})=>{const{t:i}=et(),[s,o]=$1(),a=_.useRef(null);_.useEffect(()=>(a.current&&(n==null||n.attach(a.current)),()=>{n==null||n.detach()}),[n]);const l=_.useMemo(()=>e.video.enabled&&!n,[e.video.enabled,n]);return E.jsxs("div",{className:Ne(q0.preview),ref:s,children:[E.jsx("video",{className:n&&PA(n).facingMode==="user"?q0.mirror:void 0,ref:a,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),(!e.video.enabled||l)&&E.jsx(E.Fragment,{children:E.jsxs("div",{className:q0.avatarContainer,children:[l&&E.jsx("div",{className:q0.cameraStarting,role:"status",children:i("video_tile.camera_starting")}),E.jsx(Aze,{id:t.userId,name:t.displayName,size:Math.min(o.width,o.height)/2,src:t.avatarUrl,loading:l})]})}),E.jsx("div",{className:q0.buttonBar,children:r})]})},Yle=t=>{const{t:e}=et();return E.jsx(Dt,{kind:"secondary",size:"sm",Icon:j5e,...t,children:e("action.invite")})};function ef(t){const e=_.useRef(void 0);return e.current??(e.current={value:t()}),e.current.value}let Sh;/android/i.test(navigator.userAgent)?Sh="android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?Sh="ios":Sh="desktop";const jze=()=>{const{userAgent:t}=navigator;return t.includes("Firefox")};function eu(t){const e=_.useRef(t);return e.current=t,e}function Xle(t){const e=hf(),n=eu(e.videoInput.select),r=Fh(s=>s.pipe(jt(([o])=>o),jt(o=>o===null?At(null):xy(Nl(o,Ce.Restarted).pipe(yn(null),Me(()=>o)),Nl(o,Ce.Muted).pipe(Me(()=>null))))),[t]),i=Fh(s=>Sh==="desktop"?At(null):s.pipe(jt(([o])=>o),Me(o=>{if(o===null)return null;const a=PA(o).facingMode;return a!=="user"&&a!=="environment"?null:()=>void o.restartTrack({facingMode:a==="user"?"environment":"user"}).then(()=>{const l=o.mediaStreamTrack.getSettings().deviceId;l!==void 0&&n.current(l)}).catch(l=>O.error("Failed to switch camera",a,l))})),[r]);return Je(i)}const Jle=({client:t,matrixInfo:e,muteStates:n,onEnter:r,enterLabel:i,confineToRoom:s,hideHeader:o,participantCount:a,onShareClick:l,waitingForInvite:c})=>{_.useEffect(()=>(O.info("[Lifecycle] GroupCallView Component mounted"),()=>{O.info("[Lifecycle] GroupCallView Component unmounted")}),[]);const{t:u}=et();O_(e.roomName);const f=_.useCallback(()=>{var z,K;return(K=(z=n.audio).setEnabled)==null?void 0:K.call(z,V=>!V)},[n]),p=_.useCallback(()=>{var z,K;return(K=(z=n.video).setEnabled)==null?void 0:K.call(z,V=>!V)},[n]),[m,v]=_.useState(!1),[g,S]=_.useState(WM),b=_.useCallback(()=>v(!0),[v]),w=_.useCallback(()=>v(!1),[v]),k=Yl(),T=_.useCallback(()=>{var z;(z=k("/"))==null||z.catch(K=>{O.error("Failed to navigate to /",K)})},[k]),I=ET("(max-height: 500px)"),C=!s&&E.jsx(Bl,{className:G0.recents,to:"/",children:u("lobby.leave_button")}),x=hf(),A=ef(()=>n.audio.enabled&&{deviceId:x.audioInput.selectedId}),{processor:N}=m3(),D=ef(()=>N),F=_.useMemo(()=>({audio:Object.assign({},A),video:n.video.enabled&&{deviceId:x.videoInput.selectedId,processor:D}}),[A,n.video.enabled,x.videoInput.selectedId,D]),$=_.useCallback(z=>{var K,V,q,Z;O.error("Error while creating preview Tracks:",z),(V=(K=n.audio).setEnabled)==null||V.call(K,!1),(Z=(q=n.video).setEnabled)==null||Z.call(q,!1)},[n.audio,n.video]),B=sze(F,$),W=_.useMemo(()=>(B==null?void 0:B.find(z=>z.kind===ue.Kind.Video))??null,[B]);ile(W);const H=Xle(Fh(z=>z.pipe(Me(([K])=>K)),[W]));return E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:Ne(G0.room,Zn.inRoom),children:[!o&&E.jsxs(uf,{children:[E.jsx(Jh,{children:E.jsx(nre,{id:e.roomId,name:e.roomName,avatarUrl:e.roomAvatar,encrypted:e.e2eeSystem.kind!==zt.NONE,participantCount:a})}),E.jsx(Zh,{children:l!==null&&E.jsx(Yle,{onClick:l})})]}),E.jsxs("div",{className:G0.content,children:[E.jsx(Uze,{matrixInfo:e,muteStates:n,videoTrack:W,children:E.jsx(Dt,{className:Ne(G0.join,{[G0.wait]:c}),size:c?"sm":"lg",onClick:()=>{c||r()},"data-testid":"lobby_joinCall",children:i??u("lobby.join_button")})}),!I&&C]}),E.jsxs("div",{className:Zn.footer,children:[I&&C,E.jsxs("div",{className:Zn.buttons,children:[E.jsx(wse,{muted:!n.audio.enabled,onClick:f,disabled:n.audio.setEnabled===null}),E.jsx(Cse,{muted:!n.video.enabled,onClick:p,disabled:n.video.setEnabled===null}),H&&E.jsx(Tse,{onClick:H}),E.jsx(Ise,{onClick:b}),!s&&E.jsx(Rse,{onClick:T})]})]})]}),t&&E.jsx(zM,{client:t,open:m,onDismiss:w,tab:g,onTabChange:S})]})},$ze="_headline_1em2y_8",Bze="_callEndedContent_1em2y_15",Hze="_callEndedButton_1em2y_35",Vze="_submitButton_1em2y_40",Gze="_container_1em2y_47",qze="_main_1em2y_55",Kze="_footer_1em2y_72",zu={headline:$ze,callEndedContent:Bze,callEndedButton:Hze,submitButton:Vze,container:Gze,main:qze,footer:Kze},Wze="_starIcon_1m09w_8",zze="_starRating_1m09w_12",Yze="_inputContainer_1m09w_18",Xze="_hideElement_1m09w_22",K0={starIcon:Wze,starRating:zze,inputContainer:Yze,hideElement:Xze},Jze=(t,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),Zze=_.forwardRef(Jze),Qze=(t,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),eYe=_.forwardRef(Qze);function tYe({starCount:t,onChange:e,required:n}){const[r,i]=_.useState(0),[s,o]=_.useState(0),{t:a}=et();return E.jsx("div",{className:K0.starRating,children:[...Array(t)].map((l,c)=>(c+=1,E.jsxs("div",{className:K0.inputContainer,onMouseEnter:()=>o(c),onMouseLeave:()=>o(r),children:[E.jsx("input",{className:K0.hideElement,type:"radio",id:"starInput"+String(c),value:String(c)+"Star",name:"star rating",onChange:u=>{i(c),e(c)},required:!0}),E.jsx("label",{className:K0.hideElement,id:"starInvisibleLabel"+String(c),htmlFor:"starInput"+String(c),children:a("star_rating_input_label",{count:c})}),E.jsx("label",{className:K0.starIcon,id:"starIcon"+String(c),htmlFor:"starInput"+String(c),children:c<=(s||r)?E.jsx(Zze,{}):E.jsx(eYe,{})})]},c)))})}const nYe=({client:t,isPasswordlessUser:e,confineToRoom:n,endedCallId:r})=>{const{t:i}=et(),s=Yl(),{displayName:o}=T_(t),[a,l]=_.useState(!1),[c,u]=_.useState(0),[f,p]=_.useState(!1),[m,v]=_.useState(!1),g=_.useCallback(w=>{w.preventDefault();const T=new FormData(w.target).get("feedbackText");xt.instance.eventQualitySurvey.track(r,T,c),p(!0),setTimeout(()=>{v(!0),setTimeout(()=>{var I;e?l(!0):n||(I=s("/"))==null||I.catch(C=>{O.error("Failed to navigate to /",C)})},1e3)},1e3)},[r,s,e,n,c]),S=e&&E.jsxs("div",{className:zu.callEndedContent,children:[E.jsxs(Os,{i18nKey:"call_ended_view.create_account_prompt",children:[E.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),E.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),E.jsx(A8,{className:zu.callEndedButton,to:"/register",children:i("call_ended_view.create_account_button")})]}),b=E.jsxs("div",{className:zu.callEndedContent,children:[E.jsx(Os,{i18nKey:"call_ended_view.feedback_prompt",children:E.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),E.jsxs("form",{onSubmit:g,children:[E.jsx(St,{children:E.jsx(tYe,{starCount:5,onChange:u,required:!0})}),E.jsx(St,{children:E.jsx(fn,{className:Fse.feedback,id:"feedbackText",name:"feedbackText",label:i("settings.feedback_tab_description_label"),placeholder:i("settings.feedback_tab_description_label"),type:"textarea"})})," ",E.jsx(St,{children:m?E.jsx(Os,{i18nKey:"call_ended_view.feedback_done",children:E.jsx("p",{children:"Thanks for your feedback!"})}):E.jsx(Dt,{type:"submit",className:zu.submitButton,"data-testid":"home_go",children:i(f?"submitting":"action.submit")})})]})]});return E.jsxs(E.Fragment,{children:[E.jsxs(uf,{children:[E.jsx(Jh,{children:!n&&E.jsx(Oh,{})}),E.jsx(Zh,{})]}),E.jsxs("div",{className:zu.container,children:[E.jsxs("main",{className:zu.main,children:[E.jsx(cf,{size:"xl",weight:"semibold",className:zu.headline,children:a?i("call_ended_view.headline",{displayName:o}):i("call_ended_view.headline",{displayName:o})+`
`+i("call_ended_view.survey_prompt")}),(!a||n)&&xt.instance.isEnabled()?b:S]}),!n&&E.jsx(ln,{className:zu.footer,children:E.jsxs(Bl,{to:"/",children:[" ",i("call_ended_view.not_now_button")," "]})})]})]})};function qG(t,e,n){const r=n.find(i=>i.kind===e&&i.label===t);return r==null?void 0:r.deviceId}const rYe=(t,e)=>_.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("g",{id:"Logo Mark"},_.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),_.createElement("g",{id:"Union"},_.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),_.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),_.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),_.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),iYe=_.forwardRef(rYe),sYe=(t,e)=>_.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("g",{id:"Logo Type"},_.createElement("g",{id:"Vector"},_.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),_.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),_.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),_.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),_.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),_.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),_.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),_.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),oYe=_.forwardRef(sYe),KG=t=>{const e=document.activeElement;return e!==null&&e.contains(t)},WG=Object.fromEntries(Iy.slice(0,F5).map((t,e)=>[(e+1).toString(),t]));function aYe(t,e,n,r,i,s){const o=_.useRef(!1);x1(window,"keydown",_.useCallback(a=>{t.current!==null&&KG(t.current)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||(a.key==="m"?(a.preventDefault(),e()):a.key=="v"?(a.preventDefault(),n()):a.key===" "?(a.preventDefault(),o.current||(o.current=!0,r(!1))):a.key==="h"?(a.preventDefault(),s()):WG[a.key]&&(a.preventDefault(),i(WG[a.key]))))},[t,n,e,r,i,s]),_.useMemo(()=>({capture:!0}),[])),x1(window,"keyup",_.useCallback(a=>{t.current!==null&&KG(t.current)&&a.key===" "&&(o.current=!1,r(!0))},[t,r])),x1(window,"blur",_.useCallback(()=>{o.current&&(o.current=!1,r(!0))},[r,o]))}const lYe="_tile_vtjqb_8",cYe="_speaking_vtjqb_27",uYe="_handRaised_vtjqb_47",dYe="_muteIcon_vtjqb_74",fYe="_volumeSlider_vtjqb_82",c1={tile:lYe,speaking:cYe,handRaised:uYe,muteIcon:dYe,volumeSlider:fYe};class Zle{constructor(){this.ended$=new Yr,this.bindImpl=R$e(this.ended$),this.stateImpl=e=>e.pipe(this.bind(),Ll(),E$e({bufferSize:1,refCount:!1}))}bind(){return this.bindImpl}state(){return this.stateImpl}end(){this.ended$.next(),this.ended$.complete()}}class b3{constructor(){this.scope=new Zle}destroy(){this.scope.end()}}const zG=Symbol("nothing");function hYe(t){return e=>n$e(()=>{let n=zG;return e.pipe(I$e(r=>n=r),cse(()=>{n!==zG&&t(n)}))})}function yL(t,e){return n=>n.pipe(yc(e,t),yn(t))}function Uy(t,e){return t.pipe(jt(n=>n?F8(n).pipe(Me(()=>({participant:n,publication:n.getTrackPublication(e),source:e})),b$e("publication")):At(void 0)))}function Qle(t,e,n){return Gn([Uy(At(t),e),U5(1e3).pipe(yn(0))]).pipe(jt(async([r])=>{var o;const i=(o=r==null?void 0:r.publication)==null?void 0:o.track;if(!i||!(i instanceof xA||i instanceof GC))return;const s=await i.getRTCStatsReport();if(s){for(const a of s.values())if(a.type===n)return a}}),yn(void 0))}function _L(t,e){return Qle(t,e,"inbound-rtp").pipe(Me(n=>n))}function YG(t,e){return Qle(t,e,"outbound-rtp").pipe(Me(n=>n))}function s2(t,e){let n={framesDecoded:void 0,framesReceived:void 0};return _L(t,e).pipe(Me(r=>{if(!r)return;const{framesDecoded:i,framesDropped:s,framesReceived:o}=r;return{framesDecoded:i,framesDropped:s,framesReceived:o}}),Ga(r=>!!r),Me(r=>{const i=n;if(n=r,typeof r.framesReceived=="number"&&typeof i.framesReceived=="number"&&typeof r.framesDecoded=="number"&&typeof i.framesDecoded=="number"){const s=r.framesReceived-i.framesReceived,o=r.framesDecoded-i.framesDecoded;if(s>0)return o>0}}),Ga(r=>typeof r=="boolean"),yn(void 0))}function J4(t,e,n,r){return xHe(t,ae.EncryptionError).pipe(Me(i=>{const[s]=i;return n.kind===zt.PER_PARTICIPANT?((s==null?void 0:s.message.includes(e.identity))&&(s==null?void 0:s.message.includes(r)))??!1:n.kind===zt.SHARED_KEY?!!(s!=null&&s.message.includes(r)):!1}),k$e(1e3),yn(!1))}class ece extends b3{constructor(e,n,r,i,s,o,a,l){super(),this.id=e,this.member=n,this.participant$=r,this.displayname$=l;const c=Uy(r,s).pipe(this.scope.state());this.video$=Uy(r,o).pipe(this.scope.state()),this.unencryptedWarning$=Gn([c,this.video$],(u,f)=>{var p,m;return i.kind!==zt.NONE&&(((p=u==null?void 0:u.publication)==null?void 0:p.isEncrypted)===!1||((m=f==null?void 0:f.publication)==null?void 0:m.isEncrypted)===!1)}).pipe(this.scope.state()),this.encryptionStatus$=this.participant$.pipe(jt(u=>u?u.isLocal||i.kind===zt.NONE?At(1):i.kind===zt.PER_PARTICIPANT?Gn([J4(a,u,i,"MissingKey"),J4(a,u,i,"InvalidKey"),s2(u,s),s2(u,o)]).pipe(Me(([f,p,m,v])=>{if(f)return 2;if(p)return 3;if(m||v)return 1}),Ga(f=>!!f),yn(0)):Gn([J4(a,u,i,"InvalidKey"),s2(u,s),s2(u,o)]).pipe(Me(([f,p,m])=>{if(f)return 4;if(p||m)return 1}),Ga(f=>!!f),yn(0)):At(0)),this.scope.state())}}class tce extends ece{constructor(e,n,r,i,s,o,a,l){super(e,n,r,i,ue.Source.Microphone,ue.Source.Camera,s,o),this.handRaised$=a,this.reaction$=l,this.speaking$=this.participant$.pipe(jt(u=>u?D8(u,se.IsSpeakingChanged).pipe(Me(f=>f.isSpeaking)):At(!1)),this.scope.state()),this._cropVideo$=new Gi(!0),this.cropVideo$=this._cropVideo$;const c=r.pipe(jt(u=>(u&&F8(u))??At(void 0)),this.scope.state());this.audioEnabled$=c.pipe(Me(u=>{var f;return((f=u==null?void 0:u.microphoneTrack)==null?void 0:f.isMuted)===!1})),this.videoEnabled$=c.pipe(Me(u=>{var f;return((f=u==null?void 0:u.cameraTrack)==null?void 0:f.isMuted)===!1}))}toggleFitContain(){this._cropVideo$.next(!this._cropVideo$.value)}get local(){return this instanceof Ug}}class Ug extends tce{constructor(e,n,r,i,s,o,a,l){super(e,n,r,i,s,o,a,l),this.mirror$=this.video$.pipe(jt(c=>{var f;const u=(f=c==null?void 0:c.publication)==null?void 0:f.track;return u instanceof GC?Nl(u,Ce.Restarted).pipe(yn(null),Me(()=>PA(u).facingMode==="user")):At(!1)}),this.scope.state()),this.alwaysShow$=sV.value$,this.setAlwaysShow=sV.setValue,this.audioStreamStats$=Gn([this.participant$,Ly.value$]).pipe(jt(([c,u])=>!c||!u?At(void 0):YG(c,ue.Source.Microphone))),this.videoStreamStats$=Gn([this.participant$,Ly.value$]).pipe(jt(([c,u])=>!c||!u?At(void 0):YG(c,ue.Source.Camera)))}}class pYe extends tce{constructor(e,n,r,i,s,o,a,l){super(e,n,r,i,s,o,a,l),this.locallyMutedToggle$=new Yr,this.localVolumeAdjustment$=new Yr,this.localVolumeCommit$=new Yr,this.localVolume$=xy(this.locallyMutedToggle$.pipe(Me(()=>"toggle mute")),this.localVolumeAdjustment$,this.localVolumeCommit$.pipe(Me(()=>"commit"))).pipe(yL({volume:1,committedVolume:1},(c,u)=>{switch(u){case"toggle mute":return{...c,volume:c.volume===0?c.committedVolume:0};case"commit":return{...c,committedVolume:c.volume===0?c.committedVolume:c.volume};default:return{...c,volume:u}}}),Me(({volume:c})=>c),this.scope.state()),this.locallyMuted$=this.localVolume$.pipe(Me(c=>c===0),this.scope.state()),this.audioStreamStats$=Gn([this.participant$,Ly.value$]).pipe(jt(([c,u])=>!c||!u?At(void 0):_L(c,ue.Source.Microphone))),this.videoStreamStats$=Gn([this.participant$,Ly.value$]).pipe(jt(([c,u])=>!c||!u?At(void 0):_L(c,ue.Source.Camera))),Gn([r,this.localVolume$.pipe(this.scope.bind())]).subscribe(([c,u])=>c&&c.setVolume(u))}toggleLocallyMuted(){this.locallyMutedToggle$.next()}setLocalVolume(e){this.localVolumeAdjustment$.next(e)}commitLocalVolume(){this.localVolumeCommit$.next()}}class Em extends ece{constructor(e,n,r,i,s,o,a){super(e,n,r,i,ue.Source.ScreenShareAudio,ue.Source.ScreenShare,s,o),this.local=a}}var n9=U_(),vt=t=>F_(t,n9),r9=U_();vt.write=t=>F_(t,r9);var S3=U_();vt.onStart=t=>F_(t,S3);var i9=U_();vt.onFrame=t=>F_(t,i9);var s9=U_();vt.onFinish=t=>F_(t,s9);var ng=[];vt.setTimeout=(t,e)=>{const n=vt.now()+e,r=()=>{const s=ng.findIndex(o=>o.cancel==r);~s&&ng.splice(s,1),Ed-=~s?1:0},i={time:n,handler:t,cancel:r};return ng.splice(nce(n),0,i),Ed+=1,rce(),i};var nce=t=>~(~ng.findIndex(e=>e.time>t)||~ng.length);vt.cancel=t=>{S3.delete(t),i9.delete(t),s9.delete(t),n9.delete(t),r9.delete(t)};vt.sync=t=>{bL=!0,vt.batchedUpdates(t),bL=!1};vt.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function r(...i){e=i,vt.onStart(n)}return r.handler=t,r.cancel=()=>{S3.delete(n),e=null},r};var o9=typeof window<"u"?window.requestAnimationFrame:()=>{};vt.use=t=>o9=t;vt.now=typeof performance<"u"?()=>performance.now():Date.now;vt.batchedUpdates=t=>t();vt.catch=console.error;vt.frameLoop="always";vt.advance=()=>{vt.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):sce()};var Sd=-1,Ed=0,bL=!1;function F_(t,e){bL?(e.delete(t),t(0)):(e.add(t),rce())}function rce(){Sd<0&&(Sd=0,vt.frameLoop!=="demand"&&o9(ice))}function mYe(){Sd=-1}function ice(){~Sd&&(o9(ice),vt.batchedUpdates(sce))}function sce(){const t=Sd;Sd=vt.now();const e=nce(Sd);if(e&&(oce(ng.splice(0,e),n=>n.handler()),Ed-=e),!Ed){mYe();return}S3.flush(),n9.flush(t?Math.min(64,Sd-t):16.667),i9.flush(),r9.flush(),s9.flush()}function U_(){let t=new Set,e=t;return{add(n){Ed+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return Ed-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,Ed-=e.size,oce(e,r=>r(n)&&t.add(r)),Ed+=t.size,e=t)}}}function oce(t,e){t.forEach(n=>{try{e(n)}catch(r){vt.catch(r)}})}var gYe=Object.defineProperty,vYe=(t,e)=>{for(var n in e)gYe(t,n,{get:e[n],enumerable:!0})},za={};vYe(za,{assign:()=>_Ye,colors:()=>Nd,createStringInterpolator:()=>l9,skipAnimation:()=>lce,to:()=>ace,willAdvance:()=>c9});function SL(){}var yYe=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),be={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Rc(t,e){if(be.arr(t)){if(!be.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var wt=(t,e)=>t.forEach(e);function Vl(t,e,n){if(be.arr(t)){for(let r=0;r<t.length;r++)e.call(n,t[r],`${r}`);return}for(const r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r)}var ns=t=>be.und(t)?[]:be.arr(t)?t:[t];function B1(t,e){if(t.size){const n=Array.from(t);t.clear(),wt(n,e)}}var u1=(t,...e)=>B1(t,n=>n(...e)),a9=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),l9,ace,Nd=null,lce=!1,c9=SL,_Ye=t=>{t.to&&(ace=t.to),t.now&&(vt.now=t.now),t.colors!==void 0&&(Nd=t.colors),t.skipAnimation!=null&&(lce=t.skipAnimation),t.createStringInterpolator&&(l9=t.createStringInterpolator),t.requestAnimationFrame&&vt.use(t.requestAnimationFrame),t.batchedUpdates&&(vt.batchedUpdates=t.batchedUpdates),t.willAdvance&&(c9=t.willAdvance),t.frameLoop&&(vt.frameLoop=t.frameLoop)},H1=new Set,Uo=[],Z4=[],cC=0,E3={get idle(){return!H1.size&&!Uo.length},start(t){cC>t.priority?(H1.add(t),vt.onStart(bYe)):(cce(t),vt(EL))},advance:EL,sort(t){if(cC)vt.onFrame(()=>E3.sort(t));else{const e=Uo.indexOf(t);~e&&(Uo.splice(e,1),uce(t))}},clear(){Uo=[],H1.clear()}};function bYe(){H1.forEach(cce),H1.clear(),vt(EL)}function cce(t){Uo.includes(t)||uce(t)}function uce(t){Uo.splice(SYe(Uo,e=>e.priority>t.priority),0,t)}function EL(t){const e=Z4;for(let n=0;n<Uo.length;n++){const r=Uo[n];cC=r.priority,r.idle||(c9(r),r.advance(t),r.idle||e.push(r))}return cC=0,Z4=Uo,Z4.length=0,Uo=e,Uo.length>0}function SYe(t,e){const n=t.findIndex(e);return n<0?t.length:n}var EYe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Ba="[-+]?\\d*\\.?\\d+",uC=Ba+"%";function w3(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var wYe=new RegExp("rgb"+w3(Ba,Ba,Ba)),CYe=new RegExp("rgba"+w3(Ba,Ba,Ba,Ba)),TYe=new RegExp("hsl"+w3(Ba,uC,uC)),RYe=new RegExp("hsla"+w3(Ba,uC,uC,Ba)),IYe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,kYe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,xYe=/^#([0-9a-fA-F]{6})$/,PYe=/^#([0-9a-fA-F]{8})$/;function LYe(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=xYe.exec(t))?parseInt(e[1]+"ff",16)>>>0:Nd&&Nd[t]!==void 0?Nd[t]:(e=wYe.exec(t))?(Jp(e[1])<<24|Jp(e[2])<<16|Jp(e[3])<<8|255)>>>0:(e=CYe.exec(t))?(Jp(e[1])<<24|Jp(e[2])<<16|Jp(e[3])<<8|ZG(e[4]))>>>0:(e=IYe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=PYe.exec(t))?parseInt(e[1],16)>>>0:(e=kYe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=TYe.exec(t))?(XG(JG(e[1]),o2(e[2]),o2(e[3]))|255)>>>0:(e=RYe.exec(t))?(XG(JG(e[1]),o2(e[2]),o2(e[3]))|ZG(e[4]))>>>0:null}function Q4(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function XG(t,e,n){const r=n<.5?n*(1+e):n+e-n*e,i=2*n-r,s=Q4(i,r,t+1/3),o=Q4(i,r,t),a=Q4(i,r,t-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function Jp(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function JG(t){return(parseFloat(t)%360+360)%360/360}function ZG(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function o2(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function QG(t){let e=LYe(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,r=(e&16711680)>>>16,i=(e&65280)>>>8,s=(e&255)/255;return`rgba(${n}, ${r}, ${i}, ${s})`}var jy=(t,e,n)=>{if(be.fun(t))return t;if(be.arr(t))return jy({range:t,output:e,extrapolate:n});if(be.str(t.output[0]))return l9(t);const r=t,i=r.output,s=r.range||[0,1],o=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",l=r.easing||(c=>c);return c=>{const u=OYe(c,s);return AYe(c,s[u],s[u+1],i[u],i[u+1],l,o,a,r.map)}};function AYe(t,e,n,r,i,s,o,a,l){let c=l?l(t):t;if(c<e){if(o==="identity")return c;o==="clamp"&&(c=e)}if(c>n){if(a==="identity")return c;a==="clamp"&&(c=n)}return r===i?r:e===n?t<=e?r:i:(e===-1/0?c=-c:n===1/0?c=c-e:c=(c-e)/(n-e),c=s(c),r===-1/0?c=-c:i===1/0?c=c+r:c=c*(i-r)+r,c)}function OYe(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var MYe={linear:t=>t},$y=Symbol.for("FluidValue.get"),jg=Symbol.for("FluidValue.observers"),Do=t=>!!(t&&t[$y]),ws=t=>t&&t[$y]?t[$y]():t,eq=t=>t[jg]||null;function NYe(t,e){t.eventObserved?t.eventObserved(e):t(e)}function By(t,e){const n=t[jg];n&&n.forEach(r=>{NYe(r,e)})}var dce=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");DYe(this,t)}},DYe=(t,e)=>fce(t,$y,e);function Ev(t,e){if(t[$y]){let n=t[jg];n||fce(t,jg,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function Hy(t,e){const n=t[jg];if(n&&n.has(e)){const r=n.size-1;r?n.delete(e):t[jg]=null,t.observerRemoved&&t.observerRemoved(r,e)}}var fce=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),IE=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,FYe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,tq=new RegExp(`(${IE.source})(%|[a-z]+)`,"i"),UYe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,C3=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,hce=t=>{const[e,n]=jYe(t);if(!e||a9())return t;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(n&&n.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(n);return i||t}else{if(n&&C3.test(n))return hce(n);if(n)return n}return t},jYe=t=>{const e=C3.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]},e6,$Ye=(t,e,n,r,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,pce=t=>{e6||(e6=Nd?new RegExp(`(${Object.keys(Nd).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(s=>ws(s).replace(C3,hce).replace(FYe,QG).replace(e6,QG)),n=e.map(s=>s.match(IE).map(Number)),i=n[0].map((s,o)=>n.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>jy({...t,output:s}));return s=>{var l;const o=!tq.test(e[0])&&((l=e.find(c=>tq.test(c)))==null?void 0:l.replace(IE,""));let a=0;return e[0].replace(IE,()=>`${i[a++](s)}${o||""}`).replace(UYe,$Ye)}},u9="react-spring: ",mce=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${u9}once requires a function parameter`);return(...r)=>{n||(e(...r),n=!0)}},BYe=mce(console.warn);function HYe(){BYe(`${u9}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var VYe=mce(console.warn);function GYe(){VYe(`${u9}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function T3(t){return be.str(t)&&(t[0]=="#"||/\d/.test(t)||!a9()&&C3.test(t)||t in(Nd||{}))}var wm=a9()?_.useEffect:_.useLayoutEffect,qYe=()=>{const t=_.useRef(!1);return wm(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function gce(){const t=_.useState()[1],e=qYe();return()=>{e.current&&t(Math.random())}}function KYe(t,e){const[n]=_.useState(()=>({inputs:e,result:t()})),r=_.useRef(),i=r.current;let s=i;return s?e&&s.inputs&&WYe(e,s.inputs)||(s={inputs:e,result:t()}):s=n,_.useEffect(()=>{r.current=s,i==n&&(n.inputs=n.result=void 0)},[s]),s.result}function WYe(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var vce=t=>_.useEffect(t,zYe),zYe=[];function YYe(t){const e=_.useRef();return _.useEffect(()=>{e.current=t}),e.current}var Vy=Symbol.for("Animated:node"),XYe=t=>!!t&&t[Vy]===t,Rl=t=>t&&t[Vy],d9=(t,e)=>yYe(t,Vy,e),R3=t=>t&&t[Vy]&&t[Vy].getPayload(),yce=class{constructor(){d9(this,this)}getPayload(){return this.payload||[]}},j_=class extends yce{constructor(t){super(),this._value=t,this.done=!0,this.durationProgress=0,be.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new j_(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return be.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,be.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}},Gy=class extends j_{constructor(t){super(0),this._string=null,this._toString=jy({output:[t,t]})}static create(t){return new Gy(t)}getValue(){const t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(be.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=jy({output:[this.getValue(),t]})),this._value=0,super.reset()}},dC={dependencies:null},I3=class extends yce{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return Vl(this.source,(n,r)=>{XYe(n)?e[r]=n.getValue(t):Do(n)?e[r]=ws(n):t||(e[r]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&wt(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return Vl(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){dC.dependencies&&Do(t)&&dC.dependencies.add(t);const e=R3(t);e&&wt(e,n=>this.add(n))}},_ce=class extends I3{constructor(t){super(t)}static create(t){return new _ce(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const e=this.getPayload();return t.length==e.length?e.map((n,r)=>n.setValue(t[r])).some(Boolean):(super.setValue(t.map(JYe)),!0)}};function JYe(t){return(T3(t)?Gy:j_).create(t)}function wL(t){const e=Rl(t);return e?e.constructor:be.arr(t)?_ce:T3(t)?Gy:j_}var nq=(t,e)=>{const n=!be.fun(t)||t.prototype&&t.prototype.isReactComponent;return _.forwardRef((r,i)=>{const s=_.useRef(null),o=n&&_.useCallback(v=>{s.current=eXe(i,v)},[i]),[a,l]=QYe(r,e),c=gce(),u=()=>{const v=s.current;if(n&&!v)return;(v?e.applyAnimatedValues(v,a.getValue(!0)):!1)===!1&&c()},f=new ZYe(u,l),p=_.useRef();wm(()=>(p.current=f,wt(l,v=>Ev(v,f)),()=>{p.current&&(wt(p.current.deps,v=>Hy(v,p.current)),vt.cancel(p.current.update))})),_.useEffect(u,[]),vce(()=>()=>{const v=p.current;wt(v.deps,g=>Hy(g,v))});const m=e.getComponentProps(a.getValue());return _.createElement(t,{...m,ref:o})})},ZYe=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&vt.write(this.update)}};function QYe(t,e){const n=new Set;return dC.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new I3(t),dC.dependencies=null,[t,n]}function eXe(t,e){return t&&(be.fun(t)?t(e):t.current=e),e}var rq=Symbol.for("AnimatedComponent"),tXe=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=i=>new I3(i),getComponentProps:r=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:r},s=o=>{const a=iq(o)||"Anonymous";return be.str(o)?o=s[o]||(s[o]=nq(o,i)):o=o[rq]||(o[rq]=nq(o,i)),o.displayName=`Animated(${a})`,o};return Vl(t,(o,a)=>{be.arr(t)&&(a=iq(o)),s[a]=s(o)}),{animated:s}},iq=t=>be.str(t)?t:t&&be.str(t.displayName)?t.displayName:be.fun(t)&&t.name||null;function Cs(t,...e){return be.fun(t)?t(...e):t}var V1=(t,e)=>t===!0||!!(e&&t&&(be.fun(t)?t(e):ns(t).includes(e))),bce=(t,e)=>be.obj(t)?e&&t[e]:t,Sce=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,nXe=t=>t,f9=(t,e=nXe)=>{let n=rXe;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const r={};for(const i of n){const s=e(t[i],i);be.und(s)||(r[i]=s)}return r},rXe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],iXe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function sXe(t){const e={};let n=0;if(Vl(t,(r,i)=>{iXe[i]||(e[i]=r,n++)}),n)return e}function h9(t){const e=sXe(t);if(e){const n={to:e};return Vl(t,(r,i)=>i in e||(n[i]=r)),n}return{...t}}function qy(t){return t=ws(t),be.arr(t)?t.map(qy):T3(t)?za.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function oXe(t){for(const e in t)return!0;return!1}function CL(t){return be.fun(t)||be.arr(t)&&be.obj(t[0])}function sq(t,e){var n;(n=t.ref)==null||n.delete(t),e==null||e.delete(t)}function aXe(t,e){var n;e&&t.ref!==e&&((n=t.ref)==null||n.delete(t),e.add(t),t.ref=e)}var lXe={default:{tension:170,friction:26}},TL={...lXe.default,mass:1,damping:1,easing:MYe.linear,clamp:!1},cXe=class{constructor(){this.velocity=0,Object.assign(this,TL)}};function uXe(t,e,n){n&&(n={...n},oq(n,e),e={...n,...e}),oq(t,e),Object.assign(t,e);for(const o in TL)t[o]==null&&(t[o]=TL[o]);let{frequency:r,damping:i}=t;const{mass:s}=t;return be.und(r)||(r<.01&&(r=.01),i<0&&(i=0),t.tension=Math.pow(2*Math.PI/r,2)*s,t.friction=4*Math.PI*i*s/r),t}function oq(t,e){if(!be.und(e.decay))t.duration=void 0;else{const n=!be.und(e.tension)||!be.und(e.friction);(n||!be.und(e.frequency)||!be.und(e.damping)||!be.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var aq=[],dXe=class{constructor(){this.changed=!1,this.values=aq,this.toValues=null,this.fromValues=aq,this.config=new cXe,this.immediate=!1}};function Ece(t,{key:e,props:n,defaultProps:r,state:i,actions:s}){return new Promise((o,a)=>{let l,c,u=V1(n.cancel??(r==null?void 0:r.cancel),e);if(u)m();else{be.und(n.pause)||(i.paused=V1(n.pause,e));let v=r==null?void 0:r.pause;v!==!0&&(v=i.paused||V1(v,e)),l=Cs(n.delay||0,e),v?(i.resumeQueue.add(p),s.pause()):(s.resume(),p())}function f(){i.resumeQueue.add(p),i.timeouts.delete(c),c.cancel(),l=c.time-vt.now()}function p(){l>0&&!za.skipAnimation?(i.delayed=!0,c=vt.setTimeout(m,l),i.pauseQueue.add(f),i.timeouts.add(c)):m()}function m(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(f),i.timeouts.delete(c),t<=(i.cancelId||0)&&(u=!0);try{s.start({...n,callId:t,cancel:u},o)}catch(v){a(v)}}})}var p9=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?rg(t.get()):e.every(n=>n.noop)?wce(t.get()):Na(t.get(),e.every(n=>n.finished)),wce=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),Na=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),rg=t=>({value:t,cancelled:!0,finished:!1});function Cce(t,e,n,r){const{callId:i,parentId:s,onRest:o}=e,{asyncTo:a,promise:l}=n;return!s&&t===a&&!e.reset?l:n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const c=f9(e,(S,b)=>b==="onRest"?void 0:S);let u,f;const p=new Promise((S,b)=>(u=S,f=b)),m=S=>{const b=i<=(n.cancelId||0)&&rg(r)||i!==n.asyncId&&Na(r,!1);if(b)throw S.result=b,f(S),S},v=(S,b)=>{const w=new lq,k=new cq;return(async()=>{if(za.skipAnimation)throw Ky(n),k.result=Na(r,!1),f(k),k;m(w);const T=be.obj(S)?{...S}:{...b,to:S};T.parentId=i,Vl(c,(C,x)=>{be.und(T[x])&&(T[x]=C)});const I=await r.start(T);return m(w),n.paused&&await new Promise(C=>{n.resumeQueue.add(C)}),I})()};let g;if(za.skipAnimation)return Ky(n),Na(r,!1);try{let S;be.arr(t)?S=(async b=>{for(const w of b)await v(w)})(t):S=Promise.resolve(t(v,r.stop.bind(r))),await Promise.all([S.then(u),p]),g=Na(r.get(),!0,!1)}catch(S){if(S instanceof lq)g=S.result;else if(S instanceof cq)g=S.result;else throw S}finally{i==n.asyncId&&(n.asyncId=s,n.asyncTo=s?a:void 0,n.promise=s?l:void 0)}return be.fun(o)&&vt.batchedUpdates(()=>{o(g,r,r.item)}),g})()}function Ky(t,e){B1(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var lq=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},cq=class extends Error{constructor(){super("SkipAnimationSignal")}},RL=t=>t instanceof m9,fXe=1,m9=class extends dce{constructor(){super(...arguments),this.id=fXe++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Rl(this);return t&&t.getValue()}to(...t){return za.to(this,t)}interpolate(...t){return HYe(),za.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){By(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||E3.sort(this),By(this,{type:"priority",parent:this,priority:t})}},$h=Symbol.for("SpringPhase"),Tce=1,Rce=2,Ice=4,t6=t=>(t[$h]&Tce)>0,Yu=t=>(t[$h]&Rce)>0,W0=t=>(t[$h]&Ice)>0,uq=(t,e)=>e?t[$h]|=Rce|Tce:t[$h]&=-3,dq=(t,e)=>e?t[$h]|=Ice:t[$h]&=-5,hXe=class extends m9{constructor(t,e){if(super(),this.animation=new dXe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!be.und(t)||!be.und(e)){const n=be.obj(t)?{...t}:{...e,from:t};be.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Yu(this)||this._state.asyncTo)||W0(this)}get goal(){return ws(this.animation.to)}get velocity(){const t=Rl(this);return t instanceof j_?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return t6(this)}get isAnimating(){return Yu(this)}get isPaused(){return W0(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:s}=r,o=R3(r.to);!o&&Do(r.to)&&(i=ns(ws(r.to))),r.values.forEach((c,u)=>{if(c.done)return;const f=c.constructor==Gy?1:o?o[u].lastPosition:i[u];let p=r.immediate,m=f;if(!p){if(m=c.lastPosition,s.tension<=0){c.done=!0;return}let v=c.elapsedTime+=t;const g=r.fromValues[u],S=c.v0!=null?c.v0:c.v0=be.arr(s.velocity)?s.velocity[u]:s.velocity;let b;const w=s.precision||(g==f?.005:Math.min(1,Math.abs(f-g)*.001));if(be.und(s.duration))if(s.decay){const k=s.decay===!0?.998:s.decay,T=Math.exp(-(1-k)*v);m=g+S/(1-k)*(1-T),p=Math.abs(c.lastPosition-m)<=w,b=S*T}else{b=c.lastVelocity==null?S:c.lastVelocity;const k=s.restVelocity||w/10,T=s.clamp?0:s.bounce,I=!be.und(T),C=g==f?c.v0>0:g<f;let x,A=!1;const N=1,D=Math.ceil(t/N);for(let F=0;F<D&&(x=Math.abs(b)>k,!(!x&&(p=Math.abs(f-m)<=w,p)));++F){I&&(A=m==f||m>f==C,A&&(b=-b*T,m=f));const $=-s.tension*1e-6*(m-f),B=-s.friction*.001*b,W=($+B)/s.mass;b=b+W*N,m=m+b*N}}else{let k=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,c.durationProgress>0&&(c.elapsedTime=s.duration*c.durationProgress,v=c.elapsedTime+=t)),k=(s.progress||0)+v/this._memoizedDuration,k=k>1?1:k<0?0:k,c.durationProgress=k),m=g+s.easing(k)*(f-g),b=(m-c.lastPosition)/t,p=k==1}c.lastVelocity=b,Number.isNaN(m)&&(console.warn("Got NaN while animating:",this),p=!0)}o&&!o[u].done&&(p=!1),p?c.done=!0:e=!1,c.setValue(m,s.round)&&(n=!0)});const a=Rl(this),l=a.getValue();if(e){const c=ws(r.to);(l!==c||n)&&!s.decay?(a.setValue(c),this._onChange(c)):n&&s.decay&&this._onChange(l),this._stop()}else n&&this._onChange(l)}set(t){return vt.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Yu(this)){const{to:t,config:e}=this.animation;vt.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return be.und(t)?(n=this.queue||[],this.queue=[]):n=[be.obj(t)?t:{...e,to:t}],Promise.all(n.map(r=>this._update(r))).then(r=>p9(this,r))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),Ky(this._state,t&&this._lastCallId),vt.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:r}=t;n=be.obj(n)?n[e]:n,(n==null||CL(n))&&(n=void 0),r=be.obj(r)?r[e]:r,r==null&&(r=void 0);const i={to:n,from:r};return t6(this)||(t.reverse&&([n,r]=[r,n]),r=ws(r),be.und(r)?Rl(this)||this._set(n):this._set(r)),i}_update({...t},e){const{key:n,defaultProps:r}=this;t.default&&Object.assign(r,f9(t,(o,a)=>/^on/.test(a)?bce(o,n):o)),hq(this,t,"onProps"),Y0(this,"onProps",t,this);const i=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return Ece(++this._lastCallId,{key:n,props:t,defaultProps:r,state:s,actions:{pause:()=>{W0(this)||(dq(this,!0),u1(s.pauseQueue),Y0(this,"onPause",Na(this,z0(this,this.animation.to)),this))},resume:()=>{W0(this)&&(dq(this,!1),Yu(this)&&this._resume(),u1(s.resumeQueue),Y0(this,"onResume",Na(this,z0(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(t.loop&&o.finished&&!(e&&o.noop)){const a=kce(t);if(a)return this._update(a,!0)}return o})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(rg(this));const r=!be.und(t.to),i=!be.und(t.from);if(r||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(rg(this));const{key:s,defaultProps:o,animation:a}=this,{to:l,from:c}=a;let{to:u=l,from:f=c}=t;i&&!r&&(!e.default||be.und(u))&&(u=f),e.reverse&&([u,f]=[f,u]);const p=!Rc(f,c);p&&(a.from=f),f=ws(f);const m=!Rc(u,l);m&&this._focus(u);const v=CL(e.to),{config:g}=a,{decay:S,velocity:b}=g;(r||i)&&(g.velocity=0),e.config&&!v&&uXe(g,Cs(e.config,s),e.config!==o.config?Cs(o.config,s):void 0);let w=Rl(this);if(!w||be.und(u))return n(Na(this,!0));const k=be.und(e.reset)?i&&!e.default:!be.und(f)&&V1(e.reset,s),T=k?f:this.get(),I=qy(u),C=be.num(I)||be.arr(I)||T3(I),x=!v&&(!C||V1(o.immediate||e.immediate,s));if(m){const F=wL(u);if(F!==w.constructor)if(x)w=this._set(I);else throw Error(`Cannot animate between ${w.constructor.name} and ${F.name}, as the "to" prop suggests`)}const A=w.constructor;let N=Do(u),D=!1;if(!N){const F=k||!t6(this)&&p;(m||F)&&(D=Rc(qy(T),I),N=!D),(!Rc(a.immediate,x)&&!x||!Rc(g.decay,S)||!Rc(g.velocity,b))&&(N=!0)}if(D&&Yu(this)&&(a.changed&&!k?N=!0:N||this._stop(l)),!v&&((N||Do(l))&&(a.values=w.getPayload(),a.toValues=Do(u)?null:A==Gy?[1]:ns(I)),a.immediate!=x&&(a.immediate=x,!x&&!k&&this._set(l)),N)){const{onRest:F}=a;wt(pXe,B=>hq(this,e,B));const $=Na(this,z0(this,l));u1(this._pendingCalls,$),this._pendingCalls.add(n),a.changed&&vt.batchedUpdates(()=>{var B;a.changed=!k,F==null||F($,this),k?Cs(o.onRest,$):(B=a.onStart)==null||B.call(a,$,this)})}k&&this._set(T),v?n(Cce(e.to,e,this._state,this)):N?this._start():Yu(this)&&!m?this._pendingCalls.add(n):n(wce(T))}_focus(t){const e=this.animation;t!==e.to&&(eq(this)&&this._detach(),e.to=t,eq(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;Do(e)&&(Ev(e,this),RL(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;Do(t)&&Hy(t,this)}_set(t,e=!0){const n=ws(t);if(!be.und(n)){const r=Rl(this);if(!r||!Rc(n,r.getValue())){const i=wL(n);!r||r.constructor!=i?d9(this,i.create(n)):r.setValue(n),r&&vt.batchedUpdates(()=>{this._onChange(n,e)})}}return Rl(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,Y0(this,"onStart",Na(this,z0(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),Cs(this.animation.onChange,t,this)),Cs(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Rl(this).reset(ws(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),Yu(this)||(uq(this,!0),W0(this)||this._resume())}_resume(){za.skipAnimation?this.finish():E3.start(this)}_stop(t,e){if(Yu(this)){uq(this,!1);const n=this.animation;wt(n.values,i=>{i.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),By(this,{type:"idle",parent:this});const r=e?rg(this.get()):Na(this.get(),z0(this,t??n.to));u1(this._pendingCalls,r),n.changed&&(n.changed=!1,Y0(this,"onRest",r,this))}}};function z0(t,e){const n=qy(e),r=qy(t.get());return Rc(r,n)}function kce(t,e=t.loop,n=t.to){const r=Cs(e);if(r){const i=r!==!0&&h9(r),s=(i||t).reverse,o=!i||i.reset;return fC({...t,loop:e,default:!1,pause:void 0,to:!s||CL(n)?n:void 0,from:o?t.from:void 0,reset:o,...i})}}function fC(t){const{to:e,from:n}=t=h9(t),r=new Set;return be.obj(e)&&fq(e,r),be.obj(n)&&fq(n,r),t.keys=r.size?Array.from(r):null,t}function fq(t,e){Vl(t,(n,r)=>n!=null&&e.add(r))}var pXe=["onStart","onRest","onChange","onPause","onResume"];function hq(t,e,n){t.animation[n]=e[n]!==Sce(e,n)?bce(e[n],t.key):void 0}function Y0(t,e,...n){var r,i,s,o;(i=(r=t.animation)[e])==null||i.call(r,...n),(o=(s=t.defaultProps)[e])==null||o.call(s,...n)}var mXe=["onStart","onChange","onRest"],gXe=1,vXe=class{constructor(e,n){this.id=gXe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),n&&(this._flush=n),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((n,r)=>e[r]=n.get()),e}set(e){for(const n in e){const r=e[n];be.und(r)||this.springs[n].set(r)}}update(e){return e&&this.queue.push(fC(e)),this}start(e){let{queue:n}=this;return e?n=ns(e).map(fC):this.queue=[],this._flush?this._flush(this,n):(Ace(this,n),yXe(this,n))}stop(e,n){if(e!==!!e&&(n=e),n){const r=this.springs;wt(ns(n),i=>r[i].stop(!!e))}else Ky(this._state,this._lastAsyncId),this.each(r=>r.stop(!!e));return this}pause(e){if(be.und(e))this.start({pause:!0});else{const n=this.springs;wt(ns(e),r=>n[r].pause())}return this}resume(e){if(be.und(e))this.start({pause:!1});else{const n=this.springs;wt(ns(e),r=>n[r].resume())}return this}each(e){Vl(this.springs,e)}_onFrame(){const{onStart:e,onChange:n,onRest:r}=this._events,i=this._active.size>0,s=this._changed.size>0;(i&&!this._started||s&&!this._started)&&(this._started=!0,B1(e,([l,c])=>{c.value=this.get(),l(c,this,this._item)}));const o=!i&&this._started,a=s||o&&r.size?this.get():null;s&&n.size&&B1(n,([l,c])=>{c.value=a,l(c,this,this._item)}),o&&(this._started=!1,B1(r,([l,c])=>{c.value=a,l(c,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;vt.onFrame(this._onFrame)}};function yXe(t,e){return Promise.all(e.map(n=>xce(t,n))).then(n=>p9(t,n))}async function xce(t,e,n){const{keys:r,to:i,from:s,loop:o,onRest:a,onResolve:l}=e,c=be.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),s===!1&&(e.from=null);const u=be.arr(i)||be.fun(i)?i:void 0;u?(e.to=void 0,e.onRest=void 0,c&&(c.onRest=void 0)):wt(mXe,g=>{const S=e[g];if(be.fun(S)){const b=t._events[g];e[g]=({finished:w,cancelled:k})=>{const T=b.get(S);T?(w||(T.finished=!1),k&&(T.cancelled=!0)):b.set(S,{value:null,finished:w||!1,cancelled:k||!1})},c&&(c[g]=e[g])}});const f=t._state;e.pause===!f.paused?(f.paused=e.pause,u1(e.pause?f.pauseQueue:f.resumeQueue)):f.paused&&(e.pause=!0);const p=(r||Object.keys(t.springs)).map(g=>t.springs[g].start(e)),m=e.cancel===!0||Sce(e,"cancel")===!0;(u||m&&f.asyncId)&&p.push(Ece(++t._lastAsyncId,{props:e,state:f,actions:{pause:SL,resume:SL,start(g,S){m?(Ky(f,t._lastAsyncId),S(rg(t))):(g.onRest=a,S(Cce(u,g,f,t)))}}})),f.paused&&await new Promise(g=>{f.resumeQueue.add(g)});const v=p9(t,await Promise.all(p));if(o&&v.finished&&!(n&&v.noop)){const g=kce(e,o,i);if(g)return Ace(t,[g]),xce(t,g,!0)}return l&&vt.batchedUpdates(()=>l(v,t,t.item)),v}function _Xe(t,e){const n={...t.springs};return e&&wt(ns(e),r=>{be.und(r.keys)&&(r=fC(r)),be.obj(r.to)||(r={...r,to:void 0}),Lce(n,r,i=>Pce(i))}),bXe(t,n),n}function bXe(t,e){Vl(e,(n,r)=>{t.springs[r]||(t.springs[r]=n,Ev(n,t))})}function Pce(t,e){const n=new hXe;return n.key=t,e&&Ev(n,e),n}function Lce(t,e,n){e.keys&&wt(e.keys,r=>{(t[r]||(t[r]=n(r)))._prepareNode(e)})}function Ace(t,e){wt(e,n=>{Lce(t.springs,n,r=>Pce(r,t))})}var k3=({children:t,...e})=>{const n=_.useContext(hC),r=e.pause||!!n.pause,i=e.immediate||!!n.immediate;e=KYe(()=>({pause:r,immediate:i}),[r,i]);const{Provider:s}=hC;return _.createElement(s,{value:e},t)},hC=SXe(k3,{});k3.Provider=hC.Provider;k3.Consumer=hC.Consumer;function SXe(t,e){return Object.assign(t,_.createContext(e)),t.Provider._context=t,t.Consumer._context=t,t}var EXe=()=>{const t=[],e=function(r){GYe();const i=[];return wt(t,(s,o)=>{if(be.und(r))i.push(s.start());else{const a=n(r,s,o);a&&i.push(s.start(a))}}),i};e.current=t,e.add=function(r){t.includes(r)||t.push(r)},e.delete=function(r){const i=t.indexOf(r);~i&&t.splice(i,1)},e.pause=function(){return wt(t,r=>r.pause(...arguments)),this},e.resume=function(){return wt(t,r=>r.resume(...arguments)),this},e.set=function(r){wt(t,(i,s)=>{const o=be.fun(r)?r(s,i):r;o&&i.set(o)})},e.start=function(r){const i=[];return wt(t,(s,o)=>{if(be.und(r))i.push(s.start());else{const a=this._getProps(r,s,o);a&&i.push(s.start(a))}}),i},e.stop=function(){return wt(t,r=>r.stop(...arguments)),this},e.update=function(r){return wt(t,(i,s)=>i.update(this._getProps(r,i,s))),this};const n=function(r,i,s){return be.fun(r)?r(s,i):r};return e._getProps=n,e};function wXe(t,e,n){const r=be.fun(e)&&e,{reset:i,sort:s,trail:o=0,expires:a=!0,exitBeforeEnter:l=!1,onDestroyed:c,ref:u,config:f}=r?r():e,p=_.useMemo(()=>r||arguments.length==3?EXe():void 0,[]),m=ns(t),v=[],g=_.useRef(null),S=i?null:g.current;wm(()=>{g.current=v}),vce(()=>(wt(v,W=>{p==null||p.add(W.ctrl),W.ctrl.ref=p}),()=>{wt(g.current,W=>{W.expired&&clearTimeout(W.expirationId),sq(W.ctrl,p),W.ctrl.stop(!0)})}));const b=TXe(m,r?r():e,S),w=i&&g.current||[];wm(()=>wt(w,({ctrl:W,item:H,key:z})=>{sq(W,p),Cs(c,H,z)}));const k=[];if(S&&wt(S,(W,H)=>{W.expired?(clearTimeout(W.expirationId),w.push(W)):(H=k[H]=b.indexOf(W.key),~H&&(v[H]=W))}),wt(m,(W,H)=>{v[H]||(v[H]={key:b[H],item:W,phase:"mount",ctrl:new vXe},v[H].ctrl.item=W)}),k.length){let W=-1;const{leave:H}=r?r():e;wt(k,(z,K)=>{const V=S[K];~z?(W=v.indexOf(V),v[W]={...V,item:m[z]}):H&&v.splice(++W,0,V)})}be.fun(s)&&v.sort((W,H)=>s(W.item,H.item));let T=-o;const I=gce(),C=f9(e),x=new Map,A=_.useRef(new Map),N=_.useRef(!1);wt(v,(W,H)=>{const z=W.key,K=W.phase,V=r?r():e;let q,Z;const G=Cs(V.delay||0,z);if(K=="mount")q=V.enter,Z="enter";else{const Pe=b.indexOf(z)<0;if(K!="leave")if(Pe)q=V.leave,Z="leave";else if(q=V.update)Z="update";else return;else if(!Pe)q=V.enter,Z="enter";else return}if(q=Cs(q,W.item,H),q=be.obj(q)?h9(q):{to:q},!q.config){const Pe=f||C.config;q.config=Cs(Pe,W.item,H,Z)}T+=o;const Q={...C,delay:G+T,ref:u,immediate:V.immediate,reset:!1,...q};if(Z=="enter"&&be.und(Q.from)){const Pe=r?r():e,Te=be.und(Pe.initial)||S?Pe.from:Pe.initial;Q.from=Cs(Te,W.item,H)}const{onResolve:ge}=Q;Q.onResolve=Pe=>{Cs(ge,Pe);const Te=g.current,Re=Te.find(we=>we.key===z);if(Re&&!(Pe.cancelled&&Re.phase!="update")&&Re.ctrl.idle){const we=Te.every(ve=>ve.ctrl.idle);if(Re.phase=="leave"){const ve=Cs(a,Re.item);if(ve!==!1){const We=ve===!0?0:ve;if(Re.expired=!0,!we&&We>0){We<=2147483647&&(Re.expirationId=setTimeout(I,We));return}}}we&&Te.some(ve=>ve.expired)&&(A.current.delete(Re),l&&(N.current=!0),I())}};const _e=_Xe(W.ctrl,Q);Z==="leave"&&l?A.current.set(W,{phase:Z,springs:_e,payload:Q}):x.set(W,{phase:Z,springs:_e,payload:Q})});const D=_.useContext(k3),F=YYe(D),$=D!==F&&oXe(D);wm(()=>{$&&wt(v,W=>{W.ctrl.start({default:D})})},[D]),wt(x,(W,H)=>{if(A.current.size){const z=v.findIndex(K=>K.key===H.key);v.splice(z,1)}}),wm(()=>{wt(A.current.size?A.current:x,({phase:W,payload:H},z)=>{const{ctrl:K}=z;z.phase=W,p==null||p.add(K),$&&W=="enter"&&K.start({default:D}),H&&(aXe(K,H.ref),(K.ref||p)&&!N.current?K.update(H):(K.start(H),N.current&&(N.current=!1)))})},i?void 0:n);const B=W=>_.createElement(_.Fragment,null,v.map((H,z)=>{const{springs:K}=x.get(H)||H.ctrl,V=W({...K},H.item,H,z);return V&&V.type?_.createElement(V.type,{...V.props,key:be.str(H.key)||be.num(H.key)?H.key:H.ctrl.id,ref:V.ref}):V}));return p?[B,p]:B}var CXe=1;function TXe(t,{key:e,keys:n=e},r){if(n===null){const i=new Set;return t.map(s=>{const o=r&&r.find(a=>a.item===s&&a.phase!=="leave"&&!i.has(a));return o?(i.add(o),o.key):CXe++})}return be.und(n)?t:be.fun(n)?t.map(n):ns(n)}var RXe=class extends m9{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=jy(...e);const n=this._get(),r=wL(n);d9(this,r.create(n))}advance(t){const e=this._get(),n=this.get();Rc(e,n)||(Rl(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&pq(this._active)&&n6(this)}_get(){const t=be.arr(this.source)?this.source.map(ws):ns(ws(this.source));return this.calc(...t)}_start(){this.idle&&!pq(this._active)&&(this.idle=!1,wt(R3(this),t=>{t.done=!1}),za.skipAnimation?(vt.batchedUpdates(()=>this.advance()),n6(this)):E3.start(this))}_attach(){let t=1;wt(ns(this.source),e=>{Do(e)&&Ev(e,this),RL(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){wt(ns(this.source),t=>{Do(t)&&Hy(t,this)}),this._active.clear(),n6(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=ns(this.source).reduce((e,n)=>Math.max(e,(RL(n)?n.priority:0)+1),0))}};function IXe(t){return t.idle!==!1}function pq(t){return!t.size||Array.from(t).every(IXe)}function n6(t){t.idle||(t.idle=!0,wt(R3(t),e=>{e.done=!0}),By(t,{type:"idle",parent:t}))}za.assign({createStringInterpolator:pce,to:(t,e)=>new RXe(t,e)});var Oce=/^--/;function kXe(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!Oce.test(t)&&!(G1.hasOwnProperty(t)&&G1[t])?e+"px":(""+e).trim()}var mq={};function xXe(t,e){if(!t.nodeType||!t.setAttribute)return!1;const n=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{className:r,style:i,children:s,scrollTop:o,scrollLeft:a,viewBox:l,...c}=e,u=Object.values(c),f=Object.keys(c).map(p=>n||t.hasAttribute(p)?p:mq[p]||(mq[p]=p.replace(/([A-Z])/g,m=>"-"+m.toLowerCase())));s!==void 0&&(t.textContent=s);for(const p in i)if(i.hasOwnProperty(p)){const m=kXe(p,i[p]);Oce.test(p)?t.style.setProperty(p,m):t.style[p]=m}f.forEach((p,m)=>{t.setAttribute(p,u[m])}),r!==void 0&&(t.className=r),o!==void 0&&(t.scrollTop=o),a!==void 0&&(t.scrollLeft=a),l!==void 0&&t.setAttribute("viewBox",l)}var G1={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},PXe=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),LXe=["Webkit","Ms","Moz","O"];G1=Object.keys(G1).reduce((t,e)=>(LXe.forEach(n=>t[PXe(n,e)]=t[e]),t),G1);var AXe=/^(matrix|translate|scale|rotate|skew)/,OXe=/^(translate)/,MXe=/^(rotate|skew)/,r6=(t,e)=>be.num(t)&&t!==0?t+e:t,kE=(t,e)=>be.arr(t)?t.every(n=>kE(n,e)):be.num(t)?t===e:parseFloat(t)===e,NXe=class extends I3{constructor({x:t,y:e,z:n,...r}){const i=[],s=[];(t||e||n)&&(i.push([t||0,e||0,n||0]),s.push(o=>[`translate3d(${o.map(a=>r6(a,"px")).join(",")})`,kE(o,0)])),Vl(r,(o,a)=>{if(a==="transform")i.push([o||""]),s.push(l=>[l,l===""]);else if(AXe.test(a)){if(delete r[a],be.und(o))return;const l=OXe.test(a)?"px":MXe.test(a)?"deg":"";i.push(ns(o)),s.push(a==="rotate3d"?([c,u,f,p])=>[`rotate3d(${c},${u},${f},${r6(p,l)})`,kE(p,0)]:c=>[`${a}(${c.map(u=>r6(u,l)).join(",")})`,kE(c,a.startsWith("scale")?1:0)])}}),i.length&&(r.transform=new DXe(i,s)),super(r)}},DXe=class extends dce{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return wt(this.inputs,(n,r)=>{const i=ws(n[0]),[s,o]=this.transforms[r](be.arr(i)?i:n.map(ws));t+=" "+s,e=e&&o}),e?"none":t}observerAdded(t){t==1&&wt(this.inputs,e=>wt(e,n=>Do(n)&&Ev(n,this)))}observerRemoved(t){t==0&&wt(this.inputs,e=>wt(e,n=>Do(n)&&Hy(n,this)))}eventObserved(t){t.type=="change"&&(this._value=null),By(this,t)}},FXe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];za.assign({batchedUpdates:zg.unstable_batchedUpdates,createStringInterpolator:pce,colors:EYe});var UXe=tXe(FXe,{applyAnimatedValues:xXe,createAnimatedStyle:t=>new NXe(t),getComponentProps:({scrollTop:t,scrollLeft:e,...n})=>n}),Mce=UXe.animated;const jXe="_media_40njg_8",$Xe="_mirror_40njg_25",BXe="_bg_40njg_37",HXe="_avatar_40njg_45",VXe="_fg_40njg_70",GXe="_nameTag_40njg_84",qXe="_status_40njg_100",KXe="_reactions_40njg_119",WXe="_name_40njg_84",zXe="_errorIcon_40njg_138",wa={media:jXe,mirror:$Xe,bg:BXe,avatar:HXe,fg:VXe,nameTag:GXe,status:qXe,reactions:KXe,name:WXe,errorIcon:zXe},YXe="_reactionIndicatorWidget_14f9a_1",XXe="_reactionIndicatorWidgetLarge_14f9a_21",JXe="_reactionLarge_14f9a_28",ZXe="_reaction_14f9a_1",a2={reactionIndicatorWidget:YXe,reactionIndicatorWidgetLarge:XXe,reactionLarge:JXe,reaction:ZXe};function Nce({emoji:t,miniature:e,children:n}){const{t:r}=et();return E.jsxs("div",{className:Ne(a2.reactionIndicatorWidget,{[a2.reactionIndicatorWidgetLarge]:!e}),children:[E.jsx("div",{className:Ne(a2.reaction,{[a2.reactionLarge]:!e}),children:E.jsx("span",{role:"img","aria-label":r("common.reaction"),children:t})}),n]})}function QXe({raisedHandTime:t,miniature:e,showTimer:n,onClick:r}){const{t:i}=et(),[s,o]=_.useState(""),a=_.useMemo(()=>new Intl.DurationFormat(void 0,{minutesDisplay:"always",secondsDisplay:"always",hoursDisplay:"auto",style:"digital"}),[]),l=_.useCallback(u=>{r&&(u.preventDefault(),r())},[r]);if(_.useEffect(()=>{if(!t||!n)return;const u=()=>{const p=Math.ceil((new Date().getTime()-t.getTime())/1e3);o(a.format({seconds:p%60,minutes:Math.floor(p/60)}))};u();const f=setInterval(u,1e3);return()=>clearInterval(f)},[o,t,n,a]),!t)return;const c=E.jsx(Nce,{emoji:"✋",miniature:e,children:n&&E.jsx("p",{children:s})});return r?E.jsx("button",{"aria-label":i("action.lower_hand"),style:{display:"contents",background:"none"},onClick:l,children:c}):c}const eJe="_modal_13thw_8",tJe="_statsPill_13thw_12",gq={modal:eJe,statsPill:tJe},nJe=({audio:t,video:e,...n})=>{const[r,i]=_.useState(!1),[s,o]=_.useState("none"),a=c=>{i(!0),o(c)},l=()=>{i(!1),o("none")};return E.jsxs("div",{className:Ne(wa.nameTag,gq.statsPill),children:[E.jsx(ep,{title:"RTC Connection Stats",open:r,onDismiss:l,children:E.jsx("div",{className:gq.modal,children:E.jsx("pre",{children:s!=="none"&&JSON.stringify(s==="video"?e:t,null,2)})})}),t&&E.jsx("div",{children:E.jsx(Dt,{onClick:()=>a("audio"),size:"sm",kind:"tertiary",Icon:JO,children:"jitter"in t&&typeof t.jitter=="number"&&E.jsxs(ln,{as:"span",size:"xs",title:"jitter",children:[" ",(t.jitter*1e3).toFixed(0),"ms"]})})}),e&&E.jsx("div",{children:E.jsxs(Dt,{onClick:()=>a("video"),size:"sm",kind:"tertiary",Icon:Jne,children:[!!(e!=null&&e.framesPerSecond)&&E.jsxs(ln,{as:"span",size:"xs",title:"frame rate",children:[" ",e.framesPerSecond.toFixed(0),"fps"]}),"jitter"in e&&typeof e.jitter=="number"&&E.jsxs(ln,{as:"span",size:"xs",title:"jitter",children:[" ",(e.jitter*1e3).toFixed(0),"ms"]}),"frameHeight"in e&&typeof e.frameHeight=="number"&&"frameWidth"in e&&typeof e.frameWidth=="number"&&E.jsxs(ln,{as:"span",size:"xs",title:"frame size",children:[" ",e.frameWidth,"x",e.frameHeight]}),"qualityLimitationReason"in e&&typeof e.qualityLimitationReason=="string"&&e.qualityLimitationReason!=="none"&&E.jsxs(ln,{as:"span",size:"xs",title:"quality limitation reason",children:[" ",e.qualityLimitationReason]})]})})]})},$_=_.forwardRef(({className:t,style:e,targetWidth:n,targetHeight:r,video:i,videoFit:s,mirror:o,member:a,videoEnabled:l,unencryptedWarning:c,nameTagLeadingIcon:u,displayName:f,primaryButton:p,encryptionStatus:m,raisedHandTime:v,currentReaction:g,raisedHandOnClick:S,localParticipant:b,audioStreamStats:w,videoStreamStats:k,...T},I)=>{const{t:C}=et(),[x]=bn(gse),A=Math.round(Math.min(n,r)/2);return E.jsxs(Mce.div,{className:Ne(wa.media,t,{[wa.mirror]:o}),style:e,ref:I,"data-testid":"videoTile","data-video-fit":s,...T,children:[E.jsxs("div",{className:wa.bg,children:[E.jsx(lv,{id:(a==null?void 0:a.userId)??f,name:f,size:A,src:a==null?void 0:a.getMxcAvatarUrl(),className:wa.avatar,style:{display:i&&l?"none":"initial"}}),(i==null?void 0:i.publication)!==void 0&&E.jsx(rze,{trackRef:i,tabIndex:-1,disablePictureInPicture:!0,style:{display:i&&l?"block":"none"},"data-testid":"video"})]}),E.jsxs("div",{className:wa.fg,children:[E.jsxs("div",{className:wa.reactions,children:[E.jsx(QXe,{raisedHandTime:v,miniature:A<96,showTimer:x,onClick:S}),g&&E.jsx(Nce,{miniature:A<96,emoji:g.emoji})]}),!i&&!b&&E.jsx("div",{className:wa.status,children:C("video_tile.waiting_for_media")}),(w||k)&&E.jsx(nJe,{audio:w,video:k}),E.jsxs("div",{className:wa.nameTag,children:[u,E.jsx(ln,{as:"span",size:"sm",weight:"medium",className:wa.name,"data-testid":"name_tag",children:f}),c&&E.jsx(Vi,{label:C("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,children:E.jsx(oT,{width:20,height:20,className:wa.errorIcon,role:"img","aria-label":C("common.unencrypted")})})]}),p]})]})});$_.displayName="MediaView";const B_=(...t)=>_.useCallback(e=>t.forEach(n=>{typeof n=="function"?n(e):n!==null&&(n.current=e)}),t),g9=_.forwardRef(({vm:t,showSpeakingIndicators:e,locallyMuted:n,menuStart:r,menuEnd:i,className:s,displayName:o,...a},l)=>{const{toggleRaisedHand:c}=O8(),{t:u}=et(),f=Je(t.video$),p=Je(t.unencryptedWarning$),m=Je(t.encryptionStatus$),v=Je(t.audioStreamStats$),g=Je(t.videoStreamStats$),S=Je(t.audioEnabled$),b=Je(t.videoEnabled$),w=Je(t.speaking$),k=Je(t.cropVideo$),T=_.useCallback(H=>{H.preventDefault(),t.toggleFitContain()},[t]),I=Py(t.handRaised$),C=Py(t.reaction$),x=n?B5e:S?JO:Pne,A=u(n?"video_tile.muted_for_me":S?"microphone_on":"microphone_off"),[N,D]=_.useState(!1),F=E.jsxs(E.Fragment,{children:[r,E.jsx(YO,{Icon:wne,label:u("video_tile.change_fit_contain"),checked:k,onSelect:T}),i]}),$=t.local?()=>void c():void 0,B=e&&w,W=E.jsx($_,{ref:l,video:f,member:t.member,unencryptedWarning:p,encryptionStatus:m,videoEnabled:b,videoFit:k?"cover":"contain",className:Ne(s,c1.tile,{[c1.speaking]:B,[c1.handRaised]:!B&&I}),nameTagLeadingIcon:E.jsx(x,{width:20,height:20,"aria-label":A,"data-muted":n||!S,className:c1.muteIcon}),displayName:o,primaryButton:E.jsx($O,{open:N,onOpenChange:D,title:o,trigger:E.jsx("button",{"aria-label":u("common.options"),children:E.jsx(L5e,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:F}),raisedHandTime:I??void 0,currentReaction:C??void 0,raisedHandOnClick:$,localParticipant:t.local,audioStreamStats:v,videoStreamStats:g,...a});return E.jsx(axe,{title:o,trigger:W,hasAccessibleAlternative:!0,children:F})});g9.displayName="UserMediaTile";const Dce=_.forwardRef(({vm:t,onOpenProfile:e,...n},r)=>{const{t:i}=et(),s=Je(t.mirror$),o=Je(t.alwaysShow$),a=eu(o),l=_.useCallback(c=>{c.preventDefault(),t.setAlwaysShow(!a.current)},[t,a]);return E.jsx(g9,{ref:r,vm:t,locallyMuted:!1,mirror:s,menuStart:E.jsx(YO,{Icon:LPe,label:i("video_tile.always_show"),checked:o,onSelect:l}),menuEnd:e&&E.jsx(Eg,{Icon:zne,label:i("common.profile"),onSelect:e}),...n})});Dce.displayName="LocalUserMediaTile";const Fce=_.forwardRef(({vm:t,...e},n)=>{const{t:r}=et(),i=Je(t.locallyMuted$),s=Je(t.localVolume$),o=_.useCallback(u=>{u.preventDefault(),t.toggleLocallyMuted()},[t]),a=_.useCallback(u=>t.setLocalVolume(u),[t]),l=_.useCallback(()=>t.commitLocalVolume(),[t]),c=i?H5e:V5e;return E.jsx(g9,{ref:n,vm:t,locallyMuted:i,mirror:!1,menuStart:E.jsxs(E.Fragment,{children:[E.jsx(YO,{Icon:x5e,label:r("video_tile.mute_for_me"),checked:i,onSelect:o}),E.jsx(Eg,{as:"div",Icon:c,label:null,onSelect:null,children:E.jsx(soe,{className:c1.volumeSlider,label:r("video_tile.volume"),value:s,onValueChange:a,onValueCommit:l,min:0,max:1,step:.01})})]}),...e})});Fce.displayName="RemoteUserMediaTile";const Uce=_.forwardRef(({vm:t,onOpenProfile:e,...n},r)=>{const i=_.useRef(null),s=B_(i,r),o=Je(t.media$),a=Je(o.displayname$);return o instanceof Ug?E.jsx(Dce,{ref:s,vm:o,onOpenProfile:e,displayName:a,...n}):E.jsx(Fce,{ref:s,vm:o,displayName:a,...n})});Uce.displayName="GridTile";const rJe=({rageshakeRequestId:t,roomId:e,open:n,onDismiss:r})=>{const{t:i}=et(),{submitRageshake:s,sending:o,sent:a,error:l}=FT();return _.useEffect(()=>{a&&r()},[a,r]),E.jsxs(ep,{title:i("rageshake_request_modal.title"),open:n,onDismiss:r,children:[E.jsx(ln,{children:i("rageshake_request_modal.body")}),E.jsx(St,{children:E.jsx(Dt,{onClick:()=>void s({sendLogs:!0,rageshakeRequestId:t,roomId:e}),disabled:o,children:i(o?"rageshake_sending_logs":"rageshake_send_logs")})}),l&&E.jsx(St,{children:E.jsx(ff,{error:l})})]})};function vq(t){return new Worker(""+new URL("livekit-client.e2ee.worker-D7jue42X.js",import.meta.url).href,{name:t==null?void 0:t.name})}const iJe={audioPreset:nw.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[Ol.h180,Ol.h360],screenShareEncoding:HC.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:Ol.h720.encoding,backupCodec:{codec:"vp8",encoding:Ol.h720.encoding}},i6={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:Ol.h720.resolution},publishDefaults:iJe,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new RY,disconnectOnPageLeave:!0,webAudioMix:!1};function sJe(t){const[e,n]=_.useState(()=>{const i=t.getActiveFocus();return i&&mx(i)?i:void 0}),r=_.useCallback(()=>{const i=t.getActiveFocus();if(!(i&&!mx(i))&&!Eh(e,i)){const s=t.getOldestMembership();O.warn(`Got new active focus from membership: ${s==null?void 0:s.sender}/${s==null?void 0:s.deviceId}.
        Updating focus (focus switch) from ${JSON.stringify(e)} to ${JSON.stringify(i)}`),n(i)}},[e,t]);return _.useEffect(()=>(t.on(Ar.MembershipsChanged,r),()=>{t.off(Ar.MembershipsChanged,r)})),e}function oJe(){const[t,e]=_.useState(null),n=_.useMemo(()=>({showErrorBoundary:r=>e(r)}),[]);if(t)throw t;return n}const pt=t=>typeof t=="string",X0=()=>{let t,e;const n=new Promise((r,i)=>{t=r,e=i});return n.resolve=t,n.reject=e,n},yq=t=>t==null?"":""+t,aJe=(t,e,n)=>{t.forEach(r=>{e[r]&&(n[r]=e[r])})},lJe=/###/g,_q=t=>t&&t.indexOf("###")>-1?t.replace(lJe,"."):t,bq=t=>!t||pt(t),q1=(t,e,n)=>{const r=pt(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(bq(t))return{};const s=_q(r[i]);!t[s]&&n&&(t[s]=new n),Object.prototype.hasOwnProperty.call(t,s)?t=t[s]:t={},++i}return bq(t)?{}:{obj:t,k:_q(r[i])}},Sq=(t,e,n)=>{const{obj:r,k:i}=q1(t,e,Object);if(r!==void 0||e.length===1){r[i]=n;return}let s=e[e.length-1],o=e.slice(0,e.length-1),a=q1(t,o,Object);for(;a.obj===void 0&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),a=q1(t,o,Object),a!=null&&a.obj&&typeof a.obj[`${a.k}.${s}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${s}`]=n},cJe=(t,e,n,r)=>{const{obj:i,k:s}=q1(t,e,Object);i[s]=i[s]||[],i[s].push(n)},pC=(t,e)=>{const{obj:n,k:r}=q1(t,e);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},uJe=(t,e,n)=>{const r=pC(t,n);return r!==void 0?r:pC(e,n)},jce=(t,e,n)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?pt(t[r])||t[r]instanceof String||pt(e[r])||e[r]instanceof String?n&&(t[r]=e[r]):jce(t[r],e[r],n):t[r]=e[r]);return t},Zp=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var dJe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const fJe=t=>pt(t)?t.replace(/[&<>"'\/]/g,e=>dJe[e]):t;class hJe{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const pJe=[" ",",","?","!",";"],mJe=new hJe(20),gJe=(t,e,n)=>{e=e||"",n=n||"";const r=pJe.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(r.length===0)return!0;const i=mJe.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let s=!i.test(t);if(!s){const o=t.indexOf(n);o>0&&!i.test(t.substring(0,o))&&(s=!0)}return s},IL=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(n);let i=t;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let o,a="";for(let l=s;l<r.length;++l)if(l!==s&&(a+=n),a+=r[l],o=i[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<r.length-1)continue;s+=l-s+1;break}i=o}return i},mC=t=>t==null?void 0:t.replace("_","-"),vJe={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){var n,r;(r=(n=console==null?void 0:console[t])==null?void 0:n.apply)==null||r.call(n,console,e)}};class gC{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||vJe,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,r,i){return i&&!this.debug?null:(pt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new gC(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new gC(this.logger,e)}}var Dl=new gC;class x3{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(n)||0;this.observers[r].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,l]=o;for(let c=0;c<l;c++)a(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,l]=o;for(let c=0;c<l;c++)a.apply(a,[e,...r])})}}class Eq extends x3{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,r){var c,u;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],r&&(Array.isArray(r)?a.push(...r):pt(r)&&s?a.push(...r.split(s)):a.push(r)));const l=pC(this.data,a);return!l&&!n&&!r&&e.indexOf(".")>-1&&(e=a[0],n=a[1],r=a.slice(2).join(".")),l||!o||!pt(r)?l:IL((u=(c=this.data)==null?void 0:c[e])==null?void 0:u[n],r,s)}addResource(e,n,r,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let a=[e,n];r&&(a=a.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(a=e.split("."),i=n,n=a[1]),this.addNamespaces(n),Sq(this.data,a,i),s.silent||this.emit("added",e,n,r,i)}addResources(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in r)(pt(r[s])||Array.isArray(r[s]))&&this.addResource(e,n,s,r[s],{silent:!0});i.silent||this.emit("added",e,n,r)}addResourceBundle(e,n,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),i=r,r=n,n=a[1]),this.addNamespaces(n);let l=pC(this.data,a)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?jce(l,r,s):l={...l,...r},Sq(this.data,a,l),o.silent||this.emit("added",e,n,r)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var $ce={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,r,i){return t.forEach(s=>{var o;e=((o=this.processors[s])==null?void 0:o.process(e,n,r,i))??e}),e}};const wq={},Cq=t=>!pt(t)&&typeof t!="boolean"&&typeof t!="number";class vC extends x3{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),aJe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Dl.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,n);return(r==null?void 0:r.res)!==void 0}extractFromKey(e,n){let r=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let s=n.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!gJe(e,r,i);if(o&&!a){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:pt(s)?[s]:s};const c=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(c[0])>-1)&&(s=c.shift()),e=c.join(i)}return{key:e,namespaces:pt(s)?[s]:s}}translate(e,n,r){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],n),l=a[a.length-1],c=n.lng||this.language,u=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((c==null?void 0:c.toLowerCase())==="cimode"){if(u){const F=n.nsSeparator||this.options.nsSeparator;return i?{res:`${l}${F}${o}`,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:`${l}${F}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:o}const f=this.resolve(e,n);let p=f==null?void 0:f.res;const m=(f==null?void 0:f.usedKey)||o,v=(f==null?void 0:f.exactUsedKey)||o,g=["[object Number]","[object Function]","[object RegExp]"],S=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject,w=n.count!==void 0&&!pt(n.count),k=vC.hasDefaultValue(n),T=w?this.pluralResolver.getSuffix(c,n.count,n):"",I=n.ordinal&&w?this.pluralResolver.getSuffix(c,n.count,{ordinal:!1}):"",C=w&&!n.ordinal&&n.count===0,x=C&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${T}`]||n[`defaultValue${I}`]||n.defaultValue;let A=p;b&&!p&&k&&(A=x);const N=Cq(A),D=Object.prototype.toString.apply(A);if(b&&A&&N&&g.indexOf(D)<0&&!(pt(S)&&Array.isArray(A))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const F=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,A,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(f.res=F,f.usedParams=this.getUsedParamsDetails(n),f):F}if(s){const F=Array.isArray(A),$=F?[]:{},B=F?v:m;for(const W in A)if(Object.prototype.hasOwnProperty.call(A,W)){const H=`${B}${s}${W}`;k&&!p?$[W]=this.translate(H,{...n,defaultValue:Cq(x)?x[W]:void 0,joinArrays:!1,ns:a}):$[W]=this.translate(H,{...n,joinArrays:!1,ns:a}),$[W]===H&&($[W]=A[W])}p=$}}else if(b&&pt(S)&&Array.isArray(p))p=p.join(S),p&&(p=this.extendTranslation(p,e,n,r));else{let F=!1,$=!1;!this.isValidLookup(p)&&k&&(F=!0,p=x),this.isValidLookup(p)||($=!0,p=o);const W=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&$?void 0:p,H=k&&x!==p&&this.options.updateMissing;if($||F||H){if(this.logger.log(H?"updateKey":"missingKey",c,l,o,H?x:p),s){const q=this.resolve(o,{...n,keySeparator:!1});q&&q.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let z=[];const K=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&K&&K[0])for(let q=0;q<K.length;q++)z.push(K[q]);else this.options.saveMissingTo==="all"?z=this.languageUtils.toResolveHierarchy(n.lng||this.language):z.push(n.lng||this.language);const V=(q,Z,G)=>{var ge;const Q=k&&G!==p?G:W;this.options.missingKeyHandler?this.options.missingKeyHandler(q,l,Z,Q,H,n):(ge=this.backendConnector)!=null&&ge.saveMissing&&this.backendConnector.saveMissing(q,l,Z,Q,H,n),this.emit("missingKey",q,l,Z,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&w?z.forEach(q=>{const Z=this.pluralResolver.getSuffixes(q,n);C&&n[`defaultValue${this.options.pluralSeparator}zero`]&&Z.indexOf(`${this.options.pluralSeparator}zero`)<0&&Z.push(`${this.options.pluralSeparator}zero`),Z.forEach(G=>{V([q],o+G,n[`defaultValue${G}`]||x)})}):V(z,o,x))}p=this.extendTranslation(p,e,n,f,r),$&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${l}:${o}`),($||F)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${o}`:o,F?p:void 0))}return i?(f.res=p,f.usedParams=this.getUsedParamsDetails(n),f):p}extendTranslation(e,n,r,i,s){var c,u;var o=this;if((c=this.i18nFormat)!=null&&c.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const f=pt(e)&&(((u=r==null?void 0:r.interpolation)==null?void 0:u.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let p;if(f){const v=e.match(this.interpolator.nestingRegexp);p=v&&v.length}let m=r.replace&&!pt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,r.lng||this.language||i.usedLng,r),f){const v=e.match(this.interpolator.nestingRegexp),g=v&&v.length;p<g&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var v=arguments.length,g=new Array(v),S=0;S<v;S++)g[S]=arguments[S];return(s==null?void 0:s[0])===g[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${n[0]}`),null):o.translate(...g,n)},r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,l=pt(a)?[a]:a;return e!=null&&(l!=null&&l.length)&&r.applyPostProcessor!==!1&&(e=$ce.handle(l,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,i,s,o,a;return pt(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(r))return;const c=this.extractFromKey(l,n),u=c.key;i=u;let f=c.namespaces;this.options.fallbackNS&&(f=f.concat(this.options.fallbackNS));const p=n.count!==void 0&&!pt(n.count),m=p&&!n.ordinal&&n.count===0,v=n.context!==void 0&&(pt(n.context)||typeof n.context=="number")&&n.context!=="",g=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);f.forEach(S=>{var b,w;this.isValidLookup(r)||(a=S,!wq[`${g[0]}-${S}`]&&((b=this.utils)!=null&&b.hasLoadedNamespace)&&!((w=this.utils)!=null&&w.hasLoadedNamespace(a))&&(wq[`${g[0]}-${S}`]=!0,this.logger.warn(`key "${i}" for languages "${g.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),g.forEach(k=>{var C;if(this.isValidLookup(r))return;o=k;const T=[u];if((C=this.i18nFormat)!=null&&C.addLookupKeys)this.i18nFormat.addLookupKeys(T,u,k,S,n);else{let x;p&&(x=this.pluralResolver.getSuffix(k,n.count,n));const A=`${this.options.pluralSeparator}zero`,N=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(T.push(u+x),n.ordinal&&x.indexOf(N)===0&&T.push(u+x.replace(N,this.options.pluralSeparator)),m&&T.push(u+A)),v){const D=`${u}${this.options.contextSeparator}${n.context}`;T.push(D),p&&(T.push(D+x),n.ordinal&&x.indexOf(N)===0&&T.push(D+x.replace(N,this.options.pluralSeparator)),m&&T.push(D+A))}}let I;for(;I=T.pop();)this.isValidLookup(r)||(s=I,r=this.getResource(k,S,I,n))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,r){var s;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(s=this.i18nFormat)!=null&&s.getResource?this.i18nFormat.getResource(e,n,r,i):this.resourceStore.getResource(e,n,r,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!pt(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of n)delete i[s]}return i}static hasDefaultValue(e){const n="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&n===r.substring(0,n.length)&&e[r]!==void 0)return!0;return!1}}class Tq{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Dl.create("languageUtils")}getScriptPartFromCode(e){if(e=mC(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=mC(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(pt(e)&&e.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(e)[0]}catch{}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(r=>{if(n)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(r=>{if(n)return;const i=this.getLanguagePartFromCode(r);if(this.isSupportedCode(i))return n=i;n=this.options.supportedLngs.find(s=>{if(s===i)return s;if(!(s.indexOf("-")<0&&i.indexOf("-")<0)&&(s.indexOf("-")>0&&i.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===i||s.indexOf(i)===0&&i.length>1))return s})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),pt(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let r=e[n];return r||(r=e[this.getScriptPartFromCode(n)]),r||(r=e[this.formatLanguageCode(n)]),r||(r=e[this.getLanguagePartFromCode(n)]),r||(r=e.default),r||[]}toResolveHierarchy(e,n){const r=this.getFallbackCodes(n||this.options.fallbackLng||[],e),i=[],s=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return pt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):pt(e)&&s(this.formatLanguageCode(e)),r.forEach(o=>{i.indexOf(o)<0&&s(this.formatLanguageCode(o))}),i}}const Rq={zero:0,one:1,two:2,few:3,many:4,other:5},Iq={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class yJe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=Dl.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=mC(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let o;try{o=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Iq;if(!e.match(/-|_/))return Iq;const l=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(l,n)}return this.pluralRulesCache[s]=o,o}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),(r==null?void 0:r.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(i=>`${n}${i}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),r?r.resolvedOptions().pluralCategories.sort((i,s)=>Rq[i]-Rq[s]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",n,r))}}const kq=function(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=uJe(t,e,n);return!s&&i&&pt(n)&&(s=IL(t,n,r),s===void 0&&(s=IL(e,n,r))),s},s6=t=>t.replace(/\$/g,"$$$$");class _Je{constructor(){var n;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Dl.create("interpolator"),this.options=e,this.format=((n=e==null?void 0:e.interpolation)==null?void 0:n.format)||(r=>r),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:o,suffix:a,suffixEscaped:l,formatSeparator:c,unescapeSuffix:u,unescapePrefix:f,nestingPrefix:p,nestingPrefixEscaped:m,nestingSuffix:v,nestingSuffixEscaped:g,nestingOptionsSeparator:S,maxReplaces:b,alwaysFormat:w}=e.interpolation;this.escape=n!==void 0?n:fJe,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?Zp(s):o||"{{",this.suffix=a?Zp(a):l||"}}",this.formatSeparator=c||",",this.unescapePrefix=u?"":f||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=p?Zp(p):m||Zp("$t("),this.nestingSuffix=v?Zp(v):g||Zp(")"),this.nestingOptionsSeparator=S||",",this.maxReplaces=b||1e3,this.alwaysFormat=w!==void 0?w:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,r)=>(n==null?void 0:n.source)===r?(n.lastIndex=0,n):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,r,i){var m;let s,o,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=v=>{if(v.indexOf(this.formatSeparator)<0){const w=kq(n,l,v,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(w,void 0,r,{...i,...n,interpolationkey:v}):w}const g=v.split(this.formatSeparator),S=g.shift().trim(),b=g.join(this.formatSeparator).trim();return this.format(kq(n,l,S,this.options.keySeparator,this.options.ignoreJSONStructure),b,r,{...i,...n,interpolationkey:S})};this.resetRegExp();const u=(i==null?void 0:i.missingInterpolationHandler)||this.options.missingInterpolationHandler,f=((m=i==null?void 0:i.interpolation)==null?void 0:m.skipOnVariables)!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:v=>s6(v)},{regex:this.regexp,safeValue:v=>this.escapeValue?s6(this.escape(v)):s6(v)}].forEach(v=>{for(a=0;s=v.regex.exec(e);){const g=s[1].trim();if(o=c(g),o===void 0)if(typeof u=="function"){const b=u(e,s,i);o=pt(b)?b:""}else if(i&&Object.prototype.hasOwnProperty.call(i,g))o="";else if(f){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),o="";else!pt(o)&&!this.useRawValueToEscape&&(o=yq(o));const S=v.safeValue(o);if(e=e.replace(s[0],S),f?(v.regex.lastIndex+=o.length,v.regex.lastIndex-=s[0].length):v.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,s,o;const a=(l,c)=>{const u=this.nestingOptionsSeparator;if(l.indexOf(u)<0)return l;const f=l.split(new RegExp(`${u}[ ]*{`));let p=`{${f[1]}`;l=f[0],p=this.interpolate(p,o);const m=p.match(/'/g),v=p.match(/"/g);(((m==null?void 0:m.length)??0)%2===0&&!v||v.length%2!==0)&&(p=p.replace(/'/g,'"'));try{o=JSON.parse(p),c&&(o={...c,...o})}catch(g){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,g),`${l}${u}${p}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l};for(;i=this.nestingRegexp.exec(e);){let l=[];o={...r},o=o.replace&&!pt(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let c=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const u=i[1].split(this.formatSeparator).map(f=>f.trim());i[1]=u.shift(),l=u,c=!0}if(s=n(a.call(this,i[1].trim(),o),o),s&&i[0]===e&&!pt(s))return s;pt(s)||(s=yq(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),c&&(s=l.reduce((u,f)=>this.format(u,f,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const bJe=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(o=>{if(o){const[a,...l]=o.split(":"),c=l.join(":").trim().replace(/^'+|'+$/g,""),u=a.trim();n[u]||(n[u]=c),c==="false"&&(n[u]=!1),c==="true"&&(n[u]=!0),isNaN(c)||(n[u]=parseInt(c,10))}})}return{formatName:e,formatOptions:n}},Qp=t=>{const e={};return(n,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const o=r+JSON.stringify(s);let a=e[o];return a||(a=t(mC(r),i),e[o]=a),a(n)}};class SJe{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Dl.create("formatter"),this.options=e,this.formats={number:Qp((n,r)=>{const i=new Intl.NumberFormat(n,{...r});return s=>i.format(s)}),currency:Qp((n,r)=>{const i=new Intl.NumberFormat(n,{...r,style:"currency"});return s=>i.format(s)}),datetime:Qp((n,r)=>{const i=new Intl.DateTimeFormat(n,{...r});return s=>i.format(s)}),relativetime:Qp((n,r)=>{const i=new Intl.RelativeTimeFormat(n,{...r});return s=>i.format(s,r.range||"day")}),list:Qp((n,r)=>{const i=new Intl.ListFormat(n,{...r});return s=>i.format(s)})},this.init(e)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=n.interpolation.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=Qp(n)}format(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=n.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(a=>a.indexOf(")")>-1)){const a=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,a)].join(this.formatSeparator)}return s.reduce((a,l)=>{var f;const{formatName:c,formatOptions:u}=bJe(l);if(this.formats[c]){let p=a;try{const m=((f=i==null?void 0:i.formatParams)==null?void 0:f[i.interpolationkey])||{},v=m.locale||m.lng||i.locale||i.lng||r;p=this.formats[c](a,v,{...u,...i,...m})}catch(m){this.logger.warn(m)}return p}else this.logger.warn(`there was no format function for ${c}`);return a},e)}}const EJe=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class wJe extends x3{constructor(e,n,r){var s,o;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=Dl.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],(o=(s=this.backend)==null?void 0:s.init)==null||o.call(s,r,i.backend,i)}queueLoad(e,n,r,i){const s={},o={},a={},l={};return e.forEach(c=>{let u=!0;n.forEach(f=>{const p=`${c}|${f}`;!r.reload&&this.store.hasResourceBundle(c,f)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?o[p]===void 0&&(o[p]=!0):(this.state[p]=1,u=!1,o[p]===void 0&&(o[p]=!0),s[p]===void 0&&(s[p]=!0),l[f]===void 0&&(l[f]=!0)))}),u||(a[c]=!0)}),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}loaded(e,n,r){const i=e.split("|"),s=i[0],o=i[1];n&&this.emit("failedLoading",s,o,n),!n&&r&&this.store.addResourceBundle(s,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&r&&(this.state[e]=0);const a={};this.queue.forEach(l=>{cJe(l.loaded,[s],o),EJe(l,e),n&&l.errors.push(n),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(c=>{a[c]||(a[c]={});const u=l.loaded[c];u.length&&u.forEach(f=>{a[c][f]===void 0&&(a[c][f]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(l=>!l.done)}read(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:r,tried:i,wait:s,callback:o});return}this.readingCalls++;const a=(c,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const f=this.waitingReads.shift();this.read(f.lng,f.ns,f.fcName,f.tried,f.wait,f.callback)}if(c&&u&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,r,i+1,s*2,o)},s);return}o(c,u)},l=this.backend[r].bind(this.backend);if(l.length===2){try{const c=l(e,n);c&&typeof c.then=="function"?c.then(u=>a(null,u)).catch(a):a(null,c)}catch(c){a(c)}return}return l(e,n,a)}prepareLoading(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();pt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),pt(n)&&(n=[n]);const s=this.queueLoad(e,n,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,r){this.prepareLoading(e,n,{},r)}reload(e,n,r){this.prepareLoading(e,n,{reload:!0},r)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${s} for language ${i} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${s} for language ${i}`,a),this.loaded(e,o,a)})}saveMissing(e,n,r,i,s){var l,c,u,f,p;let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((c=(l=this.services)==null?void 0:l.utils)!=null&&c.hasLoadedNamespace&&!((f=(u=this.services)==null?void 0:u.utils)!=null&&f.hasLoadedNamespace(n))){this.logger.warn(`did not save key "${r}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if((p=this.backend)!=null&&p.create){const m={...o,isUpdate:s},v=this.backend.create.bind(this.backend);if(v.length<6)try{let g;v.length===5?g=v(e,n,r,i,m):g=v(e,n,r,i),g&&typeof g.then=="function"?g.then(S=>a(null,S)).catch(a):a(null,g)}catch(g){a(g)}else v(e,n,r,i,a,m)}!e||!e[0]||this.store.addResource(e[0],n,r,i)}}}const xq=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),pt(t[1])&&(e.defaultValue=t[1]),pt(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(r=>{e[r]=n[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Pq=t=>{var e,n;return pt(t.ns)&&(t.ns=[t.ns]),pt(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),pt(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),((n=(e=t.supportedLngs)==null?void 0:e.indexOf)==null?void 0:n.call(e,"cimode"))<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t},l2=()=>{},CJe=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class Wy extends x3{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=Pq(e),this.services={},this.logger=Dl,this.modules={external:[]},CJe(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(r=n,n={}),n.defaultNS==null&&n.ns&&(pt(n.ns)?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const i=xq();this.options={...i,...this.options,...Pq(n)},this.options.interpolation={...i.interpolation,...this.options.interpolation},n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const s=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?Dl.init(s(this.modules.logger),this.options):Dl.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=SJe;const f=new Tq(this.options);this.store=new Eq(this.options.resources,this.options);const p=this.services;p.logger=Dl,p.resourceStore=this.store,p.languageUtils=f,p.pluralResolver=new yJe(f,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),u&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(p.formatter=s(u),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new _Je(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new wJe(s(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(m){for(var v=arguments.length,g=new Array(v>1?v-1:0),S=1;S<v;S++)g[S-1]=arguments[S];e.emit(m,...g)}),this.modules.languageDetector&&(p.languageDetector=s(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=s(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new vC(this.services,this.options),this.translator.on("*",function(m){for(var v=arguments.length,g=new Array(v>1?v-1:0),S=1;S<v;S++)g[S-1]=arguments[S];e.emit(m,...g)}),this.modules.external.forEach(m=>{m.init&&m.init(this)})}if(this.format=this.options.interpolation.format,r||(r=l2),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=function(){return e.store[u](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=function(){return e.store[u](...arguments),e}});const l=X0(),c=()=>{const u=(f,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(p),r(f,p)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),l}loadResources(e){var s,o;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l2;const i=pt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if((i==null?void 0:i.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const a=[],l=c=>{if(!c||c==="cimode")return;this.services.languageUtils.toResolveHierarchy(c).forEach(f=>{f!=="cimode"&&a.indexOf(f)<0&&a.push(f)})};i?l(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(u=>l(u)),(o=(s=this.options.preload)==null?void 0:s.forEach)==null||o.call(s,c=>l(c)),this.services.backendConnector.load(a,this.options.ns,c=>{!c&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(c)})}else r(null)}reloadResources(e,n,r){const i=X0();return typeof e=="function"&&(r=e,e=void 0),typeof n=="function"&&(r=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),r||(r=l2),this.services.backendConnector.reload(e,n,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&$ce.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const r=this.languages[n];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,n){var r=this;this.isLanguageChangingTo=e;const i=X0();this.emit("languageChanging",e);const s=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,c)=>{c?(s(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,i.resolve(function(){return r.t(...arguments)}),n&&n(l,function(){return r.t(...arguments)})},a=l=>{var u,f;!e&&!l&&this.services.languageDetector&&(l=[]);const c=pt(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);c&&(this.language||s(c),this.translator.language||this.translator.changeLanguage(c),(f=(u=this.services.languageDetector)==null?void 0:u.cacheUserLanguage)==null||f.call(u,c)),this.loadResources(c,p=>{o(p,c)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),i}getFixedT(e,n,r){var i=this;const s=function(o,a){let l;if(typeof a!="object"){for(var c=arguments.length,u=new Array(c>2?c-2:0),f=2;f<c;f++)u[f-2]=arguments[f];l=i.options.overloadTranslationOptionHandler([o,a].concat(u))}else l={...a};l.lng=l.lng||s.lng,l.lngs=l.lngs||s.lngs,l.ns=l.ns||s.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||r||s.keyPrefix);const p=i.options.keySeparator||".";let m;return l.keyPrefix&&Array.isArray(o)?m=o.map(v=>`${l.keyPrefix}${p}${v}`):m=l.keyPrefix?`${l.keyPrefix}${p}${o}`:o,i.t(m,l)};return pt(e)?s.lng=e:s.lngs=e,s.ns=n,s.keyPrefix=r,s}t(){var i;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=this.translator)==null?void 0:i.translate(...n)}exists(){var i;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=this.translator)==null?void 0:i.exists(...n)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(a,l)=>{const c=this.services.backendConnector.state[`${a}|${l}`];return c===-1||c===0||c===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!i||o(s,e)))}loadNamespaces(e,n){const r=X0();return this.options.ns?(pt(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),n&&n(i)}),r):(n&&n(),Promise.resolve())}loadLanguages(e,n){const r=X0();pt(e)&&(e=[e]);const i=this.options.preload||[],s=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return s.length?(this.options.preload=i.concat(s),this.loadResources(o=>{r.resolve(),n&&n(o)}),r):(n&&n(),Promise.resolve())}dir(e){var i,s;if(e||(e=this.resolvedLanguage||(((i=this.languages)==null?void 0:i.length)>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=((s=this.services)==null?void 0:s.languageUtils)||new Tq(xq());return n.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new Wy(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l2;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new Wy(i);if((e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(a=>{s[a]=this[a]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const a=Object.keys(this.store.data).reduce((l,c)=>(l[c]={...this.store.data[c]},Object.keys(l[c]).reduce((u,f)=>(u[f]={...l[c][f]},u),{})),{});s.store=new Eq(a,i),s.services.resourceStore=s.store}return s.translator=new vC(s.services,i),s.translator.on("*",function(a){for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];s.emit(a,...c)}),s.init(i,n),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ki=Wy.createInstance();ki.createInstance=Wy.createInstance;ki.createInstance;ki.dir;ki.init;ki.loadResources;ki.reloadResources;ki.use;ki.changeLanguage;ki.getFixedT;const Ya=ki.t;ki.exists;ki.setDefaultNamespace;ki.hasLoadedNamespace;ki.loadNamespaces;ki.loadLanguages;var v9=(t=>(t.MISSING_MATRIX_RTC_FOCUS="MISSING_MATRIX_RTC_FOCUS",t.CONNECTION_LOST_ERROR="CONNECTION_LOST_ERROR",t.MEMBERSHIP_MANAGER_UNRECOVERABLE="MEMBERSHIP_MANAGER_UNRECOVERABLE",t.INSUFFICIENT_CAPACITY_ERROR="INSUFFICIENT_CAPACITY_ERROR",t.E2EE_NOT_SUPPORTED="E2EE_NOT_SUPPORTED",t.OPEN_ID_ERROR="OPEN_ID_ERROR",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t))(v9||{}),xE=(t=>(t.CONFIGURATION_ISSUE="CONFIGURATION_ISSUE",t.NETWORK_CONNECTIVITY="NETWORK_CONNECTIVITY",t.RTC_SESSION_FAILURE="RTC_SESSION_FAILURE",t.CLIENT_CONFIGURATION="CLIENT_CONFIGURATION",t.UNKNOWN="UNKNOWN",t))(xE||{});class tc extends Error{constructor(e,n,r,i,s){super(e,{cause:s}),this.localisedTitle=e,this.localisedMessage=i,this.category=r,this.code=n}}class TJe extends tc{constructor(e){super(Ya("error.call_is_not_supported"),"MISSING_MATRIX_RTC_FOCUS","CONFIGURATION_ISSUE",Ya("error.matrix_rtc_focus_missing",{domain:e,brand:"Element Call",errorCode:"MISSING_MATRIX_RTC_FOCUS"})),this.domain=e}}class Bce extends tc{constructor(){super(Ya("error.connection_lost"),"CONNECTION_LOST_ERROR","NETWORK_CONNECTIVITY",Ya("error.connection_lost_description"))}}class RJe extends tc{constructor(e,n){super("RTCSession Error",e,"RTC_SESSION_FAILURE",n)}}class IJe extends tc{constructor(){super(Ya("error.e2ee_unsupported"),"E2EE_NOT_SUPPORTED","CLIENT_CONFIGURATION",Ya("error.e2ee_unsupported_description"))}}class y9 extends tc{constructor(e){super(Ya("error.generic"),"UNKNOWN_ERROR","UNKNOWN",e.message,e)}}class Hce extends tc{constructor(e){super(Ya("error.generic"),"OPEN_ID_ERROR","CONFIGURATION_ISSUE",void 0,e)}}class kJe extends tc{constructor(){super(Ya("error.insufficient_capacity"),"INSUFFICIENT_CAPACITY_ERROR","UNKNOWN",Ya("error.insufficient_capacity_description"))}}function xJe(t,e){return t===void 0&&e===void 0?!0:t===void 0||e===void 0?!1:t.jwt===e.jwt&&t.url===e.url}function PJe(t,e){const[n,r]=_.useState(void 0),i=sJe(e),{showErrorBoundary:s}=oJe();return _.useEffect(()=>{i?LJe(t,i).then(o=>{r(o)},o=>{s(new Hce(o)),O.error("Failed to get SFU config",o)}):r(void 0)},[t,i,s]),n}async function LJe(t,e){let n;try{n=await kqe(async()=>t.getOpenIdToken())}catch(r){throw new Hce(r instanceof Error?r:new Error("Unknown error"))}O.debug("Got openID token",n);try{O.info(`Trying to get JWT from call's active focus URL of ${e.livekit_service_url}...`);const r=await AJe(t,e.livekit_service_url,e.livekit_alias,n);return O.info("Got JWT from call's active focus URL."),r}catch(r){O.warn(`Failed to get JWT from RTC session's active focus URL of ${e.livekit_service_url}.`,r);return}}async function AJe(t,e,n,r){try{const i=await fetch(e+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:n,openid_token:r,device_id:t.getDeviceId()})});if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}catch(i){throw new Error("SFU Config fetch failed with exception "+i)}}class OJe{constructor(e=!1){this.aborted=e}abort(){this.aborted=!0}isAborted(){return this.aborted}}var kL=(t=>(t.ECSwitchingFocus="ec_switching_focus",t.ECWaiting="ec_waiting",t))(kL||{});function c2(t){return!!(t!=null&&t.url)&&!!(t!=null&&t.jwt)}async function MJe(t,e,n,r,i){if(t.localParticipant.getTrackPublication(ue.Source.Microphone)){O.warn("Pre-creating audio track but participant already appears to have an microphone track: this shouldn't happen!"),YSe("Pre-creating audio track but participant already appears to have an microphone track!");return}O.info("Pre-creating microphone track");let s;try{const o=await t.localParticipant.createTracks({audio:{deviceId:r}});if(o.length<1?O.info("Tried to pre-create local audio track but got no tracks"):s=o[0],i.isAborted()){O.info("[Lifecycle] Signal Aborted: Pre-created audio track but connection aborted"),s==null||s.stop();return}O.info("Pre-created microphone track")}catch(o){O.error("Failed to pre-create microphone track",o)}if(!n&&(await(s==null?void 0:s.mute()),i.isAborted())){O.info("[Lifecycle] Signal Aborted: Pre-created audio track but connection aborted"),s==null||s.stop();return}if(t.localParticipant.getTrackPublication(ue.Source.Microphone)){O.warn("Pre-created audio track but participant already appears to have an microphone track: this shouldn't happen!"),s==null||s.stop();return}O.info("[Lifecycle] Connecting & publishing");try{if(await Vce(t,e,s,[]),i.isAborted()){O.info("[Lifecycle] Signal Aborted: Connected but operation was cancelled. Force disconnect"),t==null||t.disconnect().catch(o=>{O.error("Failed to disconnect from SFU",o)});return}}catch(o){throw s==null||s.stop(),O.debug("Stopped precreated audio tracks."),o}}async function Vce(t,e,n,r){const i=xt.instance.eventCallConnectDuration;i.cacheConnectStart(),t.once(ae.SignalConnected,i.cacheWsConnect);try{O.info(`[Lifecycle] Connecting to livekit room ${e.url} ...`),await t.connect(e.url,e.jwt,{peerConnectionTimeout:window.peerConnectionTimeout??45e3,websocketTimeout:window.websocketTimeout??45e3}),O.info("[Lifecycle] ... connected to livekit room")}catch(s){throw O.error("[Lifecycle] Failed to connect",s),s instanceof dn&&(s.status===503||s.status===200||s.status===429)?new kJe:s}t.off(ae.SignalConnected,i.cacheWsConnect),i.track({log:!0}),n&&(O.info("Publishing precreated mic track"),await t.localParticipant.publishTrack(n,{source:ue.Source.Microphone})),O.info(`Publishing ${r.length} precreated screenshare tracks`);for(const s of r)t.localParticipant.publishTrack(s,{source:ue.Source.ScreenShare}).catch(o=>{O.error("Failed to publish screenshare track",o)})}function NJe(t,e,n,r){const[i,s]=_.useState(r&&n?n.state:"ec_waiting"),[o,a]=_.useState(!1),[l,c]=_.useState(!1),[u,f]=_.useState(null);if(u!==null)throw u;const p=_.useCallback(S=>{S==kt.Connected&&a(!1),s(S)},[]);_.useEffect(()=>{const S=n;return n&&n.on(ae.ConnectionStateChanged,p),()=>{S&&S.off(ae.ConnectionStateChanged,p)}},[n,p]);const m=_.useCallback(async()=>{const S=[];for(const b of n.localParticipant.videoTrackPublications.values())if(b.track&&b.source==ue.Source.ScreenShare){const w=b.track.mediaStreamTrack.clone();w.enabled=!0,S.push(w)}a(!0),await(n==null?void 0:n.disconnect()),c(!0);try{await Vce(n,r,void 0,S)}finally{c(!1)}},[n,r]),v=_.useRef(Object.assign({},r)),g=_.useRef(new Set);return _.useEffect(()=>{const S=g.current;return()=>{S.forEach(b=>{b.abort()})}},[]),_.useEffect(()=>{var S;if(c2(r)&&c2(v.current)&&!xJe(v.current,r))O.info(`SFU config changed! URL was ${(S=v.current)==null?void 0:S.url} now ${r==null?void 0:r.url}`),m().catch(b=>{O.error("Failed to switch focus",b)});else if(!c2(v.current)&&c2(r)){c(!0);const b=new OJe;g.current.add(b),MJe(n,r,e,t,b).catch(w=>{w instanceof tc?f(w):w instanceof Error?f(new y9(w)):O.error("Failed to connect to SFU",w)}).finally(()=>{g.current.delete(b),c(!1)})}v.current=Object.assign({},r)},[r,n,t,e,m]),o?"ec_switching_focus":l?kt.Connecting:i}class DJe extends oX{constructor(){super({ratchetWindowSize:10,keyringSize:256}),this.onEncryptionKeyChanged=(e,n,r)=>{crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"]).then(i=>{var s;this.onSetEncryptionKey(i,r,n),O.debug(`Sent new key to livekit room=${(s=this.rtcSession)==null?void 0:s.room.roomId} participantId=${r} encryptionKeyIndex=${n}`)},i=>{var s;O.error(`Failed to create key material from buffer for livekit room=${(s=this.rtcSession)==null?void 0:s.room.roomId} participantId=${r} encryptionKeyIndex=${n}`,i)})}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(Ar.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(Ar.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession.reemitEncryptionKeys()}}function FJe(t,e,n,r){const{controlledAudioDevices:i}=sa(),s=_.useMemo(()=>{if(r.kind!==zt.NONE){if(r.kind===zt.PER_PARTICIPANT)return O.info("Created MatrixKeyProvider (per participant)"),{keyProvider:new DJe,worker:new vq};if(r.kind===zt.SHARED_KEY&&r.secret)return O.info("Created ExternalE2EEKeyProvider (shared key)"),{keyProvider:new K0e,worker:new vq}}},[r]);_.useEffect(()=>{r.kind===zt.NONE||!s||(r.kind===zt.PER_PARTICIPANT?s.keyProvider.setRTCSession(t):r.kind===zt.SHARED_KEY&&r.secret&&s.keyProvider.setKey(r.secret).catch(b=>{O.error("Failed to set shared key for E2EE",b)}))},[s,r,t]);const o=_.useRef(e),a=hf(),l=_.useRef(a),{processor:c}=m3(),u=ef(()=>c),f=_.useMemo(()=>({...i6,videoCaptureDefaults:{...i6.videoCaptureDefaults,deviceId:l.current.videoInput.selectedId,processor:u},audioCaptureDefaults:{...i6.audioCaptureDefaults,deviceId:l.current.audioInput.selectedId},audioOutput:{deviceId:l.current.audioOutput.selectedId},e2ee:s}),[s,u]),p=_.useRef(!1),m=_.useRef(!1),v=_.useRef({audio:o.current.audio.enabled,video:o.current.video.enabled}),g=_.useMemo(()=>{O.info("[LivekitRooms] Create LiveKit room with options",f);const b=new iu(f);return b.setE2EEEnabled(r.kind!==zt.NONE).catch(w=>{O.error("Failed to set E2EE enabled on room",w)}),b},[f,r]);ile(Je(Fh(b=>Uy(b.pipe(Me(([w])=>w.localParticipant)),ue.Source.Camera).pipe(Me(w=>{var T;const k=(T=w==null?void 0:w.publication)==null?void 0:T.track;return k instanceof hg?k:null})),[g])));const S=NJe(l.current.audioInput.selectedId,o.current.audio.enabled,g,n);return _.useEffect(()=>{if(g!==void 0&&S===kt.Connected){const b=g.localParticipant;v.current={audio:e.audio.enabled,video:e.video.enabled};let w;(T=>{T[T.Microphone=0]="Microphone",T[T.Camera=1]="Camera"})(w||(w={}));const k=async(T,I)=>{var N,D,F,$;if(T>10){O.error("Stop trying to sync the input device with current mute state after 10 failed tries");return}let C,x,A;switch(I){case 0:C=b.isMicrophoneEnabled,x=v.current.audio,A=p.current;break;case 1:C=b.isCameraEnabled,x=v.current.video,A=m.current;break}if(C!==x&&!A)try{let B;switch(I){case 0:p.current=!0,B=await b.setMicrophoneEnabled(v.current.audio,g.options.audioCaptureDefaults),p.current=!1;break;case 1:m.current=!0,B=await b.setCameraEnabled(v.current.video,g.options.videoCaptureDefaults),m.current=!1;break}if(B)await new Promise(W=>setTimeout(W,100)),await k(T+1,I);else throw new Error("track with new mute state could not be published")}catch(B){B.name==="NotAllowedError"?(O.error("Fatal error while syncing mute state: resetting",B),I===0?(p.current=!1,(D=(N=e.audio).setEnabled)==null||D.call(N,!1)):(m.current=!1,($=(F=e.video).setEnabled)==null||$.call(F,!1))):(O.error("Failed to sync audio mute state with LiveKit (will retry to sync in 1s):",B),setTimeout(()=>{k(T+1,I).catch(W=>{O.error(`Failed to sync ${w[I]} mute state with LiveKit iterCount=${T+1}`,W)})},1e3))}};k(0,0).catch(T=>{O.error("Failed to sync audio mute state with LiveKit",T)}),k(0,1).catch(T=>{O.error("Failed to sync video mute state with LiveKit",T)})}},[g,e,S]),_.useEffect(()=>{if(g!==void 0&&S===kt.Connected&&!i){const b=(w,k)=>{var I,C,x,A;const T=k.selectedId;if(T==="default"&&w==="audioinput"&&((I=g.options.audioCaptureDefaults)==null?void 0:I.deviceId)==="default"){const N=(C=Array.from(g.localParticipant.audioTrackPublications.values()).find(D=>D.source===ue.Source.Microphone))==null?void 0:C.track;N&&N.mediaStreamTrack.readyState!=="ended"&&k.selectedGroupId!==N.mediaStreamTrack.getSettings().groupId&&((A=(x=g.localParticipant.getTrackPublication(ue.Source.Microphone))==null?void 0:x.audioTrack)==null||A.restartTrack().catch(D=>{O.error("Failed to restart audio device track",D)}))}else T!==void 0&&g.getActiveDevice(w)!==T&&g.switchActiveDevice(w,T).catch(N=>O.error(`Failed to sync ${w} device with LiveKit`,N))};b("audioinput",a.audioInput),b("audiooutput",a.audioOutput),b("videoinput",a.videoInput)}},[g,a,S,i]),{connState:S,livekitRoom:g}}function UJe(){_.useEffect(()=>{if("wakeLock"in navigator){let t=!0,e=null;const n=()=>{document.visibilityState==="visible"&&navigator.wakeLock.request("screen").then(r=>{e=r,t||e.release().catch(i=>O.warn("Can't release wake lock",i))},r=>{O.warn("Can't acquire wake lock",r)})};return n(),document.addEventListener("visibilitychange",n),()=>{t=!1,e!==null&&e.release().catch(r=>O.warn("Can't release wake lock",r)),document.removeEventListener("visibilitychange",n)}}},[])}const jJe="_toggle_z1rxf_8",$Je={toggle:jJe},BJe=({layout:t,setLayout:e,className:n,onTouchEnd:r})=>{const{t:i}=et(),s=_.useCallback(o=>e(o.target.value),[e]);return E.jsxs("div",{className:Ne($Je.toggle,n),children:[E.jsx(Vi,{label:i("layout_spotlight_label"),children:E.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:t==="spotlight",onChange:s,onTouchEnd:r})}),E.jsx(D5e,{"aria-hidden":!0,width:24,height:24}),E.jsx(Vi,{label:i("layout_grid_label"),children:E.jsx("input",{type:"radio",name:"layout",value:"grid",checked:t==="grid",onChange:s,onTouchEnd:r})}),E.jsx(C5e,{"aria-hidden":!0,width:24,height:24})]})};let HJe=0;function VJe(){return(HJe++).toString()}class Gce extends b3{constructor(e){super(),this.media$=e,this.id=VJe()}}class GJe extends b3{constructor(e,n){super(),this.media$=e,this.maximised$=n}}function qJe(t,e){return{[Symbol.iterator](){const n=t[Symbol.iterator](),r=e[Symbol.iterator]();return{next(){let i;do{if(i=n.next(),!i.done&&i.value!==void 0)return i;const s=r.next();if(!s.done)return s}while(!i.done);return i}}}}}function u2(t){return t.map(e=>{var n;return((n=e.media.member)==null?void 0:n.rawDisplayName)??"[👻]"})}let PE=!1;x8.value$.subscribe(t=>PE=t);class KJe{get media(){return this.media$.value}set media(e){this.media$.next(e)}get maximised(){return this.maximised$.value}set maximised(e){this.maximised$.next(e)}constructor(e,n){this.media$=new Gi(e),this.maximised$=new Gi(n),this.vm=new GJe(this.media$,this.maximised$)}destroy(){this.vm.destroy()}}class Lq{get media(){return this.media$.value}set media(e){this.media$.next(e)}constructor(e){this.media$=new Gi(e),this.vm=new Gce(this.media$)}destroy(){this.vm.destroy()}}class yC{constructor(e,n,r){var i;this.spotlight=e,this.grid=n,this.generation=r,this.spotlightTile=(i=this.spotlight)==null?void 0:i.vm,this.gridTiles=this.grid.map(({vm:s})=>s),this.gridTilesByMedia=new Map(this.grid.map(({vm:s,media:o})=>[o,s]))}static empty(){return new yC(null,[],0)}from(e){return new WJe(this.spotlight,this.grid,(n,r)=>new yC(n,r,this.generation+1),e,this.generation)}}class WJe{constructor(e,n,r,i,s){var o;this.prevSpotlight=e,this.prevGrid=n,this.construct=r,this.visibleTiles=i,this.generation=s,this.spotlight=null,this.prevSpotlightSpeaker=((o=this.prevSpotlight)==null?void 0:o.media.length)===1&&"speaking"in this.prevSpotlight.media[0]&&this.prevSpotlight.media[0],this.prevGridByMedia=new Map(this.prevGrid.map((a,l)=>[a.media,[a,l]])),this.numGridEntries=0,this.stationaryGridEntries=new Array(this.prevGrid.length),this.visibleGridEntries=[],this.invisibleGridEntries=[]}registerSpotlight(e,n){if(PE&&O.debug(`[TileStore, ${this.generation}] register spotlight: ${e.map(r=>{var i;return((i=r.member)==null?void 0:i.rawDisplayName)??"[👻]"})}`),this.spotlight!==null)throw new Error("Spotlight already set");if(this.numGridEntries>0)throw new Error("Spotlight must be registered before grid tiles");this.prevSpotlight===null?this.spotlight=new KJe(e,n):(this.spotlight=this.prevSpotlight,this.spotlight.media=e,this.spotlight.maximised=n)}registerGridTile(e){var r;if(PE&&O.debug(`[TileStore, ${this.generation}] register grid tile: ${((r=e.member)==null?void 0:r.rawDisplayName)??"[👻]"}`),this.spotlight!==null){if(!e.local&&this.spotlight.media.includes(e))return;if(e===this.prevSpotlightSpeaker&&this.spotlight.media.length===1&&"speaking"in this.spotlight.media[0]&&this.prevSpotlightSpeaker!==this.spotlight.media[0]){const i=this.prevGridByMedia.get(this.spotlight.media[0]);if(i!==void 0){const[s,o]=i,a=o<this.visibleTiles,l=this.numGridEntries<this.visibleTiles;a===l?(this.stationaryGridEntries[o]=s,s.media=e,this.prevGridByMedia.delete(this.spotlight.media[0]),this.prevGridByMedia.set(e,i)):(l?this.visibleGridEntries:this.invisibleGridEntries).push(new Lq(e)),this.numGridEntries++;return}}}const n=this.prevGridByMedia.get(e);if(n===void 0)(this.numGridEntries<this.visibleTiles?this.visibleGridEntries:this.invisibleGridEntries).push(new Lq(e));else{const[i,s]=n,o=s<this.visibleTiles,a=this.numGridEntries<this.visibleTiles;o===a?this.stationaryGridEntries[s]=i:(a?this.visibleGridEntries:this.invisibleGridEntries).push(i)}this.numGridEntries++}build(){const e=[...qJe(this.stationaryGridEntries,[...this.visibleGridEntries,...this.invisibleGridEntries])];PE&&(O.debug(`[TileStore, ${this.generation}] stationary: ${u2(this.stationaryGridEntries)}`),O.debug(`[TileStore, ${this.generation}] visible: ${u2(this.visibleGridEntries)}`),O.debug(`[TileStore, ${this.generation}] invisible: ${u2(this.invisibleGridEntries)}`),O.debug(`[TileStore, ${this.generation}] result: ${u2(e)}`)),this.spotlight===null&&this.prevSpotlight!==null&&this.prevSpotlight.destroy();const n=new Set(e);for(const r of this.prevGrid)n.has(r)||r.destroy();return this.construct(this.spotlight,e)}}function zJe(t,e,n,r){const i=r.from(e);t.spotlight!==void 0&&i.registerSpotlight(t.spotlight,t.type==="spotlight-portrait");for(const o of t.grid)i.registerGridTile(o);const s=i.build();return[{type:t.type,spotlight:s.spotlightTile,grid:s.gridTiles,setVisibleTiles:n},s]}function YJe(t,e){const n=e.from(1);n.registerSpotlight(t.spotlight,!0),t.pip!==void 0&&n.registerGridTile(t.pip);const r=n.build();return[{type:t.type,spotlight:r.spotlightTile,pip:r.gridTiles[0]},r]}function XJe(t,e){const n=e.from(2);n.registerGridTile(t.local),n.registerGridTile(t.remote);const r=n.build();return[{type:t.type,local:r.gridTilesByMedia.get(t.local),remote:r.gridTilesByMedia.get(t.remote)},r]}function JJe(t,e){const n=e.from(0);n.registerSpotlight(t.spotlight,!0);const r=n.build();return[{type:t.type,spotlight:r.spotlightTile},r]}function ZJe(t){const e=t.pipe(Ll());return e.pipe(p$e(n=>xy(bd(n?1e3:6e4),e.pipe(Ga(r=>r!==n)))),yn(!1),Ll())}function Aq(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const J0=new Map;function xL(t){if(J0.has(t))return J0.get(t);const e=wd(t);return J0.size>500&&J0.clear(),J0.set(t,e),e}function QJe(t,e,n){const{rawDisplayName:r,userId:i}=t;if(!r||r===i)return!1;const s=xL(r);return s?/@.+:.+/.test(r)||/[\u200E\u200F\u202A-\u202F]/.test(r)?!0:e.map(o=>o.sender&&n.getMember(o.sender)).filter(o=>!!o).filter(o=>o.userId!==i).some(o=>xL(qce(o,!1))===s):!1}function qce(t,e){const{rawDisplayName:n,userId:r}=t;if(!n||n===r)return r;const i=ME(n);return e?i+" ("+r+")":xL(n)?i:r}const eZe=3e3,tZe=3,o6=4e3;class d2{constructor(e,n,r,i,s,o,a,l){this.id=e,this.scope=new Zle,this.participant$=new Gi(r),r!=null&&r.isLocal?this.vm=new Ug(this.id,n,this.participant$.asObservable(),i,s,o,a,l):this.vm=new pYe(e,n,this.participant$.asObservable(),i,s,o,a,l),this.speaker$=ZJe(this.vm.speaking$).pipe(this.scope.state()),this.presenter$=this.participant$.pipe(jt(c=>(c&&D8(c,se.TrackPublished,se.TrackUnpublished,se.LocalTrackPublished,se.LocalTrackUnpublished).pipe(Me(u=>u.isScreenShareEnabled)))??At(!1)),this.scope.state())}updateParticipant(e){this.participant$.value!==e&&this.participant$.next(e)}destroy(){this.scope.end(),this.vm.destroy()}}class Oq{constructor(e,n,r,i,s,o){this.participant$=new Gi(r),this.vm=new Em(e,n,this.participant$.asObservable(),i,s,o,r.isLocal)}destroy(){this.vm.destroy()}}function Mq(t,e){let n=t.sender+":"+t.deviceId;if(!t.sender)return{id:n,member:void 0};t.sender===e.client.getUserId()&&t.deviceId===e.client.getDeviceId()&&(n="local");const r=e.getMember(t.sender)??void 0;return{id:n,member:r}}class nZe extends b3{constructor(e,n,r,i,s,o){super(),this.matrixRTCSession=e,this.livekitRoom=n,this.encryptionSystem=r,this.connectionState$=i,this.handsRaisedSubject$=s,this.reactionsSubject$=o,this.localVideo$=Uy(At(this.livekitRoom.localParticipant),ue.Source.Camera).pipe(Me(a=>{var c;const l=(c=a==null?void 0:a.publication)==null?void 0:c.track;return l instanceof hg?l:null})),this.rawRemoteParticipants$=LHe(this.livekitRoom).pipe(this.scope.state()),this.remoteParticipantHolds$=this.connectionState$.pipe(x$e(this.rawRemoteParticipants$),C_(([a,l])=>a===kL.ECSwitchingFocus?zw(At({hold:l}),r$e([bd(eZe),this.connectionState$.pipe(Ga(c=>c!==kL.ECSwitchingFocus),j5(1))]).pipe(Me(()=>({unhold:l})))):Ww),yL([],(a,l)=>"hold"in l?[l.hold,...a]:a.filter(c=>c!==l.unhold))),this.remoteParticipants$=Gn([this.rawRemoteParticipants$,this.remoteParticipantHolds$],(a,l)=>{const c=[...a],u=new Set(c.map(f=>f.identity));for(const f of l)for(const p of f)u.has(p.identity)||(c.push(p),u.add(p.identity));return c}),this.memberDisplaynames$=xy(Nl(this.matrixRTCSession,Ar.MembershipsChanged),Nl(this.matrixRTCSession.room,gt.Members)).pipe(yn(null),Me(()=>{const a=new Map,{room:l,memberships:c}=this.matrixRTCSession;for(const u of c){const f=`${u.sender}:${u.deviceId}`,{member:p}=Mq(u,l);if(!p){O.error("Could not find member for media id:",f);continue}const m=QJe(p,c,l);a.set(f,qce(p,m))}return a}),this.scope.state()),this.mediaItems$=Gn([this.remoteParticipants$,F8(this.livekitRoom.localParticipant),fse.value$,Nl(this.matrixRTCSession,Ar.MembershipsChanged).pipe(yn(null)),hse.value$]).pipe(yc((a,[l,{participant:c},u,f,p])=>{const m=new Map((function*(){const S=this.matrixRTCSession.room;for(const b of this.matrixRTCSession.memberships){const{member:w,id:k}=Mq(b,S),T=`${b.sender}:${b.deviceId}`;let I;k==="local"?I=c:I=l.find(C=>C.identity===k),w||O.error("Could not find member for media id: ",k);for(let C=0;C<1+u;C++){const x=`${k}:${C}`;let A=a.get(x);if(A&&A instanceof d2&&(A.updateParticipant(I),A.vm.member===void 0&&(A=void 0)),yield[x,A??new d2(x,w,I,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Me(N=>N.get(T)??"[👻]")),this.handsRaised$.pipe(Me(N=>{var D;return((D=N[T])==null?void 0:D.time)??null})),this.reactions$.pipe(Me(N=>N[T]??void 0)))],I!=null&&I.isScreenShareEnabled){const N=`${x}:screen-share`;yield[N,a.get(N)??new Oq(N,w,I,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Me(D=>D.get(T)??"[👻]")))]}}}}).bind(this)()),v=p?new Map((function*(){for(const S of l)for(let b=0;b<1+u;b++){const w=S.identity+":"+b;if(!m.has(w)){const k=w;yield[k,a.get(k)??new d2(k,void 0,S,this.encryptionSystem,this.livekitRoom,this.memberDisplaynames$.pipe(Me(T=>T.get(S.identity)??"[👻]")),At(null),At(null))]}}}).bind(this)()):new Map;v.size>0&&O.debug("Added NonMember items: ",v);const g=new Map([...v.entries(),...m.entries()]);for(const[S,b]of a)g.has(S)||b.destroy();return g},new Map),Me(a=>[...a.values()]),hYe(a=>{for(const l of a)l.destroy()}),this.scope.state()),this.userMedia$=this.mediaItems$.pipe(Me(a=>a.filter(l=>l instanceof d2))),this.memberChanges$=this.userMedia$.pipe(Me(a=>a.map(l=>l.id))).pipe(yc((a,l)=>{const c=a.ids.filter(f=>!l.includes(f)),u=l.filter(f=>!a.ids.includes(f));return{ids:l,joined:u,left:c}},{ids:[],joined:[],left:[]})),this.screenShares$=this.mediaItems$.pipe(Me(a=>a.filter(l=>l instanceof Oq)),this.scope.state()),this.spotlightSpeaker$=this.userMedia$.pipe(jt(a=>a.length===0?At([]):Gn(a.map(l=>l.vm.speaking$.pipe(Me(c=>[l,c]))))),yc((a,l)=>{var f,p,m;const[c,u]=!(a!=null&&a.vm.local)&&l.find(([v])=>v===a)||[];return u?c:((f=l.find(([v,g])=>!v.vm.local&&g))==null?void 0:f[0])??c??((p=l.find(([v])=>!v.vm.local))==null?void 0:p[0])??((m=l.find(([v])=>v.vm.local))==null?void 0:m[0])},null),Me(a=>(a==null?void 0:a.vm)??null),this.scope.state()),this.grid$=this.userMedia$.pipe(jt(a=>{const l=a.map(c=>Gn([c.speaker$,c.presenter$,c.vm.videoEnabled$,c.vm.handRaised$,c.vm instanceof Ug?c.vm.alwaysShow$:At(!1)],(u,f,p,m,v)=>{let g;return c.vm.local?g=v?0:6:f?g=1:u?g=2:m?g=3:p?g=4:g=5,[c,g]}));return l.length===0?At([]):Gn(l,(...c)=>c.sort(([,u],[,f])=>u-f).map(([u])=>u.vm))}),Ll(Aq),this.scope.state()),this.spotlight$=this.screenShares$.pipe(jt(a=>a.length>0?At(a.map(l=>l.vm)):this.spotlightSpeaker$.pipe(Me(l=>l?[l]:[]))),Ll(Aq),this.scope.state()),this.pip$=Gn([this.screenShares$,this.spotlightSpeaker$,this.mediaItems$]).pipe(jt(([a,l,c])=>{if(a.length>0)return this.spotlightSpeaker$;if(!l||l.local)return At(null);const u=c.find(p=>p.vm instanceof Ug),f=u==null?void 0:u.vm;return f?f.alwaysShow$.pipe(Me(p=>p?f:null)):At(null)}),this.scope.state()),this.hasRemoteScreenShares$=this.spotlight$.pipe(Me(a=>a.some(l=>!l.local&&l instanceof Em)),Ll()),this.pipEnabled$=um.pipe(yn(!1)),this.naturalWindowMode$=Nl(window,"resize").pipe(yn(null),Me(()=>{const a=window.innerHeight,l=window.innerWidth;return a<=400&&l<=340?"pip":a<=600?"flat":l<=600?"narrow":"normal"}),this.scope.state()),this.windowMode$=this.pipEnabled$.pipe(jt(a=>a?At("pip"):this.naturalWindowMode$)),this.spotlightExpandedToggle$=new Yr,this.spotlightExpanded$=this.spotlightExpandedToggle$.pipe(yL(!1,a=>!a),this.scope.state()),this.gridModeUserSelection$=new Yr,this.gridMode$=this.gridModeUserSelection$.pipe(yn(null),jt(a=>(a==="spotlight"?Ww:Gn([this.hasRemoteScreenShares$,this.windowMode$]).pipe(w$e(a===null?0:1),Me(([l,c])=>l||c==="flat"?"spotlight":"grid"))).pipe(yn(a??"grid"))),this.scope.state()),this.gridLayoutMedia$=Gn([this.grid$,this.spotlight$],(a,l)=>({type:"grid",spotlight:l.some(c=>c instanceof Em)?l:void 0,grid:a})),this.spotlightLandscapeLayoutMedia$=Gn([this.grid$,this.spotlight$],(a,l)=>({type:"spotlight-landscape",spotlight:l,grid:a})),this.spotlightPortraitLayoutMedia$=Gn([this.grid$,this.spotlight$],(a,l)=>({type:"spotlight-portrait",spotlight:l,grid:a})),this.spotlightExpandedLayoutMedia$=Gn([this.spotlight$,this.pip$],(a,l)=>({type:"spotlight-expanded",spotlight:a,pip:l??void 0})),this.oneOnOneLayoutMedia$=this.mediaItems$.pipe(Me(a=>{var u,f;if(a.length!==2)return null;const l=(u=a.find(p=>p.vm.local))==null?void 0:u.vm,c=(f=a.find(p=>!p.vm.local))==null?void 0:f.vm;return!c||!l?null:{type:"one-on-one",local:l,remote:c}})),this.pipLayoutMedia$=this.spotlight$.pipe(Me(a=>({type:"pip",spotlight:a}))),this.layoutMedia$=this.windowMode$.pipe(jt(a=>{switch(a){case"normal":return this.gridMode$.pipe(jt(l=>{switch(l){case"grid":return this.oneOnOneLayoutMedia$.pipe(jt(c=>c===null?this.gridLayoutMedia$:At(c)));case"spotlight":return this.spotlightExpanded$.pipe(jt(c=>c?this.spotlightExpandedLayoutMedia$:this.spotlightLandscapeLayoutMedia$))}}));case"narrow":return this.oneOnOneLayoutMedia$.pipe(jt(l=>l===null?Gn([this.grid$,this.spotlight$],(c,u)=>c.length>tZe||u.some(f=>f instanceof Em)?this.spotlightPortraitLayoutMedia$:this.gridLayoutMedia$).pipe(C$e()):this.spotlightExpandedLayoutMedia$));case"flat":return this.gridMode$.pipe(jt(l=>{switch(l){case"grid":return this.spotlightLandscapeLayoutMedia$;case"spotlight":return this.spotlightExpandedLayoutMedia$}}));case"pip":return this.pipLayoutMedia$}}),this.scope.state()),this.visibleTiles$=new Yr,this.setVisibleTiles=a=>this.visibleTiles$.next(a),this.layoutInternals$=Gn([this.layoutMedia$,this.visibleTiles$.pipe(yn(0),Ll())]).pipe(yc(({tiles:a},[l,c])=>{let u,f;switch(l.type){case"grid":case"spotlight-landscape":case"spotlight-portrait":[u,f]=zJe(l,c,this.setVisibleTiles,a);break;case"spotlight-expanded":[u,f]=YJe(l,a);break;case"one-on-one":[u,f]=XJe(l,a);break;case"pip":[u,f]=JJe(l,a);break}return{layout:u,tiles:f}},{layout:null,tiles:yC.empty()}),this.scope.state()),this.layout$=this.layoutInternals$.pipe(Me(({layout:a})=>a),this.scope.state()),this.tileStoreGeneration$=this.layoutInternals$.pipe(Me(({tiles:a})=>a.generation),this.scope.state()),this.showSpotlightIndicators$=this.layout$.pipe(Me(a=>a.type!=="grid"),this.scope.state()),this.showSpeakingIndicators$=this.layout$.pipe(jt(a=>{switch(a.type){case"spotlight-landscape":case"spotlight-portrait":return a.spotlight.media$.pipe(Me(l=>l.some(c=>c instanceof Em)));case"spotlight-expanded":case"one-on-one":return At(!1);default:return At(!0)}}),this.scope.state()),this.toggleSpotlightExpanded$=this.windowMode$.pipe(jt(a=>a==="normal"?this.layout$.pipe(Me(l=>l.type==="spotlight-landscape"||l.type==="spotlight-expanded")):At(!1)),Ll(),Me(a=>a?()=>this.spotlightExpandedToggle$.next():null),this.scope.state()),this.screenTap$=new Yr,this.controlsTap$=new Yr,this.screenHover$=new Yr,this.screenUnhover$=new Yr,this.showHeader$=this.windowMode$.pipe(Me(a=>a!=="pip"&&a!=="flat"),this.scope.state()),this.showFooter$=this.windowMode$.pipe(jt(a=>{switch(a){case"pip":return At(!1);case"normal":case"narrow":return At(!0);case"flat":return jze()?At(!0):xy(this.screenTap$.pipe(Me(()=>"tap screen")),this.controlsTap$.pipe(Me(()=>"tap controls")),this.screenHover$.pipe(Me(()=>"hover"))).pipe(T$e((l,c)=>{switch(c){case"tap screen":return l?At(!1):bd(o6).pipe(Me(()=>!1),yn(!0));case"tap controls":return bd(o6).pipe(Me(()=>!1),yn(!0));case"hover":return f$e(bd(o6),this.screenUnhover$.pipe(j5(1))).pipe(Me(()=>!1),yn(!0))}},!1),yn(!1))}}),this.scope.state()),this.reactions$=this.reactionsSubject$.pipe(Me(a=>Object.fromEntries(Object.entries(a).map(([l,{reactionOption:c}])=>[l,c])))),this.handsRaised$=this.handsRaisedSubject$.pipe(),this.visibleReactions$=vse.value$.pipe(jt(a=>a?this.reactions$:At({})),yc((a,l)=>{var u;const c=[];for(const[f,p]of Object.entries(l)){const m=((u=a.find(v=>v.sender===f&&v.emoji))==null?void 0:u.startX)??Math.ceil(Math.random()*80)+10;c.push({sender:f,emoji:p.emoji,startX:m})}return c},[])),this.audibleReactions$=P8.value$.pipe(jt(a=>a?this.reactions$:At({})),Me(a=>Object.values(a).map(l=>l.name)),yc((a,l)=>({playing:l.filter(c=>a.playing.includes(c)||a.newSounds.includes(c)),newSounds:l.filter(c=>!a.playing.includes(c)&&!a.newSounds.includes(c))}),{playing:[],newSounds:[]}),Me(a=>a.newSounds)),this.newHandRaised$=this.handsRaised$.pipe(Me(a=>Object.keys(a).length),yc((a,l)=>({value:l,playSounds:l>a.value}),{value:0,playSounds:!1}),Ga(a=>a.playSounds)),this.newScreenShare$=this.screenShares$.pipe(Me(a=>a.length),yc((a,l)=>({value:l,playSounds:l>a.value}),{value:0,playSounds:!1}),Ga(a=>a.playSounds))}setGridMode(e){this.gridModeUserSelection$.next(e)}tapScreen(){this.screenTap$.next()}tapControls(){this.controlsTap$.next()}hoverScreen(){this.screenHover$.next()}unhoverScreen(){this.screenUnhover$.next()}}function rZe(t,e,n){return Math.max(e,Math.min(t,n))}const pi={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function Nq(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function Dq(t,e,n,r=.15){return r===0?rZe(t,e,n):t<e?-Nq(e-t,n-e,r)+e:t>n?+Nq(t-n,n-e,r)+n:t}function iZe(t,[e,n],[r,i]){const[[s,o],[a,l]]=t;return[Dq(e,s,o,r),Dq(n,a,l,i)]}function sZe(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function oZe(t){var e=sZe(t,"string");return typeof e=="symbol"?e:String(e)}function Xi(t,e,n){return e=oZe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Fq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function er(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Fq(Object(n),!0).forEach(function(r){Xi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Kce={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Uq(t){return t?t[0].toUpperCase()+t.slice(1):""}const aZe=["enter","leave"];function lZe(t=!1,e){return t&&!aZe.includes(e)}function cZe(t,e="",n=!1){const r=Kce[t],i=r&&r[e]||e;return"on"+Uq(t)+Uq(i)+(lZe(n,i)?"Capture":"")}const uZe=["gotpointercapture","lostpointercapture"];function dZe(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=uZe.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function fZe(t,e=""){const n=Kce[t],r=n&&n[e]||e;return t+r}function P3(t){return"touches"in t}function Wce(t){return P3(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function hZe(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function pZe(t){return t.type==="touchend"||t.type==="touchcancel"?t.changedTouches:t.targetTouches}function zce(t){return P3(t)?pZe(t)[0]:t}function mZe(t){return hZe(t).map(e=>e.identifier)}function a6(t){const e=zce(t);return P3(t)?e.identifier:e.pointerId}function jq(t){const e=zce(t);return[e.clientX,e.clientY]}function gZe(t){var e,n;const{scrollX:r,scrollY:i,scrollLeft:s,scrollTop:o}=t.currentTarget;return[(e=r??s)!==null&&e!==void 0?e:0,(n=i??o)!==null&&n!==void 0?n:0]}function vZe(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s})}return e}function _C(t,...e){return typeof t=="function"?t(...e):t}function yZe(){}function _Ze(...t){return t.length===0?yZe:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function $q(t,e){return Object.assign({},e,t||{})}const bZe=32;class SZe{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:i}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?_C(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:i}=this;n.args=this.args;let s=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,vZe(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const C=n._delta.map(Math.abs);pi.addTo(n._distance,C)}this.axisIntent&&this.axisIntent(e);const[o,a]=n._movement,[l,c]=r.threshold,{_step:u,values:f}=n;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=l&&f[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&f[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const p=[0,0];if(r.hasCustomTransform){const[C,x]=f;p[0]=u[0]!==!1?C-u[0]:0,p[1]=u[1]!==!1?x-u[1]:0}else p[0]=u[0]!==!1?o-u[0]:0,p[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(p);const m=n.offset,v=n._active&&!n._blocked||n.active;v&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=_C(r.bounds,n)),this.setup&&this.setup()),n.movement=p,this.computeOffset()));const[g,S]=n.offset,[[b,w],[k,T]]=n._bounds;n.overflow=[g<b?-1:g>w?1:0,S<k?-1:S>T?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const I=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=iZe(n._bounds,n.offset,I),n.delta=pi.sub(n.offset,m),this.computeMovement(),v&&(!n.last||s>bZe)){n.delta=pi.sub(n.offset,m);const C=n.delta.map(Math.abs);pi.addTo(n.distance,C),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&s>0&&(n.velocity=[C[0]/s,C[1]/s],n.timeDelta=s)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(er(er(er({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function EZe([t,e],n){const r=Math.abs(t),i=Math.abs(e);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class Yce extends SZe{constructor(...e){super(...e),Xi(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=pi.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=pi.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[Wce(e)]:r.axisThreshold;n.axis=EZe(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const wZe=t=>t,Bq=.15,Xce={enabled(t=!0){return t},eventOptions(t,e,n){return er(er({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[Bq,Bq];case!1:return[0,0];default:return pi.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return pi.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||wZe},threshold(t){return pi.toVector(t,0)}},CZe=0,wv=er(er({},Xce),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=CZe){return t},bounds(t={}){if(typeof t=="function")return s=>wv.bounds(t(s));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),Hq={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};class TZe extends Yce{constructor(...e){super(...e),Xi(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const n=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:n.left-r.left+e.offset[0],right:n.right-r.right+e.offset[0],top:n.top-r.top+e.offset[1],bottom:n.bottom-r.bottom+e.offset[1]};e._bounds=wv.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const n=this.config,r=this.state;if(e.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(e.buttons):n.pointerButtons!==-1&&n.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);n.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&r._pointerActive)&&(this.start(e),this.setupPointer(e),r._pointerId=a6(e),r._pointerActive=!0,this.computeValues(jq(e)),this.computeInitial(),n.preventScrollAxis&&Wce(e)!=="mouse"?(r._active=!1,this.setupScrollPrevention(e)):n.delay>0?(this.setupDelayTrigger(e),n.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const n=this.state,r=this.config;if(!n._pointerActive)return;const i=a6(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;const s=jq(e);if(document.pointerLockElement===e.target?n._delta=[e.movementX,e.movementY]:(n._delta=pi.sub(s,n._values),this.computeValues(s)),pi.addTo(n._movement,n._delta),this.compute(e),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const n=this.state,r=this.config;if(!n._active||!n._pointerActive)return;const i=a6(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=n._distance;if(n.tap=s<=r.tapsThreshold&&o<=r.tapsThreshold,n.tap&&r.filterTaps)n._force=!0;else{const[a,l]=n._delta,[c,u]=n._movement,[f,p]=r.swipe.velocity,[m,v]=r.swipe.distance,g=r.swipe.duration;if(n.elapsedTime<g){const S=Math.abs(a/n.timeDelta),b=Math.abs(l/n.timeDelta);S>f&&Math.abs(c)>m&&(n.swipe[0]=Math.sign(a)),b>p&&Math.abs(u)>v&&(n.swipe[1]=Math.sign(l))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const n=this.config,r=n.device;n.pointerLock&&e.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,RZe(e);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const n=Hq[e.key];if(n){const r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=n(this.config.keyboardDisplacement,i),r._keyboardActive=!0,pi.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in Hq&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const n=this.config.device;e(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(n,"change",this.pointerMove.bind(this)),e(n,"end",this.pointerUp.bind(this)),e(n,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function RZe(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}const H_=typeof window<"u"&&window.document&&window.document.createElement;function Jce(){return H_&&"ontouchstart"in window}function IZe(){return Jce()||H_&&window.navigator.maxTouchPoints>1}function kZe(){return H_&&"onpointerdown"in window}function xZe(){return H_&&"exitPointerLock"in window.document}function PZe(){try{return"constructor"in GestureEvent}catch{return!1}}const Fo={isBrowser:H_,gesture:PZe(),touch:Jce(),touchscreen:IZe(),pointer:kZe(),pointerLock:xZe()},LZe=250,AZe=180,OZe=.5,MZe=50,NZe=250,DZe=10,Vq={mouse:0,touch:0,pen:8},FZe=er(er({},wv),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Fo.pointerLock,Fo.touch&&n?"touch":this.pointerLock?"mouse":Fo.pointer&&!i?"pointer":Fo.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?LZe:void 0,!(!Fo.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const s=pi.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:t=OZe,distance:e=MZe,duration:n=NZe}={}){return{velocity:this.transform(pi.toVector(t)),distance:this.transform(pi.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return AZe;case!1:return 0;default:return t}},axisThreshold(t){return t?er(er({},Vq),t):Vq},keyboardDisplacement(t=DZe){return t}});er(er({},Xce),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Fo.touch&&Fo.gesture)return"gesture";if(Fo.touch&&r)return"touch";if(Fo.touchscreen){if(Fo.pointer)return"pointer";if(Fo.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=o=>{const a=$q(_C(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=$q(_C(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",pi.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});er(er({},wv),{},{mouseOnly:(t=!0)=>t});class UZe extends Yce{constructor(...e){super(...e),Xi(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const n=this.state,r=gZe(e);n._delta=pi.sub(r,n._values),pi.addTo(n._movement,n._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const jZe=wv;er(er({},wv),{},{mouseOnly:(t=!0)=>t});const Zce=new Map,PL=new Map;function Qce(t){Zce.set(t.key,t.engine),PL.set(t.key,t.resolver)}const $Ze={key:"drag",engine:TZe,resolver:FZe},BZe={key:"scroll",engine:UZe,resolver:jZe};function HZe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function VZe(t,e){if(t==null)return{};var n=HZe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const GZe={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=Fo.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},qZe=["target","eventOptions","window","enabled","transform"];function LE(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=LE(t[r],i);break;case"boolean":i&&(n[r]=t[r]);break}return n}function KZe(t,e,n={}){const r=t,{target:i,eventOptions:s,window:o,enabled:a,transform:l}=r,c=VZe(r,qZe);if(n.shared=LE({target:i,eventOptions:s,window:o,enabled:a,transform:l},GZe),e){const u=PL.get(e);n[e]=LE(er({shared:n.shared},c),u)}else for(const u in c){const f=PL.get(u);f&&(n[u]=LE(er({shared:n.shared},c[u]),f))}return n}class eue{constructor(e,n){Xi(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,i,s){const o=this._listeners,a=fZe(n,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=er(er({},l),s);e.addEventListener(a,i,c);const u=()=>{e.removeEventListener(a,i,c),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class WZe{constructor(){Xi(this,"_timeouts",new Map)}add(e,n,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class zZe{constructor(e){Xi(this,"gestures",new Set),Xi(this,"_targetEventStore",new eue(this)),Xi(this,"gestureEventStores",{}),Xi(this,"gestureTimeoutStores",{}),Xi(this,"handlers",{}),Xi(this,"config",{}),Xi(this,"pointerIds",new Set),Xi(this,"touchIds",new Set),Xi(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),YZe(this,e)}setEventIds(e){if(P3(e))return this.touchIds=new Set(mZe(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=KZe(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],l=Gq(r,a.eventOptions,!!i);if(a.enabled){const c=Zce.get(o);new c(this,e,o).bind(l)}}const s=Gq(r,n.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](er(er({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=_Ze(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:l}=dZe(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:l})}}}}function em(t,e){t.gestures.add(e),t.gestureEventStores[e]=new eue(t,e),t.gestureTimeoutStores[e]=new WZe}function YZe(t,e){e.drag&&em(t,"drag"),e.wheel&&em(t,"wheel"),e.scroll&&em(t,"scroll"),e.move&&em(t,"move"),e.pinch&&em(t,"pinch"),e.hover&&em(t,"hover")}const Gq=(t,e,n)=>(r,i,s,o={},a=!1)=>{var l,c;const u=(l=o.capture)!==null&&l!==void 0?l:e.capture,f=(c=o.passive)!==null&&c!==void 0?c:e.passive;let p=a?r:cZe(r,i,u);n&&f&&(p+="Passive"),t[p]=t[p]||[],t[p].push(s)};function tue(t,e={},n,r){const i=Se.useMemo(()=>new zZe(t),[]);if(i.applyHandlers(t,r),i.applyConfig(e,n),Se.useEffect(i.effect.bind(i)),Se.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function XZe(t,e){return Qce($Ze),tue({drag:t},e||{},"drag")}function JZe(t,e){return Qce(BZe),tue({scroll:t},e||{},"scroll")}const ZZe="_grid_19qx5_8",QZe="_slot_19qx5_12",l6={grid:ZZe,slot:QZe},eQe="_tile_lwkx2_8",tQe="_draggable_lwkx2_8",qq={tile:eQe,draggable:tQe},nue=_.memo(({id:t,onDrag:e,targetWidth:n,targetHeight:r,model:i,Tile:s,opacity:o,scale:a,zIndex:l,x:c,y:u,width:f,height:p})=>{const m=_.useRef(null);return XZe(v=>e==null?void 0:e.current(t,v),{target:m,filterTaps:!0,preventScroll:!0}),E.jsx(s,{ref:m,className:Ne(qq.tile,{[qq.draggable]:e}),style:{opacity:o,scale:a,zIndex:l,x:c,y:u,width:f,height:p},targetWidth:n,targetHeight:r,model:i})});nue.displayName="TileWrapper";const nQe=nue,rQe=()=>ET("(prefers-reduced-motion)");function rue(t,e){if(!(t.offsetParent instanceof HTMLElement)||t.offsetParent===e)return{x:t.offsetLeft,y:t.offsetTop};{const n=rue(t.offsetParent,e);return n.x+=t.offsetLeft,n.y+=t.offsetTop,n}}const iue=_.createContext(null);function sue(){const t=_.useContext(iue);if(t===null)throw new Error("useUpdateLayout called outside a Grid layout context");return t}function Gl(){const{setGeneration:t}=sue();_.useEffect(()=>t(e=>e===null?0:e+1))}function _9(t){const{setVisibleTilesCallback:e}=sue();_.useEffect(()=>e(()=>t),[t,e]),_.useEffect(()=>()=>e(null),[e])}const iQe=Nl(window,"resize").pipe(yn(null),Me(()=>window.innerHeight));function Kq({model:t,Layout:e,Tile:n,className:r,style:i}){const[s,o]=$1(),[a,l]=_.useState(null),c=B_(s,l),u=Je(iQe),[f,p]=_.useState(null),[m,v]=_.useState(null),[g,S]=_.useState(null),b=ef(()=>new Map),w=rQe(),k=_.useMemo(()=>function({id:z,model:K,onDrag:V,style:q,className:Z,...G}){const Q=_.useRef(null);return _.useEffect(()=>(b.set(z,{id:z,model:K,onDrag:V}),()=>void b.delete(z)),[z,K,V]),E.jsx("div",{ref:Q,className:Ne(Z,l6.slot),"data-id":z,style:q,...G})},[b]),T=_.useMemo(()=>_.memo(_.forwardRef(function({Layout:z,...K},V){return E.jsx(z,{...K,ref:V})})),[]),I=_.useMemo(()=>({setGeneration:v,setVisibleTilesCallback:S}),[S]),C=_.useMemo(()=>{const H=[];if(a!==null&&f!==null){const z=f.getElementsByClassName(l6.slot);for(const K of z){const V=K.getAttribute("data-id");K.offsetWidth>0&&K.offsetHeight>0&&H.push({...b.get(V),...rue(K,a),width:K.offsetWidth,height:K.offsetHeight})}}return H},[a,f,b,o,m]),x=_.useMemo(()=>Math.min(o.bottom,u)-o.top,[o,u]);_.useEffect(()=>{g==null||g(C.filter(H=>H.y+H.height<=x).length)},[C,g,x]);const A=_.useRef(null),[N,D]=wXe(C,()=>({key:({id:H})=>H,from:({x:H,y:z,width:K,height:V})=>({opacity:0,scale:0,zIndex:1,x:H,y:z,width:K,height:V,immediate:w}),enter:{opacity:1,scale:1,immediate:w},update:({id:H,x:z,y:K,width:V,height:q})=>{var Z;return H===((Z=A.current)==null?void 0:Z.tileId)?null:{x:z,y:K,width:V,height:q,immediate:w}},leave:{opacity:0,scale:0,immediate:w},config:{mass:.7,tension:252,friction:25}}));_.useEffect(()=>{D.start().forEach(H=>void H.catch(O.error))},[C,D]);const F=(H,z)=>{var G;const{tileId:K,tileX:V,tileY:q}=A.current,Z=C.find(Q=>Q.id===K);(G=D.current.find(Q=>Q.item.id===K))==null||G.start(H?{scale:1,zIndex:1,x:Z.x,y:Z.y,width:Z.width,height:Z.height,immediate:w||(Q=>Q==="zIndex"),delay:Q=>Q==="zIndex"?500:0}:{scale:1.1,zIndex:2,x:V,y:q,immediate:w||(Q=>Q==="zIndex"||Q==="x"||Q==="y")}).catch(O.error),H&&z({x:V,y:q,xRatio:V/(o.width-Z.width),yRatio:q/(o.height-Z.height)})},$=(H,{tap:z,initial:[K,V],delta:[q,Z],last:G})=>{if(!z){const Q=D.current.find(_e=>_e.item.id===H),ge=b.get(Q.item.id).onDrag;if(ge!=null){if(A.current===null){const _e=Q.get();A.current={tileId:H,tileX:_e.x,tileY:_e.y,cursorX:K-o.x,cursorY:V-o.y+W.current}}A.current.tileX+=q,A.current.tileY+=Z,A.current.cursorX+=q,A.current.cursorY+=Z,F(G,ge),G&&(A.current=null)}}},B=_.useRef($);B.current=$;const W=_.useRef(0);return JZe(({xy:[,H],delta:[,z]})=>{W.current=H,A.current!==null&&(A.current.tileY+=z,A.current.cursorY+=z,F(!1,b.get(A.current.tileId).onDrag))},{target:a??void 0}),E.jsxs("div",{ref:c,className:Ne(r,l6.grid),style:i,children:[E.jsx(iue.Provider,{value:I,children:E.jsx(T,{ref:p,Layout:e,model:t,Slot:k})}),N((H,{id:z,model:K,onDrag:V,width:q,height:Z})=>E.jsx(nQe,{id:z,onDrag:V?B:null,targetWidth:q,targetHeight:Z,model:K,Tile:n,...H},z))]})}const sQe="_contents_18jbt_8",oQe="_tile_18jbt_25",aQe="_maximised_18jbt_25",lQe="_item_18jbt_29",cQe="_snap_18jbt_36",uQe="_advance_18jbt_40",dQe="_back_18jbt_76",fQe="_next_18jbt_80",hQe="_expand_18jbt_84",pQe="_indicators_18jbt_128",mQe="_show_18jbt_140",no={contents:sQe,tile:oQe,maximised:aQe,item:lQe,snap:cQe,advance:uQe,back:dQe,next:fQe,expand:hQe,indicators:pQe,show:mQe},b9=(t,e)=>{const n=_.useRef(void 0);n.current===void 0&&(n.current=t());const r=_.useRef(void 0),[,i]=_.useState(0);return(r.current===void 0||e.length!==r.current.length||e.some((s,o)=>!Object.is(s,r.current[o])))&&(n.current=t(n.current)),r.current=e,[n.current,_.useCallback(s=>{typeof s=="function"?n.current=s(n.current):n.current=s,i(o=>o+1)},[i])]},oue=_.forwardRef(({vm:t,...e},n)=>{const r=Je(t.mirror$);return E.jsx($_,{ref:n,mirror:r,...e})});oue.displayName="SpotlightLocalUserMediaItem";const aue=_.forwardRef(({vm:t,...e},n)=>{const r=Je(t.videoEnabled$),i=Je(t.cropVideo$),s={ref:n,videoEnabled:r,videoFit:i?"cover":"contain",...e};return t instanceof Ug?E.jsx(oue,{vm:t,...s}):E.jsx($_,{mirror:!1,...s})});aue.displayName="SpotlightUserMediaItem";const lue=_.forwardRef(({vm:t,targetWidth:e,targetHeight:n,intersectionObserver$:r,snap:i,"aria-hidden":s},o)=>{const a=_.useRef(null),l=B_(a,o),c=Je(t.displayname$),u=Je(t.video$),f=Je(t.unencryptedWarning$),p=Je(t.encryptionStatus$);_.useEffect(()=>{const v=a.current;let g=null;const S=r.subscribe(b=>{g==null||g.unobserve(v),b.observe(v),g=b});return()=>{S.unsubscribe(),g==null||g.unobserve(v)}},[r]);const m={ref:l,"data-id":t.id,className:Ne(no.item,{[no.snap]:i}),targetWidth:e,targetHeight:n,video:u,member:t.member,unencryptedWarning:f,displayName:c,encryptionStatus:p,"aria-hidden":s,localParticipant:t.local};return t instanceof Em?E.jsx($_,{videoEnabled:!0,videoFit:"contain",mirror:!1,...m}):E.jsx(aue,{vm:t,...m})});lue.displayName="SpotlightItem";const LL=_.forwardRef(({vm:t,expanded:e,onToggleExpanded:n,targetWidth:r,targetHeight:i,showIndicators:s,className:o,style:a},l)=>{var $;const{t:c}=et(),[u,f]=F$e(null),p=B_(u,l),m=Je(t.maximised$),v=Je(t.media$),[g,S]=_.useState(($=v[0])==null?void 0:$.id),b=eu(v),w=eu(g),k=v.findIndex(B=>B.id===g),T=k>0,I=k!==-1&&k<v.length-1,C=ef(()=>f.pipe(Me(B=>new IntersectionObserver(W=>{const H=W.find(z=>z.isIntersecting);H!==void 0&&S(H.target.getAttribute("data-id"))},{root:B,threshold:.5})))),[x,A]=b9(B=>B==null||B===g||v.every(W=>W.id!==B)?null:B,[g]),N=_.useCallback(()=>{const B=b.current,W=B.findIndex(H=>H.id===w.current);W>0&&A(B[W-1].id)},[w,b,A]),D=_.useCallback(()=>{const B=b.current,W=B.findIndex(H=>H.id===w.current);W!==-1&&W!==B.length-1&&A(B[W+1].id)},[w,b,A]),F=e?E5e:wne;return E.jsxs(Mce.div,{ref:p,className:Ne(o,no.tile,{[no.maximised]:m}),style:a,children:[T&&E.jsx("button",{className:Ne(no.advance,no.back),"aria-label":c("common.back"),onClick:N,children:E.jsx(WPe,{"aria-hidden":!0,width:24,height:24})}),E.jsx("div",{className:no.contents,children:v.map(B=>E.jsx(lue,{vm:B,targetWidth:r,targetHeight:i,intersectionObserver$:C,snap:x===null||x===B.id,"aria-hidden":(x??g)!==B.id},B.id))}),n&&E.jsx("button",{className:Ne(no.expand),"aria-label":c(e?"video_tile.collapse":"video_tile.expand"),onClick:n,children:E.jsx(F,{"aria-hidden":!0,width:20,height:20})}),I&&E.jsx("button",{className:Ne(no.advance,no.next),"aria-label":c("common.next"),onClick:D,children:E.jsx(Vte,{"aria-hidden":!0,width:24,height:24})}),!e&&E.jsx("div",{className:Ne(no.indicators,{[no.show]:s&&v.length>1}),children:v.map(B=>E.jsx("div",{className:no.item,"data-visible":B.id===g},B.id))})]})});LL.displayName="SpotlightTile";const gQe="_fixed_r39jt_8",vQe="_scrolling_r39jt_9",yQe="_slot_r39jt_21",f2={fixed:gQe,scrolling:vQe,slot:yQe},_Qe={inline:"end",block:"end"},bQe={inline:"end",block:"start"},Wq=17/9,c6=4/3;function S9(t,e,n){const r=t<800?16:20,i=t*e,s=Math.pow(Math.sqrt(i)/8+125,2),o=Math.min(n,i/s);let a=Math.min(o,Math.round(Math.sqrt(t/e/c6*o))),l=o/a;o===n&&(l=Math.ceil(l),a=Math.ceil(n/l));let c=(t-(a+1)*r)/a,u=(e-(l-1)*r)/l;const f=c/u;return f>Wq?c=u*Wq:f<c6&&(u=c/c6),{tileWidth:c,tileHeight:u,gap:r,columns:a}}const SQe=({minBounds$:t,spotlightAlignment$:e})=>({scrollingOnTop:!1,fixed:_.forwardRef(function({model:r,Slot:i},s){Gl();const o=Je(ef(()=>e.pipe(Ll((l,c)=>l.block===c.block&&l.inline===c.inline)))),a=_.useCallback(({xRatio:l,yRatio:c})=>e.next({block:c<.5?"start":"end",inline:l<.5?"start":"end"}),[]);return E.jsx("div",{ref:s,className:f2.fixed,children:r.spotlight&&E.jsx(i,{className:f2.slot,id:"spotlight",model:r.spotlight,onDrag:a,"data-block-alignment":o.block,"data-inline-alignment":o.inline})})}),scrolling:_.forwardRef(function({model:r,Slot:i},s){Gl(),_9(r.setVisibleTiles);const{width:o,height:a}=Je(t),{gap:l,tileWidth:c,tileHeight:u}=_.useMemo(()=>S9(o,a,r.grid.length),[o,a,r.grid.length]);return E.jsx("div",{ref:s,className:f2.scrolling,style:{width:o,"--gap":`${l}px`,"--width":`${Math.floor(c)}px`,"--height":`${Math.floor(u)}px`},children:r.grid.map(f=>E.jsx(i,{className:f2.slot,id:f.id,model:f},f.id))})})}),EQe="_layer_mc5gk_8",wQe="_container_mc5gk_14",CQe="_local_mc5gk_18",TQe="_slot_mc5gk_31",h2={layer:EQe,container:wQe,local:CQe,slot:TQe},RQe=({minBounds$:t,pipAlignment$:e})=>({scrollingOnTop:!1,fixed:_.forwardRef(function(r,i){return Gl(),E.jsx("div",{ref:i})}),scrolling:_.forwardRef(function({model:r,Slot:i},s){Gl();const{width:o,height:a}=Je(t),l=Je(e),{tileWidth:c,tileHeight:u}=_.useMemo(()=>S9(o,a,1),[o,a]),f=_.useCallback(({xRatio:p,yRatio:m})=>e.next({block:m<.5?"start":"end",inline:p<.5?"start":"end"}),[]);return E.jsx("div",{ref:s,className:h2.layer,children:E.jsx(i,{id:r.remote.id,model:r.remote,className:h2.container,style:{width:c,height:u},children:E.jsx(i,{className:Ne(h2.slot,h2.local),id:r.local.id,model:r.local,onDrag:f,"data-block-alignment":l.block,"data-inline-alignment":l.inline})})})})}),IQe="_layer_1swii_8",kQe="_spotlight_1swii_12",xQe="_pip_1swii_17",p2={layer:IQe,spotlight:kQe,pip:xQe},PQe=({pipAlignment$:t})=>({scrollingOnTop:!0,fixed:_.forwardRef(function({model:n,Slot:r},i){return Gl(),E.jsx("div",{ref:i,className:p2.layer,children:E.jsx(r,{className:p2.spotlight,id:"spotlight",model:n.spotlight})})}),scrolling:_.forwardRef(function({model:n,Slot:r},i){Gl();const s=Je(t),o=_.useCallback(({xRatio:a,yRatio:l})=>t.next({block:l<.5?"start":"end",inline:a<.5?"start":"end"}),[]);return E.jsx("div",{ref:i,className:p2.layer,children:n.pip&&E.jsx(r,{className:p2.pip,id:n.pip.id,model:n.pip,onDrag:o,"data-block-alignment":s.block,"data-inline-alignment":s.inline})})})}),LQe="_layer_jsvx2_8",AQe="_spotlight_jsvx2_19",OQe="_slot_jsvx2_28",MQe="_grid_jsvx2_34",pc={layer:LQe,spotlight:AQe,slot:OQe,grid:MQe},NQe=({minBounds$:t})=>({scrollingOnTop:!1,fixed:_.forwardRef(function({model:n,Slot:r},i){return Gl(),Je(t),E.jsxs("div",{ref:i,className:pc.layer,children:[E.jsx("div",{className:pc.spotlight,children:E.jsx(r,{className:pc.slot,id:"spotlight",model:n.spotlight})}),E.jsx("div",{className:pc.grid})]})}),scrolling:_.forwardRef(function({model:n,Slot:r},i){Gl(),_9(n.setVisibleTiles),Je(t);const s=Je(n.spotlight.media$).length>1;return E.jsxs("div",{ref:i,className:pc.layer,children:[E.jsx("div",{className:Ne(pc.spotlight,{[pc.withIndicators]:s})}),E.jsx("div",{className:pc.grid,children:n.grid.map(o=>E.jsx(r,{className:pc.slot,id:o.id,model:o},o.id))})]})})}),DQe="_layer_1q32d_8",FQe="_spotlight_1q32d_17",UQe="_withIndicators_1q32d_26",jQe="_slot_1q32d_30",$Qe="_grid_1q32d_35",Xu={layer:DQe,spotlight:FQe,withIndicators:UQe,slot:jQe,grid:$Qe},BQe=({minBounds$:t})=>({scrollingOnTop:!1,fixed:_.forwardRef(function({model:n,Slot:r},i){return Gl(),E.jsx("div",{ref:i,className:Xu.layer,children:E.jsx("div",{className:Xu.spotlight,children:E.jsx(r,{className:Xu.slot,id:"spotlight",model:n.spotlight})})})}),scrolling:_.forwardRef(function({model:n,Slot:r},i){Gl(),_9(n.setVisibleTiles);const{width:s}=Je(t),{gap:o,tileWidth:a,tileHeight:l}=S9(s,s,n.grid.length),c=Je(n.spotlight.media$).length>1;return E.jsxs("div",{ref:i,className:Xu.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(a)}px`,"--grid-tile-height":`${Math.floor(l)}px`},children:[E.jsx("div",{className:Ne(Xu.spotlight,{[Xu.withIndicators]:c})}),E.jsx("div",{className:Xu.grid,children:n.grid.map(u=>E.jsx(r,{className:Xu.slot,id:u.id,model:u},u.id))})]})})});async function HQe(t,e,n,r){const i=t.createGain();i.gain.setValueAtTime(n,0);const s=t.createStereoPanner();s.pan.setValueAtTime(r,0);const o=t.createBufferSource();o.buffer=e,o.connect(i).connect(s).connect(t.destination);const a=new Promise(l=>o.addEventListener("ended",()=>l()));return o.start(),a}function E9(t){const[e]=bn(yse),{audioOutput:n}=hf(),{controlledAudioDevices:r}=sa(),[i,s]=_.useState(),[o,a]=_.useState();_.useEffect(()=>{const u=t.sounds;if(!u)return;const f=new AudioContext({latencyHint:t.latencyHint});return(async()=>{const p={};for(const[m,v]of Object.entries(await u)){const g=await f.decodeAudioData(v.slice(0));p[m]=g}a(p)})().catch(p=>{O.debug("Failed to setup audio context",p)}),s(f),()=>{f.close().catch(p=>{O.debug("Failed to close audio engine",p)}),s(void 0)}},[t.sounds,t.latencyHint]),_.useEffect(()=>{i&&"setSinkId"in i&&!r&&i.setSinkId(n.selectedId).catch(u=>{O.warn("Unable to change sink for audio context",u)})},[i,n.selectedId,r]);const{pan:l,volume:c}=Gse();return!i||!o||t.muted?null:{playSound:async u=>{if(!o[u]){O.debug(`Tried to play a sound that wasn't buffered (${u})`);return}return HQe(i,o[u],e*c,l)}}}function VQe(){return document.createElement("audio").canPlayType("audio/ogg")==="maybe"?"ogg":"mp3"}const GQe=VQe();async function cue(t){const e={};return await Promise.all(Object.entries(t).map(async([n,r])=>{const{mp3:i,ogg:s}=r,o=await fetch(GQe==="ogg"?s:i??s);if(n8(o)){O.warn(`Could not load sound ${n}, response was not okay`);return}e[n]=await o.arrayBuffer()})),e}const zq=Object.fromEntries([...Iy.filter(t=>t.sound!==void 0).map(t=>[t.name,t.sound]),[D5.name,D5.sound]]);function qQe({vm:t,muted:e}){const[n]=bn(P8),[r,i]=_.useState(null),s=E9({sounds:r,latencyHint:"interactive",muted:e}),o=eu(s);return _.useEffect(()=>{!n||r||i(cue(zq))},[r,n]),_.useEffect(()=>{const a=t.audibleReactions$.subscribe(l=>{var c,u;for(const f of l)zq[f]?(c=o.current)==null||c.playSound(f):(u=o.current)==null||u.playSound("generic")});return()=>{a.unsubscribe()}},[t,o]),null}const KQe="_container_1ux8r_1",WQe="_reaction_1ux8r_12",Yq={container:KQe,reaction:WQe};function zQe({vm:t}){const e=Py(t.visibleReactions$);return E.jsx("div",{className:Yq.container,children:e==null?void 0:e.map(({sender:n,emoji:r,startX:i})=>E.jsx("span",{role:"presentation",style:{left:`${i}vw`},className:Yq.reaction,children:r},n))})}const YQe=""+new URL("join_call-dEJCP2wD.mp3",import.meta.url).href,XQe=""+new URL("join_call-DlMV9nHk.ogg",import.meta.url).href,JQe=""+new URL("left_call-BbqmRgnC.mp3",import.meta.url).href,ZQe=""+new URL("left_call-C7NMl6WI.ogg",import.meta.url).href,QQe=""+new URL("raise_hand-CUbxEnt9.ogg",import.meta.url).href,eet=""+new URL("raise_hand-Bzqn65WB.mp3",import.meta.url).href,tet=""+new URL("screen_share_started-IZDL-kAw.ogg",import.meta.url).href,net=""+new URL("screen_share_started-DH3qxml5.mp3",import.meta.url).href,Xq=8,Jq=500,uue=cue({join:{mp3:YQe,ogg:XQe},left:{mp3:JQe,ogg:ZQe},raiseHand:{mp3:eet,ogg:QQe},screenshareStarted:{mp3:net,ogg:tet}});function ret({vm:t,muted:e}){const n=E9({sounds:uue,latencyHint:"interactive",muted:e}),r=eu(n);return _.useEffect(()=>{const i=t.memberChanges$.pipe(Ga(({joined:l,ids:c})=>c.length<=Xq&&l.length>0),$5(()=>U5(Jq))).subscribe(()=>{var l;(l=r.current)==null||l.playSound("join")}),s=t.memberChanges$.pipe(Ga(({ids:l,left:c})=>l.length<=Xq&&c.length>0),$5(()=>U5(Jq))).subscribe(()=>{var l;(l=r.current)==null||l.playSound("left")}),o=t.newHandRaised$.subscribe(()=>{var l;(l=r.current)==null||l.playSound("raiseHand")}),a=t.newScreenShare$.subscribe(()=>{var l;(l=r.current)==null||l.playSound("screenshareStarted")});return()=>{i.unsubscribe(),s.unsubscribe(),o.unsubscribe(),a.unsubscribe()}},[r,t]),E.jsx(E.Fragment,{})}const Zq=3e3;class iet{constructor(e){this.rtcSession=e,this.raisedHandsSubject$=new Gi({}),this.reactionsSubject$=new Gi({}),this.raisedHands$=this.raisedHandsSubject$.asObservable(),this.reactions$=this.reactionsSubject$.asObservable(),this.onMembershipsChanged=n=>{for(const r of Object.keys(this.raisedHandsSubject$.value).filter(i=>n.find(s=>s.sender==i)))this.removeRaisedHand(r);for(const r of this.rtcSession.memberships){if(!r.sender||!r.eventId)continue;const i=`${r.sender}:${r.deviceId}`;this.raisedHandsSubject$.value[i]&&this.raisedHandsSubject$.value[i].membershipEventId!==r.eventId&&this.removeRaisedHand(i);const s=this.getLastReactionEvent(r.eventId,r.sender);if(s){const o=s==null?void 0:s.getId();if(!o)continue;this.addRaisedHand(`${r.sender}:${r.deviceId}`,{membershipEventId:r.eventId,reactionEventId:o,time:new Date(s.localTimestamp)})}}},this.handleReactionEvent=n=>{var o,a,l;const r=this.rtcSession.room;if(n.getRoomId()!==r.roomId||n.isSending())return;const i=n.getSender(),s=n.getId();if(!(!i||!s)&&(r.client.decryptEventIfNeeded(n).catch(c=>O.warn(`Failed to decrypt ${n.getId()}`,c)),!(n.isBeingDecrypted()||n.isDecryptionFailure()))){if(n.getType()===b8){const c=n.getContent(),u=(o=c==null?void 0:c["m.relates_to"])==null?void 0:o.event_id,f=this.rtcSession.memberships.find(b=>b.eventId===u&&b.sender===i);if(!f){O.warn(`Reaction target was not a membership event for ${i}, ignoring`);return}const p=`${f.sender}:${f.deviceId}`;if(!c.emoji){O.warn(`Reaction had no emoji from ${s}`);return}const v=(a=new Intl.Segmenter(void 0,{granularity:"grapheme"}).segment(c.emoji)[Symbol.iterator]().next().value)==null?void 0:a.segment;if(!(v!=null&&v.trim())){O.warn(`Reaction had no emoji from ${s} after splitting`);return}const g={...D5,emoji:v,...Iy.find(b=>b.name===c.name)},S=this.reactionsSubject$.value;if(S[p]){O.warn(`Got reaction from ${p} but one is still playing`);return}this.reactionsSubject$.next({...S,[p]:{reactionOption:g,expireAfter:new Date(Date.now()+Zq)}})}else if(n.getType()===ee.Reaction){const c=n.getContent(),u=c["m.relates_to"].event_id,f=this.rtcSession.memberships.find(p=>p.eventId===u&&p.sender===i);if(!f){O.warn(`Reaction target was not a membership event for ${i}, ignoring`);return}(c==null?void 0:c["m.relates_to"].key)==="🖐️"&&this.addRaisedHand(`${f.sender}:${f.deviceId}`,{reactionEventId:s,membershipEventId:u,time:new Date(n.localTimestamp)})}else if(n.getType()===ee.RoomRedaction){const c=n.event.redacts,u=(l=Object.entries(this.raisedHandsSubject$.value).find(([f,p])=>p.reactionEventId===c))==null?void 0:l[0];if(!u)return;this.removeRaisedHand(u)}}},this.reactionsSub=this.reactionsSubject$.pipe(y$e(Zq)).subscribe(n=>{const r=new Date,i=Object.fromEntries(Object.entries(n).filter(([s,o])=>o.expireAfter>r));Object.keys(n).length!==Object.keys(i).length&&this.reactionsSubject$.next(i)}),this.rtcSession.room.on(xe.Timeline,this.handleReactionEvent),this.rtcSession.room.on(xe.Redaction,this.handleReactionEvent),this.rtcSession.room.client.on(Ht.Decrypted,this.handleReactionEvent),this.rtcSession.room.on(xe.LocalEchoUpdated,this.handleReactionEvent),e.on(Ar.MembershipsChanged,this.onMembershipsChanged),this.onMembershipsChanged([])}getLastReactionEvent(e,n){const r=this.rtcSession.room.relations.getChildEventsForEvent(e,Tn.Annotation,ee.Reaction);return((r==null?void 0:r.getRelations())??[]).find(s=>{var o,a;return s.event.sender===n&&s.getType()===ee.Reaction&&((a=(o=s.getContent())==null?void 0:o["m.relates_to"])==null?void 0:a.key)==="🖐️"})}addRaisedHand(e,n){this.raisedHandsSubject$.next({...this.raisedHandsSubject$.value,[e]:n})}removeRaisedHand(e){this.raisedHandsSubject$.next(Object.fromEntries(Object.entries(this.raisedHandsSubject$.value).filter(([n])=>n!==e)))}destroy(){this.rtcSession.off(Ar.MembershipsChanged,this.onMembershipsChanged),this.rtcSession.room.off(xe.Timeline,this.handleReactionEvent),this.rtcSession.room.off(xe.Redaction,this.handleReactionEvent),this.rtcSession.room.client.off(Ht.Decrypted,this.handleReactionEvent),this.rtcSession.room.off(xe.LocalEchoUpdated,this.handleReactionEvent),this.reactionsSub.unsubscribe()}}function set({members:t,muted:e}){const n=_.useMemo(()=>new Set(t==null?void 0:t.map(p=>`${p.sender}:${p.deviceId}`)),[t]),r=_.useRef(new Set),i=(p,m)=>{r.current.has(p)||(O.warn(`Audio track ${p} has no matching matrix call member`,`current members: ${Array.from(m.values())}`,"track will not get rendered"),r.current.add(p))},s=AWe([ue.Source.Microphone,ue.Source.ScreenShareAudio,ue.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(p=>{const m=n==null?void 0:n.has(p.participant.identity);return!m&&!p.participant.isLocal&&i(p.participant.identity,n),!p.participant.isLocal&&p.publication.kind===ue.Kind.Audio&&m}),{pan:o,volume:a}=Gse(),l=o!==0,[c,u]=_.useState(void 0);_.useEffect(()=>{const p=new AudioContext;return u(p),()=>{p.close()}},[]);const f=_.useMemo(()=>({gain:c==null?void 0:c.createGain(),pan:c==null?void 0:c.createStereoPanner()}),[c]);return _.useEffect(()=>{f.pan&&(f.pan.pan.value=o)},[f.pan,o]),_.useEffect(()=>{f.gain&&(f.gain.gain.value=a)},[f.gain,a]),E.jsx("div",{style:{display:"none"},children:s.map(p=>E.jsx(oet,{trackRef:p,muted:e,audioContext:l?c:void 0,audioNodes:f},wHe(p)))})}function oet({trackRef:t,muted:e,audioContext:n,audioNodes:r,...i}){const[s,o]=b9(()=>!1,[n&&r]);return _.useEffect(()=>{if(!t||s)return;const a=t.publication.track,l=n&&r.gain&&r.pan;a.setAudioContext(l?n:void 0),a.setWebAudioPlugins(l?[r.gain,r.pan]:[]),o(!0)},[n,r,o,s,t]),s&&E.jsx(ize,{trackRef:t,muted:e,...i})}const due=Gn([V5.pipe(yn(!0)),bse.value$],(t,e)=>!t||e),aet="getDisplayMedia"in(navigator.mediaDevices??{}),cet=400,uet=t=>{const e=PJe(t.client,t.rtcSession),{livekitRoom:n,connState:r}=FJe(t.rtcSession,t.muteStates,e,t.e2eeSystem),i=Fh(a=>a.pipe(Me(([l])=>l)),[r]),[s,o]=_.useState(null);return _.useEffect(()=>(O.info(`[Lifecycle] InCallView Component mounted, livekitroom state ${n==null?void 0:n.state}`),()=>{O.info(`[Lifecycle] InCallView Component unmounted, livekitroom state ${n==null?void 0:n.state}`),n==null||n.disconnect().then(()=>{O.info(`[Lifecycle] Disconnected from livekite room, state:${n==null?void 0:n.state}`)}).catch(a=>{O.error("[Lifecycle] Failed to disconnect from livekit room",a)})}),[]),_.useEffect(()=>{if(n!==void 0){const a=new iet(t.rtcSession),l=new nZe(t.rtcSession,n,t.e2eeSystem,i,a.raisedHands$,a.reactions$);return o(l),()=>{l.destroy(),a.destroy()}}},[t.rtcSession,n,t.e2eeSystem,i]),n===void 0||s===null?null:E.jsx(Gle.Provider,{value:n,children:E.jsx(nBe,{vm:s,rtcSession:t.rtcSession,children:E.jsx(det,{...t,vm:s,livekitRoom:n,connState:r})})})},det=({client:t,vm:e,matrixInfo:n,rtcSession:r,livekitRoom:i,muteStates:s,participantCount:o,onLeave:a,hideHeader:l,connState:c,onShareClick:u})=>{const{supportsReactions:f,sendReaction:p,toggleRaisedHand:m}=O8();if(UJe(),c===kt.Disconnected)throw new Bce;const v=_.useRef(null),[g,S]=$1(),b=B_(v,g),{hideScreensharing:w,showControls:k}=sa(),{isScreenShareEnabled:T,localParticipant:I}=LWe({room:i}),C=Je(due),x="io.safemeet.call.hangup",A=_.useRef(!1),[N,D]=_.useState(!1);ST(r,AC.EnabledTransportsChanged,ct=>D(ct.room));const[F]=bn(k8),[$]=bn(L8),B=L_(r.room.roomId),W=_.useMemo(()=>F&&$&&B.kind===zt.PER_PARTICIPANT&&!N,[F,$,B.kind,N]),H=_.useCallback(()=>{var ct,mn;return(mn=(ct=s.audio).setEnabled)==null?void 0:mn.call(ct,jn=>!jn)},[s]),z=_.useCallback(()=>{var ct,mn;return(mn=(ct=s.video).setEnabled)==null?void 0:mn.call(ct,jn=>!jn)},[s]);aYe(v,H,z,ct=>{var mn,jn;return(jn=(mn=s.audio).setEnabled)==null?void 0:jn.call(mn,!ct)},ct=>void p(ct),()=>void m());const K=Je(e.windowMode$),V=Je(e.layout$),q=Je(e.tileStoreGeneration$),[Z]=bn(x8),G=Je(e.gridMode$),Q=Je(e.showHeader$),ge=Je(e.showFooter$),_e=Xle(e.localVideo$);_.useEffect(()=>{if(!i)return;const ct=(mn,jn)=>{if(!(!jn||o>2))try{JSON.parse(new TextDecoder().decode(mn)).action===x&&a()}catch(ca){console.error("Failed to parse chat message:",ca)}};return i.on(ae.DataReceived,ct),()=>{i.off(ae.DataReceived,ct)}},[i,a,o]);const Pe=_.useRef(null),Te=_.useCallback(()=>Pe.current=Date.now(),[]),Re=_.useCallback(()=>{const ct=Pe.current;ct!==null&&Date.now()-ct<=cet&&e.tapScreen(),Pe.current=null},[e]),we=_.useCallback(()=>Pe.current=null,[]),ve=_.useCallback(ct=>{ge?(ct.stopPropagation(),e.tapControls()):ct.preventDefault()},[e,ge]),We=_.useCallback(ct=>{ct.pointerType==="mouse"&&e.hoverScreen()},[e]),pn=_.useCallback(()=>e.unhoverScreen(),[e]),[hr,Ft]=_.useState(!1),[ze,Fr]=_.useState(WM),Tr=_.useCallback(()=>Ft(!0),[Ft]),Ki=_.useCallback(()=>Ft(!1),[Ft]),nc=_.useMemo(()=>Ze===null?()=>{Fr("profile"),Ft(!0)}:null,[Fr,Ft]),[Bs,Pi]=$1(),[la,_u]=$1(),Hs=_.useMemo(()=>({width:S.width,height:S.height-Pi.height-(K==="flat"?0:_u.height)}),[S.width,S.height,Pi.height,_u.height,K]),vf=Fh(ct=>ct.pipe(Me(([mn])=>mn)),[Hs]),bu=ef(()=>new Gi(_Qe)),yf=ef(()=>new Gi(bQe)),nl=_.useCallback(ct=>e.setGridMode(ct),[e]);_.useEffect(()=>{Ze==null||Ze.api.transport.send(G==="grid"?fi.TileLayout:fi.SpotlightLayout,{}).catch(ct=>{O.error("Failed to send layout change to widget API",ct)})},[G]),_.useEffect(()=>{if(Ze){const ct=jn=>{nl("grid"),Ze.api.transport.reply(jn.detail,{})},mn=jn=>{nl("spotlight"),Ze.api.transport.reply(jn.detail,{})};return Ze.lazyActions.on(fi.TileLayout,ct),Ze.lazyActions.on(fi.SpotlightLayout,mn),()=>{Ze.lazyActions.off(fi.TileLayout,ct),Ze.lazyActions.off(fi.SpotlightLayout,mn)}}},[nl]);const yo=_.useMemo(()=>_.forwardRef(function({className:mn,style:jn,targetWidth:ca,targetHeight:tt,model:Tt},It){const Et=Je(e.spotlightExpanded$),wn=Je(e.toggleSpotlightExpanded$),Ur=Je(e.showSpeakingIndicators$),Rr=Je(e.showSpotlightIndicators$);return Tt instanceof Gce?E.jsx(Uce,{ref:It,vm:Tt,onOpenProfile:nc,targetWidth:ca,targetHeight:tt,className:Ne(mn,Zn.tile),style:jn,showSpeakingIndicators:Ur}):E.jsx(LL,{ref:It,vm:Tt,expanded:Et,onToggleExpanded:wn,targetWidth:ca,targetHeight:tt,showIndicators:Rr,className:Ne(mn,Zn.tile),style:jn})}),[e,nc]),sp=_.useMemo(()=>{const ct={minBounds$:vf,spotlightAlignment$:bu,pipAlignment$:yf};return{grid:SQe(ct),"spotlight-landscape":NQe(ct),"spotlight-portrait":BQe(ct),"spotlight-expanded":PQe(ct),"one-on-one":RQe(ct)}},[vf,bu,yf]),rl=()=>{if(V.type==="pip")return E.jsx(LL,{className:Ne(Zn.tile,Zn.maximised),vm:V.spotlight,expanded:!0,onToggleExpanded:null,targetWidth:Hs.height,targetHeight:Hs.width,showIndicators:!1});const ct=sp[V.type],mn=E.jsx(Kq,{className:Zn.fixedGrid,style:{insetBlockStart:Pi.bottom,height:Hs.height},model:V,Layout:ct.fixed,Tile:yo},"fixed"),jn=E.jsx(Kq,{className:Zn.scrollingGrid,model:V,Layout:ct.scrolling,Tile:yo},"scrolling");return V.type==="spotlight-expanded"?E.jsxs(E.Fragment,{children:[mn,jn]}):E.jsxs(E.Fragment,{children:[jn,mn]})},rc=W$e(r.room.roomId),ic=_.useCallback(()=>{I.setScreenShareEnabled(!T,{audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"}).catch(O.error)},[I,T]),Vs=[];Vs.push(E.jsx(wse,{muted:!s.audio.enabled,onClick:H,onTouchEnd:ve,disabled:s.audio.setEnabled===null,"data-testid":"incall_mute"},"audio"),E.jsx(Cse,{muted:!s.video.enabled,onClick:z,onTouchEnd:ve,disabled:s.video.setEnabled===null,"data-testid":"incall_videomute"},"video")),_e!==null&&Vs.push(E.jsx(Tse,{className:Zn.switchCamera,onClick:_e,onTouchEnd:ve},"switch_camera")),aet&&!w&&Vs.push(E.jsx(Q$e,{className:Zn.shareScreen,enabled:T,onClick:ic,onTouchEnd:ve,"data-testid":"incall_screenshare"},"share_screen")),f&&Vs.push(E.jsx(OBe,{vm:e,className:Zn.raiseHand,identifier:`${t.getUserId()}:${t.getDeviceId()}`,onTouchEnd:ve},"raise_hand")),V.type!=="pip"&&Vs.push(E.jsx(Ise,{onClick:Tr,onTouchEnd:ve},"settings")),Vs.push(E.jsx(Rse,{onClick:async()=>{if(!A.current){try{const ct=new TextEncoder().encode(JSON.stringify({action:x}));await i.localParticipant.publishData(ct,{reliable:!1})}catch(ct){O.warn("[LiveKit] Failed to send hangup signal",ct)}A.current=!0}a()},onTouchEnd:ve,"data-testid":"incall_leave"},"end_call"));const op=E.jsxs("div",{ref:la,className:Ne(Zn.footer,{[Zn.overlay]:K==="flat",[Zn.hidden]:!ge||!k&&l}),children:[!l&&E.jsxs("div",{className:Zn.logo,children:[E.jsx(iYe,{width:24,height:24,"aria-hidden":!0}),E.jsx(oYe,{width:80,height:11,"aria-label":"Element Call"}),Z?`Tiles generation: ${q}`:void 0]}),k&&E.jsx("div",{className:Zn.buttons,children:Vs}),k&&E.jsx(BJe,{className:Zn.layout,layout:G,setLayout:nl,onTouchEnd:ve})]});return E.jsxs("div",{className:Zn.inRoom,ref:b,onTouchStart:Te,onTouchEnd:Re,onTouchCancel:we,onPointerMove:We,onPointerOut:pn,children:[Q&&(l?E.jsx("div",{className:Ne(Zn.header,Zn.filler),ref:Bs}):E.jsxs(uf,{className:Zn.header,ref:Bs,children:[E.jsx(Jh,{children:E.jsx(nre,{id:n.roomId,name:n.roomName,avatarUrl:n.roomAvatar,encrypted:n.e2eeSystem.kind!==zt.NONE,participantCount:o})}),E.jsx(Zh,{children:k&&u!==null&&E.jsx(Yle,{className:Zn.invite,onClick:u})})]})),W&&E.jsx(ln,{style:{height:0,zIndex:1,alignSelf:"center",margin:0},size:"sm",children:"using to Device key transport"}),E.jsx(set,{members:r.memberships,muted:C}),rl(),E.jsx(ret,{vm:e,muted:C}),E.jsx(qQe,{vm:e,muted:C}),E.jsx(zQe,{vm:e}),op,V.type!=="pip"&&E.jsxs(E.Fragment,{children:[E.jsx(rJe,{...rc}),E.jsx(zM,{client:t,roomId:r.room.roomId,open:hr,onDismiss:Ki,tab:ze,onTabChange:Fr,livekitRoom:i})]})]})},fet=8,het={enabled:!1,setEnabled:null};function Qq(t,e){const[n,r]=b9(i=>i??(t.available.size>0?e():void 0),[t]);return _.useMemo(()=>t.available.size===0?het:{enabled:n??!1,setEnabled:r},[t,n,r])}function pet(t){const e=hf(),{skipLobby:n}=sa(),r=Qq(e.audioInput,()=>Zt.get().media_devices.enable_audio&&!n&&!t),i=Qq(e.videoInput,()=>Zt.get().media_devices.enable_video&&!n&&!t);_.useEffect(()=>{Ze==null||Ze.api.transport.send(fi.DeviceMute,{audio_enabled:r.enabled,video_enabled:i.enabled}).catch(o=>O.warn("Could not send DeviceMute action to widget",o))},[r,i]);const s=_.useCallback(o=>{var l,c;const a={audio_enabled:r.enabled,video_enabled:i.enabled};o.detail.data.audio_enabled!=null&&typeof o.detail.data.audio_enabled=="boolean"&&((l=r.setEnabled)==null||l.call(r,o.detail.data.audio_enabled),a.audio_enabled=o.detail.data.audio_enabled),o.detail.data.video_enabled!=null&&typeof o.detail.data.video_enabled=="boolean"&&((c=i.setEnabled)==null||c.call(i,o.detail.data.video_enabled),a.video_enabled=o.detail.data.video_enabled),Ze.api.transport.reply(o.detail,a)},[r,i]);return _.useEffect(()=>{if(Ze)return Ze.lazyActions.on(fi.DeviceMute,s),()=>{Ze==null||Ze.lazyActions.off(fi.DeviceMute,s)}},[s]),_.useMemo(()=>({audio:r,video:i}),[r,i])}const met="org.matrix.msc4143.rtc_foci";function get(){return{type:"livekit",focus_selection:"oldest_membership"}}async function vet(t,e){var o,a;O.log("Start building foci_preferred list: ",t.room.roomId);const n=[],r=t.getFocusInUse();r&&mx(r)&&(O.log("Adding livekit focus from oldest member: ",r),n.push(r));const i=t.room.client.getDomain();if(i){const l=(o=await dt.getRawClientConfig(i))==null?void 0:o[met];Array.isArray(l)&&n.push(...l.filter(c=>!!c).filter(YW).map(c=>(O.log("Adding livekit focus from well known: ",c),{...c,livekit_alias:e})))}const s=(a=Zt.get().livekit)==null?void 0:a.livekit_service_url;if(s){const l={type:"livekit",livekit_service_url:s,livekit_alias:e};O.log("Adding livekit focus from config: ",l),n.push(l)}if(n.length===0)throw new TJe(i??"");return Promise.resolve(n)}async function yet(t,e,n=!0,r=!1){xt.instance.eventCallEnded.cacheStartCall(new Date),xt.instance.eventCallStarted.track(t.room.roomId);const i=t.room.roomId,{features:s,matrix_rtc_session:o}=Zt.get(),a=s==null?void 0:s.feature_use_device_session_member_events;if(t.joinRoomSession(await vet(t,i),get(),{useNewMembershipManager:n,manageMediaKeys:e,...a!==void 0&&{useLegacyMemberEvents:!a},delayedLeaveEventDelayMs:o==null?void 0:o.membership_server_side_expiry_timeout,networkErrorRetryMs:o==null?void 0:o.membership_keep_alive_period,makeKeyDelay:o==null?void 0:o.key_rotation_on_leave_delay,useExperimentalToDeviceTransport:r}),Ze)try{await Ze.api.transport.send(fi.JoinCall,{})}catch(l){O.error("Failed to send join action",l)}}const _et=async(t,e,n)=>{try{await t.api.setAlwaysOnScreen(!1)}catch(r){O.error("Failed to set call widget `alwaysOnScreen` to false",r)}await n;try{await t.api.transport.send(fi.HangupCall,{})}catch(r){O.error("Failed to send hangup action",r)}if(e==="user"&&!Ri().returnToLobby){try{await t.api.transport.send(fi.Close,{})}catch(r){O.error("Failed to send close action",r)}t.api.transport.stop()}};async function eK(t,e,n){await t.leaveRoomSession(),Ze?await _et(Ze,e,n):await n}const fue=(t,e)=>{const[n,r]=_.useState(0);return ST(t,gt.Update,_.useCallback(()=>r(i=>i+1),[r])),_.useMemo(()=>e(t.currentState),[t,e,n])};function bet(t){return fue(t,_.useCallback(()=>t.getMxcAvatarUrl(),[t]))}function Eet(t){const[,e]=_.useState(0);return ST(t,xe.Name,()=>e(n=>n+1)),t.name}function wet(t){return fue(t,_.useCallback(e=>e.getJoinRule(),[]))}var u6,tK;function Cet(){return tK||(tK=1,u6=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],r=0;r<t.rangeCount;r++)n.push(t.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||n.forEach(function(i){t.addRange(i)}),e&&e.focus()}}),u6}var d6,nK;function Tet(){if(nK)return d6;nK=1;var t=Cet(),e={"text/plain":"Text","text/html":"Url",default:"Text"},n="Copy to clipboard: #{key}, Enter";function r(s){var o=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return s.replace(/#{\s*key\s*}/g,o)}function i(s,o){var a,l,c,u,f,p,m=!1;o||(o={}),a=o.debug||!1;try{c=t(),u=document.createRange(),f=document.getSelection(),p=document.createElement("span"),p.textContent=s,p.ariaHidden="true",p.style.all="unset",p.style.position="fixed",p.style.top=0,p.style.clip="rect(0, 0, 0, 0)",p.style.whiteSpace="pre",p.style.webkitUserSelect="text",p.style.MozUserSelect="text",p.style.msUserSelect="text",p.style.userSelect="text",p.addEventListener("copy",function(g){if(g.stopPropagation(),o.format)if(g.preventDefault(),typeof g.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var S=e[o.format]||e.default;window.clipboardData.setData(S,s)}else g.clipboardData.clearData(),g.clipboardData.setData(o.format,s);o.onCopy&&(g.preventDefault(),o.onCopy(g.clipboardData))}),document.body.appendChild(p),u.selectNodeContents(p),f.addRange(u);var v=document.execCommand("copy");if(!v)throw new Error("copy command was unsuccessful");m=!0}catch(g){a&&console.error("unable to copy using execCommand: ",g),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(o.format||"text",s),o.onCopy&&o.onCopy(window.clipboardData),m=!0}catch(S){a&&console.error("unable to copy using clipboardData: ",S),a&&console.error("falling back to prompt"),l=r("message"in o?o.message:n),window.prompt(l,s)}}finally{f&&(typeof f.removeRange=="function"?f.removeRange(u):f.removeAllRanges()),p&&document.body.removeChild(p),c()}return m}return d6=i,d6}var Ret=Tet();const Iet=Xa(Ret);function ket(t,e){var n=_.useState(!1),r=n[0],i=n[1],s=e;return _.useEffect(function(){},[r,s]),[r,function(){var o=Iet(t);i(o)}]}const xet="_url_1ibuh_8",Pet="_button_1ibuh_15",Let="_qrCode_1ibuh_19",f6={url:xet,button:Pet,qrCode:Let},Aet="_toast_z5w27_8",Oet={toast:Aet},Met=({open:t,onDismiss:e,autoDismiss:n,children:r,Icon:i})=>{const s=_.useCallback(o=>{o||e()},[e]);return _.useEffect(()=>{if(t&&n!==void 0){const o=setTimeout(e,n);return()=>clearTimeout(o)}},[t,n,e]),E.jsx(PO,{open:t,onOpenChange:s,children:E.jsxs(LO,{children:[E.jsx(AO,{className:Ne(xl.bg,xl.animate)}),E.jsx(OO,{"aria-describedby":void 0,asChild:!0,children:E.jsxs(Ste,{className:Ne(xl.overlay,xl.animate,Oet.toast),children:[E.jsx(MO,{asChild:!0,children:E.jsx(ln,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&E.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]})})};var tm={},h6,rK;function Net(){return rK||(rK=1,h6=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),h6}var p6={},Ju={},iK;function rp(){if(iK)return Ju;iK=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Ju.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},Ju.getSymbolTotalCodewords=function(r){return e[r]},Ju.getBCHDigit=function(n){let r=0;for(;n!==0;)r++,n>>>=1;return r},Ju.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},Ju.isKanjiModeEnabled=function(){return typeof t<"u"},Ju.toSJIS=function(r){return t(r)},Ju}var m6={},sK;function w9(){return sK||(sK=1,function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,i){if(t.isValid(r))return r;try{return e(r)}catch{return i}}}(m6)),m6}var g6,oK;function Det(){if(oK)return g6;oK=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const n=Math.floor(e/8);return(this.buffer[n]>>>7-e%8&1)===1},put:function(e,n){for(let r=0;r<n;r++)this.putBit((e>>>n-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),e&&(this.buffer[n]|=128>>>this.length%8),this.length++}},g6=t,g6}var v6,aK;function Fet(){if(aK)return v6;aK=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,n,r,i){const s=e*this.size+n;this.data[s]=r,i&&(this.reservedBit[s]=!0)},t.prototype.get=function(e,n){return this.data[e*this.size+n]},t.prototype.xor=function(e,n,r){this.data[e*this.size+n]^=r},t.prototype.isReserved=function(e,n){return this.reservedBit[e*this.size+n]},v6=t,v6}var y6={},lK;function Uet(){return lK||(lK=1,function(t){const e=rp().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,s=e(r),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let l=1;l<i-1;l++)a[l]=a[l-1]-o;return a.push(6),a.reverse()},t.getPositions=function(r){const i=[],s=t.getRowColCoords(r),o=s.length;for(let a=0;a<o;a++)for(let l=0;l<o;l++)a===0&&l===0||a===0&&l===o-1||a===o-1&&l===0||i.push([s[a],s[l]]);return i}}(y6)),y6}var _6={},cK;function jet(){if(cK)return _6;cK=1;const t=rp().getSymbolSize,e=7;return _6.getPositions=function(r){const i=t(r);return[[0,0],[i-e,0],[0,i-e]]},_6}var b6={},uK;function $et(){return uK||(uK=1,function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},t.from=function(i){return t.isValid(i)?parseInt(i,10):void 0},t.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,l=0,c=null,u=null;for(let f=0;f<s;f++){a=l=0,c=u=null;for(let p=0;p<s;p++){let m=i.get(f,p);m===c?a++:(a>=5&&(o+=e.N1+(a-5)),c=m,a=1),m=i.get(p,f),m===u?l++:(l>=5&&(o+=e.N1+(l-5)),u=m,l=1)}a>=5&&(o+=e.N1+(a-5)),l>=5&&(o+=e.N1+(l-5))}return o},t.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let l=0;l<s-1;l++){const c=i.get(a,l)+i.get(a,l+1)+i.get(a+1,l)+i.get(a+1,l+1);(c===4||c===0)&&o++}return o*e.N2},t.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,l=0;for(let c=0;c<s;c++){a=l=0;for(let u=0;u<s;u++)a=a<<1&2047|i.get(c,u),u>=10&&(a===1488||a===93)&&o++,l=l<<1&2047|i.get(u,c),u>=10&&(l===1488||l===93)&&o++}return o*e.N3},t.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let l=0;l<o;l++)s+=i.data[l];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function n(r,i,s){switch(r){case t.Patterns.PATTERN000:return(i+s)%2===0;case t.Patterns.PATTERN001:return i%2===0;case t.Patterns.PATTERN010:return s%3===0;case t.Patterns.PATTERN011:return(i+s)%3===0;case t.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case t.Patterns.PATTERN101:return i*s%2+i*s%3===0;case t.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case t.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let l=0;l<o;l++)s.isReserved(l,a)||s.xor(l,a,n(i,l,a))},t.getBestMask=function(i,s){const o=Object.keys(t.Patterns).length;let a=0,l=1/0;for(let c=0;c<o;c++){s(c),t.applyMask(c,i);const u=t.getPenaltyN1(i)+t.getPenaltyN2(i)+t.getPenaltyN3(i)+t.getPenaltyN4(i);t.applyMask(c,i),u<l&&(l=u,a=c)}return a}}(b6)),b6}var m2={},dK;function hue(){if(dK)return m2;dK=1;const t=w9(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return m2.getBlocksCount=function(i,s){switch(s){case t.L:return e[(i-1)*4+0];case t.M:return e[(i-1)*4+1];case t.Q:return e[(i-1)*4+2];case t.H:return e[(i-1)*4+3];default:return}},m2.getTotalCodewordsCount=function(i,s){switch(s){case t.L:return n[(i-1)*4+0];case t.M:return n[(i-1)*4+1];case t.Q:return n[(i-1)*4+2];case t.H:return n[(i-1)*4+3];default:return}},m2}var S6={},Z0={},fK;function Bet(){if(fK)return Z0;fK=1;const t=new Uint8Array(512),e=new Uint8Array(256);return function(){let r=1;for(let i=0;i<255;i++)t[i]=r,e[r]=i,r<<=1,r&256&&(r^=285);for(let i=255;i<512;i++)t[i]=t[i-255]}(),Z0.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},Z0.exp=function(r){return t[r]},Z0.mul=function(r,i){return r===0||i===0?0:t[e[r]+e[i]]},Z0}var hK;function Het(){return hK||(hK=1,function(t){const e=Bet();t.mul=function(r,i){const s=new Uint8Array(r.length+i.length-1);for(let o=0;o<r.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(r[o],i[a]);return s},t.mod=function(r,i){let s=new Uint8Array(r);for(;s.length-i.length>=0;){const o=s[0];for(let l=0;l<i.length;l++)s[l]^=e.mul(i[l],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},t.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let s=0;s<r;s++)i=t.mul(i,new Uint8Array([1,e.exp(s)]));return i}}(S6)),S6}var E6,pK;function Vet(){if(pK)return E6;pK=1;const t=Het();function e(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const i=new Uint8Array(r.length+this.degree);i.set(r);const s=t.mod(i,this.genPoly),o=this.degree-s.length;if(o>0){const a=new Uint8Array(this.degree);return a.set(s,o),a}return s},E6=e,E6}var w6={},C6={},T6={},mK;function pue(){return mK||(mK=1,T6.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),T6}var ml={},gK;function mue(){if(gK)return ml;gK=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+`)(?:.|[\r
]))+`;ml.KANJI=new RegExp(n,"g"),ml.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ml.BYTE=new RegExp(r,"g"),ml.NUMERIC=new RegExp(t,"g"),ml.ALPHANUMERIC=new RegExp(e,"g");const i=new RegExp("^"+n+"$"),s=new RegExp("^"+t+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ml.testKanji=function(l){return i.test(l)},ml.testNumeric=function(l){return s.test(l)},ml.testAlphanumeric=function(l){return o.test(l)},ml}var vK;function ip(){return vK||(vK=1,function(t){const e=pue(),n=mue();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},t.getBestModeForData=function(s){return n.testNumeric(s)?t.NUMERIC:n.testAlphanumeric(s)?t.ALPHANUMERIC:n.testKanji(s)?t.KANJI:t.BYTE},t.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},t.isValid=function(s){return s&&s.bit&&s.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+i)}}t.from=function(s,o){if(t.isValid(s))return s;try{return r(s)}catch{return o}}}(C6)),C6}var yK;function Get(){return yK||(yK=1,function(t){const e=rp(),n=hue(),r=w9(),i=ip(),s=pue(),o=7973,a=e.getBCHDigit(o);function l(p,m,v){for(let g=1;g<=40;g++)if(m<=t.getCapacity(g,v,p))return g}function c(p,m){return i.getCharCountIndicator(p,m)+4}function u(p,m){let v=0;return p.forEach(function(g){const S=c(g.mode,m);v+=S+g.getBitsLength()}),v}function f(p,m){for(let v=1;v<=40;v++)if(u(p,v)<=t.getCapacity(v,m,i.MIXED))return v}t.from=function(m,v){return s.isValid(m)?parseInt(m,10):v},t.getCapacity=function(m,v,g){if(!s.isValid(m))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=i.BYTE);const S=e.getSymbolTotalCodewords(m),b=n.getTotalCodewordsCount(m,v),w=(S-b)*8;if(g===i.MIXED)return w;const k=w-c(g,m);switch(g){case i.NUMERIC:return Math.floor(k/10*3);case i.ALPHANUMERIC:return Math.floor(k/11*2);case i.KANJI:return Math.floor(k/13);case i.BYTE:default:return Math.floor(k/8)}},t.getBestVersionForData=function(m,v){let g;const S=r.from(v,r.M);if(Array.isArray(m)){if(m.length>1)return f(m,S);if(m.length===0)return 1;g=m[0]}else g=m;return l(g.mode,g.getLength(),S)},t.getEncodedBits=function(m){if(!s.isValid(m)||m<7)throw new Error("Invalid QR Code version");let v=m<<12;for(;e.getBCHDigit(v)-a>=0;)v^=o<<e.getBCHDigit(v)-a;return m<<12|v}}(w6)),w6}var R6={},_K;function qet(){if(_K)return R6;_K=1;const t=rp(),e=1335,n=21522,r=t.getBCHDigit(e);return R6.getEncodedBits=function(s,o){const a=s.bit<<3|o;let l=a<<10;for(;t.getBCHDigit(l)-r>=0;)l^=e<<t.getBCHDigit(l)-r;return(a<<10|l)^n},R6}var I6={},k6,bK;function Ket(){if(bK)return k6;bK=1;const t=ip();function e(n){this.mode=t.NUMERIC,this.data=n.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let i,s,o;for(i=0;i+3<=this.data.length;i+=3)s=this.data.substr(i,3),o=parseInt(s,10),r.put(o,10);const a=this.data.length-i;a>0&&(s=this.data.substr(i),o=parseInt(s,10),r.put(o,a*3+1))},k6=e,k6}var x6,SK;function Wet(){if(SK)return x6;SK=1;const t=ip(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(r){this.mode=t.ALPHANUMERIC,this.data=r}return n.getBitsLength=function(i){return 11*Math.floor(i/2)+6*(i%2)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(i){let s;for(s=0;s+2<=this.data.length;s+=2){let o=e.indexOf(this.data[s])*45;o+=e.indexOf(this.data[s+1]),i.put(o,11)}this.data.length%2&&i.put(e.indexOf(this.data[s]),6)},x6=n,x6}var P6,EK;function zet(){if(EK)return P6;EK=1;const t=ip();function e(n){this.mode=t.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){for(let r=0,i=this.data.length;r<i;r++)n.put(this.data[r],8)},P6=e,P6}var L6,wK;function Yet(){if(wK)return L6;wK=1;const t=ip(),e=rp();function n(r){this.mode=t.KANJI,this.data=r}return n.getBitsLength=function(i){return i*13},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(r){let i;for(i=0;i<this.data.length;i++){let s=e.toSJIS(this.data[i]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[i]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},L6=n,L6}var A6={exports:{}},CK;function Xet(){return CK||(CK=1,function(t){var e={single_source_shortest_paths:function(n,r,i){var s={},o={};o[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var l,c,u,f,p,m,v,g,S;!a.empty();){l=a.pop(),c=l.value,f=l.cost,p=n[c]||{};for(u in p)p.hasOwnProperty(u)&&(m=p[u],v=f+m,g=o[u],S=typeof o[u]>"u",(S||g>v)&&(o[u]=v,a.push(u,v),s[u]=c))}if(typeof i<"u"&&typeof o[i]>"u"){var b=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(b)}return s},extract_shortest_path_from_predecessor_list:function(n,r){for(var i=[],s=r;s;)i.push(s),n[s],s=n[s];return i.reverse(),i},find_path:function(n,r,i){var s=e.single_source_shortest_paths(n,r,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,i={},s;n=n||{};for(s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);return i.queue=[],i.sorter=n.sorter||r.default_sorter,i},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var i={value:n,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e}(A6)),A6.exports}var TK;function Jet(){return TK||(TK=1,function(t){const e=ip(),n=Ket(),r=Wet(),i=zet(),s=Yet(),o=mue(),a=rp(),l=Xet();function c(b){return unescape(encodeURIComponent(b)).length}function u(b,w,k){const T=[];let I;for(;(I=b.exec(k))!==null;)T.push({data:I[0],index:I.index,mode:w,length:I[0].length});return T}function f(b){const w=u(o.NUMERIC,e.NUMERIC,b),k=u(o.ALPHANUMERIC,e.ALPHANUMERIC,b);let T,I;return a.isKanjiModeEnabled()?(T=u(o.BYTE,e.BYTE,b),I=u(o.KANJI,e.KANJI,b)):(T=u(o.BYTE_KANJI,e.BYTE,b),I=[]),w.concat(k,T,I).sort(function(x,A){return x.index-A.index}).map(function(x){return{data:x.data,mode:x.mode,length:x.length}})}function p(b,w){switch(w){case e.NUMERIC:return n.getBitsLength(b);case e.ALPHANUMERIC:return r.getBitsLength(b);case e.KANJI:return s.getBitsLength(b);case e.BYTE:return i.getBitsLength(b)}}function m(b){return b.reduce(function(w,k){const T=w.length-1>=0?w[w.length-1]:null;return T&&T.mode===k.mode?(w[w.length-1].data+=k.data,w):(w.push(k),w)},[])}function v(b){const w=[];for(let k=0;k<b.length;k++){const T=b[k];switch(T.mode){case e.NUMERIC:w.push([T,{data:T.data,mode:e.ALPHANUMERIC,length:T.length},{data:T.data,mode:e.BYTE,length:T.length}]);break;case e.ALPHANUMERIC:w.push([T,{data:T.data,mode:e.BYTE,length:T.length}]);break;case e.KANJI:w.push([T,{data:T.data,mode:e.BYTE,length:c(T.data)}]);break;case e.BYTE:w.push([{data:T.data,mode:e.BYTE,length:c(T.data)}])}}return w}function g(b,w){const k={},T={start:{}};let I=["start"];for(let C=0;C<b.length;C++){const x=b[C],A=[];for(let N=0;N<x.length;N++){const D=x[N],F=""+C+N;A.push(F),k[F]={node:D,lastCount:0},T[F]={};for(let $=0;$<I.length;$++){const B=I[$];k[B]&&k[B].node.mode===D.mode?(T[B][F]=p(k[B].lastCount+D.length,D.mode)-p(k[B].lastCount,D.mode),k[B].lastCount+=D.length):(k[B]&&(k[B].lastCount=D.length),T[B][F]=p(D.length,D.mode)+4+e.getCharCountIndicator(D.mode,w))}}I=A}for(let C=0;C<I.length;C++)T[I[C]].end=0;return{map:T,table:k}}function S(b,w){let k;const T=e.getBestModeForData(b);if(k=e.from(w,T),k!==e.BYTE&&k.bit<T.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(k)+`.
 Suggested mode is: `+e.toString(T));switch(k===e.KANJI&&!a.isKanjiModeEnabled()&&(k=e.BYTE),k){case e.NUMERIC:return new n(b);case e.ALPHANUMERIC:return new r(b);case e.KANJI:return new s(b);case e.BYTE:return new i(b)}}t.fromArray=function(w){return w.reduce(function(k,T){return typeof T=="string"?k.push(S(T,null)):T.data&&k.push(S(T.data,T.mode)),k},[])},t.fromString=function(w,k){const T=f(w,a.isKanjiModeEnabled()),I=v(T),C=g(I,k),x=l.find_path(C.map,"start","end"),A=[];for(let N=1;N<x.length-1;N++)A.push(C.table[x[N]].node);return t.fromArray(m(A))},t.rawSplit=function(w){return t.fromArray(f(w,a.isKanjiModeEnabled()))}}(I6)),I6}var RK;function Zet(){if(RK)return p6;RK=1;const t=rp(),e=w9(),n=Det(),r=Fet(),i=Uet(),s=jet(),o=$et(),a=hue(),l=Vet(),c=Get(),u=qet(),f=ip(),p=Jet();function m(C,x){const A=C.size,N=s.getPositions(x);for(let D=0;D<N.length;D++){const F=N[D][0],$=N[D][1];for(let B=-1;B<=7;B++)if(!(F+B<=-1||A<=F+B))for(let W=-1;W<=7;W++)$+W<=-1||A<=$+W||(B>=0&&B<=6&&(W===0||W===6)||W>=0&&W<=6&&(B===0||B===6)||B>=2&&B<=4&&W>=2&&W<=4?C.set(F+B,$+W,!0,!0):C.set(F+B,$+W,!1,!0))}}function v(C){const x=C.size;for(let A=8;A<x-8;A++){const N=A%2===0;C.set(A,6,N,!0),C.set(6,A,N,!0)}}function g(C,x){const A=i.getPositions(x);for(let N=0;N<A.length;N++){const D=A[N][0],F=A[N][1];for(let $=-2;$<=2;$++)for(let B=-2;B<=2;B++)$===-2||$===2||B===-2||B===2||$===0&&B===0?C.set(D+$,F+B,!0,!0):C.set(D+$,F+B,!1,!0)}}function S(C,x){const A=C.size,N=c.getEncodedBits(x);let D,F,$;for(let B=0;B<18;B++)D=Math.floor(B/3),F=B%3+A-8-3,$=(N>>B&1)===1,C.set(D,F,$,!0),C.set(F,D,$,!0)}function b(C,x,A){const N=C.size,D=u.getEncodedBits(x,A);let F,$;for(F=0;F<15;F++)$=(D>>F&1)===1,F<6?C.set(F,8,$,!0):F<8?C.set(F+1,8,$,!0):C.set(N-15+F,8,$,!0),F<8?C.set(8,N-F-1,$,!0):F<9?C.set(8,15-F-1+1,$,!0):C.set(8,15-F-1,$,!0);C.set(N-8,8,1,!0)}function w(C,x){const A=C.size;let N=-1,D=A-1,F=7,$=0;for(let B=A-1;B>0;B-=2)for(B===6&&B--;;){for(let W=0;W<2;W++)if(!C.isReserved(D,B-W)){let H=!1;$<x.length&&(H=(x[$]>>>F&1)===1),C.set(D,B-W,H),F--,F===-1&&($++,F=7)}if(D+=N,D<0||A<=D){D-=N,N=-N;break}}}function k(C,x,A){const N=new n;A.forEach(function(W){N.put(W.mode.bit,4),N.put(W.getLength(),f.getCharCountIndicator(W.mode,C)),W.write(N)});const D=t.getSymbolTotalCodewords(C),F=a.getTotalCodewordsCount(C,x),$=(D-F)*8;for(N.getLengthInBits()+4<=$&&N.put(0,4);N.getLengthInBits()%8!==0;)N.putBit(0);const B=($-N.getLengthInBits())/8;for(let W=0;W<B;W++)N.put(W%2?17:236,8);return T(N,C,x)}function T(C,x,A){const N=t.getSymbolTotalCodewords(x),D=a.getTotalCodewordsCount(x,A),F=N-D,$=a.getBlocksCount(x,A),B=N%$,W=$-B,H=Math.floor(N/$),z=Math.floor(F/$),K=z+1,V=H-z,q=new l(V);let Z=0;const G=new Array($),Q=new Array($);let ge=0;const _e=new Uint8Array(C.buffer);for(let ve=0;ve<$;ve++){const We=ve<W?z:K;G[ve]=_e.slice(Z,Z+We),Q[ve]=q.encode(G[ve]),Z+=We,ge=Math.max(ge,We)}const Pe=new Uint8Array(N);let Te=0,Re,we;for(Re=0;Re<ge;Re++)for(we=0;we<$;we++)Re<G[we].length&&(Pe[Te++]=G[we][Re]);for(Re=0;Re<V;Re++)for(we=0;we<$;we++)Pe[Te++]=Q[we][Re];return Pe}function I(C,x,A,N){let D;if(Array.isArray(C))D=p.fromArray(C);else if(typeof C=="string"){let H=x;if(!H){const z=p.rawSplit(C);H=c.getBestVersionForData(z,A)}D=p.fromString(C,H||40)}else throw new Error("Invalid data");const F=c.getBestVersionForData(D,A);if(!F)throw new Error("The amount of data is too big to be stored in a QR Code");if(!x)x=F;else if(x<F)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+F+`.
`);const $=k(x,A,D),B=t.getSymbolSize(x),W=new r(B);return m(W,x),v(W),g(W,x),b(W,A,0),x>=7&&S(W,x),w(W,$),isNaN(N)&&(N=o.getBestMask(W,b.bind(null,W,A))),o.applyMask(N,W),b(W,A,N),{modules:W,version:x,errorCorrectionLevel:A,maskPattern:N,segments:D}}return p6.create=function(x,A){if(typeof x>"u"||x==="")throw new Error("No input text");let N=e.M,D,F;return typeof A<"u"&&(N=e.from(A.errorCorrectionLevel,e.M),D=c.from(A.version),F=o.from(A.maskPattern),A.toSJISFunc&&t.setToSJISFunction(A.toSJISFunc)),I(x,D,N,F)},p6}var O6={},M6={},IK;function gue(){return IK||(IK=1,function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},t.getImageWidth=function(r,i){const s=t.getScale(r,i);return Math.floor((r+i.margin*2)*s)},t.qrToImageData=function(r,i,s){const o=i.modules.size,a=i.modules.data,l=t.getScale(o,s),c=Math.floor((o+s.margin*2)*l),u=s.margin*l,f=[s.color.light,s.color.dark];for(let p=0;p<c;p++)for(let m=0;m<c;m++){let v=(p*c+m)*4,g=s.color.light;if(p>=u&&m>=u&&p<c-u&&m<c-u){const S=Math.floor((p-u)/l),b=Math.floor((m-u)/l);g=f[a[S*o+b]?1:0]}r[v++]=g.r,r[v++]=g.g,r[v++]=g.b,r[v]=g.a}}}(M6)),M6}var kK;function Qet(){return kK||(kK=1,function(t){const e=gue();function n(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(s,o,a){let l=a,c=o;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),o||(c=r()),l=e.getOptions(l);const u=e.getImageWidth(s.modules.size,l),f=c.getContext("2d"),p=f.createImageData(u,u);return e.qrToImageData(p.data,s,l),n(f,c,u),f.putImageData(p,0,0),c},t.renderToDataURL=function(s,o,a){let l=a;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),l||(l={});const c=t.render(s,o,l),u=l.type||"image/png",f=l.rendererOpts||{};return c.toDataURL(u,f.quality)}}(O6)),O6}var N6={},xK;function ett(){if(xK)return N6;xK=1;const t=gue();function e(i,s){const o=i.a/255,a=s+'="'+i.hex+'"';return o<1?a+" "+s+'-opacity="'+o.toFixed(2).slice(1)+'"':a}function n(i,s,o){let a=i+s;return typeof o<"u"&&(a+=" "+o),a}function r(i,s,o){let a="",l=0,c=!1,u=0;for(let f=0;f<i.length;f++){const p=Math.floor(f%s),m=Math.floor(f/s);!p&&!c&&(c=!0),i[f]?(u++,f>0&&p>0&&i[f-1]||(a+=c?n("M",p+o,.5+m+o):n("m",l,0),l=0,c=!1),p+1<s&&i[f+1]||(a+=n("h",u),u=0)):l++}return a}return N6.render=function(s,o,a){const l=t.getOptions(o),c=s.modules.size,u=s.modules.data,f=c+l.margin*2,p=l.color.light.a?"<path "+e(l.color.light,"fill")+' d="M0 0h'+f+"v"+f+'H0z"/>':"",m="<path "+e(l.color.dark,"stroke")+' d="'+r(u,c,l.margin)+'"/>',v='viewBox="0 0 '+f+" "+f+'"',S='<svg xmlns="http://www.w3.org/2000/svg" '+(l.width?'width="'+l.width+'" height="'+l.width+'" ':"")+v+' shape-rendering="crispEdges">'+p+m+`</svg>
`;return typeof a=="function"&&a(null,S),S},N6}var PK;function ttt(){if(PK)return tm;PK=1;const t=Net(),e=Zet(),n=Qet(),r=ett();function i(s,o,a,l,c){const u=[].slice.call(arguments,1),f=u.length,p=typeof u[f-1]=="function";if(!p&&!t())throw new Error("Callback required as last argument");if(p){if(f<2)throw new Error("Too few arguments provided");f===2?(c=a,a=o,o=l=void 0):f===3&&(o.getContext&&typeof c>"u"?(c=l,l=void 0):(c=l,l=a,a=o,o=void 0))}else{if(f<1)throw new Error("Too few arguments provided");return f===1?(a=o,o=l=void 0):f===2&&!o.getContext&&(l=a,a=o,o=void 0),new Promise(function(m,v){try{const g=e.create(a,l);m(s(g,o,l))}catch(g){v(g)}})}try{const m=e.create(a,l);c(null,s(m,o,l))}catch(m){c(m)}}return tm.create=e.create,tm.toCanvas=i.bind(null,n.render),tm.toDataURL=i.bind(null,n.renderToDataURL),tm.toString=i.bind(null,function(s,o,a){return r.render(s,a)}),tm}var ntt=ttt();const rtt="_qrCode_h54ia_8",itt={qrCode:rtt},stt=({data:t,className:e})=>{const[n,r]=_.useState(null);return _.useEffect(()=>{let i=!1;return ntt.toDataURL(t,{errorCorrectionLevel:"L"}).then(s=>{i||r(s)}).catch(s=>{i||r(null)}),()=>{i=!0}},[t]),E.jsx("div",{className:Ne(itt.qrCode,e),children:n&&E.jsx("img",{src:n,alt:Ya("qr_code")})})},ott=({room:t,open:e,onDismiss:n})=>{const{t:r}=et(),i=L_(t.roomId),s=_.useMemo(()=>ule(t.roomId,i,t.name),[i,t.name,t.roomId]),[,o]=ket(s),[a,l]=_.useState(!1),c=_.useCallback(()=>l(!1),[l]),u=_.useCallback(f=>{f.stopPropagation(),o(),n(),l(!0)},[o,n]);return E.jsxs(E.Fragment,{children:[E.jsxs(ep,{title:r("invite_modal.title"),open:e,onDismiss:n,children:[E.jsx(stt,{className:f6.qrCode,data:s}),E.jsx(ln,{className:f6.url,size:"sm",weight:"semibold",children:s}),E.jsx(Dt,{className:f6.button,Icon:R5e,onClick:u,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),E.jsx(Met,{open:a,onDismiss:c,autoDismiss:2e3,Icon:ine,children:r("invite_modal.link_copied_toast")})]})},att=({error:t,recoveryActionHandler:e,widget:n})=>{const{t:r}=et();let i;switch(t.category){case xE.CONFIGURATION_ISSUE:i=T5e;break;case xE.NETWORK_CONNECTIVITY:i=P5e;break;case xE.CLIENT_CONFIGURATION:i=G5e;break;default:i=oT}const s=[];return t instanceof Bce&&s.push({label:r("call_ended_view.reconnect_button"),onClick:()=>e("reconnect")}),E.jsx(zm,{children:E.jsxs(Ay,{Icon:i,title:t.localisedTitle,rageshake:t.code==v9.UNKNOWN_ERROR,widget:n,children:[E.jsx("p",{children:t.localisedMessage??E.jsx(Os,{i18nKey:"error.unexpected_ec_error",components:[E.jsx("b",{}),E.jsx("code",{})],values:{errorCode:t.code}})}),s&&s.map((o,a)=>E.jsx("button",{onClick:o.onClick,children:o.label},`action${a}`))]})})},ltt=({recoveryActionHandler:t,onError:e,children:n,widget:r})=>{const i=_.useCallback(({error:s,resetError:o})=>{const a=s instanceof tc?s:new y9(s instanceof Error?s:new Error);return E.jsx(att,{widget:r??null,error:a,resetError:o,recoveryActionHandler:l=>{o(),t(l)}})},[t,r]);return E.jsx(sT,{fallback:i,onError:s=>e==null?void 0:e(s),children:n})},ctt=({client:t,isPasswordlessUser:e,confineToRoom:n,preload:r,skipLobby:i,hideHeader:s,rtcSession:o,isJoined:a,muteStates:l,widget:c})=>{const[u,f]=_.useState(null),p=xse(o),m=Je(due),v=eu(E9({sounds:uue,latencyHint:"interactive",muted:m}));_.useEffect(()=>{var we,ve;p.length>=fet&&((ve=(we=l.audio).setEnabled)==null||ve.call(we,!1))},[]),_.useEffect(()=>(O.info("[Lifecycle] GroupCallView Component mounted"),()=>{O.info("[Lifecycle] GroupCallView Component unmounted")}),[]),_.useEffect(()=>(window.rtcSession=o,()=>{delete window.rtcSession}),[o]),ST(o,Ar.MembershipManagerError,we=>{f(new RJe(v9.MEMBERSHIP_MANAGER_UNRECOVERABLE,we.message??we))}),_.useEffect(()=>{t.getRoom(o.room.roomId)!==o.room&&O.warn(`We've ended up with multiple rooms for the same ID (${o.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)},[t,o.room]);const g=o.room,{displayName:S,avatarUrl:b}=T_(t),w=Eet(g),k=bet(g),{perParticipantE2EE:T,returnToLobby:I}=sa(),C=L_(g.roomId),[x]=bn(_se),[A]=bn(L8);O_(w);const N=_.useMemo(()=>({userId:t.getUserId(),displayName:S,avatarUrl:b,roomId:g.roomId,roomName:w,roomAlias:g.getCanonicalAlias(),roomAvatar:k,e2eeSystem:C}),[t,S,b,w,g,k,C]),D=_.useMemo(()=>new Set(p.map(we=>we.sender)).size,[p]),F=hf(),$=eu(F),B=eu(l),W=_.useCallback(async we=>{try{await yet(we,T,x,A)}catch(ve){if(ve instanceof tc)f(ve);else{O.error("Unknown Error while entering RTC session",ve);const We=new y9(ve instanceof Error?ve:new Error("Unknown error",{cause:ve}));f(We)}}},[T,A,x]);_.useEffect(()=>{const we=async({audioInput:ve,videoInput:We})=>{var hr,Ft,ze,Fr;const pn=await iu.getLocalDevices(void 0,!0);if(ve){const Tr=qG(ve,"audioinput",pn);Tr?(O.debug(`Found audio input ID ${Tr} for name ${ve}`),$.current.audioInput.select(Tr)):(O.warn("Unknown audio input: "+ve),(Ft=(hr=B.current.audio).setEnabled)==null||Ft.call(hr,!1))}if(We){const Tr=qG(We,"videoinput",pn);Tr?(O.debug(`Found video input ID ${Tr} for name ${We}`),$.current.videoInput.select(Tr)):(O.warn("Unknown video input: "+We),(Fr=(ze=B.current.video).setEnabled)==null||Fr.call(ze,!1))}};if(i)if(c)if(r){const ve=We=>{(async()=>{await we(We.detail.data),await W(o),c.api.transport.reply(We.detail,{})})().catch(pn=>{O.error("Error joining RTC session",pn)})};return c.lazyActions.on(fi.JoinCall,ve),()=>{c.lazyActions.off(fi.JoinCall,ve)}}else(async()=>{await W(o)})().catch(ve=>{O.error("Error joining RTC session",ve)});else W(o)},[c,o,r,i,T,$,B,W,x]);const[H,z]=_.useState(!1),K=Yl(),V=_.useCallback((we="user")=>{var hr;const ve=(hr=v.current)==null?void 0:hr.playSound("left"),We=!!c;z(!0);const pn=new Promise(Ft=>{xt.instance.eventCallEnded.track(g.roomId,o.memberships.length,We,o),window.setTimeout(Ft,10)});eK(o,we,Promise.all([ve,pn])).then(async()=>{!e&&!n&&!xt.instance.isEnabled()&&await K("/")}).catch(Ft=>{O.error("Error leaving RTC session",Ft)})},[v,c,o,g.roomId,e,n,K]);_.useEffect(()=>{if(c&&a){c.api.setAlwaysOnScreen(!0).catch(ve=>{O.error("Error calling setAlwaysOnScreen(true)",ve)});const we=ve=>{c.api.transport.reply(ve.detail,{}),eK(o,"user").catch(We=>{O.error("Failed to leave RTC session",We)})};return c.lazyActions.once(fi.HangupCall,we),()=>{c.lazyActions.off(fi.HangupCall,we)}}},[c,a,o]);const q=wet(g),[Z,G]=_.useState(!1),Q=_.useCallback(()=>G(!1),[G]),ge=_.useCallback(()=>G(!0),[G]),_e=q===Td.Public?ge:null;if(!sX()&&C.kind!==zt.NONE)throw new IJe;const Pe=E.jsx(ott,{room:g,open:Z,onDismiss:Q}),Te=E.jsxs(E.Fragment,{children:[Pe,E.jsx(Jle,{client:t,matrixInfo:N,muteStates:l,onEnter:()=>void W(o),confineToRoom:n,hideHeader:s,participantCount:D,onShareClick:_e})]});let Re;if(u){const we=()=>{throw u};Re=E.jsx(we,{})}else a?Re=E.jsxs(E.Fragment,{children:[Pe,E.jsx(uet,{client:t,matrixInfo:N,rtcSession:o,participantCount:D,onLeave:V,hideHeader:s,muteStates:l,e2eeSystem:C,onShareClick:_e})]}):H&&c===null?e||xt.instance.isEnabled()&&c===null?Re=E.jsx(nYe,{endedCallId:o.room.roomId,client:t,isPasswordlessUser:e,confineToRoom:n}):Re=null:H&&c!==null?Re=I?Te:null:r||i?Re=null:Re=Te;return E.jsx(ltt,{widget:c,recoveryActionHandler:we=>{we=="reconnect"&&(z(!1),W(o).catch(ve=>{O.error("Error re-entering RTC session",ve)}))},onError:()=>{o.isJoined()&&V("error")},children:Re})},utt="_modal_1tnec_8",dtt={modal:utt},ftt=({roomId:t})=>{const{t:e}=et(),[n,r]=_.useState(!0),i=_.useCallback(a=>{a.preventDefault(),a.stopPropagation(),r(!1)},[r]),s=L_(t);s.kind===zt.NONE&&O.error("Generating app redirect URL for encrypted room but don't have key available!");const o=_.useMemo(()=>{const a=new URL(t===null?window.location.href:ule(t,s));a.hash=t8e(a.hash,c=>(c.set("appPrompt","false"),c.set("confineToRoom","true"),c));const l=new URL("io.element.call:/");return l.searchParams.set("url",a.toString()),l.toString()},[s,t]);return E.jsxs(ep,{className:dtt.modal,title:e("app_selection_modal.title"),open:n,children:[E.jsx(ln,{size:"md",weight:"semibold",children:e("app_selection_modal.text")}),E.jsx(Dt,{kind:"secondary",onClick:i,children:e("app_selection_modal.continue_in_browser")}),E.jsx(Dt,{as:"a",href:o,Icon:Dne,children:e("app_selection_modal.open_in_app")})]})},htt=3,ptt=3e3;async function vue(t,e=0,...n){try{return await t.joinRoom(...n)}catch(r){if(r instanceof Nn&&r.errcode==="M_FORBIDDEN"&&e<htt)return await new Promise(i=>setTimeout(i,ptt)),vue(t,e+1,...n);throw r}}class AE extends Error{constructor(e,n,r,i){super(n),this.icon=e,this.messageBody=r,this.reason=i}}const mtt=(t,e,n)=>{const[r,i]=_.useState({kind:"loading"}),s=_.useRef(void 0),{t:o}=et(),a=_.useCallback(()=>new AE(b5e,o("group_call_loader.banned_heading"),o("group_call_loader.banned_body"),u()),[o]),l=_.useCallback(()=>new AE(aT,o("group_call_loader.knock_reject_heading"),o("group_call_loader.knock_reject_body"),u()),[o]),c=_.useCallback(()=>new AE(Sne,o("group_call_loader.call_ended_heading"),o("group_call_loader.call_ended_body"),u()),[o]),u=()=>{var f,p,m;return(m=(p=s.current)==null?void 0:p.currentState.getStateEvents(ee.RoomMember,(f=s.current)==null?void 0:f.myUserId))==null?void 0:m.getContent().reason};return _.useEffect(()=>{if(!t||!e)return;const f=async b=>{let w=null;const k=await t.getRoomIdForAlias(b.toLowerCase());return O.info(`${b} resolved to ${k.room_id}`),w=t.getRoom(k.room_id),w?O.info(`Already in room ${k.room_id}, not rejoining.`):(O.info(`Room ${k.room_id} not found, joining.`),w=await t.joinRoom(k.room_id,{viaServers:k.servers})),w},p=async(b,w,k)=>(await t.knockRoom(b,{viaServers:w}),k(),await new Promise((T,I)=>{t.on(xe.MyMembership,(C,x,A)=>{b===C.roomId&&(s.current=C,x===qe.Invite&&A===qe.Knock&&vue(t,0,C.roomId,{viaServers:w}).then(N=>{O.log("Auto-joined %s",N.roomId),T(N)},I),x===qe.Ban&&I(a()),x===qe.Leave&&I(l()))})})),m=async()=>{let b=null;if(e[0]==="#")b=await f(e),s.current=b;else{const w=e;b=t.getRoom(w),s.current=b??void 0;const k=b==null?void 0:b.getMyMembership();if(k===qe.Join)return b;if(Ze)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(k===qe.Ban)throw a();if(k===qe.Invite)b=await t.joinRoom(w,{viaServers:n});else{let T;try{T=await t.getRoomSummary(w,n)}catch(I){O.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",I)}if(T===void 0||T.join_rule===Td.Public)b=await t.joinRoom(w,{viaServers:n});else if(T.join_rule===Td.Knock){const I=T;let C=()=>{};const x=new Promise(A=>{I.membership!==qe.Knock?C=A:A()});i({kind:"canKnock",roomSummary:I,knock:C}),await x,b=await p(T.room_id,n,()=>i({kind:"waitForInvite",roomSummary:I}))}else throw new Error(`Room ${T.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`)}}return O.info(`Joined ${e}, waiting room to be ready for group calls`),await t.waitUntilRoomReadyForGroupCalls(b.roomId),O.info(`${e}, is ready for group calls`),b},v=async()=>{const b=await m();return s.current=b,O.debug(`Fetched / joined room ${e}`),t.matrixRTC.getRoomSession(b)},g=async()=>{t.getSyncState()!==qt.Syncing&&(O.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise(b=>{const w=()=>{if(t.getSyncState()===qt.Syncing)return t.off(Ae.Sync,w),b()};t.on(Ae.Sync,w)}),O.debug("useLoadGroupCall: client is now syncing."))},S=async()=>{await new Promise((b,w)=>{t.on(xe.MyMembership,(k,T)=>{T===qe.Leave&&w(c()),T===qe.Ban&&w(a())})})};r.kind==="loading"&&(O.log("Start loading group call"),g().then(v).then(b=>i({kind:"loaded",rtcSession:b})).then(S).catch(b=>i({kind:"failed",error:b})))},[a,t,l,c,e,r,o,n]),r};function gtt(t){const[,e]=_.useState(0);return _.useEffect(()=>{if(t!==void 0){const n=r=>{O.info(`Session in room ${t.room.roomId} changed to ${r?"joined":"left"}`),e(i=>i+1)};return t.on(Ar.JoinStateChanged,n),()=>{t.off(Ar.JoinStateChanged,n)}}},[t]),(t==null?void 0:t.isJoined())??!1}const vtt=()=>{const{confineToRoom:t,appPrompt:e,preload:n,hideHeader:r,displayName:i,skipLobby:s}=sa(),{t:o}=et(),{roomAlias:a,roomId:l,viaServers:c}=r8e(),u=l??a;u||O.error("No room specified");const{registerPasswordlessUser:f}=mle(),[p,m]=_.useState(!1),{loading:v,authenticated:g,client:S,error:b,passwordlessUser:w}=N8(),{avatarUrl:k,displayName:T}=T_(S),I=mtt(S,u,c),C=gtt(I.kind==="loaded"?I.rtcSession:void 0),x=pet(C);_.useEffect(()=>{!v&&!g&&i&&!Ze&&(m(!0),f(i).catch(B=>{O.error("Failed to register passwordless user",B)}).finally(()=>{m(!1)}))},[v,g,i,m,f]);const[A,N]=MT();_.useEffect(()=>{A===null&&N&&N(!0)},[A,N]);const D=_.useRef(!1);_.useEffect(()=>{I.kind==="loaded"&&D.current&&O.log("Play join sound 'Not yet implemented'")},[I.kind]);const F=()=>{switch(I.kind){case"loaded":return E.jsx(ctt,{widget:Ze,client:S,rtcSession:I.rtcSession,isJoined:C,isPasswordlessUser:w,confineToRoom:t,preload:n,skipLobby:s||D.current,hideHeader:r,muteStates:x});case"waitForInvite":case"canKnock":{D.current=D.current||I.kind==="waitForInvite";const B=I.kind==="canKnock"?I.knock:null,W=I.kind==="canKnock"?o("lobby.ask_to_join"):E.jsxs(E.Fragment,{children:[o("lobby.waiting_for_invite"),E.jsx(ine,{})]});return E.jsx(Jle,{client:S,matrixInfo:{userId:S.getUserId()??"",displayName:T??"",avatarUrl:k??"",roomAlias:null,roomId:I.roomSummary.room_id,roomName:I.roomSummary.name??"",roomAvatar:I.roomSummary.avatar_url??null,e2eeSystem:{kind:I.roomSummary["im.nheko.summary.encryption"]?zt.PER_PARTICIPANT:zt.NONE}},onEnter:()=>B==null?void 0:B(),enterLabel:W,waitingForInvite:I.kind==="waitForInvite",confineToRoom:t,hideHeader:r,participantCount:null,muteStates:x,onShareClick:null})}case"loading":return E.jsx(zm,{children:E.jsx("h1",{children:o("common.loading")})});case"failed":return D.current=!1,I.error.errcode==="M_NOT_FOUND"?E.jsx(zm,{children:E.jsx(Ay,{Icon:U5e,title:o("error.call_not_found"),widget:Ze,children:E.jsx(Os,{i18nKey:"error.call_not_found_description",children:E.jsxs("p",{children:["That link doesn't appear to belong to any existing call. Check that you have the right link, or"," ",E.jsx(Bl,{to:"/",children:"create a new one"}),"."]})})})}):I.error instanceof AE?E.jsx(zm,{children:E.jsxs(Ay,{Icon:I.error.icon,title:I.error.message,widget:Ze,children:[E.jsx("p",{children:I.error.messageBody}),I.error.reason&&E.jsx("p",{children:o("group_call_loader.reason",{reason:I.error.reason})})]})}):E.jsx(Oy,{widget:Ze,error:I.error});default:return E.jsx(E.Fragment,{children:" "})}};let $;return v||p?$=E.jsx(UT,{}):b?$=E.jsx(Oy,{widget:Ze,error:b}):S?u?$=F():$=E.jsx(hle,{}):$=E.jsx(TKe,{}),E.jsxs(E.Fragment,{children:[$,e&&Zt.get().app_prompt&&(Sh==="android"||Sh==="ios")&&l&&E.jsx(ftt,{roomId:l})]})},ytt="_banner_sye6n_8",_tt={banner:ytt},btt=({children:t,className:e,...n})=>{const{t:r}=et(),i=fv();let s=!1;return(i==null?void 0:i.state)==="valid"&&(s=i.disconnected),E.jsx(E.Fragment,{children:s&&E.jsxs("div",{className:Ne(_tt.banner,e),...n,children:[t,r("disconnected_banner")]})})},Stt="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQvNC10L3RjiIKICB9LAogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAi0JfQsNGC0LLQvtGA0LgiLAogICAgImNvcHlfbGluayI6ICLQmtC+0L/QuNGA0LDQvdC1INC90LAg0LLRgNGK0LfQutCw0YLQsCIsCiAgICAiZ28iOiAi0J3QsNC/0YDQtdC0IiwKICAgICJpbnZpdGUiOiAi0J/QvtC60LDQvdCwIiwKICAgICJubyI6ICLQndC1IiwKICAgICJyZWdpc3RlciI6ICLQoNC10LPQuNGB0YLRgNCw0YbQuNGPIiwKICAgICJyZW1vdmUiOiAi0J/RgNC10LzQsNGF0L3QuCIsCiAgICAic2lnbl9pbiI6ICLQktC70LXQtyIsCiAgICAic2lnbl9vdXQiOiAi0JjQt9C70LXQtyIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogItCh0YrQt9C00LDQuSDQsNC60LDRg9C90YIiLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD7Ql9Cw0YnQviDQvdC1INC90LDRgdGC0YDQvtC50YLQtSDQv9Cw0YDQvtC70LAg0LfQsCDQtNCwINC30LDQv9Cw0LfQuNGC0LUg0LDQutCw0YPQvdGC0LAg0YHQuD88LzA+PDE+0KnQtSDQvNC+0LbQtdGC0LUg0LTQsCDQt9Cw0L/QsNC30LjRgtC1INC40LzQtdGC0L4g0Lgg0LDQstCw0YLQsNGA0LAg0YHQuCDQt9CwINCx0YrQtNC10YnQuCDRgNCw0LfQs9C+0LLQvtGA0Lg8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLQndC1INGB0LXQs9CwLCDQstGK0YDQvdC4INGB0LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iCiAgfSwKICAiY29tbW9uIjogewogICAgImF1ZGlvIjogItCX0LLRg9C6IiwKICAgICJhdmF0YXIiOiAi0JDQstCw0YLQsNGAIiwKICAgICJkaXNwbGF5X25hbWUiOiAi0JjQvNC1L9C/0YHQtdCy0LTQvtC90LjQvCIsCiAgICAiaG9tZSI6ICLQndCw0YfQsNC70L4iLAogICAgImxvYWRpbmciOiAi0JfQsNGA0LXQttC00LDQvdC14oCmIiwKICAgICJwYXNzd29yZCI6ICLQn9Cw0YDQvtC70LAiLAogICAgInByb2ZpbGUiOiAi0J/RgNC+0YTQuNC7IiwKICAgICJzZXR0aW5ncyI6ICLQndCw0YHRgtGA0L7QudC60LgiLAogICAgInVzZXJuYW1lIjogItCf0L7RgtGA0LXQsdC40YLQtdC70YHQutC+INC40LzQtSIsCiAgICAidmlkZW8iOiAi0JLQuNC00LXQviIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi0JTQsCwg0L/RgNC40YHRitC10LTQuNC90Lgg0YHQtSIsCiAgICAidGV4dCI6ICLQotC+0LfQuCDRgNCw0LfQs9C+0LLQvtGAINCy0LXRh9C1INGB0YrRidC10YHRgtCy0YPQstCwLCDQuNGB0LrQsNGC0LUg0LvQuCDQtNCwINGB0LUg0L/RgNC40YHRitC10LTQuNC90LjRgtC1PyIsCiAgICAidGl0bGUiOiAi0J/RgNC40YHRitC10LTQuNC90Y/QstCw0L3QtSDQutGK0Lwg0YHRitGJ0LXRgdGC0LLRg9Cy0LDRiSDRgNCw0LfQs9C+0LLQvtGAPyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItCf0YDQvtC20LXQutGC0L7RgCIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItCS0LvQtdC3INCyINGA0LDQt9Cz0L7QstC+0YDQsCIKICB9LAogICJsb2dnaW5nX2luIjogItCS0LvQuNC30LDQvdC14oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD7QodGK0LfQtNCw0LnRgtC1INCw0LrQsNGD0L3RgjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLQktC70LXQtyIsCiAgInJhZ2VzaGFrZV9yZXF1ZXN0X21vZGFsIjogewogICAgImJvZHkiOiAi0JTRgNGD0LMg0L/QvtGC0YDQtdCx0LjRgtC10Lsg0LIg0YLQvtC30Lgg0YDQsNC30LPQvtCy0L7RgCDQuNC80LAg0L/RgNC+0LHQu9C10LwuINCX0LAg0LTQsCDQtNC40LDQs9C90L7RgdGC0LjRhtC40YDQsNC80LUg0YLQvtC30Lgg0L/RgNC+0LHQu9C10Lwg0L/Qvi3QtNC+0LHRgNC1INC90Lgg0YHQtSDQuNGB0LrQsCDQtNCwINGB0YrQsdC10YDQtdC8IGRlYnVnINC70L7Qs9C+0LLQtS4iLAogICAgInRpdGxlIjogItCX0LDRj9Cy0LrQsCDQt9CwIGRlYnVnINC70L7Qs9C+0LLQtSIKICB9LAogICJyYWdlc2hha2Vfc2VuZF9sb2dzIjogItCY0LfQv9GA0LDRgtC10YLQtSBkZWJ1ZyDQu9C+0LPQvtCy0LUiLAogICJyYWdlc2hha2Vfc2VuZGluZyI6ICLQmNC30L/RgNCw0YnQsNC90LXigKYiLAogICJyZWNhcHRjaGFfZGlzbWlzc2VkIjogIlJlY2FwdGNoYSDQvtGC0YXQstGK0YDQu9C10L3QsCIsCiAgInJlY2FwdGNoYV9ub3RfbG9hZGVkIjogIlJlY2FwdGNoYSDQvdC1INC1INC30LDRgNC10LTQtdC90LAiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICLQn9Cw0YDQvtC70LjRgtC1INC90LUg0YHRitCy0L/QsNC00LDRgiIsCiAgICAicmVnaXN0ZXJpbmciOiAi0KDQtdCz0LjRgdGC0YDQuNGA0LDQvdC14oCmIgogIH0sCiAgInJlZ2lzdGVyX2F1dGhfbGlua3MiOiAiPDA+0JLQtdGH0LUg0LjQvNCw0YLQtSDQsNC60LDRg9C90YI/PC8wPjwxPjwwPtCS0LvQtdC30YLQtSDRgSDQvdC10LPQvjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLQn9C+0YLQstGK0YDQtNC4INC/0LDRgNC+0LvQsNGC0LAiLAogICJyZXR1cm5faG9tZV9idXR0b24iOiAi0JLRgNGK0YnQsNC90LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iLAogICJzY3JlZW5zaGFyZV9idXR0b25fbGFiZWwiOiAi0KHQv9C+0LTQtdC70Lgg0LXQutGA0LDQvdCwIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLQoNCw0LfRgNCw0LHQvtGC0YfQuNC6IiwKICAgICJmZWVkYmFja190YWJfaDQiOiAi0JjQt9C/0YDQsNGC0Lgg0L7QsdGA0LDRgtC90LAg0LLRgNGK0LfQutCwIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogItCS0LrQu9GO0YfQuCBkZWJ1ZyDQu9C+0LPQvtCy0LUiCiAgfSwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfYm9keSI6ICLQktGB0LUg0L7RidC1INC90LUg0YHRgtC1INGA0LXQs9C40YHRgtGA0LjRgNCw0L3QuD8gPDI+0KHRitC30LTQsNC50YLQtSDQsNC60LDRg9C90YI8LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogItCS0LvQtdC30YLQtSDQsiDQsNC60LDRg9C90YLQsCDRgdC4IiwKICAidmVyc2lvbiI6ICLQktC10YDRgdC40Y86IHt7dmVyc2lvbn19Igp9Cg==",Ett=""+new URL("cs-app-v58LOBvt.json",import.meta.url).href,wtt=""+new URL("da-app-9paXotmH.json",import.meta.url).href,Ctt=""+new URL("de-app-DoDe9FNi.json",import.meta.url).href,Ttt=""+new URL("el-app-BBr3LLTK.json",import.meta.url).href,Rtt=""+new URL("en-app-DpvT44u_.json",import.meta.url).href,Itt=""+new URL("es-app-Q3c7lmEj.json",import.meta.url).href,ktt=""+new URL("et-app-DBPtMBtN.json",import.meta.url).href,xtt="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLZgdmH2LHYs9iqINqp2KfYsdio2LEiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogItio2LPYqtmGIiwKICAgICJnbyI6ICLYsdmB2KrZhiIsCiAgICAibm8iOiAi2K7bjNixIiwKICAgICJyZWdpc3RlciI6ICLYq9io2KrigIzZhtin2YUiLAogICAgInJlbW92ZSI6ICLYrdiw2YEiLAogICAgInNpZ25faW4iOiAi2YjYsdmI2K8iLAogICAgInNpZ25fb3V0IjogItiu2LHZiNisIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAi2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+2obYsdinINuM2qkg2LHZhdiyINi52KjZiNixINio2LHYp9uMINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2KrZhti424zZhSDZhtmF24zigIzaqdmG24zYr9ifPC8wPjwxPti02YXYpyDZhduM4oCM2KrZiNin2YbbjNivINmG2KfZhSDYrtmI2K8g2LHYpyDYrdmB2Lgg2qnZhtuM2K8g2Ygg24zaqSDYotmI2KfYqtin2LEg2KjYsdin24wg2KrZhdin2LPigIzZh9in24wg2KLbjNmG2K/ZhyDYqNiz2KfYstuM2K88LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLYp9mE2KfZhiDZhtmH2Iwg2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCDYqNix2q/Ysdiv24zYryIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi2LXYr9inIiwKICAgICJhdmF0YXIiOiAi2KLZiNin2KrYp9ixIiwKICAgICJkaXNwbGF5X25hbWUiOiAi2YbYp9mFINmG2YXYp9uM2LTbjCIsCiAgICAiaG9tZSI6ICLYrtin2YbZhyIsCiAgICAibG9hZGluZyI6ICLYqNin2LHar9iy2KfYsduM4oCmIiwKICAgICJwYXNzd29yZCI6ICLYsdmF2LIg2LnYqNmI2LEiLAogICAgInByb2ZpbGUiOiAi2b7YsdmI2YHYp9uM2YQiLAogICAgInNldHRpbmdzIjogItiq2YbYuNuM2YXYp9iqIiwKICAgICJ1c2VybmFtZSI6ICLZhtin2YUg2qnYp9ix2KjYsduMIiwKICAgICJ2aWRlbyI6ICLZiNuM2K/bjNmIIgogIH0sCiAgImhlYWRlcl9sYWJlbCI6ICLYrtin2YbZh9mUINiq2YXYp9izINin2YTZhdmG2KoiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi2KjZhNmH2Iwg2KjZhyDYqtmF2KfYsyDYqNm+24zZiNmG2K/bjNivIiwKICAgICJ0ZXh0IjogItin24zZhiDYqtmF2KfYsyDYp9iyINmC2KjZhCDZiNis2YjYryDYr9in2LHYr9iMINmF24zigIzYrtmI2KfZh9uM2K8g2KjZvtuM2YjZhtiv24zYr9ifIiwKICAgICJ0aXRsZSI6ICLZvtuM2YjYs9iqINio2Ycg2KrZhdin2LPYnyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItmG2YjYsSDYp9mB2qnZhiIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItm+24zZiNiz2KrZhiDYqNmHINiq2YXYp9izIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi2YjYsdmI2K/igKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPtiz2KfYrtiqINit2LPYp9ioINqp2KfYsdio2LHbjDwvMD4gT3IgPDI+2K/Ys9iq2LHYs9uMINio2Ycg2LnZhtmI2KfZhiDZhduM2YfZhdin2YY8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi2YjYsdmI2K8iLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItqp2KfYsdio2LEg2K/bjNqv2LHbjCDYr9ixINin24zZhiDYqtmF2KfYsyDZhdi02qnZhNuMINiv2KfYsdivLiDYqNix2KfbjCDYqti02K7bjNi1INio2YfYqtixINmF2LTaqdmE2Iwg2KjZh9iq2LEg2KfYs9iqINmF2Kcg2YTYp9qvINi524zYqOKAjNuM2KfYqNuMINix2Kcg2KzZhdi54oCM2KLZiNix24wg2qnZhtuM2YUuIiwKICAgICJ0aXRsZSI6ICLYr9ix2K7ZiNin2LPYqiDZhNin2q8g2LnbjNio4oCM24zYp9io24wiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLYp9ix2LPYp9mEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YTigKYiLAogICJyYWdlc2hha2Vfc2VuZGluZ19sb2dzIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YQg2KjYp9qv4oCM2YfYp9uMINi524zYqOKAjNuM2KfYqNuM4oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICLYsduM2qnZvtqG2Kcg2LHYryDYtNivIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAi2qnZvtqG2Kcg2KjYp9ix2q/bjNix24wg2YbYtNivIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi2LHZhdiyINi52KjZiNixINio2KfbjNivINmH2YXYrtmI2KfZhtuMINiv2KfYtNiq2Ycg2KjYp9i02K8iLAogICAgInJlZ2lzdGVyaW5nIjogItir2KjYquKAjNmG2KfZheKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtin2LIg2YLYqNmEINit2LPYp9ioINqp2KfYsdio2LHbjCDYr9in2LHbjNiv2J88LzA+PDE+PDA+2YjYsdmI2K88LzA+IE9yIDwyPtio2Ycg2LnZhtmI2KfZhiDbjNqpINmF24zZh9mF2KfZhiDZiNin2LHYryDYtNmI24zYrzwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLYqtin24zbjNivINix2YXYsti52KjZiNixIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItio2LHar9i02Kog2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCIsCiAgInNjcmVlbnNoYXJlX2J1dHRvbl9sYWJlbCI6ICLYp9i02KrYsdin2qkg2q/YsNin2LHbjCDYtdmB2K3ZhyDZhtmF2KfbjNi0IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLYqtmI2LPYudmHINiv2YfZhtiv2YciLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICLYqNin2LLYrtmI2LHYryDYp9ix2KfYptmHINiv2YfbjNivIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIti02KfZhdmEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogItmH2YbZiNiyINir2KjYquKAjNmG2KfZhSDZhtqp2LHYr9mH4oCM2KfbjNiv2J8gPDI+2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLYqNmHINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2YjYp9ix2K8g2LTZiNuM2K8iLAogICJ2ZXJzaW9uIjogItmG2LPYrtmHOiB7e9mG2LPYrtmHfX0iCn0K",Ptt=""+new URL("fi-app-tnO3DMdi.json",import.meta.url).href,Ltt=""+new URL("fr-app-BxTYbDfK.json",import.meta.url).href,Att=""+new URL("id-app-BEz8ptLJ.json",import.meta.url).href,Ott=""+new URL("it-app-Cik25Qgd.json",import.meta.url).href,Mtt=""+new URL("ja-app-Cp_00ujI.json",import.meta.url).href,Ntt=""+new URL("lv-app-D-ZV3Ytk.json",import.meta.url).href,Dtt=""+new URL("pl-app-CUkXVSZk.json",import.meta.url).href,Ftt=""+new URL("ro-app-CdYgKCOW.json",import.meta.url).href,Utt=""+new URL("ru-app-Bz0WyIJI.json",import.meta.url).href,jtt=""+new URL("sk-app-Bv2npyK0.json",import.meta.url).href,$tt=""+new URL("sv-app-BvdrRKW-.json",import.meta.url).href,Btt=""+new URL("tr-app-Dk--6BpP.json",import.meta.url).href,Htt=""+new URL("uk-app-DZD01h76.json",import.meta.url).href,Vtt="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAixJDDs25nIiwKICAgICJubyI6ICJLaMO0bmciLAogICAgInJlZ2lzdGVyIjogIsSQxINuZyBrw70iLAogICAgInNpZ25faW4iOiAixJDEg25nIG5o4bqtcCIsCiAgICAic2lnbl9vdXQiOiAixJDEg25nIHh14bqldCIsCiAgICAic3VibWl0IjogIkfhu61pIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAiVOG6oW8gdMOgaSBraG/huqNuIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+VOG6oWkgc2FvIGzhuqFpIGtow7RuZyBob8OgbiB0aGnhu4duIGLhurFuZyBjw6FjaCDEkeG6t3QgbeG6rXQga2jhuql1IMSR4buDIGdp4buvIHTDoGkga2hv4bqjbiBj4bunYSBi4bqhbj88LzA+PDE+QuG6oW4gc+G6vSBjw7MgdGjhu4MgZ2nhu68gdMOqbiB2w6AgxJHhurd0IOG6o25oIMSR4bqhaSBkaeG7h24gY2hvIG5o4buvbmcgY3Xhu5ljIGfhu41pIHRp4bq/cCB0aGVvLjwvMT4iLAogICAgImZlZWRiYWNrX2RvbmUiOiAiPDA+Q+G6o20gaMahbiB2w6wgxJHDoyBwaOG6o24gaOG7k2khPC8wPiIsCiAgICAiZmVlZGJhY2tfcHJvbXB0IjogIjwwPkNow7puZyB0w7RpIG114buRbiBuZ2hlIHBo4bqjbiBo4buTaSBj4bunYSBi4bqhbiDEkeG7gyBjw7JuIGPhuqNpIHRoaeG7h24gdHLhuqNpIG5naGnhu4dtIGNobyBi4bqhbi48LzA+IiwKICAgICJoZWFkbGluZSI6ICJ7e2Rpc3BsYXlOYW1lfX0sIGN14buZYyBn4buNaSDEkcOjIGvhur90IHRow7pjLiIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiw4JtIHRoYW5oIiwKICAgICJhdmF0YXIiOiAi4bqibmggxJHhuqFpIGRp4buHbiIsCiAgICAiZGlzcGxheV9uYW1lIjogIlTDqm4gaGnhu4NuIHRo4buLIiwKICAgICJsb2FkaW5nIjogIsSQYW5nIHThuqNp4oCmIiwKICAgICJwYXNzd29yZCI6ICJN4bqtdCBraOG6qXUiLAogICAgInByb2ZpbGUiOiAiSOG7kyBzxqEiLAogICAgInNldHRpbmdzIjogIkPDoGkgxJHhurd0IiwKICAgICJ1c2VybmFtZSI6ICJUw6puIG5nxrDhu51pIGTDuW5nIiwKICAgICJ2aWRlbyI6ICJUcnV54buBbiBow6xuaCIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAiVsOibmcsIHRoYW0gZ2lhIGN14buZYyBn4buNaSIsCiAgICAidGV4dCI6ICJDdeG7mWMgZ+G7jWkgxJHDoyB04buTbiB04bqhaSwgYuG6oW4gY8OzIG114buRbiB0aGFtIGdpYSBraMO0bmc/IiwKICAgICJ0aXRsZSI6ICJUaGFtIGdpYSBjdeG7mWMgZ+G7jWk/IgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAiVGnDqnUgxJFp4buDbSIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIlRoYW0gZ2lhIGN14buZYyBn4buNaSIKICB9LAogICJsb2dnaW5nX2luIjogIsSQYW5nIMSRxINuZyBuaOG6rXDigKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPlThuqFvIHTDoGkga2hv4bqjbjwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBraMOhYzwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLEkMSDbmcgbmjhuq1wIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJN4buZdCBuZ8aw4budaSBkw7luZyBraMOhYyB0cm9uZyBjdeG7mWMgZ+G7jWkgxJFhbmcgZ+G6t3AgduG6pW4gxJHhu4EuIMSQ4buDIGPDsyB0aOG7gyBjaOG6qW4gxJFvw6FuIHThu5F0IGjGoW4gY2jDum5nIHTDtGkgbXXhu5FuIHRodSB0aOG6rXAgbmjhuq10IGvDvSBn4buhIGzhu5dpLiIsCiAgICAidGl0bGUiOiAiWcOqdSBj4bqndSBuaOG6rXQga8O9IGfhu6EgbOG7l2kiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAixJBhbmcgZ+G7rWnigKYiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJDaMawYSB04bqjaSDEkcaw4bujYyBSZWNhcHRjaGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJN4bqtdCBraOG6qXUgcGjhuqNpIGto4bubcCIsCiAgICAicmVnaXN0ZXJpbmciOiAixJBhbmcgxJHEg25nIGvDveKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPsSQw6MgY8OzIHTDoGkga2hv4bqjbj88LzA+PDE+PDA+xJDEg25nIG5o4bqtcDwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBLaMOhY2g8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAiWMOhYyBuaOG6rW4gbeG6rXQga2jhuql1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkNoaWEgc+G6uyBtw6BuIGjDrG5oIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJOaMOgIHBow6F0IHRyaeG7g24iLAogICAgImZlZWRiYWNrX3RhYl9kZXNjcmlwdGlvbl9sYWJlbCI6ICJQaOG6o24gaOG7k2kgY+G7p2EgYuG6oW4iLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICJH4butaSBwaOG6o24gaOG7k2kiLAogICAgImZlZWRiYWNrX3RhYl9zZW5kX2xvZ3NfbGFiZWwiOiAiS8OobSB0aGVvIG5o4bqtdCBrw70gZ+G7oSBs4buXaSIsCiAgICAiZmVlZGJhY2tfdGFiX3RoYW5rX3lvdSI6ICJD4bqjbSDGoW4sIGNow7puZyB0w7RpIMSRw6Mgbmjhuq1uIMSRxrDhu6NjIHBo4bqjbiBo4buTaSEiLAogICAgImZlZWRiYWNrX3RhYl90aXRsZSI6ICJQaOG6o24gaOG7k2kiCiAgfSwKICAic3VibWl0dGluZyI6ICLEkGFuZyBn4butaeKApiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAiQ2jGsGEgxJHEg25nIGvDvT8gPDI+VOG6oW8gdMOgaSBraG/huqNuPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGPhu6dhIGLhuqFuIiwKICAidmVyc2lvbiI6ICJQaGnDqm4gYuG6o246IHt7dmVyc2lvbn19Igp9Cg==",Gtt=""+new URL("zh-Hans-app-BY5jJGyr.json",import.meta.url).href,qtt=""+new URL("zh-Hant-app-BV1LKS_j.json",import.meta.url).href,{slice:Ktt,forEach:Wtt}=[];function ztt(t){return Wtt.call(Ktt.call(arguments,1),e=>{if(e)for(const n in e)t[n]===void 0&&(t[n]=e[n])}),t}const LK=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Ytt=function(t,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let s=`${t}=${i}`;if(r.maxAge>0){const o=r.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(o)}`}if(r.domain){if(!LK.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!LK.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s},AK={create(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+n*60*1e3)),r&&(i.domain=r),document.cookie=Ytt(t,encodeURIComponent(e),i)},read(t){const e=`${t}=`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){let i=n[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(t){this.create(t,"",-1)}};var Xtt={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return AK.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:s}=e;n&&typeof document<"u"&&AK.create(n,t,r,i,s)}},Jtt={name:"querystring",lookup(t){var r;let{lookupQuerystring:e}=t,n;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const o=i.substring(1).split("&");for(let a=0;a<o.length;a++){const l=o[a].indexOf("=");l>0&&o[a].substring(0,l)===e&&(n=o[a].substring(l+1))}}return n}};let nm=null;const OK=()=>{if(nm!==null)return nm;try{if(nm=typeof window<"u"&&window.localStorage!==null,!nm)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{nm=!1}return nm};var Ztt={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&OK())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:n}=e;n&&OK()&&window.localStorage.setItem(n,t)}};let rm=null;const MK=()=>{if(rm!==null)return rm;try{if(rm=typeof window<"u"&&window.sessionStorage!==null,!rm)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{rm=!1}return rm};var Qtt={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&MK())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:n}=e;n&&MK()&&window.sessionStorage.setItem(n,t)}},ent={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:n,userLanguage:r,language:i}=navigator;if(n)for(let s=0;s<n.length;s++)e.push(n[s]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},tnt={name:"htmlTag",lookup(t){let{htmlTag:e}=t,n;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(n=r.getAttribute("lang")),n}},nnt={name:"path",lookup(t){var i;let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?(i=n[typeof e=="number"?e:0])==null?void 0:i.replace("/",""):void 0}},rnt={name:"subdomain",lookup(t){var i,s;let{lookupFromSubdomainIndex:e}=t;const n=typeof e=="number"?e+1:1,r=typeof window<"u"&&((s=(i=window.location)==null?void 0:i.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[n]}};let yue=!1;try{document.cookie,yue=!0}catch{}const _ue=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];yue||_ue.splice(1,1);const int=()=>({order:_ue,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class bue{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,n)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=ztt(n,this.options||{},int()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(Xtt),this.addDetector(Jtt),this.addDetector(Ztt),this.addDetector(Qtt),this.addDetector(ent),this.addDetector(tnt),this.addDetector(nnt),this.addDetector(rnt)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,n=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(n=n.concat(i))}}),n=n.map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}cacheUserLanguage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;n&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||n.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}bue.type="languageDetector";var g2={},NK;function snt(){if(NK)return g2;NK=1,Object.defineProperty(g2,"__esModule",{value:!0}),g2.shouldPolyfill=t;function t(){return!Intl.Segmenter}return g2}var ont=snt(),v2={},DK;function ant(){if(DK)return v2;DK=1,Object.defineProperty(v2,"__esModule",{value:!0}),v2.shouldPolyfill=t;function t(){return typeof Intl>"u"||!("DurationFormat"in Intl)}return v2}var lnt=ant();const Sue=Object.assign({"../locales/bg/app.json":Stt,"../locales/cs/app.json":Ett,"../locales/da/app.json":wtt,"../locales/de/app.json":Ctt,"../locales/el/app.json":Ttt,"../locales/en/app.json":Rtt,"../locales/es/app.json":Itt,"../locales/et/app.json":ktt,"../locales/fa/app.json":xtt,"../locales/fi/app.json":Ptt,"../locales/fr/app.json":Ltt,"../locales/id/app.json":Att,"../locales/it/app.json":Ott,"../locales/ja/app.json":Mtt,"../locales/lv/app.json":Ntt,"../locales/pl/app.json":Dtt,"../locales/ro/app.json":Ftt,"../locales/ru/app.json":Utt,"../locales/sk/app.json":jtt,"../locales/sv/app.json":$tt,"../locales/tr/app.json":Btt,"../locales/uk/app.json":Htt,"../locales/vi/app.json":Vtt,"../locales/zh-Hans/app.json":Gtt,"../locales/zh-Hant/app.json":qtt}),cnt=(t,e)=>Sue[`../locales/${t}/${e}.json`],unt=[...new Set(Object.keys(Sue).map(t=>{var n;const e=(n=t.match(/\/([^/]+)\/[^/]+\.json$/))==null?void 0:n[1];if(!e)throw new Error(`Could not parse locale URL ${t}`);return e}))],dnt={type:"backend",init(){},read(t,e,n){(async()=>{const r=cnt(t,e);if(!r)throw new Error(`Namespace ${e} for locale ${t} not found`);const i=await fetch(r,{credentials:"omit",headers:{Accept:"application/json"}});if(n8(i))throw Error(`Failed to fetch ${r}`);return await i.json()})().then(r=>n(null,r),r=>n(r,null))}};class fnt{constructor(){this.config=0,this.sentry=0,this.openTelemetry=0}allDepsAreLoaded(){return!Object.values(this).some(e=>e!==2)}}class ro{constructor(){this.isInitialized=!1,this.loadStates=new fnt}static isInitialized(){var e;return!!((e=ro.internalInstance)!=null&&e.isInitialized)}static async initBeforeReact(){const e=[];ont.shouldPolyfill()&&e.push(X1(()=>import("./polyfill-force-C40iLpTT.js").then(s=>s.p),__vite__mapDeps([2,3]),import.meta.url)),lnt.shouldPolyfill()&&e.push(X1(()=>import("./polyfill-force-juZMR7fT.js").then(s=>s.p),__vite__mapDeps([4,3]),import.meta.url)),await Promise.all(e);const n=new bue;n.addDetector({name:"urlFragment",lookup:()=>Ri().lang??void 0}),ki.on("languageChanged",s=>{document.documentElement.lang=s}),await ki.use(dnt).use(n).use(g5e).init({fallbackLng:"en",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",supportedLngs:unt,interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}});const{fonts:r,fontScale:i}=Ri();i!==null&&document.documentElement.style.setProperty("--font-scale",i.toString()),r.length>0&&document.documentElement.style.setProperty("--font-family",r.map(s=>`"${s}"`).join(", ")),document.body.setAttribute("data-platform",Sh)}static init(){var e;return(e=ro==null?void 0:ro.internalInstance)!=null&&e.initPromise?null:(ro.internalInstance=new ro,ro.internalInstance.initPromise=new Promise(n=>{var r;(r=ro.internalInstance)==null||r.initStep(n)}),ro.internalInstance.initPromise)}static reset(){ro.internalInstance=void 0}initStep(e){if(this.loadStates.config===0&&(this.loadStates.config=1,Zt.init().then(()=>{this.loadStates.config=2,this.initStep(e)},n=>{O.error("Failed to load config",n)})),this.loadStates.sentry===0&&this.loadStates.config===2){let n,r;n=Ri().sentryDsn??void 0,r=Ri().sentryEnvironment??void 0,n&&JCe({dsn:n,environment:r,integrations:[gTe({useEffect:Se.useEffect,useLocation:qi,useNavigationType:s_e,createRoutesFromChildren:cw,matchRoutes:LA})],tracesSampleRate:1}),this.loadStates.sentry=2}this.loadStates.openTelemetry===0&&this.loadStates.config===2&&(DT.globalInit(),this.loadStates.openTelemetry=2),this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const hnt=()=>{const[t,e]=_.useState(()=>Ri().theme),n=_.useRef(document.body.classList.item(0));_.useEffect(()=>{if(Ze){const r=i=>{i.preventDefault(),"name"in i.detail.data&&typeof i.detail.data.name=="string"&&e(i.detail.data.name),Ze.api.transport.reply(i.detail,{})};return Ze.lazyActions.on(ar.ThemeChange,r),()=>{Ze.lazyActions.off(ar.ThemeChange,r)}}},[]),_.useLayoutEffect(()=>{const r=t!=null&&t.includes("light")?"light":"dark",i=t!=null&&t.includes("high-contrast")?"-hc":"",s="cpd-theme-"+r+i;s!==n.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(s),n.current=s),document.body.classList.remove("no-theme")},[n,t])},y2=vTe(NX),pnt=({children:t})=>{const{pathname:e}=qi();return _.useEffect(()=>{let n="";!["/login","/register"].includes(e)&&!Ze&&(n="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=n},[e]),E.jsx(E.Fragment,{children:t})},mnt=({children:t})=>(hnt(),t),gnt=()=>{const[t,e]=_.useState(!1);return _.useEffect(()=>{var n;(n=ro.init())==null||n.then(async()=>{t||(e(!0),await(Ze==null?void 0:Ze.api.sendContentLoaded()))}).catch(O.error)}),E.jsx(q_e,{children:E.jsx(pnt,{children:E.jsx(mnt,{children:E.jsx(JZ,{children:t?E.jsx(_.Suspense,{fallback:null,children:E.jsx(DBe,{children:E.jsx(MHe,{children:E.jsx(sqe,{children:E.jsxs(sT,{fallback:n=>E.jsx(Oy,{error:n,widget:Ze}),children:[E.jsx(btt,{}),E.jsxs(S_e,{children:[E.jsx(y2,{path:"/",element:E.jsx(hle,{})}),E.jsx(y2,{path:"/login",element:E.jsx(yKe,{})}),E.jsx(y2,{path:"/register",element:E.jsx(_Ke,{})}),E.jsx(y2,{path:"*",element:E.jsx(vtt,{})})]})]})})})})}):E.jsx(UT,{})})})})})};window.setLKLogLevel=TY;d8e().catch(t=>{O.error("Failed to initialize rageshake",t)});TY("info");I0e((t,e,n)=>{global.mx_rage_logger.log(t,"livekit",e,n)});O.info("Element Call dev");const AL=zge.createRoot(document.getElementById("root"));let K1=null;window.isSecureContext?navigator.mediaDevices||(K1=new Error("Your browser does not support WebRTC.")):K1=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(K1!==null)throw AL.render(K1.message),K1;ro.initBeforeReact().then(()=>{AL.render(E.jsx(_.StrictMode,{children:E.jsx(gnt,{})}))}).catch(t=>{O.error("Failed to initialize app",t),AL.render(t.message)});export{Tnt as A,Int as B,Zt as C,dme as D,ee as E,xnt as F,lo as G,QL as H,knt as I,Ht as J,qe as K,Snt as L,Nn as M,Bc as N,KF as O,AF as P,Pnt as Q,Lnt as R,Wf as S,Un as T,Rnt as U,$t as V,sg as W,hme as X,Zo as _,ynt as a,ia as b,vnt as c,Cnt as d,U as e,kG as f,Xa as g,L as h,ale as i,bnt as j,ri as k,O as l,le as m,Rm as n,Ie as o,TC as p,KL as q,Sz as r,tu as s,Dnt as t,yge as u,Vg as v,ql as w,Hr as x,yme as y,E2 as z};
//# sourceMappingURL=index-fcopGTKV.js.map
